{"L2Jsb2cvMjAxNS8xMi9jb250ZW5pZG9ycw==":{"date":1449014400000,"title":"Docker: crea, desplega i executa aplicacions en contenidors","description":"Docker és una tecnologia que ha revolucionat el desplegament d’aplicacions i de programari degut a la seva senzillesa, facilitat d'ús i velocitat de  desplegament.","sections":["Blog","home"],"blog_tags":["desplegament","contenidors","docker"],"imatge":"/images/bloc/docker/large_h-dark-trans.png","path":"/blog/2015/12/contenidors","content":"Des de la Unitat d'Arquitectura de CTTI estem avaluant **Docker** com a tecnologia de desplegament d'aplicacions, de cara a utilitzar-la en el futur als clouds de la Generalitat.\n\nDocker és una tecnologia que ha revolucionat el desplegament d’aplicacions i de programari degut a la seva senzillesa, facilitat d'ús i velocitat de  desplegament.\n\nEl seu fonament és l’ús de plantilles, anomedades \"imatges\", que inclouen tant el sistema operatiu com les dependències necessàries per a executar les aplicacions. Aquestes imatges són: \n\n* **Extensibles**, podent partir d'imatges ja creades, i poder-hi afegir les característiques requerides a nivell de programari. \n\n* **Exportables**: la definició de la imatge consisteix en un fitxer de text (Dockerfile) que pot ser utilitzat per a crear la imatge a qualsevol ordinador/servidor i sistema operatiu.\n\n* **Lleugeres** en comparació amb les màquines virtuals tradicionals\n\nA partir de les imatges Docker s'arrenquen els contenidors. Els contenidors són instàncies executades d'una imatge concreta, arrencada amb una sèrie de característiques. Per exemple, una contenidor es pot arrencar amb aïllament de CPU i RAM, i amb volums de dades compartits entre el host i el contenidor per a realitzar certes operacions. \n\nDegut a que els contenidors no arrenquen un sistema operatiu complet, a diferència de les màquines virtuals, el seu _footprint_ és molt petit i són capaços d'arrencar en pocs segons, aspecte que permet l'escalat automàtic d'aplicacions de manera molt senzilla i sota demanda.\n\n## Comparativa entre VM i Docker\n\n![comparativa vm i docker](/images/bloc/docker/vm-vs-container2.png)\n\nUn altre aspecte a destacar és que els contenidors, i concretament Docker, és una tecnologia adoptada a la majoria de cloud públics (Amazon, Google, Azure, Bluemix, ...), fent dels contenidors una tecnologia portable i àmpliament suportada, junt amb un, cada cop més gran, ecosistema d'eines per a governar el cicle de vida dels contenidors i les imatges.\n\nA més, els fabricants de software també proporcionen imatges Docker oficials, donant certes garanties sobre la tecnologia i la manera de fer servir els seus productes.\n\nDes de la Unitat d'Arquitectura, una de les imatges que hem creat és la de **\"Apache GICAR\"**. Aquesta imatge ens permet aixecar instàncies d'Apache amb l'agent de Siteminder instal·lat i configurat en un segon (literalment), amb polítiques i configuracions diverses que es passen al contenidor en el moment de l'arrencada.\n\n","objectID":"L2Jsb2cvMjAxNS8xMi9jb250ZW5pZG9ycw=="},"L2Jsb2cvMjAxNS8xMi9sbGVuZ3VhdGdlcw==":{"date":1449100800000,"title":"Nous llenguatges i entorns d'execució: Node.js i Golang","description":"Tecnologies de desenvolupament i altres opcions davant noves necessitats dels projectes","sections":["Blog","home"],"blog_tags":["desenvolupament"],"imatge":"/images/bloc/nodejs_golang.png","expirydate":"2018-07-31","path":"/blog/2015/12/llenguatges","content":"Des de la Unitat d'Arquitectura fem un seguiment de noves tecnologies de desenvolupament, per a avaluar el seu encaix dins la Generalitat de Catalunya i tenir altres opcions davant noves necessitats dels projectes. \n\nUs presentem dues que tenim al nostre radar i amb les que ja hem fet alguns projectes:\n\n## Node.js\n\n* basat en la màquina de Google Chrome V8\n* javascript\n* model asíncron\n* un únic thread\n* la comunitat que més ha crescut als últims anys\n* grans empreses l'han adoptat per als seus serveis migrant-los de piles tecnològiques antigues\n* Node.js Foundation (https://nodejs.org/en/foundation/members/): fabricants i proveïdors de serveis formen part de la fundació\n\n\n### Experiències a la Generalitat\n\n* Serveis oberts (http://serveisoberts.gencat.cat ): \n\t* és una API d'accés a dades obertes de la Generalitat construïda sobre Node.js i MongoDB.  \n\t* exposa una API privada per a la sincronització de dades des dels backends i una API pública de consulta\n\t* inclou un \"explorador de dades\" per a cada col·lecció, per a poder visualitzar les dades en un format més amigable (http://serveisoberts.gencat.cat/equipaments/explorer)\n\n* Microservei per a les aplicacions de mobilitat per a comprovar versions i compatibilitat \n\n* Diccionari clínic de l'ICS\n\nResultat: alta productivitat de l'equip de desenvolupament, corba d'aprenentatge relativament petita i gran rendiment de la plataforma.\n\n\n## Golang\n\n* llenguatge que va sortir dels laboratoris de Google\n* intenta millorar aspectes de baix nivell que amb C són més difícils de realitzar\n* molt bona gestió de threads i concurrència\n* \"garbage collected\"\n* compilat\n* cross-compiling: des d'un mateix entorn es pot compilar per a diverses arquitectures\n\n### Experiències a la Generalitat\n\nHem desenvolupat una eina orientada a avaluar la qualitat de les infraestructures lliurades. \n\nEn aquest cas, ens permet avaluar si totes les connectivitats necessàries s'han obert, mitjançant el lliurament d'un fitxer de configuració en format YAML adaptat al projecte concret. L'eina genera un informe de resultats que inclou si les diferents connectivitats han estat satisfactòries o no, la data, hora i host en el que s'ha executat, així com un hash per a validar la integritat de l'informe generat.\n\nL'eina s'afegeix a totes les plantilles d'imatges virtuals de tots els CPDs, de manera que només s'ha d'afegir el fitxer de configuració i executar l'eina. \n\nCom que l'eina ha de córrer en diferents sistemes operatius i havia de ser compilada - per a evitar dependències externes - i el més lleugera possible, vàrem pensar que Golang podria ser una bona oportunitat. \n\nResultat: alta productivitat i posada en funcionament realment ràpida.\n","objectID":"L2Jsb2cvMjAxNS8xMi9sbGVuZ3VhdGdlcw=="},"L2Jsb2cvMjAxNi8wMS9hcGk=":{"date":1452556800000,"lastmod":"2017-10-03","title":"APIs RESTful: millors pràctiques","description":"Millors pràctiques per a la construcció d'APIs REST","toc":true,"sections":["Blog","home"],"blog_tags":["bones pràctiques","api","desenvolupament"],"imatge":"/images/bloc/json-api.png","path":"/blog/2016/01/api","content":"Aquest document pretèn unificar la manera d'interaccionar amb les APIs que ofereixin els diferents sistemes de la Generalitat, ja siguin públics o d'ús intern.\r\n\r\n## Acords generals\r\n\r\n- Utilitzarem estàndards HTTP: verbs, http codes, headers, ...\r\n- Els recursos exposats a través de la API seran en plural (\"aplicacions\" enlloc d' \"aplicacio\")\r\n- El format per defecte serà JSON. No es contemplaran altres formats, en general.\r\n- Recomanable utilitzar només caràcters alfanumérics per atributs que formin part d'una URI\r\n- Si exposem dades d'accés públic o per tercers, implementarem el verb OPTIONS per possibilitar CORS \r\n- Paràmetres del querystring reservats explicats més endavant:\r\n\t\r\n\t- fields\r\n\t- sort\r\n\t- q\r\n\t- limit\r\n\t- offset\r\n\t- v\r\n\r\n- La nostra API es publicarà en el path /api del nostre domini:\r\n\t\r\n\t\thttp://subdomini.gencat.cat/api\r\n\r\n## Verbs HTTP\r\n \r\n- GET = select\r\n- POST = insert\r\n- [PATCH o PUT] (http://www.baeldung.com/http-put-patch-difference-spring) = update \r\n- DELETE\r\n- OPTIONS \r\n\r\n###\t Exemple\r\n\r\nL'esquema general de la nostra uri serà el següent:\r\n\r\n\t\thttp://subdomini.gencat.cat/api/{recurs}/{id}\r\n\r\nImaginem que la nostra API gestiona el recurs \"Aplicació\". La notra API exposarà aquests recursos amb el verbs http de la manera següent:\r\n\r\n- GET **/aplicacions** - obté el llistat de totes les aplicacions\r\n- GET **/aplicacions/{id}** - obté la informació de l'aplicació amb l'id corresponent passat a l'URI\r\n- POST **/aplicacions** - crea una nova aplicació\r\n- PATCH o PUT **/aplicacions/{id}** - actualitza l'aplicació amb l'id corresponent passat a l'URI\r\n- DELETE **/aplicacions/{id}** - elimina l'aplicació amb l'id corresponent passat a l'URI\r\n- OPTIONS **/aplicacions** - obté  els verbs suportats per l'aplicacíó i si suporta CORS\r\n\r\n## Esquemes JSON\r\n\r\n- GET\r\n\r\n\t\t\t{\r\n\t\t\t\tdata : {\r\n\r\n\t\t\t\t\ttotal : 976,  //nombre total dels resultats de la petició\r\n\t\t\t\t\tlimit : 100,  //màxim nombre de resultats a retornar per a cada petició\r\n\t\t\t\t\tnumberOfElements : 10 // nombre d'elements que es mostren en la pàgina actual\r\n\t\t\t\t\toffset : 200, //en quin resultat del total comença aquesta petició \r\n\t\t\t\t\t\r\n\t\t\t\t\tincluded : [  //array de resultats\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tid : 1,\r\n\t\t\t\t\t\t\tcamp1 : \"A\",\r\n\t\t\t\t\t\t\tcamp2 : \"B\"\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tid : 2,\r\n\t\t\t\t\t\t\tcamp1 : \"C\",\r\n\t\t\t\t\t\t\tcamp2 : \"D\"\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t...\r\n\t\t\t\t\t]\r\n\t\t\t\t} \r\n\t\t\t}\r\n\r\n- GET/POST/PATCH/PUT/DELETE\r\n\r\n\t\t\t{\r\n\t\t\t\terrors : [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcode : 401,\r\n\t\t\t\t\t\tmessage : \"l'usuari proporcionat no té permisos d'accés\"\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t}\r\n\r\n- GET/POST/PATCH/PUT - Elements individuals\r\n\r\n\r\n\t\t\t{\r\n\t\t\t\tid : 1, // en el cas del POST no enviarem el id, normalment\r\n\t\t\t\tcamp1 : \"A\",\r\n\t\t\t\tcamp2 : \"B\"\r\n\t\t\t}\r\n\r\n\r\n## GET - Filtrat de resultats\r\n\r\n- Els recursos es filtraran mitjançant paràmetres al querystring.\r\n\r\n- S'utilitzarà un sol cop cada paràmetre que permeti filtratge:\r\n\r\n\t- si s'han de realitzar operacions més complexes, s'hauria d'establir el mecanisme amb un sol paràmetre\r\n\r\n- Exemple\r\n\r\n\t\tGET /aplicacions?estat=evolutiu&lang=nodejs\r\n\r\n\tRetornarà totes les aplicacions que en aquell moment estiguin en evolució i el llenguatge de desenvolupament sigui Node.js.\r\n\r\n## GET - Paginació\r\n\r\n- En una petició sense cap filtre, mai no es retornaran tots els elements del recurs consultat.\r\n\r\n- La nostra API implementarà paginació, indicant els resultats de la següent manera:\r\n\r\n\r\n\t\t\tdata : {\r\n\t\t\t\ttotal : 976,\r\n\t\t\t\tlimit : 100, \r\n\t\t\t\tnumberOfElements : 10,\r\n\t\t\t\toffset : 200,\r\n\t\t\t\tincluded : [\r\n\t\t\t\t\t...\r\n\t\t\t\t]\r\n\t\t\t} \r\n\r\n\r\n\t- el camp \"**total**\" indicarà el número de resultats d'una request\r\n\t- el camp \"**limit**\" indicarà el número de resultats per pàgina. S'inclourà al querystring. Si no s'informa, per defecte serà 10 i el màxim dependrà dels objectius de rendiment, però no hauríem de passar de 500 resultats.\r\n\t- el camp \"**offset**\" indicarà en quin resultat hauria de començar el subset de resultats demanat en una request. S'inclourà al querystring. Si no s'informa, per defecte serà 0 i retornarà el primers resultats en funció del paràmetre \"limit\".\r\n\r\n\t\t\tGET /aplicacions?limit=100&offset=200 \r\n\r\n\t\tRetornarà a partir del resultat 300 i amb 100 resultats en aquella petició.\r\n\r\n\r\n\t- Amb l'exemple anterior, el número de pàgines seria:\r\n\r\n\t\t- total / límit = 976 / 100 = 9,76, que arrodonit a l'enter superior ens donaria 10 planes\r\n\r\n\t- I la pàgina activa seria:\r\n\r\n\t\t- (offset / limit) + 1 = 200/100+1 = pàgina 3\r\n\r\n\t- [Exemple a jsfiddle](https://goo.gl/WKlXnV)\r\n\r\n## GET - Selecció de camps\r\n\r\n- Es permetrà seleccionar els camps que es volen consultar implementant el paràmetre \"**fields**\", on el seu valor seran els noms dels camps a incloure en els resultats separats per coma:\r\n\r\n\t\tGET /aplicacions?fields=codi,data_creacio,proveidor,lang \r\n\r\n\tRetornarà totes les aplicacions però els documents només retornaran els camps enumerats al camp fields.\r\n\t\t\r\n\r\n## GET - Ordre dels resultats\r\n\r\n- Si es requereix, es podrà habilitar un paràmetre \"**sort**\" que acceptarà valors dels camps separats per comes i on es podrà indicar amb el signe \"-\" precedint el nom del camp, l'ordre descendent per a aquell camp. Per defecte l'ordre serà ascendent\r\n\r\n- Exemple:\r\n\r\n\t\tGET /aplicacions?sort=data_creacio,-loc \r\n\r\n\tRetornarà totes les aplicacions ordenades per data de creació ascendent i línies de codi (loc) descendent.\r\n\r\n## GET - Cerca lliure\r\n\r\n- Per a les cerques lliures a qualsevol camp dels elements del recurs, el paràmetre per defecte serà \"**q**\"\r\n\r\n- Exemple:\r\n\r\n\t\tGET /aplicacions?q=mysql\r\n\r\n\tRetornarà totes les aplicacions que en algun dels camps continguin \"mysql\"\t\r\n\r\n## GET - Memòria cau\r\n\r\nLes peticions de tipus GET són succeptibles de ser guardades en memòria cau si l'API està exposada al públic i té un consum elevat. Depèn de què es vulgui guardar, establirem una o altra \"clau de caché\". \r\n\r\nUtilitzarem dues aproximacions:\r\n\r\n- Per a consultes sobre tot el recurs establirem una clau de caché que podria ser tota la url + el querystring o bé alguns paràmetres del querystring.\r\n\r\n\tPer a realitzar aquesta funcionalitat es podria incorporar dins la lògica de la pròpia API però la millor pràctica seria utilitzar serveis de caché externs (Varnish, caché a balancejadors, ...)\r\n\r\n- En qualsevol cas, siguin consultes múltiples o d'un ítem concret, hauríem de proporcionar les capçareleres http relacionades amb la caducitat dels resultats:\r\n\r\n\t- Etag\r\n\t- Date\r\n\t- Last-modified\r\n\t- Expires\r\n\r\n\r\n## POST - Creació d'un recurs\r\n\r\nAmb el verb POST crearem nous elements al nostre recurs:\r\n\r\n\t\tPOST /aplicacions/\r\n\t\tContent-type: application/json\r\n\r\n\t\t{\r\n\t\t\tdata : {\r\n\t\t\t\tcamp1 : \"A\",\r\n\t\t\t\tcamp2 : \"B\"\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\nSi tot ha anat correctament el HTTP response code serà 201. La resposta pot incloure un header location amb la uri del recurs creat.\r\n\r\n\r\n\t\tLocation: /api/aplicacions/5220-4848-864539594927\r\n\r\n\t\t{\r\n\t\t\tdata : {\r\n\t\t\t\tid : \"5220-4848-864539594927\", // en el cas del POST no enviarem el id, normalment\r\n\t\t\t\tcamp1 : \"A\",\r\n\t\t\t\tcamp2 : \"B\"\r\n\t\t\t}\r\n\t\t}\r\n\r\n## PUT - Actualització total d'un recurs\r\n\r\nAmb el verb PUT substituirem un recurs concret completament. Si un dels camps és una llista, que inclou [1,2,3,4,5] la nova llista al aplicar la operació de sota quedaria [2,3,4,5]\r\n\r\n\t\tPUT /aplicacions/5220-4848-864539594927\r\n\t\tContent-type: application/json\r\n\r\n\t\t{\r\n\t\t\tdata : {\r\n\t\t\t\tid : 5220-4848-864539594927\r\n\t\t\t\tcamp1 : \"X\"\r\n\t\t\t\tcamp2 : \"Y\"\r\n\t\t\t\tlista : [2,3,4,5]\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\nSi tot ha anat correctament el HTTP response code serà 20x, depenent de si s'ha realitzat o s'ha encuat per a processar\r\n\r\n## PATCH - Actualització parcial d'un recurs\r\n\r\nAmb el verb PATCH actualitzarem un recurs concret. Només actualitzarem els camps que constin al payload. Això te avantatges sobretot amb llistes on només especifiquem els canvis a afegir. Al nostre cas d'abans quedaria [1,2,3,4,5,2,3,4,5]\r\n\r\n\t\tPATCH /aplicacions/5220-4848-864539594927\r\n\t\tContent-type: application/json\r\n\r\n\t\t{\r\n\t\t\tdata : {\r\n\t\t\t\tid : 5220-4848-864539594927\r\n\t\t\t\tcamp1 : \"X\"\r\n\t\t\t\tcamp2: \"Y\"\r\n\t\t\t\tlista: [2,3,4,5]\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\nSi tot ha anat correctament el HTTP response code serà 20x, depenent de si s'ha realitzat o s'ha encuat per a processar\r\n\r\n## DELETE - Eliminació d'un recurs\r\n\r\nAmb el verb DELETE eliminarem un recurs concret.\r\n\r\n\t\tDELETE /aplicacions/5220-4848-864539594927\r\n\t\tContent-type: application/json\r\n\r\n\r\nSi tot ha anat correctament el HTTP response code serà 20x, depenent de si s'ha realitzat o s'ha encuat per a processar\r\n\r\n## Operacions múltiples (BATCH)\r\n\r\n- La nostra API podrà incorporar un mecanisme per a poder realitzar operacions múltiples (crear, actualitzar o eliminar) a la url:\r\n\r\n\t\thttp://subdomini.gencat.cat/api/_batch\r\n\r\n- L'acció serà de crear, actualitzar o eliminar, no es podran barrejar accions.\r\n\r\n- Es realitzarà mitjançant un POST amb el següent format de document:\r\n\r\n\r\n\t\tPATCH /_batch/\r\n\t\tContent-type: application/json\r\n\r\n\t\t{\r\n\t\t\taction : \"POST\" //o \"PATH\", \"DELETE\"\r\n\t\t\tdata : [\r\n\t\t\t\t{\r\n\t\t\t\t\tid : 5220-4848-864539594927\r\n\t\t\t\t\tcamp1 : \"X\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tid : 5220-4848-864539594928\r\n\t\t\t\t\tcamp1 : \"Z\"\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t}\r\n\r\n\r\n- En el cas de crear múltiples elements, és obligatori enviar un \"id\" que permeti retornar en la resposta si l'id enviat s'ha processat correctament o no.\r\n\r\n- Qualsevol acció múltiple estarà limitada a un màxim de **100 elements**.\r\n\r\n- La resposta http consistirà en el mateix atribut data enviat, que retornarà un status per a cada document enviat a crear, actualitzar o eliminar. En el cas d'errors, s'inclourà un atribut \"errors\" que serà un array d'errors a processar, amb el codi intern que li correspongui i la descripció.\r\n\r\n\t\t{\r\n\t\t\tdata : [\r\n\t\t\t\t{\r\n\t\t\t\t\tid : 5220-4848-864539594927,\r\n\t\t\t\t\tstatus: 200\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tid : 5220-4848-864539594928,\r\n\t\t\t\t\tstatus: 400,\r\n\t\t\t\t\terrors : [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tcode : 999,\r\n\t\t\t\t\t\t\tmessage : \"Falten camps obligatoris per informar\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t]\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t}\r\n\r\n\r\n\r\n\r\n## Multi idioma\r\n\r\nSi l'API pot retornar atributs en múltiples idiomes, tindrem dos mecanismes per a poder negociar-lo:\r\n\r\n- Paràmetre \"lang\" al querystring per a peticions GET\r\n\r\n\t\tGET /aplicacions?lang=ca\r\n\r\n- Header \"Accept-Language\" a tots els verbs\r\n\r\nUtilitzarem els codis de l'estàndard ISO-639-1: https://en.wikipedia.org/wiki/List_of_ISO_639-1_codes\r\n\r\nLa API tindrà un idioma per defecte i informarà en quins llenguatges es pot consultar a la seva pàgina d'ajuda.\r\n\r\n## Versionat\r\n\r\n- El mètode preferit per a seleccionar la versió que volem consultar de l'API, serà incloent el paràmetre \"**v**\" a la querystring\r\n\r\n- Exemple:\r\n\r\n\t\tGET /aplicacions?q=mysql&v=2 \r\n\r\n\tRetornarà totes les aplicacions que en algun dels camps continguin \"mysql\" en la versió 2 de l'API\r\n\r\n- Només farem versions per a canvis majors, de manera que els canvis menors s'incorporaran a la versió major actual en un moment donat, garantint la compatibilitat cap a enrera dels recursos servits mentre es mantingui una versió major.\r\n\r\n## Missatges i errors\r\n\r\nTota interacció amb els recursos de a nostra API retornarà un codi HTTP en funció del tipus d'acció i èxit o error de la mateixa. HTTP codes més comuns:\r\n\r\n- 200 – _OK_ – Tot correcte\r\n- 201 – _OK_ – Nou recurs creat (POST)\r\n- 204 – _OK_ – El recurs s'ha eliminat correctament (DELETE)\r\n\r\n- 304 – _Not Modified_. Es pot utilitzar la caché.\r\n\r\n- 400 – _Bad Request_ – La petició és incorrecta. L'error s'haurà de descriure en el _payload_ de la resposta http.\r\n- 401 – _Unauthorized_ – La petició requereix d'autorització.\r\n- 403 – _Forbidden_ – El servidor entèn la petició però la rebutja o l'accés no està permès.\r\n- 404 – _Not found_ – No s'ha trobat el recurs.\r\n\r\nEn cas d'errors, inclourem un _payload_ en format JSON que informarà dels problemes trobats, ampliant la informació si cal a la descripció (\"desc\"):\r\n\r\n\t\t\t{\r\n\t\t\t\terrors : [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcode : 404,\r\n\t\t\t\t\t\tmessage : \"El recurs sol·licitat no s'ha trobat\"\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\r\n\t\t\t}\r\n\r\n## Autenticació\r\n\r\nEls mecanismes preferits per a donar accés a la nostra API seran els següents, per ordre de preferència:\r\n\r\n1. Oauth2\r\n1. Autenticació Bàsica sobre GICAR\r\n1. HMAC\r\n\r\nEn cas d'existir un API Gateway en el moment d'implementar l'API, la millor opció serà gestionar la seguretat a través d'aquesta peça, millor que implementar-la a la nostra API.\r\n\r\n## Documentació\r\n\r\nEntre els formats de descripció d'APIs tenim Swagger i WADL. La nostra opció preferida serà utilitzar [Swagger](http://swagger.io/). Podeu veure un exemple de funcionament a [http://petstore.swagger.io/](http://petstore.swagger.io/)\r\n\r\n\r\n## Referències\r\n\r\n- http://jsonapi.org/\r\n- http://www.restapitutorial.com/resources.html\r\n- http://www.vinaysahni.com/best-practices-for-a-pragmatic-restful-api\r\n- http://restful-api-design.readthedocs.org/en/latest/methods.html\r\n- http://blog.mwaysolutions.com/2014/06/05/10-best-practices-for-better-restful-api/\r\n- http://blog.octo.com/en/design-a-rest-api\r\n\r\n### Aspectes pendents de definir\r\n\r\n- Filtrat per rangs: establir un QL\r\n\r\n- Relacions entre elements \r\n\r\n","objectID":"L2Jsb2cvMjAxNi8wMS9hcGk="},"L2Jsb2cvMjAxNi8wNC9hcHBsZXRzLXRvLWpubHA=":{"date":1459987200000,"title":"Dels Applets a Java Web Start amb JNLP","description":"Us expliquem breument les estratègies de migració dels Applets Java i en concret, la migració a tecnologia Java Web Start amb JNLP","sections":["Blog","home"],"blog_tags":["legacy"],"key":"ABRIL2016","path":"/blog/2016/04/applets-to-jnlp","content":"Tal i com us explicàvem fa unes setmanes, la tecnologia applet tal i com la coneixem deixarà de poder utilitzar-se als navegadors d'internet en breu i, a més, la versió Java 9 deixarà de donar suport als plugins de navegador que permeten l'execució d'aquests applets.\n\nPer tant, davant d'aquesta problemàtica se'ns presenten dues solucions:\n\n- Continuar utilitzant els applets amb l'alternativa recomanada per Oracle: Java Web Start\n- Canviar la funcionalitat que utilitza els applets per tecnologia nativa web\n\n### Java Web Start (JWS)\n\n[Java Web Start](https://www.java.com/en/download/faq/java_webstart.xml) permet executar aplicacions des de la web, però enlloc d'executar-se dins del navegador, incrustats a l'html (tags object, applet, ...) l'usuari es descarrega un fitxer JNLP (Java Network Launching Protocol) i, en clicar-lo, s'executa l'aplicació JWS fora del navegador.\n\nEn el cas dels applets, JWS dóna suport a la seva execució, de manera que un applet incrustat en una pàgina web d'aquesta manera:\n\n\t\t<applet code=\"java2d.Java2DemoApplet\"          \n        \tjnlp_href=\"dynamictree_applet.jnlp\"         \n        \twidth=\"710\" \n        \theight=\"540\" >        \n\t\t    <param name=\"param1\" value=\"value1\"/>\n\t\t</applet> \n\nPassaria a cridar-se mitjançant un fitxer amb extensió jnlp que contindria el següent codi:\n\n\t\t<jnlp spec='1.0+' codebase='http://sc-pre.aoc.cat/appletCentralitzat/resources/jars/' href=''>\n\t\t\t<information>\n\t\t\t\t<title>Applet Centralitzat</title>\n\t\t\t</information>\n\t\t\t<resources>\n\t\t\t\t<jar href=\"SwingSet2.jar\"/>\n\t\t\t</resources>\n\t\t\t<applet-desc main-class=\"SwingSet2Applet\" name=\"SwingSet\" width=\"625\" height=\"595\">\n\t\t\t\t<param name=\"param1\" value=\"value1\"/>\n\t\t\t  \t<param name=\"param2\" value=\"value2\"/>\n\t\t\t</applet-desc>\n\t\t</jnlp>\n\nL'usuari es descarregaria aquest fitxer des de la web i aixecaria l'aplicació Java fora del navegador. \n\n**En el cas que l'applet intercanviés informació amb l'aplicació web que el fa servir (o a la inversa) mitjançant javascript, aquesta comunicació deixarà de funcionar, i, per tant, s'haurà de canviar la manera de comunicar l'aplicació applet/java i l'aplicació web. La solució passa per crear un servei del costat de servidor que s'encarregui de comunicar l'applet i l'aplicació web.** \n\nNota d'Oracle sobre la migració d'applets a JWS: http://docs.oracle.com/javase/8/docs/technotes/guides/deploy/applet_dev_guide.html#JSDPG1032\n\n### Codi\n\n- Applet de Signatura de l'AOC: https://github.com/ConsorciAOC/signador \n\n","objectID":"L2Jsb2cvMjAxNi8wNC9hcHBsZXRzLXRvLWpubHA="},"L2Jsb2cvMjAxNi8wNS9yZXN0LXZzLWpzZg==":{"date":1463097600000,"title":"Aplicacions webs modernes: JSF vs REST","description":"Us donem una breu explicació d'aquest canvi de paradigma en la capa de presentació","sections":["Blog","home"],"blog_tags":["patrons de disseny","bones pràctiques","legacy","desenvolupament"],"imatge":"/images/bloc/rest.png","key":"JUNY2016","path":"/blog/2016/05/rest-vs-jsf","content":"Des de fa més de 3 anys, des de la Unitat d'Arquitectura Corporativa i el Centre de Suport Canigó, promovem la creació d'aplicacions orientades a serveis/API (dins els moviments de API Economy, API First, API Strategy) on la capa de presentació és un client més d'aquesta API. A més, proposem que aquest client html sigui totalment estàtic, on no hi hagi renderització des del costat de servidor: d'aquesta manera, el manteniment i evolució de l'aplicació és més senzill i no depenem de frameworks pesats de servidor (com són JSF o Struts).\n\nPer aquest motiu, us comuniquem que a partir d'aquest moment, **l'ús de JSF ha de ser exclusiu a efectes de manteniment d'aplicacions**. Qualsevol nova aplicació o funcionalitat dins d'una aplicació, s'hauria de desenvolupar seguint el patró REST, on el servidor exposa la lògica de negoci mitjançant serveis en format JSON (i seguint les millor pràctiques en desenvolupament d'APIs que trobareu al nostre bloc) i el client, normalment desenvolupat amb tecnologia estàtica (html/javascript/css), consumeix aquest servei.\n\nAixò no vol dir que no es puguin utilitzar elements de servidor (jsp) per a facilitar la renderització de plantilles, però s'hauria de reduir a la mínima expressió.\n\n#### JSF vs HTML5/JS\n\nA continuació s'exposen una sèrie de referències d'interès que reflecteixen l'impuls dels nous frameworks de client basats en HTML5 i Javascript vers el frameworks JSF més estès del moment, Primefaces:\n\n*Primefaces (JSF)*\n\n- https://www.thoughtworks.com/radar/languages-and-frameworks/jsf (Només manteniment)\n- https://github.com/primefaces/primefaces (No arriba a 400 starts a Github)\n\n*AngularJS (HTML5/JS)*\n\n- https://www.thoughtworks.com/radar/languages-and-frameworks/angularjs (Avaluar)\n- https://github.com/angular/angular.js (Aprop de 50.000 starts a Github)\n\n*ReactJS (HTML5/JS)*\n\n- https://www.thoughtworks.com/radar/languages-and-frameworks/react-js (Adoptar)\n- https://github.com/facebook/react (Més de 40.000 starts a Github)\n\n*EmberJS (HTML5/JS)*\n\n- https://www.thoughtworks.com/radar/languages-and-frameworks/ember-js (Provar)\n- https://github.com/emberjs/ember.js (Més de 16.000 starts a Github)\n\nLa tendència de les cerques realitzades a Google també indica un canvi clar des de fa uns anys:\n\n![Google Trends](/images/bloc/comparativa-frameworks.png  \"Google Trends\")\n\n*Termes comparats: Primefaces, Richfaces, JavaServer Faces (JSF), Representational state transfer (REST) i AngularJS (JavaScript MVW Framework)*\n\n### Notícies i comunicats\n\nDes del CS Canigó s'han anat publicant notícies i enviant comunicats durant aquests darrers anys promocionant aquest tipus d'arquitectura moderna REST+HTML5/JS:\n\n* [Notícia - Plantilla d'aplicació REST](http://canigo.ctti.gencat.cat/noticies/2015-09-01-Canigo-Plantilla-aplicacio-rest/)\n\n* [Notícia - Arquitectura d'aplicacions recomanada](http://canigo.ctti.gencat.cat/noticies/2015-07-24-Canigo-Arquitectura-aplicacio-recomanada/)\n\n* [Notícia - Integració de serveis REST amb GICAR](http://canigo.ctti.gencat.cat/noticies/2015-02-05-Canigo-integracio-serveis-rest-gicar/)\n\n* [Notícia - Cas d'èxit d'aplicació Canigó 3 amb arquitectura HTML5 + REST](http://canigo.ctti.gencat.cat/noticies/2015-01-08-canig%C3%B3-REST/)\n\n* [Comunicat Gener 2015](http://canigo.ctti.gencat.cat/related/cs/2015/01/comunicat.html)\n\n* [Comunicat Novembre 2013](http://canigo.ctti.gencat.cat/comunicats_antics/2013/11/)\n\n* [Comunicat Maig 2013](http://canigo.ctti.gencat.cat/comunicats_antics/2013/05/)\n\n### Canigó\n\nProperes publicacions del framework Canigó 3 deixaran de donar suport a JSF. També el plugin d'Eclipse inclòs l'[Entorn de desenvolupament Canigó](http://canigo.ctti.gencat.cat/canigo/entorn-desenvolupament/) per a generació de noves aplicacions no permetrà la generació d'aplicacions basades en aquesta tecnologia. L'única opció serà la creació d'aplicacions amb arquitectura REST+HTML5/JS.\n","objectID":"L2Jsb2cvMjAxNi8wNS9yZXN0LXZzLWpzZg=="},"L2Jsb2cvMjAxNi8wOC9taWNyb3NlcnZlaXM=":{"date":1470268800000,"title":"(micro)serveis","description":"Introducció al patró de disseny basat en microserveis i les implicacions que té a l'hora de pensar les aplicacions","sections":["Blog","home"],"blog_tags":["patrons de disseny","api","microserveis"],"imatge":"/images/bloc/microserveis.png","key":"SETEMBRE2016","path":"/blog/2016/08/microserveis","content":"**(micro)serveis és un patró de disseny** de sistemes orientat a descompondre una aplicació en les seves **unitats funcionals mínimes**, tractar-les com a aplicacions independents, on **cada servei és responsable d'un domini de negoci** i la resta de serveis es comuniquen amb ell mitjançant **interfícies i contractes estàndard** (per exemple, HTTP/REST amb una API coneguda).\n\nPosem (micro) entre parèntesis perquè la granularitat dels serveis dependrà de diversos factors, però el que sí que és important és que les comunicacions entre els diferents serveis/mòduls/funcionalitats es realitzi mitjançant les interfícies que s'exposin. El que no es farà en cap cas és anar a buscar les dades al repositori del servei que volem consumir. És a dir, cada servei serà [**\"l'única font de la veritat\"**](https://en.wikipedia.org/wiki/Single_source_of_truth) de les dades que gestiona.\n\nÉs un pas més a la componentització i modularització dels sistemes en totes les seves capes, on tant el **software** (la meva aplicació) com els **middlewares** (el programari sobre el que corre l'aplicació: servidor web, base de dades, ...) i els **entorns de desplegament** (contenidors o runtimes) es poden dedicar en exclusiva a cada (micro)servei.\n\n### Millors pràctiques\n\n- un servei, un repositori independent: els serveis no comparteixen repositori (lògic)\n- cada servei té un procés de construcció (build) independent\n- es recomana desplegar en contenidors o runtimes estàndards\n- s'han de respectar els contractes/interfícies interns (diferents equips de desenvolupament?) i externs (clients o aplicacions terceres)\n\t\n\n### Beneficis\n\n- cada servei és relativament petit i pot ser desplegat independentment de la resta (això sí, s'han de vigilar els canvis de contracte i per a això és important el versionat dels serveis).\n\n- en ser serveis independents i desplegats de manera independent, poden ser escalats per separat: els monòlits, per contra, s'han d'escalar en bloc.\n\n- permet fer conviure diverses tecnologies en un sistema, de manera que l'únic que ens hem de preocupar d'estandarditzar és la interfície de comunicació (API)\n\n- si un servei té problemes, no té per què veure's afectat tot el sistema, això sí, s'ha de gestionar en els diferents serveis la tolerància a errors de serveis tercers.\n\n\n### Aspectes a tenir presents\n\n- s'ha d'automatitzar TOT des del principi del projecte, ja que la coordinació és la clau de l'èxit.\n\n- en sistemes grans i amb molts serveis, apareixen patrons relacionats que cal gestionar, per a coreografiar els fluxes, gestionar la configuració, ...\n\n\t- service registration: els microserveis s'han d'enregistrar (ells mateixos o via un servei dedicat) al servei de registre\n\n\t- service discovery: han de poder ser \"descoberts\" pels clients abans de ser cridats o a la banda de servidor, que seria la millor pràctica, (en aquest cas, per un API Gateway), de manera que el sistema sabrà les diferents instàncies que corren i a les que ha de dirigir les peticions\n\n\t- seria recomanable disposar d'un API Gateway per a governar els serveis (seguretat, discovery, caché, ...)\n\n- estem acostumats a tenir les dades centralitzades mentre que en aquest patró estan descentralitzades. Per exemple estem acostumats a tenir eines de reporting o BI que accedeixen a un repositori centralitzat. En aquest cas, on els repositoris poden ser diferents i estar ubicats en diferents llocs, es pot optar per disposar d'una BD que agregui la informació per al reporting.\n\n### Canigó + (micro)serveis \n\nCom que estem parlant d'un patró, la seva implementació es pot realitzar de diverses maneres. I com ja hem comentat, aquest patró permet la coexistència de diverses tecnologies. \n\nEn el cas de Canigó, basat en Spring, tot dependrà del disseny que es faci de l'aplicació. Això sí, implica respectar els [principis d'arquitectura](http://canigo.ctti.gencat.cat/blog/2015/12/principis/) i les [millors pràctiques en la construcció d'apis i serveis](http://canigo.ctti.gencat.cat/blog/2016/01/api/). A més, algunes de les característiques d'aquest patró ja estan resoltes dins Spring Cloud (routing, load balancing, registry, discovery, ...) i per això recomanem el seu ús als projectes Canigó.\n\n\n<br />\n\n**Referències**:\n\n- http://samnewman.io/books/building_microservices/\n- https://www.nginx.com/blog/introduction-to-microservices/\n- http://microservices.io/patterns/microservices.html\n- https://www.nginx.com/blog/microservices-at-netflix-architectural-best-practices/\n- https://netflix.github.io/ (Common Runtime Services & Libraries: Eureka, Zuul, ...)\n- https://spring.io/blog/2015/07/14/microservices-with-spring\n- http://projects.spring.io/spring-cloud/\n","objectID":"L2Jsb2cvMjAxNi8wOC9taWNyb3NlcnZlaXM="},"L2Jsb2cvMjAxNi8wMi9hcHBsZXRz":{"date":1455494400000,"title":"Desenvolupament web. Discontinuació dels Applets Java","description":"","sections":["Blog","home"],"blog_tags":["legacy"],"imatge":"/images/bloc/applet.png","path":"/blog/2016/02/applets","content":"Com bé sabeu la tecnologia dels applets està entrant en obsolescència i se n’està discontinuant el suport per part dels diferents actors del mercat:\n\n* **Navegadors**: no es poden executar sobre Google Chrome des de setembre de 2015 en què es va deixar de donar suport a l’especificació NPAPI. La resta de navegadors també seguiran aquesta via (https://java.com/en/download/faq/chrome.xml)\n\n* **Màquina virtual Java**: a partir de la versió 9 de Java, Oracle deixarà de donar suport als applets. Està previst que aquesta versió es publiqui l’abril de 2017. Cal fer esment que encara que es disposés d’un navegador que suportés l’execució d’applets no els podria executar quan la jvm del PC sigui la versió 9 (https://blogs.oracle.com/java-platform-group/entry/moving_to_a_plugin_free)\n\nDes de la Unitat d’Arquitectura estem avaluant les diferents alternatives tecnològiques que hi ha a l’ús dels applets en funció del seu cas d’ús a les aplicacions de la Generalitat de Catalunya. \n\nActualment, tenim identificats els casos d’ús següents:\n\n* Accés a maquinari (perifèrics del PC):\n\n\t* **Accés a lectors de targes per la signatura digital des del navegador**. L’exemple més rellevant és el que es coneix com a “applet de CatCert”. L'AOC està en procés de construcció d’una alternativa a aquesta funcionalitat.  Estem fent seguiment amb ells per avaluar els impactes del canvi sobre els sistemes d’informació de la Generalitat. Al llarg de la propera setmana ja disposaran d’una primera versió sobre un entorn de proves i començaran les proves internes dins AOC.\n\n\t* **Accés a impressores**. Com per exemple, l’applet d S@rcat que permet accedir a la impressora de registre de documents.\n\n\t* **Accés a escàner**\n\n* Accés a programari:\n\n\t* **JClic**: aquest applet s'utilitza per a fer córrer aplicacions educatives que es dissenyen amb el Generador de JClic\n\n\t* **Edició de documents**. Applet que s’utilitza per a poder editar documents amb un openOffice instal·lat al PC, convertir-los a pdf, etc.\n\n\t* **Comparador de documents de MS Word**\n\n\t* **Gestió de dades a client**: per temes de performance en aplicacions antigues s'utilitzaven applets per a emmagatzemar dades poc volàtils per a evitar anar a buscar-les al servidor\n\n\t* **Generació de pantalles a client**\n\nDurant les properes setmanes publicarem les alternatives per substituir aquesta tecnologia a les aplicacions.\n\t","objectID":"L2Jsb2cvMjAxNi8wMi9hcHBsZXRz"},"L2Jsb2cvMjAxNy8wMy9hY2Nlcy1lbGFzdGljc2VhcmNoLWRiYWFz":{"date":1488412800000,"title":"Elasticsearch, open source en cloud públic amb orientació empresarial","description":"L'accés a un Elasticsearch a cloud públic té una sèrie de consideracions de seguretat a tenir en compte","sections":["Blog"],"blog_tags":["dbaas","seguretat"],"imatge":"/images/bloc/elastic-search.png","aliases":["/bloc/2017/03/acces-elasticsearch-dbaas/"],"path":"/blog/2017/03/acces-elasticsearch-dbaas","content":"La base de dades Elasticsearch (ES) en la seva versió de programari lliure no incorpora el mòdul de seguretat [X-Pack](https://www.elastic.co/products/x-pack/security) que permet gestionar-ne els permisos de connexió per prevenir accessos no autoritzats.\n\nLa gestió de la seguretat de la base de dades dedicada a cerques esdevé encara més crítica quan es tracta de solucions hostatjades en clouds públics i per a solucions amb visibilitat en portals web de lliure accés.\n\n## Accés des d’una pàgina web\n\nEn alguns casos, com per exemple cercadors a portals web, és possible que l’accés a l’ES es realitzi directament des del navegador de l’usuari. Per fer-ho, cal que el client disposi de les credencials d’accés a l’ES. No entrarem en detall sobre millors pràctiques de seguretat al respecte, però ho deixarem en què és una pràctica clarament insegura. Pels ES que no incorporin el mòdul X-Pack és més important encara, ja que els usuaris tenen privilegis de lectura i escriptura.\n\nUna opció que nosaltres hem implementat amb èxit per evitar aquesta problemàtica és aprovisionar un Proxy intermig que evita la potencial sostracció de credencials.\n\nLes planes web no haurien d’incorporar les credencials a l’ES donat que la sostracció d’aquestes podria derivar en un ús indegut. Pels ES que no incorporin el mòdul X-Pack és més important encara, ja que els usuaris tenen privilegis de lectura i escriptura.\n\nTenir en compte que el tràfic entre el Proxy i l’ElasticSearch ha d’estar encriptat per a evitar que es pugui interceptar les credencials.\n\n## Accés per la indexació de contingut\n\nAddicionalment a la mesura anterior, és molt recomanable també implementar un control sobre les IP que podran accedir a l’ES per fer les gravacions d’informació que conformen l’índex.\n\nEn el nostre cas, també s’ha posat en pràctica aquest filtratge i l’ES disposa d’una whitelist que només permet l’accés des del backend per poder administar-ne el contingut. \n\nMalgrat tot, si per algun motiu això no fos possible, alternativament també es podria utilitzar el Proxy que desacobla els accessos de les aplicacions per habilitar-hi el mecanisme de filtratge d’IPs en mode whitelist.\n\n![Seguretat accés a ES a cloud públic](/images/bloc/seguretat_es_cloud_public_generic.png)\n\n## Referències\n\n- [Securing Elasticsearch and Kibana](https://www.elastic.co/guide/en/x-pack/current/xpack-security.html)\n","objectID":"L2Jsb2cvMjAxNy8wMy9hY2Nlcy1lbGFzdGljc2VhcmNoLWRiYWFz"},"L2Jsb2cvMjAxNi8xMS93ZWItYXJxdWl0ZWN0dXJh":{"date":1478649600000,"lastmod":"2018-01-10","title":"Tecnologia darrera del Web d'Arquitectura","description":"Us expliquem la tecnologia darrera la web d'arquitectura i com l'utilitzem de base per a part de la R&D que fem a la unitat","sections":["Blog","home"],"blog_tags":["patrons de disseny"],"imatge":"/images/bloc/web-aq.png","aliases":["/bloc/2016/11/web-arquitectura/"],"path":"/blog/2016/11/web-arquitectura","content":"Amb el **Web d'Arquitectura** gaudim d'un petit laboratori d'investigació que ens permet avaluar tecnologies, provar aspectes que en un futur seran susceptibles de formar part del catàleg de solucions, i posar en producció principis i tècniques que serviran com a patrons per al disseny d'aplicacions.\n\n## Web d'Arquitectura S01E01 \"Pilot\"\n\nEl Web d'Arquitectura actual va néixer de l'antic web del Centre de Suport Canigó, desenvolupat amb _Confluence_, i era difícil de mantenir i evolucionar. En el moment que ens vàrem plantejar la modernització del web i l'ampliació de seccions i continguts, vam estudiar què es feia al món dels bloggers. \n\nAllà hi havia una tendència per a simplificar la pila tecnològica sobre la que corrien els blocs (normalment PHP + MySQL, com en el cas de Wordpress). D'aquest corrent varen començar a sorgir el que s'anomenen **Static Site Generators**. Aquestes eines simplificaven moltíssim la gestió de blocs, mitjançant un sistema de plantilles com qualsevol gestor de continguts. Utilitzant **markdown** com a metallenguatge que es \"compila\" a html, es generaven sites estàtics que es podien allotjar a tan sols un servidor web o en _(diverses plataformes)_ al núvol.\n\nVam considerar interessant aquesta aproximació i vam avaluar diverses eines. D'elles vam considerar [**Hugo**](http://gohugo.io) per la seva senzillesa i potència, per que no incorpora dependències externes (doncs és un sol binari), i aconsegueix un performance molt elevat en la generació del web. Una altra raó colateral es que està desenvolupat amb Golang i va coincidir en el temps amb la nostra investigació d'aquest llenguatge de programació.\n\nUn temps després, a principis de l'any 2015, vàrem publicar el web que esteu llegint.\n\n## Web d'Arquitectura S01E02 \"Hugo\"\n\nEn què ens beneficia, doncs, [**Hugo**](http://gohugo.io)? \n\nParadoxalment, en molts casos ens trobem que el rendiment que donen piles tecnològiques més complexes pel fet de ser dinàmiques, com el nostre vell i estimat model en 3 capes, no és òptim per la quantitat de visites que pateix. Llavors un remei que acostumem a aplicar és guardar, a memòria cau, còpies del html que genera aquest codi dinàmic, que, per disseny, a cada petició accedeix a una base de dades. És a dir, guardem a la caché una còpia de la crida que fa el codi dinàmic a la base de dades i la transformació a html que es serveix a l'usuari final. Llavors, ens trobem que, si obviem aquesta generació dinàmica, només necessitem quelcom que ens generi l'html directament. Val a dir que no tots els webs o aplicacions poden fer servir aquesta tècnica, però per al web d'arquitectura, va encaixar perfectament. Un altre dels principis que pretenim cobrir es que les arquitectures puguin evolucionar segons requeriments o la tecnologia de cada moment. En tenir els continguts en text pla organitzats en carpetes, un canvi d'eina de generació del web seria relativament senzill.\n\n## Web d'Arquitectura: el Making-off\n\nA banda de Hugo com a generador del site, hem anat incoporant diverses peces a mida que anàvem investigant o necessitant de noves solucions tecnològiques. Us fem un breu resum i us explicarem en posts posteriors algunes d'elles:\n\n- **Cercador**: inicialment utilitzàvem el _Google Search Appliance_ com a eina de cerca, però, lligat a que Google discontinuarà aquesta solució i havíem d'investigar-ne de noves, una de les avaluades ens va semblar prou bona i ens ha servit per establir requeriments per al futur **Cercador Corporatiu**. En aquest cas parlem d'[**Algolia**](https://www.algolia.com), un _Search Engine as a Service_ que dóna moltíssimes facilitats per a crear tant l'índex com les pàgines de resultats.\n\n- [**Github**](https://github.com): el web l'editen diversos usuaris i com que, inicialment, l'edició la fèiem en local (cada usuari editor necessitava instal·lar el binari d'Hugo a la seva màquina), necessitàvem un repositori àgil que ens permetés recuperar (git pull) i publicar (git push) els canvis i fer-los visibles als companys. A banda, ens ha servit per avaluar **Git** com a possible substitució del **Subversion** que utilitzem al **SIC**.\n\n- [**Github Pages**](https://pages.github.com): per a publicar el web, de manera que tingui la màxima disponibilitat possible, res millor que un _Content Delivery Network_. En aquest cas, utilitzant Github com a repositori del codi (templates Hugo, contingut markdown, ...), publicar el portal a la solució que ofereix el propi Github per a allotjar webs, ens va semblar una bona idea i ens va servir per a demostrar els beneficis de cloud públic per a segons quines necessitats.\n\n- [**NodeJS**](https://nodejs.org): utilitzem uns scripts desenvolupats amb aquesta tecnologia per a transformar el markdown a un index en JSON que injectem a Algolia. Fem un incremental amb els canvis, de manera que l'índex sempre està operatiu (_zero downtime_): https://github.com/cs-canigo/portal/blob/master/_tasks/algolia/index-algolia.js\n\n- [**Prose.io**](http://prose.io): com hem comentat, inicialment tots els usuaris editors havien d'instal·lar certes eines a la seva màquina (Hugo, client de Git,...). Recentment hem començat a utilitzar Prose com a editor per sobre de Github, cosa que ens permet actualitzar els continguts del portal a través del navegador web. Lligat al punt següent de Continuous Delivery, hem aconeguit tenir la solució totalment lliure de dependències locals i podem treballar únicament amb un navegador web.\n\n- **Continuous Delivery**: la nostra línia objectiu d'evolució del SIC, lligat a la iniciativa de cloud públic/contenidors/xpaas, és normalitzar els conceptes d'integració contínua i lliurament continu. En aquest cas, com que estem parlant d'un web estàtic, no crític, ens ha semblat un bon exemple per a començar. Hem utilitzat una eina al cloud públic ([**Wercker**](http://www.wercker.com)) que simularà el que acabarem fent al SIC amb Jenkins. En aquest cas, hem configurat l'eina per a que rebi un _webhook_ de Github quan es produeix un \"push\" del codi del portal. Aquesta eina s'encarrega de fer la construcció del web (amb Hugo), la indexació a Algolia (amb NodeJS) i la publicació a Github pages (amb Git). Aquí es pot veure el workflow i les pipelines que hem creat: https://github.com/cs-canigo/portal/blob/master/wercker.yml\n\n- [**Disqus**](https://disqus.com): Un cop creat el portal ens va semblar que li faltava un punt de interactivitat. Amb **Disqus** tenim una eina SaaS que ens permet la interacció amb els lectors en base a comentaris al propi bloc. Sent un portal obert al públic, Disqus ens permet també la gestió dels comentaris i així evitar comentaris malsonants o fora de lloc.\n\n![Workflow](/related/blog/workflow.png)\n\n\n## Referències\n\n* Llista de generadors de sites estàtics: https://www.staticgen.com/\n* Markdown: https://guides.github.com/features/mastering-markdown/\n* Codi del web a github: https://github.com/cs-canigo/portal\n* Html generat a github pages: https://github.com/cs-canigo/portal/tree/gh-pages\n","objectID":"L2Jsb2cvMjAxNi8xMS93ZWItYXJxdWl0ZWN0dXJh"},"L2Jsb2cvMjAxNi8wOS9jbG91ZC1yZWFkeQ==":{"date":1473897600000,"title":"Cloud-Ready","description":"Aspectes a tenir en compte en la definició de l'arquitectura d'una aplicació per estar preparada per anar al Cloud","sections":["Blog","home"],"blog_tags":["patrons de disseny","microserveis","api"],"imatge":"/images/bloc/cloud-ready.png","key":"OCTUBRE2016","path":"/blog/2016/09/cloud-ready","content":"Per tal que una aplicació pugui ser desplegada al **Cloud** i s'aprofiti dels beneficis que aquest aporta, cal que hagi estat dissenyada amb aquesta finalitat. Aquest disseny, normalment, és més complex que el disseny que es pugui realitzar per una aplicació destinada a ser desplegada en servidors \"on-premise\". Són molts els avantatges d'un entorn Cloud (flexibilitat, agilitat en aprovisionament, facilitat per desplegament continu, ...) que fan que l'esforç en la **definició de l'arquitectura** valgui la pena.\n\nA continuació s'enumeren diferents conceptes a tenir en compte en el disseny d'una aplicació que vulgui estar preparada per anar al Cloud:\n\n## Conceptes\n\n### Micro-serveis <img src=\"/images/bloc/cloud-ready-microservices.png\" alt=\"Microserveis\" style=\"width: 80px;\"/>\n\nL'aplicació ha de ser concebuda com una **col·lecció de serveis**, no com a una única peça (monòlit). Més informació en aquesta [entrada](/blog/2016/08/microserveis/) d'aquest mateix bloc.\n\n### Escalabilitat <img src=\"/images/bloc/cloud-ready-scalability.png\" alt=\"Escalabilitat\" style=\"width: 80px;\"/>\n\nUna arquitectura orientada a micro-serveis permetrà l'**escalabilitat de cada servei per separat**. Els entorns Cloud estan dissenyats per aprovisionar molts entorns d'execució petits (contenidors, paas, ...). Per tant, les arquitectures orientades a micro-serveis són de forma natural fàcilment integrables en entorns Cloud.\n\nL'escalabilitat permetrà canviar el nombre d'instàncies de l'aplicació segons les necessitats. És important que l'aplicació sigui el més \"stateless\" possible ja que d'aquesta manera serà molt més fàcil d'escalar.\n\nL'aplicació ha d'estar preparada per aturar-se i reiniciar-se sempre que calgui, aturant nodes quan la càrrega sigui petita o incrementant-ne quan hi hagi un pic de consum.\n\n### Agnòstic de la infraestructura <img src=\"/images/bloc/cloud-ready-infraestructure-agnostic.png\" alt=\"Agnòstic de la infraestructura\" style=\"width: 70px;\"/>\n\nL'aplicació **no ha d'estar lligada a cap element de la infraestructura** on hagi de ser desplegada. D'aquesta manera, si l'aplicació ha de traslladar-se d'una infraestructura a una altra de diferent, no es veurà afectada. Per exemple, no ha d'utilitzar IPs, o tenir en compte el número de instàncies de l'aplicació. Tampoc hauria de tenir funcionalitats dependents d'un sistema operatiu concret.\n\n### Robustesa <img src=\"/images/bloc/cloud-ready-fault-tolerance.png\" alt=\"Robustesa\" style=\"width: 50px;\"/>\n\nCada component ha de ser **el més autònom possible**, podent funcionar encara que la resta no estiguin disponibles. Aquesta tolerància a fallides és clau per a l'èxit d'una aplicació amb una arquitectura distribuïda. S'han d'evitar punts crítics que suposin la caiguda (downtime) de tota l'aplicació.\n\n### Desacoblament de les dades <img src=\"/images/bloc/cloud-ready-decoupled.png\" alt=\"Desacoblament\" style=\"width: 60px;\"/>\n\nEl **processament de les dades, i les mateixes dades, han d'estar en components separats**. Un cop desacoblats, és possible tenir les dades en un CPD privat i fer-ne el processament en un cloud públic o privat. Aquesta és una pràctica habitual en empreses i organitzacions que volen tenir les dades en els seus servidors però aprofitar els avantatges que proporciona el cloud.\n\n### Emmagatzemament local <img src=\"/images/bloc/cloud-ready-storage.jpg\" alt=\"Emmagatzemament\" style=\"width: 80px;\"/>\n\nEn un entorn Cloud **els fitxers que escriu l'aplicació al sistema de fitxers local són volàtils**. Per exemple, suposant que l'aplicació utilitza el sistema de fitxers local com a caché, en aturar-se un node i aixecar-se posteriorment en una altra ubicació (màquina física, VM, ...), aquesta caché desapareixerà, el que suposarà que el temps de resposta serà diferent dels altres nodes on si existeix aquesta caché. El que es recomana és utilitzar un repositori extern com pugui ser una base de dades SQL o NoSQL.\n\nUn altre aspecte a tenir en compte és la lectura de fitxers de configuració de l'aplicació. Aquests han de ser idèntics en tots els nodes, ja que en cas contrari el resultat pot ser inesperat.\n\n### Seguretat <img src=\"/images/bloc/cloud-ready-security.png\" alt=\"Seguretat\" style=\"width: 80px;\"/>\n\n#### Stateless\n\nPer tal que una aplicació no es vegi afectada per un escalat dinàmic (canvi del nombre d'instàncies en calent) cal que sigui \"stateless\", és a dir, **no mantingui l'estat en la mateixa aplicació**. Una possibilitat és emmagatzemar part de l'estat en el navegador en aplicacions web modernes utilitzant funcionalitats d'HTML5, encara que el més habitual és utilitzar un repositori centralitzat en el servidor (Redis, per exemple). No ha d'utilitzar-se l'HTTPSession en Java, o session[] hash a Ruby on Rails, donat que llavors estem emmagatzemant l'estat dins la pròpia aplicació, fet que volem evitar. La solució implica utilitzar un repositori amb alta disponibilitat extern a l'aplicació com pugui ser Redis o Memcached. \n\n### Interoperabilitat  <img src=\"/images/bloc/cloud-ready-interoperability.png\" alt=\"Interoperability\" style=\"width: 60px;\"/>\n\n#### Protocols moderns i estàndards\n\nL'aplicació ha d'utilitzar protocols moderns, preferiblement **REST sobre HTTP(s)**, o inclús SOAP i WS-* estàndards. Per tant, cal evitar l'ús de protocols com per exemple RMI-IIOP ja en desús des de fa força temps.\n\n#### Optimització de la comunicació entre components\n\nPer tal que una aplicació tingui un bon rendiment, cal pensar molt bé quina és la manera més òptima per a comunicar els diferents components que en formen part. Per exemple, agrupant missatges en lloc d'estar contínuament fent intercanvi d'informació.\n\n### DevOps <img src=\"/images/bloc/cloud-ready-devops.jpg\" alt=\"DevOps\" style=\"width: 60px;\"/>\n\n#### Configuració/Automatització\n\nÉs molt important que els equips de desenvolupament i operacions es posin d'acord en com ha de ser la configuració de l'aplicació per a poder ser desplegada en els diferents entorns i aquest procés de desplegament pugui automatitzar-se (DevOps). Per assolir aquest objectiu cal definir **convencions** i documentar com han de ser aquestes configuracions per tal que no hi hagi divergències que puguin dificultar la tasca.\n\n#### Monitorització\n\nL'aplicació ha de poder ser monitoritzada. No ha de ser necessari tenir coneixements (interpretar logs) de l'aplicació per a poder determinar si aquesta està funcionant correctament o no. Per tant, han d'existir **mètriques i sondes (health check URL) tècniques**, no funcionals, que permetin saber si l'estat de l'aplicació és correcte. Per exemple, una URL que retorni el codi HTTP 200 en cas satisfactori o un codi diferent altrament.\n\n#### Traçabilitat\n\nL'aplicació no ha d'escriure els logs a un fitxer local. Cal recordar que els nodes han de poder aturar-se i reiniciar-se sense que l'aplicació es vegi afectada. En cas que els logs s'escriguin en el sistema de fitxers local aquesta informació es perdrà.\n\nEn entorns cloud s'acostuma a utilitzar un servei extern que funciona com a **agregador de logs**. D'aquesta manera els logs persistiran encara que els nodes de l'aplicació s'eliminin. Donat que la transmissió de logs es fa per la xarxa, cal anar amb compte amb el nivell de log (error, warn, info, debug, trace) configurat en entorns productius, ja que pot produïr un problema de saturació en cas que estigui configurat a un nivell de detall molt alt. El volum de logs ha de ser manegable.\n\n## Canigó\n\nEs preveu una evolució del framework Canigó durant l'any 2017 en aquesta línia, per tal de facilitar el màxim possible el seu desplegament en entorns Cloud.\n\n<br />\n\n**Referències**:\n\n- http://blog.octo.com/en/cloud-ready-applications/\n- http://www.ibm.com/developerworks/websphere/techjournal/1404_brown/1404_brown.html\n- http://techbeacon.com/5-steps-building-cloud-ready-application-architecture\n","objectID":"L2Jsb2cvMjAxNi8wOS9jbG91ZC1yZWFkeQ=="},"L2Jsb2cvMjAxNy8wNi9Hb29nbGVDbG91ZE5leHQxNw==":{"date":1498521600000,"title":"Google Cloud Next 17","description":"Novetats Google Cloud Next 17","sections":["Blog","home"],"blog_tags":["cloud","kubernetes","contenidors"],"imatge":"/images/bloc/GC17.png","aliases":["/bloc/2017/06/GC17/"],"key":"JUNY2017","path":"/blog/2017/06/GoogleCloudNext17","content":"![GoogleNext17](/images/bloc/GC17.png)\r\n\r\nGoogle Cloud Next 17 és l'esdeveniment que va organitzar Google a San Francisco els dies 8, 9 i 10 de març. En aquest esdeveniment es presenten les novetats amb vocació empresarial al cloud, tant en el que respecta a lloc de treball (GSuite), com a nivell de construcció i desplegament d'aplicacions (Google Cloud Platform).\r\n\r\n![GSuite](/images/bloc/ImatgeGC17_1.png)\r\n\r\nLa solució de Google al treball col·laboratiu en cloud amb vocació empresarial és [GSuite](https://gsuite.google.es/). Les principals novetats en aquest producte van ser:\r\n\r\n## Team Drive\r\nSimilar a Google Drive però amb vocació corporativa. [Team Drive](https://www.youtube.com/watch?v=ywBuQZOHX-E) permetrà veure'l com a unitat local tot i no estar sincronitzat. La diferència principal amb Google Drive és que els documents emmagatzemats no pertanyen a una persona, sinó a la corporació.\r\n\r\n## App Maker\r\nEntorn de desenvolupament d'aplicacions JavaScript internes orientades a gestió de dades a l'abast dels usuaris funcionals. Permet utilitzar plantilles així com les APIs pròpies de Google per a dotar de funcionalitat les aplicacions de manera senzilla. [App Maker](https://www.youtube.com/watch?v=Br6aNwDXDgQ)\r\n\r\n## Jamboard\r\nPissarra que permet col·laboració en temps real a través de Hangouts.\r\n![Jamboard](/images/bloc/jamboard.jpg)\r\n\r\n![GCPlatform](/images/bloc/ImatgeGC17_3.png)\r\n\r\nPel que respecte a les plataformes cloud que ofereix Google, van presentar les següents novetats:\r\n\r\n## Plataformes d'execució\r\nDisposen de diferents opcions en que els integradors tenen més o menys graus de llibertat:\r\n\r\n- **AppEngines**. Motors d'execució gestionats per Google i utilitzats com a servei on sols es desplega els recursos de l'aplicació, sigui codi o dades.\r\n- **Contenidors**. Desplegament de contenidors a través de l'orquestrador **Kubernetes**.\r\n- **Infraestructura**. Potència a nivell de SO. Equivalent a un element IaaS, on sols es proporciona un SO.\r\n- **Cloud Functions**. Presentada en l'esdeveniment en estat beta. Serveis Serverless, sols s'executa en rebre un esdeveniment.\r\n\r\nLes principals novetats en aquesta categoria es van presentar a Kubernetes.\r\n**Kubernetes** és l'orquestrador de clústers de contenidors opensource desenvolupat per Google. Les seves principals funcionalitats inclouen:\r\n\r\n- **Portable**, entre escenaris de cloud públic, privat o híbrid\r\n- **Auto-corregit**, permet auto-ubicació, auto-restart, auto-rèplica, auto-escalat\r\n- **Balanceig integrat** permet definir regles de balanceig de càrrega entre els recursos\r\n\r\nAlgunes de les novetats presentades en la versió 1.6 de Kubernetes són:\r\n\r\n- Balanceig Multi-Clúster / multi-zona N7 amb SSL amb una única IP. Ingress és un recurs Kubernetes que permet encapsular condicions i configuració per a enrutar tràfic extern a serveis interns.\r\n- Nous paràmetres de desplegament:\r\n- Condicionar el desplegament a la tipologia de hardware sobre el que s'executa:\r\n- Desplega a la màquina més barata\r\n- Desplega a la màquina que té un mínim de prestacions a nivell de maquinari\r\n- Desplega a la màquina que té un mínim de prestacions a nivell de tipus de disc\r\n- Aprovisionament dinàmic de volums estàtics\r\n- Aplicacions amb estat\r\n- Federació de clústers ([Kubefed](https://kubernetes.io/docs/tasks/federation/set-up-cluster-federation-kubefed/)) en diverses regions (fins i tot entre on-premise i cloud)\r\n- Afinitat a pods\r\n- Afinitat a zones geogràfiques\r\n- Definició dinàmica de DNS\r\n\r\n## Emmagatzemament de dades\r\nEn aquesta categoria, la principal novetat va ser la presentació de [Spanner](https://cloud.google.com/spanner/). Una base de dades relacional com a servei, que permet l'escalat horitzontal a diferents zones de disponibilitat. En l'esdeveniment es va presentar una [demo](https://www.youtube.com/watch?v=AC9xUc4SkvU) amb les següents característiques:\r\n\r\n- BBDD desplegada en tres regions Google\r\n- 500.000 vendes transaccionals per minut\r\n- 3 Bilions de files\r\n- 80 TB BBDD\r\n- DBaaS, Completament administrada. Replicació, Failover\r\n\r\n## Data Analytics - Machine Learning\r\nÉs un dels aspectes en que Google aposta fortament. Es van presentar diverses novetats en aquest apartat:\r\n\r\n- **DLP Data Loss Prevention.** Basat en el principi de només guardar les dades que són necessàries, identifica les dades sensibles de les imatges i les oculta abans de guardar-les.\r\n- **API d'indexació d'imatges**. API que permet categoritzar una imatge en diferents eixos, contingut, detecció de cares, OCR, geogràficament, etc.\r\n- **API d'indexació de vídeos**. API que permet categoritzar un vídeo, a més a més d'identificar el seu contingut i el moment en que apareix. Molt il·lustrativa la demo feta a l'esdeveniment: [API vídeo ](https://www.youtube.com/watch?v=mDAoLO4G4CQ)\r\n\r\n## Xarxa\r\nEs van presentar les funcionalitats en la definició de la xarxa en que es va remarcar:\r\n\r\n- **La xarxa ha de ser global.** El cloud ha de ser una extensió de la xarxa local per tal de donar alta disponibilitat en diferents zones en format híbrid (part de la infraestructura en local, i part en el cloud) utilitzant l'espai d'IPs privades pròpies.\r\n- **La xarxa com a servei.** Les funcions de xarxa s'han d'oferir com a serveis distribuïts i gestionats. Dins d'aquest punt es va presentar els diferents models de XPN (Cross-Project Networking), Xarxes privades entre projectes.\r\n\r\nPodeu trobar tota l'agenda de l'esdeveniment a [Schedule](https://cloudnext.withgoogle.com/schedule) i les conferències estan disponibles a [Youtube](https://www.youtube.com/playlist?list=PLIivdWyY5sqI8RuUibiH8sMb1ExIw0lAR).\r\n","objectID":"L2Jsb2cvMjAxNy8wNi9Hb29nbGVDbG91ZE5leHQxNw=="},"L2Jsb2cvMjAxNy8wNi92ZXJzaW9uc19sdHM=":{"date":1496620800000,"title":"Utilització preferent de versions LTS de programari","description":"Les versions LTS (Long-Term Support) de programari lliure són les recomanades i a adoptar com a preferents seguint el criteri d'Arquitectura CTTI","sections":["Blog","home"],"blog_tags":["patrons","LTS","principis"],"categories":["principis"],"imatge":"/images/bloc/keep-calm-and-use-lts-versions.png","key":"JUNY2017","path":"/blog/2017/06/versions_lts","content":"### La necessitat d'un suport a llarg termini\r\n\r\nEl cicle de vida tradicional en molts projectes es desplegar noves versions sovint, o planificar els desplegaments en períodes curts i regulars. En qualsevol cas, cada nova versió inclou tant correccions funcionals com de seguretat i nous evolutius.\r\n\r\nLes grans organitzacions, i altres tipus de col·lectius amb projectes de missió crítica, necessiten les correccions a les vulnerabilitats però sovint prefereixen mantenir la mateixa base de codi per un període estès en el temps sense que hi hagi cap tipus de canvi en les funcionalitats. És habitual que canvis funcionals impliquin introducció de nous errors.\r\n\r\nEncara que es pogués assegurar al 100% que les noves versions estan lliures de defectes, per aquests tipus d'usuaris, el tractament de noves versions és sovint molt car. Actualitzar una aplicació requereix la participació de molts equips que poden fer prohibitiva la certificació contínua de noves versions.\r\n\r\nLes versions de Suport a Llarg Termini d'un programari, també conegudes com a LTS, de l'anglès \"Long Term Support\", usualment adrecen aquestes preocupacions. \r\n\r\n### Què són les versions LTS \r\n\r\nLes versions LTS són un tipus especial de versions o edicions de programari que estan designades per a ser suportades per un període més llarg que el normal. És un concepte que ha aparegut majoritàriament en programari lliure.\r\n\r\nEs tracta d'una política de gestió del cicle de vida del programari, que aplica criteris d'estabilitat de les versions en un termini més llarg de l'acostumat, alterant la freqüència de les noves versions per rebaixar el risc, la despesa i la disruptivitat que provoquen. Les versions LTS despleguen només aquelles actualitzacions que afecten a problemes de seguretat, donat que instal·lar-les aporta menys risc que no fer-ho. \r\n\r\nAl principi d'un període de suport a llarg termini, els desenvolupadors del programari imposen una congelació de les característiques: corregeixen errors i vulnerabilitats, però no introdueixen noves funcionalitats que poden causar problemes de regressió.\r\n\r\n### Nou Principi d'Arquitectura: fer servir versions LTS sempre que el programari escollit les ofereixi\r\n\r\nLes versions LTS ofereixen a la Generalitat una opció ideal per a mantenir el versionat dels components del programari al dia amb una eficiència en cost. També s'adapta millor al cicle de vida habitual de les nostres aplicacions, més llarg que en altres sectors. És per aquest motiu que s'ha decidit introduïr l'ús preferent de versions LTS dins dels [Principis d'Arquitectura](http://canigo.ctti.gencat.cat/principis/):\r\n\r\n```\r\nLes versions de les diferents peces (productes, llibreries, etc) que componen un sistema han de ser el més estable possible, d'aquí que es recomani l'ús de versions LTS (Long-Term Support) o, si de cas hi manca, GA (General Availability) o la nomenclatura que hagi donat el fabricant. Versions productives d'un sistema mai haurien d'incorporar versions no consolidades (snapshot, alpha, beta, release candidate, milestone, etc) dels components que en formen part.\r\n```\r\n\r\n### Exemples\r\n\r\nA continuació es mostra el roadmap de versions de Symfony, NodeJS o Ubuntu com a exemples:\r\n\r\n* Symfony\r\n\r\n![Symfony](/images/bloc/symfony_schedule.png)\r\n\r\n* NodeJS\r\n\r\n![NodeJS schedule](/images/bloc/nodejs_schedule.png)\r\n \r\n* Ubuntu\r\n\r\n![Ubuntu schedule](/images/bloc/ubuntu_schedule.png)\r\n","objectID":"L2Jsb2cvMjAxNy8wNi92ZXJzaW9uc19sdHM="},"L2Jsb2cvMjAxNy8wOS9Bbmd1bGFy":{"date":1504224000000,"title":"Angular: Estat actual i evolució","description":"Angular és un framework de JavaScript de codi obert, mantingut per Google, utilitzat per desenvolupar aplicacions web d'una única pàgina (SPA). Deriva d'AngularJs, un framework Javascript per a SPAs també mantingut per Google, però del que en conserva ben poques coses més enllà de la similitud del nom","sections":["Blog","home"],"blog_tags":["desenvolupament","Eines","SPA","Frameworks","Angular"],"categories":["desenvolupament","Eines","SPA","Frameworks"],"imatge":"/images/bloc/201709/logoAngularllarg.png","key":"SETEMBRE2017","path":"/blog/2017/09/Angular","content":"### Angular: Estat actual i evolució\r\n\r\nAngular és un framework de JavaScript de codi obert, mantingut per Google, utilitzat per desenvolupar aplicacions web d'una única pàgina (SPA). Deriva d'AngularJs, un framework Javascript per a SPAs també mantingut per Google, però del que en conserva ben poques coses més enllà de la similitud del nom.  \r\n\r\n![Angular Logo](/images/bloc/201709/logoAngularllarg.png)\r\n\r\nFem una mica d'història. Des que es va alliberar el codi d'AngularJs, el seu ús i recolzament per part de la comunitat software va ser molt ample. Comparativament amb altres frameworks que oferien funcionalitat similar com ara Vue, React o Ember, l'ús d'AngularJs es va imposar sobre la resta.\r\n\r\nUtilitzant Google trends podem veure la tendència i popularitat d'AngularJs sobre els seus competidors:\r\n\r\n![Tendències](/images/bloc/201709/InteresAngular.png)\r\n\r\nPer què va obtenir tanta popularitat? Hi ha varies raons:\r\n\r\n- Va sortir el primer: la versió 1.0 es va publicar el 2010\r\n- Sent mantingut per Google, generava confiança a la comunitat. Aquesta és, potser, la principal raó de la seva popularitat.\r\n- Aporta una estructura estàndard de directoris per facilitar la organització encara que es tracti d'aplicatius grans\r\n- Un dels objectius principals és la modularitat: és més senzill crear i testejar components\r\n- Corba d'aprenentatge molt plana per començar a produir\r\n\r\nAra bé, si AngularJs ha estat tan exitós i tan ben adoptat per la comunitat, calia trencar-ho tot i fer la transició d'AngularJs a Angular 2 tan traumàtica? Calia mantenir el nom si el canvi entre els dos era tan radical?\r\n\r\nCertament, hi va haver moltes coses millorables al procés, sobretot quan Google va anunciar que no hi hauria pla de migració de AngularJS 1.x a Angular 2.0. Això va acabar de dividir i radicalitzar a la comunitat i fa encara més difícil defensar l'adopció de qualsevol versió d'Angular. Què passarà quan surti una nova versió, diguem-ne Angular 4?  Serà la transició igual de dolorosa? \r\n\r\nAbans de mirar en detall com s'ha de gestionar això de cara al futur, mirem què ofereix Angular 2 respecte a AngularJS:\r\n\r\n- **Suport per plataformes mòbils:** AngularJS va ser pensat només per aplicacions responsives i de dades bidireccionals. L'arquitectura d'Angular, en canvi, està orientada a suport de plataformes mòbils des del començament. El mateix codi és generat diferent segons la plataforma final i l'experiència d'usuari és molt similar a aplicacions natives.\r\n- **Millores de rendiment:** El bootstrap, inicialització de l'aplicatiu, és fa diferent segons la plataforma reduint el temps i millorant l'experiència d'usuari.\r\n- **TypeScript** :  És un superset de JavaScript ES6 mantingut i desenvolupat per Microsoft. Afegeix tipat estàtic i objectes basats en classes. Una de les grans avantatges d'utilitzar TypeScript és el poder detectar errors abans d'executar el codi. És completament compatible amb ES6.\r\n- I molt més...: es canvia a programació basada en components, s'elimina el controvertit $scope d'AngularJS, simplificació de directives, més modular i un llarg etcètera.\r\n\r\nSi Angular és de fet un nou framework i té poc a veure amb AngularJS, és legítim qüestionar-se si val la pena fer la transició d'AngularJS a Angular o de fet triar altre framework.\r\n\r\nPrimer hem de dir que, després de la presentació d'Angular i de tota la incertesa que va generar, Google ha aprés i van reaccionar ràpid:\r\n\r\n- Van oferir un pla de migració ben documentat i fins i tot van publicar llibreries per ajudar amb la transició com ara **ng-upgrade**\r\n- Incorporen el concepte de SEMVER (semantic versioning). Això farà en el futur les actualitzacions menys traumàtiques. Totes les noves publicacions de Angular constaran de 3 números: MAJOR.MINOR.PATCH\r\n\r\n  - MAJOR: Nova funcionalitat amb canvis incompatibles a l'API.\r\n  - MINOR: Nova funcionalitat i és compatible amb versions anteriors\r\n  - PATCH: Corregeix bugs i es manté retrocompatible\r\n\r\nA més, l'equip d'Angular ha assegurat que en un futur una de les seves prioritats és facilitar al màxim la transició cap a noves versions.\r\n\r\nRecentment s'ha publicat la versió 4 d'Angular i la transició de Angular 2 a 4, en contrast a la transició d'AngularJS a Angular és força senzilla i molt ben documentada.\r\n\r\n![Tuit](/images/bloc/201709/tuit.png)\r\n\r\nCom hem mencionat, la versió actual és Angular 4, que va sortir el març de 2017. I què va passar amb la versió 3? Angular 3 mai va ser publicada.\r\n\r\nEn utilitzar el versionat semàntic es van trobar amb un problema amb la numeració de la llibreria router. Per ser coherents amb la nova adopció del SEMVER és va decidir de passar de la versió 2 a la 4 directament i així poder oferir un versionat coherent per totes les llibreries.\r\n\r\nI com queda el panorama actual? On es situa Angular respecte als seus competidors?\r\n\r\n![Tendències](/images/bloc/201709/InteresAngularvsCompetencia.png)\r\n\r\nPer ser justos, la cerca per AngularJS engloba a AngularJs i Angular. A més, altres mètriques com la quantitat d'estrelles per projecte a github o npm trends, la quantitat de vegades que es baixa una llibreria, dóna com a guanyador a React sobre Angular. Com és possible?\r\n\r\nPrimer, React té el suport d'una gran companyia com és Facebook. Aquesta llibreria s'ocupa de la part vista del patró MVC mentre que Angular és un framework i ofereix una solució completa per MVC a la part explorador així que no són totalment comparables. Una comparativa més acurada seria React + [Redux](http://redux.js.org/) contra Angular tot i que React es pot utilitzar amb altres frameworks.\r\n\r\nA més React no ha experimentat una revolució tan traumàtica com Angular i això ha permès fidelitzar més a la seva comunitat. Tot i que Google no ha sabut fer bé la transició d'AngularJs a Angular, han certament aprés de les seves errades i la projecció és clarament al alça.\r\n\r\nTant React com Angular semblen a dia d'avui les opcions més estables i recolzades per la comunitat tot i que l'esperança de vida de qualsevol tecnologia és difícil de estimar avui en dia.\r\n\r\nA CTTI observem que els projectes que ens arriben s'alineen bastant amb les tendències vistes anteriorment. \r\n\r\nEstàndards emergents com WebAssembly, que permet l'execució de codi nadiu dins de màquines virtuals al browser, o web components, que permet estendre HTML i definir components reutilitzables, arriben per segmentar, encara més, un diversificat univers frontend.\r\n\r\n![Estàndards](https://imgs.xkcd.com/comics/standards.png)\r\n\r\nFont original:  https://xkcd.com/927/\r\n\r\n### Referències:\r\n\r\nAngular is not a massive monolith – but your mom is:\r\n\r\n[https://gofore.com/angular-is-not-a-massive-monolith/](https://gofore.com/angular-is-not-a-massive-monolith/)\r\n\r\nAngular 1 to Angular 2 Upgrade Strategy:\r\n\r\n[https://docs.google.com/document/d/1xvBZoFuNq9hsgRhPPZOJC-Z48AHEbIBPlOCBTSD8m0Y/edit](https://docs.google.com/document/d/1xvBZoFuNq9hsgRhPPZOJC-Z48AHEbIBPlOCBTSD8m0Y/edit)\r\n\r\nReact vs Angular: An in-depth comparison\r\n\r\n[https://www.sitepoint.com/react-vs-angular/](https://www.sitepoint.com/react-vs-angular/)\r\n\r\nAngularJS to Angular quick reference\r\n\r\n[https://angular.io/guide/ajs-quick-reference](https://angular.io/guide/ajs-quick-reference)\r\n","objectID":"L2Jsb2cvMjAxNy8wOS9Bbmd1bGFy"},"L2Jsb2cvMjAxNy8wNC9TRE4tMjAxNzA0MDE=":{"date":1491004800000,"title":"Sobre les SDN","description":"Què és i el per què de SDN. Consideracions per dummies que trobem al respecte","sections":["Blog","home"],"blog_tags":["comunicacions","patrons de disseny","sdn"],"imatge":"/images/bloc/XarxesSDN.png","aliases":["/bloc/2017/04/XarxesSDN/"],"key":"ABRIL2017","path":"/blog/2017/04/SDN-20170401","content":"# SDN (Software Defined Network)\n\nSi busquem la definició de SDN, ens trobarem en que es tracta d'una **arquitectura emergent** que és dinàmica, rentable, adaptable i manegable, el que la fa ideal per l'ample de banda i la naturalesa dinàmica de les aplicacions.\nTot i que es tracta d’una *nova* arquitectura (separa el pla de control del pla de dades en els dispositius de xarxa), crec que la importància de la mateixa radica sobretot en el canvi de la forma de treballar permetent adaptar-nos, a nivell de xarxa, a les pròpies necessitats del mercat / aplicacions.\n\n## D'on sorgeix la necessitat\n\nLa pròpia evolució de la societat de la Informació, i en concret d'Internet, ha fet que les necessitats del mercat vagin canviant i, com a conseqüència, els negocis hagin d'evolucionar a gran velocitat. Ens trobem en una situació on conceptes com flexibilitat i rapidesa són fonamentals per evolucionar.\n\nL'evolució dels sistemes d’informació ha estat i esta sent decisiva en el desenvolupament dels negocis,  i no només pel que fa referència al hardware  (major capacitat de processament, memòria, etc) sinó també a nivell de programari, virtualització fonamentalment. \n\nAquesta evolució, juntament amb la aparició de noves tecnologies, estratègies (dockers, microserveis, etc.) ens permet poder crear aplicacions d’una forma ràpida i flexible reduint substancialment el temps emprat per  oferir el nostre producte.\n\n## Canvi en la direcció del tràfic dins dels Data Centers\n\nEns els Data Centera el sentit del tràfic, fins fa poc, era majoritàriament Nord-Sud (vertical). Aquesta tendència està canviat a gran velocitat, passant a ser Est-Oest (horitzontal).\n\nEl motiu d’aquest canvi ve determinat principalment pel canvi / evolució que es produeix en l’arquitectura de les aplicacions, passant d’arquitectures monolítiques a arquitectures distribuïdes, com per exemple els (micro)serveis.\n\n\n![Distribució SDN1](/images/bloc/ImatgeSDN1.PNG)\n\n\n## Però...   i la xarxa?\n\nTot i les evolucions / canvis descrits anteriorment, aquests no seran realment efectius sense l'evolució pertinent del medi sobre el que ha de viatjar la informació, la xarxa. \n\nL’evolució constant dels equipaments de xarxa, ens permet anar *solucionant* tant problemes de capacitat com de configuració. Valgui com a exemple la limitació en quant a les VLANS actives per switch que, a part dels possibles altres problemes que això podria suposar, provocava que el moviment de les maquines virtuals dins del Data Center depengués en molts casos de la realització de tasques prèvies per part de xarxa, amb el temps que això comporta. En l’actualitat, aquesta limitació ja ha estat superada.\n\nTot i així, un dels principals problemes amb què ens trobem és el d’aconseguir una xarxa flexible (on es puguin realitzar canvis de forma immediata),  ràpida i segura. En definitiva, **la xarxa hauria de ser  transparent**. Això permetrà que front a qualsevol canvi i/o nova necessitat ( a nivell d’aplicació / S.I.) la configuració de la part de xarxa no suposi cap “stopper” pel que fa al temps de provisionament. \n\n## Entendre SDN\n\nCom ja hem indicat anteriorment, SDN es tracta d’una arquitectura emergent que es basa principalment en la separació del pla de control del pla de dades dels dispositius de xarxa. \n\nTradicionalment, el funcionament de la xarxa, juntament amb la seva governabilitat està basada en dos conceptes bàsics, el **pla de control** (control plane) i el **pla de dades** (data plane). \n\nEl **pla de control** és l’encarregat de dur a terme totes aquelles accions necessàries per a fer possible l’enviament dels paquets / dades, com pot ser la construcció de la taula de rutes, l’establiment de polítiques de seguretat, etc. En definitiva és l’encarregat de configurar el pla de dades\n\nEl **pla de dades** en canvi, està format per totes aquelles activitats encarregades del propi enviament dels paquets, com per exemple la fragmentació i reconstrucció, replicació pel tràfic multicast, etc.\n\nAquests dos plans es troben presents en els propis dispositius de xarxa separats lògicament o, en alguns dispositius, inclús físicament.\n\n\n![Control vs Dades](/images/bloc/ImatgeSDN2.PNG)\n\nAixò comporta  que front a un canvi s’hagin de configurar  varis dispositius de forma separada, cuidant sempre de no caure en inconsistències. El resultat final és que el temps d'aprovisionament / canvi d’un servei no sol ser curt, afegint el risc que implica el fet d'haver d’anar configurant dispositiu a dispositiu.\n\n## Separació del pla de control del de dades\n\nHem d’entendre que quan parlem de separació d’aquests dos plans, no ens referim a la separació dins del propi dispositiu de xarxa (aquesta ja existeix) sinó que ens referim a l'extracció del pla de control dels dispositius de xarxa, ubicant-lo en un o varis elements externs a la mateixa., el que anomenarem a partir d’ara controlador.\n\nPer tant, el primer que ens proposa SDN, és **centralitzar el Pla de control** en un dispositiu (controlador) que serà l’encarregat de controlar a varis i/o tots els dispositius de xarxa.\n\n![Distribuït vs Centralitzat](/images/bloc/ImatgeSDN3.PNG)\n\nAquesta centralització del pla de control fa que:\n\n- Els switchos tan sols haurien de tenir el pla de dades ( realment, també tenen una mínima part de “pla de control”)\n\n- La xarxa sigui més consistent\n\n- La resposta front a canvis sigui més ràpida\n\n- La gestió de gran quantitat de dispositius sigui molt més fàcil\n\n\n## Arquitectura SDN\n\nSegons la  [Open Networking Foundation (ONF)](https://www.opennetworking.org/), organització que es dedica a accelerar la adopció de SDN y NFV, la arquitectura de SDN la podríem separar en les següents capes:\n\n- **Capa d'infraestructura**. Formada pels nodes / equipaments  de xarxa que realitzen la commutació i enrutament dels paquets.\n\n- **Capa de control**. Es tracta de la capa més important dins de la arquitectura SDN. És la capa on esta ubicada la intel·ligència de la xarxa. Es on ens trobem amb el controlador (programari ) , encarregat de controlar i configurar els nodes de la xarxa dirigint així els fluxes de tràfic, és a dir, la intel·ligència de conmutació i enrutament de les dades dels nodes de la xarxa passa a ser propietat del controlador SDN. La comunicació entre el controlador i els dispositius de la xarxa a controlar, es fa mitjançant un protocol ( per exemple openflow), que pot variar segons el fabricant de la solució. Anomenarem interface *northbound* a la comunicació/fluxe que hi ha entre la capa de control i la d'aplicació i interface *southbound* a la que hi ha entre la capa de cotnrol i la d'infraestructura.\n\n- **Capa d'aplicació**. Aquesta capa esta formada per aplicacions d’usuaris que incideixen directament en el controlador que ens permetran simplificar i automatitzar les tasques de configuració de la xarxa, aprovisionar y gestionar nous serveis, així com extreure informació de negoci, fent que  la xarxa es pugui anar adaptant automàticament a les necessitats que vagin sorgint. Aquestes aplicacions es comuniquen amb el controladors mitjançant APIs de la capa de control com REST, JSON, XML, etc. \n\n\n![Tres capes](/images/bloc/ImatgeSDN4.PNG)\n\n\n\n## On aplicar SDN\n\nTot i que a priori pot semblar que la aplicació de SDN s’hauria de fer en tots els entorns on hi hagi xarxa, cal destacar que aquesta en principi és una tecnologia / arquitectura pensada per Data Centers. Això no vol dir que en altres entorns o tipus de xarxa, com per exemple Nodes de trànsit (NUS de Comunicacions) no s’arribi a aplicar mai, però, la finalitat no es aquesta i per tant encara avui no esta pensada per poder aplicar-se a aquest tipus de xarxa, tot i que s'està treballant perquè acabi de ser una realitat.\n\nSDN ens ha d'aportat tot un seguit d'avantatges:\n\n- Gestió unificada de milers de dispositius\n\n- Escalat dinàmic, és a dir, ens ha de permetre poder créixer d’una forma transparent, sense afectar al servei\n\n- Integració de nous serveis de forma ràpida\n\n- Programable. Hem de ser capaços de programar la xarxa per a que aquesta canviï el seu comportament segons les circumstàncies que es donin\n\n- Automatització: reducció progressiva de les tasques manuals mitjançant l’automatització de les mateixes, evitant així errades operacionals\n\nUna de les principals característiques és la que fa referència a la **\"virtualització” de la xarxa**. Això permetrà, que el propi desenvolupador de la aplicació o l’encarregat dels sistemes d’informació, pugui configurar-se la xarxa de forma automàtica i transparent, és a dir, front una determinada necessitat, la gent de sistemes podrà arribar a configurar-se fins i tot la part de la xarxa, **sense haver de dependre de la intervenció per part del personal que gestiona la mateixa**.\n\nAixò no significa que hi hagi llibertat total per a fer el que vulgui en la xarxa, sempre s’hauran de establir unes normes molt bàsiques que permetran al personal que gestiona la xarxa no perdre el control de la mateixa i per tant garantir el servei. Com a exemple, els administradors de sistemes tindran assignat un pool de vlans per poder crear les xarxes que necessitin. Aquest pool serà definit pels administradors de la xarxa i de forma automàtica, aquestes VLANS s’afegiran i/o borraran dels ports de la xarxa segons necessitats dels administradors de sistemes.\n\nEn definitiva, el que tindrem és una xarxa amb una configuració base, sobre la que de forma automàtica s’aniran creant xarxes superposades (overlay network).\n\n## Maduresa\nTenint present la velocitat a la que s'està evolucionant, per a que la implementació de SDN sigui eficient s’hauria de tenir present:\n\n- Situació actual de la xarxa a transformar. Actualment, ens trobarem amb molta electrònica de xarxa que  no esta preparada i/o no compleix els requisits mínims per a ser gestionada per un controlador SDN.\n\n- Convivència entre xarxes SDN i  no SDN. El pas de les xarxes actuals a SDN no és fàcil (fer-se de cop és poc menys que una bogeria). Per fer possible aquesta evolució, cal anar molt poc a poc amb una planificació molt detallada.\n\n- Hi ha casos en els que separar el pla de control del de dades dels equipaments de xarxa no és el més adient, havent-se d’estudiar tots i cadascuna de les casuístiques  que ens apareguin.\n\nDonada la importància i l’impacte que pot suposar el fet de separar el pla de control del de dades dels dispositius, hi ha una tendència que defineix  SDN com la interacció de les aplicacions (moltes inclús a nivell de negoci) sobre la xarxa, sense la intervenció del operador de la mateixa. Tenint present aquesta definició, ens podem trobar amb:\n\n- **Switchos  que no disposen de pla de control** (tot i que sempre ha d’haver un mínim pla de control només pel fet que han de parlar amb el controlador i guardar les configuracions que aquest els hi fa arribar), el que s’anomena *Out-of-Band control Plane*. En cas de caiguda del controlador, la xarxa no podrà reaccionar front a qualsevol canvi.\n- **Switchos que sí disposen de pla de control**, *In-Band Control Plane*, però tot i així és el controlador el que configura el pla de control de tots i cadascun dels dispositius. En cas de caiguda del controlador, la xarxa podria reaccionar front a determinats canvis / incidències (caiguda d’un port, etc) i sempre, com a cas excepcional,  es podrien configurar els dispositius individualment.   \n\n\n\n### Referències:\n\n- [Open Networking](https://www.opennetworking.org)\n- [CISCO - SDN](http://www.cisco.com/c/en/us/solutions/software-defined-networking/overview.html) \n- [Microserveis](http://canigo.ctti.gencat.cat/blog/2016/08/microserveis/)\n- [SDX Central - SDN](https://www.sdxcentral.com/sdn)\n","objectID":"L2Jsb2cvMjAxNy8wNC9TRE4tMjAxNzA0MDE="},"L2Jsb2cvMjAxNy8wOS9oaWJyaWRhY2lvLW9mZmljZTM2NQ==":{"date":1505433600000,"title":"Hibridació de l'autenticació i de la gestió d'identitats amb Office365","description":"Arquitectura implementada per a assolir la hibridació de la capa de gestió d'identitats i de control d'accés amb l'Office365 de la Generalitat","sections":["Blog","home"],"blog_tags":["gestió identitats","GICAR","Office365","Microsoft","cloud"],"categories":["gestió identitats","GICAR","Office365","Microsoft","cloud"],"imatge":"/related/gicar/adfs-index.PNG","key":"SETEMBRE2017","path":"/blog/2017/09/hibridacio-office365","content":"El present document té per objectiu explicar el projecte d'hibridació de l'autenticació amb Office365 (Exchange Online, Skype Empresarial, OneDrive Empresarial, Office Online) dels usuaris de la Generalitat de Catalunya, i quina és l'arquitectura implementada per a dur a terme aquesta funcionalitat.\n\n## Antecedents\n\nLa Generalitat de Catalunya abans d'iniciar aquest projecte disposava de les següents eines per a gestionar les identitats dels seus empleats i col·laboradors:\n\n### Al CPD de la Generalitat (On premise)\n\n- El sistema corporatiu de gestió d'identitat (GICAR) amb 230.000 identitats actives\n\n- Un Exchange desplegat sobre un domini Windows per donar servei al correu corporatiu. Aquest Exchange disposava d'unes 90.000 bústies nominals + 20.000 de genèriques.\n\n- Les 90.000 bústies nominals estaven desplegades sobre identitats que venien sincronitzades des de la Gestió d'Identitats Corporativa (GICAR).\n\n### Al Núvol\n\n- Es disposava d'un tenant d'Office365, associat al domini gencat.cat, però sense cap lligam amb el Exchange i domini On Premise.\n\n- Els usuaris entraven als serveis del núvol amb un usuari i contrasenya diferent al corporatiu GICAR.\n\n- No hi havia cicle de vida dels usuaris al núvol. Quan un usuari marxava de la Generalitat no hi havia una sincronía entre la petició de baixa de GICAR i la d'aquest compte per a esborrar la identitat i la informació associada a aquella identitat a Office365.\n\n## Arquitectura\n\n### Requeriments a donar compliment\n\nS'ha proposat i desplegat la següent arquitectura, suportada per Microsoft, per a donar compliment als següents requeriments:\n\n- Mateixes credencials a la plataforma d'Exchange On Premise i als serveis del núvol.\n\n- La informació dels usuaris a la Plataforma d'Exchange On Premise ha d'estar reflectida a l'Exchange del núvol. No tota la informació sino només un subconjunt rellevant per a l'ús de les aplicacions al núvol.\n\n- Contrasenya de l'usuari nominal gestionada per GICAR, gestionable a través del Portal d'Autogestió de Contrasenyes, sotmesa a la Política de caducitat de les contrasenyes corporativa i hostatjada al CPD de la Generalitat.\n\n- Cicle de vida de les identitats nominals, tant a on Premise com al núvol, gestionat per GICAR.\n\n- Propagació de la llibreta d'adreces de l'Exchange On Premise cap als serveis d'Office365.\n\n### Descripció de les peces que componen l'arquitectura\n\nA continuació es descriuen les peces que componen aquesta arquitectura:\n\n![Integració Aplicacions GICAR](/related/gicar/adfs-hibridacio.PNG)\n\n- GICAR: plataforma de Gestió d'Identitats corporativa encarregada d'aprovisionar els usuaris i les contrasenyes d'aquests al directori actiu On Premise.\n\n- OIM (Oracle Identity Manager): component de GICAR que és l'encarregat d'efectuar aquesta sincronització.\n\n- Directori de LT1: directori actiu on Premise que conté les identitats que accedeixen tant a l'Exchange On Premise com a l'Office365.\n\n- ADFS: Servidors d'Active Directory Federation Services que s'encarreguen de validar l'autenticació de les identitats contra el Directori de LT1. Aquests servidors són accessibles només des de la xarxa de la Generalitat. Per a accedir a aquests des de fora del nus de comunicacions de la Generalitat, s'ha d'accedir a través dels servidors WAP, que fan de proxy invers, per a dotar de més seguretat als ADFS.\n\n- WAP: Web Application Proxy és un rol de servidor Windows que proporciona una funcionalitat de servidor proxy invers per a aplicacions web dins de la xarxa corporativa, per permetre que els usuaris de qualsevol dispositiu puguin accedir des de fora de la xarxa corporativa.\n\n- AD Sync: Servidor que conté el producte AADConnect que s'encarrega de sincronitzar les identitats del Directori de LT1 cap al directori d'Azure, a través del qual es pot donar accés a les aplicacions d'Office365. A través d'aquest servidor se sincronitzen les dades mínimes dels usuaris per a poder fer servir els serveis d'Office365, i no se sincronitza la contrasenya corporativa. No se sincronitzen tampoc cap al núvol els usuaris sensibles que no es veuen a la llibreta d'adreces de l'Exchange On Premise.\n\n- AD Azure: Directori de Microsoft al núvol, el qual permet gestionar l'accés pels usuaris als recursos de l'Office365.\n\n![Integració Aplicacions GICAR](/related/gicar/adfs-arquitectura.PNG)\n\n## Descripció del procés d'autenticació\n\nEl procés d'autenticació que se segueix de cara a que l'usuari pugui accedir als serveis de l'Office365 està basat en el protocol WS-FED, variant del protocol SAML.\n\nQuan un usuari intenta accedir a un dels serveis de l'Office365 es produeixen les següents accions:\n\n1.- Intent d’accés al recurs d’Office365 i introducció de nom d’usuari @gencat.cat.\n\n![Integració Aplicacions GICAR](/related/gicar/adfs-pas1.PNG)\n\n2.- Redirecció de l’usuari al ADFS de Gencat per a fer login\n![Integració Aplicacions GICAR](/related/gicar/adfs-pas2.PNG)\n\nLa redirecció es fa amb els paràmetres que necessita el ADFS per identificar l'aplicació origen d'on ve la petició. Quan l'accés a aquest ADFS es fa des d'internet, les peticions es fan a través d'un servidor WAP.\n\n3.- L’ADFS de GENCAT valida credencials contra el directori de LT1. **Procés efectuat a On Premise**\n\n4.- El directori de LT1 retorna OK/KO de les credencials. **Procés efectuat a On Premise**\n\n5.- ADFS de GENCAT retorna token amb la sessió de l’usuari. **Procés efectuat a On Premise**\n\nPer a fer això l'ADFS efectua un POST a **https://login.microsoftonline.com/login.srf** amb el paràmetre **wresult** que conté el XML de tornada cap a Office365 signat per l'ADFS.\n\nAl estar aquest token signat per l'ADFS, no és possible generar aquesta resposta per un tercer si no disposa del certificat de signatura dels tokens que només té el ADFS.\n\n6.- Amb aquest token es concedeix l’accés a Office365:\n![Integració Aplicacions GICAR](/related/gicar/adfs-pas3.PNG)\n\n## Descripció del procés de sincronització d'usuaris\n\nEl procés de sincronització d'usuaris permet que l'Office365 pugui trobar els usuaris al AD Azure i per tant, se li puguin assignar grups i autoritzacions a l'Office365.\n\nAquest procés es dispara cada tres hores a la màquina del AADConnect, i el que fa és sincronitzar els canvis que hi ha hagut al directori de LT1 cap l'AD Azure.\n\nAquest procés sincronitza només cap a l'AD Azure els atributs d'usuari que es poden veure a través de la llibreta d'adreces corporativa.\n\nEl procés de rèplica d'aquesta informació cap al núvol es fa de manera segura mitjançant protocol TLS per assegurar la confidencialitat de les dades que es repliquen.\n\nQuan Recursos Humans dels Departaments de la Generalitat fan una baixa a GICAR, a través d'aquest procés de sincronització d'usuaris, aquesta també es replica al AD Azure, impedint a l'usuari poder accedir al seu compte un cop ja no està en l'organització.\n\n\n## Altres funcionalitats que ens permetrà aquesta arquitectura en el futur\n\n- A banda de la federació del servei d'Office365 anteriorment descrita, aquesta solució de federació permet també la integració de portals web On Premise amb aquest flux d'autenticació. L'ADFS permet doncs la validació/generació de tokens cap a aplicacions On Premise (en el nostre cas s'ha fet ja amb aplicacions corporatives de col·laboració) o núvol (en el nostre cas Office365). En un futur poden ser més les aplicacions que s'integrin amb aquesta arquitectura, no necessàriament lligades a tecnologies Microsoft.\n\n- El fet de tenir els usuaris corporatius de la Generalitat aprovisionats a AD Azure també obre la porta a poder fer ús d'aquests usuaris en futures aplicacions de la Generalitat que puguin ser desplegades al CPD d'Azure.\n\n## Conclusions\n\n- Amb aquest tipus d'arquitectura es permet fer l'autenticació a l'Office365 sense haver de passar credencials d'usuari al núvol. Tot el procés d'autenticació es fa a On Premise, i només es passa cap al núvol un token signat amb l'identificador de l'usuari que s'ha autenticat.\n\n- Amb aquest model d'arquitectura les dades dels usuaris a l'Office365 són consistents amb les dades dels usuaris a GICAR. Les dades que l'usuari tingui als serveis al núvol seran fidedignes amb les que hi ha a GICAR.\n\n- Amb aquest model d'arquitectura el cicle de vida de l'usuari queda cobert, i una baixa d'un usuari a GICAR queda reflectida a l'Office365 evitant així la proliferació de comptes orfes d'usuaris que ja no estan a l'organització, i conseqüentment el cost en llicències innecessari que això podria implicar.\n\n- Aquesta arquitectura podria ser utilitzada per altres aplicacions on Premise que puguin requerir d'ADFS com a mecanisme d'autenticació.\n","objectID":"L2Jsb2cvMjAxNy8wOS9oaWJyaWRhY2lvLW9mZmljZTM2NQ=="},"L2Jsb2cvMjAxNy8xMi9wcmluY2lwaXNtaWNyb3NlcnZlaXM=":{"date":1513382400000,"title":"Principis de Microserveis","description":"Un cop acabada la transformació del maquinari i dels programaris que suporten les aplicacions, comencem a observar una certa tracció en les necessitats de posar al dia també les aplicacions. En la majoria de casos són plantejables la conversió de monòlits en aplicacions basades en microserveis. En aquest post, continuem la sèrie d'articles sobre els microserveis i presentem els principis que han de governar el disseny i la implementació de les aplicacions basades en microserveis.","sections":["Blog","home"],"blog_tags":["patrons de disseny","microserveis","automatitzacio"],"categories":["microserveis"],"imatge":"/images/bloc/Services4.png","key":"DESEMBRE2017","path":"/blog/2017/12/principismicroserveis","content":"## Principis de Microserveis\r\n\r\nUn cop acabada la fase de transformació i posada al dia del maquinari i dels programaris base que suporten les aplicacions de la Generalitat, a Arquitectura CTTI comencem a observar interès en posar al dia també les aplicacions. En la majoria de casos es posa damunt de la taula la conversió d'aplicacions monòlits cap a aplicacions basades en microserveis. D'aquesta manera es pretén dotar de lleugeresa i adaptabilitat als canvis a les aplicacions. Aquestes acostumen a durar molts més anys que les infraestructures i programaris que les sustenten. Per tant, gaudir d'aplicacions basades en arquitectures flexibles i que facilitin els canvis esdevé un factor d'èxit decisiu. \r\n\r\nEn aquest post, continuem la sèrie d'articles sobre els [microserveis](http://canigo.ctti.gencat.cat/blog/2016/08/microserveis/) i presentem els principis que han de governar el disseny i la implementació de les aplicacions basades en microserveis. En properes entrades continuarem aprofundint en les arquitectures de microserveis i iniciarem una nova sèrie sobre la Refactorització d'aplicacions.\r\n\r\n*Aquest post està basat en una sèrie de ponències i material videogràfic creat per [Sam Newman](http://samnewman.io/)*\r\n\r\n![Microservices logo](/images/bloc/Services4.png)\r\n\r\n### Què són els microserveis?\r\n\r\nEls microserveis són serveis petits i autònoms que treballen plegats. Cadascun d'aquests serveis té una funció determinada, i la fa bé. Una aplicació està composada per uns quants d'aquests serveis, que poden ser propis o creats per altres equips de dins o de fora de l'organització. En ser molts i petits, l'arquitectura, el disseny, el desenvolupament i les operacions dels microserveis són substancialment diferents dels sistemes monolítics. En aquests principis es mostren directrius per a crear una bona arquitectura de microserveis:\r\n\r\n### 1. Han de ser modelats sobre el domini de negoci que volem cobrir.\r\n\r\nSembla un principi trivial i simple, però trenca d'arrel el model que s'ha anat seguint els darrers anys: els serveis es creaven per capes tecnològiques; presentació, dades, totes les funcionalitats agrupades en una única capa de negoci, interoperabilitat, etc. En canvi, els microserveis es dissenyen per a cobrir funcionalitats senceres, de dalt a baix. Les capes tecnològiques s'utilitzen només dins del propi àmbit funcional del microservei. El **disseny basat en el domini de negoci** ajuda a trobar **límits estables** (un pagament de nòmines sempre serà això mentre hi hagi treballadors a qui pagar una nòmina!), i preparats per a ser **reutilitzables**  en l'aplicació que l'ha creat, o en altres (es poden pagar n varietats de nòmines, independentment dels tipus de contracte que estigui vigent segons la llei).\r\n\r\n### 2. Es basen en l'automatització.\r\n\r\nAquest és un principi crucial. Quan hi ha més parts a controlar, l'automatització és clau per a poder construir i desplegar l'aplicació. Les dependències, que són difícils de gestionar en qualsevol producte de programari, esdevenen un maldecap encara major si no **s'automatitzen els canals de construcció i desplegament** dels microserveis. Deixar clar per escrit (en un script o fitxer de configuració) quines són les dependències i com s'han d'executar la construcció i el desplegament dels microserveis és la clau per a no fracassar. L'**aprovisionament de plataformes per codi**, assegura que els microserveis es comporten sempre de la mateixa manera, doncs els entorns d'execució són exactament iguals a com s'han definit cada cop. D'aquesta manera s'evita que cada entorn es comporti de manera diferent perquè s'ha creat manualment. L'**automatització de les proves** assegura que els resultats són coherents de versió en versió, detectant fàcilment si les funcionalitats no es cobreixen en qüestió de minuts.\r\n\r\nSi no es té prou clar aquest principi, millor no posar-s'hi.\r\n\r\n### 3. Ocultar els detalls de la implementació.\r\n\r\nUn dels errors que sovint cometen els sistemes distribuïts és el d'acoblar excessivament els seus serveis entre ells. Dissenyar i crear **contextos limitats**, amb abast determinat i sense interseccions amb altres serveis. Com està fet el servei per dins, no ha d'afectar a com els seus clients el consumeixen. De la mateixa manera, com més clients de diferents tecnologies pugui tenir un servei, més èxit tindrà i més podrà evolucionar. Per tant cal **evitar a tota costa**: \r\n\r\n* **accessos directes a la base de dades** del nostre servei, \r\n\r\n* fer servir **protocols propietaris** a una tecnologia concreta (RMI només funciona amb java), o\r\n\r\n* utilitzar la distribució de **clients o agents** com a mitjà de connexió als nostres serveis. En aquest cas la distribució de clients i el seu manteniment és un maldecap addicional. \r\n\r\n**Com més universals siguin els protocols i la forma de cridar als nostres serveis, millor**. **REST** és potser el paradigma d'aquest principi.\r\n\r\n### 4. Descentralitzar-ho tot.\r\n\r\nCom ja s'hi introduïa en la definició, els microserveis han de ser **autosuficients** en recursos i en decissions de disseny. Cada equip que crea microserveis ha d'actuar com un **operador autònom** en les decisions que afecten a la funcionalitat que pretenen cobrir. Una dependència d'altres elements, com una capa única de presentació, una base de dades centralitzada, o un bus de serveis, trenquen aquest principi de disseny. El microservei necessitaria doncs d'altres equips i recursos i en dependria de llurs decisions i de la seva disponibilitat. \r\n\r\nEn el cas de processos de llarga durada que requereixen la participació de varis microserveis, considerar tècniques com l'**orquestració** o la **coreografia** de serveis, implementades com un agregat de microserveis.\r\n\r\n### 5. Desplegar-los independentment.\r\n\r\nÉs la característica més important que necessiten els microserveis. **Cada servei ha de desplegar-se en un sistema operatiu** per a poder gaudir d'independència d'altres components; la utilització de contenidors permet crear màquines mínimes per a un sol servei, sense haver de pagar els peatges de la sobrecapacitat dels servidors físics o dels recursos dedicats pels hipervisors en el cas de la virtualització. \r\n\r\nEls serveis han de poder variar sense afectar als seus consumidors. Per això és convenient establir **contractes dirigits pels consumidors**. En aquests, els consumidors estableixen les seves expectatives de funcionament en base a uns tests que faciliten als propietaris del microservei. Si la nova versió del servei falla en executar aquests tests, aquesta no pot pujar a producció doncs faria fallar l'execució a aquest consumidor. \r\n\r\nEls serveis s'han de poder versionar independentment de les necessitats i els calendaris dels consumidors. Mitjançant la **Coexistència de versions** els serveis poden anar publicant noves versions sense afectar als consumidors de versions antigues. Aquesta pràctica ha de tenir un compromís per anar eliminant versions obsoletes, sinó, el manteniment dels serveis requeriria de múltiples branques actives. Aquesta és una pràctica altament desaconsellada per la complexitat que afegeix al desenvolupament en cas d'haver d'aplicar correccions a vàries versions vives. \r\n\r\nUna altra tècnica que es pot utilitzar és la de **punts finals múltiples** en què el servei desplega noves APIs en ports o camins diferents de l'aplicació, deixant el codi antic donant servei a les APIs originals. Aquest és un mètode útil en la majoria de casos, especialment quan no es pot controlar el calendari de canvis dels consumidors, com en el cas d'APIs públiques. \r\n\r\n### 6. Donar preferència als consumidors dels serveis.\r\n\r\nDissenyar serveis perquè siguin usats posa als consumidors d'aquests en primera línia de les preocupacions dels desenvolupadors. **Conèixer els teus consumidors** i que aquests et coneguin és primordial perquè els serveis facin bé la feina per la que han estat creats. Els **contractes creats pels consumidors** són una bona eina per a conèixer les expectatives dels consumidors respecte als serveis que es publiquen. Uns **estàndards d'ús clars** i que s'entenguin ajuden a que els consumidors entenguin la seva funció sense dubtes. Per això resulten útils eines com els **documentadors d'APIs**, els **programaris de descoberta de serveis** o els **registres llegibles per humans**.\r\n\r\n### 7. Aïllar les caigudes.\r\n\r\nEn una arquitectura basada en microserveis, el fet que un microservei falli no ha de comportar que tot el sistema caigui. L'arquitectura ha de dissenyar-se tenint en compte aquesta eventualitat, i que l'error d'un servei no bloquegi l'execució d'altres serveis en la mesura del possible. Hi ha tres tècniques que poden ajudar a mantenir viva l'aplicació malgrat que un o varis serveis caiguin:\r\n\r\n* **Timeouts**. Posant timeouts adequats a la durada esperada de l'execució d'una crida a un servei pot donar més temps a resoldre el problema i fer el sistema més resilient. Un microservei que ha de tenir un temps de resposta sub-segon, no cal que tingui un timeout de 10 minuts.\r\n\r\n* **Mampares**. En un ús semblant a les mampares dels vaixells, separar els fils d'execució en pools de connexions dedicats en exclusiva a serveis diferents. Per tant si un servei cau no afecta a altres serveis que estan funcionant.\r\n\r\n* **Tallacircuits**. Com els que tenim a les entrades de les cases per evitar mals majors amb l'electricitat, els tallacircuits en microserveis donen una resposta alternativa als consumidors quan el servei no pot funcionar de la manera que s'espera.\r\n\r\n### 8. Altament observables.\r\n\r\nEn sistemes tradicionals, la **monitorització estàndard** basada en logs, temps de resposta i codis d'error a més a més del seguiment de les variables de CPU, espai en disc, memòria i I/O poden ser suficients. Però en el cas dels microserveis, amb múltiples parts mòbils i donant aquesta informació, pot ser inviable fer un seguiment a la manera clàssica. L'automatització i l'**agregació de logs i d'estadístiques** són claus per a donar una visió holística del sistema. \r\n\r\nEls microserveis poden fallar malgrat que estiguin aixecats i reportant bon funcionament de forma individual. La **monitorització de corrent** captura disfuncions de l'orquestració dels microserveis provocades per la xarxa o per altres sistemes de suport a l'execució. La **monitorització semàntica**, en què s'executa un circuit funcional complet, com \"Crear un Expedient\", és útil per avaluar les funcionalitats més crítiques d'un sistema. Cal notar que aquestes transaccions són falses i que no han d'introduir soroll al sistema. La introducció de rastres o **IDs de correlació** pot donar idea de per on ha anat passant l'execució d'una funcionalitat. Aquesta tècnica és especialment útil en sistemes dirigits per esdeveniments. És una eina molt potent a l'hora de realitzar investigacions d'informàtica forense. Finalment, la creació de **panells** on es mostri tota la informació en temps real del comportament del sistema i dels microserveis que el composen ajuden a la comprensió i al seguiment del seu funcionament.\r\n\r\n\r\n## Referències:\r\n\r\nSam Newman: \"Principles of Microservices\"\r\n[http://samnewman.io/talks/principles-of-microservices/](http://samnewman.io/talks/principles-of-microservices/)\r\n\r\nSam Newman: \"The Principles of Microservices. Embrace Autonomy to Optimize Performance\" [http://shop.oreilly.com/product/0636920043935.do#](http://shop.oreilly.com/product/0636920043935.do#)\r\n\r\nSam Newman: \"Building Microservices\"\r\n[http://shop.oreilly.com/product/0636920033158.do?cmp=af-code-books-video-product_cj_0636920033158_7739078](http://shop.oreilly.com/product/0636920033158.do?cmp=af-code-books-video-product_cj_0636920033158_7739078)\r\n","objectID":"L2Jsb2cvMjAxNy8xMi9wcmluY2lwaXNtaWNyb3NlcnZlaXM="},"L2Jsb2cvMjAxOC8wNy9EZXZPcHM=":{"date":1532304000000,"title":"DevOps","description":"DevOps és un moviment que aplica pràctiques reconegudes i exitoses de la industria als sistemes d'informació.  Arquitectura CTTI està introduint pràctiques bàsiques de DevOps, com són els desplegaments automàtics i l’aprovisionament d’infraestructures mitjançant codi.","sections":["Blog","home"],"blog_tags":["Desenvolupament","Operacions","DevOps"],"categories":["Desenvolupament","Operacions","DevOps"],"imatge":"/images/bloc/201710/devopsprocess.png","key":"AGOST2018","path":"/blog/2018/07/DevOps","content":"## Introducció\n\nEls sistemes de informació han de ser fiables i estar disponibles perquè les organitzacions en puguin dependre amb confiança. De fet, avui en dia gairebé tota iniciativa de qualsevol negoci depèn de la tecnologia en major o menor grau. Una aplicació creada per suportar un cas d’ús determinat no aporta valor si el departament de tecnologies de la informació no és capaç d’oferir una operació normal i mantenir les disrupcions a la mínima expressió. En aquest sentit, Arquitectura CTTI està introduint pràctiques bàsiques de DevOps, com són els desplegaments automàtics i l’aprovisionament d’infraestructures mitjançant codi. Ara és el moment de mirar més enllà i plantejar una estratègia de DevOps que permeti desplegar aquesta capacitat a tota la Generalitat. \n\n\n## Origen i Motivació\n\nEl terme “DevOps” va ser creat per Patrick Debois i Andrew Shafer el 2008, i va començar a ser d’ús comú el 2009 amb la ponència de John Allspaw i Paul Hammond “10+ Deploy Per Day: Dev and Ops Cooperation at Flickr” a la O’Reilly Velocity Conference.\n\nL’impacte que van produir Allspaw i Hammond va ser considerable. Presentaven una cosa mai vista abans com que Desenvolupament i Operacions col·laboraven per aconseguir fer més de 10 desplegaments al dia al portal Flickr. \n\nL’escenari que tenien era l’habitual en moltes organitzacions que es basen en les tecnologies d’informació. Desenvolupament rep l’encàrrec de materialitzar una idea de negoci en una aplicació que pugui ser consumida amb fluïdesa pels usuaris. Operacions és el responsable de mantenir les aplicacions en marxa. Per la divisió de responsabilitats i coneixements entre els dos departaments, la comunicació és difícil, normalment basada en correus electrònics, tiquets i escalats. Per tirar endavant els projectes i que acabin en dates, s’hi aboquen desenvolupadors i múltiples capes de gestors que fan servir gran part del temps i pressupost en desenvolupar les funcionalitats. Els departaments de Qualitat i d’Operacions reben una part insuficient d’aquest temps, sense tenir marge a fer proves ni rebre convenientment l’aplicació a Operacions. Per la raó que ningú es vol fer responsable d’un retard a la data, tant QA com Operacions rebaixen la dedicació possible i s’assumeix un deute tècnic, que s’intentarà eixugar un cop l’aplicació ja estigui en producció.\n\nEn aquest escenari, els resultats sovint no són satisfactoris. Normalment el producte és inestable i amb mancances d’usabilitat. A partir d’aquí és Operacions qui fa mans i mànigues per mantenir l’aplicació amunt, aplicant la força bruta, posant més servidors dels que estaven previstos en les estimacions, i havent de fer reinicis sovint, per culpa d’un codi que no ha passat un mínim control de qualitat ni és operat adequadament per manca d’instruccions fiables.\n\n\nEl deute tècnic no és un concepte eteri ni difícil d’observar. Es tota aquella feina no planificada que s’està obligat a fer degut a un mal desenvolupament i un desplegament inadequat. Malgrat aplicar rigor, disciplina, eficiències i processos, la feina no planificada passa per davant dels altres tipus de feina; projectes de negoci, projectes d’operacions i canvis planificats.\n\nLa feina no planificada distorsiona qualsevol planificació ordenada de la feina d’Operacions i de Desenvolupament. Crema als equips, impedeix que l’organització avanci i mina la confiança del Negoci sobre les àrees TIC.\nLa feina no planificada resulta molt cara, doncs es realitza a canvi de feina planificada. Sense un control efectiu, el deute tècnic que comporta aquest fenomen provocarà que l’únic treball que es faci sigui la feina no planificada.\nAllspaw i Hammond van demostrar que aquesta espiral es podia trencar i obtenir resultats inimaginables abans, mitjançant la col·laboració i la confiança entre els equips de Devs i Ops.\n\n\n## Les Tres Vies de DevOps\n\nDins del moviment DevOps es coneixen les Tres Vies com un recull de principis, patrons, valors i filosofies que guien els processos i pràctiques de DevOps. Les Tres Vies van ser introduïdes per Gene Kim, Kevin Behr i George Spafford al seu llibre \"The Phoenix Project, A Novel About IT, DevOps, and Helping Your Business Win\", i ràpidament es van constituir en un recull fonamental per a qualsevol organització que es plantegi abordar un projecte d'implantació de DevOps.  \n\n\n## La Primera Via\n\n![La Primera Via](/images/bloc/201710/Dev-to-Ops-1-way-narrow.png)\n\nLa Primera Via es concentra en crear un **flux de treball ràpid per passar de desenvolupament (commit) a \"corrent en producció satisfactòriament\"**. Aquest temps és el que hi ha entre la idea de negoci i tenir-la disponible per al seu consum. Necessita d'un coneixement profund del sistema de negoci i del sistema d'informació que el suporta.\n\nEs basa en els següents principis fonamentals:\n\n1. Automatitzar els processos de construcció, integració i desplegament, via SIC\n\n1. Eliminar totes les tasques manuals en els desplegaments, excepte les proves exploratòries d'usuari.\n\n1. Crear pipelines de desplegament que s'adaptin als requeriments del negoci i a l'estructura interna de l'aplicació.\n\n1. Tractar la infraestructura com a codi, aconseguint un aprovisionament automàtic d'infraestructures, via els serveis de contenidors a cloud públic i privat: contenidors, balancejadors i dns.\n\n1. Tenir tot sota control de versions: codi, infraestructura, fitxers de configuració, scripts de desplegament i jocs de proves automàtiques.\n\n1. Reduir els temps de cicle per a que el volum i temps de resolució d'incidències es redueixin al mínim possible.\n\n1. Per fer sostenible el servei, potenciar l'autoservei de repositoris, usuaris, i pipelines. Aquest últim via plantilles o via un llenguatge específic de domini que pugui incorporar pipelines creades en entorns de desenvolupament.\n\n1. Disposar d'una gestió visual de les tasques. Recopilar tota la feina pendent, penjar-la en un taulell comú, prioritzar les tasques i abordar-les d'una en una. \n\n1. Limitar el nombre de tasques en vol, per evitar la multitasca.\n\nLa gestió visual de les tasques amb una eina com podria Kanban fa que les tasques es facin més ràpidament perquè:\n\n1.\tEs més fàcil prioritzar perquè totes les tasques estan inventariades i són visibles per tothom.\n1.\tReduint les tasques en vol per recurs disminueix dràsticament els canvis de context i les interrupcions, el que accelera el seu acompliment.\n\n\n\n## La Segona Via\n\n![La Segona Via](/images/bloc/201710/Dev-to-Ops-2-way.png)\n\nLa Segona Via tracta de tenir un flux constant de **feedback ràpid** sobre el funcionament de l’aplicació. Llavors es poden resoldre problemes de qualitat ja en el moment de pujar una nova versió i així estalviar retreball en moments més avançats del projecte. Es busca que el sistema reporti errors el més aviat possible perquè la seva resolució sigui també molt més ràpida i menys costosa. El feedback ha d’arribar no només a Desenvolupament, sinó també a la definició de les aplicacions-productes, al disseny d’aquestes i a la seva arquitectura.\n\nPer això s’incorporen al flux de desplegament tota una sèrie de proves automàtiques i validacions de qualitat i seguretat. Quan alguna d’aquestes validacions falla, el flux s’atura i cal corregir els errors i tornar a iniciar el flux de desplegament. També s’afegeixen al codi font mecanismes de telemetria i avaluació contínua del rendiment, per poder assegurar en tot moment que l’aplicació està funcionant com s’ha dissenyat i com esperen els seus promotors i usuaris.\n\nQuan l’aplicació s’està executant és important que se’n realitzin mesures. Les mesures poden generar-se de dues maneres:\n\n1. agregant informació de logs que proporcionen les màquines i components.\n1. afegint informació de telemetria a les aplicacions, per a donar indicacions del rendiment i volum de les peticions que gestionen.\n\nLes mesures no només serveixen per a prendre accions reactives, sinó que s'ha d'establir un procés d'anàlisi preventiu del rendiment i així poder-lo resoldre abans que es converteixi en un foc que cal apagar fora d'horari laboral. Un exemple de CTTI és el seguiment del nombre de receptes electròniques que es realitzen: una desviació en la gràfica normal indica que alguna cosa està passant. Una correlació efectiva de diferents indicadors pot ajudar a prevenir problemes que s'esdevindran amb greus conseqüències.\n\n\n## La Tercera Via\n\n![La Tercera Via](/images/bloc/201710/Dev-to-Ops-3-way.png)\n\nLa Tercera Via consisteix a crear una **cultura de col·laboració** que fomenti dues coses: \n\n1. l'experimentació contínua, que requereix assumir riscos i aprendre dels èxits i dels fracassos, i \n1. entendre que la repetició i la pràctica són prerequisits per al mestratge.\n\nL'experimentació i l'assumpció de riscos permeten millorar contínuament el sistema de treball, que sovint exigeix fer coses de manera molt diferent de com s'ha fet durant dècades. I si les coses van mal dades, la constant repetició i pràctica diària és el que permet assolir les habilitats i hàbits que permeten tornar a la zona de confort i reactivar les operacions normals, en un temps cada cop menor.\n\nLes pràctiques necessàries en aquesta via, inclouen:\n\n- la creació d'una cultura d'innovació i presa de riscos (a diferència de la por a prendre decisions),\n\n- d'alta confiança (a diferència de la de baixa confiança, basada en comandament i control), \n\n- assignant un percentatge del temps de cicle de Desenvolupament i Operacions cap a la millora dels requisits no funcionals i la reducció de deute tècnic,\n\n- i un reforç constant en que es fomentin i celebrin les millores aconseguides.\n\n\n## Valor de Negoci obtingut adoptant pràctiques DevOps\n\nSi s'observen els resultats obtinguts per empreses que han adoptat pràctiques DevOps, destaquen els següents efectes:\n\n- Els desplegaments de noves versions de codi són més freqüents\n\n- El temps de lliurament de codi és més ràpid\n\n- El percentatge de canvis amb èxit és superior\n\n- El temps mig de recuperació d'un sistema és menor\n\nEn comptes de parlar de setmanes o mesos per disposar d'un desplegament, es passa a parlar d'hores o minuts. Els desplegaments que acaben amb èxit són la norma i en cas que vagin malament, la resolució de la incidència és molt més ràpida. En comptes de parlar de desplegaments en cap de setmana amb tall de servei, es gaudeix de desplegaments sense tall en horari laboral. Aquesta és la potència observada a moltes organitzacions que ja tenen experiència en aquesta disciplina. Despleguen noves funcionalitats més ràpidament i obtenint ratis molt alts de fiabilitat, estabilitat i seguretat.\n\n\n## Referències:\n\nJohn Allspaw i Paul Hammond \"10+ Deploys Per Day: Dev and Ops Cooperation at Flickr\":\n[https://www.youtube.com/watch?v=LdOe18KhtT4](https://www.youtube.com/watch?v=LdOe18KhtT4)\n\nGene Kim, Kevin Behr i George Spafford \"The Phoenix Project: A Novel About IT, DevOps, and Helping Your Business Win\":\n[https://www.amazon.es/Phoenix-Project-DevOps-Helping-Business/dp/0988262509](https://www.amazon.es/Phoenix-Project-DevOps-Helping-Business/dp/0988262509)\n\nGene Kim, John Willis, Patrick Debois i Jez Humble: \"The DevOPS Handbook: How to Create World-Class Agility, Reliability, and Security in Technology Organizations\":\n[https://www.amazon.es/DevOPS-Handbook-World-Class-Reliability-Organizations/dp/1942788002](https://www.amazon.es/DevOPS-Handbook-World-Class-Reliability-Organizations/dp/1942788002)\n\nJez Humble, David Farley: \"Continuous Delivery: Reliable Software Releases through Build, Test, and Deployment Automation (Addison Wesley Signature Series)\":\n[https://www.amazon.es/dp/0321601912](https://www.amazon.es/dp/0321601912)\n\nNicole Forsgren, Jez Humble, Gene Kim, Alanna Brown, Nigel Kersten: \"2017 State of DevOps Report\":\n[https://puppet.com/resources/whitepaper/state-of-devops-report](https://puppet.com/resources/whitepaper/state-of-devops-report)\n","objectID":"L2Jsb2cvMjAxOC8wNy9EZXZPcHM="},"L2Jsb2cvMjAxOC8wOS9TZXJ2ZXJsZXNzX2NvbXB1dGluZ19GYWFT":{"date":1538006400000,"title":"Serverless Computing o FaaS","description":"Com a evolució dels serveis oferts al nuvol, apareix un nou concepte anomenat FaaS (Function as a service) o Serverless Computing (Informàtica sense Servidor) que proporciona una plataforma que permet als clients desenvolupar, executar i gestionar les funcionalitats de l'aplicació sense la complexitat de construir i mantenir la infraestructura associada al desenvolupament i llançament d'una aplicació.","sections":["Blog","home"],"blog_tags":["cloud","nuvol","FaaS","Serverless"],"categories":["Cloud Services"],"imatge":"/images/bloc/201809/FaaS.png","key":"OCTUBRE2018","path":"/blog/2018/09/Serverless_computing_FaaS","content":"## Introducció\n\nServerless computing, també conegut com a Function as a service (FaaS), és una categoria de serveis de cloudcomputing que proporciona una plataforma que permet als clients desenvolupar, executar i gestionar les funcionalitats de l&#39;aplicació sense la complexitat de construir i mantenir la infraestructura associada al desenvolupament i llançament d&#39;una aplicació.\n\n![FaaS logo](/images/bloc/201809/FaaS.png)\n\n## Origen i Motivació\n\nDes de fa anys s&#39;està incorporant als desenvolupaments l&#39;arquitectura de microserveis, una forma d&#39;arquitectura SOA (ServiceOrientedArquitecture). Les aplicacions basades en microserveis divideixen la funcionalitat en serveis especialitzats, molt desacoblats i que comuniquen entre ells i col·laboren a través d&#39;API&#39;s.\nLa contrapartida dels microserveis és l&#39;augment en les tasques de gestió i manteniment d&#39;infraestructura, el que comporta que només sigui recomanable per aplicacions molt grans a empreses grans.\nPer cobrir aquest inconvenient en els microserveis apareix el ServerlessComputing, que permet als equips de desenvolupament centrar-se a definir cada funcionalitat i cada lògica de negoci, deixant a banda tots els aspectes relacionats amb la infraestructura com són:\n\n- Aprovisionament de servidors\n- Manteniment i gestió de servidors\n- Escalabilitat de l&#39;aplicació\n- Disponibilitat i tolerància a errors\n\n## Casos d&#39;ús\n\nEl Serverless computing encaixa molt bé per càrregues de treball que responen a peticions entrants, els events inclouen:\n\n- Temporitzadors / tasques programades\n- Crides HTTP per escenaris API i WebHook\n- Cues\n\nTambé es pot fer ús d&#39;aquesta tecnologia per altres tipus d&#39;aplicacions com són:\n\n- Processament de dades\n  - Processament d&#39;arxius en temps real\n  - Processament de transmissions en temps real\n  - Extracció, transformació i carrega\n- Back-ends\n  - Back-end per a IOT: Per administrar sol·licituds web, mòbils, Internet de les coses i API de tercers\n  - Aplicacions Web\n\n## Quins són els avantatges i inconvenients?\n\n**Respecte als avantatges podem destacar:**\n\n**Cost**\n\nAmb l&#39;arquitectura FaaS pagues només quan s&#39;està executant el teu codi, si no hi ha funcions actives no hi ha cost. Per exemple, si el teu codi només s&#39;executa un cop al dia amb una durada de 15 minuts, es factura 1 unitat d&#39;execució i 15 minuts de còmput.\n\n**Operacions**\n\nUna arquitectura sense servidor significa que els desenvolupadors i els operadors no necessiten dedicar temps a configurar i ajustar polítiques, el proveïdor del núvol s&#39;encarrega de garantir que la capacitat sempre satisfà la demanda.\n\n**Productivitat**\n\nEn la informàtica sense servidor, les unitats de codi exposades al món exterior són funcions simples. Això vol dir que, normalment, el programador no ha de preocupar-se per la transmissió multidireccional o per gestionar directament les sol·licituds HTTP al seu codi, simplificant la tasca del desenvolupament de programari de fons.\n\n**Independència amb el Proveïdor**\n\nExisteixen biblioteques intermèdies que s&#39;encarreguen d&#39;unificar els diferents models dels principals proveïdors de forma que les funcions que es creïn puguin executar-se en els núvols més populars. La més coneguda d&#39;aquestes biblioteques és Serverless (https://serverless.com/), que a més es Open Source.\n\n**Alguns dels inconvenients de FaaS inclouen:**\n\n**Rendiment**\n\nEl codi sense servidor utilitzat amb poca freqüència pot patir una major latència de resposta que el codi que s&#39;executa contínuament en un servidor dedicat, màquina virtual o contenidor. Això és degut al fet que, a diferència de l&#39;autocompressió, el proveïdor del núvol normalment &quot;atura o li treu prioritat&quot; al codi sense servidor quan no està en ús. Això vol dir que si el temps d&#39;execució (per exemple, el temps d&#39;execució de Java) requereix una quantitat considerable de temps per arrencar, crearà una latència addicional.\n\n**Límits de recursos**\n\nEl programari sense servidor no és adequat per a algunes càrregues de treball computacionals, com ara l&#39;alt rendiment, a causa dels límits de recursos que imposen els proveïdors de núvol i també per que és probable que sigui més econòmic proporcionar massivament el nombre de servidors que es consideren necessaris en qualsevol moment en el temps.\n\n**Seguiment i depuració**\n\nEl diagnòstic del rendiment o els problemes d&#39;ús de recursos excessius amb el codi sense servidor pot ser més difícil que amb el codi del servidor tradicional, ja que, tot i que es poden programar funcions completes, normalment no hi ha cap possibilitat d&#39;aprofundir en afegir perfils, depuradores o eines de monitoratge. A més, l&#39;entorn on s&#39;executa el codi no sol ser de codi obert, de manera que les seves característiques de rendiment no es poden reproduir exactament en un entorn local.\n\n**Seguretat**\n\nServerless a vegades es considera erròniament més segur que les arquitectures tradicionals. Tot i que això és cert en certa manera perquè les vulnerabilitats del SO són ateses pel proveïdor del núvol, la superfície d&#39;atac total és significativament més gran, ja que hi ha molts més components per a l&#39;aplicació en comparació amb les arquitectures tradicionals i cada component és un punt d&#39;entrada a l&#39;aplicació sense servidor . A més, les solucions de seguretat que els clients solien tenir per protegir les seves càrregues de treball en el núvol es converteixen en irrellevants perquè els clients no poden controlar i instal·lar res al punt final i al nivell de xarxa com IDS / IPS.\n\n## Tecnologia amb futur o només es tracta d&#39;una moda?\n\nLa informàtica sense servidor o FaaS és una evolució dels serveis oferts al núvol i encara que es tracta d&#39;una tecnologia nova són molts els operadors de CloudComputing que ofereixen serveis de funcions &quot;Sense Servidor&quot;, entre ells podem destacar els següents:\n\n- Microsoft amb AzureFunctions.\n- Amazon amb AWS Lambda.\n- Google amb Google CloudFunctions\n\n## Lectures relacionades\n\n[**https://en.wikipedia.org/wiki/Function\\_as\\_a\\_service**](https://en.wikipedia.org/wiki/Function_as_a_service)\n\n[**https://aws.amazon.com/es/lambda/features/**](https://aws.amazon.com/es/lambda/features/)\n\n[**https://azure.microsoft.com/es-es/services/functions/**](https://azure.microsoft.com/es-es/services/functions/)\n\n[**https://cloud.google.com/functions/docs/**](https://cloud.google.com/functions/docs/)\n\n[**https://www.ibm.com/cloud/functions**](https://www.ibm.com/cloud/functions)\n\n[**https://serverless.com/**](https://serverless.com/)\n\n[**https://www.slideshare.net/bennybauer1/serverless-when-to-faas**](https://www.slideshare.net/bennybauer1/serverless-when-to-faas)\n\n","objectID":"L2Jsb2cvMjAxOC8wOS9TZXJ2ZXJsZXNzX2NvbXB1dGluZ19GYWFT"},"L2Jsb2cvMjAxOC8xMS8yMDE4MTJTRFdBTg==":{"date":1543363200000,"title":"SD-WAN","description":"Fonaments de les SD-WAN per dummies","responsable":"Unitat d'arquitectura","sections":["Blog","home"],"blog_tags":["SD-WAN","SDN","Comunicacions"],"categories":["Cloud","SD-WAN","SDN","Comunicacions"],"imatge":"/images/bloc/2018/12/sdwanportada.jpg","key":"NOVEMBRE2018","path":"/blog/2018/11/201812SDWAN","content":"# SD-WAN (software-defined networking in a wide area network)\n\n\n\n\nPer poder entendre millor la tecnologia SD-WAN, cal que fem una ullada al que implica el SDN (xarxes definides per software).\nI si per definir les xarxes dins d’un CPD utilitzen SDN, per què no fer el mateix amb les connexions WAN ?  D’aquí sorgeix SD-WAN.\n\nPodem definir SD-WAN com una tecnologia que ens permetrà poder connectar les nostres seus, utilitzant xarxes definides per software, podent determinar així la manera més eficient i eficaç de enrutar el tràfic entre aquests.\n\nCom en el cas de SDN, SD-WAN ens permet separar el pla de control del pla de dades, amb els avantatges que això implica, gestió centralitzada, automatització, etc.\n\n## D’on sorgeix la necessitat\n\nEstem en una època en què l’adaptació a les noves necessitats d’una forma ràpida i senzilla és fonamental perquè el nostre negoci prosperi.  \n\nUn dels factors principals que mai hem d’oblidar és el de la seguretat, essencial per a poder protegir-nos de la gran infinitat d’atacs als que podem estar sotmesos cada dia.  \n\n**Hem de aconseguir ser ràpids, eficients , segurs i tot a un preu raonable.**  \n\nI just en aquest punt és on apareix una tecnologia, SD-WAN, que ens pot arribar a cobrir les nostres necessitats pel que fa a la connectivitat de les nostres seus.  \n\n\n## Principals característiques d’una xarxa SD-WAN\n\nTot i que al tractar-se d’una tecnologia, les característiques de la xarxa SD-WAN que configurem dependran directament del fabricant escollit, sí que hi ha un seguit de característiques genèriques que tota xarxa SD-WAN hauria de complir. Aquestes característiques són les següents:  \n\n- **Gestió centralitzada.** Tots els dispositius que formin part de la xarxa SD-WAN han de poder-se gestionar / administrar des d’un únic punt. Això ens ha de permetre poder crear plantilles amb les que configurar d’una forma fàcil i ràpida molts dispositius alhora. És important poder disposar d’APIs que ens permetin poder integrar-nos en altres solucions i ajudar-nos en l’automatització de tasques.\n\n- **Gestió/utilització “activa”  les línies connectades a una mateixa seu.** Si en la nostra organització tenim seus amb més d’una línia per connectar-se, per exemple, a la seu central, hauríem de ser capaços de  poder aplicar funcions sobre aquestes ( balanceig, QoS, acceleració de tràfic, etc.) de tal forma que poguéssim aprofitar activament totes les connexions, és a dir, les dues o més línies haurien d’estar treballant conjuntament, alhora.\n\n- **Aprovisionament automàtic (“Zero Touch Provisioning”).** Ha de ser possible poder aprovisionar/ connectar una nova seu de forma automàtica i centralitzada. Això ens dona una gran flexibilitat i velocitat en el moment de connectar noves seus a la nostra organització, sense necessitat d’estar desplaçant personal constantment.\n\n- **Diferents serveis en un únic dispositiu.**  Està clar que en l’actualitat ja tenim dispositius que poden realitzar cadascuna de les funcions que hem descrit anteriorment. Un dels avantatges de SD-WAN és el fet que aquestes funcions es centrin en únic dispositiu, permetent-nos així simplificar molt l’administració / gestió, poder resoldre més àgilment possibles problemes , poder automatitzar més tasques i sobretot baixar els costos.\n\n\n![Imatge centralització funcions](/images/bloc/2018/12/sdwan1.jpg)\n\n## Beneficis que podem obtenir\n\nEls beneficis que podem obtenir amb SD-WAN són:  \n\n- **Flexibilitat / agilitat.** En tot moment podem adaptar les connexions (ampliació, creació de noves) entre les seus a les nostres necessitats.\n\n- **Optimització/ disponibilitat.** Es podrà determinar en cada instant, de forma automàtica,  quin és el millor camí per a comunicar les seus, poden utilitzar els dos alhora.\n\n- **Seguretat.** Podrem fer arribar la seguretat fins a l’entrada/sortida de la pròpia seu.\n\n- **Visibilitat.** Podrem tenir un control centralitzat de tot el que esta passant en la comunicació entre les diferents seus.\n\n- **Administració centralitzada.** L’administració / gestió de la connectivitat (amb les funcions incloses en aquesta, com potser el cas de la seguretat) de les seus es podrà realitzar  des de un únic punt.\n\n- **Estalvi en els costos.** Tot i l’estalvi que impliquen els punts anteriors, podríem determinar canviar el tipus de connexió contractat actualment per un altre de més baix cost, és a dir, podem determinar que ja no hi ha  necessitat de contractar línies punt a punt, ni treballar amb tecnologia MPLS, sinó que connectarem les nostres seus mitjançant Internet, o utilitzar també les connexions internet que ja tenim per poder comunicar les seus a part de les línies dedicades.\n\n\n![Imatge centralització connexions](/images/bloc/2018/12/sdwan2.jpg)\n\nA part dels beneficis descrits anteriorment, cal fer especial atenció a  les prestacions que ens ofereix SD-WAN en quant a administració centralitzada, automatització i visibilitat.  \n\n## Tipus, aproximacions a la tecnologia SD-WAN  \n\nSegons “la naturalesa del negoci“ del fabricant, ens podem trobar amb varies aproximacions, fabricants que:  \n\n- Prioritzin el Routing (balanceig, acceleració,...).\n\n- Prioritzin la Seguretat.\n\n- Es vulguin apropar al màxim als sistemes de Informació / usuaris.\n\n- Prioritzin la convergència amb la LAN.\n\n- Tinguin una visió dirigida més a grans operadors.  \n\nCada fabricant, disposa de dispositius / software SD-WAN on preval les seves prioritats. Això no vol dir que no disposin d’altres funcionalitats, però si més no, estan especialitzats en les pròpies..   \nTenint present els diferents tipus /aproximacions de SD-WAN que hi ha en el mercat, una mostra són les anomenades anteriorment, la següent qüestió que se’ns planteja és: Quin tipus de SD-WAN hauria d’aplicar a la meva empresa?  \n\n## Quin tipus de SD-WAN hauria d’aplicar a la meva empresa  \nÉs important tenir present que una determinada empresa pot tenir més d’un tipus de SD-WAN funcionant, tot dependrà del tipus de negoci que estigui tractant.  \nCrec que per poder determinar el tipus de SD-WAN, ens hem de fer un seguit de preguntes referents sobretot al negoci / negocis que tenim i el que implica poder disposar d’un tipus o un altre de SD-WAN. Aquestes preguntes aniran molt enfocades a la situació actual en què ens trobem. Per exemple, per una empresa que tingui moltes seus connectades amb línies punt a punt i la sortida Internet centralitzada a la Seu Central igual que els dispositius de seguretat, algunes de les preguntes que ens hauríem de plantejar són:  \n\n- Com s’estan administrant actualment les connectivitats de totes aquestes seus, d’una forma centralitzada o no?\n\n- A nivell d’ocupació de les línies, quina part d’aquestes esta ocupada per tràfic “il·lícit”, que després es tallarà a la Seu Central?\n\n- Quin tipus de seguretat necessitaria implementar a la pròpia seu, a nivell de connectivitat?\n\n- Tinc serveis sensibles (aplicacions en temps real crítiques) que passin per aquestes línies?\n\n- Necessito integrar la gestió / administració de la SD-WAN amb la LAN?\n\n- En cas que l'ocupació de les línies sigui molt elevada, a quin nivell he de poder garantir cert tràfic (aplicació, usuari, etc.)?\n  \nDepenent de la resposta que donem a  aquestes qüestions, podrem determinar si ens interessa tenir una SD-WAN que prioritzi la seguretat de les Seus, una que prioritzi tot el tema de Routing, una que convergeixi la WAN i la LAN o simplement una combinació d’aquestes (diferenciant grups de Seus per tipus de SD-WAN a aplicar). \n\n## I què passa amb les meves connexions WAN?\n\nEstà clar que el fet de utilitzar una tecnologia com SD-WAN, ens pot suposar un gran estalvi a nivell de costos, i un dels motius pot ser substituir les línies que tenim actualment per altres de més baix cost.  \nAbans de donar aquest pas, el que hem de tenir present en tot moment és el tipus/ naturalesa de tràfic que va per aquestes línies i si ens interessa o no canviar-les. És a dir, el primer canvi en què podem pensar és el de substituir el conjunt de línies d’un determinat proveïdor (MPLS) per FTTH, però s’ha de tenir present la  qualitat que ens ofereix Internet, que si bé pot ser acceptable per la majoria de casos (segons el negoci), poden haver alguns casos en què no ens doni les garanties necessàries.  \nTenint això present, els que s’hauria de fer és utilitzar la tecnologia SD-WAN en seus que puguin arribar a tenir connexions MPLS i FTTH, per exemple.  \nLa reducció de la dependència del MPLS del proveïdor farà que cada cop hagin de dependre menys d’ell,  facilitant-nos tasques de futur, com potser el fet de voler canviar de proveïdor.  \nUn altre tendència a nivell de línies podria ser utilitzar línies de baix cost com a segona connexió, tot i que aquesta, amb SD-WAN  també estaria activa i utilitzant-se. En aquest cas, estaríem parlant físicament d’una WAN híbrida  (s’utilitzen diferents tipus de connexió).  \n\n## Connexió al Núvol. Una nova aproximació a la SD-WAN ?\nDins dels diferents tipus / aproximacions a SD-WAN, en el mercat ens podem trobar un cas particular que es basa en connectar totes les seus, inclosa la central, a un determinat núvol.  \nLa connexió entre les diferents seus es faria a través d’aquets núvol on hi haurien els serveis necessaris ( seguretat, balanceig, etc. ). Com en els casos anteriors, l’administració es faria de forma centralitzada però en la majoria de casos en el propi núvol.\nTot i que podria ser una opció valida per poder connectar les seus de la nostra organització, podríem com a mínim dubtar si la podem tractar com un tipus de SD-WAN o no, tenint present que:  \n\n- Ens estem lligant a un proveïdor, en aquest cas el del núvol que triem.\n  \n- La majoria de serveis que s’apliquen són centralitzats en el núvol, no en cadascuna de les seus per separat. Hi haurà seus que ens interessi aplicar uns determinats serveis en la sortida/entrada de la pròpia seu, estalviant-nos així problemes de seguretat i de accessibilitat, no consumint línia amb tràfic que considerem il·lícit.\n\n- Pel que fa a la visibilitat i automatització, estarem lligats a la que ens ofereixi el propi núvol.\n\nTenint present això, caldria que cadascú determinés si al seu entendre aquests tipus de connexions es pot considerar SD-WAN o no.  \n\nPer finalitzar, hem de ser conscients que es tracta d’una tecnologia “recent” i com a tal hi ha molts fabricants que encara la estan desenvolupant i evolucionant, podent sofrir molts canvis a curt / mig termini.  \n\n## Lectures relacionades:\n \n[**http://www.velocloud.com/**](http://www.velocloud.com/)  \n[**https://www.cisco.com/c/es_es/solutions/enterprise-networks/sd-wan/index.html**](https://www.cisco.com/c/es_es/solutions/enterprise-networks/sd-wan/index.html)  \n[**https://www.arubanetworks.com/products/networking/sd-wan/**](https://www.arubanetworks.com/products/networking/sd-wan/)  \n[**https://www.fortinet.com/products/sd-wan.html**](https://www.fortinet.com/products/sd-wan.html)  \n[**http://www.nuagenetworks.net/enterprise/software-defined-wan/**](http://www.nuagenetworks.net/enterprise/software-defined-wan/)  \n[**https://e.huawei.com/es/solutions/technical/sdn/sd-wan**](https://e.huawei.com/es/solutions/technical/sdn/sd-wan)  \n[**https://www.silver-peak.com/sd-wan**](https://www.silver-peak.com/sd-wan)  \n","objectID":"L2Jsb2cvMjAxOC8xMS8yMDE4MTJTRFdBTg=="},"L2Nhbmlnby9lbnRvcm4tZGVzZW52b2x1cGFtZW50":{"date":1447804800000,"lastmod":"2019-04-23","title":"Entorn de desenvolupament","description":"Màquina virtual amb l'ecosistema d'eines Canigó per a començar a desenvolupar","sections":"Canigó","weight":5,"path":"/canigo/entorn-desenvolupament","content":"### Introducció\n\n_L'entorn de desenvolupament_ és una màquina virtual Linux, basada en Lubuntu Desktop (Ubuntu Bionic Beaver 18.04.2 LTS) per ser una distribució d'escriptori Linux lleugera, derivada d'una de les distribucions més esteses del món (Ubuntu / Debian) i amb suport LTS, a la qual se li ha afegit una selecció de programari enfocat principalment a aplicacions Canigó.\n\n\n### Objectius\n\nEls objectius perseguits per l'entorn de desenvolupament són:\n\n* Facilitar la posada en marxa de l'entorn de desenvolupament, aprovisionant una màquina virtual amb tot el necessari per a començar el desenvolupament d'una aplicació Canigó.\n* Simular els entorns de desplegament als CPD Generalitat, facilitant contenidors amb les mateixes versions i configuracions dels PaaS que ens trobarem als clouds.\n\nAddicionalment aquesta versió de l'entorn de desenvolupament no només s'ha actualitzat amb les últimes versions estables del programari, sino que s'ha fet que estigui alineada amb l'última versió de Canigó 3.4 per proporcionar la millor experiència d'usuari *out-of-the-box* en el desenvolupament d'aplicacions Canigó.\n\n\n### Prerequisits\n\nPer poder treballar amb l'entorn de desenvolupament s'ha d'instal·lar prèviament el següent programari:\n\n* [Virtualbox](https://www.virtualbox.org/wiki/Downloads)\n* [Vagrant](http://www.vagrantup.com/downloads.html)\n* [Vagranfile](https://github.com/gencat/dev-environment/releases/tag/3.0.0) amb la configuració de l'entorn Canigó\n\n\n### Instal·lació\n\nLa versió 3.0.0 ha simplificat i automatitzat la configuració inicial fins al punt de no haver de fer cap acció especial per part de l'usuari (vegeu apartat _KNOWN ISSUES_ de la versió).\n\n1. Descarregar la configuració del vagrant amb la següent comanda\n\n        git clone https://github.com/gencat/dev-environment.git\n\n2. Anar al directori `dev-environment/Vagrant` i arrencar l'entorn amb\n\n        vagrant up\n\n    Amb aquesta última instrucció, vagrant aixeca una màquina virtual a Virtualbox, i executa les comandes que inclogui el fitxer `Vagrantfile`. El temps d'instal·lació pot variar **entre 25 i 90 minuts**, pel fet que ha de descarregar i instal·lar tot el software necessari.\n\nEn el moment que a la màquina virtual aixecada es vegi l'escriptori, el procés haurà finalitzat.\n\n\n#### Notes addicionals\n\n* Tot i que es pot engegar i aturar la màquina virtual a través de VirtualBox, es recomana utilitzar les comandes `vagrant up` i `vagrant halt` per fer aquestes accions.\n* Es recomana no realitzar cap actualització ni de versió de sistema operatiu ni d'eines a l'entorn sense prèvia consulta a l'equip del CS Canigó.\n\n\n### Software base\n\nEl software base s'ha instal·lat un conjunt de programari per a les tasques complementàries de desenvolupament. Aquest software addicional s'ha instal·lat dins el directori `/opt`\n\n* Open JDK 8 (1.8.0_191)\n* Visual VM 1.3\n* Clients per diferents BBDD (Mysql, PostgreSQL, MongoDB i Redis)\n* Navegador Mozilla FireFox Quantum (66.0.3)\n* Client VPNC per accés a XCAT\n* Navegador Google Chrome (73.0.3683.103)\n* Engine Docker i Docker Compose Tool per l'execució de contenidors Docker\n* Servidor Apache HTTP (2.4)\n\n\n### Software addicional\n\nA banda del software base s'ha instal·lat i configurat un conjunt de programari addicional dins el directori `/opt`, amb les versions alineades al [full de ruta del programari](https://qualitat.solucions.gencat.cat/estandards/estandard-full-ruta-programari/).\n\n* Open JDK 11 (11.0.2 : OpenJDK 64-Bit Server VM 18.9)\n* LanguageTool 5.3 - Per revisar gramàtica, ortografia i formes correctes del català.\n* DBeaver 6.0.2 - Eina multi-paradigma (SQL, No-SQL, etc.) per a BBDD.\n* SoapUI 5.5.0 - Eina per treballar amb serveis SOAP i REST.\n* jMeter 5.1.1 - Eina per fer validacions funcionals, proves de càrrega i mesures de rendiment d'aplicacions.\n* NodeJS - Servidor d'aplicacions JS. Les versions instal·lades són 8.15.1 i 10.15.3.\n* Visual Studio Code - Editor altament extensible (mitjançant plugins). Recomanable principalment per a treballar amb tecnologies frontend (AngularJS, Javascript, Typescript, etc.)\n* Maven 3.5.3\n* IDE - [Spring Tool Suite 4.2.0](https://spring.io/tools) (basat en Eclipse 2019/03), i els següents plugins:\n  - [Plugin CTTI Canigó](https://canigo.ctti.gencat.cat/canigo-download-related/plugin-canigo/) per creació aplicacions Canigó 3.4 basades en arquitectura REST+HTML5/JS.\n  - Spring Tool Suite per facilitar el desenvolupament d'aplicacions basades en [Spring](http://spring.io/projects).\n  - SonarLint permet detectar i solucionar problemes de qualitat al codi (actualment Java, JavaScript, Python i PHP) [SonarLint](https://www.sonarlint.org/).\n* jEdit 5.5.0 - Editor de textos (més lleuger que VS Code) basat en Java. Recomanable per a l'edició de fitxers grans (logs).\n\n\n### Screenshots\n\nA continuació s'adjunta un petit recull de captures de pantalla on es pot copsar l'escriptori i diferents programes per treballar-hi.\n\n<center><img src=\"/images/bloc/201904-entorn-desenvolupament/VirtualBox_CanigoDev-3.0.0_18_04_2019_10_35_36.png\" width=\"960px\" /><p style=\"font-size: small;\">Figura 1. Escriptori</p></center>\n\n<center><img src=\"/images/bloc/201904-entorn-desenvolupament/VirtualBox_CanigoDev-3.0.0_18_04_2019_10_37_15.png\" width=\"960px\" /><p style=\"font-size: small;\">Figura 2. Exemples de comandes al terminal</p></center>\n\n<center><img src=\"/images/bloc/201904-entorn-desenvolupament/VirtualBox_CanigoDev-3.0.0_18_04_2019_10_33_42.png\" width=\"960px\" /><p style=\"font-size: small;\">Figura 3. Eclipse Spring Tool Suite 4</p></center>\n\n<center><img src=\"/images/bloc/201904-entorn-desenvolupament/VirtualBox_CanigoDev-3.0.0_23_04_2019_10_45_54.png\" width=\"960px\" /><p style=\"font-size: small;\">Figura 4. Gestor DBeaver</p></center>\n\n<center><img src=\"/images/bloc/201904-entorn-desenvolupament/VirtualBox_CanigoDev-3.0.0_23_04_2019_10_49_50.png\" width=\"960px\" /><p style=\"font-size: small;\">Figura 5. VS Code</p></center>\n\n<center><img src=\"/images/bloc/201904-entorn-desenvolupament/VirtualBox_CanigoDev-3.0.0_18_04_2019_10_35_03.png\" width=\"960px\" /><p style=\"font-size: small;\">Figura 6. Editor jEdit</p></center>\n\n<center><img src=\"/images/bloc/201904-entorn-desenvolupament/VirtualBox_CanigoDev-3.0.0_23_04_2019_10_29_24.png\" width=\"960px\" /><p style=\"font-size: small;\">Figura 7. Language Tool</p></center>\n\n\n### Versions\n\n#### 3.0.0 (22/04/2019) -- <span style=\"color:green\">OPERATIVA</span>\n\n_RELEASE NOTES_\n\n* Actualitzacions del programari i millores generals.\n* Certificació funcionament amb plugin d'Eclipse v1.7.0 de Canigó.\n\n_KNOWN ISSUES_\n\n* El sistema d'àudio (hda, ac97) no funciona correctament degut a un error relacionat amb la versió de VirtualBox (p.e. 5.2.18). En versions més noves (>= 6.0.0) pot estar resolt (tot i que no s'ha verificat aquest punt). Podeu trobar més informació al següent enllaç: [https://forums.virtualbox.org/viewtopic.php?f=8&t=91190](https://forums.virtualbox.org/viewtopic.php?f=8&t=91190)\n\n#### 2.0.4 (22/11/2018)\n\n_RELEASE NOTES_\n\n* Deshabilitats \"Update sites\" excepte pel plugin de Canigó\n* Certificació funcionament amb plugin d'Eclipse v1.7.0 de Canigó\n\n#### 2.0.3 (6/8/2018)\n\n_RELEASE NOTES_\n\n* Millores en el procés de construcció de la VM per tal d'aïllar-lo d'alguns recursos externs importats ara dins el [repositori](https://github.com/gencat/dev-environment/tree/master/Vagrant/resources) de l'entorn de desenvolupament.\n\n#### 2.0.2 (25/6/2018)\n\n_RELEASE NOTES_\n\n* Es detecten problemes amb el servei de VirtualBox Guest Additions. No s'instal·len i es deixa desactivada l'acceleració 3D\n\n#### 2.0.1 (19/6/2018)\n\n_RELEASE NOTES_\n\n* S'activa l'acceleració 3D i s'incrementa la memòria de video per poder arrencar la VM ja que havia deixat de funcionar el mode gràfic\n\n#### 2.0.0 (20/11/2017)\n\n_RELEASE NOTES_\n\n* Incorporada nova versió del plugin d'Eclipse per Canigó 3.2\n* Implementat procés de healthcheck per comprovar el correcte funcionament del procés de construcció de la VM\n\n#### 1.0.4 (29/05/2017)\n\n_RELEASE NOTES_\n\n* Actualitzada la versió de Oracle Java a 1.8\n\n#### 1.0.3 (21/03/2017)\n\n_RELEASE NOTES_\n\n* Actualitzada la màquina virtual a Ubuntu 16.04\n* Actualitzat el plugin SVN a la versió 1.12.x\n\n#### 1.0.2 (9/1/2017)\n\n_RELEASE NOTES_\n\n* Revisats enllaços \"trencats\" a instal·lables (Subclipse, Docker Tooling, ...)\n\n#### 1.0.1 (16/3/2016)\n\n_RELEASE NOTES_\n\n* Actualització a Ubuntu 15.10\n\n_RELEASE NOTES_\n\nEn cas de voler actualitzar a la v1.0.1 des de la v1.0.0 de l'entorn de desenvolupament cal...\n\n* Fer l'upgrade a la versió 15.10 d'Ubuntu\n* Executar les següents comandes per a que segueixi apareixent el fons de pantalla corporatiu CTTI:\n\n\t\t$ sudo cp /usr/share/lubuntu/wallpapers/1510-lubuntu-default-wallpaper.png /usr/share/lubuntu/wallpapers/1510-lubuntu-default-wallpaper_bck.png\n\t\t$ sudo wget http://canigo.ctti.gencat.cat/devenv/fonspantalla_1280.png -O /usr/share/lubuntu/wallpapers/1510-lubuntu-default-wallpaper.png\n\n* Revisar la configuració de teclat a Preferències -> IBus Preferences -> Input method (en cas de no estar activat l'IBus cal activar-lo a Preferències -> Language Support -> Keyboard input method system)\n\n#### 1.0.0 (16/11/2015)\n\nRELEASE NOTES\n\n* Versió inicial\n","objectID":"L2Nhbmlnby9lbnRvcm4tZGVzZW52b2x1cGFtZW50"},"L2Nhbmlnby9mcmFtZXdvcms=":{"date":1463011200000,"title":"Framework Canigó","description":"Descripció del Framework de desenvolupament corporatiu JEE de la Generalitat de Catalunya","sections":"Canigó","taxonomies":[],"toc":true,"weight":1,"path":"/canigo/framework","content":"## Descripció del framework\n\nCanigó es defineix com un \"Espai de treball tecnològic comú per al desenvolupament i execució d'aplicacions en l'àmbit dels sistemes corporatius i departamentals de la Generalitat de Catalunya\", i es els seus objectius són: \n\n- Oferir una arquitectura comuna de construcció d'aplicacions JEE.\n- Proporcionar un entorn de treball, documentacó, suport i manteniment dels seus components.\n- Simplificar la complexitat inherent a JEE, oferint un marc de referència de treball.\n- Oferir una solució aliniada amb els estàndars i solucions més utilitzades per la comunitat OpenSource.\n- Oferir una solució oberta que permeti afegir i intercanviar qualsevol peça amb un cost reduït.\n- Oferir una solució d'interconnectivitat amb els serveis corporatius.\n- Oferir patrons de desenvolupament àmpliament acceptats.\n\nL'arquitectura de Canigó es basa en l'arquitectura MVC (Model-Vista-Controlador), on existeix un procés d'abstracció que permet dividir una aplicació en components lògics amb responsabilitats diferenciades i que poden ser desenvolupats fins i tot per diferents rols de l'equip.\n\nTanmateix, a més de l'estructura lògica dels components segons el patró MVC, Canigó defineix la seva ubicació segons una arquitectura en 3 capes i 4 mòduls transversals:\n\n**Capes**\n\n- **Capa de Presentació**: els patrons de desenvolupament actuals fomenten la separació de la capa de presentació en dues parts diferenciades:\n\t- **Servidor**: la \"vista\" serà una resposta format JSON, mitjançant serveis (microserveis) HTTP/REST\n\t- **Client**: client lleuger estàtic que consumirà el serveis del punt anterior.\n\n- **Capa de Lògica de Negoci**\n- **Capa de Dades/Integració**\n\n\n**Mòduls**\n\n- **Nucli del Framework**\n- **Mòdul de Seguretat**\n- **Mòdul de Suport**\n- **Mòdul d'Operació**\n\n\n![Arquitectura Canigó](/related/canigo/arquitectura.png)\n\nCom es mostra en el gràfic anterior, Canigó esta estructurat modularment donant així la opció de només utlitzar el mòdul del framework que es requereixi. Tots aquests mòduls es troben definits mitjançant interfícies, aïllant-los així de la implementació concreta escollida.\n\nCanigó es basa en la utilització de interfícies i en la integració existent entre diferents APIs (JPA,...) i paquets oberts (Spring, Hibernate, ...). També ofereix extensions als paquets oberts, afegint un ampli ventall de components reutilitzables.\n\nEl framework base es pot classificar en els següents blocs:\n\n## Components Base\n\nCanigó3 és un framework de codi obert per a la plataforma Java. Està basat en Spring, la primera versió del qual va ser creada per Rod Johnson a l'octubre de 2002. Està pensat per donar suport a:\n\n- la configuració d'aplicacións \n- facilitar el muntatge d'un sistema per parts fàcilment intercanviables i visibles entre elles\n- la integració de serveis\n- serveis de seguretat\n- connexió a base de dades, transaccionalitat, ... \n- la realització de proves, a través de Spring, que permet realitzar tests unitaris desacoblant els objectes del seu context fent més senzill realitzar proves dels components per separat\n- l'accés a dades externes, mitjantçant Spring, gestionant els recursos, proporcionant APIs d'ajuda i suportant la majoria de les tecnologies d'accés a dades com: JDBC, JPA (Hibernate com a proveïdor), MongoDB. \n\nEs pot considerar que la base principal de l'arquitectura de Canigó és un conjunt totalment integrat, i a la vegada modular, de les millors pràctiques tecnològiques existent actualment en aquest entorn, formada pels següents components:\n\n- **Spring 4 Framework** com a contenidor centralitzat d'objectes i serveis, totalment configurable mitjançant fitxers XML. La injecció de dependències permet la configuració d'objectes fora del codi de l'aplicació (i de manera no intrusiva). Redueix el codi d'aplicació dedicat a configurar i localitzar recursos. Facilita millors pràctiques com programar contra interfícies enlloc de contra classes, permetent el desacoblament de serveis i el canvi ràpid d'una implementació concreta per una altra. Permet també la gestió de transaccions sense la utilització de APIs específiques mitjançant l'ús de Aspect Oriented Programming (AOP)\n- **Spring Data JPA** proporciona un model de persistència basat en POJO's (Plain Old Java Objects) per mapejar bases de dades relacionals en Java.\n- **Spring Data MongoDB** proporciona un model de persistència també basat en POJO's per la integració amb la base de dades orientada a documents MongoDB. La capa d'accés a dades es composa de repositoris\n- **AOP (Aspect Oriented Programming)** per intercepció d'events a l'aplicació sense necessitat de modificar el codi\n\n## Nucli del Framework\n\nAquest mòdul és el <i>core</i> del framework on es troben les principals caracteristiquest:\n\n- **Configuració Multientorn**: basat en el PropertyPlaceHolder ofert per Spring. Amb la diferència que aquest mòdul permet disposar de propietats depenents de l'entorn sense necessitat de cap configuració extra a nivell de beans o propietats.\n- **Internacionalització (i18n)**: té com a objectiu facilitar el desenvolupament a l'hora d'oferir una aplicació en múltiples llenguatges.\n- **Servei de Traces**: basat en Log4j. Permet definir el nivell de traces, sortides, nivell mínim de traces, format de sortida, informació de context, ...\n- **Servei d'Excepcions**: permet informar que s'ha produït un error al realitzar una petició. Canigó ofereix una sèrie d'excepcions per defecte (BaseException, CoreException, ...). També proporciona un mecanisme d'intercepció d'Excepcions per a evitar \"try-catch\".\n\n## Mòdul de Seguretat\n\nTé com a propòsit gestionar l'autenticació i autorització dels usuaris que accedeixen a les aplicacions.\n\n- **Mòdul de Seguretat**: basat en Spring Security 3.0. Permet gestionar l'autenticació i l'autorització dels usuaris de les aplicacions.\n- **Backends Seguretat**: El servei de seguretat s'integra amb GICAR, SACE, LDAP, Base de dades i Inmemory.\n\n## Mòdul d'Integració\n\nLa finalitat d'aquests mòduls és facilitar l'accés a diferents serveis que ofereix la Generalitat.\n\n- **PICA**: proporciona una interfície Java per accedir a la Plataforma d'Integració i Col·laboració Administrativa. Aquest mòdul permet realitzar comunicacions síncrones i asíncrones.\n- **GECAT**: proporciona funcionalitat d'alta de factures, consultes i reserves online que ofereix el servei SAP de GECAT.\n- **PSIS**: permet la validació de signatures i certificats mitjançant el servei de PSIS ofert per Catcert.\n- **SARCAT**: permet consumir els diferents serveis que ofereix Sarcat, via Webservices o FTP/SFTP per a peticions planificades.\n- **Documentum**: permet consumir funcionalitats de Documentum com l'emmagatzematge i recuperació de documents, a més de crear carpetes i associar propietats.\n- **Notificacions Telemàtiques**: és un connector funcional cap a la PICA que simplifica l'utilització de Notificacions Telemàtiques de la Generalitat.\n- **Antivirus**: permet l'escaneig d'arxius mitjançant la Plataforma d'Antivirus Corporatiu de la Generalitat.\n- **SAP**: proporciona una interfície simplificada per a accedir a backends SAP de la Generalitat.\n- **Webservices**: Canigó 3 no disposa d'un mòdul de Webservices. S'ha realitzat una guia on s'explica com realitzar l'exportació de serveis Java mitjançant Webservices, l'importació de webservices externs i generació de les classes Java d'invocació. Proposa l'utilització d'Spring WS, Jaxb i OXM\n- **Cues**: Canigó 3 no disposa d'un mòdul de Gestió de Cues. S'ha realitzat una guia on s'explica com produir i consumir missatges d'una cua. Proposa l'utilització d'Spring JMS (Java Message Service).\n\n## Mòdul de Persistència\n\nAquest mòdul permet persistir i recuperar dades entre l'aplicació i el motor de base de dades.\n\n- **JPA**: Java Persistence API busca la manera d'unificar les utilitats que proporcionen un mapeig objecte-relacional. La implementació de JPA per defecte a Canigó 3 és Hibernate. Spring Data JPA permet implementar fàcilment repositoris per l'accés a dades amb JPA.\n- **MongoDB**: facilitat d'integració amb MongoDB gràcies a Spring Data MongoDB.\n\n## Mòdul de Suport\n\nAquest mòdul facilita l'ús d'un conjunt addicional de funcionalitats mitjançant el framework.\n\n- **Transferència Fitxers**: permet al servidor obtenir fitxers adjunts provinents d'una petició d'un formulari HTML. A més, aquest mòdul s'integra amb d'altres com el d'Antivirus.\n- **Enviament de correu**: permet l'enviament de correus electrònics a una o diverses adreces. També permet enviar en format de text pla o html i en tots dos casos ofereix la possibilitat d'adjuntar un o més fitxers en mode adjunt o inline.\n- **Planificador Tasques**: basat en Spring i Quartz. Ofereix la possibilitat d'executar tasques de forma diferida. En qualsevol moment del dia, algun dia de la setmana, ...\n- **OLE**: permet la manipulació d'objectes OLE (Excel i Word: crear, llegir, modificar documents de Microsoft en format OLE). Basat en POI.\n- **Merging**: permet realitzar la fusió de documents en format WordML, partint d'un document amb uns marcadors que seran substituïts per un conjunt de valors indicats en un diccionari.\n- **SFTP**: Permet enviar i rebre arxius entre el servidor on s'executa l'aplicació i altres servidors de forma segura mitjançant un intercanvi de claus. Basat en llibreries JSCH i Commons-VFS.\n\n## Mòdul d'Operació\n\n- **Instrumentació**: permet a l'aplicació generar dades d'instrumentació (nombre de peticions, nombre d'errors, ...) de la seva execució i posteriorment ser explotades amb eines de monitorització.\n- **Monitorització**: permet a l'aplicació mostrar una pantalla on es mostren dades guardades pel mòdul d'instrumentació.\n- **Logging**: permet a l'aplicació mostrar una pantalla on canviar el nivell dels logs, monitoritzar el diferents fitxers de logs i descarregar-los.\n\nLa informació detallada sobre els diferents components del Framework Canigó, la seva arquitectura i components, es pot trobar a l'apartat de <a href=\"/canigo-documentacio\">documentació del portal web</a>.\n","objectID":"L2Nhbmlnby9mcmFtZXdvcms="},"L2Nhbmlnby9kb3dubG9hZA==":{"date":1553011902000,"title":"Binaris de Canigó","description":"Descàrrega de les diferents versions de Canigó, entorn de treball, plugin d'eclipse...","sections":"Canigó","toc":true,"weight":4,"path":"/canigo/download","content":"## Canigó 3.4\r\n\r\n- [Release notes Canigó 3.4](/canigo-download-related/release-notes-canigo-34)\r\n- [Matriu de Compatibilitat Canigo 3](/canigo-download-related/matrius-compatibilitats)\r\n\r\n|          Versió Canigó LTS Actual  |      Última versió disponible     |\r\n|--------------------------------- \t |---------------------------------- |\r\n|              3.4.0          \t  \t |                3.4.0\t             |\r\n\r\n|          Dependències externes   \t \t|      Canigó 3.4.0     |\r\n|--------------------------------- \t \t|---------------------- |\r\n| springframework\t\t           \t \t\t\t|  5.1.5.RELEASE        |\r\n| spring.security\t\t           \t \t\t\t|  5.1.4.RELEASE        |\r\n| spring.data\t\t\t\t           \t \t\t\t|  2.1.5.RELEASE        |\r\n| springframework.boot         \t \t\t\t|  2.1.3.RELEASE        |\r\n| log4j\t\t\t\t\t\t\t\t\t\t         \t \t|  2.11.0\t\t\t\t        |\r\n| slf4j\t\t\t\t\t\t\t\t\t\t         \t \t|  1.7.25\t\t\t\t        |\r\n| junit\t\t\t\t\t\t\t\t\t\t         \t \t|  4.12\t\t\t\t\t        |\r\n| hamcrest\t\t\t\t\t\t\t\t         \t \t|  1.3\t\t\t\t\t        |\r\n| mockito\t\t\t\t\t\t\t\t\t         \t \t|  2.23.4\t\t\t\t        |\r\n| json.path.assert\t\t\t\t         \t \t|  2.4.0\t\t\t\t        |\r\n| jsonassert\t\t\t\t\t\t\t         \t \t|  2.4.0\t\t\t\t        |\r\n| jackson\t\t\t\t\t\t\t\t\t         \t \t|  2.9.5\t\t\t\t        |\r\n| springfox-swagger2\t\t\t         \t \t|  2.7.0\t\t\t\t        |\r\n| querydsl\t\t\t\t\t\t\t\t         \t \t|  4.2.1\t\t\t\t        |\r\n| hibernate\t\t\t\t\t\t\t\t         \t \t|  5.3.7.Final\t        |\r\n| mongodb.driver\t\t\t\t\t         \t \t|  3.10.1\t\t\t\t        |\r\n| mongodb-driver-reactivestreams   \t \t|  1.9.2\t\t\t\t        |\r\n\r\nPodeu consultar el llistat complet de dependències externes de Spring Boot 2.1.x a:\r\nhttps://docs.spring.io/spring-boot/docs/2.1.x/reference/htmlsingle/#appendix-dependency-versions\r\n\r\nS'ha certificat la compatibilitat de Canigó 3.4.0 amb els següents servidors incrustats\r\n\r\n|     \tServidor incrustat\t\t\t\t\t|      \t\t\t\tVersió\t\t\t\t\t     \t|\r\n|--------------------------------- \t|--------------------------------- \t|\r\n|  Tomcat\t\t\t\t\t          \t  \t \t|         9.0.16\t             \t\t\t|\r\n|  Undertow\t\t\t\t          \t  \t \t|         2.0.17.Final         \t\t\t|\r\n|  Jetty\t\t\t  \t\t        \t  \t \t|         9.4.14.v20181114    \t\t\t|\r\n|  Netty (webflux)\t\t\t\t\t\t\t\t\t|         4.1.33.Final        \t\t\t|\r\n|  Reactor Netty (reactor webflux)  |         0.8.5.RELEASE       \t\t\t|\r\n\r\nPer la següent versió de Canigó es certificarà Canigó 3.4.x amb els servidors suportats al [full de ruta del CTTI](https://qualitat.solucions.gencat.cat/estandards/estandard-full-ruta-programari/)\r\n\r\n## Canigó 3.2\r\n\r\n- [Release notes Canigó 3.2](/canigo-download-related/release-notes-canigo-32)\r\n- [Matriu de Compatibilitat Canigo 3](/canigo-download-related/matrius-compatibilitats)\r\n\r\n|          Versió LTS Actual       \t |      Última versió disponible     |\r\n|--------------------------------- \t |---------------------------------- |\r\n|              3.2.0.1            \t |                3.2.7\t             |\r\n\r\n### Creació de l'entorn local de desenvolupament\r\n\r\n<!--\r\n- Descàrrega de l'[entorn base de treball](http://repos.canigo.ctti.gencat.cat/repository/maven2/canigo/entorn-treball/canigo3.html) *És necessari realitzar l'upgrade del plugin de Canigó per Eclipse a la versió 1.2.0.\r\n- Guia d'inici per a la configuració d'un entorn de desenvolupament. Veure aquest [link](/canigo-download-related/guia-inici)\r\n-->\r\n\r\nVeure [Entorn desenvolupament Canigó](http://canigo.ctti.gencat.cat/canigo/entorn-desenvolupament/)\r\n\r\nAltra informació d'interés:\r\n\r\n* [Plugin Canigó 3.2 per a Eclipse i creació d'aplicació](/canigo-download-related/plugin-canigo)\r\n* [Codi plantilla demo Canigó 3.2] (https://github.com/gencatcloud/plantilla-demo-canigo32)\r\n\r\n### Configuració Maven (manual)\r\n\r\nPer a la resolució de dependències de Canigó i llibreries de tercers necessàries, fora de l'entorn de desenvolupament proporcionats pel CS Canigó on ja està pre-configurat, cal configurar el següent repositori Maven:\r\n```\r\n    https://sic.ctti.extranet.gencat.cat/nexus/content/groups/canigo-group-maven2/\r\n```\r\nPer a utilitzar el repositori, en realitat grup de repositoris, s'ha d'afegir el certificat del domini \"sic.ctti.extranet.gencat.cat\" al \"cacerts\" de Java des d'on s'executi el procés Maven que construeixi l'aplicació Canigó. Les passes a seguir són les següents:\r\n\r\n* Descarregar el certificat de la web mitjançant un navegador. Per exemple amb Google Chrome es pot fer de la següent manera:\r\n```\r\n    Chrome -> \"Eines per a desenvolupadors\" -> \"Seguretat\" -> \"Veure certificat\" -> \"Detalls\" -> \"Exportar\"\r\n```\r\n* Importar el certificat (Ex. \"certificat.cer\") al magatzem \"cacerts\" de Java amb l'eina keytool inclosa dins la JDK:\r\n```\r\n    $ keytool -keystore cacerts -importcert -alias canigo -file certificat.cer\r\n```\r\nUn cop importat el certificat els processos Maven executats que utilitzin la JDK on s'ha importat el certificat seran capaços de descarregar dependències del grup de repositoris.\r\n\r\nAl settings.xml del Maven configurar el repository al profile per defecte:\r\n\r\n```\r\n\t<profile>\r\n\t\t<id>defaultProfile</id>\r\n\t\t<activation>\r\n\t\t\t<activeByDefault>true</activeByDefault>\r\n\t\t</activation>\r\n\t\t<repositories>\r\n\t\t\t<repository>\r\n\t\t\t\t<id>canigo</id>\r\n\t\t\t\t<url>https://sic.ctti.extranet.gencat.cat/nexus/content/groups/canigo-group-maven2/</url>\r\n\t\t\t\t<snapshots>\r\n\t\t\t\t\t<enabled>true</enabled>\r\n\t\t\t\t\t<updatePolicy>always</updatePolicy>\r\n\t\t\t\t</snapshots>\r\n\t\t\t\t<releases>\r\n\t\t\t\t\t<enabled>true</enabled>\r\n\t\t\t\t</releases>\r\n\t\t\t</repository>\r\n\t\t</repositories>\r\n\t\t<properties>\r\n\t\t\t<downloadSources>true</downloadSources>\r\n\t\t\t<downloadJavadocs>false</downloadJavadocs>\r\n\t\t</properties>\r\n\t</profile>\r\n  \r\n```\r\n\r\n## Canigó 2.3\r\n\r\n- [Release notes Canigó 2.3.22](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN/fixforversion/10452)\r\n- [Plantilla Canigó 2.3.20 (Amb exemples) (format .zip)](http://repos.canigo.ctti.gencat.cat/repository/maven2/canigo/plantilla-canigo-inicial/2.3.20/demo-canigo-2.3.20.zip)\r\n- [Plantilla Canigó 2.3.20 (Sense exemples) (format .zip)](http://repos.canigo.ctti.gencat.cat/repository/maven2/canigo/plantilla-canigo-inicial/2.3.20/plantilla-canigo-2.3.20.zip)\r\n- [Contingut estàtic versió 2.3.20 (Comprimit) (format .zip)](http://repos.canigo.ctti.gencat.cat/repository/maven2/canigo/plantilla-canigo-inicial/2.3.20/demo-canigo-static-compress-2.3.20.zip)\r\n\r\n### Creació de l'entorn local de desenvolupament\r\n\r\n- Descàrrega de l'[entorn base de treball](https://sic.ctti.extranet.gencat.cat/nexus/content/groups/canigo-group-maven2/canigo/entorn-treball/canigo.zip)\r\n- Guia d'inici per a la configuració d'un entorn de desenvolupament. Veure aquest [link](/canigo-download-related/guia-inici-canigo2)\r\n\r\n<p>&nbsp;</p>\r\n\r\n## Versions anteriors 2.x\r\n\r\nPer a versions antigues del Framework Canigó, contacteu amb el [Centre de Suport](https://canigo.ctti.gencat.cat/centre-de-suport/contacta/).\r\n<p>&nbsp;</p>\r\n","objectID":"L2Nhbmlnby9kb3dubG9hZA=="},"L2Nhbmlnby9yb2FkbWFw":{"date":1499990400000,"title":"Roadmap Framework Canigó","description":"Roadmap previst per a la evolució del Framework Canigó","sections":"Canigó","taxonomies":[],"toc":true,"weight":3,"path":"/canigo/roadmap","content":"Aquest és el Roadmap previst per a la evolució del Framework de Canigó 3\r\n\r\n<script type=\"text/javascript\" src=\"https://www.gstatic.com/charts/loader.js\"></script>\r\n\r\n<script type=\"text/javascript\">\r\n  google.charts.load(\"current\", {packages:[\"timeline\"], 'language': 'es'});\r\n  google.charts.setOnLoadCallback(drawChart);\r\n  function drawChart() {\r\n    var container = document.getElementById('roadmap');\r\n    var chart = new google.visualization.Timeline(container);\r\n    var dataTable = new google.visualization.DataTable();\r\n\r\n\tdataTable.addColumn({ type: 'string', id: 'id' });\r\n    dataTable.addColumn({ type: 'string', id: 'Name' });\r\n    dataTable.addColumn({ type: 'date', id: 'Start' });\r\n    dataTable.addColumn({ type: 'date', id: 'End' });\r\n    dataTable.addRows([\r\n      [ '1','Canigo 3.2.0 LTS', new Date(2017, 2), new Date(2020, 2) ],\r\n      [ '2','Canigo 3.2.1', new Date(2017, 5), new Date(2017, 8) ],\r\n      [ '3','Canigo 3.2.2', new Date(2017, 8), new Date(2017, 11) ],\r\n\t  [ '4','Canigo 3.2.3', new Date(2017, 11), new Date(2018, 2) ],\r\n\t  [ '5','Canigo 3.2.4', new Date(2018, 2), new Date(2018, 5) ],\r\n\t  [ '6','Canigo 3.2.5', new Date(2018, 5), new Date(2018, 8) ],\r\n      [ '7','Canigo 3.2.6', new Date(2018, 8), new Date(2018, 11) ],\r\n\t  [ '8','Canigo 3.2.7', new Date(2018, 11), new Date(2019, 2) ],\r\n\t  [ '9','Canigo 3.4.0 LTS', new Date(2019, 2), new Date(2022, 2) ],\r\n\t  [ '10','Canigo 3.4.1', new Date(2019, 5), new Date(2019, 8) ],\r\n\t  [ '11','Canigo 3.4.2', new Date(2019, 8), new Date(2019, 11) ],\r\n\t  [ '12','Canigo 3.4.3', new Date(2019, 11), new Date(2020, 2) ],\r\n\t  [ '13','Canigo 3.4.4', new Date(2020, 2), new Date(2020, 5) ]]);\r\n\r\n    var options = {\r\n      timeline: { groupByRowLabel: false, showRowLabels: false },\r\n\t  colors: ['blue', 'green', 'green', 'green', 'green', 'green', 'green', 'green', 'blue','green','green','green','green']\r\n    };\r\n\r\n    chart.draw(dataTable, options);\r\n  }\r\n</script>\r\n\r\n<div id=\"roadmap\" style=\"height: 590px;\"></div>\r\n\r\n\r\n<br />\r\n\r\n* *El període associat a cada release no correspon a temps de desenvolupament, si no al temps en què es considera vigent*\r\n* *Aquest Roadmap està subjecte a canvis*\r\n\r\n\r\n","objectID":"L2Nhbmlnby9yb2FkbWFw"},"L2Nhbmlnby1kb2N1bWVudGFjaW8vaG93LXRvcw==":{"date":1556755200000,"title":"HOWTOs","description":"HOWTOs d'utilitat per els diferents serveis que ofereix el CS Canigó","sections":"HOWTOs","taxonomies":[],"weight":4,"path":"/canigo-documentacio/how-tos","content":"Un HOWTO és un document informal, generalment breu, que descriu com desenvolupar una certa tasca.\r\n\r\nEn aquest apartat s'aniran afegint un seguit de HOWTO, per tal de facilitar la configuració de certs components del framework, evitar possibles problemes, etc. Aquests documents estan disponibles en format pdf.\r\n\r\nHOWTOs disponibles actualment:\r\n\r\n- [Afegir les dev tools de Spring a Canigó 3.4.0] (/howtos/2019-04-Howto-afegir_dev_tools_spring/)\r\n\r\n- [Test unitaris amb programació reactiva a Canigó 3.4] (/howtos/2019-03-Howto-Test_unitaris_programacio_reactiva_canigo_3_4/)\r\n\r\n- [Actualitzar aplicació de Canigó 3.2 a Canigó 3.4] (/howtos/2019-03-Howto-Actualitzacio_Canigo3_2_Canigo3_4/)\r\n\r\n- [Definició sondes per aplicacions Canigó a AppAgile] (/howtos/2019-03-HowTo-Definicio-sondes-aplicacions-Canigo-AppAgile)\r\n\r\n- [Ús de Hikari CP a Canigó 3.2] (/howtos/2018-11-Howto-Canigo3-HikariCP)\r\n\r\n- [Migració Canigó 3 de Java 7 a Java 8] (/howtos/2018-10-10-HowTo-Canigo-Java8/)\r\n\r\n- [Configuració de MongoDB a Canigó 3.2.6] (/howtos/2018-09-Howto-MongoDB/)\r\n\r\n- [Configuració SAML per la integració amb GICAR en aplicació Canigó 3.2] (/howtos/2018-08-Canigo-SAML/)\r\n\r\n- [Propietats Multientorn al Front-End] (/howtos/2018-04-howto-frontend-multientorn/)\r\n\r\n- [Jocs de proves API REST] (/howtos/2018-02-howto-swagger_soapui/)\r\n\r\n- [Proves Unitàries Mòduls de Canigó] (/howtos/2018-01-howto-test_jars_canigo/)\r\n\r\n- [Integració d'una aplicació Canigó a SIC 2.0] (/howtos/2017-12-howto-integracio_canigo_sic/)\r\n\r\n- [Ús de Spring Data i QueryDSL al servei de persistència de Canigó 3.2] (/howtos/2017-11-Howto-Us_Servei_Persistence_Canigo/)\r\n\r\n- [Ús de Spring Cache (Caffeine) en Canigó 3.2](/howtos/2017-10-Howto-Us_Spring_Cache_Canigo/)\r\n\r\n- [Actualització aplicació de Canigó 3.1 a Canigó 3.2](/howtos/2017-08-Howto-Actualitzacio_Canigo3_1_Canigo3_2/)\r\n\r\n- [Desplegar aplicació Canigó 3.2 en IBM Websphere 8.5.x] (/howtos/2017-06-Howto-Desplegar_aplicacio_canigo32_websphere)\r\n\r\n- [Connectar amb una BBDD Mongo amb SSL a través de NodeJS](/howtos/2017-05-Howto-Connectar_nodejs_amb_mongo_ssl)\r\n\r\n- [Inserció/actualització massiva de dades a una aplicació Canigó 3.2](/howtos/2017-04-Batch-inserts-updates-canigo32)\r\n\r\n- [Securitzar accés a Elasticsearch des d'una pàgina web](/howtos/2017-03-Securitzar_ElasticSearch_Apache)\r\n\r\n- [Autenticació amb JWT a una aplicació Canigó 3.1](/howtos/2016-11-Howto-Canigo-JWT)\r\n\r\n- [Gestió d'errors a una aplicació Canigó 3.1](/howtos/2016-10-Howto-Canigo-Gestio-Errors-Globals)\r\n\r\n- [Spring Batch en aplicació Canigó 3.1](/howtos/2016-10-Howto-Canigo-Spring-Batch)\r\n\r\n- [Swagger en aplicació Canigó 3.1](/related/canigo/howto/Canigo - Howto - Swagger_en_aplicacio_Canigo_3_1.pdf)\r\n\r\n- [Desplegament aplicació Canigo 3.1 en Docker](/related/canigo/howto/Canigo - Howto - Desplegament aplicacio Canigo 3.1 en Docker.pdf)\r\n\r\n- [Contenidor Docker GICAR a Canigó en entorns de desenvolupament](/related/canigo/howto/Canigo - Howto - Contenidor GICAR en entorns de desenvolupament.pdf)\r\n\r\n- [Incorporació Mòdul Administració de logs a aplicació Canigó 3.1](/related/canigo/howto/Canigo - Incorporacio modul Administracio de logs a aplicacio Canigo 3.pdf)\r\n\r\n- [Anàlisi d'aplicació Canigó 3.1 amb Sonar](/related/canigo/howto/Canigo - Analisi aplicacio Canigo amb Sonar.pdf)\r\n\r\n- [Websockets a Canigó 3.1](/related/canigo/howto/Canigo - Websockets a Canigo 3.1.pdf)\r\n\r\n- [Streaming de fitxers en clients REST a Canigó 3.1](/related/canigo/howto/Canigo - Streaming de fitxers en clients REST.pdf)\r\n\r\n- [Actualització connectors de Canigó amb la PICA](/related/canigo/howto/Canigo - Actualitzacio Connectors PICA.pdf)\r\n\r\n- [Execució demo Equipaments al nou Entorn de Treball de Canigó](/related/canigo/howto/Canigo - HowTo - Execucio demo Equipaments al nou Entorn de Treball.pdf)\r\n\r\n- [Certificació desplegaments d'aplicacions Canigó 3.X a Websphere 8.5](/related/canigo/howto/Canigo - HowTo - Certificació desplegaments d'aplicacions Canigó a Websphere 8.5.pdf)\r\n\r\n- [Custodia i control de versions del codi de les aplicacions al SIC](/related/canigo/howto/SIC-Custodia_i_control_de_versions_del_codi_de_les_aplicacions.pdf)\r\n\r\n- [Generació aplicació Canigó 3.1 amb plugin d'Eclipse](/related/canigo/howto/Canigo - HowTo - Generacio aplicacio Canigo 3.1 amb plugin Eclipse.pdf)\r\n\r\n- [Aplicació Canigó 3.1 sense frontend](/related/canigo/howto/Canigo - HowTo - Aplicacio Canigo 3.1 sense frontend.pdf)\r\n\r\n- [Ús de relacions lazy a entitats de domini en serveis REST](/related/canigo/howto/Canigo - Us de relacions Lazy en aplicacions REST.pdf)\r\n\r\n- [Configuració GICAR i CORS amb proxy invers Apache en aplicacions REST+HTML5/JS](/related/canigo/howto/Canigó - Configuració GICAR-CORS amb Apache en aplicacions REST_HTML5_JS.pdf)\r\n\r\n- [Configuració autenticació bàsica a Canigó 3.1](/related/canigo/howto/Canigó - Configuració autenticació bàsica a Canigó 3.1.pdf)\r\n- [Integració Recaptcha](/related/canigo/howto/Canigó - Howto - Integració Recaptcha.pdf)\r\n\r\n- [Configuració de Canigo LOPD](/related/canigo/howto/Canigó - Howto - Configuració de Canigo LOPD.pdf)\r\n\r\n- [Us checkstyle pmd i findbugs en entorns de desenvolupament](/related/canigo/howto/Canigó - Howto - Us checkstyle pmd i findbugs en entorns de desenvolupament.pdf)\r\n\r\n- [Actualització Canigó 3.0 a Canigó 3.1](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Actualitzacio+Canig%C3%B3+3.0+a+Canigo+3.1.pdf)\r\n\r\n- [Configuració plantilla canigó amb Primefaces](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Plantilla+Canigo+amb+Primefaces.pdf)\r\n\r\n- [Configuració scope view JSF a Spring 3](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Configuraci%C3%B3+scope+view+JSF+a+Spring+3.pdf)\r\n\r\n- [AOP i AspectJ a Canigó 3](/related/canigo/howto/Canig%C3%B3+-+Howto+-+AOP+i+AspectJ+amb+Canig%C3%B3+3.pdf)\r\n\r\n- [Configuració fil d'Ariadna a Canigó 3](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Configuraci%C3%B3+fil+d%27ariadna+a+Canig%C3%B33.pdf)\r\n\r\n- [Menú Lateral amb estat a Canigó 3](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Men%C3%BA+Lateral+amb+Recordatori+d%27estat.pdf)\r\n\r\n- [Validacions amb Java Bean Validation (JSR-303)](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Validacions+amb+Java+Bean+Validation+%28JSR-303%29.pdf)\r\n\r\n- [Llistats paginables a servidor amb Canigó 3 ](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Llistats+paginables+a+servidor+amb+Canig%C3%B3+3.pdf)\r\n\r\n- [Joc de caràcters en aplicacions Canigó 3 ](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Joc+de+car%C3%A0cters+en+aplicacions+Canig%C3%B3+3.pdf)\r\n\r\n- [Upload de fitxers a Canigó 3 ](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Upload+de+fitxers+a+Canig%C3%B3+3.pdf)\r\n\r\n- [Generació de CRUDs amb JSF 2 ](/related/canigo/howto/howto_crud_jsf2.zip)\r\n\r\n- [Gestió d'excepcions amb JSF 2](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Gesti%C3%B3+d%27excepcions+amb+JSF+2.pdf)\r\n\r\n- [Exemple d'arquitectura servidor i clients desacoblats](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Exemple+d%27arquitectura+servidor+i+clients+desacoblats.pdf)\r\n\r\n- [Generació d'informes amb JasperReports](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Generaci%C3%B3+d%27informes+amb+JasperReports.pdf\")\r\n\r\n- [Generació de codis de barres](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Generaci%C3%B3+de+codis+de+barres.pdf\")\r\n\r\n- [Configuració slave Windows a Jenkins](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Configuraci%C3%B3+slave+Windows+a+Jenkins.pdf\")\r\n\r\n- [Implementació CRUD amb serveis REST i JQuery](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Implementaci%C3%B3+CRUD+amb+servei+REST+i+JQuery.pdf\")\r\n\r\n- [Mavenització d'aplicacions Android](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Mavenitzaci%C3%B3+d%27aplicacions+Android.pdf\")\r\n\r\n- [Custodia i control de versions del codi de les aplicacions](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Custodia+i+control+de+versions+del+codi+de+les+aplicacions.pdf\")\r\n\r\n- [Generació de gràfiques amb Primefaces a Canigó 3](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+Generaci%C3%B3+de+gr%C3%A0fiques+amb+Primefaces+a+Canig%C3%B3+3.pdf\")\r\n\r\n- [Canigó - HowTo + YUI Compressor al SIC](/related/canigo/howto/HowTo.+YUI+Compressor+al+SIC.pdf\")\r\n\r\n- [Creació d'un client CXF per l'STD](/related/canigo/howto/HowTo++Creaci%C3%B3+d%27un+client+CXF+STD.pdf\")\r\n\r\n- [Creació EAR's en un sol pas](/related/canigo/howto/HowTo.+Creaci%C3%B3+EAR+en+un+sol+pas.pdf)\r\n\r\n- [Desplegament Scripts de BBDD en INT](/related/canigo/howto/HowTo.Desplegament+Scripts+de+BBDD+en+INT.pdf)\r\n\r\n- [Instrumentació de Canigó 3 custom](/related/canigo/howto/HowTo.+Personalitzaci%C3%B3+de+la+Instrumentaci%C3%B3+Canig%C3%B33.pdf)\r\n\r\n- [Eina de Generació de Projectes Canigó 3](/related/canigo/howto/HowTo++Operativa+Eina+de+creaci%C3%B3+de+projectes+Canig%C3%B3.pdf)\r\n\r\n- [WURFL](/related/canigo/howto/Howto+Canigo3+-+WURFL_v1+3.pdf)\r\n\r\n- [Mavenització d'aplicacions basades en scripts d'ANT.pdf](/related/canigo/howto/HowTo+-+Mavenitzaci%C3%B3+aplicacions+basades+en+scripts+ANT.pdf\")\r\n\r\n- [Configuració de Webservices per MTOM.pdf](/related/canigo/howto/Howto+-+Configuraci%C3%B3+de+Webservices+MTOM.pdf)\r\n\r\n- [Upgrade Weblogic 10g.pdf](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+Upgrade+Weblogic+10g.pdf)\r\n\r\n- [Crides webservices segurs SSL.pdf](/related/canigo/howto/Howto - Crides webservices segurs SSL.pdf)\r\n\r\n- [Millora entorn desenvolupament.pdf](/related/canigo/howto/Howto+-+Millora+entorn+desenvolupament.pdf)\r\n\r\n- [Ús d'eines d'increment de la productivitat per l'entorn de treball de Canigó.pdf](/related/canigo/howto/Canig%C3%B3+-+HowTo+-++%C3%9As+d%3Feines+d%3Fincrement+de+la+productivitat+per+l%3Fentorn+de+treball+de+Canig%C3%B3.pdf)\r\n\r\n- [Tomcat 6.pdf](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+Tomcat+6.pdf)\r\n\r\n- [Directrius J2EE.pdf](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+Directrius+J2EE.pdf)\r\n\r\n- [HowTo - Upgrade Hibernate 3.2.6.ga a Canigó 1.4.x.pdf](/related/canigo/howto/HowTo.Pujar+la+versi%C3%B3+de+Hibernate+a+3.2.6.ga.pdf)\r\n\r\n- [HowTo - Empaquetat en format EAR.pdf](/related/canigo/howto/Canigo+-+HowTo+-+Empaquetat+en+format+EAR.pdf)\r\n\r\n- [HowTo - Construcció de projectes amb Maven.pdf](/related/canigo/howto/Canigo+-+HowTo+-+Construcci%C3%B3+de+projectes+amb+Maven.pdf)\r\n\r\n- [Accés a WebServices externs des de la Xarxa XCAT.pdf](/related/canigo/howto/Howto+-+Utilitzaci%C3%B3+Proxy+Servei+Framework.pdf)\r\n\r\n- [HowTo - Com fer upgrade a Servlet 2.4 i JSP 2.0 (J2EE 1.4)](/related/canigo/howto/Canigo+-+HowTo+-+Com+fer+upgrade+a+Servlet+2.4+i+JSP+2.0+%28J2EE+1.4%29.pdf)\r\n\r\n- [Com pujar la versió de Hibernate a 3.2.6.ga.pdf](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+Com+pujar+la+versi%C3%B3+de+Hibernate+a+3.2.6.ga.pdf)\r\n\r\n- [Integració amb Gicar](/related/canigo/howto/Canig%C3%B3+-+HowTo+GICAR+v2.pdf)\r\n\r\n- [Què fer si els missatges d'excepció d'Hibernate no arriben correctament](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+que+fer+si+els+missatges+d%27excepci%C3%B3+de+Hibernate+no+arriben+correctament.pdf)\r\n\r\n- [mostrar excepcions produides en fase de renderitzat .pdf](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+mostrar+excepcions+produides+en+fase+de+renderitzat+.pdf)\r\n\r\n- [Publicació i invocació de WebServices](/related/canigo/howto/Canigo+-+HowTo+WebServices-v1.1.pdf)\r\n\r\n- [HowTo - Generació i visualització de Traces.pdf](/related/canigo/howto/Canigo+-+HowTo+-+Generaci%C3%B3+i+visualitzaci%C3%B3+de+Traces.pdf)\r\n\r\n- [HowTo - Com securitzar els mètodes de negoci.pdf](/related/canigo/howto/Canigo+-+HowTo+-+Com+securitzar+els+m%C3%A8todes+de+negoci.pdf)&nbsp;\r\n\r\n- [Com definir tests en context Spring.pdf](/related/canigo/howto/Canigo+-+HowTo+-+Com+definir+tests+en+context+Spring.pdf)\r\n\r\n- [HowTo - com fer paginacio amb grans volums de dades.pdf](/related/canigo/howto/Canigo+-+HowTo+-+com+fer+paginacio+amb+grans+volums+de+dades.pdf)\r\n\r\n- [Joc de Caràcters en aplicacions Canigó.pdf](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+Joc+de+Car%C3%A0cters+en+aplicacions+Canig%C3%B3.pdf)\r\n\r\n- [Anàlisi d'Utilització de Memòria.pdf](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+An%C3%A0lisi+d%27Utilitzaci%C3%B3+de+Mem%C3%B2ria.pdf)\r\n\r\n- [Integracio Continua.pdf](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+Integracio+Continua.pdf)\r\n\r\n- [Eines d'anàlisi de rendiment web.pdf](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+Eines+d%27an%C3%A0lisi+de+rendiment+web.pdf)\r\n\r\n- [Eines de compressió JavaScript.pdf](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+Eines+de+compressi%C3%B3+JavaScript.pdf)\r\n\r\n- [Antivirus.pdf](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+Antivirus.docx)\r\n\r\n- [Transformació ppk a openSSH.pdf](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+Transformaci%C3%B3+ppk+a+openssh.docx)\r\n\r\n- [Eines de visualització del GC.pdf](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+Eines+de+visualitzaci%C3%B3+del+GC.pdf)\r\n\r\n- [Eines Intercepció de peticions http.pdf](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+Eines+Intercepci%C3%B3+de+peticions.pdf)\r\n\r\n- [Entorn Treball](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+Entorn+Treball.pdf)\r\n\r\n- [Generació de CRUD Canigó 3](/related/canigo/howto/Howto+-+Generaci%C3%B3+Crud+Canig%C3%B33.zip?version=2) [Descarregar ScreenCast](http://dl.dropbox.com/u/6456567/Videos%20Generaci%C3%B3%20CRUD.zip)\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8vaG93LXRvcw=="},"L2Nhbmlnby1kb2N1bWVudGFjaW8vbm9ybWF0aXVz":{"date":1422115902000,"title":"Normatius","description":"Normes aplicables al desenvolupament d'aplicacions","sections":"Documentació Canigó","taxonomies":[],"weight":3,"path":"/canigo-documentacio/normatius","content":"### Principals normes\r\n\r\n- [Norma de desenvolupament J2EE](/related/canigo/normes/NOR_0009_Desenvolupament_J2EE-V03.pdf)\r\n- [Norma de desenvolupament web](https://qualitat.solucions.gencat.cat/normatius/normatiu-desenvolupament-web/)\r\n- [Norma de desenvolupament de BBDD](/related/canigo/normes/SC-NOR11-01 Norma nomenclatura i esquema de bases de dades_v2.2.pdf)\r\n\r\n### Regles d'estil\r\n\r\n- Per als entorns de desenvolupament es recomana l'ús de Checkstyle, PMD i Findbugs\r\n- L'eina corporativa d'auditoria de codi és CAST. Més informació al web del [Model de Qualitat de Solucions](https://qualitat.solucions.gencat.cat/). Enllaç directe a [CAST](https://qualitat.solucions.gencat.cat/MQS/tools/cast_9A47CE30.html?nodeId=33196b46)\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8vbm9ybWF0aXVz"},"L2Nhbmlnby9tb25pdG9yaXR6YWNpbw==":{"date":1540166400000,"title":"Monitorització d'aplicacions","description":"Opcions que existeixen a l'actualitat per la monitorització d'aplicacions Canigó","taxonomies":[],"sections":"Canigó","key":"NOVEMBRE2018","weight":6,"path":"/canigo/monitoritzacio","content":"En aquesta plana s'enumeren les diferents funcionalitats que ofereix el framework Canigó per tal de monitoritzar les aplicacions. Aquestes funcionalitats es proporcionen als mòduls Canigó amb prefix \"canigo.operation\".\n\n### Instrumentació (canigo.operation.instrumentation)\n\nGràcies a aquest mòdul l'aplicació pot expossar mètriques de número de peticions, temps de resposta, i errors els quals poden ser visualitzats fàcilment en un time-line.\n\n![Instrumentació Canigó](/images/news/instrumentacio-canigo.png)\n\n_Documentació de referència_: https://canigo.ctti.gencat.cat/canigo-documentacio-versions-3x-core/modul-instrumentacio/\n\n### Administració de logs (canigo.operation.logging)\n\nEl mòdul d'administració de logs permet visualitzar traces en temps real gràcies a la tecnologia WebSockets, canviar el nivell de logs en calent, realitzar cerques, i descàrrega dels fitxers de log generats per l'aplicació.\n\n_Documentació de referència_: https://canigo.ctti.gencat.cat/canigo-documentacio-versions-3x-core/modul-logging-admin/\n\n#### Configuració nivell de logs\n\n![Configuració de logs Canigó](/images/news/configuracioNivellLogs.PNG)\n\n#### Visualització de logs\n\n![Visualització de logs Canigó](/images/news/VisualitzacioLogs.PNG)\n\n### Roadmap\n\nEn en roadmap de Canigó està previst incorporar alguna llibreria com [Metrics](https://metrics.dropwizard.io/) o estàndar com [Micrometer](https://micrometer.io/) mitjançant [Spring](https://spring.io/blog/2018/03/16/micrometer-spring-boot-2-s-new-application-metrics-collector) com a evolució de l'actual mòdul d'instrumentació. A més d'una consola de monitorització bàsica de l'aplicació, també es vol donar l'opció d'integrar les mètriques d'aplicacions Canigó amb eines tipus [Prometheus](https://prometheus.io/) o [New Relic](https://newrelic.com/), a més del Centre de Control de CTTI on poder tenir una visió general de l'estat de les aplicacions.\n\n### Plataformes Container Cloud\n\nA més de la pròpia monitorització de l'aplicació, cal tenir en compte que plataformes com Cloud Foundry (PaaS) o orquestradors Docker com Kubernetes (CaaS) proporcionen les seves pròpies eines de monitorització de consum de recursos i visualització de logs.\n\nL'objectiu d'aquesta monitorització, ja sigui a nivell d'aplicació (temps de resposta, integracions, ...) o PaaS/CaaS (cpu, mem, disc), és tenir el màxim d'informació de l'estat del servei. L'agilitat en poder fer un diagnòstic quan hi ha un problema a una aplicació és molt important, així com definir un pla de capacitat i/o escalat automàtic en funció dels recursos que requereixi l'aplicació amb caràcter preventiu.\n","objectID":"L2Nhbmlnby9tb25pdG9yaXR6YWNpbw=="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtYWx0cmVzL21vZHVsLW1vbmdvLXJlYWN0aXU=":{"date":1552867200000,"title":"Mongo reactiu","description":"Com configurar aplicació Canigó 3.4 per utilitzar mongo reactiu","sections":"Canigó. Documentació versió 3.x","weight":6,"key":"ABRIL2019","path":"/canigo-documentacio-versions-3x-altres/modul-mongo-reactiu","content":"## Propòsit\n\nEl propòsit d’aquest apartat és introduïr a les funcionalitats de reactiu en una base de dades Mongodb\n\n### Versió de Canigó\n\nEls passos descrits en aquest document apliquen a la versió 3.4 del Framework Canigó\n\n### Introducció\n\nEl mes de Març del 2019 s'ha publicat la versió 3.4 del Framework Canigó. Aquesta versió incorpora la possibilitat d'utilitzar les funcionalitats de reactiu en una base de dades Mongodb\n\nPer a passar una aplicació 3.3 a 3.4 hi ha disponible la següent guia [\"Actualització Canigó 3.3 a Canigó 3.4\"](/howtos/2019-03-Howto-Actualitzacio_Canigo3_3_Canigo3_4)\n\nL'objectiu d'aquest Howto és mostrar els procediments necessaris poder utilitzar les funcionalitats de reactiu en una base de dades Mongodb. El punt de partida d'aquest Howto és una aplicació creada amb el plugin de Canigó per Eclipse i actualitzada a la versió 3.4.0 de Canigó.\n\n\n### Introducció programació reactiu\n\nEn termes simples, la programació reactiva tracta d'aplicacions no bloquejadores que són asíncrones i orientades a esdeveniments i requereixen un nombre reduït de fils per escalar. Un aspecte clau d'aquesta definició és el concepte de contrapressió, que és un mecanisme per garantir que els productors no aclaparen els consumidors. Per exemple, en una pipeline de components reactius que s'estén des de la base de dades fins al socket HTTP, quan el client HTTP és lent, el repositori de dades es ralentitza o s’atura fins que la capacitat s’alliberi\n\nCanigó 3.4 té com a base Spring Framework 5 que aporta funcionalitats amb streams reactius utilitzant el projecte Reactor\n\nPer a més informació:\n\n[Reactive Stream](http://www.reactive-streams.org/)\n\n[Reactor](https://projectreactor.io/)\n\n[Spring Framework reactive](https://docs.spring.io/spring-framework/docs/5.0.0.M1/spring-framework-reference/html/web-reactive.html)\n\n[Notes on Reactive Programming](https://spring.io/blog/2016/06/07/notes-on-reactive-programming-part-i-the-reactive-landscape)\n\n\n### Introducció cas d'exemple\n\nPer il·lustrar aquesta guia utilitzarem un repositori de dades on hi contindrà missatges homòlegs a un tweet, on tindrà un id, un text i una data de creació\n\nPel repositori de dades utilitzarem una base de dades Mongodb i utilitzarem les funcionalitats de reactiu per accedir-hi\n\nEn l'exemple exposarem un CRUD de serveis rest sobre l'entitat tweet i exposarem 2 serveis rest de tipus stream per il·lustrar un efecte tipus timeline\n\n\n### Exemple\n\nPer l'exemple utilitzarem una base de dades Mongodb en local al port 27017 amb una base de dades amb nom \"canigo_persistence_mongo\"\n\nComençarem per afegir les dependències a Canigó Mongodb, Spring Mongodb, reactiu, reactor i Mongodb per test\n\n```xml\n<canigo.persistence.mongodb.version>[2.0.0,2.1.0)</canigo.persistence.mongodb.version>\n```\n\n```xml\n\t\t<dependency>\n\t\t\t<groupId>cat.gencat.ctti</groupId>\n\t\t\t<artifactId>canigo.persistence.mongodb</artifactId>\n\t\t\t<version>${canigo.persistence.mongodb.version}</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t<artifactId>spring-boot-starter-data-mongodb-reactive</artifactId>\n\t\t\t<exclusions>\n\t\t\t\t<exclusion>\n\t\t\t\t\t<artifactId>spring-boot-starter-logging</artifactId>\n\t\t\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t\t</exclusion>\n\t\t\t</exclusions>\n\t\t</dependency>\n\n\t\t<dependency>\n\t\t\t<groupId>io.projectreactor</groupId>\n\t\t\t<artifactId>reactor-test</artifactId>\n\t\t\t<scope>test</scope>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>de.flapdoodle.embed</groupId>\n\t\t\t<artifactId>de.flapdoodle.embed.mongo</artifactId>\n\t\t\t<scope>test</scope>\n\t\t</dependency>\n```\n\nAfegirem la propietat per la connexió a Mongodb, utilitzarem el estàndard de connexió per String de connexió a Mongodb, recomanem utilitzar aquesta forma de connexió, per més informació podeu consultar: https://docs.mongodb.com/manual/reference/connection-string/#connection-string-options\n```properties\n*.mongodb.uri=mongodb://127.0.0.1:27017/canigo_persistence_mongo?socketTimeoutMS=5000\n```\n\nNecessitem crear un configurador que extengui de *cat.gencat.ctti.canigo.arch.persistence.mongodb.config.ReactiveMongoCoreConfig* que crearà la connexió a la base de dades Mongodb a partir del String de connexió, un exemple de configurador podria ser:\n\n```java\nimport org.springframework.context.annotation.Configuration;\n\nimport cat.gencat.ctti.canigo.arch.persistence.mongodb.config.ReactiveMongoCoreConfig;\n\n@Configuration\npublic class ReactiveMongoConfig extends ReactiveMongoCoreConfig {\n\n\n}\n```\n\nEn aquest configurador hi podríem registrar els listeners que necessitéssim de Mongodb\n\nPartim de l'entitat Tweet amb la definició:\n```java\nimport java.util.Date;\n\nimport javax.validation.constraints.NotBlank;\nimport javax.validation.constraints.NotNull;\nimport javax.validation.constraints.Size;\n\nimport org.springframework.data.annotation.Id;\nimport org.springframework.data.mongodb.core.mapping.Document;\n\n\n@Document(collection = \"tweets\")\npublic class Tweet {\n    @Id\n    private String id;\n\n    @NotBlank\n    @Size(max = 140)\n    private String text;\n\n    @NotNull\n    private Date createdAt = new Date();\n\n    public Tweet() {\n\n    }\n\n    public Tweet(String text) {\n        this.text = text;\n    }\n\n    public String getId() {\n        return id;\n    }\n\n    public void setId(String id) {\n        this.id = id;\n    }\n\n    public String getText() {\n        return text;\n    }\n\n    public void setText(String text) {\n        this.text = text;\n    }\n\n    public Date getCreatedAt() {\n        return createdAt;\n    }\n\n    public void setCreatedAt(Date createdAt) {\n        this.createdAt = createdAt;\n    }\n}\n```\n\nCrearem el repository de l'entitat Tweet, utilitzarem les funcionalitats que aporta Spring per a repositoris reactius amb Mongo amb ReactiveMongoRepository\n\n```java\nimport org.springframework.data.mongodb.repository.ReactiveMongoRepository;\nimport org.springframework.data.mongodb.repository.Tailable;\nimport org.springframework.stereotype.Repository;\n\nimport cat.gencat.ctti.model.Tweet;\nimport reactor.core.publisher.Flux;\n\n@Repository\npublic interface TweetRepository extends ReactiveMongoRepository<Tweet, String> {\n\t\n\t@Tailable\n\tFlux<Tweet> findTweetsBy();\n\n}\n```\n\nHem definit un mètode de consulta de tweets de tipus \"Tailable\" per mantenir la connectivitat esperant a nous tweets\n\nPer a utilitzar aquest mètode la collection de Mongo ha de ser de tipus capped. Si la collection és de tipus capped no es pot utilitzar la funcionalitat d'eliminació d'elements. Si s'utilitza tailable a una collection no capped o s'eliminen elements a una collection capped s'obtindrà un error. Per tenir un exemple complet exposarem un servei utilitzant tailable i un servei d'eliminació d'elements però en un cas real no podrien conviure a la mateixa collection\n\nPer simplificar l'exemple utilitzarem directament el repositori al controller, recomanem, però, utilitzar la capa service entre els controllers i els repositoris\n\n```java\nimport javax.validation.Valid;\n\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.http.HttpStatus;\nimport org.springframework.http.MediaType;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.web.bind.annotation.DeleteMapping;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.PathVariable;\nimport org.springframework.web.bind.annotation.PostMapping;\nimport org.springframework.web.bind.annotation.PutMapping;\nimport org.springframework.web.bind.annotation.RequestBody;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\nimport cat.gencat.ctti.model.Tweet;\nimport cat.gencat.ctti.repository.TweetRepository;\nimport reactor.core.publisher.Flux;\nimport reactor.core.publisher.Mono;\n\n@RestController\n@RequestMapping(\"/tweets\")\npublic class TweetController {\n\n    @Autowired\n    private TweetRepository tweetRepository;\n\n    @GetMapping\n    public Flux<Tweet> getAllTweets() {\n        return tweetRepository.findAll();\n    }\n\n    @PostMapping\n    public Mono<Tweet> createTweets(@Valid @RequestBody Tweet tweet) {\n        return tweetRepository.save(tweet);\n    }\n\n    @GetMapping(\"/{id}\")\n    public Mono<ResponseEntity<Tweet>> getTweetById(@PathVariable(value = \"id\") String tweetId) {\n        return tweetRepository.findById(tweetId)\n                .map(savedTweet -> ResponseEntity.ok(savedTweet))\n                .defaultIfEmpty(ResponseEntity.notFound().build());\n    }\n\n    @PutMapping(\"/{id}\")\n    public Mono<ResponseEntity<Tweet>> updateTweet(@PathVariable(value = \"id\") String tweetId,\n                                                   @Valid @RequestBody Tweet tweet) {\n        return tweetRepository.findById(tweetId)\n                .flatMap(existingTweet -> {\n                    existingTweet.setText(tweet.getText());\n                    return tweetRepository.save(existingTweet);\n                })\n                .map(updateTweet -> new ResponseEntity<>(updateTweet, HttpStatus.OK))\n                .defaultIfEmpty(new ResponseEntity<>(HttpStatus.NOT_FOUND));\n    }\n\n    @DeleteMapping(\"/{id}\")\n    public Mono<ResponseEntity<Void>> deleteTweet(@PathVariable(value = \"id\") String tweetId) {\n\n        return tweetRepository.findById(tweetId)\n                .flatMap(existingTweet ->\n                        tweetRepository.delete(existingTweet)\n                            .then(Mono.just(new ResponseEntity<Void>(HttpStatus.OK)))\n                )\n                .defaultIfEmpty(new ResponseEntity<>(HttpStatus.NOT_FOUND));\n    }\n\n    // Tweets are Sent to the client as Server Sent Events\n    @GetMapping(value = \"/event-stream\", produces = MediaType.TEXT_EVENT_STREAM_VALUE)\n    public Flux<Tweet> eventStreamTweets() {\n        return tweetRepository.findTweetsBy();\n    }\n    \n    // Tweets are Sent to the client as stream json\n    @GetMapping(path = \"/stream-json\", produces = MediaType.APPLICATION_STREAM_JSON_VALUE)\n    public Flux<Tweet> streamJsonTweets() {\n        return tweetRepository.findTweetsBy();\n    }\n\n}\n```\n\nEn aquest controller exposem un CRUD de serveis rest sobre el path \"/tweets\" i dos serveis en stream: \"/tweets/event-stream\" per enviar tweets produint \"text/event-stream\" i \"/tweets/stream-json\" per enviar tweets produint \"application/stream+json\" per simular un efecte de tipus timeline\n\n#### Test serveis rest\n\nPer observar el comportament dels serveis amb streaming iniciarem l'aplicació amb Spring boot i utilitzarem un navegador amb la url:\n\n```\nhttp://localhost:8080/api/tweets/event-stream\n```\n\ni\n\n```\nhttp://localhost:8080/api/tweets/stream-json\n```\n\nObservarem que el navegador està esperant resposta del servidor\n\nEnviarem un nou tweet, per exemple fent:\n```\ncurl -X POST \\\n  http://localhost:8080/api/tweets \\\n  -H 'Content-Type: application/json' \\\n  -d '{\"text\":\"Hello, World!\"}'\n```\n\nI observarem com en el navegador ha aparegut el nou tweet simulant l'efecte de timeline\n\n#### Junit repositori reactiu\n\nPer provar el respositori reactiu utilitzarem un Embeded Mongo\n\nCrearem una configuració utilitzant el Embeded Mongo\n\n```java\nimport org.springframework.boot.autoconfigure.AutoConfigureAfter;\nimport org.springframework.boot.autoconfigure.EnableAutoConfiguration;\nimport org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration;\nimport org.springframework.boot.autoconfigure.mongo.embedded.EmbeddedMongoAutoConfiguration;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.context.annotation.DependsOn;\nimport org.springframework.core.env.Environment;\nimport org.springframework.data.mongodb.config.AbstractReactiveMongoConfiguration;\nimport org.springframework.data.mongodb.repository.config.EnableReactiveMongoRepositories;\n\nimport com.mongodb.reactivestreams.client.MongoClient;\nimport com.mongodb.reactivestreams.client.MongoClients;\n\n@Configuration\n@EnableReactiveMongoRepositories(basePackages = \"cat.gencat\")\n@EnableAutoConfiguration(exclude = { MongoAutoConfiguration.class })\n@AutoConfigureAfter(EmbeddedMongoAutoConfiguration.class)\npublic class EmbeddedReactiveMongoConfig extends AbstractReactiveMongoConfiguration {\n\n\tprivate final Environment environment;\n\n\tpublic EmbeddedReactiveMongoConfig(Environment environment) {\n\t\tthis.environment = environment;\n\t}\n\n\t@Override\n\t@Bean\n\t@DependsOn(\"embeddedMongoServer\")\n\tpublic MongoClient reactiveMongoClient() {\n\t\tint port = environment.getProperty(\"local.mongo.port\", Integer.class);\n\t\treturn MongoClients.create(String.format(\"mongodb://localhost:%d\", port));\n\t}\n\n\t@Override\n\tprotected String getDatabaseName() {\n\t\treturn \"embedded-reactive-mongo\";\n\t}\n\n}\n```\n\nEn un test de Junit podem utilitzar aquesta configuració enlloc que la de l'aplicació \"ReactiveMongoConfig\", per exemple:\n\n```java\nimport org.junit.Assert;\nimport org.junit.Test;\nimport org.junit.runner.RunWith;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.test.context.ContextConfiguration;\nimport org.springframework.test.context.junit4.SpringJUnit4ClassRunner;\n\nimport cat.gencat.ctti.config.AppConfig;\nimport cat.gencat.ctti.config.EmbeddedReactiveMongoConfig;\nimport cat.gencat.ctti.model.Tweet;\nimport reactor.core.publisher.Mono;\nimport reactor.test.StepVerifier;\n\n@RunWith(SpringJUnit4ClassRunner.class)\n@ContextConfiguration(classes = { AppConfig.class, EmbeddedReactiveMongoConfig.class })\npublic class TweetRepositoryTest {\n\n\t@Autowired\n\tTweetRepository tweetRepository;\n\n\t@Test\n\tpublic void testSaveTweet() {\n\t\tTweet originTweet = new Tweet(\"Hello, World!\");\n\t\tMono<Tweet> tweetMono = tweetRepository.save(originTweet);\n\n\t\tStepVerifier.create(tweetMono).assertNext(createdTweet -> {\n\t\t\tAssert.assertNotNull(createdTweet);\n\t\t\tAssert.assertNotNull(createdTweet.getId());\n\t\t\tAssert.assertNotNull(createdTweet.getText());\n\t\t\tAssert.assertEquals(originTweet.getText(), createdTweet.getText());\n\t\t\tAssert.assertNotNull(createdTweet.getCreatedAt());\n\t\t\tAssert.assertEquals(originTweet.getCreatedAt(), createdTweet.getCreatedAt());\n\n\t\t}).expectComplete().verify();\n\t}\n\n}\n```\n\nEn aquest exemple provem el mètode de guardar tweets de forma reactiva\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtYWx0cmVzL21vZHVsLW1vbmdvLXJlYWN0aXU="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtYWx0cmVzL21vZHVsLWptcw==":{"date":1427973276000,"title":"Cues JMS","description":"Missatgeria estándard JMS","sections":"Canigó. Documentació versió 3.x","weight":2,"path":"/canigo-documentacio-versions-3x-altres/modul-jms","content":"## Propòsit\r\n\r\nEn aquest apartat s'explica de forma senzilla la infraestructura de missatgeria estándard JMS (Java Messaging Service) de J2EE. Aquest estàndar defineix dues modalitats:\r\n\r\n1. Producció de missatges\r\n2. Consum de missatges, que pot ser asíncron.\r\n\r\nEl consum de missatges assíncrons a l'estàndar J2EE es realitza mitjançant \"Message-Driven Beans\".\r\n\r\nCanigó no incorpora cap llibreria addicional a les ja aportades per Spring per lo que aquest apartat estará enfocat com a guia per a simplificar la publicació i consum de missatge.\r\n\r\n## Documents i Fonts de Referència\r\n\r\nReferència | URL\r\n---------- | ---\r\nSpring JMS | http://static.springsource.org/spring/docs/4.1.0.RELEASE/spring-framework-reference/html/jms.html\r\n\r\n## Glossari\r\n\r\n**JMS**\r\n\r\nJMS o Java Message Service es un estàndard de missatgeria que permet als components de les aplicacions basades en la plataforma J2EE, crear, enviar, rebre i llegir missatges de manera sincrona i asincrona.\r\n\r\n**ConnectionFactory**\r\n\r\nFactoria encarregada de crear una connexió al proveidor del sistema de missatges.\r\n\r\n**Destination**\r\n\r\nPunts de destí dels missatges que s'envien.\r\n\r\n## Descripció detallada\r\n\r\n### Missatgeria Publicació/Subscripció\r\n\r\nLa missatgeria de publicació/subscripció permet a una aplicació enviar missatges a una o múltiples aplicacions. Aquestes aplicacions envien i reben missatges subscrivint-se a un servidor de missatges a una cua o tòpic determinat.\r\n\r\nHi ha dos tipus de missatge depenent de com es consumeixen:\r\n\r\n* Queue: en el cas d'un missatge enviat a una cua, encara que hi hagi varis subscriptors a aquests missatges, únicament es processarà una única vegada pel primer subscriptor que estigui lliure.\r\n* Topic: en el cas d'un missatge enviat a un tòpic, tots els subscriptors a aquests missatges els processaran.\r\n\r\nEls consumidors d'un missatge poden ser síncrons o asíncrons. En general, els consumidors asíncrons escalen millor i tenen un rendiment superior.\r\n\r\nPer aplicacions que s'executen al costat servidor, gairebé sempre sempre s'utilitzaran consumidors asíncrons. Concretament per aplicacions J2ee es fa mitjançant Message-Driven Beans (MDB's) que són EJB's configurats per escoltar i subscriures a cues o tòpics del servidor d'aplicacions.\r\n\r\nA continuació es destaquen alguns paràmetres de configuració dels missatges JMS que cal tenir en compte en el desenvolupament d'aplicacions que publiquin o consumeixin aquests tipus de missatges.\r\n\r\n### Persistència del missatge\r\n\r\nEls missatges JMS poden ser especificats com a persistents o no-persistents.\r\n\r\n* Un missatge persistent garanteix la seva entrega un i només un cop. El missatge no pot ser perdut degut a una fallida del proveïdor JMS, i no pot ser entregat dos cops. No es considerat enviat el missatge fins que no ha estat persistit (a un fitxer ó a una base de dades).\r\n* Un missatge no-persistent no és emmagatzemat. Està garantit que sigui entregat com a molt un cop, però si hi ha una fallida del proveïdor JMS el missatge pot ser perdut.\r\n\r\nEls missatges persistents tenen pitjor rendiment degut al pas addicional d'haver-se d'escriure en disc o a base de dades. Només es recomana utilitzar missatges persistents pels casos d'ús crítics, on no es pot permetre la pèrdua del missatge (p.ex. una trasacció bancària, ...).\r\n\r\n### Destinacions distribuïdes\r\n\r\nUna destinació distribuïda és un conjunt de destinacions que són accessibles com a una única destinació lògica al client. Disposen d'una sola adreça JNDI, i els membres d'aquest conjunt normalment són distribuïts pels membres d'un cluster, on cada destinació pertany a un servidor JMS separat.\r\n\r\nLes aplicacions que usen destinacions distribuïdes tenen més disponibilitat respecte a les tradicionals, ja que els servidor (Weblogic) proporciona balanceig de càrrega i tolerància a fallades pels membres d'una destinació distribuïda en un cluster.\r\n\r\nPer tant, es recomana l'ús de destinacions distribuïdes sempre que les aplicacions publicadores/consumidores es desplegin en un cluster de Weblogic.\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer tal d'instal- lar Quartz es necessari afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<org.opensymphony.quartz.version>2.2.1</org.opensymphony.quartz.version>\r\n<commons.collections.version>4.0</commons.collections.version>\r\n<org.springframework.version>4.1.0.RELEASE</org.springframework.version>\r\n\r\n<dependency>\r\n\t<groupId>org.springframework</groupId>\r\n\t<artifactId>org.springframework.jms</artifactId>\r\n\t<version>$org.springframework.version}</version>\r\n</dependency>\r\n<dependency>\r\n\t<groupId>javax.jms</groupId>\r\n\t<artifactId>com.springsource.javax.jms</artifactId>\r\n\t<version>1.1.0</version>\r\n</dependency>\r\n<!-- Active MQ -->\r\n<dependency>\r\n\t<groupId>org.apache.activemq</groupId>\r\n\t<artifactId>com.springsource.org.apache.activemq</artifactId>\r\n\t<version>5.3.0</version>\r\n</dependency>\r\n<dependency>\r\n\t<groupId>org.apache.xbean</groupId>\r\n\t<artifactId>com.springsource.org.apache.xbean.spring</artifactId>\r\n\t<version>3.6.0</version>\r\n</dependency>\r\n<dependency>\r\n\t<groupId>org.apache.geronimo.specs</groupId>\r\n\t<artifactId>com.springsource.javax.management.j2ee</artifactId>\r\n\t<version>1.0.1</version>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració del servei de cues el podriem dividir en els següents punts:\r\n\r\n* Configuració de la infraestructura\r\n* Configuració del productor\r\n* Configuració del consumidor\r\n* Externalització de les propietats d'aquests beans\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/spring/jms-config.xml\r\n\r\nConfiguració dels arxius de propietats\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/config/props/jms.properties\r\n\r\nDins d'aquest arxiu romandrien les propietats per a la gestió de la invocació:\r\n\r\nExemple d'arxiu de propietats:\r\n\r\n```\r\n*.jms.physicalNameDestination=cat.gencat.cttit.jms.test\r\n*.jms.acknowledge=auto\r\n*.jms.uri=tcp://localhost:0\r\n``\r\n\r\n\r\n## Utilització del Mòdul\r\n\r\nEn aquest exemple es configurarà:\r\n\r\n* Arxiu de configuració de Spring per a la càrrega de beans implicats en l'enviament i consum de missatges JMS.\r\n* Arxiu de propietats de configuració.\r\n* Productor de missatges.\r\n* Listener/consumidor de missatges.\r\n* Classe de Test per certificar el se funcionament.\r\n\r\n**jms-config.xml**\r\n\r\n```\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\r\n       xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n       xmlns:p=\"http://www.springframework.org/schema/p\"\r\n       xmlns:context=\"http://www.springframework.org/schema/context\"\r\n       xmlns:jms=\"http://www.springframework.org/schema/jms\"\r\n       xmlns:amq=\"http://activemq.apache.org/schema/core\"\r\n       xsi:schemaLocation=\"http://www.springframework.org/schema/beans\r\n                           http://www.springframework.org/schema/beans/spring-beans.xsd\r\n                           http://www.springframework.org/schema/context\r\n                           http://www.springframework.org/schema/context/spring-context.xsd\r\n                           http://www.springframework.org/schema/jms\r\n                           http://www.springframework.org/schema/jms/spring-jms.xsd\r\n                           http://activemq.apache.org/schema/core\r\n                           http://activemq.apache.org/schema/core/activemq-core.xsd\">\r\n\r\n    <context:component-scan base-package=\"cat.gencat.ctti.testing.jms\" />\r\n\r\n    <!--  ActiveMQ Broker Embegut -->\r\n    <amq:broker id=\"broker\" useJmx=\"false\" persistent=\"false\">\r\n        <amq:transportConnectors>\r\n            <amq:transportConnector uri=\"${jms.uri}\" />\r\n        </amq:transportConnectors>\r\n    </amq:broker>\r\n\r\n    <!--  ActiveMQ Destination  -->\r\n    <amq:queue id=\"destination\" physicalName=\"${jms.physicalNameDestination}\" />\r\n\r\n    <!-- JMS ConnectionFactory al broker embegut -->\r\n    <amq:connectionFactory id=\"jmsFactory\" brokerURL=\"${jms.brokerURL}\" />\r\n\r\n    <!-- Configuració del productor -->\r\n    <bean id=\"jmsProducerConnectionFactory\"\r\n          class=\"org.springframework.jms.connection.SingleConnectionFactory\"\r\n          depends-on=\"broker\"\r\n          p:targetConnectionFactory-ref=\"jmsFactory\" />\r\n\r\n    <bean id=\"jmsProducerTemplate\" class=\"org.springframework.jms.core.JmsTemplate\"\r\n          p:connectionFactory-ref=\"jmsProducerConnectionFactory\"\r\n          p:defaultDestination-ref=\"destination\" />\r\n\r\n    <!-- Configuració del consumidor -->\r\n    <bean id=\"jmsConsumerConnectionFactory\"\r\n          class=\"org.springframework.jms.connection.SingleConnectionFactory\"\r\n          depends-on=\"broker\"\r\n          p:targetConnectionFactory-ref=\"jmsFactory\" />\r\n\r\n    <jms:listener-container container-type=\"default\"\r\n                            connection-factory=\"jmsConsumerConnectionFactory\"\r\n                            acknowledge=\"${jms.acknowledge}\">\r\n        <jms:listener destination=\"org.springbyexample.jms.test\" ref=\"jmsMessageListener\" />\r\n    </jms:listener-container>\r\n\r\n    <!-- Contador per al consumidor i la clase de test per verificar el número de missatges enviats -->\r\n    <bean id=\"counter\" class=\"java.util.concurrent.atomic.AtomicInteger\" />\r\n\r\n</beans>\r\n```\r\n\r\n<div class=\"message information\">\r\nEn aquest cas s'ha fet servir un servidor ActiveMQ embegut que Spring s'encarrega de aixecar. En el cas d'apuntar a un servidor remot, s'hauria d'eliminar les referències a aquest i apuntar al nou broker.\r\n</div>\r\n\r\n\r\nDestacar que els beans del consumidor i productor han de'estar al package \"cat.gencat.ctti.testing.jms\" perque component-scan aixequi de manera automàtica els beans de Spring.\r\n\r\n**jms.properties**\r\n\r\n```\r\n*.jms.physicalNameDestination=cat.gencat.cttit.jms.test\r\n*.jms.acknowledge=auto\r\n*.jms.uri=tcp://localhost:0\r\n*.jms.brokerURL=vm://localhost\r\n```\r\n\r\n**JmsMessageProducer.java**\r\n\r\n```java\r\n@Component\r\npublic class JmsMessageProducer {\r\n\r\n    private static final Log logger = LogFactory.getLog(JmsMessageProducer.class);\r\n\r\n    protected static final String MESSAGE_COUNT = \"messageCount\";\r\n\r\n    @Autowired\r\n    private JmsTemplate template = null;\r\n    private int messageCount = 100;\r\n\r\n    /**\r\n     * Generació dels missatges\r\n     */\r\n    @PostConstruct\r\n    public void generateMessages() throws JMSException {\r\n        for (int i = 0; i < messageCount; i++) {\r\n            final int index = i;\r\n            final String text = \"Message number is \" + i + \".\";\r\n\r\n            template.send(new MessageCreator() {\r\n                public Message createMessage(Session session) throws JMSException {\r\n                    TextMessage message = session.createTextMessage(text);\r\n                    message.setIntProperty(MESSAGE_COUNT, index);\r\n                    logger.info(\"Sending message: \" + text);\r\n                    return message;\r\n                }\r\n            });\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nL'annotació PostConstruct fa que el métode generateMessage s'executi un cop Spring instanciï/creï el bean **JmsMessageProducer**.\r\n\r\n**JmsMessageListener.java**\r\n\r\n```java\r\n@Component\r\npublic class JmsMessageListener implements MessageListener {\r\n\r\n    private static final Log logger = LogFactory.getLog(JmsMessageListener.class);\r\n\r\n    @Autowired\r\n    private AtomicInteger counter = null;\r\n\r\n    /**\r\n     * Implementació de <code>MessageListener</code>.\r\n     */\r\n    public void onMessage(Message message) {\r\n        try {\r\n            int messageCount = message.getIntProperty(JmsMessageProducer.MESSAGE_COUNT);\r\n\r\n            if (message instanceof TextMessage) {\r\n                TextMessage tm = (TextMessage)message;\r\n                String msg = tm.getText();\r\n                logger.info(\"Processed message '\" + msg + \"'.  value=\" + messageCount);\r\n                counter.incrementAndGet();\r\n            }\r\n        } catch (JMSException e) {\r\n            logger.error(e.getMessage(), e);\r\n        }\r\n    }\r\n\r\n}\r\n```\r\n\r\nConsumim asincronament els missatges que el productor ha anat enviat a la cua.\r\n\r\n**JmsMessageListenerTest.java**\r\n\r\n```java\r\n@RunWith(SpringJUnit4ClassRunner.class)\r\n@ContextConfiguration(locations = {\"jms-config.xml\"})\r\npublic class JmsMessageListenerTest {\r\n\r\n    private static final Log logger = LogFactory.getLog(JmsMessageListenerTest.class);\r\n\r\n    @Autowired\r\n    private AtomicInteger counter = null;\r\n\r\n    @Test\r\n    public void testMessage() throws Exception {\r\n        assertNotNull(\"Counter is null.\", counter);\r\n        int expectedCount = 100;\r\n        logger.info(\"Testing...\");\r\n        // Esperem que el listener processi tots els missatges\r\n        Thread.sleep(2 * 1000);\r\n        assertEquals(\"Message is not '\" + expectedCount + \"'.\", expectedCount, counter.get());\r\n    }\r\n\r\n}\r\n```\r\n\r\nEns assegurem que el contador ha arribat a 100, lo que asegura que el consumidor ha rebut els 100 missatges del productor.","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtYWx0cmVzL21vZHVsLWptcw=="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtYWx0cmVzL21vZHVsLXdlYkZsdXg=":{"date":1553040000000,"title":"WebFlux","description":"Com configurar aplicació Canigó 3.4 per utilitzar WebFlux","sections":"Canigó. Documentació versió 3.x","weight":5,"key":"ABRIL2019","path":"/canigo-documentacio-versions-3x-altres/modul-webFlux","content":"## Propòsit\n\nEl propòsit d’aquest apartat és introduïr al desenvolupador la programació amb WebFlux\n\n## Versió de Canigó\n\nEls passos descrits en aquest document apliquen a la versió 3.4 del Framework Canigó\n\n## Introducció\n\nEl mes de Març del 2019 s'ha publicat la versió 3.4 del Framework Canigó. Aquesta versió incorpora la possibilitat d'utilitzar les funcionalitats de WebFlux\n\nPer a passar una aplicació 3.3 a 3.4 hi ha disponible la següent guia [\"Actualització Canigó 3.3 a Canigó 3.4\"](/howtos/2019-03-Howto-Actualitzacio_Canigo3_3_Canigo3_4)\n\nL'objectiu d'aquesta guia és mostrar els procediments necessaris poder utilitzar les funcionalitats WebFlux sobre un repositori reactiu amb Mongodb. El punt de partida d'aquesta guia és una aplicació creada amb el plugin de Canigó per Eclipse i actualitzada a la versió 3.4.0 de Canigó.\n\n### Introducció WebFlux\n\nLa programació funcional va néixer per poder proporcionar un desenvolupament orientat a l'aplicació de funcions declarades\n\nSpring WebFlux proporciona endpoints web de forma funcional a més dels controlladors tradicionals, proporcionant un lleuger model de programació funcional on les funcions són utilitzades per enrutar i capturar peticions a més de la tradicional programació imperativa\n\nA la següent imatge es pot observar la comparativa de funcionalitats entre Spring MVC i Spring WebFlux\n\n![Spring MVC Webflux Venn](https://docs.spring.io/spring-framework/docs/5.1.5.RELEASE/spring-framework-reference/images/spring-mvc-and-webflux-venn.png)\n\nPer a poder utilitzar WebFlux és necessari utilitzar un contenidor d'aplicacions que suporti Servlet 3.1+\n\nSpring WebFlux està suportat a Tomcat, Jetty, Netty, Undertow i contenidors Servlet 3.1+\n\nEl quadre següent mostra les funcionalitats que utilitza WebFlux dels servidors d'aplicacions:\n\n|     \tServidor \t\t\t\t\t\t\t\t\t\t\t\t|      \t\t\t\tApi utilitzada\t\t\t\t\t    \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t \t\t\t\t\t\t\t\t\t\t|\n|--------------------------------- \t\t\t|----------------------------------------------------------------------------------------\t\t\t\t|\n|  Netty\t\t\t\t\t          \t  \t \t\t\t|         Netty API\t             \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|\n|  Undertow\t\t\t\t          \t  \t \t\t\t|         Undertow API         \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|\n|  Tomcat\t\t\t  \t\t        \t  \t \t\t\t|         Servlet 3.1 non-blocking I/O; Tomcat API per escriure i llegir ByteBuffers vs byte[]\t|\n|  Jetty\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|         Servlet 3.1 non-blocking I/O; Jetty API per escriure ByteBuffers vs byte[]\t\t\t\t\t\t|\n|  Contenidor amb suport Servlet 3.1+ \t|         Servlet 3.1 non-blocking I/O       \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|\n\nPer a més informació sobre programació funcional amb Spring 5 podeu consultar:\nhttps://docs.spring.io/spring-framework/docs/5.1.5.RELEASE/spring-framework-reference/web-reactive.html#webflux-fn\n\n### Spring MVC o WebFlux\n\nEls següents punts són un resum dels punts que s'han de tenir en compte a l'hora de decidir-se per utilitzar Spring MVC o WebFlux en una aplicació:\n\n- Si l'aplicació amb Spring MVC funciona correctament, no hi ha necessitat de canvi\n\n- Si necessites un web stack amb non-blocking, Spring WebFlux et proporcionarà el màxim de funcionalitats reactives\n\n- Si necessites una aplicació el més lleugera possible, amb programació web funcional i utilització de lambdas de Java 8, Spring WebFlux et proporcionarà endpoint web funcionals\n\n- Si l'aplicació utilitza apis de persistència bloquejants (JPA, JDBC) o apis externes bloquejants, Spring MVC és la millor solució\n\n- Encara que la teva aplicació hagi de ser amb Spring MVC, els controlladors de Spring MVC poden cridar a altres components reactius com serveis remots o repositoris de dades no bloquejants\n\nSi teniu dubtes a l'hora de decidir-vos utilitzar Spring MVC o WebFlux, no dubteu en posar-vos en contacte amb el CS Canigó al servei CAN del JIRA CSTD o enviant-nos un mail a la bústia del CS Canigó\n\n### Introducció cas d'exemple\n\nPer il·lustrar aquesta guia utilitzarem un repositori de dades on hi contindrà missatges homòlegs a un tweet, on tindrà un id, un text i una data de creació\n\nPel repositori de dades utilitzarem una base de dades Mongodb\n\nEn l'exemple exposarem un CRUD de serveis rest sobre l'entitat tweet i exposarem 2 serveis rest de tipus stream utilitzant controllers per l'exposició dels serveis en el path \"/tweets\" \n\nPer mostrar la forma de programació web funcional exposarem 2 dels serveis del CRUD anterior (obtenir tots els tweets i obtenir un tweet pel seu id ) mitjançant la definició de l'enrutament directament a les \"RouterFuntions\" en el path \"/route-flux/tweets\" i exposarem aquests mateixos serveis mitjançant \"Handlers\" en l'enrutament de les \"RouterFuntions\" en el path \"/handler-flux/tweets\"\n\n## Exemple\n\nPer l'exemple utilitzarem una base de dades Mongodb en local al port 27017 amb una base de dades amb nom \"canigo_persistence_mongo\"\n\nComençarem incorporant el starter de Spring Boot per WebFlux\n\n```xml\n\t\t<dependency>\n\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t<artifactId>spring-boot-starter-webflux</artifactId>\n\t\t\t<exclusions>\n\t\t\t\t<exclusion>\n\t\t\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t\t\t<artifactId>spring-boot-starter-logging</artifactId>\n\t\t\t\t</exclusion>\n\t\t\t</exclusions>\n\t\t</dependency>\n```\n\nEnlloc de:\n```xml\n\t\t<dependency>\n\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t<artifactId>spring-boot-starter-web</artifactId>\n\t\t\t<exclusions>\n\t\t\t\t<exclusion>\n\t\t\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t\t\t<artifactId>spring-boot-starter-logging</artifactId>\n\t\t\t\t</exclusion>\n\t\t\t</exclusions>\n\t\t</dependency>\n```\n\nActualment els mòduls \"canigo.web.core\", \"canigo.web.rs\" i \"canigo.operation.logging\" estan desenvolupats sobre Spring MVC. WebFlux i Spring MVC son dos desenvolupaments separts, per tant, necessitarem eliminar les dependències a aquests mòduls\n\nAfegirem les dependències de Mongodb\n\n```xml\n\t\t<dependency>\n\t\t\t<groupId>cat.gencat.ctti</groupId>\n\t\t\t<artifactId>canigo.persistence.mongodb</artifactId>\n\t\t\t<version>${canigo.persistence.mongodb.version}</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t<artifactId>spring-boot-starter-data-mongodb-reactive</artifactId>\n\t\t\t<exclusions>\n\t\t\t\t<exclusion>\n\t\t\t\t\t<artifactId>spring-boot-starter-logging</artifactId>\n\t\t\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t\t</exclusion>\n\t\t\t</exclusions>\n```\n\nEn aquest cas, com que utilitzarem alguna funcionalitat de reactiu, necessitem incorporar la dependència de Mongo reactive de Spring Boot\n\nPer a més informació sobre utilització de mongo reactiu podeu consular la guia d'[Utilització de mongo reactiu](/canigo-documentacio-versions-3x-altres/Mongo_reactiu)\n\nAfegirem la propietat per la connexió a Mongodb\n```properties\n*.mongodb.uri=mongodb://127.0.0.1:27017/canigo_persistence_mongo?socketTimeoutMS=5000\n```\n\nNecessitem crear un configurador que extengui de *cat.gencat.ctti.canigo.arch.persistence.mongodb.config.ReactiveMongoCoreConfig* que crearà la connexió a la base de dades Mongodb a partir del String de connexió, un exemple de configurador podria ser:\n\n```java\nimport org.springframework.context.annotation.Configuration;\n\nimport cat.gencat.ctti.canigo.arch.persistence.mongodb.config.ReactiveMongoCoreConfig;\n\n@Configuration\npublic class ReactiveMongoConfig extends ReactiveMongoCoreConfig {\n\n\n}\n```\n\nCrearem el repository de l'entitat Tweet, utilitzarem les funcionalitats que aporta Spring per a repositoris reactius amb Mongo amb ReactiveMongoRepository\n\n```java\nimport org.springframework.data.mongodb.repository.ReactiveMongoRepository;\nimport org.springframework.data.mongodb.repository.Tailable;\nimport org.springframework.stereotype.Repository;\n\nimport cat.gencat.ctti.model.Tweet;\nimport reactor.core.publisher.Flux;\n\n@Repository\npublic interface TweetRepository extends ReactiveMongoRepository<Tweet, String> {\n\t\n\t@Tailable\n\tFlux<Tweet> findTweetsBy();\n\n}\n```\n\nHem definit un mètode de consulta de tweets de tipus \"Tailable\" per mantenir la connectivitat esperant a nous tweets\n\nPer a utilitzar aquest mètode la collection de Mongo ha de ser de tipus capped. Si la collection és de tipus capped no es pot utilitzar la funcionalitat d'eliminació d'elements. Si s'utilitza tailable a una collection no capped o s'eliminen elements a una collection capped s'obtindrà un error. Per tenir un exemple complet exposarem un servei utilitzant tailable i un servei d'eliminació d'elements però en un cas real no podrien conviure a la mateixa collection\n\nPer simplificar l'exemple utilitzarem directament el repositori al controller, recomanem, però, utilitzar la capa service entre els controllers i els repositoris\n\n```java\nimport javax.validation.Valid;\n\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.http.HttpStatus;\nimport org.springframework.http.MediaType;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.web.bind.annotation.DeleteMapping;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.PathVariable;\nimport org.springframework.web.bind.annotation.PostMapping;\nimport org.springframework.web.bind.annotation.PutMapping;\nimport org.springframework.web.bind.annotation.RequestBody;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\nimport cat.gencat.ctti.model.Tweet;\nimport cat.gencat.ctti.repository.TweetRepository;\nimport reactor.core.publisher.Flux;\nimport reactor.core.publisher.Mono;\n\n@RestController\n@RequestMapping(\"/tweets\")\npublic class TweetController {\n\n    @Autowired\n    private TweetRepository tweetRepository;\n\n    @GetMapping\n    public Flux<Tweet> getAllTweets() {\n        return tweetRepository.findAll();\n    }\n\n    @PostMapping\n    public Mono<Tweet> createTweets(@Valid @RequestBody Tweet tweet) {\n        return tweetRepository.save(tweet);\n    }\n\n    @GetMapping(\"/{id}\")\n    public Mono<ResponseEntity<Tweet>> getTweetById(@PathVariable(value = \"id\") String tweetId) {\n        return tweetRepository.findById(tweetId)\n                .map(savedTweet -> ResponseEntity.ok(savedTweet))\n                .defaultIfEmpty(ResponseEntity.notFound().build());\n    }\n\n    @PutMapping(\"/{id}\")\n    public Mono<ResponseEntity<Tweet>> updateTweet(@PathVariable(value = \"id\") String tweetId,\n                                                   @Valid @RequestBody Tweet tweet) {\n        return tweetRepository.findById(tweetId)\n                .flatMap(existingTweet -> {\n                    existingTweet.setText(tweet.getText());\n                    return tweetRepository.save(existingTweet);\n                })\n                .map(updateTweet -> new ResponseEntity<>(updateTweet, HttpStatus.OK))\n                .defaultIfEmpty(new ResponseEntity<>(HttpStatus.NOT_FOUND));\n    }\n\n    @DeleteMapping(\"/{id}\")\n    public Mono<ResponseEntity<Void>> deleteTweet(@PathVariable(value = \"id\") String tweetId) {\n\n        return tweetRepository.findById(tweetId)\n                .flatMap(existingTweet ->\n                        tweetRepository.delete(existingTweet)\n                            .then(Mono.just(new ResponseEntity<Void>(HttpStatus.OK)))\n                )\n                .defaultIfEmpty(new ResponseEntity<>(HttpStatus.NOT_FOUND));\n    }\n\n    // Tweets are Sent to the client as Server Sent Events\n    @GetMapping(value = \"/event-stream\", produces = MediaType.TEXT_EVENT_STREAM_VALUE)\n    public Flux<Tweet> eventStreamTweets() {\n        return tweetRepository.findTweetsBy();\n    }\n    \n    // Tweets are Sent to the client as stream json\n    @GetMapping(path = \"/stream-json\", produces = MediaType.APPLICATION_STREAM_JSON_VALUE)\n    public Flux<Tweet> streamJsonTweets() {\n        return tweetRepository.findTweetsBy();\n    }\n\n}\n```\n\nEn aquest controller exposem un CRUD de serveis rest sobre el path \"/tweets\" i dos serveis en stream: \"/tweets/event-stream\" per enviar tweets produint \"text/event-stream\" i \"/tweets/stream-json\" per enviar tweets produint \"application/stream+json\" per simular un efecte de tipus timeline\n\n### Exposició serveis mitjançant definició de l'enrutament a les \"RouterFuntions\" \n\nPer a la definició els serveis amb programacio web funcional necessitem definit les \"RouterFunctions\", en aquest cas definirem les \"RouterFunctions\" directament a la seva definició\n\nPer això definirem un \"Configuration\" amb la definició dels dos serveis web, un exemple seria:\n\n```java\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.web.reactive.function.server.RequestPredicates;\nimport org.springframework.web.reactive.function.server.RouterFunction;\nimport org.springframework.web.reactive.function.server.RouterFunctions;\nimport org.springframework.web.reactive.function.server.ServerResponse;\n\nimport cat.gencat.ctti.model.Tweet;\nimport cat.gencat.ctti.repository.TweetRepository;\n\n@Configuration\npublic class TweetRouteRouterFuntionConfig {\n\n\t@Bean\n\tRouterFunction<ServerResponse> routeFluxRouterFunction(TweetRepository tweetRepository) {\n\t\treturn RouterFunctions\n\t\t\t\t.route(RequestPredicates.GET(\"/route-flux/tweets\"),\n\t\t\t\t\t\tserverRequest -> ServerResponse.ok().body(tweetRepository.findAll(), Tweet.class))\n\t\t\t\t.andRoute(RequestPredicates.GET(\"/route-flux/tweets/{id}\"), serverRequest -> ServerResponse.ok()\n\t\t\t\t\t\t.body(tweetRepository.findById(serverRequest.pathVariable(\"id\")), Tweet.class));\n\t}\n\t\n}\n```\n\nOn s'utilitza les \"FunctionalInterface\" i lambdas de Java per determinar quin mètode del repositori s'utilitza per cada una de les rutes definides\n\n### Exposició serveis mitjançant \"Handlers\" en l'enrutament de les \"RouterFuntions\"\n\nEn aquest cas utilitzarem \"Handlers\" en l'enrutament de les \"RouterFunctions\", per separar l'enrutament de la lògica de dins de l'enrutament\n\nPer això definirem un \"Configuration\" amb la definició dels dos serveis web, un exemple seria:\n\n```java\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.stereotype.Component;\nimport org.springframework.web.reactive.function.server.RequestPredicates;\nimport org.springframework.web.reactive.function.server.RouterFunction;\nimport org.springframework.web.reactive.function.server.RouterFunctions;\nimport org.springframework.web.reactive.function.server.ServerRequest;\nimport org.springframework.web.reactive.function.server.ServerResponse;\n\nimport cat.gencat.ctti.model.Tweet;\nimport cat.gencat.ctti.repository.TweetRepository;\nimport reactor.core.publisher.Mono;\n\n@Configuration\npublic class TweetHandlerRouterFuntionConfig {\n\n\t@Bean\n\tRouterFunction<ServerResponse> handlerFluxRouterFunction(TweetHandler tweetHandler) {\n\t\treturn RouterFunctions\n\t\t\t\t.route(RequestPredicates.GET(\"/handler-flux/tweets\"), tweetHandler::getAllTweets)\n\t\t\t\t.andRoute(RequestPredicates.GET(\"/handler-flux/tweets/{id}\"), tweetHandler::getTweetById);\n\t}\n\n}\n\n@Component\nclass TweetHandler {\n\n\t@Autowired\n\tprivate TweetRepository tweetRepository;\n\n\tpublic Mono<ServerResponse> getAllTweets(ServerRequest serverRequest) {\n\t\treturn ServerResponse.ok().body(tweetRepository.findAll(), Tweet.class);\n\t}\n\n\tpublic Mono<ServerResponse> getTweetById(ServerRequest serverRequest) {\n\t\treturn ServerResponse.ok().body(tweetRepository.findById(serverRequest.pathVariable(\"id\")), Tweet.class);\n\t}\n\n}\n```\n\nOn s'utilitza les \"FunctionalInterface\" de Java per determinar quin mètode s'utilitza de la classe \"Handler\" intern \"TweetHandler\"\n\n## Test serveis rest\n\nSi provem els serveis web:\n- /tweets\n- /route-flux/tweets\n- /handler-flux/tweets\n\nPer exemple, per provar el servei \"/tweets\":\n```\ncurl -X POST \\\n  http://localhost:8080/tweets \\\n  -H 'Content-Type: application/json' \\\n  -d '{\"text\":\"Hello, World!\"}'\n```\n  \ni els serveis web:\n- /tweets/{id}\n- /route-flux/tweets/{id}\n- /handler-flux/tweets/{id}\n\nPer exemple, per provar el servei \"/tweets/{id}\":\n```\ncurl -X GET \\\n  http://localhost:8080/tweets/99 \n```\n\nPodrem observar que retornen la mateixa informació\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtYWx0cmVzL21vZHVsLXdlYkZsdXg="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtYWx0cmVzL21vZHVsLXByb3Zlcw==":{"date":1427978212000,"title":"Proves","description":"Proves unitàries","sections":"Canigó. Documentació versió 3.x","weight":4,"path":"/canigo-documentacio-versions-3x-altres/modul-proves","content":"## Propòsit\r\n\r\nLes proves son una part fonamental en el desenvolupament d'aplicacions, en aquest apartat es focalitza en com realitzar proves unitàries dels diferents mòduls de l'aplicació mitjançant Spring Test.\r\n\r\nA l'utilitzar injecció de dependència, això fa que el codi sigui menys dependent del que ho seria en un desenvolupament java tradicional i per tant realitzar proves unitàries de diferents parts de mòduls sense tenir el conjunt complert hauria de ser més senzill.\r\n\r\n## Documents i Fonts de Referència\r\n\r\nReferència | URL\r\n---------- | ---\r\nSpring Test | http://docs.spring.io/spring/docs/4.1.x/spring-framework-reference/html/testing.html\r\n\r\n## Glossari\r\n\r\n**@RunWith** - Anotació a nivell de classe per indicar amb que s'executarà la classe de test.\r\n**@ContextConfiguration** - Anotació a nivell de classe per a carregar el context d'Spring.\r\n**@Before** - Anotació a nivell de mètode per indicar quin és el mètode d'inicialització de la classe de test.\r\n**@Test** - Anotació a nivell de mètode per indicar que el mètode és de test.\r\n**@Autowired** - Anotació a nivell de propietat o mètode per a indicar que la propietat de la classe es carregui automàticament amb el bean del context d'spring.\r\n**@Qualifier** - Anotació a nivell de propietat o mètode que s'utilitza quan s'ha indicat un @Autowired i al context d'spring existeixen més d'un bean del mateix tipus del que s'ha de realitzar l'autowired, aleshores d'indica el @Qualifier per indicar a Spring el nom del bean que ha de setejar.\r\n\r\n## Instal.lació\r\n\r\nUtilitzant Canigó3 on cal realitzar cap pas addicional per a tenir instal- lat el mòdul de testing d'Spring. Ja que el framework ja incorpora la dependència.\r\n\r\n**Dependència pom.xml**\r\n\r\nPer defecte canigó3 incorpora la dependència d'Spring Test en scope test, aquesta dependència la incorpora canigo-core de la següent manera:\r\n\r\n```\r\n<dependency>\r\n\t<groupId>org.springframework</groupId>\r\n\t<artifactId>spring-test</artifactId>\r\n\t<version>${org.springframework.version}</version>\r\n\t<scope>test</scope>\r\n</dependency>\r\n```\r\n\r\n## Utilització\r\n\r\n### Definició classe de test\r\n\r\nPer a crear una classe de test simplement s'ha de crear una classe de Java tradicional i afegir la següent anotació @RunWith (org.junit.runner.RunWith) per a que spring detecti que és una classe de test.\r\n\r\n```\r\nimport org.springframework.test.context.junit4.SpringJUnit4ClassRunner;\r\n\r\n...\r\n\r\n@RunWith(SpringJUnit4ClassRunner.class)\r\n```\r\n\r\n### Càrrega del context de l'aplicació\r\n\r\nPer a carregar el context de l'aplicació s'utilitzarà l'anotació @ContextConfiguration (org.springframework.test.context.ContextConfiguration) a nivell de classe.\r\n\r\nEs pot carregar el context de canigo-core que carregarà tot el framework:\r\n\r\n```\r\n@ContextConfiguration(locations = {\"../../../core/config/canigo-core.xml\"})\r\n```\r\n\r\n\r\nal carregar el context de canigó serà necessari indicar els fitxers xml app-custom-***.xml dintre del directori spring i els fitxers de propietats d'aquest fitxer xml dintre del directori config, tal i com es te a l'aplicació.\r\n\r\no be només carregar els beans que es troben en certs fitxers xml:\r\n\r\n```\r\n@ContextConfiguration(locations = {\"config/canigo-support-mailing.xml\", \"config/app-support-mailing.xml\"})\r\n```\r\n\r\n### Mètodes de setUp\r\n\r\nPer indicar el mètode de setUp del test cal fer-ho mitjançant l'anotació @Before (org.junit.Before) a nivell de mètode.\r\n\r\nEn aquest mètode es realitzaran les inicialitzacions necessàries per a poder executar els mètodes de test de la classe.\r\n\r\n```java\r\n@Autowired\r\n@Qualifier(\"accountDAO\")\r\nAccountDAO<Account, Integer> dao = null;\r\n\r\n...\r\n\r\n@Before\r\npublic void settingUp(){\r\n\tAssert.assertNotNull(dao);\r\n\tAssert.assertEquals(Account.class, dao.getPersistentClass());\r\n}\r\n```\r\n\r\n### Mètodes de test\r\n\r\nPer indicar que un mètode és de test cal fer-ho mitjançant l'anotació @Test (org.junit.Test) a nivell de mètode.\r\n\r\n```java\r\n@Test\r\npublic void testFinder(){\t\t\r\n\tAssert.assertNull(dao.get(1));\r\n\tAccount account = new Account();\r\n\taccount.setName(\"test1\");\r\n\tdao.save(account);\r\n\t\r\n\tAssert.assertNotNull(dao.get(account.getId()));\r\n\t\r\n\tAccount account2 = new Account();\r\n\taccount2.setName(\"test2\");\r\n\tdao.save(account2);\r\n\t\r\n\tList<Account> accounts = dao.findAll();\r\n\tAssert.assertEquals(5, accounts.size());\r\n}\r\n```\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtYWx0cmVzL21vZHVsLXByb3Zlcw=="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtYWx0cmVzL21vZHVsLXBsYW5pZmljYWRvcg==":{"date":1427971783000,"title":"Planificador de tasques","description":"Planificador de tasques","sections":"Canigó. Documentació versió 3.x","weight":1,"path":"/canigo-documentacio-versions-3x-altres/modul-planificador","content":"## Propòsit\r\n\r\nEl propòsit d'aquest apartat es introduir al desenvolupador a la planificació de tasques mitjançant Quartz.\r\n\r\nQuartz permet l'execució de tasques de forma diferida:\r\n\r\n* en qualsevol moment del dia (precisió de milisegons)\r\n* en alguns dies de la setmana\r\n* en alguns dies del mes\r\n* en alguns dies de l'any\r\n* un número específic de repeticions\r\n* repetidament fins a una data/instant determinat\r\n* repetida e indefinidament\r\n* repetidament en un determinat interval de temps\r\n\r\nDocuments i Fonts de Referència\r\n\r\nReferència                       | URL\r\n-------------------------------- | ----\r\nQuartz                           | http://www.quartz-scheduler.org/\r\nSpring 4 + Quartz                | http://static.springsource.org/spring/docs/4.1.0.RELEASE/spring-framework-reference/html/scheduling.html#scheduling-quartz\r\nGuia migració Quartz 1.8.x a 2.0 | http://www.quartz-scheduler.org/documentation/quartz-2.x/migration-guide\r\n\r\n## Glossari\r\n\r\n**Job**\r\n\r\nUn Job o tasca és simplement la referència a la classe que conté el mètode que volem executar de forma diferida.\r\n\r\n**Trigger**\r\n\r\nUn objecte de tipus Trigger s'utilitza per llençar l'execució dels Jobs o tasques. Quan es vol programar una tasca, s'intancia un Trigger i configures les seves propietats per tal de proporcionar la programació d'execució (interval d'execució, número de repeticions, timeout, etc..).\r\n\r\n**SchedulerFactory**\r\n\r\nObjecte que s'encarrega d'instanciar el programador o scheduler que s'encarregarà de gestionar l'execució de les tasques.\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer tal d'instal-lar Quartz es necessari afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<org.opensymphony.quartz.version>2.2.1</org.opensymphony.quartz.version>\r\n<commons.collections.version>4.0</commons.collections.version>\r\n<org.springframework.versionn>4.1.0.RELEASE</org.springframework.version>\r\n\r\n<dependency>\r\n    <groupId>org.quartz-scheduler</groupId>\r\n    <artifactId>quartz</artifactId>\r\n    <version>${org.opensymphony.quartz.version}</version>\r\n</dependency>\r\n<dependency>\r\n    <groupId>org.springframework</groupId>\r\n    <artifactId>spring-context-support</artifactId>\r\n    <version>${org.springframework.version}</version>\r\n</dependency><!-- Només per clustering Oracle -->\r\n<dependency>\r\n    <groupId>org.quartz-scheduler</groupId>\r\n    <artifactId>quartz-oracle</artifactId>\r\n    <version>${org.opensymphony.quartz.version}</version>\r\n</dependency>\r\n<!-- Només per a Weblogic -->\r\n<dependency>\r\n    <groupId>org.quartz-scheduler</groupId>\r\n    <artifactId>quartz-weblogic</artifactId>\r\n    <version>${org.opensymphony.quartz.version}</version>\r\n</dependency>\r\n<dependency>\r\n\t<groupId>org.apache.commons</groupId>\r\n\t<artifactId>commons-collections4</artifactId>\r\n\t<version>${commons.collections.version}</version>\r\n</dependency>\r\n<dependency>\r\n      <groupId>org.springframework</groupId>\r\n      <artifactId>spring-tx</artifactId>\r\n      <version>${org.springframework.version}</version>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració del servei de planificació de tasques es pot dividir en dos punts:\r\n\r\n* Definició dels xmls (o anotacions) de Spring que s'encarregen de la inicialització dels beans de Quartz.\r\n* Externalització de les propietats d'aquest beans.\r\n    \t\r\n<div class=\"message information\">\r\nIMPORTANT: <br>\r\nPer a entorns clusteritzats revisar l'apartat de Preguntes freqüents.\r\n</div>\r\n\r\n#### Definició dels xmls de Spring\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/spring/quartz-config.xml\r\n\r\nLa configuració del planificador de tasques Quartz implica 3 pasos:\r\n\r\n* Definir les tasques que volem executar de forma diferida\r\n* Definir els triggers que defineixen en quin moment s'executaran les tasques\r\n* Definir la factoria per executar les tasques amb els triggers\r\n\r\n#### Configuració dels arxius de propietats\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/config/props/planificador.properties\r\n\r\nDins d'aquest arxiu romandrien les propietats dels Jobs, Triggers, Scheduler, etc.\r\n\r\nExemple d'arxiu de propietats:\r\n\r\n```\r\n*.quartz.repeatInterval=2000\r\n*.quartz.autoStartup=false\r\n*.quartz.concurrent=true\r\n```\r\n\r\n## Utilització del Mòdul\r\n\r\n\r\nEn aquest exemple es configura una tasca que es repeteix cada dos segons amb el work manager per defecte de Quartz.\r\n\r\n**quartz-config.xml**\r\n\r\n```\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\r\n\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n\txsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.1.xsd\">\r\n\r\n\t<bean id=\"salutacio\" class=\"springapp.web.vo.Salutacio\"/>\r\n\r\n        <bean id=\"unaTasca\"\r\n             class=\"org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean\">\r\n\t\t<property name=\"targetObject\" \tref=\"salutacio\" />\r\n\t\t<property name=\"targetMethod\" \tvalue=\"saludar\" />\r\n\t\t<property name=\"concurrent\" \tvalue=\"${quartz.concurrent}\" />\r\n\t</bean>\r\n\r\n\t<bean id=\"simpleTrigger\" class=\"org.springframework.scheduling.quartz.SimpleTriggerBean\">\r\n\t\t<property name=\"jobDetail\" ref=\"unaTasca\" />\r\n\t\t<property name=\"repeatInterval\" value=\"${quartz.repeatInterval}\" />\r\n\t</bean>\r\n\r\n\t<bean id=\"schedulerFactoryBean\"\r\n             class=\"org.springframework.scheduling.quartz.SchedulerFactoryBean\">\r\n\t\t<property name=\"autoStartup\" value=\"${quartz.autoStartup}\" />\r\n\t\t<property name=\"triggers\">\r\n\t\t\t<list>\r\n\t\t\t\t<ref bean=\"simpleTrigger\" />\r\n\t\t\t</list>\r\n\t\t</property>\r\n\t</bean>\r\n\r\n</beans>\r\n```\r\n\r\n<div class=\"message warning\">\r\nWorkmanager per defecte\r\n\r\nPer defecte de Quartz gestiona l'execució de les tasques amb el seu pròpi workmanager. Aquest motor per defecte s'encarrega de gestionar els diferents \"threads\" o fils d'execució de les tasques planificades de manera autònoma sense que el servidor d'aplicacions tingui constància d'aquests \"threads\" oberts.\r\nEn entorns productius s'ha pogut observar com en algunes situacions el motor no allibera correctament aquests \"threads\" de la VM, lo que pot provocar la degradació del sistema o en el pitjor dels casos, la seva indisponibilitat.\r\n\r\nPer evitar aquest tipus de situacions es recomenable que llegiu l'apartat de Recomanacions.\r\n</div>\r\n\r\n## Recomanacions\r\n\r\nCom a alternativa al workmanager per defecte de \"Quartz\", i amb la idea de que sigui el servidor d'aplicacions qui gestioni els threads de Quartz, a continuació es descriu un exemple de configuració per a utilitzar la implementació de \"Commonj\".\r\n\r\n### Configuració per a servidors d'aplicacions Weblogic\r\n\r\nPer canviar el WorkManager per defecte per el de \"Commonj\" a servidors d'aplicacions Weblogic, es necessari realitzar les següents accions:\r\n\r\n* Modificar el taskexecutor del SchedulerFactoryBean.\r\n* Modificar web.xml per afegir una referència local al \"WorkManager\".\r\n* Modificar weblogic.xml per crear un \"WorkManager\".\r\n\r\n### Modificar el taskexecutor del SchedulerFactoryBean\r\n\r\nPer sobrescriure el \"taskexecutor\" per defecte de \"Quartz\", s'ha de modificar el SchedulerFactoryBean per instanciar el nou \"TaskExecutor\", aquest informarà les següents propietats:\r\n\r\n* workManagerName: Nom JNDI del WorkManager JCA.\r\n* resourceRef: Indica si la cerca del nom JNDI es realitza en un contenidor J2EE.\r\n\r\n```\r\n<!-- Planificador amb l'engine de commonj -->\r\n<bean id=\"schedulerFactoryBeanCommonj\"\r\n      class=\"org.springframework.scheduling.quartz.SchedulerFactoryBean\">\r\n    <property name=\"autoStartup\" value=\"false\" />\r\n    <property name=\"triggers\">\r\n        <list>\r\n            <ref bean=\"simpleTrigger\" />\r\n        </list>\r\n    </property>\r\n    <property name=\"taskExecutor\" ref=\"taskExecutor\"/>\r\n</bean>\r\n<bean id=\"taskExecutor\"\r\n      class=\"org.springframework.scheduling.commonj.WorkManagerTaskExecutor\">\r\n    <property name=\"workManagerName\" value=\"appWorkManager\" />\r\n    <property name=\"resourceRef\" value=\"true\" />\r\n</bean>\r\n```\r\n\r\n### Modificar web.xml per afegir una referència local al \"WorkManager\"\r\n\r\nModificar l'arxiu \"web.xml\" per afegir una referència local al \"WorkManager\" que posteriorment es definirà al \"weblogic.xml\":\r\n\r\n```\r\n...\r\n<resource-ref>\r\n\t<res-ref-name>appWorkManager</res-ref-name>\r\n\t<res-type>commonj.work.WorkManager</res-type>\r\n\t<res-auth>Container</res-auth>\r\n\t<res-sharing-scope>Shareable</res-sharing-scope>\r\n</resource-ref>\r\n...\r\n```\r\n\r\n### Modificar weblogic.xml per crear un \"WorkManager\"\r\n\r\nFinalment cal registrar un \"WorkManager\" aplicatiu al servidor d'aplicacions mitjançant l'arxiu \"weblogic.xml\". En l'exemple es registra un \"WorkManager\" que com a màxim pot executar 3 \"threads\" concurrents.\r\n\r\n```\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<weblogic-web-app xmlns=\"http://www.bea.com/ns/weblogic/90\"\r\n\txmlns:j2ee=\"http://java.sun.com/xml/ns/j2ee\"\r\n\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n\txsi:schemaLocation=\"http://www.bea.com/ns/weblogic/90\r\n                           http://www.bea.com/ns/weblogic/90/weblogic-web-app.xsd\">\r\n\r\n\t<work-manager>\r\n\t\t<name>appWorkManager</name>\r\n\t\t<max-threads-constraint>\r\n\t\t\t<name>appWorkManager</name>\r\n\t\t\t<count>3</count>\r\n\t\t</max-threads-constraint>\r\n\t</work-manager>\r\n</weblogic-web-app>\r\n```\r\n\r\n### Configuració per a servidors d'aplicacions Tomcat\r\n\r\nPer canviar el WorkManager per defecte per el de \"Commonj\" per a servidors d'aplicacions Tomcat es necessari realitzar les següents accions:\r\n\r\n* Afegir les llibreries de Commonj.\r\n* Modificar el taskexecutor del SchedulerFactoryBean.\r\n* Modificar web.xml per afegir una referència local al \"WorkManager\".\r\n* Crear el \"WorkManager\" al context.xml de Tomcat.\r\n\r\n### Afegir les llibreries de Commonj\r\n\r\nCal verificar que les llibreries de Commonj estiguin incloses dins la carpeta de llibreries compartides de Tomcat o bé dins l'aplicació que les farà servir:\r\n\r\n* Si es volen afegir directament com a llibreries compartides de Tomcat, cal afegir a $TOMCAT_HOME/lib les llibreries commonj-twm.jar i foo-commonj-1.1.0.jar . Aquestes es poden trobar dins la carpeta \\foo-commonj-1.1.0\\lib del zip que es pot descarregar de la web oficial\r\n* Si es volen afegir al projecte Canigó3, cal afegir les següents dependències Maven al pom.xml:\r\n\r\n```\r\n<dependency>\r\n    <groupId>com.bea.wlplatform</groupId>\r\n    <artifactId>commonj-twm</artifactId>\r\n    <version>1.1</version>\r\n</dependency>\r\n<dependency>\r\n    <groupId>com.bea.wlplatform</groupId>\r\n    <artifactId>foo-commonj</artifactId>\r\n    <version>1.1.0</version>\r\n</dependency>\r\n```\r\n\r\n### Modificar el taskexecutor del SchedulerFactoryBean\r\n\r\nPer sobrescriure el \"taskexecutor\" per defecte de \"Quartz\", s'ha de modificar el SchedulerFactoryBean per instanciar el nou \"TaskExecutor\", aquest informarà les següents propietats:\r\n\r\n* workManagerName: Nom JNDI del WorkManager JCA.\r\n* resourceRef: Indica si la cerca del nom JNDI es realitza en un contenidor J2EE.\r\n\r\n```\r\n<!-- Planificador amb l'engine de commonj -->\r\n<bean id=\"schedulerFactoryBeanCommonj\"\r\n      class=\"org.springframework.scheduling.quartz.SchedulerFactoryBean\">\r\n    <property name=\"autoStartup\" value=\"false\" />\r\n    <property name=\"triggers\">\r\n        <list>\r\n            <ref bean=\"simpleTrigger\" />\r\n        </list>\r\n    </property>\r\n    <property name=\"taskExecutor\" ref=\"taskExecutor\"/>\r\n</bean>\r\n<bean id=\"taskExecutor\"\r\n      class=\"org.springframework.scheduling.commonj.WorkManagerTaskExecutor\">\r\n    <property name=\"workManagerName\" value=\"wm/appWorkManager\" />\r\n    <property name=\"resourceRef\" value=\"true\" />\r\n</bean>\r\n```\r\n\r\n### Modificar web.xml per afegir una referència local al \"WorkManager\"\r\n\r\nModificar l'arxiu \"web.xml\" per afegir una referència local al \"WorkManager\" que posteriorment es definirà al \"weblogic.xml\":\r\n\r\n```\r\n...\r\n<resource-ref>\r\n\t<res-ref-name>wm/appWorkManager</res-ref-name>\r\n\t<res-type>commonj.work.WorkManager</res-type>\r\n\t<res-auth>Container</res-auth>\r\n\t<res-sharing-scope>Shareable</res-sharing-scope>\r\n</resource-ref>\r\n...\r\n```\r\n\r\n### Crear el \"WorkManager\" al context.xml de Tomcat\r\n\r\nFinalment cal registrar un \"WorkManager\" aplicatiu al servidor d'aplicacions. En aquest cas caldría afegir-ho al fitxer $TOMCAT_HOME/conf/context.xml. En l'exemple es registra un \"WorkManager\" que com a màxim pot executar 3 \"threads\" concurrents.\r\n\r\n```\r\n...\r\n<Resource name=\"wm/appWorkManager\"\r\n\tauth=\"Container\"\r\n\tfactory=\"de.myfoo.commonj.work.FooWorkManagerFactory\" \r\n\ttype=\"commonj.work.WorkManager\"\r\n\tmaxThreads=\"3\"/>\r\n...\r\n```\r\n\r\nAlguns dels paràmetres de configuració i tunning del \"WorkManager\" es poden trobar a la següent adreça:\r\nhttp://download.oracle.com/docs/cd/E11035_01/wls100/config_wls/self_tuned.html\r\n\r\n## Preguntes freqüents\r\n\r\n### Utilització de Quartz en un cluster\r\n\r\nLa principal problemàtica del planificador de tasques en un cluster és l'execució del planificador en cadascuna de les màquines de forma independent. Si l'aplicació es troba en un cluster i no es gestiona aquesta problemàtica, la tasca s'executarà tants cops com nodes al cluster tinguessim.\r\n\r\nPer solventar aquest problema, Quartz proporciona una solució basada en una base de dades centralitzada que funciona com a semàfor d'execució dels diferents Jobs.\r\n\r\n### Configuració\r\n\r\nLa configuració consta de dos passos:\r\n\r\n1. Crear les taules a partir dels scripts proporcionats per Quartz. Els pots trobar al directori: quartz\\docs\\dbTables directory.\r\n2. Crear el arxiu de propietats quartz.properties a l'arrel de l'aplicació. src/main/resources/quartz.properties\r\n\r\n```\r\n#============================================================================\r\n# Configure Main Scheduler Properties\r\n#============================================================================\r\norg.quartz.scheduler.instanceName = MyClusteredScheduler\r\norg.quartz.scheduler.instanceId = AUTO\r\n#============================================================================\r\n# Configure ThreadPool\r\n#============================================================================\r\norg.quartz.threadPool.class = org.quartz.simpl.SimpleThreadPool\r\norg.quartz.threadPool.threadCount = 25\r\norg.quartz.threadPool.threadPriority = 5\r\n#============================================================================\r\n# Configure JobStore\r\n#============================================================================\r\norg.quartz.jobStore.misfireThreshold = 60000\r\norg.quartz.jobStore.class = org.quartz.impl.jdbcjobstore.JobStoreTX\r\norg.quartz.jobStore.driverDelegateClass = org.quartz.impl.jdbcjobstore.oracle.OracleDelegate\r\norg.quartz.jobStore.useProperties = false\r\norg.quartz.jobStore.dataSource = myDS\r\norg.quartz.jobStore.tablePrefix = QRTZ_\r\n\r\norg.quartz.jobStore.isClustered = true\r\norg.quartz.jobStore.clusterCheckinInterval = 20000\r\n#============================================================================\r\n# Configure Datasources\r\n#============================================================================\r\n#org.quartz.dataSource.myDS.driver = oracle.jdbc.driver.OracleDriver\r\n#org.quartz.dataSource.myDS.URL = jdbc:oracle:thin:@localhost:1521:orcl\r\n#org.quartz.dataSource.myDS.user = scott\r\n#org.quartz.dataSource.myDS.password = tiger\r\n#org.quartz.dataSource.myDS.maxConnections = 5\r\n#org.quartz.dataSource.myDS.validationQuery=select 0 from dual\r\n#============================================================================\r\n# Configure Datasources JNDI\r\n#============================================================================\r\norg.quartz.dataSource.myDS.jndiURL=jdbc/myDataSource\r\norg.quartz.dataSource.myDS.java.naming.factory.initial=com.evermind.server.rmi.RMIInitialContextFactory\r\norg.quartz.dataSource.myDS.java.naming.provider.url=ormi://localhost\r\norg.quartz.dataSource.myDS.java.naming.security.principal=admin\r\norg.quartz.dataSource.myDS.java.naming.security.credentials=123\r\n```\r\n\r\nMés informació a:\r\n\r\nhttp://www.quartz-scheduler.org/documentation/quartz-2.x/configuration/ConfigJDBCJobStoreClustering\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtYWx0cmVzL21vZHVsLXBsYW5pZmljYWRvcg=="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtYWx0cmVzL21vZHVsLXdlYnNlcnZpY2Vz":{"date":1526342400000,"title":"Webservices","description":"Webservices","sections":"Canigó. Documentació versió 3.x","weight":3,"path":"/canigo-documentacio-versions-3x-altres/modul-webservices","content":"## Propòsit\r\n\r\nEl propòsit d'aquest apartat es introduir al desenvolupador en la configuració i ús d'una infraestructura de Webservices en dues modalitats:\r\n\r\n* Exportació de serveis Java mitjançant Web Services.\r\n* Importació de Web Services externs, generació si cal de classes Java d'invocació.\r\n\r\nJa que Canigó 3 no disposa d'un servei addicional de Webservices, l'enfocament d'aquest apartat es el de simplificar tant la definició de Web Services a partir de serveis Java simples (que no tindran dependències amb la implementació particular de Web Services) així com la de facilitar la invocació a Web Services externs.\r\n\r\nPer aquesta aproximació s'ha fet servir Spring WS, JAXB i OXM.\r\n\r\n## Context i Escenaris d'Ús\r\n\r\nLa integració de WebServices no es troba ubicat dins del framework de Canigó com a un servei addicional. Ens recolzarem en les classes de Spring WS per a realitzar els exemples d'integració.\r\n\r\n## Documents i Fonts de Referència\r\n\r\nReferència | URL\r\n---------- | ---\r\nSpring Web Services | https://docs.spring.io/spring-ws/docs/2.3.x/reference/html/\r\nOXM | https://docs.spring.io/spring/docs/4.3.x/spring-framework-reference/html/oxm.html\r\n\r\n\r\n## Glossari\r\n\r\n**EndPoint**\r\n\r\nUna interfície endpoint, també coneguda com a interfície de servei endpoint (SEI), és un terme utilitzat en la plataforma J2EE quan s'exposa un Enterprise Java Bean com a servei web. Un client accedeix a partir d'aquesta interfície, que com a totes les interfícies, defineix el mètodes de negoci del bean.\r\n\r\n**OXM**\r\n\r\nLa API OXM (spring-oxm.jar) proporciona integració entre les APIs més populars de marshalling de XML (JAXB1, JAXB2, Castor, Jibx).\r\n\r\n**JAXB**\r\n\r\nJava Architecture for XML Binding (JAXB) és una API que proporcionar als desenvolupadors una eina de mapping de classes Java a la seva representació XML.\r\n\r\n**Marshalling**\r\n\r\nÉs el procés que s'encarrega de transformar la representació d'un objecte en memoria (Java Object) en un format que encaixi amb el canal de comunicació amb el que es treballa (XML).\r\n\r\n**UnMarshalling**\r\n\r\nÉs el procés invers al Marshalling, la representació en format XML passa a convertir-se en una Java Object.\r\n\r\n**XSDL**\r\n\r\nUn arxiu WSDL és un arxiu XML que descriu la forma de comunicació, es a dir, els requsisits de protocol i els formats dels missatges necessaris per interactuar amb els serveis llistats en el seu catàleg. Així un arxiu WSDL funciona com a interficie pública del web service.\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nLa instal.lació del servei requereix de la utilització de la llibreria 'spring-ws-core'.\r\n\r\n\t <dependency>\r\n      <groupId>org.springframework.ws</groupId>\r\n      <artifactId>spring-ws-core</artifactId>\r\n    </dependency>\r\n\r\n## Configuració\r\n\r\nAquest punt el dividirem en dues parts segons si volem exposar un servei o bé som consumidor(clients) de ell:\r\n\r\n### Configuració com a client\r\n\r\nLa configuració del web implica els següents passos:\r\n\r\n* Generar les classes Java i els seus bindings a partir del WSDL del Webservice.\r\n* Definir l'arxiu de propietats amb les dades del webservice.\r\n* Definir l'arxiu de configuració de Spring: client, marshallers, WebserviceTemplate.\r\n* Definir el client que realitzarà la crida.\r\n* Test d'exemple\r\n\r\n#### Generar les classes Java i els seus bindings a partir del WSDL del Webservice\r\n\r\nPer aquest procés s'utilitza el plugin [cxf-codegen-plugin](http://cxf.apache.org/docs/maven-cxf-codegen-plugin-wsdl-to-java.html) de maven. Aquest és l'encarregat de generar el codi Java i les anotacions de binding de manera automàtica a partir del WSDL.\r\n\r\nEn aquest exemple utilitzem el WSDL públic: http://ws.cdyne.com/ip2geo/ip2geo.asmx?wsdl\r\n\t\r\n    És recomanable generar aquestes classes en un projecte extern, i posteriorment afegir aquest projecte com a dependència del projecte\r\n\t\r\nEn un projecte tipus maven configurem el pom.xml.\r\n\r\nA data de creació d'aquest exemple la última versió de CXF disponible és la 3.2.4, recomanem utilitzar la última versió.\r\n\r\n**pom.xml**\r\n\r\n\t....\r\n\t<build>\r\n\t\t<plugins>\r\n\t\t\t...........\r\n\t\t\t\t\t...........\r\n\r\n\t\t\t<plugin>\r\n\t\t\t\t<groupId>org.apache.cxf</groupId>\r\n\t\t\t\t<artifactId>cxf-codegen-plugin</artifactId>\r\n\t\t\t\t<version>3.2.4</version>\r\n\t\t\t\t<executions>\r\n\t\t\t\t\t<execution>\r\n\t\t\t\t\t\t<id>generate-sources</id>\r\n\t\t\t\t\t\t<phase>generate-sources</phase>\r\n\t\t\t\t\t\t<configuration>\r\n\t\t\t\t\t\t\t<sourceRoot>${basedir}/src/main/java</sourceRoot>\r\n\t\t\t\t\t\t\t<wsdlOptions>\r\n\t\t\t\t\t\t\t\t<wsdlOption>\r\n\t\t\t\t\t\t\t\t\t<wsdl>http://ws.cdyne.com/ip2geo/ip2geo.asmx?wsdl</wsdl>\r\n\t\t\t\t\t\t\t\t</wsdlOption>\r\n\t\t\t\t\t\t\t</wsdlOptions>\r\n\t\t\t\t\t\t</configuration>\r\n\t\t\t\t\t\t<goals>\r\n\t\t\t\t\t\t\t<goal>wsdl2java</goal>\r\n\t\t\t\t\t\t</goals>\r\n\t\t\t\t\t</execution>\r\n\t\t\t\t</executions>\r\n\t\t\t</plugin>\r\n\t\t</plugins>\r\n\t</build>\r\n\t......\r\n\r\n\r\nAquest plugin generarà automàticament el codi Java del WSDL informat:\r\n\r\n![classes_generades](/related/canigo/documentacio/modul-webservices/classes_generades.png)\r\n\r\nCopiem les classes generades al nostre projecte Canigó.\r\n\r\n#### Definició de l'arxiu de propietats\r\n\r\nFitxer de configuració: webservices.properties\r\nUbicació proposada: <PROJECT_ROOT>/src/main/resources/config/props\r\n\r\n    *.ws.uri=http://ws.cdyne.com/ip2geo/ip2geo.asmx\r\n\r\nContindrà les URLs del webservices segons l'entorn al que es vulgui atacar.\r\n\r\n#### Definir l'arxiu de configuració de Spring\r\n\r\nFitxer de configuració: canigo-webservices-config.xml\r\n\r\nUbicació proposada: <PROJECT_ROOT>/src/main/resources/spring\r\n\r\n\t<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\t<beans xmlns=\"http://www.springframework.org/schema/beans\"\r\n\t\txmlns:context=\"http://www.springframework.org/schema/context\"\r\n\t\txmlns:aop=\"http://www.springframework.org/schema/aop\"\r\n\t\txmlns:util=\"http://www.springframework.org/schema/util\"\r\n\t\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" \r\n\t\txmlns:p=\"http://www.springframework.org/schema/p\"\r\n\t\txsi:schemaLocation=\"http://www.springframework.org/schema/beans \r\n\t\t\t\thttp://www.springframework.org/schema/beans/spring-beans-4.3.xsd\r\n\t\t\t\thttp://www.springframework.org/schema/aop \r\n\t\t\t\thttp://www.springframework.org/schema/aop/spring-aop-4.3.xsd\r\n\t\t\t\thttp://www.springframework.org/schema/context \r\n\t\t\t\thttp://www.springframework.org/schema/context/spring-context-4.3.xsd\r\n\t\t\t\thttp://www.springframework.org/schema/util\r\n\t\t\t\thttp://www.springframework.org/schema/util/spring-util-4.3.xsd\">\r\n\r\n\t\t<bean id=\"messageFactory\" class=\"org.springframework.ws.soap.saaj.SaajSoapMessageFactory\">\r\n\t\t\t<property name=\"soapVersion\">\r\n\t\t\t\t<util:constant static-field=\"org.springframework.ws.soap.SoapVersion.SOAP_12\" />\r\n\t\t\t</property>\r\n\t\t</bean>\r\n\t\t\r\n\t\t<bean id=\"webServiceTemplate\" class=\"org.springframework.ws.client.core.WebServiceTemplate\">\r\n\t\t\t<constructor-arg ref=\"messageFactory\" />\r\n\t\t\t<property name=\"marshaller\" ref=\"marshaller\" />\r\n\t\t\t<property name=\"unmarshaller\" ref=\"marshaller\" />\r\n\t\t\t<property name=\"defaultUri\" value=\"${ws.uri}\" />\r\n\t\t</bean>\r\n\t\t\r\n\t\t<bean id=\"webServiceClient\" class=\"cat.gencat.wsprova.ws.WebServiceClientImpl\">\r\n\t\t\t<property name=\"webServiceTemplate\" ref=\"webServiceTemplate\"/>\r\n\t\t\t<property name=\"defaultUri\" value=\"${ws.uri}\" />        \r\n\t\t</bean>\r\n\t\t\r\n\t\t<bean id=\"marshaller\" class=\"org.springframework.oxm.jaxb.Jaxb2Marshaller\">\r\n\t\t\t<property name=\"contextPath\" value=\"com.cdyne.ws\"/>\r\n\t\t</bean>\r\n\r\n\t</beans>\r\n\r\nEn aquesta configuració destacar el bean [marshaller] (https://docs.spring.io/spring/docs/4.3.x/spring-framework-reference/html/oxm.html#oxm-jaxb2) on a la propietat contextPath posem el package de les classes generades, en aquest exemple.\r\n\r\n#### Definir el client que realitzarà la crida\r\n\r\nCodi d'exemple per a la crida al webservice.\r\n\r\n**WebServiceClient.java**\r\n\r\n\timport com.cdyne.ws.ResolveIPResponse;\r\n\r\n\r\n\tpublic interface WebServiceClient {\r\n\t\t\r\n\t\tResolveIPResponse simpleSendAndReceive(String ip, String licenseKey);\r\n\t}\r\n\r\n**WebServiceClientImpl.java**\r\n\r\n\timport org.springframework.ws.client.core.WebServiceTemplate;\r\n\r\n\timport com.cdyne.ws.ResolveIP;\r\n\timport com.cdyne.ws.ResolveIPResponse;\r\n\r\n\tpublic class WebServiceClientImpl implements WebServiceClient {\r\n\t\t\r\n\t\tprivate WebServiceTemplate webServiceTemplate;\r\n\r\n\t\tpublic void setWebServiceTemplate(WebServiceTemplate webServiceTemplate) {\r\n\t\t\tthis.webServiceTemplate = webServiceTemplate;\r\n\t\t}\r\n\r\n\t\tpublic void setDefaultUri(String defaultUri) {\r\n\t\t\twebServiceTemplate.setDefaultUri(defaultUri);\r\n\t\t}\r\n\r\n\t\tpublic ResolveIPResponse simpleSendAndReceive(String ip, String licenseKey) {\r\n\t\t\t\r\n\t\t\tResolveIP request = new ResolveIP();\r\n\t\t\trequest.setIpAddress(ip);\r\n\t\t\trequest.setLicenseKey(licenseKey);\r\n\t\t\t\t\t\r\n\t\t\treturn (ResolveIPResponse)webServiceTemplate.marshalSendAndReceive(request);\r\n\t\t}\r\n\r\n\t}\r\n\r\nDefinir un test per a certificar el seu funcionament\r\n\r\n**WebServiceClientTest .java**\r\n\r\n\timport org.junit.Assert;\r\n\timport org.junit.Before;\r\n\timport org.junit.Test;\r\n\timport org.junit.runner.RunWith;\r\n\timport org.springframework.beans.factory.annotation.Autowired;\r\n\timport org.springframework.test.context.ContextConfiguration;\r\n\timport org.springframework.test.context.junit4.SpringJUnit4ClassRunner;\r\n\r\n\timport com.cdyne.ws.ResolveIPResponse;\r\n\r\n\timport cat.gencat.wsprova.ws.WebServiceClient;\r\n\r\n\r\n\t@RunWith(SpringJUnit4ClassRunner.class)\r\n\t@ContextConfiguration(locations = {\"classpath:cat/gencat/ctti/canigo/arch/core/config/canigo-core.xml\"})\r\n\tpublic class WebServiceClientTest {\r\n\t\t\r\n\t\t@Autowired\r\n\t\tpublic WebServiceClient client;\r\n\t\t\r\n\t\t@Before\r\n\t\tpublic void init(){\r\n\t\t\tAssert.assertNotNull(client);\r\n\t\t}\r\n\t\t\r\n\t\t@Test\r\n\t\tpublic void testCall(){\r\n\t\t\tResolveIPResponse response = client.simpleSendAndReceive(\"91.126.217.34\", \"?\");\r\n\t\t\t\r\n\t\t\tAssert.assertNotNull(response);\r\n\t\t\tAssert.assertEquals(\"Fornells De La Selva\", response.getResolveIPResult().getCity());\r\n\t\t\tAssert.assertEquals(\"Spain\", response.getResolveIPResult().getCountry());\r\n\t\t\t\r\n\t\t}\r\n\t\t\r\n\t}\r\n\t\r\n\r\n### Configuració com a EndPoint\r\n\r\nLa configuració del webservice implica els següents passos:\r\n\r\n* Configuració del web.xml.\r\n* Definir l'arxiu de configuració de Spring: marshallers, endpoints.\r\n* Definir el Endpoint\r\n\r\nEn aquest punt considerem que l'usuari coneix o ha generat l'arxiu XSD (Schema) que defineix el contracte del webservice.\r\n\r\n### Configuració del web.xml.\r\n\r\nEl primer punt a considerar és la càrrega i generació d'un nou context d'spring amb les dades del WS.\r\n\t\r\nAquesta context és independent del context de Spring de l'aplicació web. Si el desenvolupador vol integrar un servei propi de canigó, l'haurà de referenciar directament dins del contextConfigLocation del servlet de Spring WS.\r\n\r\nAquest servlet MessageDispatcherServlet carregarà els arxius de configuració dins del seu context de Spring, i definirá el mapping de les peticions contra aquest servei.\r\n\r\n```\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<web-app xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" \r\n         xmlns=\"http://java.sun.com/xml/ns/javaee\" \r\n         xmlns:web=\"http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd\" \r\n         xsi:schemaLocation=\"http://java.sun.com/xml/ns/javaee \r\n                             http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd\" \r\n\t     id=\"WebApp_ID\" version=\"2.5\">\r\n\r\n\t........\r\n\t\r\n    <servlet>\r\n        <servlet-name>ws-canigo</servlet-name>\r\n        <servlet-class>org.springframework.ws.transport.http.MessageDispatcherServlet</servlet-class>\r\n\t\t<init-param>\r\n\t\t\t<param-name>contextConfigLocation</param-name>\r\n\t\t\t<param-value>classpath:/spring-ws-context.xml</param-value>\r\n\t\t</init-param>\r\n    </servlet>\r\n\r\n    <servlet-mapping>\r\n        <servlet-name>ws-canigo</servlet-name>\r\n        <url-pattern>/*</url-pattern>\r\n    </servlet-mapping>\r\n\t\r\n\t.........\r\n\t\r\n</web-app>\r\n```\r\n\r\n#### Definir l'arxiu de configuració de Spring\r\n\r\nDins de l'arxiu de configuració definim:\r\n\r\n* L' estrategia de resolució del Endpoint (en aquest cas per anotacions).\r\n* Configuració de OXM per tal d'aplicar marshalling i unmarshalling sobre les dades d'entrada i sortida del Endpoint.\r\n* Indicar al marshaller quins son els beans que contenen l'informació de binding.\r\n* Exportar el XSD com a WSDL de manera transparent.\r\n\r\nRuta proposada:\r\n/src/main/resources/spring-ws/spring-ws-context.xml\r\n\t\r\n<div class=\"message information\">\r\nEn el cas de que l'aplicació web de tipus Canigó no sigui exclusivament un webservice, evitar que el context de l'aplicació Web carregui els beans\r\nde Spring WS introduïnt-los en la carpeta /src/main/resources/spring/. Això carregaria de manera automàtica els beans de Spring WS, consumint memoria innecesariament\r\nja que el context de l'aplicació web no és el mateix que el del webservice.\r\n</div>\r\n\r\n```\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\r\n       xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n       xmlns:p=\"http://www.springframework.org/schema/p\"\r\n       xmlns:context=\"http://www.springframework.org/schema/context\"\r\n       xsi:schemaLocation=\"http://www.springframework.org/schema/beans \r\n                           http://www.springframework.org/schema/beans/spring-beans.xsd\r\n                           http://www.springframework.org/schema/context\r\n                           http://www.springframework.org/schema/context/spring-context.xsd\">\r\n\r\n    <context:component-scan base-package=\"cat.gencat.ws.example.service\" />\r\n\r\n    <bean id=\"echo\" class=\"org.springframework.ws.wsdl.wsdl11.DefaultWsdl11Definition\"\r\n          p:portTypeName=\"Echo\"\r\n          p:locationUri=\"/echoService/\"\r\n\t\t  p:targetNamespace=\"http://mycompany.com/hr/definitions\">\r\n        <property name=\"schema\">\r\n            <bean class=\"org.springframework.xml.xsd.SimpleXsdSchema\"\r\n                  p:xsd=\"classpath:/config/xsd/echo.xsd\" />\r\n            </bean>\r\n        </property>        \r\n    </bean>\r\n\r\n    <bean class=\"org.springframework.ws.server.endpoint.mapping.PayloadRootAnnotationMethodEndpointMapping\"/>\r\n\r\n    <bean class=\"org.springframework.ws.server.endpoint.adapter.MarshallingMethodEndpointAdapter\">\r\n        <constructor-arg ref=\"marshaller\"/>\r\n    </bean>\r\n\r\n    <bean id=\"marshaller\" class=\"org.springframework.oxm.jaxb.Jaxb2Marshaller\"\r\n          p:contextPath=\"cat.gencat.ws.example.schema.beans\" />\r\n\r\n</beans>\r\n```\r\n\r\n#### Definir el Endpoint\r\n\r\nInterficie que defineix les operacions públiques del WS.\r\n\r\n**MarshallingEchoService.java**\r\n\r\n```\r\npublic interface MarshallingEchoService {\r\n    \r\n    /**\r\n     * Return Echo response\r\n     */\r\n    public EchoResponse echoEcho(EchoRequest request);\r\n\r\n}\r\n```\r\n\r\nLa anotació @Endpoint indica que es tracta d'un EndPoint, Spring gracies a component-scan i la clase PayloadRootAnnotationMethodEndpointMapping mapeja les peticions i respostes contra aquest bean.\r\n\r\nDe manera transparent el marshaller s'encarregarà de la conversió de XML a object i de object a XML.\r\n\r\n**EchoEndpoint.java**\r\n\r\n```java\r\n@Endpoint\r\npublic class EchoEndpoint implements MarshallingEchoService {\r\n    \r\n    /**\r\n     * Return Echo response\r\n     */\r\n    @PayloadRoot(localPart=\"echoEcho\", namespace=\"http://mycompany.com/hr/definitions\")\r\n    public EchoResponse echoEcho(EchoRequest request) {\r\n        return new EchoRequest().setMessage(request.getMessage());        \r\n    }\r\n\r\n}\r\n```\r\n\r\nDes d'un client d'aquest WS (revisar configuració com a client) realitzem la crida i recuperem el valor retornat:\r\n\r\n**EchoServiceClient.java**\r\n\r\n```java\r\npublic class EchoServiceClient implements MarshallingEchoService {\r\n   \r\n    @Autowired\r\n    private WebServiceTemplate wsTemplate;\r\n\r\n    private static final Log LOGGER = LogFactory.getLog(EchoServiceClient.class);\r\n   \r\n    /**\r\n     * Gets person list.\r\n     */\r\n    public EchoResponse echoEcho(EchoRequest request) {\r\n        EchoResponse response = \r\n            (EchoResponse) wsTemplate.marshalSendAndReceive(request);\r\n\r\n        if(LOGGER.isDebugEnabled(()){\r\n\t    LOGGER.debug(response.getMessage());\r\n        }\r\n\r\n        return response;\r\n        \r\n    }\r\n   \r\n}\r\n```\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtYWx0cmVzL21vZHVsLXdlYnNlcnZpY2Vz"},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1jb25maWd1cmFjaW8=":{"date":1552913742000,"title":"Mòdul de configuració","description":"Configuracio de les propietats dels components de l'aplicació.","sections":"Canigó. Documentació versió 3.x","weight":3,"toc":true,"path":"/canigo-documentacio-versions-3x-core/modul-configuracio","content":"## Propòsit\r\n\r\nEl mòdul de configuració té com a propòsit la configuració de les\r\npropietats de qualsevol component de l'aplicació. Aquestes propietats\r\npoden ser tant referències a altres objectes com propietats internes\r\n(atributs) que necessiten per al seu correcte funcionament.\r\n\r\nUna de les principals avantatges del mòdul respecte la classe\r\n[PropertyPlaceholderConfigurer](http://docs.spring.io/spring/docs/4.3.3.RELEASE/javadoc-api/org/springframework/beans/factory/config/PropertyPlaceholderConfigurer.html \"Documentacio de Spring\")\r\naportada per Spring, és la possibilitat de disposar de propietats\r\ndependents d'entorn sense necessitat de cap configuració extra a nivell\r\nde beans - propietats.\r\n\r\n## Limitacions\r\n\r\nPer aplicacions Canigó 3.4 que utilitzin Spring Boot, el mòdul de configuració presenta les següents limitacions:\r\n\r\n* no és compatible amb la càrrega de propietats depenent dels profiles de Spring Boot (spring.profiles.active o SPRING_PROFILES_ACTIVE). Si es vol fer depenent els valors de les propietats segons l'entorn, s'han de seguir les instruccions especificades en aquesta plana.\r\n\r\n* condicionar la configuració de Spring Boot (Veure secció \"Condicionar la configuració de Spring Boot\" d'aquesta plana)\r\n\r\n<div class=\"message warning\">\r\nA la propera versió de Canigó, es preveu deprecar aquest mòdul de configuració en favor dels profiles de Spring Boot\r\n</div>\r\n\r\n## Instal.lació\r\n\r\nEl mòdul de configuració i el corresponent test unitari s'inclou per defecte dins del core de Canigó 3.\r\nDurant el procés de creació de l'aplicació, l'eina de suport al desenvolupament inclourà la referència dins del pom.xml. \r\nEn cas d'una instal- lació manual afegir les següents línies al pom.xml de l'aplicació:\r\n\r\n```xml\r\n<canigo.core.version>[4.0.0,4.1.0)</canigo.core.version>\r\n<canigo.test.version>[2.0.0,2.1.0)</canigo.test.version>\r\n\r\n<dependency>\r\n    <groupId>cat.gencat.ctti</groupId>\r\n    <artifactId>canigo.core</artifactId>\r\n    <version>${canigo.core.version}</version>\r\n</dependency>\r\n\r\n<dependency>\r\n    <groupId>cat.gencat.ctti</groupId>\r\n    <artifactId>canigo.test</artifactId>\r\n    <version>${canigo.test.version}</version>\r\n    <scope>test</scope>\r\n</dependency>\r\n\r\n<dependency>\r\n    <groupId>cat.gencat.ctti</groupId>\r\n    <artifactId>canigo.core</artifactId>\r\n    <type>test-jar</type>\r\n    <version>${canigo.core.version}</version>\r\n    <scope>test</scope>\r\n    <classifier>tests</classifier>\r\n</dependency>\r\n```\r\n\r\nAl pom.xml també s'ha d'afegir el plugin que executa el test unitari del mòdul de configuració:\r\n```xml\r\n<build>\r\n    ...\r\n    <plugins>\r\n        ...\r\n        <plugin>\r\n            <groupId>org.apache.maven.plugins</groupId>\r\n            <artifactId>maven-surefire-plugin</artifactId>\r\n            <executions>\r\n                <execution>\r\n                    <id>base-test</id>\r\n                    <phase>test</phase>\r\n                    <goals>\r\n                        <goal>test</goal>\r\n                    </goals>\r\n                    <configuration>\r\n                        <dependenciesToScan>\r\n                            <dependency>cat.gencat.ctti:canigo.core</dependency>\r\n                            ...\r\n                        </dependenciesToScan>\r\n\t\t\t<excludes>\r\n\t\t\t\t<exclude>%regex[${project.groupId}.*.*Test.*]</exclude>\r\n\t\t\t</excludes>\r\n                    </configuration>\r\n                </execution>\r\n                ...\r\n            </executions>\r\n        </plugin>\r\n        ...\r\n    </plugins>\r\n    ...\r\n</build>    \r\n```\r\n\r\n## Configuració de l'entorn\r\n\r\nEl concepte d'Entorn es defineix mitjançant la propietat entorn, a la\r\nque s'assigna el valor corresponent a l'arrancar la màquina virtual\r\nJava\r\n\r\n```java\r\njava ... -Dentorn=pro\r\n```\r\n\r\nAquesta configuració de l'entorn es utilitzada pel servei de configuració per obternir les propietats segons l'entorn\r\n\r\n## Configuració propietats en format yaml\r\n\r\nA la versió Canigó 3.4 es proporciona la funcionalitat de càrrega de propietats definides a fitxers yaml\r\n\r\nYaml és un estàndard de format fàcilment llegible que signigica \"YAML Ain't Markup Language\", per a més informació es pot consultar: https://yaml.org/\r\n\r\nEs recomana passar les propietats definides en format properties a format yaml\r\n\r\nEn properes versions de Canigó s'eliminarà l'actual funcionalitat de configuració de propietats de Canigó, per utilitzar les funcionalitats de configuració de propietats de Spring\r\n\r\nEls arxius de configuració de propietats de l'aplicació han d'estar en la següent ubicació:\r\n\r\n```\r\n    <PROJECT_ROOT>/src/main/resources/config/props/\r\n```\r\n\r\nI han de tenir el nom:\r\n\r\n```\r\napplication*.yml\r\n```\r\n\r\n### Configuració segons l'entorn\r\n\r\nEs necessari definir un fitxer yaml per cada entorn, aixi pels entorns de loc, dev, pre i pro necessitem definir els fitxers:\r\n\r\n```\r\napplication-loc.yml\r\napplication-dev.yml\r\napplication-pre.yml\r\napplication-pro.yml\r\n```\r\n\r\nSi no es defineix un fitxer específic per l'entorn agafarà la configuració del fitxer application.yml, així si tenim els entorns loc, dev, pre i pro i tenim la mateixa configuració per loc i per dev podriem tenir els fitxers:\r\n```\r\napplication.yml\r\napplication-pre.yml\r\napplication-pro.yml\r\n```\r\n\r\nA cada fitxer necessitem tenir definides totes les propietats de l'aplicació\r\n\r\nEn futures versions de Canigó s'utilitzarà la configuració de propietats de Spring en un sol fitxer yaml\r\n\r\n### Propietats de format properties a format yaml\r\n\r\nEs necessari passar les claus de les propietats de l'aplicació de formar properties a format yaml\r\n\r\nEl resum del format yaml seria:\r\n- Estructurat per indentació\r\n- Els llistats es senyalen amb un guió\r\n- Els valors de les propietats estan separats per dos punts\r\n\r\nUn exemple de format yaml seria:\r\nhttps://yaml.org/start.html\r\n\r\nSi partim, per exemple, de les propietats:\r\n\r\n```properties\r\napplication.Id = provaCanigoSpringBoot2MVC\r\napplication.version = 1.0.0\r\napplication.defaultLanguage = ca_ES\r\npersistence.database=H2\r\npersistence.dialect=org.hibernate.dialect.H2Dialect\r\npublishInfoModules=false\r\npublishInfoProperties=false\r\n```\r\n\r\nEn el fitxer application.yml hauriem de tenir la definició:\r\n\r\n```yaml\r\napplication:\r\n  id: provaCanigoSpringBoot2MVC\r\n  version: 1.0.0\r\n  defaultLanguage: ca_ES\r\npersistence:\r\n  database: H2\r\n  dialect: org.hibernate.dialect.H2Dialect\r\npublishInfoModules: false\r\npublishInfoProperties: false\r\n```\r\n\r\nCom es pot observar, amb la indentació es poden agrupar propietats, així, tenim que les claus \"database\" i \"dialect\" que pengen de \"persistence\" acaben formant les propietat \"persistence.database\" i \"persistence.dialect\"\r\n\r\nLes propietats en format yaml tindran prioritat a les propietats definides en format properties \r\n\r\n## Configuració propietats en format properties\r\n\r\nNo requereix configuració per part del desenvolupador. Els xmls de\r\nconfiguració del servei es troben internalitzats dins del jar del core,\r\ni s'inicialitzarà de manera automàtica un cop arrenqui l'aplicació.\r\n\r\nEls arxius de configuració de propietats de l'aplicació han d'estar en\r\nla següent ubicació:\r\n\r\n```\r\n    <PROJECT_ROOT>/src/main/resources/config/props/*.properties\r\n```\r\n\r\nTots els arxius d'aquest directori han de complir el format de multi-entorn \r\n\r\n### Configuració segons l'entorn\r\n\r\nA partir de la versió 3.0 de Canigó i per tal de reduir el número\r\nd'arxius de configuració per entorn, s'introdueixen els arxius de\r\npropietats multientorn. Cadascuna de les claus d'aquests arxius de\r\nconfiguració disposa de dues parts:\r\n\r\n-   **Entorn:** identifica l'entorn en el que aquesta propietat serà\r\n    vàlida. El entorn amb asterisc indica valor per defecte. En el cas\r\n    de que existeixi una propietat específica per a l'entorn, aquesta es\r\n    seleccionarà per defecte.\r\n-   **Clau:** propietat de identifica un determinat valor de\r\n    configuració.\r\n\r\nUn exemple d'un arxiu de propietats de configuració *exemple.properties*\r\npodria ser el següent:\r\n\r\n```properties\r\n# Arxiu de configuració per al mòdul d'antivirus\r\n*.antivirus.serverIp=127.0.0.1\r\npro.antivirus.serverIp=11.11.11.02\r\nint.antivirus.serverIp=21.21.11.02\r\n*.antivirus.serverPort=1344\r\nint.antivirus.serverPort=1567\r\n```\r\n\r\n\r\nAixí, en l'exemple anterior tindríem la següent configuració per entorn:\r\n\r\nClau|Entorn|Valor|Comentari\r\n----|------|-----|---------\r\nantivirus.serverIp|loc|127.0.0.1|Configuració per defecte. No hi ha propietat específica per al entorn local.\r\nantivirus.serverIp|dev|127.0.0.1|Configuració per defecte. No hi ha propietat específica per al entorn de desenvolupament.\r\nantivirus.serverIp|int|21.21.11.02|Configuració específica per a l'entorn d'integració.\r\nantivirus.serverIp|pre|127.0.0.1|Configuració per defecte. No hi ha propietat específica per al entorn de preproducció\r\nantivirus.serverIp|pro|11.11.11.02|Configuració específica per a l'entorn de producció.\r\nantivirus.serverPort|loc|1344|Configuració per defecte. No hi ha propietat específica per al entorn local.\r\nantivirus.serverPort|dev|1344|Configuració per defecte. No hi ha propietat específica per al entorn de desenvolupament.\r\nantivirus.serverPort|int|1567|Configuració específica per a l'entorn d'integració.\r\nantivirus.serverPort|pre|1344|Configuració per defecte. No hi ha propietat específica per al entorn de preproducció.\r\nantivirus.serverPort|pro|1344|Configuració per defecte. No hi ha propietat específica per al entorn de producció.\r\n\r\nAmb la configuració en funció de l'entorn, el servei de\r\nconfiguració de Canigó cerca la configuració adient en els diferents\r\narxius de configuració de la carpeta\r\n```\r\n<PROJECT_ROOT>/src/main/resources/config/props/\r\n```\r\n\r\n## Utilització del mòdul\r\n\r\nDegut a la pròpia naturalesa del mòdul, l'obtenció de les propietats des\r\nde classes \"clients\" no requereix cap injecció de dependències o\r\nconfiguració addiccional. La resolució de les propietats per entorn es\r\nrealitzarà de manera automàtica i transparent per al desenvolupador.\r\n\r\n-   Exemple d'inserció de propietats en configuració de Beans de Spring\r\n    basada en XML:\r\n\r\n    ```xml\r\n    <bean id=\"antivirus\"  class=\"cat.gencat.ctti.canigo.arch.integration.antivirus.impl.AntivirusImpl\">\r\n        <property name=\"remote\" value=\"${antivirus.remote:false}\" />\r\n            <property name=\"serverIP\" value=\"${antivirus.serverIp}\" />\r\n        <property name=\"serverPort\" value=\"${antivirus.serverPort}\" />\r\n    </bean>\r\n    ```\r\n\r\n    \r\n\r\n-   Exemple d'inserció de propietats en configuració de Beans de Spring bassat en anotacions:\r\n\r\n    ```java\r\n    @Repository\r\n    public class AntivirusImpl implements Antivirus{\r\n        @Value(\"${antivirus.serverIp}\")\r\n        private String serverIP;\r\n    }\r\n    ```\r\n\r\n## Configuració a servidors JEE corporatius\r\n\r\n### Concepte de configuració amb propietats globals\r\n\r\nA partir de la versió 3.0.3 del mòdul canigo.core s'inclou la\r\npossibilitat de poder fer servir propietats definides fora de\r\nl'aplicació. Aquestes propietats es configuren a nivell del servidor JEE\r\nmitjançant un fitxer de propietats la ruta del qual és especificada\r\ndurant l'arrencada de la JVM. Les propietats d'aquest fitxer afecten a\r\ntotes les aplicacions desplegades al servidor que incorporin aquesta\r\nversió (o posterior) del mòdul canigo.core. També es dona flexibilitat\r\nper poder definir excepcions per a certes aplicacions mitjançant un\r\nfitxer de propietats específic. \r\n Per aconseguir aquest funcionament cal que el proveïdor de l'aplicació\r\ni l'administrador del servidor JEE al CPD facin una sèrie de\r\nconfiguracions: \r\n \r\n\r\n#### Proveïdor de l'aplicació Canigó\r\n\r\nCal definir a l'aplicació la següent propietat al fitxer:\r\n**src/main/resources/config/props/application.properties**\r\n\r\nPropietat|Requerit|Descripció\r\n---------|--------|----------\r\ncodi_aplicacio|NO|Típicament serà el codi de diàleg de l'aplicació. Cal informar-ho nomes si es vol emprar un fitxer de propietats específiques per a l'aplicació en comptes del global de servidor.\r\n\r\n#### Administrador del servidor JEE al CPD\r\n\r\n<div class=\"message warning\">\r\nDeixar clar que aquest punt és responsabilitat de CPD i que l'únic que necessita conèixer de l'aplicació per poder-ne fer una configuració específica és el <b>codi_aplicacio</b>.\r\n</div>\r\n\r\n\r\n##### Indicar path de la carpeta del fitxer de propietats globals\r\n\r\nAl arrencar la màquina virtual de Java cal indicar la següent propietat:\r\n\r\n```java\r\njava ... -Dconf_dir=[ pathToConfDir ]\r\n```\r\n\r\nOn [ pathToConfDir ] és el path de la carpeta al servidor on hi figura\r\nl'arxiu de propietats global server.properties.\r\n \r\n\r\n##### Informar el fitxer de propietats globals\r\n\r\nAl servidor cal crear el següent fitxer de propietats: **[ pathToConfDir\r\n]/server.properties**\r\n I definir les següents propietats:\r\n\r\nPropietat|Requerit|Descripció\r\n---------|--------|----------\r\nentorn|SI|Nom de l'entorn\r\ncodi_servei|NO|Cal informar-ho només si es vol habilitar l'ús de fitxers de propietats específics per a aplicacions al servidor.\r\n\r\n    \r\nA aquest fitxer caldria afegir-hi la resta de propietats globals que es\r\nvulguin definir per a totes les aplicacions que es despleguin en aquest\r\nservidor. \r\n\r\n\r\n##### Informar el fitxer de propietats específic d'aplicació\r\n\r\nEn cas de voler habilitar fitxers de propietats específics per a una\r\naplicació, caldria crear la següent estructura de carpetes i fitxers: \r\n **[ pathToConfDir ]/[ entorn ]/[ codi_servei ]/[ codi_aplicacio\r\n]/app.properties** \r\n \r\n\r\n#### Exemples d'ús de propietats globals a servidor\r\n\r\n##### Exemple 1: Ús de propietats globals definides al servidor\r\n\r\nEs vol que totes les aplicacions desplegades al servidor facin servir la\r\nmateixa configuració per al servei d'enviament de correus, tret del\r\nusername i password del compte d'enviament que les definiran les pròpies\r\naplicacions. Per a aquest propòsit:\r\n\r\n-   Els proveïdors de les aplicacions que despleguin en aquest servidor\r\n    hauran d'indicar les propietats referents al username/password al\r\n    fitxer de propietats de configuració de correu de l'aplicació:\r\n    **/src/main/resources/config/props/mail.properties**.\r\n\r\n    ```java\r\n    *.mail.username=demo@gencat.cat\r\n    *.mail.password=*****\r\n    ```\r\n\r\n-   Els administradors del servidor hauran de :\r\n    -   Indicar el path de la carpeta del fitxer de propietats globals\r\n        durant l'arrencada de la JVM:\r\n\r\n        ```java\r\n        java ... -Dconf_dir=/serveis/conf\r\n        ```\r\n\r\n    -   Crear el fitxer de propietats globals i informar les seves\r\n        propietats: **/serveis/conf/server.properties**\r\n\r\n        ```java\r\n        entorn=loc\r\n        #Propietats globals d'enviament de correu per a totes les aplicacions desplegades\r\n        *.mail.host=smtp-intranet.gencat.intranet\r\n        *.mail.port=25\r\n        *.mail.protocol=smtp\r\n        *.mail.maxAttachmentSize=1024\r\n        ```\r\n\r\n        \r\n\r\n##### Exemple 2: Ús de propietats específiques d'aplicació definides al servidor\r\n\r\nEs vol definir el nom dels dataSources de les conexions per JNDI de les\r\naplicacions mitjançant els fitxers de propietats específics d'aplicació\r\ndins servidor. Per a aquest propòsit:\r\n\r\n-   Els proveïdors de l'aplicació hauran d'informar la propietat\r\n    **codi_aplicacio** al fitxer de propietats de la seva aplicació:\r\n    **src/main/resources/config/props/application.properties**\r\n\r\n    ```java\r\n    codi_aplicacio=001\r\n    ```\r\n\r\n-   Els administradors del servidor hauran de :\r\n    -   Indicar el path de la carpeta del fitxer de propietats globals\r\n        durant l'arrencada de la JVM:\r\n\r\n        ```java\r\n        java ... -Dconf_dir=/serveis/conf\r\n        ```\r\n\r\n    -   Crear el fitxer de propietats globals i informar les seves\r\n        propietats: **/serveis/conf/server.properties**\r\n\r\n        ```java\r\n        entorn=pre\r\n        codi_servei=demo\r\n        ```\r\n\r\n        \r\n\r\n    -   Crear l'estructura de carpetes i el fitxer de propietats\r\n        específic per a l'aplicació al servidor (+ creació estructura\r\n        directoris): **/serveis/conf/pre/demo/001/app.properties**\r\n\r\n        ```java\r\n        #Configuració de l'orígen de dades per JNDI per a l'aplicació 001\r\n        *.jndi.name=java:comp/env/dataSource001\r\n        ```\r\n\r\n        Prèviament cal que l'administrador del servidor hagi consultat\r\n        aquest **codi_aplicacio** al proveïdor de l'aplicació. \r\n         \r\n\t\t \r\n### Modificar ubicació dels fitxers en format propietats\r\n\r\nPer defecte Canigó carrega les propietats en format properties que es troben a **classpath:/config/props/*.properties**. \r\n\r\nSi es vol modificar aquest path s'ha d'afegir la propietat **application.configLocation** al fitxer **application.properties**. Per exemple per carregar fitxers de propietats en jars externs a l'aplicació:\r\n\r\n\t*.application.configLocation=classpath*:/config/props/*.properties\r\n\t\r\n\r\n## Condicionar la configuració de Spring Boot\r\n\r\nSpring Boot ofereix la possibilitat de condicionar diversos aspectes de la configuració (Per exemple quines classes s'han de carregar, o que controladors s'han d'exposar) segons si compleixen unes condicions:\r\n\r\nhttps://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-developing-auto-configuration.html\r\n\r\n### Configuració de propietats de Spring Boot amb format yaml\r\n\r\nPer a poder utilitzar la funcionalitat de \"@ConfigurationProperties\" de Spring Boot és necessari crear el següent initializer:\r\n```java\r\nimport java.io.IOException;\r\n\r\nimport org.springframework.boot.env.YamlPropertySourceLoader;\r\nimport org.springframework.context.ApplicationContextInitializer;\r\nimport org.springframework.context.ConfigurableApplicationContext;\r\nimport org.springframework.core.env.PropertySource;\r\nimport org.springframework.core.io.Resource;\r\n\r\nimport cat.gencat.ctti.canigo.arch.core.config.YamlPropertiesUtils;\r\n\r\npublic class YamlPropertiesApplicationContextInitializer\r\n\t\timplements ApplicationContextInitializer<ConfigurableApplicationContext> {\r\n\r\n\t@Override\r\n\tpublic void initialize(ConfigurableApplicationContext applicationContext) {\r\n\t\tResource resource = YamlPropertiesUtils.getYamlPropertiesResource();\r\n\t\ttry {\r\n\t\t\tfor (PropertySource<?> propertySource : new YamlPropertySourceLoader().load(resource.getFilename(),\r\n\t\t\t\t\tresource)) {\r\n\t\t\t\tapplicationContext.getEnvironment().getPropertySources().addFirst(propertySource);\r\n\t\t\t}\r\n\t\t} catch (IOException ex) {\r\n\t\t\tthrow new IllegalStateException(\"Failed to load yml configuration from \" + resource.getFilename(), ex);\r\n\t\t}\r\n\t}\r\n}\r\n```\r\n\r\nI inicialitzar-lo al \"Application.java\" on canviem:\r\n\r\n```java\r\n\tpublic static void main(final String[] args) throws Exception {\r\n\t\tif (System.getProperty(\"entorn\") == null) {\r\n\t\t\tSystem.setProperty(\"entorn\", \"loc\");\r\n\t\t}\r\n\r\n\t\tif (System.getProperty(\"application.defaultLanguage\") == null)\r\n\t\t\tSystem.setProperty(\"application.defaultLanguage\", \"ca_ES\");\r\n\t\t\r\n\t\tSystem.setProperty(\"spring.main.allow-bean-definition-overriding\", String.valueOf(true));\r\n\r\n\t\tSpringApplication.run(Application.class, args);\r\n\t}\r\n\r\n\t@Override\r\n\tprotected SpringApplicationBuilder configure(final SpringApplicationBuilder application) {\r\n\t\treturn application.sources(Application.class);\r\n\t}\r\n```\r\nper:\r\n```java\r\n\tpublic static void main(final String[] args) throws Exception {\r\n\t\tif (System.getProperty(\"entorn\") == null) {\r\n\t\t\tSystem.setProperty(\"entorn\", \"loc\");\r\n\t\t}\r\n\r\n\t\tif (System.getProperty(\"application.defaultLanguage\") == null)\r\n\t\t\tSystem.setProperty(\"application.defaultLanguage\", \"ca_ES\");\r\n\r\n\t\tSystem.setProperty(\"spring.main.allow-bean-definition-overriding\", String.valueOf(true));\r\n\r\n\t\tSpringApplicationBuilder builder = new SpringApplicationBuilder();\r\n\t\taddSourcesAndInitializers(builder);\r\n\t\tbuilder.run(args);\r\n\t}\r\n\r\n\t@Override\r\n\tprotected SpringApplicationBuilder configure(final SpringApplicationBuilder builder) {\r\n\t\treturn addSourcesAndInitializers(builder);\r\n\t}\r\n\r\n\tprivate static SpringApplicationBuilder addSourcesAndInitializers(SpringApplicationBuilder builder) {\r\n\t\taddSources(builder);\r\n\t\taddInitializers(builder);\r\n\t\treturn builder;\r\n\t}\r\n\r\n\tprivate static SpringApplicationBuilder addSources(SpringApplicationBuilder builder) {\r\n\t\treturn builder.sources(Application.class);\r\n\t}\r\n\r\n\tprivate static SpringApplicationBuilder addInitializers(SpringApplicationBuilder builder) {\r\n\t\treturn builder.initializers(new YamlPropertiesApplicationContextInitializer());\r\n\t}\r\n```\r\n\r\nA més, necessitem registrar els \"@ConfigurationProperties\", així en el \"@Configuration\" de l'aplicació, \"AppConfig.java\", podriem tenir:\r\n```java\r\nimport cat.gencat.ctti.properties.ApplicationProperties;\r\n\r\n@Configuration\r\n@ImportResource({ \"classpath:cat/gencat/ctti/canigo/arch/core/config/canigo-core.xml\" })\r\n@EnableTransactionManagement\r\n@EnableAutoConfiguration\r\n@EnableConfigurationProperties(ApplicationProperties.class)\r\npublic class AppConfig {\r\n\r\n}\r\n```\r\n\r\nAmb aquests canvis tindriem l'aplicació configurada per carregar les propietats amb format yaml i utilitzar les funcionalitats de String com el \"@ConfigurationProperties\"\r\n\r\nUn exemple d'utilització de les funcionalitats de Spring podria ser una classe per mapejar la clau \"application\" del nostre fitxer yaml, tenint l'estructura:\r\n```java\r\nimport org.springframework.boot.context.properties.ConfigurationProperties;\r\n\r\n@ConfigurationProperties(prefix = \"application\")\r\npublic class ApplicationProperties {\r\n\r\n\tString id;\r\n\t\r\n\tString version;\r\n\t\r\n\tString defaultLanguage;\r\n\r\n\tpublic String getId() {\r\n\t\treturn id;\r\n\t}\r\n\r\n\tpublic void setId(String id) {\r\n\t\tthis.id = id;\r\n\t}\r\n\r\n\tpublic String getVersion() {\r\n\t\treturn version;\r\n\t}\r\n\r\n\tpublic void setVersion(String version) {\r\n\t\tthis.version = version;\r\n\t}\r\n\r\n\tpublic String getDefaultLanguage() {\r\n\t\treturn defaultLanguage;\r\n\t}\r\n\r\n\tpublic void setDefaultLanguage(String defaultLanguage) {\r\n\t\tthis.defaultLanguage = defaultLanguage;\r\n\t}\r\n\r\n}\r\n```\r\n\r\nOn la podriem utilitzar utilitzant la injecció de Spring:\r\n```java\r\n\t@Autowired\r\n\tApplicationProperties applicationProperties;\r\n\t...\r\n\tapplicationProperties.getId()\r\n```\r\n\r\nTambé podem accedir a les propietats com fins ara utilitzant place holders, per exemple:\r\n```java\r\n\t@Value(\"${application.id}\")\r\n\tString applicationId;\r\n```\r\n\r\nPer poder utilitzar els \"@ConfigurationProperties\" en els tests, es necessari registrar també l'initializer en el test i registrar els \"@ConfigurationProperties\"\r\n\r\nAixí, podriem tenir una classe de configuració del test homologa a \"AppConfig.java\":\r\n```java\r\nimport org.springframework.boot.autoconfigure.EnableAutoConfiguration;\r\nimport org.springframework.boot.context.properties.EnableConfigurationProperties;\r\nimport org.springframework.context.annotation.Configuration;\r\nimport org.springframework.context.annotation.ImportResource;\r\nimport org.springframework.transaction.annotation.EnableTransactionManagement;\r\n\r\nimport cat.gencat.ctti.properties.ApplicationProperties;\r\n\r\n@Configuration\r\n@ImportResource({ \"classpath:spring/canigo-core.xml\" })\r\n@EnableTransactionManagement\r\n@EnableAutoConfiguration\r\n@EnableConfigurationProperties(ApplicationProperties.class)\r\npublic class TestAppConfig {\r\n\t\r\n}\r\n```\r\nI utilitzar aquest \"@Configuration\" en un test utilitzant també el inicializer:\r\n```java\r\n@RunWith(SpringJUnit4ClassRunner.class)\r\n@ContextConfiguration(classes = {\r\n\t\tTestAppConfig.class }, initializers = YamlPropertiesApplicationContextInitializer.class)\r\npublic class YamlPropertiesTest {\r\n...\r\n}\r\n```\t\t\r\n\r\n### Configuració de propietats de Spring Boot amb format properties\r\n\r\nPer a poder utilitzar propietats en aquestes condicions s'han de carregar específicament per a aquest motiu en un fitxer de configuració propi que llegeixi SpringBoot, ja que les propietats de l'aplicació es carreguen després de resoldre aquestes condicions.\r\n\r\nSpringBoot per defecte cerca les propietats en un fitxer que es digui application.properties a src/resources. Les propietats que es dessitgi utilitzar en la configuració de SpringBoot s'han d'afegir en aquest fitxer.\r\n\r\nSi es vol utilitzar profiles de Spring, s'hauria de crear un fitxer application-{profile}.properties.\r\n\r\nUna altre forma de carregar un fitxer de propietas és d'afegir l'annotació @PropertySource al nostre fitxer de de configuració:\r\n\r\n```java\r\n\t@Configuration\r\n\t@PropertySource(\"classpath:/config/props/boot.properties\")\r\n\t@ImportResource({ \"classpath:cat/gencat/ctti/canigo/arch/core/config/canigo-core.xml\" })\r\n\t@EnableTransactionManagement\r\n\tpublic class AppConfig {\r\n\t\t\r\n\t}\r\n```\r\n\r\nIndicant el path on es troba aquest fitxer.\r\n\r\nUn exemple d'aquesta condicionalitat es pot trobar al [servei de seguretat](/canigo-documentacio-versions-3x-core/modul-seguretat/)\r\n\r\n\r\nPreguntes freqüents\r\n-------------------\r\n\r\n## Accés manual al servei de configuració\r\n\r\nEncara que no és recomanable accedir a les propietats del mòdul de\r\nmanera directa, el desenvolupador pot realitzar una crida de forma\r\nexterna mitjançant el patró ['Dependency\r\nInjection'](http://martinfowler.com/articles/injection.html \"Dependency Injection\")\r\nal mòdul i les seves propietats d'entorn.\r\n\r\n-   Injecció de dependències mitjançant xml. Per exemple:\r\n     Ruta proposada:\r\n    <PROJECT_ROOT>/src/main/resources/spring/exemple-beans-config.xml\r\n\r\n```xml\r\n<bean id=\"myBean\"  class=\"cat.gencat.app.exemples.Injection\">\r\n    <property name=\"configuration\" ref=\"propertiesConfiguration\" />\r\n</bean>\r\n```\r\n\r\n\r\n\r\nLa clase Injection tindria la següent estructura:\r\n\r\n```java\r\nimport cat.gencat.ctti.canigo.arch.core.config.PropertiesConfiguration;\r\n\r\npublic class Injection {\r\n     PropertiesConfiguration configuration;\r\n\r\n     public void setConfiguration(PropertiesConfiguration  configuration){\r\n         this.configuration = configuration;\r\n     }\r\n\r\n}\r\n```\r\n\r\n\r\n\r\nInjecció del mòdul de configuració dins del bean \"myBean\". Spring\r\ns'encarregarà d'injectar la configuració del mòdul de propietats\r\nexecutant el mètode setConfiguration.\r\n\r\n-   Injecció de dependències mitjançant annotacions:\r\n\r\n```java\r\nimport cat.gencat.ctti.canigo.arch.core.config.PropertiesConfiguration;\r\n\r\n@Component(\"myBean\")\r\npublic class Injection {\r\n     @Autowired\r\n     PropertiesConfiguration configuration;\r\n\r\n     public void execute(){\r\n\r\n         String ip = configuration.getProperty(\"antivirus.serverIp\");\r\n     }\r\n\r\n}\r\n```\r\n\r\n\r\n\r\nL'anotació @Autowired injecta en aquest cas, un bean de tipus\r\ncat.gencat.ctti.canigo.arch.core.config.PropertiesConfiguration\r\nque Spring trobarà en el context de l'aplicació.\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1jb25maWd1cmFjaW8="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1leGNlcGNpb25z":{"date":1426175425000,"title":"Mòdul d'excepcions","description":"Mòdul per a la gestió d'Errors","sections":"Canigó. Documentació versió 3.x","weight":4,"path":"/canigo-documentacio-versions-3x-core/modul-excepcions","content":"## Propòsit\r\n\r\nLa gestió d'excepcions permet informar que s'ha produït un error al realitzar una petició. Aquest error podrà ser tractat adequadament i en cas necessari informar a l'usuari, llençar una traça, enviar un correu, etc.\r\n\r\nLa gestió correcta de les excepcions és molt important i crítica, però generalment la forma en la que es generen i gestionen les excepcions en les aplicacions és un dels aspectes més ignorats en el disseny de les mateixes. L'ús apropiat de les excepcions fa que els nostres aplicatius siguin més robusts, més fàcils de desenvolupar i mantenir, més lliures d'errors i més fàcils d'utilitzar. Per aquest motiu és important que donem el màxim de detall en les excepcions.\r\n\r\nPer evitar l'ús innecessari de blocs 'try-catch' dins el codi dels nostres aplicatius Canigó proporciona un mecanisme d'intercepció, pel qual indicarem quines excepcions volem tractar i quins gestors les tractaran sense haver d'incorporar cap referència a cap classe de l'aplicació.\r\n\r\n## Glossari\r\n\r\n## Instal.lació i configuració\r\n\r\n### Instal.lació\r\n\r\nEl mòdul de configuració s'inclou per defecte dins del core de Canigó 3. Durant el procés de creació de l'aplicació (Struts o JSF), l'eina de suport al desenvolupament inclourà la referència dins del pom.xml. En cas d'una instal- lació manual afegir les següents línies al pom.xml de l'aplicació:\r\n\r\n```\r\n<canigo.core.version>[3.1.0,3.2.0)</canigo.core.version>\r\n<canigo.web.jsf.version>[1.2.0,1.3.0)</canigo.web.jsf.version>\r\n\r\n<dependency>\r\n          <groupId>cat.gencat.ctti</groupId>\r\n          <artifactId>canigo.core</artifactId>\r\n          <version>${canigo.core.version}</version>\r\n</dependency>\r\n\r\n<dependency>\r\n\t<groupId>cat.gencat.ctti</groupId>\r\n\t<artifactId>canigo.web.jsf</artifactId>\r\n\t<version>${canigo.web.jsf.version}</version>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració del servei d'exepcions es configura mitjançant el fitxer de configuració web.xml:\r\n\r\nCaldrà configurar el filtre que interceptarà les peticions:\r\n\r\n```\r\n<filter>\r\n\t<filter-name>ErrorHandler Filter</filter-name>\r\n\t<filter-class>cat.gencat.ctti.canigo.arch.web.jsf.filter.ErrorHandlerFilter</filter-class>\r\n</filter>\r\n<filter-mapping>\r\n\t<filter-name>ErrorHandler Filter</filter-name>\r\n\t<url-pattern>*.jsf</url-pattern>\r\n</filter-mapping>\r\n\r\nTambé es definirà la pantalla d'error genèrica:\r\n\r\n<context-param>\r\n\t<param-name>errorPage</param-name>\r\n\t<param-value>/AppJava/views/error.jsf</param-value>\r\n</context-param>\r\n```\r\n\r\n## Utilització del mòdul\r\n\r\nEl filtre, intercepta totes les peticions a les pàgines JSF. Per defecte el filtre ErrorHandlerFilter que ofereix el framework, el que fa es interceptar qualsevol petició que doni un error del tipus Exception i mostrar la pàgina d'error genèrica definida al web.xml amb la informació de la excepció.\r\n\r\nEl framework defineix una interfície IBaseException, la qual han d'implementar totes les excepcions que es creï la pròpia aplicació. Aquesta interfície simplement defineix que aquesta hagi de tenir un detall de l'error amb informació de l'excepció base, codis d'error i altres propietats.\r\n\r\nEl core de Canigó3 ja incorpora una sèrie d'excepcions definides:    \r\n<br>\r\n\r\n![Imatge de les Excepcions Definides](/related/canigo/documentacio/modul-excepcions/cat.gencat.ctti.canigo.arch.core.exceptions.jpg \"Excepcions definides al mòdul\")","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1leGNlcGNpb25z"},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1pbnN0cnVtZW50YWNpbw==":{"date":1480326267000,"title":"Instrumentació","description":"Mòdul per generar dades d’instrumentació (nombre de peticions, nombre d’errors, …) de l'aplicació.","sections":"Canigó. Documentació versió 3.x","weight":1,"path":"/canigo-documentacio-versions-3x-core/modul-instrumentacio","content":"## Propòsit\r\n\r\nAquest mòdul permet a l'aplicació generar dades d'instrumentació de la seva execució, per tal de poder ser explotades posteriorment amb eines de monitorització.\r\n\r\nDins d'aquest mòdul podem trobar les següents funcionalitats:\r\n\r\n* Instrumentació de les peticions web: nombre de peticions, nombre d'errors i temps mig per petició.\r\n* Instrumentació manual en format log de mètodes de classes aplicatives.\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer tal d'instal-lar el mòdul d'instrumentació es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.operation.instrumentation.version>[1.2.0, 1.3.0)</canigo.operation.instrumentation.version>\r\n\r\n<dependency>\r\n    <groupId>cat.gencat.ctti</groupId>\r\n    <artifactId>canigo.operation.instrumentation</artifactId>\r\n    <version>${canigo.operation.instrumentation.version}</version>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració es realitza automàticament a partir de la eina de suport al desenvolupament.\r\n\r\nL'eina de desenvolupament també genera automàticament el fitxer de propietats necessari per a la configuració del servei.  \r\n\r\nUbicació proposada: <PROJECT_ROOT>/src/main/resources/config/props/instrumentation.properties\r\n\r\n<table>\r\n    <tbody>\r\n        <tr>\r\n            <th><b>Propietat</b></th>\r\n            <th><b>Requerit</b></th>\r\n            <th><b>Descripció</b></th>\r\n        </tr>\r\n        <tr>\r\n            <td> *.instrumentation.interval </td>\r\n            <td> No </td>\r\n            <td> Interval de refresc de les dades instrumentades en l'aplicació de monitorització. Per defecte: 60000 </td>\r\n        </tr>\r\n    </tbody>\r\n</table>\r\n\r\n### Utilització del Mòdul\r\n\r\nPer a utilitzar aquest mòdul, cal instal- lar-lo amb l'eina de desenvolupament.\r\n\r\nA continuació es descriu el mode d'ús per cadascuna de les funcionalitats oferides pel mòdul:\r\n\r\n#### End Point Rest amb les dades de monitorització de l'aplicació\r\n\r\nPer accedir a aquesta interfície l'usuari ha d'introduir les següents URLs al navegador:\r\n\r\n    http:\\\\url_aplicacio\\info\\monitoring\\time\r\n    http:\\\\url_aplicacio\\info\\monitoring\\request\r\n    http:\\\\url_aplicacio\\info\\monitoring\\errors\r\n    \r\nEn aquestes URLs es mostren el temps mig, nombre de peticions i errors respectivament. El format de les dades retornades és JSON.\r\n\r\n<div class=\"message information\">\r\nControl d'accés\r\n\r\nPer defecte, i només si el desenvolupador ha instal- lat el mòdul de seguretat de l'aplicació, aquesta pantalla només serà accessible per a usuaris logats amb rol administrador (ROLE_ADMIN).\r\n</div>\r\n\r\n\r\n#### Eines de revisió de l'estat de l'aplicació\r\n\r\nMitjançant anotacions Java, el desenvolupador pot crear els seus propis punts de control de l'aplicació, per certificar d'una manera ràpida el seu correcte funcionament.\r\n\r\nClasse de servei que serà invocada des del Rest Controller:\r\n\r\n```java\r\n/**\r\n * Check status for several backend\r\n *\r\n * @author\r\n *\r\n */\r\n@Service(\"statusService\")\r\npublic class StatusService {\r\n\r\n\t@Autowired\r\n        private GenericDAO<User, Integer> dao;\r\n\r\n\r\n\t/**\r\n        * Check PSIS\r\n        * @throws IOException\r\n        */\r\n        @CheckStatus\r\n        public void checkPSIS() throws IOException{\r\n\t        URL myUrl = new URL(\"http://psis.catcert.net/psis/catcert/dss\");\r\n         \tURLConnection myConn = (HttpURLConnection)myUrl.openConnection();\r\n        \tmyConn.setRequestProperty(\"User-agent\",\"Mozilla/4.0\");\r\n        \tInputStreamReader is = null;\r\n        \tBufferedReader br = null;\r\n        \ttry{\r\n\t        \tis = new InputStreamReader(myConn.getInputStream());\r\n\t\t        br = new BufferedReader(is);\r\n            \t\tbr.readLine();\r\n          \t}finally{\r\n\t         \tif(is!=null){\r\n\t\t        \tis.close();\r\n          \t\t}\r\n\t          \tif(br!=null){\r\n\t\t        \tbr.close();\r\n           \t\t}\r\n\t         }\r\n         }\r\n\r\n\t/**\r\n\t * Database check\r\n\t */\r\n\t@CheckStatus\r\n\tpublic void checkDataBaseConnection(){\r\n\t\tdao.get(1);\r\n\t}\r\n\r\n\t/**\r\n\t * Always IOException\r\n\t * @throws IOException\r\n\t */\r\n\t@CheckStatus\r\n\tpublic void checkLDAP() throws IOException{\r\n\t  .....\r\n          .....\r\n\t}\r\n\r\n}\r\n```\r\n\r\n<div class=\"message information\">\r\nControl d'excepcions\r\n\r\nLes excepcions dels diferents mètodes de validació han de propagar-se per tal de que Canigó detecti si ha finalitzat en execució correcta o errònia.\r\n</div>\r\n\r\n#### Instrumentació en format log de l'execució de mètodes de l'aplicació\r\n\r\nAmb l'anotació @Trace, el desenvolupador pot marcar un mètode d'una classe gestionada per Spring, i de automàticament aquest generarà traces d'instrumentació de la seva execució:\r\n\r\n```java\r\n@Service(\"myService\")\r\npublic class ServiceImpl implements Service {\r\n\r\n\r\n\t@Trace\r\n\tpublic void doSomething(){\r\n\t\t.....\r\n                .....\r\n\t}\r\n\r\n\r\n}\r\n```\r\n\r\nOn el resultat de l'execució del mètode ens deixarà la següent traça:\r\n\r\n```\r\ncanigo Message: XX XXX 2010 16:45:40,774 INFO  [main] cat.gencat.ctti.canigo.arch.operation.instrumentation.trace.AspectTrace - ea84cbe0-60ff-4ba5-a4e8-d90465101ac3;loc;nodeApp1;0;Service.doSomething();KO;\r\n```\r\n\r\nOn cadascun dels camps separats per coma son:\r\n\r\n* Identificador únic de petició\r\n* Entorn\r\n* Nom node servidor\r\n* Temps d'execució\r\n* Mètode executat\r\n* Resultat de l'execució.\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1pbnN0cnVtZW50YWNpbw=="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1qcGE=":{"date":1541593576000,"title":"Mòdul JPA","description":"Mòdul de persistència de Base de Dades.","sections":"Canigó. Documentació versió 3.x","weight":2,"path":"/canigo-documentacio-versions-3x-core/modul-jpa","content":"## Propòsit\r\n\r\nAquest mòdul proporciona accés amb transaccionalitat amb la base de dades, permetent la execució d'operacions dintre de transaccions.\r\n\r\nAquest mòdul utilitza Spring Data JPA i QueryDSL. Es pot trobar informació sobre aquests frameworks a la documentació de referència:\r\n\r\n* [Spring Data JPA] (https://docs.spring.io/spring-data/jpa/docs/current/reference/html/). \r\n* [QueryDSL] (http://www.querydsl.com/static/querydsl/latest/reference/html/)\r\n\r\n## Instal·lació i Configuració\r\n\r\n### Instal·lació\r\n\r\nEl mòdul de persistència i el corresponent test unitari s'inclou per defecte dins del core de Canigó 3.\r\nDurant el procés de creació de l'aplicació, l'eina de suport al desenvolupament inclourà la referència dins del pom.xml. \r\nEn cas d'una instal- lació manual afegir les següents línies al pom.xml de l'aplicació:\r\n\r\n```\r\n<canigo.persistence.jpa.version>[1.3.0,1.4.0)</canigo.persistence.jpa.version>\r\n<canigo.test.version>[1.2.0,1.3.0)</canigo.test.version>\r\n\r\n<dependency>\r\n\t<groupId>cat.gencat.ctti</groupId>\r\n\t<artifactId>canigo.persistence.jpa</artifactId>\r\n\t<version>${canigo.persistence.jpa.version}</version>\r\n</dependency>\r\n\r\n<dependency>\r\n\t<groupId>cat.gencat.ctti</groupId>\r\n\t<artifactId>canigo.test</artifactId>\r\n\t<version>${canigo.test.version}</version>\r\n\t<scope>test</scope>\r\n</dependency>\r\n\r\n<dependency>\r\n   <groupId>cat.gencat.ctti</groupId>\r\n   <artifactId>canigo.persistence.jpa</artifactId>\r\n   <type>test-jar</type>\r\n   <version>${canigo.persistence.jpa.version}</version>\r\n   <scope>test</scope>\r\n   <classifier>tests</classifier>\r\n</dependency>\r\n```\r\n\r\nAl pom.xml també s'ha d'afegir el plugin que genera les classes per als filtres de [QueryDSL](http://www.querydsl.com/) i\r\nel que executa el test unitari del mòdul de persistència:\r\n```\r\n<build>\r\n\t...\r\n\t<plugins>\r\n\t\t...\r\n\t\t<plugin>\r\n\t\t\t<groupId>com.mysema.maven</groupId>\r\n\t\t\t<artifactId>apt-maven-plugin</artifactId>\r\n\t\t\t<version>1.1.3</version>\r\n\t\t\t<executions>\r\n\t\t\t\t<execution>\r\n\t\t\t\t\t<goals>\r\n\t\t\t\t\t\t<goal>process</goal>\r\n\t\t\t\t\t\t<goal>test-process</goal>\r\n\t\t\t\t\t</goals>\r\n\t\t\t\t\t<configuration>\r\n\t\t\t\t\t\t<outputDirectory>target/generated-sources/java</outputDirectory>\r\n\t\t\t\t\t\t<processor>com.querydsl.apt.jpa.JPAAnnotationProcessor</processor>\r\n\t\t\t\t\t</configuration>\r\n\t\t\t\t</execution>\r\n\t\t\t</executions>\r\n\t\t</plugin>\r\n\t\t<plugin>\r\n\t\t\t<groupId>org.apache.maven.plugins</groupId>\r\n\t\t\t<artifactId>maven-surefire-plugin</artifactId>\r\n\t\t\t<executions>\r\n\t\t\t\t<execution>\r\n\t\t            <id>base-test</id>\r\n\t\t            <phase>test</phase>\r\n\t\t            <goals>\r\n\t\t                <goal>test</goal>\r\n\t\t            </goals>\r\n\t\t            <configuration>\r\n\t\t            \t<dependenciesToScan>\r\n\t\t            \t\t<dependency>cat.gencat.ctti:canigo.persistence.jpa</dependency>\r\n\t\t            \t\t...\r\n\t\t\t\t</dependenciesToScan>\r\n\t\t\t\t<excludes>\r\n\t\t\t\t\t<exclude>%regex[${project.groupId}.*.*Test.*]</exclude>\r\n\t\t\t\t</excludes>\r\n\t\t\t    </configuration>\r\n\t\t        </execution>\r\n\t\t        ...\r\n\t        </executions>\r\n\t\t</plugin>\r\n\t\t...\r\n\t</plugins>\r\n\t...\r\n</build>\t\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració es realitza automàticament a partir de l'eina de suport al desenvolupament (plugin de Canigó per a Eclipse)\r\n\r\nEn cas que no es generi automàticament el codi, s'ha de realitzar manualment la següent configuració:\r\n\r\n**jpa.properties**\r\n\r\nUbicació proposada: <PROJECT_ROOT>/src/main/resources/config/props/jpa.properties\r\n\r\nPropietat | Requerit | Descripció\r\n--------- | -------- | ----------\r\n*.persistence.database | Si | Sistema de base de dades al que es conectarà.\r\n*.persistence.dialect | Si | El nom de classe que permet a JPA generar SQL per a una base de dades relacional en particular. Aquests són els dialectes certificats: org.hibernate.dialect.Oracle12cDialect<br> org.hibernate.dialect.Oracle10gDialect<br> org.hibernate.dialect.Oracle9iDialect<br> org.hibernate.dialect.Oracle8iDialect<br> org.hibernate.dialect.MySQL5Dialect<br> org.hibernate.dialect.MySQLDialect <-- Versions < 5<br> org.hibernate.dialect.HSQLDialect<br> org.hibernate.dialect.PostgreSQLDialect\r\n*.persistence.showSQL | No | Escriu totes les sentències SQL al log aplicatiu.<br> Per defecte: true\r\n*.persistence.generateDdl |No | Exporta el DDL (Data Definition Language) a la BD després que l'EntityManagerFactory s'inicialitzi, creant/actualitzant les taules.<br> Valor per defecte: false\r\n*.persistence.hibernate.connection.release_mode | No | Serveix per especificar quan Hibernate ha d'alliberar les connexions JDBC. Una connexió JDBC es manté fins que la sessió és tancada explícitament o desconnectat per defecte. Per a un datasource JTA s'hauria de seleccionar after_statement, i per non-JTA after_transaction. En mode auto, se seleccionarà after_statement per a JTA i CMT, i afte_transaction per JDBC.<br> Per defecte: auto\r\n*.persistence.hibernate.connection.autocommit | No | Habilita l'autocommit per a connexions pooled JDBC\r\n*.persistence.hibernate.generate_statistics | No | Hibernate recopila informació útil per a tunning.<br> Per defecte: false\r\n*.persistence.hibernate.jdbc.use_scrollable_resultset | No | Habilita l'ús de JDBC2 scrollable resultsets a Hibernate.<br> Per defecte: true\r\n\r\n**persistence.xml**\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/config/persistence/persistence.xml\r\n\r\n```\r\n<persistence xmlns=\"http://java.sun.com/xml/ns/persistence\"\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n\txsi:schemaLocation=\"http://xmlns.jcp.org/xml/ns/persistence http://xmlns.jcp.org/xml/ns/persistence/persistence_2_1.xsd\"\r\n\tversion=\"1.0\">\r\n\r\n\t<persistence-unit name=\"canigo\" transaction-type=\"RESOURCE_LOCAL\"/>\r\n\r\n</persistence>\r\n```\r\n\r\n**app-custom-persistence-jpa.xml**\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/spring/app-custom-persistence-jpa.xml\r\n\r\nExemple del fitxer de configuració per a un base de dades H2:\r\n```\r\n<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\r\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\r\n\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:aop=\"http://www.springframework.org/schema/aop\"\r\n\txmlns:p=\"http://www.springframework.org/schema/p\" xmlns:tx=\"http://www.springframework.org/schema/tx\"\r\n\txmlns:jdbc=\"http://www.springframework.org/schema/jdbc\"\r\n\txmlns:jpa=\"http://www.springframework.org/schema/data/jpa\"\r\n\txsi:schemaLocation=\"http://www.springframework.org/schema/beans \r\n           http://www.springframework.org/schema/beans/spring-beans-4.3.xsd\r\n           http://www.springframework.org/schema/tx \r\n           http://www.springframework.org/schema/tx/spring-tx-4.3.xsd\r\n           http://www.springframework.org/schema/jdbc \r\n           http://www.springframework.org/schema/jdbc/spring-jdbc-4.3.xsd\r\n           http://www.springframework.org/schema/aop \r\n           http://www.springframework.org/schema/aop/spring-aop-4.3.xsd\r\n           http://www.springframework.org/schema/data/jpa\r\n    \t   http://www.springframework.org/schema/data/jpa/spring-jpa.xsd\">\r\n\r\n\t<aop:aspectj-autoproxy />\r\n\t\r\n\t<jpa:repositories base-package=\"cat.gencat.test.repository\" base-class=\"cat.gencat.ctti.canigo.arch.persistence.jpa.repository.impl.JPAGenericRepositoryImpl\"/>\r\n\t\r\n\t<bean id=\"jpaVendorAdapter\" class=\"org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter\">\r\n\t\t<description>\r\n\t\t\tFem servir Hibernate com a motor de persistència per sota de JPA.\r\n\t\t</description>\r\n\t\t<property name=\"showSql\" value=\"true\" />\r\n\t\t<property name=\"generateDdl\" value=\"false\" />\r\n\t\t<property name=\"database\" value=\"${persistence.database}\" />\r\n\t\t<property name=\"databasePlatform\" value=\"${persistence.dialect}\" />\r\n\t</bean>\r\n\r\n\t<tx:advice id=\"txAdvice\">\r\n\t\t<tx:attributes>\r\n\t\t\t<tx:method name=\"get*\" propagation=\"REQUIRED\" read-only=\"true\" />\r\n\t\t\t<tx:method name=\"filter*\" propagation=\"REQUIRED\" read-only=\"true\" />\r\n\t\t\t<tx:method name=\"find*\" propagation=\"REQUIRED\" read-only=\"true\" />\r\n\t\t\t<tx:method name=\"load*\" propagation=\"SUPPORTS\" read-only=\"true\" />\r\n\t\t\t<tx:method name=\"save*\" propagation=\"REQUIRED\" />\r\n\t\t\t<tx:method name=\"update*\" propagation=\"REQUIRED\" />\r\n\t\t\t<tx:method name=\"delete*\" propagation=\"REQUIRED\" />\r\n\t\t\t<tx:method name=\"insert*\" propagation=\"REQUIRED\" />\r\n\t\t</tx:attributes>\r\n\t</tx:advice>\r\n\t\r\n\t<jdbc:embedded-database id=\"dataSource\" type=\"H2\">\r\n\t\t<jdbc:script location=\"classpath:scripts/db-auth-hsqldb-schema.sql\"/>\r\n\t\t<jdbc:script location=\"classpath:scripts/db-auth-hsqldb-data.sql\"/>\r\n\t\t<jdbc:script location=\"classpath:scripts/db-app-hsqldb-schema.sql\"/>\r\n\t\t<jdbc:script location=\"classpath:scripts/db-app-hsqldb-data.sql\"/>\r\n\t</jdbc:embedded-database>\r\n\r\n</beans>\r\n```\r\n\r\nAl tag **jpa:repositories** al paràmetre **base-package** s'ha d'indicar el package on es troben els repositoris de l'aplicació.\r\n\r\n### Ús dels repositoris\r\n\r\nPer a utilitzar els repositoris s'ha de generar un objecte Repository per a l'entitat desitjada(T), que ha d'extendre de **cat.gencat.ctti.canigo.arch.persistence.jpa.repository.GenericRepository<T, ID extends Serializable>**\r\n\r\n\tpublic interface EquipamentRepository extends GenericRepository<Equipament, Long>{\r\n\r\n\t}\r\n\r\n#### Construcció de queries automàtiques\r\n\r\nA un repositori es poden definir mètodes per cada query que es vulgui definir. La construcció utilitza els prefixos find...By, read...By, query...By, count...By i get...By. El mètode pot incoporar la paraula Distinct, concatenar propietats amb And i Or o descriptors com OrderBy o IgnoreCase.\r\n\r\nExemples:\r\n\r\n    List<Equipament> findDistinctByNomOrMunicipi(String nom, String municipi);\r\n\tList<Equipament> findByNomIgnoreCase(String nom);\r\n\tList<Equipament> findByMunicipiOrderByNomDesc(String municipi);\r\n\r\n\r\nMés informació a la documentació oficial de [Spring Data JPA](http://docs.spring.io/spring-data/jpa/docs/current/reference/html/).\r\n\r\n#### Utilització de QueryDSL\r\n\r\nUna de les funcionalitats proposades és la d'utilitzar QueryDSL per a realitzar cerques segons filtres dinàmics, amb paginació i/o ordenació.\r\n\r\nEl GenericRepository proporciona el següent mètode:\r\n\r\n```\r\nPage<T> findAll(Predicate predicate, Pageable pageable);\r\n```\r\n\r\nAquest mètode espera un objecte org.springframework.data.domain.Pageable que conté el número de pàgina (la primera pàgina és la 0), el nombre d'elements per pàgina, la direcció d'ordenació, el camp d'ordenació. I un objecte Predicate amb la query a realitzar que es construeix de la següent manera:\r\n\r\nPrimer de tot el filtre ha de ser un String amb el següent patró:\r\n\r\n**field1Operador1Valor1,field2Operador2Valor2,fieldNOperadorNValorN**\r\n\r\n- on Field és el nom d'una propietat de l'entitat (per exemple id)<br>\r\n- on Operador és un dels tipus d'operador suportats:\r\n\r\nOperador | Descripció\r\n--------- | --------\r\n> | major que\r\n>: | major o igual que\r\n< | menor que\r\n<: | menor o igual que\r\n<> | diferent de\r\n: | igual que\r\n\r\n- on valor és el valor amb el qual es vol comparar.\r\n\r\nPer exemple, per cercar l'entitat que tingui id major que 15 i amb nom igual a 'Prova' el filtre hauria de ser el següent:<br>\r\nid>15,nom:Prova\r\n\r\n#### Projecció de resultats\r\n\r\nAmb QueryDSL també es poden realitzar cerques que en comptes de retornar l'objecte sencer, retorni només determinats camps de l'objecte desitjat, els camps no seleccionats els retorna amb valor null<br>\r\n\r\nPer a utilitzar les projeccions el GenericRepository proporciona el següent mètode:\r\n```\r\nPage<T> findAll(FactoryExpression<T> factoryExpression, Predicate predicate, Pageable pageable);\r\n```\r\n\r\nEl codi següent retorna una llista dels objectes Equipaments amb nom INDOORKARTING, però aquests objectes només tindran el camp nom.\r\n\r\n```\r\nString search = \"nom:INDOORKARTING\";\r\n\t\t\r\nPageable pageable = new PageRequest(0, 5, Sort.Direction.DESC, \"nom\");\r\nGenericPredicateBuilder<Equipament> builder = new GenericPredicateBuilder<Equipament>(Equipament.class, \"equipament\");\r\nbuilder.populateSearchCriteria(search);\r\n\t\t\r\nQEquipament qequipament = QEquipament.equipament;\r\n\t\r\nPage<Equipament> page = repository.findAll(Projections.bean(Equipament.class, qequipament.nom ), builder.build(), pageable);\r\n```\r\n\r\nMés informació a la documentació oficial de [QueryDSL](http://www.querydsl.com/static/querydsl/latest/reference/html/).\r\n\r\n#### Batch Inserts/Update\r\n\r\nLa classe GenericRepository també proporciona un mètode per a realitzar inserts/updates de forma massiva amb un rendiment òptim:\r\n\r\n\tpublic <S extends T> List<S> bulkSave(Iterable<S> entities);\r\n\t\r\nEs pot veure un exemple de com utilitzar aquesta classe al següent [howto] (/drafts/2017-03-Howto-SaveBatch-Canigo32)\r\n### Exemple \r\n\t\r\nPer exemple a l'aplicació inicial que genera el plugin de Canigó es generen els següents fitxers:\r\n\r\n**Equipament.java**\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/java/cat/gencat/test/model/Equipament.java\r\n```\r\npackage cat.gencat.test.model;\r\n\r\nimport javax.persistence.Column;\r\nimport javax.persistence.Entity;\r\nimport javax.persistence.Id;\r\nimport javax.persistence.Table;\r\n\r\n@Entity\r\n@Table(name = \"equipaments\")\r\npublic class Equipament {\r\n\r\n\tprivate Long id;\r\n\tprivate String nom;\r\n\tprivate String municipi;\r\n\r\n\tpublic Equipament() {\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic Equipament(Long id) {\r\n\t\tthis.id =id;\r\n\t}\r\n\t\r\n\t@Id\r\n\t@Column(name = \"id\", nullable = false, unique = true)\r\n\tpublic Long getId() {\r\n\t\treturn id;\r\n\t}\r\n\r\n\tpublic void setId(Long id) {\r\n\t\tthis.id = id;\r\n\t}\r\n\r\n\t\r\n\t@Column(name = \"nom\", nullable = false, unique = true)\r\n\tpublic String getNom() {\r\n\t\treturn nom;\r\n\t}\r\n\r\n\tpublic void setNom(String nom) {\r\n\t\tthis.nom = nom;\r\n\t}\r\n\r\n\t@Column(name = \"municipi\")\r\n\tpublic String getMunicipi() {\r\n\t\treturn municipi;\r\n\t}\r\n\r\n\tpublic void setMunicipi(String municipi) {\r\n\t\tthis.municipi = municipi;\r\n\t}\t\r\n\t\r\n\t@Override\r\n\tpublic String toString() {\r\n\t\treturn \"Equipament [nom=\" + nom + \"]\";\r\n\t}\r\n}\r\n```\r\n\r\n**EquipamentRepository**\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/java/cat/gencat/test/repository/EquipamentRepository.java\r\n```\r\npackage cat.gencat.test.repository;\r\n\r\nimport java.util.List;\r\n\r\nimport org.springframework.data.domain.Page;\r\nimport org.springframework.data.domain.Pageable;\r\n\r\nimport com.querydsl.core.types.FactoryExpression;\r\nimport com.querydsl.core.types.Predicate;\r\n\r\nimport cat.gencat.test.model.Equipament;\r\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.repository.GenericRepository;\r\n\r\npublic interface EquipamentRepository extends GenericRepository<Equipament, Long> {\r\n\r\n\tPage<Equipament> findAll(Predicate predicate, Pageable pageable);\r\n\t\r\n\tPage<Equipament> findAll(FactoryExpression<Equipament> factoryExpression, Predicate predicate, Pageable pageable);\r\n\t\r\n    List<Equipament> findDistinctByNomOrMunicipi(String nom, String municipi);\r\n\tList<Equipament> findByNomIgnoreCase(String nom);\r\n\tList<Equipament> findByMunicipiOrderByNomDesc(String municipi);\r\n}\r\n```\r\n\r\n**EquipamentService**\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/java/cat/gencat/test/service/EquipamentService.java\r\n```\r\npackage cat.gencat.test.service;\r\n\r\nimport java.util.List;\r\n\r\nimport org.springframework.beans.factory.annotation.Autowired;\r\nimport org.springframework.context.annotation.Lazy;\r\nimport org.springframework.data.domain.Page;\r\nimport org.springframework.data.domain.PageRequest;\r\nimport org.springframework.data.domain.Pageable;\r\nimport org.springframework.data.domain.Sort;\r\nimport org.springframework.data.domain.Sort.Direction;\r\nimport org.springframework.stereotype.Service;\r\n\r\nimport com.querydsl.core.types.Projections;\r\n\r\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.querydsl.GenericPredicateBuilder;\r\nimport cat.gencat.test.model.Equipament;\r\nimport cat.gencat.test.model.QEquipament;\r\nimport cat.gencat.test.repository.EquipamentRepository;\r\n\r\n@Service(\"equipamentService\")\r\n@Lazy\r\npublic class EquipamentService {\r\n\r\n\t@Autowired\r\n\tprivate EquipamentRepository repository;\r\n\t\r\n\tpublic List<Equipament> findAll() {\r\n\t\treturn repository.findAll();\r\n\t}\r\n\r\n\tpublic Page<Equipament> findPaginated(Pageable pageable, String filter) {\r\n\t\t\r\n\t\tGenericPredicateBuilder<Equipament> builder = new GenericPredicateBuilder<Equipament>(Equipament.class, \"equipament\");\r\n\t\tbuilder.populateSearchCriteria(filter);\r\n\t\t\r\n\t\treturn repository.findAll(builder.build(), pageable);\r\n\t}\r\n\t\r\n\tpublic Page<Equipament> findPaginatedProjeccio(Pageable pageable, String filter) {\r\n\t\t\r\n\t\tGenericPredicateBuilder<Equipament> builder = new GenericPredicateBuilder<Equipament>(Equipament.class, \"equipament\");\r\n\t\tbuilder.populateSearchCriteria(filter);\r\n\t\t\r\n\t    QEquipament qequipament = QEquipament.equipament;\r\n\t    \r\n\t    return repository.findAll(Projections.bean(Equipament.class, qequipament.nom ), builder.build(), pageable);\r\n\t}\r\n\r\n\tpublic Equipament getEquipament(Long equipamentId) {\r\n\t\treturn repository.findOne(equipamentId);\r\n\t}\r\n\r\n\tpublic Long saveEquipament(Equipament equipament) {\r\n\t\trepository.save(equipament);\r\n\r\n\t\treturn equipament.getId();\r\n\t}\r\n\r\n\tpublic void updateEquipament(Equipament equipament) {\r\n\t\trepository.save(equipament);\r\n\t}\r\n\r\n\tpublic void deleteEquipament(Long equipamentId) {\r\n\t\tEquipament equipament = new Equipament(equipamentId);\r\n\t\trepository.delete(equipament);\r\n\t}\r\n\r\n}\r\n```\r\n\r\n### Test\r\n\r\nPer executar els tests del mòdul jpa al executar els test de l'aplicació és necessari incorporar la dependencia test-jar del mòdul en el pom:\r\n```\r\n...\r\n\t\t<dependency>\r\n\t\t   <groupId>cat.gencat.ctti</groupId>\r\n\t\t   <artifactId>canigo.persistence.jpa</artifactId>\r\n\t\t   <type>test-jar</type>\r\n\t\t   <version>${canigo.persistence.jpa.version}</version>\r\n\t\t   <scope>test</scope>\r\n\t\t   <classifier>tests</classifier>\r\n\t\t</dependency>\r\n...\r\n```\r\n\r\n**persistence.xml**\r\n\r\nUbicació: <PROJECT_ROOT>/src/test/resources/config/persistence/persistence.xml\r\nÉs necessari afegir les entitats del mòdul jpa i les entitats de l'aplicació al fitxer persistence.xml:\r\n\r\n```\r\n<persistence xmlns=\"http://java.sun.com/xml/ns/persistence\"\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n\txsi:schemaLocation=\"http://xmlns.jcp.org/xml/ns/persistence http://xmlns.jcp.org/xml/ns/persistence/persistence_2_1.xsd\"\r\n\tversion=\"1.0\">\r\n\r\n\t<persistence-unit name=\"canigo\" transaction-type=\"RESOURCE_LOCAL\">\r\n\t\t<class>cat.gencat.test.model.Equipament</class>  \r\n\t\t<class>cat.gencat.ctti.canigo.arch.persistence.jpa.repository.Person</class> \r\n\t\t<class>cat.gencat.ctti.canigo.arch.persistence.jpa.dao.Account</class>\r\n\t\t<class>cat.gencat.ctti.canigo.arch.persistence.jpa.model.json.postgres.EventJson</class>\r\n\t\t<class>cat.gencat.ctti.canigo.arch.persistence.jpa.model.json.postgres.EventJsonb</class>\r\n\t\t<class>cat.gencat.ctti.canigo.arch.persistence.jpa.model.json.postgres.EventJsonbNode</class>\r\n\t\t<class>cat.gencat.ctti.canigo.arch.persistence.jpa.model.json.mysql.EventJson</class>\r\n\t</persistence-unit>\r\n\r\n</persistence>\r\n```\r\n\r\nOn:\r\n- cat.gencat.test.model.Equipament és l'entitat de l'aplicació\r\n- cat.gencat.ctti.canigo.arch.persistence.jpa.* son les entitats del mòdul jpa\r\n\r\nAmb aquests canvis s'executaran els test del mòdul al executar els tests de l'aplicació\r\n\r\n## Suport pel tipus de dada JSON\r\n\r\nDes de la versió 1.3.1 del mòdul de persistència el tipus de dada JSON està suportat per MySQL i per PostgreSQL, fent la transformació entre JSON i l'objecte mapejat de manera automàtica.\r\n\r\nPer fer ús només cal seguir els següents passos:\r\n\r\n1. Anotar l'entitat (o una superclasse) amb `@org.hibernate.annotations.TypeDef` per definir el/els àlies de mapeig.\r\n2. Anotar el camp de l'entitat amb `@org.hibernate.annotations.Type(type = \"json\")` com al següent exemple:\r\n\r\nUn exemple senzill seria el següent:\r\n\r\n```java\r\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.hibernate.type.json.JsonBinaryType;\r\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.hibernate.type.json.JsonNodeBinaryType;\r\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.hibernate.type.json.JsonStringType;\r\n\r\nimport org.hibernate.annotations.Type;\r\nimport org.hibernate.annotations.TypeDef;\r\nimport org.hibernate.annotations.TypeDefs;\r\n\r\nimport javax.persistence.Column;\r\nimport javax.persistence.Entity;\r\nimport javax.persistence.Table;\r\n\r\n@TypeDefs({ @TypeDef(name = \"json\", typeClass = JsonStringType.class),\r\n\t\t@TypeDef(name = \"jsonb\", typeClass = JsonBinaryType.class),\r\n\t\t@TypeDef(name = \"jsonb-node\", typeClass = JsonNodeBinaryType.class), })\r\n@Entity(name = \"MyCustomer\")\r\n@Table(name = \"customer\")\r\npublic class MyCustomer {\r\n\r\n\t@Type(type = \"json\")\r\n\t@Column\r\n\tprivate ComplexCustomerData complexCustomerData;\r\n\r\n\tpublic ComplexCustomerData getComplexCustomerData() {\r\n\t\treturn complexCustomerData;\r\n\t}\r\n\t\r\n\tpublic void setComplexCustomerData(ComplexCustomerData complexCustomerData) {\r\n\t\tthis.complexCustomerData =complexCustomerData;\r\n\t}\r\n}\r\n```\r\n\r\nNOTA: La definició SQL d'un camp de tipus JSON no és estandard i s'ha de consultar la documentació de la BBDD.\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1qcGE="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1sb2dnaW5nLWFkbWlu":{"date":1427449467000,"title":"Administració de logs","description":"Mòdul per administrar els logs de l'aplicació","sections":"Canigó. Documentació versió 3.x","weight":11,"path":"/canigo-documentacio-versions-3x-core/modul-logging-admin","content":"## Propòsit\r\n\r\nAquest mòdul permet administrar els logs de l'aplicació proporcionant les següents funcionalitats:\r\n\r\n* Canviar en calent el nivell de log dels diferents paquets de l'aplicació\r\n* Visualització de fitxers de logs en temps real mitjançant streaming amb WebSockets\r\n* Descarregar els fitxers de logs\r\n\r\n## Instal·lació i Configuració\r\n\r\n### Instal·lació\r\n\r\nLa instal·lació del Mòdul d'Administració de Logs es pot incloure automàticament a través del [Plugin de Canigó per a Eclipse](/related/canigo/howto/Canigo - HowTo - Generacio aplicacio Canigo 3.1 amb plugin Eclipse.pdf), o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.operation.logging.version>[1.1.0,1.2.0)</canigo.operation.logging.version>\r\n\r\n<dependency>\r\n    <groupId>cat.gencat.ctti</groupId>\r\n    <artifactId>canigo.operation.logging</artifactId>\r\n    <version>${canigo.operation.logging.version}</version>\r\n</dependency>\r\n```\r\nAquest mòdul requereix Java 7, per tant, cal tenir la següent configuració per la compilació amb Maven:\r\n\r\n```\r\n<plugin>\r\n    <artifactId>maven-compiler-plugin</artifactId>\r\n    <configuration>\r\n        <source>1.7</source>\r\n        <target>1.7</target>\r\n    </configuration>\r\n</plugin>\r\n```\r\n\r\n### Configuració\r\n\r\n#### Client\r\n\r\nSi s'utilitza el Plugin de Canigó per a Eclipse s'instal·la automàticament una plana \"loggingAdministration.html\" dins l'aplicació.  En cas de realitzar la instal·lació de forma manual s'ha de descarregar la [part estàtica](/related/canigo/documentacio/modul-logging/canigo.operation.logging_static.zip).\r\n\r\n<div class=\"message warning\">\r\nDes del CS Canigó no es realitzen adaptacions al <a href=\"http://www.gencat.cat/web/guies/estil/\">PIV de la Generalitat de Catalunya</a>. És responsabilitat del proveïdor d'aplicacions fer les adaptacions necessàries segons els requeriments que tingui l'aplicació.\r\n</div>\r\n\r\nEl contingut estàtic està preparat per a ser ubicat al directori `<aplicacio>\\src\\main\\webapp\\`. Si es vol canviar aquesta ubicació s'han de modificar les URLs existents en aquests fitxers.\r\n\r\n##### Keep Alive\r\n\r\nEl client implementa un procés de \"keep alive\" que s'executa cada 30 minuts. D'aquesta manera el servidor el considerarà com a actiu mentre no es tanqui aquesta plana \"loggingAdministration.html\".\r\n\r\n#### Servidor\r\n\r\nAquesta és l'API REST que publica el Mòdul d'Administració de Logs:\r\n\r\n * `<appContext>/api/logs/list` (GET): mostra la llista de loggers i els nivells (DEBUG, INFO, ERROR, FATAL, WARN)\r\n * `<appContext>/api/logs/appenders` (GET): mostra la llista d'appenders de tipus file\r\n * `<appContext>/api/logs/change` (PUT): canvia el nivell d'un logger\r\n * `<appContext>/api/logs/startwatch` (PUT): comença a monitorizar un fitxer de log\r\n * `<appContext>/api/logs/stopwatch`(PUT): deixa de monitorizar un fitxer de log\r\n * `<appContext>/api/logs/keepwatch`(PUT): missatge de monitorització activa (keep alive) per un fitxer de log\r\n * `<appContext>/api/logs/downloadLog/{index}` (GET): descarrega d'un fitxer de log\r\n\r\nSpringBoot per defecte no permeteix peticions PUT, per a que es puguin realitzar al fitxer WebSecurityConfig, mètode configure s'ha d'afegir:\r\n\r\n```\r\n\thttp.csrf().ignoringAntMatchers(\"/api/logs/**\");\r\n```\r\n\r\nPer tal d'evitar un deadlock en l'escriptura de logs a fitxer i el corresponent enviament de missatge a client, cal realitzar la següent configuració en el fitxer de configuració log4j.xml:\r\n\r\n```\r\n<category name=\"org.springframework.messaging.simp.broker.SimpleBrokerMessageHandler\">\r\n  <level value=\"off\" />\r\n</category>\r\n```\r\nAquesta configuració només serà necessària en cas que els logs de Spring s'escriguin en un appender de tipus file.\r\n\r\n##### Alliberament de recursos\r\n\r\nEl mòdul executa un procés cada 45 minuts que valida si s'ha rebut algun missatge de \"keep alive\" d'algun client per els fitxers de log configurats en l'aplicació. En cas que no haver rebut cap missatge per un fitxer de log concret en aquest periode de 45 minuts s'alliberaran els recursos associats per a la monitorització d'aquell fitxer (watcher thread).\r\n\r\n### Utilització del Mòdul\r\n\r\nPer a utilitzar el mòdul s'ha de desplegar l'aplicació i accedir-hi a `http://<host>:<port>/<appContext>/loggingAdministration.html`. Per exemple: `http:\\\\localhost:8080\\aplicacioProva\\loggingAdministration.html`\r\n\r\n![Pantalla Configuració nivells de log](/related/canigo/documentacio/modul-logging/configuracio_nivell_logs.png \"Configuració nivells de log\")\r\n\r\nLa pantalla inicial mostra els paquets de l'aplicació. Amb els botons DEBUG - INFO - ERROR - FATAL - WARN es pot modificar els nivell de log de cada paquet.\r\n\r\n\r\n![Pantalla Visualització fitxers de log](/related/canigo/documentacio/modul-logging/visualitzacio_fitxers_log.png \"Visualització fitxers de log\")\r\n\r\nEn aquesta segona pestanya es pot seleccionar el fitxer de log que es desitgi monitoritzar, prement el botó Connectar, o descarregar amb el botó Descarregar.\r\n\r\nAmb el cercador es pot resaltar en groc el text que es desitgi trobar.\r\n\r\n### Consideracions de seguretat\r\n\r\nEs recomana que aquest mòdul es securitzi per a que només els usuaris amb rol Administrador puguin accedir-hi, tant a la plana html, com als serveis REST del backend proporcionats al mòdul.\r\n\r\n### Demo\r\n\r\nDes del CS Canigó es proporciona una aplicació de demo d'aquest nou mòdul. Podeu trobar el codi font en el següent [repositori de Github](https://github.com/gencat/demoAdminLogs).\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1sb2dnaW5nLWFkbWlu"},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1tb25nb2Ri":{"date":1553166256000,"title":"Mòdul MongoDB","description":"Mòdul de persistència de Base de Dades per MongoDB.","sections":"Canigó. Documentació versió 3.x","weight":3,"path":"/canigo-documentacio-versions-3x-core/modul-mongodb","content":"## Propòsit\n\nAquest mòdul proporciona accés i l'execució d'operacions a una base de dades Mongodb.\n\nAquest mòdul utilitza Spring Data MongoDB i QueryDSL. Es pot trobar informació sobre aquests frameworks a la documentació de referència:\n\n* [Spring Data Mongo](https://docs.spring.io/spring-data/mongodb/docs/current/reference/html/). \n* [QueryDSL](http://www.querydsl.com/static/querydsl/latest/reference/html/)\n\nA partir de la versió 3.4 de Canigó, s'ha proporcionat les funcionalitats de reactiu per Mongodb\n\n## Instal·lació\n\nEs pot afegir el mòdul MongoDB a una aplicació ja generada a partir de l'eina de suport al desenvolupador. L'eina de suport al desenvolupador inclourà la referència i les dependències dins del pom.xml.\nEn cas d'una instal- lació manual afegir les següents línies al pom.xml de l'aplicació:\n\n```\n    <canigo.persistence.mongodb.version>[2.0.0,2.1.0)</canigo.persistence.mongodb.version>\n\n    <dependency>\n      <groupId>cat.gencat.ctti</groupId>\n      <artifactId>canigo.persistence.mongodb</artifactId>\n      <version>${canigo.persistence.mongodb.version}</version>\n    </dependency>\n```\n\nAl pom.xml també s'ha d'afegir el plugin que genera les classes per als filtres de [QueryDSL](http://www.querydsl.com/) i\nel que executa el test unitari del mòdul de persistència:\n```\n<build>\n\t...\n\t<plugins>\n\t\t...\n\t\t<plugin>\n\t\t\t<groupId>com.mysema.maven</groupId>\n\t\t\t<artifactId>apt-maven-plugin</artifactId>\n\t\t\t<version>1.1.3</version>\n\t\t\t<executions>\n\t\t\t...\n    \t\t\t<execution>\n                    <id>org.springframework.data.mongodb.repository.support.MongoAnnotationProcessor</id>\n                    <goals>\n                      <goal>process</goal>\n                      <goal>test-process</goal>\n                    </goals>\n                    <configuration>\n                      <outputDirectory>target/generated-sources/java</outputDirectory>\n                      <processor>org.springframework.data.mongodb.repository.support.MongoAnnotationProcessor</processor>\n                    </configuration>\n                </execution>\n\t\t\t...\n\t\t\t</executions>\n\t\t</plugin>\n\t\t...\n\t</plugins>\n\t...\n</build>\t\n```\nSi l'aplicació està configurada amb Spring Boot es necessari afegir la dependencia:\n```\n    <dependency>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-data-mongodb</artifactId>\n        <exclusions>\n            <exclusion>\n              <artifactId>spring-boot-starter-logging</artifactId>\n              <groupId>org.springframework.boot</groupId>\n            </exclusion>\n        </exclusions>\n    </dependency>\n```\n\nSi es vol utilitzar Embeded Mongo per executar els tests es necessari afegir la dependencia:\n```\n    <dependency>\n        <groupId>de.flapdoodle.embed</groupId>\n        <artifactId>de.flapdoodle.embed.mongo</artifactId>\n    </dependency>\n    <dependency>\n        <groupId>cz.jirutka.spring</groupId>\n        <artifactId>embedmongo-spring</artifactId>\n        <version>RELEASE</version>\n    </dependency>\n```\n\n## Configuració\n\nLa configuració es realitza automàticament a partir de l'eina de suport al desenvolupament (plugin de Canigó per a Eclipse)\n\nEn cas que no es generi automàticament el codi, s'ha de realitzar manualment la següent configuració:\n\n### Configuració no reactiu\n\n**mongodb.properties**\n\nUbicació proposada: <PROJECT_ROOT>/src/main/resources/config/props/mongodb.properties\n\nPropietat | Requerit | Descripció\n--------- | -------- | ----------\n*.mongodb.uri | Si | URL de connexió amb la BD MongoDB. Per més informació http://api.mongodb.com/java/current/com/mongodb/MongoClientURI.html\n*.mongodb.host | No | Requerit si no està definida la propietat mongodb.uri. Host de la connexió amb la BD MongoDB\n*.mongodb.port | No | Requerit si no està definida la propietat mongodb.uri. Port de la connexió amb la BD MongoDB\n*.mongodb.database | No | Requerit si no està definida la propietat mongodb.uri. Nom de la BD de la connexió amb la BD MongoDB\n*.mongodb.authenticationDatabase | No | Requerit si no està definida la propietat mongodb.uri. Nom de la BD MongoDB si esta autenticada\n*.mongodb.username | No | Requerit si no està definida la propietat mongodb.uri. Usuari de la connexió amb la BD MongoDB\n*.mongodb.password | No | Requerit si no està definida la propietat mongodb.uri. Secret de la connexió amb la BD MongoDB\n\n\n**MongoConfig.java**\n\nUbicació recomenada: <PROJECT_ROOT>/src/main/java/ *package de l'aplicacio* /mongodb/config\n\nEs necessari crear l'arxiu de configuració de l'aplicació per a MongoDB. Es necessari extendre de la configuració de **cat.gencat.ctti.canigo.arch.persistence.mongodb.config.MongoCoreConfig**\n\nEn aquest fitxer de configuració s'hi pot sobreesciure la configuració de la connexió per defecte utilitzant el constructor\n```\npublic MongoCoreConfig(MongoClientOptions options). \n```\nPer més informació sobre les configuracions es pot consultar: http://api.mongodb.com/java/current/com/mongodb/MongoClientOptions.html\n\nEn aquest fitxer també s'hi pot afegir els diferents listeners de les diferents entitats de MongoDB\n\nUn exemple de fitxer de configuració seria:\n```\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\nimport com.mongodb.MongoClientOptions;\n\nimport cat.gencat.ctti.canigo.arch.persistence.mongodb.repository.MongoEquipamentListener;\n\n@Configuration\npublic class EquipamentMongoConfig extends MongoCoreConfig {\n\n\tprotected static MongoClientOptions mongoClientOptions;\n\n\tpublic EquipamentMongoConfig() {\n\t\tsuper(mongoOptions());\n\t}\n\n\t@Bean\n\tpublic MongoEquipamentListener mongoEquipamentListener() {\n\t\treturn new MongoEquipamentListener();\n\t}\n\n\t@Bean\n\tpublic static MongoClientOptions mongoOptions() {\n\t\tif (mongoClientOptions == null) {\n\t\t\tmongoClientOptions = MongoClientOptions.builder().socketTimeout(2000).build();\n\t\t}\n\t\treturn mongoClientOptions;\n\t}\n\n}\n```\nOn s'està redefinit el socket time out de la connexió a 2000 ms i s'està registrant el listener cat.gencat.demo.mongodb.model.repository.MongoEquipamentListener\n\n### Configuració reactiu\n\n**mongodb.properties**\n\nUbicació proposada: <PROJECT_ROOT>/src/main/resources/config/props/mongodb.properties\n\nPropietat | Requerit | Descripció\n--------- | -------- | ----------\n*.mongodb.uri | Si | URL de connexió amb la BD MongoDB. Per més informació https://docs.mongodb.com/manual/reference/connection-string/#connection-string-options\n\n**ReactiveMongoConfig.java**\n\nUbicació recomenada: <PROJECT_ROOT>/src/main/java/ *package de l'aplicacio* /mongodb/config\n\nEs necessari crear l'arxiu de configuració de l'aplicació per a reactive MongoDB. Es necessari extendre de la configuració de **cat.gencat.ctti.canigo.arch.persistence.mongodb.config.ReactiveMongoCoreConfig**\n\nEn aquest fitxer també s'hi pot afegir els diferents listeners de les diferents entitats de MongoDB\n\nUn exemple de fitxer de configuració seria:\n```java\n\nimport org.springframework.context.annotation.Configuration;\n\nimport cat.gencat.ctti.canigo.arch.persistence.mongodb.config.ReactiveMongoCoreConfig;\n\n@Configuration\npublic class ReactiveMongoConfig extends ReactiveMongoCoreConfig {\n\n\n}\n```\n\n## Entitats\nPer definir les entits de MongoDB es necessari utilitzar les annotations de JSR 380, Spring Data i Spring Data MongoDB. Per més informació:\nhttps://docs.oracle.com/javaee/7/api/javax/validation/package-summary.html\nhttps://docs.spring.io/spring-data/commons/docs/current/api/org/springframework/data/annotation/package-summary.html\nhttps://docs.spring.io/spring-data/mongodb/docs/current/reference/html/\n\nUn exemple de entitat de MongoDB seria:\n```\nimport javax.validation.constraints.NotNull;\n\nimport org.springframework.data.annotation.Id;\nimport org.springframework.data.mongodb.core.index.Indexed;\nimport org.springframework.data.mongodb.core.mapping.Document;\n\n@Document(collection = \"Equipament\")\npublic class MongoEquipament {\n\t\n\tpublic static final String ID = \"id\";\n\tpublic static final String NOM = \"nom\";\n\tpublic static final String MUNICIPI = \"municipi\";\n\n\t@Id\n\tprivate Long id;\n\n\t@Indexed(unique = true)\n\t@NotNull(message = \"MongoEquipament's nom must not be null\")\n\tprivate String nom;\n\n\tprivate String municipi;\n\n\tpublic Long getId() {\n\t\treturn id;\n\t}\n\n\tpublic void setId(Long id) {\n\t\tthis.id = id;\n\t}\n\n\tpublic String getNom() {\n\t\treturn nom;\n\t}\n\n\tpublic void setNom(String nom) {\n\t\tthis.nom = nom;\n\t}\n\n\tpublic String getMunicipi() {\n\t\treturn municipi;\n\t}\n\n\tpublic void setMunicipi(String municipi) {\n\t\tthis.municipi = municipi;\n\t}\n\n}\n```\n\n## Ús dels repositoris\n\nPer a utilitzar els repositoris s'ha de generar un objecte MongoRepository per a l'entitat desitjada(T), que ha d'extendre de **cat.gencat.ctti.canigo.arch.persistence.mongodb.repository.MongoGenericRepository<T, ID extends Serializable>**\n\nUn exemple de repository seria:\n```\nimport java.util.List;\n\nimport org.springframework.data.domain.Sort;\nimport org.springframework.data.mongodb.repository.Query;\n\nimport cat.gencat.ctti.mongodb.model.MongoEquipament;\nimport cat.gencat.ctti.canigo.arch.persistence.mongodb.repository.MongoGenericRepository;\n\npublic interface EquipamentMongoRepository extends MongoGenericRepository<MongoEquipament, Long>{\n\n\t@Query(\"{ nom: ?0 }\")\n\tList<MongoEquipament> findByNomQuery(String nom);\n\n\tList<MongoEquipament> findByNomLike(String nom, Sort sort);\n\n\n}\n```\n\nA un repositori es poden definir mètodes per cada query que es vulgui definir. La construcció utilitza els prefixos find...By, read...By, query...By, count...By i get...By. El mètode pot incoporar la paraula Distinct, concatenar propietats amb And i Or o descriptors com OrderBy o IgnoreCase.\n\nMés informació a la documentació oficial de [Spring Data MongoDB] (https://docs.spring.io/spring-data/mongodb/docs/current/reference/html/)\n\n#### Utilització de QueryDSL\n\nUna de les funcionalitats proposades és la d'utilitzar QueryDSL per a realitzar cerques segons filtres dinàmics, amb paginació i/o ordenació.\n\nEl MongoGenericRepository proporciona els següents mètodes:\n\n```\n\tPage<T> findAll(Predicate predicate, Pageable pageable, Path<?>... paths);\n\n\tPage<T> findAll(Predicate predicate, Pageable pageable, List<Path<?>> paths);\n\t\n\tPage<T> findAll(Predicate predicate, Pageable pageable, FactoryExpression<T> factoryExpression);\n```\n\nAquests mètodes espera un objecte org.springframework.data.domain.Pageable que conté el número de pàgina (la primera pàgina és la 0), el nombre d'elements per pàgina, la direcció d'ordenació, el camp d'ordenació. Un objecte Predicate amb la query que es vol realitzar i un objecte Path o FactoryExpression on s'indica la informació que es vol retornar\n\nUn exemple d'utilització seria:\n```\nList<MongoEquipament> mongoEquipamentList = repository.findAll(QMongoEquipament.mongoEquipament.nom.isNotNull().and(QMongoEquipament.mongoEquipament.nom.isNotEmpty())\n\t\t\t\t\t\t.and(QMongoEquipament.mongoEquipament.municipi.isNotNull())\n\t\t\t\t\t\t.and(QMongoEquipament.mongoEquipament.municipi.isNotEmpty())\n\t\t\t\t\t\t.and(QMongoEquipament.mongoEquipament.nom.equalsIgnoreCase(\"findPaginatedPath\")),\n\t\t\t\tnew PageRequest(0, 10), paths).getContent();\n```\n\nEs pot utitlizar les utilitzats de **cat.gencat.ctti.canigo.arch.persistence.core.querydsl.GenericPredicateBuilder** per generar el Predicate, per exemple:\n```\n    GenericPredicateBuilder<MongoEquipament> builder = new GenericPredicateBuilder<MongoEquipament>(\n\t\t\t\tMongoEquipament.class, \"equipament\");\n\tbuilder.populateSearchCriteria(filter);\n\tPredicate predicate = builder.build();\n```\n\nOn el String filter ha de seguir el patró:\n\n**field1Operador1Valor1,field2Operador2Valor2,fieldNOperadorNValorN**\n\n- on Field és el nom d'una propietat de l'entitat (per exemple id)<br>\n- on Operador és un dels tipus d'operador suportats:\n\nOperador | Descripció\n--------- | --------\n> | major que\n>: | major o igual que\n< | menor que\n<: | menor o igual que\n<> | diferent de\n: | igual que\n\n- on valor és el valor amb el qual es vol comparar.\n\nPer exemple, per cercar l'entitat que tingui id major que 15 i amb nom igual a 'Prova' el filtre hauria de ser el següent:<br>\nid>15,nom:Prova\n\nMés informació a la documentació oficial de [QueryDSL](http://www.querydsl.com/static/querydsl/latest/reference/html/)\n\nQuerydsl està enfocat a bd relacionals, a partir de la versió 3.4 de Canigó s'ha deprecat els mètodes de \"cat.gencat.ctti.canigo.arch.persistence.mongodb.repository.MongoGenericRepository\", es recomana no utilitzar-los\n\n**MongoListeners**\n\nSi es necessari, es pot crear un listener a una entitat de Mongo\n\nUn exemple de listener seria:\n```\nimport java.util.Random;\n\nimport org.springframework.data.mongodb.core.mapping.event.AbstractMongoEventListener;\nimport org.springframework.data.mongodb.core.mapping.event.BeforeConvertEvent;\n\nimport cat.gencat.ctti.mongodb.model.MongoEquipament;\n\n/**\n * Equivalent of a domain method annotated by <code>PrePersist</code>.\n */\npublic class MongoEquipamentListener extends AbstractMongoEventListener<MongoEquipament> {\n\n\t@Override\n\tpublic void onBeforeConvert(BeforeConvertEvent<MongoEquipament> event) {\n\t\tMongoEquipament mongoEquipament = event.getSource();\n\t\tif (mongoEquipament.getId() == null) {\n\t\t\t// TODO use a better UUID generator in production\n\t\t\tmongoEquipament.setId(new Random().nextLong());\n\t\t}\n\t}\n\n}\n```\n\nPer generar id únics a l'entitat MongoEquipament abans de guardar-la\n\n**Embeded Mongo**\n\nPer a poder provar el codi generat per MongoDB en un test es pot utilitzar la utilitat Embeded Mongo. Es necessari extendre del fitxer de configuració de Mongo de l'aplciació i sobreesciure el mètode \n```\npublic Mongo mongo() throws Exception {\n```\n\nUn exemple de configuració per a Embeded MongoDB seria:\n```\nimport com.mongodb.Mongo;\n\nimport cz.jirutka.spring.embedmongo.EmbeddedMongoFactoryBean;\n\npublic class EquipamentEmbeddedMongoConfig extends EquipamentMongoConfig {\n\n\t@Override\n\tpublic Mongo mongo() throws Exception {\n\t\tif (mongo == null) {\n\t\t\tEmbeddedMongoFactoryBean embeddedMongoFactoryBean = new EmbeddedMongoFactoryBean();\n\t\t\t// embeddedMongoFactoryBean.setBindIp(host);\n\t\t\t// embeddedMongoFactoryBean.setPort(port);\n\t\t\t// embeddedMongoFactoryBean.setVersion(\"3.6\");\n\t\t\tmongo = embeddedMongoFactoryBean.getObject();\n\t\t}\n\t\treturn mongo;\n\t}\n}\n```\n\n**Test per MongoDB**\nPer poder provar el codi per MongoDB només es necessari importar el fitxer de configuració de MongoDB en el nostre test\n\nAixí, si tenim el test següent:\n```\nimport static org.hamcrest.CoreMatchers.notNullValue;\nimport static org.hamcrest.collection.IsCollectionWithSize.hasSize;\nimport static org.junit.Assert.assertThat;\n\nimport java.util.ArrayList;\nimport java.util.List;\nimport java.util.Set;\n\nimport javax.validation.ConstraintViolation;\nimport javax.validation.ConstraintViolationException;\n\nimport org.junit.Assert;\nimport org.junit.Before;\nimport org.junit.Test;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.data.domain.Page;\nimport org.springframework.data.domain.PageRequest;\nimport org.springframework.data.domain.Pageable;\nimport org.springframework.data.domain.Sort;\nimport org.springframework.data.domain.Sort.Direction;\nimport org.springframework.data.domain.Sort.Order;\n\nimport com.querydsl.core.types.Expression;\nimport com.querydsl.core.types.Path;\nimport com.querydsl.core.types.Predicate;\nimport com.querydsl.core.types.Projections;\n\nimport cat.gencat.ctti.mongodb.model.MongoEquipament;\nimport cat.gencat.ctti.mongodb.model.QMongoEquipament;\nimport cat.gencat.ctti.mongodb.model.repository.EquipamentMongoRepository;\nimport cat.gencat.ctti.canigo.arch.persistence.core.querydsl.GenericPredicateBuilder;\n\n/**\n * Test cases for the {@link EquipamentMongoRepository}.\n */\npublic abstract class EquipamentMongoRepositoryCoreTest {\n\t\n\t@Autowired\n\tEquipamentMongoRepository repository;\n\n\t@Before\n\tpublic void setUp() {\n\t\tAssert.assertNotNull(repository);\n\t\trepository.deleteAll();\n\t}\n\n\t@Test\n\tpublic void test1CRUDOperations() {\n\n\t\t// Test if table is empty\n\t\tAssert.assertTrue(repository.findAll().isEmpty());\n\n\t\t// Test save\n\t\tMongoEquipament mongoEquipament = new MongoEquipament();\n\t\tmongoEquipament.setNom(\"CAP La Pau\");\n\t\tmongoEquipament.setMunicipi(\"Barcelona\");\n\t\trepository.save(mongoEquipament);\n\n\t\t// Test insert and recover\n\t\tMongoEquipament mongoEquipament2 = new MongoEquipament();\n\t\tmongoEquipament2.setNom(\"CAP Santa Coloma\");\n\t\trepository.save(mongoEquipament2);\n\t\tMongoEquipament equipament3 = repository.findOne(mongoEquipament2.getId());\n\t\tAssert.assertEquals(equipament3.getId(), mongoEquipament2.getId());\n\t\tAssert.assertEquals(equipament3.getNom(), \"CAP Santa Coloma\");\n\n\t\t// Test delete all\n\t\trepository.deleteAll();\n\t\tAssert.assertTrue(repository.findAll().isEmpty());\n\n\t}\n\n\t@Test\n\tpublic void test2MultipleCRUD() {\n\n\t\tList<MongoEquipament> list = new ArrayList<MongoEquipament>();\n\n\t\tMongoEquipament mongoEquipament1 = new MongoEquipament();\n\t\tMongoEquipament mongoEquipament2 = new MongoEquipament();\n\t\tMongoEquipament mongoEquipament3 = new MongoEquipament();\n\n\t\tlist.add(mongoEquipament1);\n\t\tlist.add(mongoEquipament2);\n\t\tlist.add(mongoEquipament3);\n\n\t\t// Test save\n\t\tmongoEquipament1.setNom(\"equipament1\");\n\t\tmongoEquipament2.setNom(\"equipament2\");\n\t\tmongoEquipament3.setNom(\"equipament3\");\n\t\trepository.save(list);\n\t\tAssert.assertEquals(list.size(), repository.findAll().size());\n\n\t\t// Test update\n\t\tmongoEquipament1.setNom(\"equipament1 updated!\");\n\t\tmongoEquipament2.setNom(\"equipament2 updated!\");\n\t\tmongoEquipament3.setNom(\"equipament3 updated!\");\n\t\trepository.save(list);\n\t\tAssert.assertEquals(list.size(), repository.findAll().size());\n\n\t\tList<MongoEquipament> elsMeusEquipaments = repository.findAll();\n\t\tAssert.assertEquals(mongoEquipament1.getId(), elsMeusEquipaments.get(0).getId());\n\t\tAssert.assertEquals(mongoEquipament1.getNom(), elsMeusEquipaments.get(0).getNom());\n\t\tAssert.assertEquals(mongoEquipament2.getId(), elsMeusEquipaments.get(1).getId());\n\t\tAssert.assertEquals(mongoEquipament2.getNom(), elsMeusEquipaments.get(1).getNom());\n\t\tAssert.assertEquals(mongoEquipament3.getId(), elsMeusEquipaments.get(2).getId());\n\t\tAssert.assertEquals(mongoEquipament3.getNom(), elsMeusEquipaments.get(2).getNom());\n\n\t\t// Test no exception launched\n\t\trepository.save(new ArrayList<MongoEquipament>());\n\t}\n\n\t@Test\n\tpublic void test3NomNotNull() {\n\t\tMongoEquipament mongoEquipament = new MongoEquipament();\n\t\tmongoEquipament.setNom(null);\n\t\ttry {\n\t\t\trepository.save(mongoEquipament);\n\t\t} catch (ConstraintViolationException e) {\n\t\t\tSet<ConstraintViolation<?>> violations = e.getConstraintViolations();\n\t\t\tAssert.assertEquals(1, violations.size());\n\t\t\t@SuppressWarnings(\"rawtypes\")\n\t\t\tConstraintViolation violation = (ConstraintViolation) violations.iterator().next();\n\t\t\tAssert.assertEquals(\"MongoEquipament's nom must not be null\", violation.getMessageTemplate());\n\t\t}\n\t}\n\n\t@Test\n\tpublic void test4FindByNomQuery() {\n\t\tMongoEquipament mongoEquipament = new MongoEquipament();\n\t\tmongoEquipament.setNom(\"findByNomQuery\");\n\t\tmongoEquipament.setMunicipi(\"findByNomQuery\");\n\t\trepository.save(mongoEquipament);\n\n\t\tList<MongoEquipament> mongoEquipamentList = repository.findByNomQuery(\"findByNomQuery\");\n\n\t\tassertThat(mongoEquipamentList, notNullValue());\n\t\tassertThat(mongoEquipamentList, hasSize(1));\n\t}\n\n\t@Test\n\tpublic void test5FindByNomLike() {\n\t\tMongoEquipament mongoEquipament = new MongoEquipament();\n\t\tmongoEquipament.setNom(\"findByNomLike\");\n\t\tmongoEquipament.setMunicipi(\"findByNomLike\");\n\t\trepository.save(mongoEquipament);\n\n\t\tList<MongoEquipament> mongoEquipamentList = repository.findByNomLike(\"Like\", null);\n\n\t\tassertThat(mongoEquipamentList, notNullValue());\n\t\tassertThat(mongoEquipamentList, hasSize(1));\n\t}\n\n\t@Test\n\tpublic void test6FindAllPaginatedPath() {\n\t\tMongoEquipament mongoEquipament = new MongoEquipament();\n\t\tmongoEquipament.setNom(\"findPaginatedPath\");\n\t\tmongoEquipament.setMunicipi(\"findPaginatedPath\");\n\t\trepository.save(mongoEquipament);\n\n\t\tPath<?>[] paths = { QMongoEquipament.mongoEquipament.id, QMongoEquipament.mongoEquipament.nom,\n\t\t\t\tQMongoEquipament.mongoEquipament.municipi };\n\n\t\tList<MongoEquipament> mongoEquipamentList = repository.findAll(QMongoEquipament.mongoEquipament.nom.isNotNull().and(QMongoEquipament.mongoEquipament.nom.isNotEmpty())\n\t\t\t\t\t\t.and(QMongoEquipament.mongoEquipament.municipi.isNotNull())\n\t\t\t\t\t\t.and(QMongoEquipament.mongoEquipament.municipi.isNotEmpty())\n\t\t\t\t\t\t.and(QMongoEquipament.mongoEquipament.nom.equalsIgnoreCase(\"findPaginatedPath\")),\n\t\t\t\tnew PageRequest(0, 10), paths).getContent();\n\n\t\tassertThat(mongoEquipamentList, notNullValue());\n\t\tassertThat(mongoEquipamentList, hasSize(1));\n\t}\n\n\t@Test\n\tpublic void test7FindPaginatedPaths() {\n\t\tfor (int i = 0; i < 20; i++) {\n\t\t\tMongoEquipament mongoEquipament = new MongoEquipament();\n\t\t\tmongoEquipament.setNom(\"findPaginatedPaths\" + i);\n\t\t\tmongoEquipament.setMunicipi(\"findPaginatedPaths\" + i);\n\t\t\trepository.save(mongoEquipament);\n\t\t}\n\n\t\tInteger page = 1;\n\t\tInteger rpp = 10;\n\t\tString sort = \"-municipi\";\n\t\tString filter = null;\n\t\tString fields = \"id,municipi\";\n\n\t\tList<MongoEquipament> mongoEquipamentList = findPaginatedPaths(page, rpp, sort, filter, fields).getContent();\n\n\t\tassertThat(mongoEquipamentList, notNullValue());\n\t\tassertThat(mongoEquipamentList, hasSize(rpp));\n\t}\n\n\t@Test\n\tpublic void test8FindPaginatedPathId() {\n\t\tfor (int i = 0; i < 20; i++) {\n\t\t\tMongoEquipament mongoEquipament = new MongoEquipament();\n\t\t\tmongoEquipament.setNom(\"findPaginatedPathId\" + i);\n\t\t\tmongoEquipament.setMunicipi(\"findPaginatedPathId\" + i);\n\t\t\trepository.save(mongoEquipament);\n\t\t}\n\n\t\tInteger page = 1;\n\t\tInteger rpp = 10;\n\t\tString sort = \"-municipi\";\n\t\tString filter = null;\n\n\t\tList<MongoEquipament> mongoEquipamentList = findPaginatedPathId(page, rpp, sort, filter).getContent();\n\n\t\tassertThat(mongoEquipamentList, notNullValue());\n\t\tassertThat(mongoEquipamentList, hasSize(rpp));\n\t}\n\n\t@Test\n\tpublic void test9FindPaginatedFactoryExpression() {\n\t\tfor (int i = 0; i < 20; i++) {\n\t\t\tMongoEquipament mongoEquipament = new MongoEquipament();\n\t\t\tmongoEquipament.setNom(\"findPaginatedProjeccio\" + i);\n\t\t\tmongoEquipament.setMunicipi(\"findPaginatedProjeccio\" + i);\n\t\t\trepository.save(mongoEquipament);\n\t\t}\n\n\t\tInteger page = 1;\n\t\tInteger rpp = 10;\n\t\tString sort = \"-municipi\";\n\t\tString filter = null;\n\t\tString fields = \"id,municipi\";\n\n\t\tList<MongoEquipament> mongoEquipamentList = findPaginatedFactoryExpression(page, rpp, sort, filter, fields)\n\t\t\t\t.getContent();\n\n\t\tassertThat(mongoEquipamentList, notNullValue());\n\t\tassertThat(mongoEquipamentList, hasSize(rpp));\n\t}\n\n\t@Test\n\tpublic void test10FindPaginatedPathsFiltered() {\n\t\tfor (int i = 0; i < 20; i++) {\n\t\t\tMongoEquipament mongoEquipament = new MongoEquipament();\n\t\t\tmongoEquipament.setNom(\"findPaginatedPaths\" + i);\n\t\t\tmongoEquipament.setMunicipi(\"findPaginatedPaths\" + i);\n\t\t\trepository.save(mongoEquipament);\n\t\t}\n\n\t\tInteger page = 1;\n\t\tInteger rpp = 10;\n\t\tString sort = \"-municipi\";\n\t\tString filter = \"municipi:findPaginatedPaths0\";\n\t\tString fields = \"id,municipi\";\n\n\t\tList<MongoEquipament> mongoEquipamentList = findPaginatedPaths(page, rpp, sort, filter, fields).getContent();\n\n\t\tassertThat(mongoEquipamentList, notNullValue());\n\t\tassertThat(mongoEquipamentList, hasSize(1));\n\t}\n\n\tprotected Page<MongoEquipament> findPaginatedPaths(final Integer page, final Integer rpp, final String sort,\n\t\t\tfinal String filter, final String fields) {\n\n\t\tPredicate predicate = getPredicate(filter);\n\n\t\tPageable pageable = new PageRequest(page - 1, rpp, getOrdenacio(sort));\n\n\t\tList<Path<?>> listFields = getListFields(fields);\n\n\t\treturn repository.findAll(predicate, pageable, listFields);\n\t}\n\n\tprivate List<Path<?>> getListFields(String fields) {\n\t\tQMongoEquipament qmongoequipament = QMongoEquipament.mongoEquipament;\n\n\t\tList<Path<?>> listFields = new ArrayList<Path<?>>();\n\n\t\tif (fields != null && fields != \"\") {\n\t\t\tString[] selectedFields = fields.split(\",\");\n\t\t\tfor (int i = 0; i < selectedFields.length; i++) {\n\t\t\t\tswitch (selectedFields[i]) {\n\t\t\t\tcase MongoEquipament.ID:\n\t\t\t\t\tlistFields.add(qmongoequipament.id);\n\t\t\t\t\tbreak;\n\t\t\t\tcase MongoEquipament.NOM:\n\t\t\t\t\tlistFields.add(qmongoequipament.nom);\n\t\t\t\t\tbreak;\n\t\t\t\tcase MongoEquipament.MUNICIPI:\n\t\t\t\t\tlistFields.add(qmongoequipament.municipi);\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn listFields;\n\t}\n\n\tprivate Predicate getPredicate(String filter) {\n\t\tGenericPredicateBuilder<MongoEquipament> builder = new GenericPredicateBuilder<MongoEquipament>(\n\t\t\t\tMongoEquipament.class, \"equipament\");\n\t\tbuilder.populateSearchCriteria(filter);\n\t\treturn builder.build();\n\t}\n\n\tprotected Page<MongoEquipament> findPaginatedPathId(final Integer page, final Integer rpp, final String sort,\n\t\t\tfinal String filter) {\n\n\t\tPredicate predicate = getPredicate(filter);\n\n\t\tPageable pageable = new PageRequest(page - 1, rpp, getOrdenacio(sort));\n\n\t\treturn repository.findAll(predicate, pageable, QMongoEquipament.mongoEquipament.id);\n\t}\n\n\tprotected Page<MongoEquipament> findPaginatedFactoryExpression(final Integer page, final Integer rpp,\n\t\t\tfinal String sort, final String filter, final String fields) {\n\n\t\tPredicate predicate = getPredicate(filter);\n\n\t\tPageable pageable = new PageRequest(page - 1, rpp, getOrdenacio(sort));\n\n\t\tList<Path<?>> listFields = getListFields(fields);\n\n\t\tExpression[] arrayExpression = listFields.toArray(new Expression[0]);\n\n\t\treturn repository.findAll(predicate, pageable, Projections.bean(MongoEquipament.class, arrayExpression));\n\t}\n\n\tprivate Sort getOrdenacio(String sort) {\n\t\tSort resultat = null;\n\n\t\tList<Order> orders = new ArrayList<Order>();\n\n\t\tif (sort != null && sort != \"\") {\n\t\t\tString[] fields = sort.split(\",\");\n\n\t\t\tfor (int i = 0; i < fields.length; i++) {\n\t\t\t\tchar direction = fields[i].charAt(0);\n\t\t\t\tif (Character.toString(direction).equals(\"-\")) {\n\t\t\t\t\t// Order descendente\n\t\t\t\t\tString value = fields[i].substring(1);\n\t\t\t\t\torders.add(new Order(Direction.DESC, value));\n\t\t\t\t} else {\n\t\t\t\t\t// Orden ascendente\n\t\t\t\t\torders.add(new Order(Direction.ASC, fields[i]));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tresultat = new Sort(orders);\n\n\t\treturn resultat;\n\t}\n\n}\n```\nPer utilitzar la configuració definida al fitxer mongodb.properties podriem utilitzar directament la configuració de MongoDB de l'aplicació:\n```\nimport org.junit.runner.RunWith;\nimport org.springframework.test.context.ContextConfiguration;\nimport org.springframework.test.context.junit4.SpringJUnit4ClassRunner;\n\nimport cat.gencat.ctti.config.AppConfig;\nimport cat.gencat.ctti.mongodb.config.EquipamentMongoConfig;\nimport cat.gencat.ctti.mongodb.model.repository.EquipamentMongoRepository;\n\n/**\n * Test cases for the {@link EquipamentMongoRepository}.\n */\n@RunWith(SpringJUnit4ClassRunner.class)\n@ContextConfiguration(classes = { AppConfig.class, EquipamentMongoConfig.class })\npublic class EquipamentMongoRepositoryTest extends EquipamentMongoRepositoryCoreTest{\n\t\n}\n```\nPer utilitzar la configuració amb Embeded MongoBD, si no hem importat el EquipamentMongoConfig en el AppConfig:\n```\nimport org.junit.runner.RunWith;\nimport org.springframework.test.context.ContextConfiguration;\nimport org.springframework.test.context.junit4.SpringJUnit4ClassRunner;\n\nimport cat.gencat.ctti.config.AppConfig;\nimport cat.gencat.ctti.mongodb.config.EquipamentEmbeddedMongoConfig;\nimport cat.gencat.ctti.mongodb.model.repository.EquipamentMongoRepository;\n\n/**\n * Test cases for the {@link EquipamentMongoRepository}.\n */\n@RunWith(SpringJUnit4ClassRunner.class)\n@ContextConfiguration(classes = { AppConfig.class, EquipamentEmbeddedMongoConfig.class })\npublic class EquipamentEmbeddedMongoRepositoryTest extends EquipamentMongoRepositoryCoreTest{\n\t\n}\n```\n\nO crear un nou AppConfig important el EquipamentEmbeddedMongoConfig i carregar-lo al test:\n```\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.context.annotation.Import;\nimport org.springframework.context.annotation.ImportResource;\nimport org.springframework.context.annotation.PropertySource;\nimport org.springframework.transaction.annotation.EnableTransactionManagement;\n\nimport cat.gencat.ctti.mongodb.config.EquipamentEmbeddedMongoConfig;\n\n@Configuration\n@PropertySource(\"classpath:/config/props/boot.properties\")\n@ImportResource({ \"classpath:cat/gencat/ctti/canigo/arch/core/config/canigo-core.xml\" })\n@EnableTransactionManagement\n@Import(EquipamentEmbeddedMongoConfig.class)\npublic class EmbeddedMongoAppConfig {\n\n}\n```\n\n```\nimport org.junit.runner.RunWith;\nimport org.springframework.test.context.ContextConfiguration;\nimport org.springframework.test.context.junit4.SpringJUnit4ClassRunner;\n\nimport cat.gencat.ctti.config.EmbeddedMongoAppConfig;\nimport cat.gencat.ctti.mongodb.model.repository.EquipamentMongoRepository;\n\n/**\n * Test cases for the {@link EquipamentMongoRepository}.\n */\n@RunWith(SpringJUnit4ClassRunner.class)\n@ContextConfiguration(classes = { EmbeddedMongoAppConfig.class})\npublic class EquipamentEmbeddedMongoRepositoryTest extends EquipamentMongoRepositoryCoreTest{\n\t\n}\n```\n\nPer més informació sobre [Embeded MongoDB] (https://flapdoodle-oss.github.io/de.flapdoodle.embed.mongo/)\n\n### Logs\nSi es necessari el pintat de les consultes realitzades pel mòdul a la Base de Dades MongoDB, es pot afegir un \"logger\" per la categoria \"org.springframework.data.mongodb.core.MongoTemplate\" al fitxer \"log4j\" de l'aplicació\nAixí per exemple si volem pintar les querys en el fitxer de logs, podriem tenir al nostre fitxer \"log4j\":\n```\n\t\t<Logger name=\"org.springframework.data.mongodb.core.MongoTemplate\" level=\"debug\" additivity=\"false\">\n\t\t\t<AppenderRef ref=\"DAILY_LOG\" />\n\t\t</Logger>\n```\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1tb25nb2Ri"},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1pbnRlcm5hY2lvbmFsaXR6YWNpbw==":{"date":1426150815000,"title":"Mòdul d'internacionalització","description":"Mòdul d'internacionalització.","sections":"Canigó. Documentació versió 3.x","weight":5,"path":"/canigo-documentacio-versions-3x-core/modul-internacionalitzacio","content":"## Propòsit\r\n\r\nEl mòdul d'internacionalització té com a objectiu principal permetre el\r\ndesenvolupament d'aplicacions en el que no sigui necessària cap\r\nreenginyeria cada vegada que s'incorpori un nou llenguatge a\r\nl'aplicació.\r\n\r\nEn general tota aplicació internacionalitzada pot realitzar-se de dues\r\nformes diferenciades:\r\n\r\n1.  Mitjançant la rèplica d'un conjunt de pàgines per a cada idioma.\r\n2.  Mitjançant un únic conjunt de pàgines que obtenen diferents literals\r\n    de forma externa segons l'idioma.\r\n\r\nLa primera solució, fins ara utilitzada en moltes pàgines Web, implica\r\nun cost gran de rèplica i manteniment, ja que qualsevol nou requeriment\r\no canvi comporta realitzar més d'un desenvolupament, un per cada idioma.\r\n\r\nLa segona solució, recomanada per Canigó permet que:\r\n\r\n1.  Es puguin afegir llenguatges sense haver de realitzar canvis al\r\n    codi.\r\n2.  Els texts, imatges i missatges s'emmagatzemen de forma externa al\r\n    codi.\r\n3.  La informació (per exemple dates) es pot formatejar segons l'idioma\r\n    de l'usuari\r\n\r\n## Glossari\r\n\r\n**i18N (Internationalization)**\r\n\r\ni18N o Internationalization (el 18 correspon a les 18 lletres que hi ha\r\nentre la I inicial i la n final) és el procés d'agafar una aplicació\r\ndissenyada i reestructurar-la per a què pugui ser usada en diferents\r\nlocalitats o bé definir el procés de crear-la per a ser totalment\r\nflexible per executar-se en qualsevol localitat. Java defineix les\r\nclasses bàsiques d'ús de la internacionalització.\r\n\r\n## Instal.lació i configuració\r\n\r\n### Instal.lació\r\n\r\nEl mòdul de configuració s'inclou per defecte dins del core de Canigó 3.\r\nDurant el procés de creació de l'aplicació (Struts o JSF), l'eina de\r\nsuport al desenvolupament inclourà la referència dins del pom.xml. En\r\ncas d'una instal- lació manual afegir les següents línies al pom.xml de\r\nl'aplicació:\r\n\r\n~~~~ {.code-java}\r\n<canigo.core.version>[3.1.0,3.2.0)</canigo.core.version>\r\n\r\n<dependency>\r\n          <groupId>cat.gencat.ctti</groupId>\r\n          <artifactId>canigo.core</artifactId>\r\n          <version>${canigo.core.version}</version>\r\n</dependency>\r\n~~~~\r\n\r\n### Configuració\r\n\r\nPer a configurar el mòdul d'internacionalització s'han de manipular els\r\nsegüents fitxers:\r\n\r\n1.  Definició dels fitxers de traduccions (típicament els fitxers dels\r\n    diferents idiomes: application.properties,\r\n    application_XX_XX.properties)\r\n2.  Definició de la integració amb el servei de presentació (web.xml)\r\n3.  Definició dels idiomes i literals suportats (només JSF).\r\n\r\nNo requereix configuració per a inicialitzar el mòdul per part del\r\ndesenvolupador. Els xmls de configuració del servei es troben\r\ninternalitzats dins del jar del core, i s'inicialitzarà de manera\r\nautomàtica un cop arrenqui l'aplicació.\r\n\r\nEls arxius de configuració d'idiomes de l'aplicació han d'estar en la\r\nsegüent ubicació:\r\n\r\n<PROJECT_ROOT>/src/main/resources/config/i18n/*.properties\r\n\r\nAutomàticament el mòdul d'internacionalització carregarà tots els arxius\r\nde configuració d'idiomes perquè posteriorment puguin ser explotats per\r\nl'aplicació.\r\n\r\n#### Definició dels fitxers de traducció\r\n\r\nUbicació:\r\n\r\n <PROJECT_ROOT>/src/main/resources/config/i18n/*.properties\r\n\r\nExplicació:\r\n\r\nEls fitxers de traducció són els fitxers que contenen els missatges en\r\nels diferents idiomes. Es basen en l'ús de la internacionalització de\r\nJava (i18n o Internationalization).\r\n\r\n Aquests fitxers s'han de construir tenint en compte que:\r\n\r\n1.  La seva extensió ha de ser '.properties' (es denominen resource\r\n    bundles).\r\n2.  Per cada idioma que volguem suportar cal crear un nou fitxer. Aquest\r\n    fitxer tindrà la següent nomenclatura:\r\n    'nomFitxer__lg_pa._properties', on 'lg' correspon al codi del\r\n    llenguatge i 'pa' correspon al codi del país pel qual volem definir\r\n    els literals.\r\n3.  El seu contingut es basa en l'ús de parells clau-valor tal i com es\r\n    mostra a continuació:\r\n\r\nFitxer de multiidioma application.properties\r\n\r\n~~~~ {.code-java}\r\nclau_1=valor_1\r\nclau_2=valor_2\r\n...\r\n~~~~\r\n\r\nEn cas de que l'idioma escollit per l'usuari no correspongui amb cap\r\nfitxer, es pot crear un fitxer per defecte. Aquest fitxer tindrà el\r\nformat 'nomFitxer.properties'.\r\n\r\nExemple:\r\n\r\n1.  'applicationResources_en.properties', per representar els literals\r\n    en anglès\r\n2.  'applicationResources_es.properties', per representar els literals\r\n    en castellà\r\n3.  'applicationResources_ca.properties', per representar els literals\r\n    català\r\n4.  'applicationResources.properties', per representar els literals de\r\n    qualsevol altre idioma\r\n\r\nMés informació dels codis de pais e idioma:\r\n\r\n-   [Codis d'idioma\r\n    (ISO-639)](http://ftp.ics.uci.edu/pub/ietf/http/related/iso639.txt)\r\n-   [Codis de pais\r\n    (ISO-3166)](http://www.chemie.fu-berlin.de/diverse/doc/ISO_3166.html)\r\n\r\n<div class=\"message warning\">\r\nEn cas de que per un llenguatge determinat existeixi un fitxer específic, l'obtenció del literal a partir d'una clau s'obtindrà des d'aquest fitxer. Si no es troba la clau en cap cas s'anirà al fitxer per defecte. Així doncs és important que es mantinguin actualitzats els fitxers de recursos per cada idioma de l'aplicació per evitar problemes. És important que es proporcioni un fitxer de recursos per defecte. Aquest serà el fitxer utilitzat  pel servei en cas de que el llenguatge escollit per l'usuari no correspongui a cap dels fitxers de recursos definits.\r\n</div>\r\n\r\n#### Definició de la integració amb el mòdul de presentació\r\n\r\nFitxer de configuració: web.xml\r\n\r\nUbicació proposada: <PROJECT_ROOT>/src/main/webapp/WEB-INF/web.xml\r\n\r\nPer integrar el mòdul d'internacionalització amb el mòdul de presentació\r\ns'han de definir els següents filtres a nivell d'aplicació:\r\n\r\n##### Localization Filter\r\n\r\nAquest filtre s'encarrega d'exposar el mòdul d'internacionalització per\r\ntal de que sigui accessible a tota la capa web. Comú tant aplicacions\r\nJSF com a Struts.\r\n\r\nAtributs:\r\n\r\n**Atribut**  | **Requerit** | **Valor**\r\n------------ | ------------ | ---------\r\nfilter-name  | Sí           | Nom del filtre<br>Exemple: Localization Filter\r\nfilter-class | Sí           | cat.gencat.ctti.canigo.arch.web.core.filters.LocalizationFilter\r\n\r\n~~~~ {.code-java}\r\n<filter>\r\n    <filter-name>Localization Filter</filter-name>\r\n    <filter-class>cat.gencat.ctti.canigo.arch.web.core.filters.LocalizationFilter</filter-class>\r\n</filter>\r\n~~~~\r\n\r\n##### Struts Locale Filter\r\n\r\nAquest filtre s'encarrega de d'integrar el mòdul d'internacionalització\r\nexposat pel filtre comú de Localization Filter per tal que des de Struts\r\nes pugui fer ús de fitxers d'internacionalització.\r\n\r\nAtributs:\r\n\r\n**Atribut**  | **Requerit** | **Valor**\r\n------------ | ------------ | ---------\r\nfilter-name  | Sí           | Nom del filtre<br>Exemple: Struts Locale Filter\r\nfilter-class | Sí           | cat.gencat.ctti.canigo.arch.web.struts.filter.StrutsLocaleFilter\r\n\r\n~~~~ {.code-java}\r\n<filter>\r\n   <filter-name>Struts Locale Filter</filter-name>\r\n   <filter-class>cat.gencat.ctti.canigo.arch.web.struts.filter.StrutsLocaleFilter</filter-class>\r\n</filter>\r\n~~~~\r\n\r\n#### Definició dels idiomes i literals suportats (només JSF)\r\n\r\nUbicació proposada:\r\n<PROJECT_ROOT>/src/main/webapp/WEB-INF/faces-config.xml\r\n\r\nLa configuració del locale permet definir amb quin nom s'exposaran les\r\npropietats a les pàgines JSF, i els idiomes permesos i per defecte del\r\nnavegador en cas de que no sigui informat.\r\n\r\nPer defecte, l'eina de suport al desenvolupament de Canigó informa\r\naquest valors segons les opcions seleccionades durant la creació de\r\nl'aplicació.\r\n\r\n~~~~ {.code-java}\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<faces-config version=\"1.2\" xmlns=\"http://java.sun.com/xml/ns/javaee\"\r\n xmlns:xi=\"http://www.w3.org/2001/XInclude\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n xsi:schemaLocation=\"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-facesconfig_1_2.xsd\">\r\n\r\n    <application>\r\n\r\n        .......\r\n        <locale-config>\r\n        <default-locale>ca_ES</default-locale>\r\n        <supported-locale>es</supported-locale>\r\n        <supported-locale>en</supported-locale>\r\n        <supported-locale>de</supported-locale>\r\n    </locale-config>\r\n    <resource-bundle>\r\n            <base-name>config.i18n.applicationResources</base-name>\r\n            <var>msg</var>\r\n        </resource-bundle>\r\n        .......\r\n        </application>\r\n        ........\r\n</faces-config>\r\n~~~~\r\n\r\nEn l'exemple anterior l'idioma per defecte és Català, el locales\r\nsuportats: espanyol, anglès i alemany.\r\n Els recursos de l'aplicació es podran accedir des de la JSF a partir\r\ndel nom de variable **msg** i trobaran situats a:\r\n\r\n<PROJECT_ROOT>/src/main/resources/config/i18n/applicationResources.properties\r\n\r\n~~~~ {.code-java}\r\n<h:outputText value=\"#{msg.formulari_agregarCanvisArxiusIntegrats}\"/>\r\n~~~~\r\n\r\n#### Definició dels literals suportats (només Struts)\r\n\r\nUbicació proposada:\r\n<PROJECT_ROOT>/src/main/resources/struts/struts-config.xml\r\n\r\nAquest arxiu engloba la configuració de Struts, dins d'aquest podem\r\ndefinir els recursos que seran accessibles des de les pàgines web. Per\r\ntal d'habilitar aquesta internacionalització s'ha d'informar el tag\r\nmessage-resources.\r\n\r\n**Atribut** | **Requerit** | **Valor**\r\n----------- | ------------ | ---------\r\nparameter   | Sí           | Ruta per punts on estan localitzats els literals\r\nnull        | No           | Informant aquesta propietat com a \"false\" mostrará els recursos no informats com a ?key? enlloc de mostrar null\r\n\r\n~~~~ {.code-java}\r\n<message-resources parameter=\"i18n.applicationResources\" null=\"false\" />\r\n~~~~\r\n\r\nSi es vol exposar més d'un arxiu de literals crear tants tags\r\nmessage-resources com siguin necessaris.\r\n\r\n~~~~ {.code-java}\r\n<message-resources parameter=\"i18n.applicationResources\" null=\"false\" />\r\n<message-resources parameter=\"i18n.anotherApplicationResources\" null=\"false\" />\r\n<message-resources parameter=\"i18n.thirdApplicationResources\" null=\"false\" />\r\n~~~~\r\n\r\n## Utilització del mòdul\r\n\r\n### JSF\r\n\r\nSuposant que els recursos estan exposats a la variable **msg** i com a\r\nliterals tenim:\r\n\r\n**applicationResources.properties**\r\n\r\n~~~~ {.code-java}\r\nnomFormulari=Nom del formulari\r\n~~~~\r\n\r\n**prova.jsf**\r\n\r\n~~~~ {.code-java}\r\n<h:outputText value=\"#{msg.nomFormulari}\"/>\r\n~~~~\r\n\r\nSi la key del literal a mostrar conté un punt s'ha de mostrar de la\r\nsegüent manera:\r\n\r\n~~~~ {.code-java}\r\n<h:outputText value=\"#{msg['nom.formulari']\"/>\r\n~~~~\r\n\r\nI si el literal és del tipus cadena=Hola {0} {1} es poden passar\r\nparàmetres de la següent manera:\r\n\r\n~~~~ {.code-java}\r\n<h:outputFormat value=\"#{msg['cadena']}\">\r\n   <f:param value=\"Ramon\" />\r\n   <f:param value=\"Sala\" />\r\n</h:outputFormat>\r\n~~~~\r\n\r\n### Struts\r\n\r\nSuposant els següents literals:\r\n\r\n**applicationResources.properties**\r\n\r\n~~~~ {.code-java}\r\nnomFormulari=Nom del formulari\r\n~~~~\r\n\r\n**prova.jsf**\r\n\r\n~~~~ {.code-java}\r\n<font face=\"verdana\">\r\n  <bean:message key=\"formulari.errorActivacio\" />\r\n</font>\r\n~~~~\r\n\r\n## Preguntes freqüents\r\n\r\n### Accés manual al servei d'internacionalització\r\n\r\nEncara que no és una pràctica comú es pot accedir al mòdul d'idiomes\r\ndesde qualsevol bean de l'aplicació gestionat per Spring. Per recuperar\r\naquest bean el desenvolupador pot realitzar una crida de forma externa\r\nmitjançant el patró ['Dependency\r\nInjection'](http://martinfowler.com/articles/injection.html)\r\nal mòdul i les seves propietats d'entorn.\r\n\r\n- Injecció de dependències mitjançant xml. Per exemple:\r\n\r\nRuta proposada: <PROJECT_ROOT>/src/main/resources/spring/exemple-beans-config.xml\r\n\r\n~~~~ {.code-java}\r\n<bean id=\"myBean\"  class=\"cat.gencat.app.exemples.Injection\">\r\n    <property name=\"i18nResource\" ref=\"messageSource\" />\r\n</bean>\r\n~~~~\r\n\r\nLa clase Injection tindria la següent estructura:\r\n\r\n~~~~ {.code-java}\r\nimport cat.gencat.ctti.canigo.arch.core.i18n.I18nResourceBundleMessageSource;\r\n\r\npublic class Injection {\r\n     I18nResourceBundleMessageSource i18n;\r\n     private static final Log LOGGER= LogFactory.getLog(Injection.class);\r\n\r\n     public void setI18nResource(I18nResourceBundleMessageSource i18nResource){\r\n         this.i18n = i18nResource;\r\n     }\r\n     \r\n     public void executeCommand(){\r\n        if (LOGGER.isDebugEnabled()){\r\n            LOGGER.debug(i18n.getMessage(\"test.label\"));\r\n        }\r\n     }\r\n}\r\n~~~~\r\n\r\nSpring s'encarregarà d'injectar el bean d'internacionalització dins del\r\nbean \"myBean\" executant el mètode setI18nResource.\r\n\r\n-   Injecció de dependències mitjançant anotacions:\r\n\r\n~~~~ {.code-java}\r\nimport cat.gencat.ctti.canigo.arch.core.i18n.I18nResourceBundleMessageSource;\r\n\r\npublic class Injection {\r\n     \r\n     private static final Log LOGGER= LogFactory.getLog(Injection.class);\r\n     \r\n     @Autowired\r\n     I18nResourceBundleMessageSource i18n;\r\n     article table {\r\n    margin:1em 0;\r\n}\r\n     public void executeCommand(){\r\n        if (LOGGER.isDebugEnabled()){\r\n            LOGGER.debug(i18n.getMessage(\"test.label\"));\r\n        }\r\n     }\r\n}\r\n~~~~\r\n\r\nL'anotació @Autowired injecta en aquest cas, un bean de tipus\r\ncat.gencat.ctti.canigo.arch.core.i18n.I18nResourceBundleMessageSource\r\nque Spring trobarà en el context de l'aplicació.\r\n\r\n### Claus amb punts en JSF\r\n\r\nA diferencia de Struts l'accés a propietats amb punts a la seva clau\r\ncanvia:\r\n\r\nExemple de claus amb punts:\r\n\r\n~~~~ {.code-java}\r\nusuaris.name=Nom\r\nusuaris.dni=DNI\r\nusuauri.surname=Cognoms\r\n~~~~\r\n\r\nPer accedir aquest tipus de clau des d'una pàgina JSF es necessari\r\naccedir de la següent manera:\r\n\r\n**pageExemple.jsf**\r\n\r\n~~~~ {.code-java}\r\n<?xml version=\"1.0\" encoding=\"ISO-8859-1\" standalone=\"yes\" ?>\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\"\r\n    xmlns:ui=\"http://java.sun.com/jsf/facelets\"\r\n xmlns:f=\"http://java.sun.com/jsf/core\"\r\n xmlns:h=\"http://java.sun.com/jsf/html\"\r\n xmlns:c=\"http://java.sun.com/jstl/core\"\r\n xmlns:t=\"http://myfaces.apache.org/tomahawk\">\r\n \r\n<ui:composition template=\"../layouts/template.jsf\">\r\n   <h:outputText value=\"\\#{msg['usuaris.name']}\"/>\r\n</ui:composition>\r\n</html>\r\n~~~~\r\n\r\n## Exemples\r\n\r\n### Exemple de Test unitari\r\n\r\nCom a exemple d'utilització es mostra com podem fer una prova unitària:\r\n\r\n1.  Creem la classe de test 'I18nTest' i afegim un mètode 'testI18N()'\r\n2.  Creem els diferents fitxers de literals\r\n\r\n~~~~ {.code-java}\r\n@RunWith(SpringJUnit4ClassRunner.class)\r\n@ContextConfiguration(locations = {\"../canigo-core.xml\"})\r\npublic class I18nTest{\r\n    \r\n    @Autowired\r\n    I18nResourceBundleMessageSource messageResource;\r\n\r\n    @Test\r\n    public void testI18N() {\r\n       try {\r\n            Assert.assertEquals(\"Hola!\", messageResource.getMessage(\"var1\"));\r\n            Assert.assertEquals(\"Hi!\", messageResource.getMessage(\"var1\", Locale.UK));\r\n            Assert.assertEquals(\"Attaaaaaack!\", messageResource.getMessage(\"var1\", Locale.US));\r\n        }\r\n        catch(NoSuchMessageException ex){\r\n            Assert.assertTrue(\"var1 not found\", false);\r\n        }    \r\n    }\r\n}\r\n~~~~\r\n\r\nFitxers dels diferents idiomes (application_xx_XX.properties):\r\n\r\n-   **application.properties (fitxer per defecte)**\r\n\r\n    ~~~~ {.code-java}\r\n    var1=Hola!\r\n    ~~~~\r\n\r\n-   **application_en_US.properties (fitxer pel 'Locale' 'US')**\r\n\r\n    ~~~~ {.code-java}\r\n    var1=Attaaaaaack!\r\n    ~~~~\r\n\r\n-   **application_en_GB.properties (fitxer pel 'Locale' 'GB')**\r\n\r\n    ~~~~ {.code-java}\r\n    var1=Hi!\r\n    ~~~~","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1pbnRlcm5hY2lvbmFsaXR6YWNpbw=="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1tb25pdG9yaXR6YWNpbw==":{"date":1427453980000,"title":"Monitorització","description":"Monitorització de l'aplicació.","sections":"Canigó. Documentació versió 3.x","weight":8,"path":"/canigo-documentacio-versions-3x-core/modul-monitoritzacio","content":"## Introducció\r\n\r\nUn dels aspectes més innovadors de la nova versió 3 del Framework Canigó és la possibilitat de disposar inicialment d'un component de monitorització de l'aplicació sense haver de fer cap desenvolupament addicional per part dels desenvolupadors de les aplicacions. Aquest component permet:\r\n\r\n* Fer un seguiment de les peticions que rep l'aplicació.\r\n* Comprovar l'estat del sistema.\r\n* Administració dels paràmetres de configuració d'aquesta monitorització.\r\n\r\n### SEGUIMENT DE LES PETICIONS\r\n\r\nRespecte al tipus de peticions, l'eina visualitza:\r\n\r\n* Número de peticions.\r\n* Temps mitjà de les peticions.\r\n* Peticions errònies.\r\n\r\nLes peticions que es mostren són les efectuades contra el servidor d'aplicació des de que l'aplicació rep una petició fins que aquesta finalitza i la retorna al client.\r\n\r\n![Peticions per minut](/related/canigo/documentacio/modul-monitoritzacio/Peticions.jpg \"Peticions rebudes per minut\")  \r\nFigura 1 Nombre de peticions rebudes per minut\r\n\r\n![Temps de procés](/related/canigo/documentacio/modul-monitoritzacio/Temps.jpg \"Temps promig de procés\")  \r\nFigura 2 Temps promig en processar les peticions\r\n\r\n![Peticions errònies](/related/canigo/documentacio/modul-monitoritzacio/Error.jpg \"Nombre de peticions errònies\")  \r\nFigura 3 Nombre de peticions que han finalitzat amb error (no controlat)\r\n\r\n### COMPROVACIÓ DE L'ESTAT DEL SISTEMA\r\n\r\nEn aquesta part de la monitorització es podrà visualitzar l'estat de les diferents parts del sistema configurades (per configurar aquesta part de la monitorització mirar el mòdul d'instrumentació), com podria ser la comprovació de la connectivitat contra base de dades o contra un servei web.\r\n\r\nLa informació d'aquesta funcionalitat es mostrarà en una taula amb la següent informació:\r\n\r\n* Mètode\r\n* Temps transcorregut (ms)\r\n* Estat\r\n\r\n![Estat del sistema](/related/canigo/documentacio/modul-monitoritzacio/Estat.jpg \"Estat del sistema\")  \r\nFigura 4 Taula d'informació de l'estat del sistema\r\n\r\n### ADMINISTRACIÓ DELS PARÀMETRES DE CONFIGURACIÓ\r\n\r\nPer últim l'eina també ofereix la possibilitat de configurar la longitud de les mostres que apareixen en les gràfiques i l'interval de mostreig entre mostres. Per defecte ofereix una visualització de l'evolució de les peticions de 8 hores amb intervals de 1 minut.\r\n\r\n![Configuració gràfiques](/related/canigo/documentacio/modul-monitoritzacio/Config.jpg \"Configuració gràfiques\")  \r\nFigura 5 Pantalla de configuració per a les gràfiques de monitorització","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1tb25pdG9yaXR6YWNpbw=="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1ycw==":{"date":1490775976000,"title":"Mòdul RS","description":"Mòdul RESTful Services","sections":"Canigó. Documentació versió 3.x","weight":2,"path":"/canigo-documentacio-versions-3x-core/modul-rs","content":"## Propòsit\r\n\r\nAquest mòdul proporciona eines per a l'exposició de serveis REST. Està basat en les millors pràctiques descrites a [Canigó APIs RESTful](http://canigo.ctti.gencat.cat/blog/2016/01/api/)\r\n\r\nEntre altres característiques, destaquem les següents:\r\n\r\n- Control genèric d'errors\r\n- Classes estàndard de resposta\r\n- Controladors per exposar les propietats de configuració de l'aplicació i mòduls carregats\r\n\r\nTot el contingut es serveix en format JSON.\r\n\r\n## Instal·lació i Configuració\r\n\r\n### Instal·lació\r\n\r\nEl mòdul RS i el corresponent test unitari s'inclou per defecte dins del core de Canigó 3.\r\nDurant el procés de creació de l'aplicació, l'eina de suport al desenvolupament inclourà la referència dins del pom.xml. \r\nEn cas d'una instal- lació manual afegir les següents línies al pom.xml de l'aplicació:\r\n\r\n```\r\n<canigo.web.rs.version>[1.1.0,1.2.0)</canigo.web.rs.version>\r\n<canigo.test.version>[1.2.0,1.3.0)</canigo.test.version>\r\n\r\n<dependency>\r\n <groupId>cat.gencat.ctti</groupId>\r\n <artifactId>canigo.web.rs</artifactId>\r\n <version>${canigo.web.rs.version}</version>\r\n</dependency>\r\n\r\n<dependency>\r\n\t<groupId>cat.gencat.ctti</groupId>\r\n\t<artifactId>canigo.test</artifactId>\r\n\t<version>${canigo.test.version}</version>\r\n\t<scope>test</scope>\r\n</dependency>\r\n\r\n<dependency>\r\n   <groupId>cat.gencat.ctti</groupId>\r\n   <artifactId>canigo.web.rs</artifactId>\r\n   <type>test-jar</type>\r\n   <version>${canigo.web.rs.version}</version>\r\n   <scope>test</scope>\r\n   <classifier>tests</classifier>\r\n</dependency>\r\n```\r\n\r\nAl pom.xml també s'ha d'afegir el plugin que executa el test unitari del mòdul RS:\r\n```\r\n<build>\r\n    ...\r\n    <plugins>\r\n        ...\r\n        <plugin>\r\n            <groupId>org.apache.maven.plugins</groupId>\r\n            <artifactId>maven-surefire-plugin</artifactId>\r\n            <executions>\r\n                <execution>\r\n                    <id>base-test</id>\r\n                    <phase>test</phase>\r\n                    <goals>\r\n                        <goal>test</goal>\r\n                    </goals>\r\n                    <configuration>\r\n                        <dependenciesToScan>\r\n                            <dependency>cat.gencat.ctti:canigo.web.rs</dependency>\r\n                            ...\r\n                        </dependenciesToScan>\r\n\t\t\t<excludes>\r\n                            <exclude>%regex[${project.groupId}.*.*Test.*]</exclude>\r\n\t\t\t</excludes>\r\n                    </configuration>\r\n                </execution>\r\n                ...\r\n            </executions>\r\n        </plugin>\r\n        ...\r\n    </plugins>\r\n    ...\r\n</build>    \r\n```\r\n### Configuració\r\n\r\nNo necessita cap configuració especial.\r\n\r\n### Ús de controladors (REST Controllers)\r\n\r\nHi ha dos controladors inclosos dins el mòdul:\r\n```\r\n    1. _InfoModulesController_: retorna la llista de mòduls Canigó carregats a l'aplicació i les seves corresponents versions. La seva URL és http://<app>/info/modules\r\n    2. _InfoPropertiesController_: retorna la llista de propietats definides a l'aplicació i els seus valors. La seva URL és http://<app>/info/properties\r\n```\r\n\r\nPer seguretat aquests controladors per defecte no es troben disponibles.\r\n\r\nPer a que es publiquin a l'aplicació s'ha de realitzar la següent configuració:\r\n\r\nAl fitxer de configuració de l’aplicació (AppConfig.java) afegir l’annotació @PropertySource al fitxer boot.properties que s’ha de crear:\r\n\r\n\t@Configuration\r\n\t@PropertySource(\"classpath:/config/props/boot.properties\")\r\n\t@ImportResource({ \"classpath:cat/gencat/ctti/canigo/arch/core/config/canigo-core.xml\" })\r\n\t@EnableTransactionManagement\r\n\tpublic class AppConfig {\r\n\t}\r\n\t\r\nCrear el fitxer /src/main/reources/config/props/boot.properties amb les següents propietats a true:\r\n\r\n\tpublishInfoModules=true\r\n\tpublishInfoProperties=true\r\n\t\r\n<span style=\"color:red\">En entorns productius aquests endpoints s'han de protegir o bloquejar</style>\r\n\r\n#### Donar d'alta un nou controlador\r\n\r\nPer donar d'alta un nou controlador a l'aplicació Canigó s'ha de seguir la [documentació de referència de Spring MVC](http://docs.spring.io/spring/docs/current/spring-framework-reference/html/mvc.html)\r\n\r\nExemple de definició d'un controlador:\r\n\r\n```\r\npackage cat.gencat.ctti.canigo.arch.web.rs.controller;\r\n\r\nimport org.springframework.web.bind.annotation.GetMapping;\r\nimport org.springframework.web.bind.annotation.RequestMapping;\r\nimport org.springframework.web.bind.annotation.RestController;\r\n\r\n@RestController\r\n@RequestMapping(\"/hello\")\r\npublic class HelloController {\r\n\r\n\t@GetMapping(produces = MediaType.APPLICATION_JSON_VALUE)\r\n\tpublic String getHello() {\r\n\t\treturn \"hello!\";\r\n\t}\r\n\r\n}\r\n```\r\n\r\n### Gestió d'errors per defecte\r\n\r\nUna de les funcionalitats que incorpora el Mòdul RS és la de gestió d'errors per defecte. S'ha definit un @RestControllerAdvice que intercepta les excepcions dels tipus:\r\n\r\n```\r\n\t- MultipartException\r\n\t- AuthenticationException\r\n\t- AccessDeniedException\r\n\t- ResourceNotFoundException\r\n    - Exception\r\n    \r\n```\r\nQuan es produeix aquestes excepcions a l'aplicació, són capturades pel @RestControllerAdvice i retornades en format JSON al client. El client rep un JSON amb el codi i missatge de l'excepció en el cos de la resposta, i en format JSON o JSONP si s'ha fet la crida amb una funció de retorn.\r\nEs pot personalitzar i \"localitzar\" (i18n) el missatge que s'envia al client per cadascuna de les excepcions. Això és possible fer-ho definint les següents propietats en els fitxers de recursos carregats a l'aplicació:\r\n\r\n```\t\r\n\t- canigo.web.rs.resource.notfoud.msg --> Per a les excepcions de tipus ResourceNotFoundException\r\n\t- canigo.web.rs.unauthorized.msg  --> Per a les excepcions de tipus AuthenticationException i AccessDeniedException\r\n\t- canigo.web.rs.multipart.bad.request.msg --> Per a les excepcions de tipus MultipartException\r\n\t- Per a la resta d'excepcions que estenguin del tipus Exception s'utilitza el localizedMessage de la mateixa excepció. Per tant, és necessari sobreescriure el mètode getLocalizedMessage amb la propietat el valor de la qual es vol enviar com a missatge al client. Un exemple seria el següent:\r\n\r\n\tpublic class CustomException extends Exception {\r\n\r\n\t\tprivate static final long serialVersionUID = -3973341495451225082L;\r\n\t\r\n\t\t@Override\r\n\t\tpublic String getLocalizedMessage() {\r\n\t\t\treturn \"custom.message\";\r\n\t\t}\r\n\r\n    }\r\n    \r\n    \r\n```\r\n\r\nEs poden definir tants RestControllerAdvice com es necessiti.\r\n\r\n\r\n### Objectes de suport\r\n\r\nAmb la finalitat d'estandaritzar i facilitar la feina als desenvolupadors, es posa a la seva disposició objectes estàndard de petició i resposta.\r\n\r\n#### Request\r\n\r\nS'han definit els següents objectes de petició, tenint en compte les bones pràctiques definides a [Canigó APIs RESTful](http://canigo.ctti.gencat.cat/blog/2016/01/api/):\r\n\r\n```\r\n\t- BatchRequest --> Per a peticions batch\r\n\r\n```\r\n\r\n#### Response\r\n\r\nS'han definit els següents objectes de resposta, tenint en compte les bones pràctiques definides a [Canigó APIs RESTful](http://canigo.ctti.gencat.cat/blog/2016/01/api/):\r\n\r\n```\r\n\t- ResponseBatch --> Per a peticions batch\r\n\t- ResponseError --> Per errors\r\n\t- ResponsePage  --> Per documents paginats\r\n    \r\n```\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1ycw=="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1hbnRpdmlydXM=":{"date":1426763195000,"title":"Antivirus","description":"Accés a l'escaneig d'arxius mitjançant el servei d'antivirus Centrals del CTTI.","sections":"Canigó. Documentació versió 3.x","weight":1,"path":"/canigo-documentacio-versions-3x-integracio/modul-antivirus","content":"## Propòsit\r\n\r\nAquest mòdul permet l'escaneig d'arxius mitjançant el servei d'antivirus Centrals del CTTI.\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer tal d'instal-lar el mòdul d'Antivirus es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.integration.antivirus.version>[1.4.0,1.5.0)</canigo.integration.antivirus.version>\r\n\r\n<dependency>\r\n    <groupId>cat.gencat.ctti</groupId>\r\n    <artifactId>canigo.integration.antivirus</artifactId>\r\n    <version>${canigo.integration.antivirus.version}</version>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració es realitza automàticament a partir de la eina de suport al desenvolupament.\r\n\r\nUbicació proposada: <PROJECT_ROOT>/src/main/resources/config/props/antivirus.properties\r\n\r\nPropietat                              | Requerit | Descripció\r\n-------------------------------------- | -------- | ----------\r\n*.antivirus.remote                     | Sí       | Paràmetre que indica si l'escaneig dels arxius es realitza de forma remota o no. Si fos de forma remota l'arxiu a escanejar s'ha de pujar abans al servidor d'antivirus centrals, procés que fa automàticament el mòdul. En cas de remote a fals s'enten que l'arxiu ja es troba pujat al servidor d'antivirus centrals. <br>Valor per defecte: true\r\n*.antivirus.serverIp                   | Sí       | IP del Host on es troba el Servidor d'antivirus Centrals.<br>  antivirus.intranet.gencat.cat per entorns productius <br> preproduccio.antivirus.intranet.gencat.cat per entorns preproductius i d'altres\r\n*.antivirus.serverPort                 | Sí       | Port del Host on es troba el Servidor d'antivirus Centrals.<br> Valor per defecte: 1344\r\n*.antivirus.numDayDBExpirationWarning  | Sí       | Número de dies que han de passar per que una definició de virus de la base de dades d'antivirus centrals es consideri caducada. <br>Valor per defecte: 15\r\n*.antivirus.failRetryTime              | No       | Mil·lisegons d'espera màxima per obrir la connexió al servidor d'antivirus. <br>Valor per defecte: 30000\r\n*.antivirus.readWriteTime              | No       | Mil·lisegons d'espera màxima per obtenir resposta d'una consulta al servidor d'antivirus. <br>Valor per defecte: 3600000\r\n\r\n## Utilització del Mòdul\r\n\r\nPer a utilizar aquest mòdul s'ha de demanar la llibreria sym-7.5.jar enviant un correu a la bústia canigó <oficina-tecnica.canigo.ctti@gencat.cat>\r\n\r\n### Exemple d'ús\r\n\r\n**AntivirusServiceController.java**\r\n\r\nEndpoint de l'aplicació que publica el servei de l'antivirus\r\n\r\n```java\r\n\timport java.io.InputStream;\r\n\r\n\timport org.springframework.beans.factory.annotation.Autowired;\r\n\timport org.springframework.http.MediaType;\r\n\timport org.springframework.web.bind.annotation.PostMapping;\r\n\timport org.springframework.web.bind.annotation.RequestMapping;\r\n\timport org.springframework.web.bind.annotation.RestController;\r\n\r\n\timport com.sun.jersey.core.header.FormDataContentDisposition;\r\n\timport com.sun.jersey.multipart.FormDataParam;\r\n\r\n\timport cat.gencat.plantilla32.service.AntivirusService;\r\n\r\n\t@RestController\r\n\t@RequestMapping(\"/antivirus\")\r\n\tpublic class AntivirusServiceController {\r\n\r\n\t\t@Autowired\r\n\t\tAntivirusService antivirusService;\r\n\r\n\t\t@PostMapping(consumes = {MediaType.MULTIPART_FORM_DATA_VALUE}, \r\n\t\t\t\tproduces = { MediaType.APPLICATION_JSON_VALUE })\r\n\t\tpublic String scan(@FormDataParam(\"file\") InputStream inputStream, \r\n\t\t\t\t\t\t\t@FormDataParam(\"file\") FormDataContentDisposition fileDetail) {\r\n\t\t\t\r\n\t\t\treturn antivirusService.scan(inputStream);\r\n\t\t}\r\n\t}\r\n```\r\n\r\n**AntivirusService.java**\r\n\r\nClasse java on es realitza la lògica de la operació i es crida al mòdul de l'antivirus\r\n\r\n```java\r\n\timport java.io.ByteArrayOutputStream;\r\n\timport java.io.IOException;\r\n\timport java.io.InputStream;\r\n\r\n\timport org.h2.util.IOUtils;\r\n\timport org.slf4j.Logger;\r\n\timport org.slf4j.LoggerFactory;\r\n\timport org.springframework.beans.factory.annotation.Autowired;\r\n\timport org.springframework.context.annotation.Lazy;\r\n\timport org.springframework.stereotype.Service;\r\n\r\n\timport cat.gencat.ctti.canigo.arch.integration.antivirus.Antivirus;\r\n\timport cat.gencat.ctti.canigo.arch.integration.antivirus.ResultatEscaneig;\r\n\timport cat.gencat.ctti.canigo.arch.integration.antivirus.beans.InfectionInfo;\r\n\timport cat.gencat.ctti.canigo.arch.integration.antivirus.exceptions.AntivirusException;\r\n\r\n\t@Service(\"antivirusService\")\r\n\t@Lazy\r\n\tpublic class AntivirusService {\r\n\r\n\t\t@Autowired\r\n\t\tprivate Antivirus service;\r\n\t\t\r\n\t\tprivate static final Logger log = LoggerFactory.getLogger(AntivirusService.class);\r\n\r\n\r\n\t\t /**\r\n\t\t * Escaneig de l'arxiu pujat al servidor\r\n\t\t *\r\n\t\t */\r\n\t\t\tpublic String scan(InputStream file){\r\n\t\t\t\tString resultat = null;\r\n\t\t\t\tString message = null;\r\n\t\t\t\tlog.info(\"AntivirusAction [scan] - Inici\");\r\n\t\t\t\tResultatEscaneig res = null;\r\n\t\t\t\ttry {\r\n\t\t\t\r\n\t\t\t\t\tByteArrayOutputStream out = new ByteArrayOutputStream();\r\n\t\t\t\t\t\r\n\t\t\t\t\tIOUtils.copy(file, out);\r\n\t\t\t\t\t\r\n\t\t\t\t\tres = service.scan(out.toByteArray());\r\n\t\t\t\r\n\t\t\t\t\tif (res != null) {\r\n\t\t\t\t\t\tswitch (res.getEstat()) {\r\n\t\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\t\tlog.info(\"AntivirusAction [scan] - arxiu sense Virus\");\r\n\t\t\t\t\t\t\tresultat = \"Arxiu sense Virus\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase -1:\r\n\t\t\t\t\t\t\tlog.info(\"AntivirusAction [scan] - arxiu amb Virus!\");\r\n\t\t\t\t\t\t\tStringBuffer sb = new StringBuffer();\r\n\t\t\t\t\t\t\tsb.append(\"Arxiu amb Virus!\");\r\n\t\t\t\t\t\t\tif(res.getArrayVirus()!=null){\r\n\t\t\t\t\t\t\t\tfor(InfectionInfo i : res.getArrayVirus()){\r\n\t\t\t\t\t\t\t\t\tsb.append(i.getFileName() + \" - \" + i.getViolationName() + \"; \");\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tresultat = sb.toString();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\t\tlog.info(\"AntivirusAction [scan] - Warning\");\r\n\t\t\t\t\t\t\tresultat = res.getMissatge();\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\tlog.info(\"AntivirusAction [scan] - Error en el procés d'escaneig\");\r\n\t\t\t\t\t\t\tresultat = \"S'ha produit un error\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\r\n\t\t\t\t\tmessage = \"Resultat del escaneig: \" + resultat;\r\n\t\t\t\r\n\t\t\t\t\tlog.info(\"AntivirusAction [scan] - Final\");\r\n\t\t\t\t} catch (AntivirusException ae) {\r\n\t\t\t\t\tlog.error(\"AntivirusException - Antivirus (\"+ service.getClass()+\"): \" + service\r\n\t\t\t\t\t\t\t+ \" \" + ae.getStackTrace());\r\n\t\t\t\t\tmessage = \"Resultat del escaneig(Error): \" + ae.getMessage();\r\n\t\t\t\t} catch (IOException e) {\r\n\t\t\t\t\tlog.error(\"AntivirusException - Antivirus (\"+ service.getClass()+\"): \" + service\r\n\t\t\t\t\t\t\t+ \" \" + e.getStackTrace());\r\n\t\t\t\t\tmessage = \"Resultat del escaneig(Error): \" + e.getMessage();\r\n\t\t\t\t} \r\n\t\t\t\t\r\n\t\t\t\treturn message;\r\n\t\t\t}\r\n\t}\r\n```\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1hbnRpdmlydXM="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1zYW1s":{"date":1529280000000,"title":"Mòdul Seguretat SAML","description":"Autenticació d'usuaris utilitzant SAML2","sections":"Canigó. Documentació versió 3.x","weight":10,"path":"/canigo-documentacio-versions-3x-core/modul-saml","content":"## Propòsit\n\nEl Mòdul de Seguretat SAML té com a propòsit principal gestionar l'autenticació dels usuaris en aplicacions Canigó a partir [d'assercions SAML2](https://en.wikipedia.org/wiki/SAML_2.0) del proveïdor d'identitats (Shibboleth) de GICAR. \n\n## Funcionament\n\nEl sistema d'autenticació per API REST de Canigó a partir d'assercions SAML GICAR té dues particularitats:\n\n•\tÉs totalment autocontingut en Java, es desplega amb la pròpia aplicació i és indiferent del servidor web per davant del servidor d’aplicacions. No requereix la instal•lació de software binari i configuració dels Apache que requereix Shibboleth SP.\n\n•\tÉs totalment stateless pel que fa a l’API REST. Amb implicacions, ja que SAML (Security Assertion Markup Language) és un protocol totalment stateful i que fa ús de cookies per desar informació.\n\n\nPer poder fer conviure una API stateless (aplicació Canigó amb autenticació JWT) i un sistema d'autenticació basat en assercions SAML (stateful) s'ha de dividir l'aplicació en dues parts:\n\n•\tWebapp stateless que conté l’API REST protegida per token JWT (Aplicació Canigó amb tota la funcionalitat)\n\n•\tWebapp stateful (aplicació Bridge) que conté la interface d’usuari protegida per asserció SAML. Actua com a Service Provider(SP) encarregant-se únicament d'obtenir i tractar les assercions SAML amb el proveïdor d'identitat (GICAR)\n\nL'aplicació Stateful funciona com a una SPA protegida per SAML. Al accedir, si l'usuari no es troba autenticat serà redirigit al login de GICAR. Un cop realitzat el login de forma satisfactòria l'usuari disposarà d'una asserció SAML vàlida.\n\nLa SPA s'ha d'encarregar aleshores de cridar a l'endpoint /api/saml de l'aplicació Stateless amb l'asserció SAML com a paràmetre en Base64. Aquest endpoint retorna un token JWT vàlid per a accedir als serveis REST de l'aplicació Stateless protegits.\n\n<div style=\"width:90%;margin:0 auto;\"><img style=\"width: 70%; height: auto\" src=\"/related/canigo/documentacio/modul-saml/diagrama.png\" alt=\"Diagrama seqüencia SAML-GICAR-JWT\" title=\"Diagrama seqüencia SAML-GICAR-JWT\"></img></div>\n\n## Aplicació Bridge (Stateful)\n\nDes de Canigó es proporciona una aplicació bridge plantilla per tal de fer-se servir com a Service Provider. Aquesta aplicació bridge s'ha de sol·licitar a l'equip del CS Canigó ja que conté dades sensibles.\n\n### Configuració\n\n#### Servidor Web\n\nSAML depèn dels noms DNS dels serveis, i la generació de metadades SAML depèn de que l'aplicació conegui el nom DNS. Els noms de DNS han de tenir sentit al navegador de l’usuari. Es poden crear metadades de SP amb noms de DNS locals encara que l’IdP no els conegui, però el navegador ha de ser capaç de resoldre'l.\n\nUtilitzar localhost no funciona, cal un proxy que exposi un nom DNS i es recomana que el protocol d'accés sigui SSL. \n\nPer a realitzar aquesta configuració s'ha utilitzat Apache 2.4 amb la següent configuració:\n\nAl fitxer httpd.conf s'han habilitat (si no es troben ja) els mòduls:\n\n\tproxy_module\n\tproxy_connect_module\n\tproxy_http_module\n\tssl_module\n\t\nÉs possible que aquests mòduls requereixin l'activació d'altres mòduls del que tinguin dependències. En cas que sigui així, també s'haurien d'incloure per a que el servidor funcioni correctament.\n\nIncloure, si no es troba ja, al final del fitxer httpd.conf la següent configuració:\n\n\t<IfModule ssl_module>\n\tInclude conf/extra/httpd-ssl.conf\n\tSSLRandomSeed startup builtin\n\tSSLRandomSeed connect builtin\n\t</IfModule>\n\nA continuació al fitxer conf/extra/httpd-ssl.conf configurar el VirtualHost_\n\n\t<VirtualHost _default_:443>\n\n\t#Path on es deixa el contingut stàtic de l'aplicació Bridge\n\tDocumentRoot \"${SRVROOT}/htdocs/saml\"\n\tServerName vagrant.vm\n\tServerAlias www.vagrant.vm\n\tServerAdmin admin@example.cat\n\tErrorLog \"${SRVROOT}/logs/error_bridge.log\"\n\tTransferLog \"${SRVROOT}/logs/access.log\"\n\n\tSSLEngine on\n\n\tSSLProxyEngine on\n\n\tProxyRequests Off\n\tProxyPreserveHost On\n\n\t#connexió amb l'aplicació Bridge\n\tProxyPass /bridge/ http://localhost:8080/bridge/\n\tProxyPassReverse /bridge/ http://localhost:8080/bridge/\n\n\t#connexió amb l'API de Canigó\n\tProxyPass /api/ http://localhost:9090/api/\n\tProxyPassReverse /api/ http://localhost:9090/api/\n\n\tSSLCipherSuite ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP:+eNULL\n\n\t#Certificats SSL\n\tSSLCertificateFile \"${SRVROOT}/conf/ssl/apache.crt\"\n\tSSLCertificateKeyFile \"${SRVROOT}/conf/ssl/apache.key\"\n\n\t<FilesMatch \"\\.(cgi|shtml|phtml|php)$\">\n\t\tSSLOptions +StdEnvVars\n\t</FilesMatch>\n\t<Directory \"${SRVROOT}/cgi-bin\">\n\t\tSSLOptions +StdEnvVars\n\t</Directory>\n\n\tBrowserMatch \".*MSIE.*\" \\\n\t\t\t nokeepalive ssl-unclean-shutdown \\\n\t\t\t downgrade-1.0 force-response-1.0\n\n\n\t</VirtualHost>     \n\nEls certificats apache.crt i apache.key es poden generar amb [openssl](ttps://www.openssl.org/):\n\n\topenssl req -x509 -nodes -days 1095 -newkey rsa:2048 -out ${SRVROOT}/conf/ssl/apache.crt -keyout ${SRVROOT}/conf/ssl/apache.key\n\t\nAquesta operació demanarà omplir algunes dades, la realment important el paràmetre \"Common Name\" que ha de ser el mateix que el valor posat a **ServerName** al fitxer httpd-ssl.conf.\n\nAddicionalment en cas que el navegador no pugui resoldre el nom de servidor, s'haurà d'afegir al fitxer hosts:\n\n\t127.0.0.1\tvagrant.vm\n\nA l'aplicació Bridge per a realitzar la connexió per HTTPS s'ha d'indicar el schema y el proxyPort al tomcat de Spring Boot, al fitxer **TomcatContainerCustomizer**\n\n\timport org.slf4j.Logger;\n\timport org.slf4j.LoggerFactory;\n\timport org.springframework.boot.context.embedded.ConfigurableEmbeddedServletContainer;\n\timport org.springframework.boot.context.embedded.EmbeddedServletContainerCustomizer;\n\timport org.springframework.boot.context.embedded.tomcat.TomcatEmbeddedServletContainerFactory;\n\timport org.springframework.stereotype.Component;\n\n\t@Component\n\tpublic class TomcatContainerCustomizer implements EmbeddedServletContainerCustomizer{\n\t\t\n\t\tprivate static final Logger logger = LoggerFactory.getLogger(TomcatContainerCustomizer.class);\n\n\t\t@Override\n\t\tpublic void customize(ConfigurableEmbeddedServletContainer container) {\n\t\t\tif (container instanceof TomcatEmbeddedServletContainerFactory) {\n\t\t\t\tfinal TomcatEmbeddedServletContainerFactory tomcat = (TomcatEmbeddedServletContainerFactory) container;\n\t\t\t\ttomcat.addConnectorCustomizers(connector -> { \n\t\t\t\t\tconnector.setScheme(\"https\");\n\t\t\t\t\tconnector.setProxyPort(443);\n\t\t\t\t});\n\t\t\t\tlogger.info(\"Enabled secure scheme (https).\");\n\t\t\t} else {\n\t\t\t\tlogger.warn(\"Could not change protocol scheme because Tomcat is not used as servlet container.\");\n\t\t\t}\n\t\t}\n\t}\n\n#### Intercanvi de Metadades Aplicació Bridge (SP) amb IdP GICAR\n\nPer a realitzar la comunicació SAML entre SP (aplicació Bridge) i IdP (GICAR) cadascú ha de tenir les metadades de l'altre.\n\nPer obtenir les metadades de l'IdP GICAR s'ha de demanar a GICAR. A l'entorn de PRE a la redacció d'aquest manual es poden trobar a:\n\n\thttps://preproduccio.idp1-gicar.gencat.cat/idp/shibboleth \n\t\nA l'aplicació Bridge proporcionada pel CS Canigó, aquest fitxer s'ha desat a src/resources/saml/metadata/metaDadesGicarPRE.xml\n\nAl fitxer de propietats config/props/saml.properties s'ha d'indicar el path:\n\n\t*.idpMetadata=/saml/metadata/metaDadesGicarPre.xml\n\nDel fitxer de metadades proporcionat per GICAR s'obté l'entityId que també s'ha d'indicar al fitxer saml.properties\n\n\t*.idpEntityId=https://preproduccio.idp1-gicar.gencat.cat/idp/shibboleth\n\nA GICAR se li ha de proporcionar el fitxer metadades del SP, per a generar aquest fitxer cal definir les següents propietats al fitxer saml.properties\n\nPropietat                     | Descripció                                                              | Valor a l'aplicació Bridge proporcionada\n----------------------------- | ------------------------------------------------------------------------|------------------\n*.spId                 \t\t  | Identificador del SP. Serveix un UUID a l’atzar precedit de id_, S'ha de consensuar amb GICAR per a que sigui únic\t    | id_d1e325c0-f6ca-11e7-8c3f-9a214cf093ae\n*.spEntityId                  | EntityID del SP. També ha de ser consensuat amb GICAR per a que sigui únic\t| https://vagrant.vm/bridge00\n*.spEntityBaseURL             | URL de l'aplicació\t| https://vagrant.vm/bridge\n*.spKeystore                  | Localització del certificat del Service Provider\t| classpath:/saml/samlKeystore.jk\n*.spKeystorePass              | Clau privada del certificat | nalle123\n*.spKeyname                   | Nom d'accés a la clau privada del certificat\t| apollo\n*.spKeynamePass               | Contrasenya d'accés a la clau privada del certificat\t| nalle123\n\nUna vegada configurat les dades accedint a la url de l'aplicació Bridge amb l'endpoint /saml/metadata s'obté el fitxer metadades que s'ha de proporcionar a GICAR.\n\nA l'aplicació Bridge demo la url es: https://vagrant.vm/bridge/saml/metadata\n\nEl fitxer que genera amb la configuració predeterminada seria el següent:\n\n\t<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n\t<md:EntityDescriptor xmlns:md=\"urn:oasis:names:tc:SAML:2.0:metadata\"\n\t\tID=\"id_d1e325c0-f6ca-11e7-8c3f-9a214cf093ae\" entityID=\"https://vagrant.vm/bridge00\">\n\t\t<md:SPSSODescriptor AuthnRequestsSigned=\"true\"\n\t\t\tWantAssertionsSigned=\"true\" protocolSupportEnumeration=\"urn:oasis:names:tc:SAML:2.0:protocol\">\n\t\t\t<md:KeyDescriptor use=\"signing\">\n\t\t\t\t<ds:KeyInfo xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\">\n\t\t\t\t\t<ds:X509Data>\n\t\t\t\t\t\t<ds:X509Certificate>certificat...\n\t\t\t\t\t\t</ds:X509Certificate>\n\t\t\t\t\t</ds:X509Data>\n\t\t\t\t</ds:KeyInfo>\n\t\t\t</md:KeyDescriptor>\n\t\t\t<md:KeyDescriptor use=\"encryption\">\n\t\t\t\t<ds:KeyInfo xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\">\n\t\t\t\t\t<ds:X509Data>\n\t\t\t\t\t\t<ds:X509Certificate>certificat...\n\t\t\t\t\t\t</ds:X509Certificate>\n\t\t\t\t\t</ds:X509Data>\n\t\t\t\t</ds:KeyInfo>\n\t\t\t</md:KeyDescriptor>\n\t\t\t<md:SingleLogoutService\n\t\t\t\tBinding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST\" Location=\"https://vagrant.vm/bridge/saml/SingleLogout\" />\n\t\t\t<md:SingleLogoutService\n\t\t\t\tBinding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect\"\n\t\t\t\tLocation=\"https://vagrant.vm/bridge/saml/SingleLogout\" />\n\t\t\t<md:NameIDFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress\n\t\t\t</md:NameIDFormat>\n\t\t\t<md:NameIDFormat>urn:oasis:names:tc:SAML:2.0:nameid-format:transient\n\t\t\t</md:NameIDFormat>\n\t\t\t<md:NameIDFormat>urn:oasis:names:tc:SAML:2.0:nameid-format:persistent\n\t\t\t</md:NameIDFormat>\n\t\t\t<md:NameIDFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified\n\t\t\t</md:NameIDFormat>\n\t\t\t<md:NameIDFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:X509SubjectName\n\t\t\t</md:NameIDFormat>\n\t\t\t<md:AssertionConsumerService\n\t\t\t\tBinding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST\" Location=\"https://vagrant.vm/bridge/saml/SSO\"\n\t\t\t\tindex=\"0\" isDefault=\"true\" />\n\t\t\t<md:AssertionConsumerService\n\t\t\t\tBinding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Artifact\"\n\t\t\t\tLocation=\"https://vagrant.vm/bridge/saml/SSO\" index=\"1\" />\n\t\t</md:SPSSODescriptor>\n\t</md:EntityDescriptor>\n\n#### Altres configuracions Aplicació Bridge\n\nLes assercions tenen un temps de vida útil que potser massa estricte en cas de no generar el token JWT a l'instant, es pot afegir un temps addicional en minuts amb la propietat al fitxer saml.properties:\n\n\t*.extraValidityMinutes=60\n\t\n\n## API Canigó (Stateless)\n\nAquesta és l'aplicació on l'usuari vol accedir. Per a poder accedir als endpoints publicats un usuari ha de tenir un token JWT vàlid. Per a obtenir un token vàlid s'ha de fer a partir d'un asserció SAML a través de l'endpoint **/api/saml** que proporciona el mòdul de seguretat SAML.\n\n### Instal•lació\n\nPer tal d'instal•lar el mòdul de Seguretat SAML s'ha d'afegir al pom.xml de l'aplicació la següent dependència\n\n\t<dependency>\n\t\t<groupId>cat.gencat.ctti</groupId>\n\t\t<artifactId>canigo.security.saml.rest</artifactId>\n\t\t<version>${canigo.security.saml.rest}</version>\n\t</dependency>\n\t\nA la [Matriu de Compatibilitats] (/canigo-download-related/matrius-compatibilitats/) es pot veure la versió del mòdul segons la versió Canigó utilitzada\n\n### Configuració\n\nLa configuració SAML requereix les següent propietats al fitxer security.properties\n\nPropietat                     | Descripció                                                              | Valor a l'aplicació \n----------------------------- | ------------------------------------------------------------------------|------------------\n*.saml.idpMetadataResource    | Path del classpath on es troba el fitxer Metadades de GICAR\t    | /metadata/gicar/metaDadesGicarPre.xml\n*.saml.idpMetadaFile          | En cas de no informar el valor anterior i no tenir el fitxer Metadades al classpath, path on es troba el fitxer\t| \n*.saml.idpEntityId           | EntityID del IdP. (GICAR)\t| https://preproduccio.idp1-gicar.gencat.cat/idp/shibboleth\n*.saml.spBridgeEntityId       | EntityID del SP. (Aplicació Bridge) | https://vagrant.vm/bridge00\n*.saml.extraValidityMinutes    | Les assercions tenen un temps de vida útil que potser massa estricte en cas de no generar el token JWT a l'instant, es pot afegir un temps addicional en minuts | 60\n\nAl fitxer **app-custom-security.xml** és necessari definir dos authentication providers, un per a realitzar la autenticació SAML i un altre que s'encarrega de l'autorització (Arxiu, Base de dades, etc)\n\nPer exemple amb autorització per fitxer:\n\n\t<security:authentication-manager>\n\t\n\t\t<security:authentication-provider>\n\t\t\t<security:password-encoder hash=\"plaintext\"/>\n\t\t\t<security:user-service properties=\"classpath:config/props/security.users.properties\"/>\n\t\t</security:authentication-provider>\n\t\t\n\t\t<security:authentication-provider ref=\"samlAuthenticationProvider\">\n\t\t</security:authentication-provider>\n\t\t\n\t</security:authentication-manager>\n\nAl fitxer **security.users.properties** es troben els detalls dels usuaris amb autorització per accedir a l'aplicació amb el següent format:\n\n\tIDGICAR=password, ROLE, [ROLE_N..,] enabled\n\t\nCom s'utilitza les assercions SAML per a les autoritzacions la contrasenya proporcionada en aquest fitxer no s'utilitza.\n\nAl fitxer **WebSecurityConfig** s'han d'establir els Beans dels serveis d'autorització i validació SAML i un JWT token handler orientat a SAML\n\n\t@Bean\n\t@Named(\"samlAuthenticationService\")\n\tpublic AuthenticationService samlAuthenticationService() {\n\t\tfinal SAMLAuthenticationService samlAuthenticationService = new SAMLAuthenticationService();\n\t\tsamlAuthenticationService.setTokenResponseHeaderName(getTokenResponseHeaderName());\n\t\treturn samlAuthenticationService;\n\t}\n\n\t@Bean\n\tpublic SAMLValidationService samlValidationService() {\n\n\t\tSAMLValidationServiceOpenSAML samlValidationService = new SAMLValidationServiceOpenSAML();\n\t\tsamlValidationService.config(propertiesConfiguration);\n\n\t\treturn samlValidationService;\n\t}\n\n\t@Bean\n\t@Named(\"samlJwtTokenHandler\")\n\tpublic SAMLJwtTokenHandler samlJwtTokenHandler() {\n\t\t\n\t\tfinal SAMLJwtTokenHandler samlJwtTokenHandler = new SAMLJwtTokenHandler();\n\t\t\n\t\tsamlJwtTokenHandler.setExpiration(getExpiration());\n\t\tsamlJwtTokenHandler.setSecret(getSecret());\n\t\t\n\t\tSAMLJwtTokenClaimsEnforcer enforcer = new SAMLJwtTokenClaimsEnforcerMail();\n\t\tsamlJwtTokenHandler.setEnforcer(enforcer);\n\t\t\n\t\tSAMLJwtTokenClaimsSelector selector = new SAMLJwtTokenClaimsSelectorMailNomCognoms();\n\t\tsamlJwtTokenHandler.setSelector(selector);\n\t\t\n\t\treturn samlJwtTokenHandler;\n\t}\n\n\n## Exemple d'execució\n\nPer a l'execució de prova s'ha desplegat l'aplicació Bridge al port 8080, i l'aplicació Canigó al port 9090.\n\nS'intenta accedir al SPA de l'aplicació Bridge: https://vagrant.vm/bridge/app sense tenir sessió, la capa de seguretat detecta la necessitat d'autenticació i fa una redirecció 302 al SS0 (URL de GICAR IdP).\n\nS'han d'introduïr les credencials d'un usuari vàlid a GICAR, i a continuació es fa la redirecció a la SPA amb l'asserció SAML.\n\nLa SPA proporcionada a l'aplicació Bridge té dues parts:\n\n- Una on es mostra informació general obtinguda a partir de l'asserció SAML. Mostra a modo informatiu informació extreta de l'asserció.\n\n![Informació General](/related/canigo/documentacio/modul-seguretat-saml/assertionInformation.jpg)\n\n- L'altre part proporciona un botó per a capturar l'asserció i generar el JWT Token (Al ser una aplicació Demo es fa a través d'un botó, però en entorns productius aquesta part s'hauria de fer automàticament al carregar la pàgina), i un altre botó per accedir a un endpoint protegit de l'API de Canigó, en aquest cas obtenir un llistat dels equipaments.\n\n![Test SAML](/related/canigo/documentacio/modul-seguretat-saml/testsaml.jpg)\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1zYW1s"},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC10cmFjZXM=":{"date":1425571902000,"title":"Mòdul de traces","description":"Mòdul de detecció d'errades i registre de les operacions realitzades a l'aplicació.","sections":"Canigó. Documentació versió 3.x","weight":7,"path":"/canigo-documentacio-versions-3x-core/modul-traces","content":"## Introducció\r\n\r\n### Propòsit\r\n\r\nEl mòdul de traces té com a missió:\r\n\r\n-   Detectar i localitzar amb més facilitat errors de l'aplicació\r\n-   Entrada de dades incorrectes segons la lògica del sistema\r\n-   Seguiment per a auditoria\r\n\r\nPer a què això pugui ser portat a terme, el servei ofereix la\r\npossibilitat de:\r\n\r\n1.  Definir nivells de traces (d'informació, fatals, errors, etc.)\r\n2.  Definir en quines sortides es generarà la traça: consola, fitxers,\r\n    base de dades, correu electrònic, etc.\r\n3.  Canviar en qualsevol moment quin és el mínim nivell de traces que\r\n    volem mostrar, sense haver d'afectar a les classes que generen les\r\n    traces\r\n4.  Definir el format de sortida de les nostres traces: incorporar\r\n    l'hora, el número de línia del codi on s'ha produït i la seva\r\n    classe, etc.\r\n5.  Incorporar informació de context a la traça: usuari, IP del client,\r\n    etc.\r\n\r\n### Documents i Fonts de Referència\r\n\r\nNom          | Adreça\r\n------------ | ------------\r\nLog4J2 Manual | http://logging.apache.org/log4j/2.x/\r\n\r\n### Glossari\r\n\r\n**Log4J2**\r\n\r\nEvolució de Log4J, un dels framework de traces més estès. Es basa en l'ús d'Appenders,\r\nLoggers i Layouts. Veure l'annex per a més informació.\r\n\r\n## Descripció detallada\r\n\r\n### Arquitectura i components\r\n\r\nA més de les funcionalitats oferides per la pròpia API de Log4j2, Canigó\r\ndisposa d'un conjunt de components addicionals:\r\n\r\n1.  Configuració de traces multientorn.\r\n2.  Modificar el nivell de traces en calent d'una aplicació.\r\n3.  Eina de consulta de logs en calent.\r\n4.  Afegir informació contextual als logs.\r\n\r\n### Instal·lació i configuració\r\n\r\n#### Instal·lació\r\n\r\nEl mòdul de traces s'inclou per defecte dins del core de Canigó 3.\r\nDurant el procés de creació de l'aplicació, l'eina de\r\nsuport al desenvolupament inclourà la referència dins del pom.xml. En\r\ncas d'una instal·lació manual afegir les següents línies al pom.xml de\r\nl'aplicació:\r\n\r\n```java\r\n<canigo.core.version>[3.2.0,3.3.0)</canigo.core.version>\r\n\r\n<dependency>\r\n          <groupId>cat.gencat.ctti</groupId>\r\n          <artifactId>canigo.core</artifactId>\r\n          <version>${canigo.core.version}</version>\r\n</dependency>\r\n```\r\n\r\n#### Configuració\r\n\r\nL'eina de desenvolupament de Canigó 3 genera de manera automàtica els\r\ndiferents arxius de configuració de traces per entorn:\r\n\r\n-   log4j2.loc.xml Arxiu de configuració per a entorn locals.\r\n-   log4j2.int.xml Arxiu de configuració per a l'entorn d'integració.\r\n-   log4j2.pre.xml Arxiu de configuració per a l'entorn de preproducció.\r\n-   log4j2.pro.xml Arxiu de configuració per a l'entorn de producció.\r\n-   log4j2.xml Arxiu de configuració per defecte. En el cas de no trobar cap configuració específica per a l'entorn, aquesta pasarà a ser la de per defecte.\r\n\r\nDirectori de configuració: <PROJECT_ROOT>/src/main/resources/log4j2/*.xml\r\n\r\nPer cadascun dels entorns els nivells de logs poden variar.\r\n\r\nExemple de configuració log4j2.xml en local:\r\n\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<Configuration>\r\n\t<Appenders>\r\n\t    <RollingFile name=\"DAILY_LOG\" fileName=\"/tmp/log.log\" filePattern=\"tmp/%d{ddMMyyyy}_log.log\" append=\"true\">\r\n\t\t\t<PatternLayout pattern=\"canigo Message: %d{dd MM yyyy HH:mm:ss,SSS} %-5p [%t] %-5p [%t] %c - %m%n\"/>\r\n\t\t    <Policies>\r\n\t\t    \t<TimeBasedTriggeringPolicy interval=\"1\"/>\r\n\t\t    </Policies>                               \r\n\t\t</RollingFile>\r\n\t\t<Console name=\"STDOUT\" target=\"SYSTEM_OUT\">\r\n\t\t\t<PatternLayout\r\n\t\t\t\tpattern=\"canigo Message: %d{dd MM yyyy HH:mm:ss,SSS} %-5p [%t] %-5p [%t] %c - %m%n\" />\r\n\t\t</Console>\r\n\t</Appenders>\r\n\t<Loggers>\r\n\t\t<Logger name=\"cat.gencat.ctti\" level=\"debug\" additivity=\"false\">\r\n\t\t\t<AppenderRef ref=\"DAILY_LOG\" />\r\n\t\t\t<AppenderRef ref=\"STDOUT\" />\r\n\t\t</Logger>\r\n\t\t<Root level=\"info\">\r\n\t\t\t<AppenderRef ref=\"DAILY_LOG\" />\r\n\t\t</Root>\r\n\t</Loggers>\r\n</Configuration>\r\n\r\n```\r\n\r\nD'aquesta configuració d'exemple destaquem:\r\n\r\n-   Existeixen dos tipus d'appender, un que mostrarà la informació per\r\n    la consola del servidor d'aplicacions, i un altre que inserirà les\r\n    traces a un log que rotarà automàticament cada dia.\r\n-   Les traces provinents del package \"cat.gencat.ctti\" es\r\n    visualitzaran tant en la consola d'arranc del servidor com a un\r\n    arxiu de logs.\r\n-   Els packages restants (aplicació i llibreries de tercers) es\r\n    mostraran només per consola i amb nivell de log INFO.\r\n\r\n#### Appenders\r\n\r\nEls appenders més comuns i utilitzat son Console i RollingFile.\r\n\r\nEl appender Console treu els missatges per consola\r\n```\r\n<Console name=\"STDOUT\" target=\"SYSTEM_OUT\">\r\n\t<PatternLayout\r\n\t\tpattern=\"canigo Message: %d{dd MM yyyy HH:mm:ss,SSS} %-5p [%t] %-5p [%t] %c - %m%n\" />\r\n</Console>\r\n```\r\n\r\nEl appender RollingFile treu els missatges per un fitxer que es va rotant cada cert temps.\r\nA filePattern s'indica un patró de data pel nom del fitxer que es rota. Al paràmetre TimeBaseTriggeringPolicy s'indica cada quan es rota el fitxer. Aquest número farà referència a la mínima unitat de temps del patró trobat a filePattern.\r\n\r\nPer exemple si en indiquem 1, i el patró és ddMMyyyy, es rotarà cada dia. Si el patró fos MMyyyy, es rotaria cada mes\r\n```\r\n<RollingFile name=\"DAILY_LOG\" fileName=\"/tmp/log.log\" filePattern=\"tmp/%d{ddMMyyyy}_log.log\" append=\"true\">\r\n\t<PatternLayout pattern=\"canigo Message: %d{dd MM yyyy HH:mm:ss,SSS} %-5p [%t] %-5p [%t] %c - %m%n\"/>\r\n\t<Policies>\r\n\t\t<TimeBasedTriggeringPolicy interval=\"1\"/>\r\n\t</Policies>                               \r\n</RollingFile>\r\n```\r\n\r\nAl següent enllaç es troba la informació de tots els appenders existents a Log4J2.\r\n\r\nhttps://logging.apache.org/log4j/2.x/manual/appenders.html\r\n\r\n#### PatternLayout\r\n\r\nPermet especificar la sortida amb patrons de conversió. El seu ús és equivalent a la funció printf del llenguatje C.\r\n\r\nAlguns dels caràcters de conversió més interessants són (per a més referència consultar la API de la classe):\r\n\r\n**Caràcter** | **Descripció**\r\n------------ | --------------\r\n%c           | Nom del \"logger\"\r\n%C           | Mostrar el nom qualificat de la classe que ha llençat el missatge.\r\n%d           | Mostrar la data en què es va produir el missatge. A continuació opcionalment pot aparèixer el patró de conversió de data. Si no s'especifica s'utilitza per defecte **ISO 8601.** <br>Exemple: %d{dd MMM yyyy HH:mm:ss,SSS}.\r\n%L           | Número de línia a on es va llençar el missatge (**no fer servir si es necessita un bon rendiment**).\r\n%m           | Missatge\r\n%p           | Prioritat/nivell del missatge (WARN,...).\r\n%X{clau}     | Informació contextual \"clau\"\r\n%n           | Separador de línia (un \\n).\r\n\r\nEl resultat de l'aplicació d'aquests patrons són missatges de text pla\r\nuniformement formatejats.\r\n\r\nEl patró per defecte a les aplicacions Canigó és el següent:\r\n\r\n```\r\ncanigo Message: %d{dd MM yyyy HH:mm:ss,SSS} %-5p [%t] %-5p [%t] %c - %m%n\r\n\r\nQue fa que els logs surten de la següent manera:\r\n\r\ncanigo Message: 10 11 2016 16:25:39,578 DEBUG [http-bio-8081-exec-1] DEBUG [http-bio-8081-exec-1] org.hibernate.hql.internal.ast.ErrorCounter - throwQueryException() : no errors\r\ncanigo Message: 10 11 2016 16:25:39,579 DEBUG [http-bio-8081-exec-1] DEBUG [http-bio-8081-exec-1] org.hibernate.hql.internal.ast.QueryTranslatorImpl - HQL: select equipament.nom from cat.gencat.test.model.Equipament equipament\r\n```\r\n\r\nUtilització del Servei\r\n----------------------\r\n\r\n### Generar Missatges\r\n\r\nPer a generar les traces el framework utilitzat per les aplicacions Canigó 3.2 és SLF4J\r\nPer generar una traça en nivell debug tindríem el següent codi:\r\n\r\n```\r\nimport org.slf4j.Logger;\r\nimport org.slf4j.LoggerFactory;\r\n\r\npublic class ExempleTrace{\r\n\r\n   private static final Logger LOGGER = LoggerFactory.getLogger(ExempleTrace.class);\r\n\r\n   public void execute(){\r\n      if (LOGGER.isDebugEnabled()){\r\n         LOGGER.debug(\"Traça d'exemple\");\r\n      }\r\n   }\r\n}\r\n```\r\n\r\n### Recomanacions\r\n\r\n#### Recomanacions generals\r\n\r\n-   Mai utilitzar System.out.println.\r\n-   Instància de manera estàtica i final el log per evitar\r\n    instanciacions innecessàries.\r\n-   Sobreescriu sempre el mètode toString() per donar una representació\r\n    de l'objecte. Obtenir una traça del tipus className@16cd7d5 no aporta\r\n    res.\r\n-   Valida el nivell de traces abans d'escriure.\r\n\r\n#### Recomanacions davant excepcions\r\n\r\n-   No utilitzar e.printStackTrace.\r\n\r\ne.printStackTrace només imprimeix en consola. Només es podrà visualitzar\r\naquesta informació si s'ha definit un appender de consola.\r\n\r\n```\r\ntry {\r\n   ................\r\n} catch (MyException e) {\r\n    e.printStackTrace();\r\n}\r\n```\r\n\r\nUtilitzar LOGGER.error(message, t) on t és l'excepció capturada:\r\n\r\n```\r\ntry {\r\n    ................\r\n} catch (MyException e) {\r\n    LOGGER.error(\"S'ha produït un error: \", e);\r\n    .........................\r\n}\r\n```\r\n\r\n-   No utilitzar LOGGER.error i després rellançar l'excepció si no és\r\n    estrictament necessari:\r\n\r\n```\r\ntry {\r\n    ................\r\n} catch (MyException e) {\r\n    LOGGER.error(\"S'ha produït un error: \", e);\r\n    throw e;\r\n}\r\n```\r\n\r\nSi en altres nivells es fa el mateix, s'imprimirà les excepcions\r\ndiverses vegades, portant a la confusió.\r\n\r\n-   No eliminar el stacktrace\r\n\r\n```\r\ntry{\r\n    ......\r\n}catch(MyException e){\r\n    throw new RuntimeException(\"S'ha produït un error: \" + e.getMessage());\r\n}\r\n```\r\n\r\nAquest codi elimina el stacktrace de MyException. Es perd informació\r\nútil sobre l'excepció. L'alternativa correcta és:\r\n\r\n```\r\ntry{\r\n   ...\r\n}catch(MyException e){\r\n   throw new RuntimeException(\"S'ha produït un error: \", e);\r\n}\r\n```\r\n\r\n#### Evitar càlculs innecessaris\r\n\r\nUna de les qüestions més importants del sistema de traces és el cost de\r\ncomputació. Si en un moment donat es desactiven determinats nivells de\r\ntraces, encara que aquesta traça no es generi a la sortida el missatge és\r\navaluat (ja que es troba com un paràmetre de la crida). Si l'avaluació\r\ndel missatge comporta càlculs estem afegint un cost innecessari.\r\n\r\nPer evitar afegir costos addicionals de còmput innecessari es recomana\r\nprèviament comprovar que es troba activat el nivell pel qual generarem\r\nel missatge. Així, per exemple, enlloc de:\r\n\r\n```\r\nLOGGER.debug(\"....\");\r\n```\r\n\r\nHaurem sempre de realitzar:\r\n\r\n```\r\nif (LOGGER.isDebugEnabled())\r\nLOGGER.debug(\"....\");\r\n```\r\n\r\n#### Programació de traces\r\n\r\nCom a recomanació de traces i nivell d'aquestes dins d'un mètode podrien\r\nser les següents:\r\n\r\n1.  Traça a nivell debug al començament del mètode, informant els\r\n    paràmetres d'entrada que poden arribar a ser útils per a detectar\r\n    l'operació realitzada.\r\n2.  Traça a nivell info informant de l'operació realitzada, si\r\n    escau.\r\n3.  Traça a nivell error o warn per a blocs destinats a la captura\r\n    d'excepcions.\r\n\r\n```\r\npublic void inserirUsuari(String nom){\r\ntry {\r\n      if (LOGGER.isDebugEnabled()) {\r\n    LOGGER.debug(\"UsuarioDAOImpl:eliminarUsuario ...identificador del usuario:\" + identificadorUsuario);\r\n      }\r\n\r\n      User user = new User();\r\n      user.setName(nom);\r\n      getUserDAO().insert(user);\r\n\r\n      if (LOGGER.isInfoEnabled()) {\r\n     LOGGER.info(\"Usuari \" + user + \" inserit a la BD\");\r\n      }\r\n\r\n }\r\n catch (Exception e) {\r\n    LOGGER.error(\"S'ha produït un error, e);\r\n    ........\r\n }\r\n}\r\n```\r\n\r\n### Generar Informació Contextual\r\n\r\nMoltes vegades no és suficient amb la informació estàndard que es mostra\r\na les traces i és necessari complementar-la amb informació contextual\r\ncom: usuari que fa la petició, temps d'inici i final, etc. Per afegir\r\naquesta informació, és necessari inicialitzar-la en algun moment de la\r\npetició perquè estigui disponible durant tot el processament d'aquesta. Per tant, el patró de treball a seguir és:\r\n\r\n1.  Inicialització de la informació addicional abans de processar la\r\n    petició.\r\n2.  Processament de la petició (utilització de la informació addicional en\r\n    el mòdul de traces).\r\n3.  Finalització de la petició.\r\n\r\n**Canigó** suporta la inserció d'aquesta informació mitjançant l'extensió del filtre\r\nLoggingFilter.\r\nGràcies al mètode createCustomParameters, el desenvolupador pot afegir o\r\neliminar paràmetres de la Mapped Diagnostic Context (MDC) de SLF4J que\r\nposteriorment seran inserits a les traces de l'aplicació.\r\n\r\nUn exemple de filtre que afegeix informació de l'usuari, adreça i host\r\nremot a les traces podria ser:\r\n\r\n```\r\npublic class ExtendedLoggingFilter extends LoggingFilter {\r\n\r\n     private final static String USERNAME = \"USERNAME\";\r\n     private final static String REMOTEHOST = \"REMOTEHOST\";\r\n     private final static String REMOTEADDR = \"REMOTEADDR\";\r\n\r\n     @Override\r\n     protected Map<String, Object> createCustomParameters( ServletRequest request, ServletResponse response) {\r\n\r\n\t\tMap<String,Object> custom = new HashMap<String, Object>();\r\n\t\tcustom.put(REMOTEHOST, request.getRemoteHost());\r\n        custom.put(REMOTEADDR, request.getRemoteAddr());\r\n\r\n\t\tHttpServletRequest httprequest = (HttpServletRequest) request;\r\n        String userLogin = (String)httprequest .getSession().getAttribute(\"userLogin\");\r\n\r\n        if (userLogin!=null) {\r\n            custom.put(USERNAME, userLoginId);\r\n        }\r\n        return custom;\r\n     }\r\n}\r\n```\r\n\r\nConfiguració del layout per a mostrar les dades:\r\n\r\n```\r\n<Console name=\"STDOUT\" target=\"SYSTEM_OUT\">\r\n\t<PatternLayout\r\n\t\tpattern=\"%X{USERNAME}%n - %X{REMOTEHOST} - %X{REMOTEADDR} canigo Message: %d{dd MM yyyy HH:mm:ss,SSS} %-5p [%t] %-5p [%t] %c - %m%n\" />\r\n</Console>\r\n```\r\n\r\n## Annexos\r\n\r\n### Introducció a Log4J2\r\n\r\nEn aquest annex s'ofereix una breu introducció a conceptes de Log4J2 que\r\ncal entendre per utilitzar el Servei de Traces.\r\n\r\nA Log4J2, existeixen diversos elements clau:\r\n\r\n1.  Prioritats o nivells de les traces. Log4J2 defineix per defecte 5\r\n    nivells: DEBUG, INFO, WARN, ERROR i FATAL. Entre ells existeix una\r\n    jerarquia (DEBUG<INFO<WARN<ERROR<FATAL), de forma que si en\r\n    l'aplicació s'ha configurat que només es mostrin traces de nivell\r\n    WARN, també es mostrarien els de nivell ERROR i FATAL.\r\n    \r\n    ![](/related/canigo/documentacio/modul-traces/ServeiTraces_img014.jpg)\r\n    \r\n2.  Loggers. Els loggers donen control al programador per a\r\n    determinar quins events requereixen ser capturats i quins no. Dins\r\n    de l'aplicació es poden definir diferents loggers organitzats\r\n    per jerarquia que en la majoria dels casos es mapejen amb el nom\r\n    qualificat de les classes java, a on cada classe tindria el seu logger. \r\n    \r\n3.  Appenders. Els \"appenders\" especifiquen a on es desarà la traça\r\n    definida per a la categoria. Un logger pot definir diferents\r\n    sortides o \"appenders\" a la vegada (consola, fitxer, correu\r\n    electrònic, base de dades,etc.)\r\n    \r\n4.  Layouts. Permeten especificar com es mostren els events. Per exemple\r\n    podem especificar que ens aparegui l'hora en la què s'ha produït\r\n    l'event, qui ho ha llençat, la línia en la què s'ha fet, etc.\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC10cmFjZXM="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1hdmlzb3MtaS1hbGVydGVz":{"date":1426853089000,"title":"Avisos i  alertes","description":"Serveisd'enviament de SMS i CORREU del CTTI a través del servei AVISALERT de la PICA.","sections":"Canigó. Documentació versió 3.x","weight":2,"path":"/canigo-documentacio-versions-3x-integracio/modul-avisos-i-alertes","content":"## Introducció\r\n\r\nL'objectiu d'aquest connector és el de proporcionar accés als serveis d'enviament de SMS i CORREU del CTTI a través del servei AVISALERT de la PICA.\r\n\r\n### Propòsit\r\n\r\nEl propòsit del connector és proporcionar una interfície funcional reduïda al connector de la Pica que simplifica l'utilització dels diferents serveis d'enviament de SMS i MAIL oferts per la generalitat.\r\n\r\n### Context i Escenaris d'ús\r\n\r\nEl connector PICA-AVISALERT es troba dins els connectors de serveis funcionals de la Generalitat.\r\n\r\n### A qui va dirigit\r\n\r\nAquest document va dirigit als següents perfils:\r\n\r\n* Programador. Per conèixer l'ús del connector.\r\n* Arquitecte. Per conèixer quins són els components i la configuració del connector.\r\n\r\n## Descripció Detallada\r\n\r\nAquest connector permet utilitzar les diferents modalitats del servei AVISALERT en les seves modalitats asíncrones i síncrones, a través de les modalitats de sevei següents:\r\n\r\nServeis Síncrons\r\n\r\n* AVISALERT_SMS\r\n* AVISALERT_CORREU-E\r\n\r\nServeis Asíncrons\r\n\r\n* AVISALERT_SMS\r\n\r\n### Arquitectura i Components\r\n\r\n#### Interfícies i Components Genèrics\r\n\r\nEs pot trobar el codi font referent a aquest component a la següent url:\r\n\r\nCodi Font:  https://sic.ctti.extranet.gencat.cat/nexus/content/groups/canigo-group-maven2/cat/gencat/ctti/canigo.integration.avisosalertes.pica/\r\n\r\n#### Requeriments\r\n\r\nEl connector AVISALERT és compatible amb les versions 1.5 o superior de Java. Per versions inferiors no es garantit el seu correcte funcionament.\r\n\r\nPer tal de que el connector AVISALERT funcioni correctament sobre l'aplicació que l'utilitzi, s'ha de tenir configurat el servei [connector genèric de la PICA](/canigo-documentacio-versions-3x-integracio/modul-pica/) 1.2.0.\r\n\r\n### Configuració\r\n\r\nPer configurar el mòdul d'integració PICA-AVISALERT és necessari configurar els següents arxius:\r\n\r\n1.- Importar el mòdul PICA-AVISALERT amb el plugin de Canigó 3 de l'eclipse o bé incorporar manualment les seves dependències en el pom.xml de l'aplicació.\r\n\r\nEn el pom.xml:\r\n\r\n```\r\n<canigo.integration.avisosalertes.pica.version>[1.2.0,1.3.0)</canigo.integration.avisosalertes.pica.version>\r\n...\r\n\r\n<!-- Dependencia del mòdul PICA-AVISALERT -->\r\n<dependency>\r\n    <groupId>cat.gencat.ctti</groupId>\r\n\t<artifactId>canigo.integration.avisosalertes.pica</artifactId>\r\n\t<version><version>${canigo.integration.avisosalertes.pica.version}</version></version>\r\n</dependency>\r\n\r\n```\r\n\r\n2.- Crear l'arxiu /config/props/avisalert.properties amb el següent contingut:\r\n\r\n```\r\n*.avisosalertes.pica.finalitat=[finalitat]\r\n*.avisosalertes.pica.urlPica=http://preproduccio.pica.intranet.gencat.cat/pica_cataleg/AppJava/services/\r\n*.avisosalertes.pica.nifEmisor=[nifEmisor]\r\n*.avisosalertes.pica.nomEmisor=[nomEmisor]\r\n*.avisosalertes.nomFuncionari=[nomFuncionari]\r\n*.avisosalertes.nifFuncionari=[nifFuncionari]\r\n*.avisosalertes.emailFuncionari=[emailFuncionari]\r\n```\r\n\r\nEls valors de finalitat, urlPica, nifEmisor i nomEmisor s'han de consultar a la OT PICA en requeridors.otpica.ctti@gencat.cat\r\n\r\nNOTA: El valor per defecte de urlPica es la de l'entorn de Pre-producció.\r\n\r\n3.- Configurar l'arxiu /config/props/pica.properties amb el següent contingut:\r\n\r\n```\r\n*.pica.modes.passwordType=PasswordText\r\n*.pica.requirer.signatureFile=classpath:config/cert/signature.properties\r\n*.pica.requirer.petitionerId=[petitionerId]\r\n*.pica.requirer.transmitionId=[transmitionId]\r\n*.pica.requirer.petitionerName=[petitionerName]\r\n*.pica.requirer.password=[password]\r\n*.pica.requirer.user=[password]\r\n*.pica.axisdefinition.location=classpath:axis2client/\r\n*.pica.trustStore.location=classpath:config/cert/certificats.jks\r\n*.pica.trustStore.type=JKS\r\n*.pica.trustStore.password=[trustStore.password]\r\n```\r\n\r\nEls valors entre [] s'han de consultar a la OT PICA en requeridors.otpica.ctti@gencat.cat\r\n\r\n4.- Configurar l'arxiu /spring/app-integration-avisalert.xml amb el següent contingut:\r\n\r\n```\r\n<!-- BEAN DE LA PICA -->\r\n<bean id=\"picaService\" class=\"cat.gencat.ctti.canigo.arch.integration.pica.PicaServiceWrapperImpl\" scope=\"prototype\">\r\n    <property name=\"axisDefinition\" value=\"${pica.axisdefinition.location}\"/>\r\n    <property name=\"trustStoreSSLKeystore\" value=\"${pica.trustStore.location}\" />\r\n    <property name=\"trustStoreSSLKeystoreType\" value=\"${pica.trustStore.type}\" />\r\n    <property name=\"trustStoreSSLKeystorePassword\" value=\"${pica.trustStore.password}\" />\r\n    <property name=\"requeridor\" ref=\"requeridor\"/>\r\n    <property name=\"modalitats\">\r\n        <map>\r\n\r\n        </map>\r\n    </property>\r\n</bean>\r\n```\r\n\r\nLes propietats trustStoreSSLKeystore, trustStoreSSLKesytoreType i trustStoreSSLKeystorePassword només són necessàries en cas d'accedir a la url de la PICA mitjançant HTTPS.\r\n\r\n### Utilització del Connector\r\n\r\n#### Exemple d'utilització d'un Servei Síncron\r\n\r\n1.- En el bean on es vulgui disposar dels serveis del connector declarar el servei.\r\n\r\n```java\r\n@Autowired\r\nprivate AvisosAlertesConnectorImpl avisalertService;\r\n```\r\n\r\n2.- Escollir una modalitat de servei síncrona i cridar-la amb els paràmetres que necessiti. En aquest cas es mostra un exemple amb la modalitat d'enviament de correu electrònic:\r\n\r\n```java\r\nString from = \"from@cscanigo.com\";\r\nString to = \"to@cscanigo.com\";\r\nString title = \"cscanigo\";\r\nString message = \"Això és una prova\";\r\nString arxiu = null;\r\nString resposta = avisalertService.avisAlertCorreuESincron(from, to, title, message, arxiu);\r\n```\r\n\r\nL'estat de finalització dependrà del codi retornat:\r\n\r\nPer consultar la totalitat de possibles codis de retorn i el detall exacte dels objectes retornats consultar el document de la PICA **Guia d'us del servei Avisos i Alertes v2.2.pdf** disponible via petició a requeridors.otpica.ctti@gencat.cat\r\n\r\n#### Exemple d'utilització d'un Servei Asíncron\r\n\r\n1.- La modalitat d'enviament de SMS, AVISALERT_SMS, suporta l'enviament síncron i asíncron, l'exemple que segueix utilitzarà la seva variant asíncrona. Per poder utilitzar aquesta modalitat de consum el connector de Canigó 3 preveu tres mètodes diferents:\r\n\r\n```java\r\npublic DataResponse avisAlertSMSsimpleASincron(String serviceNumber, String mobile, String message) throws AvisosAlertesException;\r\npublic EstatAsincron getEstatAvisAlertSMSASincron(CridaAsincronaResponseDocument response) throws AvisosAlertesException;\r\npublic String getDadesAvisAlertSMSASincron(IPICAServiceAsincron servei) throws AvisosAlertesException;\r\n```\r\n\r\n2.- El primer serveix per carregar les dades de la consulta al servei i fer la primera petició. Donat que és un servei asíncron retorna un objecte amb l'estat actual de la petició i el temps estimat de finalització d'aquesta.\r\n\r\nIgual que en les peticions síncrones, s'inicialitza el bean del servei del connector:\r\n\r\n```java\r\n@Autowired\r\nprivate AvisosAlertesConnectorImpl avisosAlertesConnector;\r\n```\r\n\r\nEs crida al servei amb les dades pertinents;\r\n\r\n```java\r\nString mobile = MOV_NUMBER;\r\nString serviceNumber = \"6666\";\r\nString message = \"Test\";\r\n\t\t\t\r\nDataResponse resposta = avisosAlertesConnector.avisAlertSMSsimpleASincron(serviceNumber, mobile, message);\r\n```\r\n\r\n3.- El segon serveix per anar comprovant l'estat de la consulta de forma periòdica. Igual que el primer mètode retorna un objecte amb l'estat actual de la petició i el temps estimat per la seva resolució.\r\n\r\n```java\r\nEstatAsincron estat = avisosAlertesConnector.getEstatAvisAlertSMSASincron(resposta.getResponse());\r\n```\r\n\r\n4.- Finalment el tercer mètode recupera el resultat de la petició una vegada confirmat que la petició ha finalitzat.\r\n\r\n```java\r\nString dades = avisosAlertesConnector.getDadesAvisAlertSMSASincron(resposta.getServei());\r\n```\r\n\r\nPer consultar la totalitat de possibles codis de retorn i el detall exacte dels objectes retornats consultar el document de la PICA **Guia d'us del servei Avisos i Alertes v2.2.pdf** disponible via petició a requeridors.otpica.ctti@gencat.cat\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1hdmlzb3MtaS1hbGVydGVz"},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1kbmk=":{"date":1426783321000,"title":"DNI","description":"Servei de verificació i consulta de DNI de la DGP.","sections":"Canigó. Documentació versió 3.x","weight":3,"path":"/canigo-documentacio-versions-3x-integracio/modul-dni","content":"## Introducció\r\n\r\nL'objectiu d'aquest connector, és el de proporcionar un punt d'accés utilitzant la plataforma PICA cap servei de verificació i consulta de DNI de la DGP.\r\n\r\n## Propòsit\r\n\r\nEl propòsit del connector és proporcionar una interfície funcional reduida al connector de la Pica que simplifica l'utilització del servei de consulta i verificació de DNI's ofert per la generalitat.\r\n\r\n## Context i Escenaris d'ús\r\n\r\nEl connector PICA-DNI es troba dins els connectors de serveis funcionals de la Generalitat.\r\n\r\n## A qui va dirigit\r\n\r\nAquest document va dirigit als següents perfils:\r\n\r\n* Programador. Per conèixer l'ús del connector.\r\n* Arquitecte. Per conèixer quins són els components i la configuració del connector.\r\n\r\n## Descripció Detallada\r\n\r\nAquest connector permet realitzar les següents funcionalitats referents a les següent operacions amb un DNI:\r\n\r\n**Funcionalitats de Consulta**\r\n\r\n* Consulta Bàsica: Funcionalitat que permet la consulta de les dades d'un DNI subministrant un conjunt mínim de dades.\r\n* Consulta Estesa: Funcionalitat que permet la consulta de les dades d'un DNI donant la possibilitat d'escollir d'entre un conjunt més ampli de dades d'entrada.\r\n\r\n**Funcionalitats de Verificació**\r\n\r\n* **Verificació Bàsica:** Funcionalitat que permet la verificació de les dades d'un DNI subministrant un conjunt mínim de dades.\r\n* **Verificació Estesa:** Funcionalitat que permet la verificació de les dades d'un DNI donant la possibilitat d'escollir d'entre un conjunt més ampli de dades d'entrada.\r\n\r\n## Arquitectura i Components\r\n\r\n### Interfícies i Components Genèrics\r\n\r\nEs pot trobar el codi font referent aquests components a les següents url's:\r\n\r\nCodi Font : https://sic.ctti.extranet.gencat.cat/nexus/content/groups/canigo-group-maven2/cat/gencat/ctti/canigo.integration.dni.pica/\r\n\r\n### Requeriments\r\n\r\nEl connector DNI és compatible amb les versions 1.5 o superior de Java. Per versions inferiors no es garantit el seu correcte funcionament.\r\n\r\nPer tal de que el connector DNI funcioni correctament sobre l'aplicació que l'utilitzi, s'ha de tenir configurat el servei [connector genèric de la PICA](/canigo-documentacio-versions-3x-integracio/modul-pica/) 1.2.0.\r\n\r\n## Configuració\r\n\r\nPer configurar el mòdul d'integració PICA-DNI és necessari configurar els següents arxius:\r\n\r\n1.- Importar el mòdul PICA-DNI amb el plugin de Canigó 3 de l'eclipse o bé incorporar manualment les seves dependències en el pom.xml de l'aplicació.\r\n\r\nEn el pom.xml;\r\n\r\n```\r\n<canigo.integration.dni.pica.version>[1.3.0,1.4.0)</canigo.integration.dni.pica.version>\r\n...\r\n\r\n<!-- Dependencia del mòdul PICA-DNI -->\r\n<dependency>\r\n    <groupId>cat.gencat.ctti</groupId>\r\n    <artifactId>canigo.integration.dni.pica</artifactId>\r\n    <version>${canigo.integration.dni.pica.version}</version>\r\n</dependency>\r\n```\r\n\r\n2.- Crear l'arxiu /config/props/dni.properties amb el següent contingut:\r\n\r\n```\r\n*.dni.finalitat=[finalitat]\r\n*.dni.urlPica=[urlPica]\r\n*.dni.nifEmisor=[nifEmisor]\r\n*.dni.nomEmisor=[nomEmisor]\r\n*.dni.nomFuncionari=[nomFuncionari]\r\n*.dni.nifFuncionari=[nifFuncionari]\r\n*.dni.emailFuncionari=[emailFuncionari]\r\n```\r\n\r\nEls valors de finalitat, urlPica, nifEmisor i nomEmisor s'han de consultar a la OT PICA en requeridors.otpica.ctti@gencat.cat\r\n\r\nNOTA: El valor per defecte de urlPica es la de l'entorn de Pre-producció.\r\n\r\n3.- Configurar l'arxiu /config/props/pica.properties amb el següent contingut:\r\n\r\n```\r\n*.pica.modes.passwordType=PasswordText\r\n*.pica.requirer.signatureFile=classpath:config/cert/signature.properties\r\n*.pica.requirer.petitionerId=[petitionerId]\r\n*.pica.requirer.transmitionId=[transmitionId]\r\n*.pica.requirer.petitionerName=[petitionerName]\r\n*.pica.requirer.password=[password]\r\n*.pica.requirer.user=[password]\r\n*.pica.axisdefinition.location=classpath:axis2client/\r\n*.pica.trustStore.location=classpath:config/cert/certificats.jks\r\n*.pica.trustStore.type=JKS\r\n*.pica.trustStore.password=[trustStore.password]\r\n```\r\n\r\nEls valors entre [] s'han de consultar a la OT PICA en requeridors.otpica.ctti@gencat.cat\r\n\r\n4.- Configurar l'arxiu /spring/app-integration-dni.xml amb el següent contingut:\r\n\r\n```\r\n<!-- BEAN DE LA PICA -->\r\n<bean id=\"picaService\" class=\"cat.gencat.ctti.canigo.arch.integration.pica.PicaServiceWrapperImpl\" scope=\"prototype\">\r\n    <property name=\"axisDefinition\" value=\"${pica.axisdefinition.location}\"/>\r\n    <property name=\"trustStoreSSLKeystore\" value=\"${pica.trustStore.location}\" />\r\n    <property name=\"trustStoreSSLKeystoreType\" value=\"${pica.trustStore.type}\" />\r\n    <property name=\"trustStoreSSLKeystorePassword\" value=\"${pica.trustStore.password}\" />\r\n    <property name=\"requeridor\" ref=\"requeridor\"/>\r\n    <property name=\"modalitats\">\r\n        <map>\r\n\r\n        </map>\r\n    </property>\r\n</bean>\r\n```\r\n\r\nLes propietats trustStoreSSLKeystore, trustStoreSSLKesytoreType i trustStoreSSLKeystorePassword només són necessàries en cas d'accedir a la url de la PICA mitjançant HTTPS.\r\n\r\n## Utilització del Connector\r\n\r\n### Exemple d'utilització Consulta de DNI\r\n\r\nRecuperar el bean del servei de DNI des de la classe on es vol utilitzar:\r\n\r\n```java\r\n@Autowired\r\nprivate DniConnectorImpl dniConnector;\r\n```\r\n\r\nFer la crida a la modalitat del servei desitjat, p.e.:\r\n\r\n```java\r\nDadesConsultaDni resposta = dniConnector.dniConsultaBasica(numero_document, tipus_document, cognom1, anyNaixement);\r\n```\r\n\r\non, **numero_document** correspon al valor del número del document utilitzat i **tipus_document** correspon al tipus de document que es vol subministrar (Constants.DNI, Constants.NIE, Constants.NIF).\r\nÉs obligatori informar el **cognom1**(primer Cognom) o bé l'**anyNaixement**\r\n\r\nEn cas que es vulgui sobreescriure les dades del funcionari especificats en el fitxer dni.properties, és possible fer-ho abans de fer la crida al servei:\r\n\r\n```java\r\nFuncionari funcionari = new Funcionari();\r\nfuncionari.setNombreFuncionario(\"Nom Cognoms Funcionari\");\r\nfuncionari.setNifFuncionario(\"NIF\");\r\nfuncionari.setEmailFuncionario(\"mail\");\r\n\r\ndniConnector.setFuncionari(funcionari);\r\n\r\nPer consultar l'estat de la resposta;\r\n\r\nEstatResultat estat = resposta.getEstat();\r\n```\r\n\r\n* En cas de que les dades no corresponguin amb un DNI, típicament es retornaran aquestes dades:\r\n\r\n```java\r\nAssert.assertEquals(\"TITULAR NO IDENTIFICADO\", estat.getDescripcio());\r\nAssert.assertEquals(\"0233\", estat.getCodiEstat());\r\n```\r\n\r\n* En cas de que les dades si corresponguin a un DNI, típicament es retornaran les següents dades:\r\n\r\n```java\r\nAssert.assertEquals(\"TRAMITADA\", estat.getDescripcio());\r\nAssert.assertEquals(\"0003\", estat.getCodiEstat());\r\n```\r\n\r\nLes dades associades a la consulta d'un DNI es poden recuperar amb:\r\n\r\n```java\r\nresposta.getTitular();\r\n```\r\n\r\nPer consultar la totalitat de possibles codis de retorn consultar el document de la PICA Guia d'us del servei de DNI v.1.9.pdf disponible via petició a requeridors.otpica.ctti@gencat.cat\r\n\r\n### Exemple d'utilització Verificació DNI\r\n\r\nRecuperar el bean del servei de DNI des de la classe on es vol utilitzar:\r\n\r\n```java\r\n@Autowired\r\nprivate DniConnectorImpl dniConnector;\r\n```\r\n\r\nFer la crida a la modalitat del servei desitjat, p.e.:\r\n\r\n```java\r\nEstatResultat resposta = dniConnector.dniVerificacioBasica(numero_document, tipus_document, nom, cognom1, cognom2, sexe);\r\n```\r\n\r\non, **numero_document** correspon al valor del número del document utilitzat;<br>\r\n**tipus_document** correspon al tipus de document que es vol subministrar (Constants.DNI, Constants.NIE, Constants.NIF);<br>\r\n**nom** nom del titular del DNI;<br>\r\n**cognom1** primer cognom del titular del DNI;<br>\r\n**cognom2** segon cognom del titular del DNI;<br>\r\n**sexe** sexe del titular del DNI (Constants.MASCULI o Constants.FEMENI)\r\n\r\n* En cas de que les dades no corresponguin amb un DNI, típicament es retornaran aquestes dades:\r\n\r\n```java\r\nAssert.assertEquals(\"TITULAR NO IDENTIFICADO\", resposta.getDescripcio());\r\nAssert.assertEquals(\"0233\", resposta.getCodiEstat());\r\n```\r\n\r\n* En cas de que les dades si corresponguin a un DNI, típicament es retornaran les següents dades:\r\n\r\n```java\r\nAssert.assertEquals(\"TRAMITADA\", estat.getDescripcio());\r\nAssert.assertEquals(\"0003\", estat.getCodiEstat());\r\n```\r\n\r\nPer consultar la totalitat de possibles codis de retorn consultar el document de la PICA **Guia d'us del servei de DNI v.1.9.pdf** disponible via petició a requeridors.otpica.ctti@gencat.cat\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1kbmk="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1lbm90dW0=":{"date":1426777297000,"title":"Enotum","description":"Connector de la Pica que simplifica l'utilització del servei de Notificacions Telemàtiques de la Generalitat.","sections":"Canigó. Documentació versió 3.x","weight":5,"path":"/canigo-documentacio-versions-3x-integracio/modul-enotum","content":"## Propòsit\r\n\r\nEl propòsit del connector és proporcionar una interfície funcional reduida al connector de la Pica que simplifica l'utilització del servei de Notificacions Telemàtiques de la Generalitat.\r\n\r\n## Descripció Detallada\r\n\r\nAquest connector permet realitzar les següents funcionalitats referents a les notificacions telemàtiques:\r\n\r\nFuncionalitats per a l'empleat públic:\r\n\r\n* Enviar tramesa: Creació d'una nova tramesa de notificacions telemàtiques al sistema E-Notum per part del sistema requeridor de notificacions telemàtiques.\r\n* Consultar estat tramesa: Consulta de l'estat d'una tramesa de notificacions telemàtiques per part del sistema requeridor de notificacions telemàtiques.\r\n* Consultar notificacions destinatari: Consulta de les notificacions telemàtiques adreçades al destinatari.\r\n* Consultar detall notificació: Visualització d'una notificació telemàtica per part d'un empleat públic.\r\n* Consultar evidències notificació: Consulta de les evidències d'una notificació telemàtica gestionades per eNotum.\r\n\r\nFuncionalitats per al ciutadà:\r\n\r\n* Consultar detall notificació: Visualització d'una notificació telemàtica per part del destinatari.\r\n* Consultar notificacions destinatari: Consulta de les notificacions telemàtiques adreçades al destinatari.\r\n* Modificar estat notificació: Permet canviar l'estat d'una notificació telemàtica, per qüestions de seguretat un usuari només pugui canviar d'estat les seves pròpies notificacions.\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer tal d'instal-lar el mòdul de notificacions electròniques es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.integration.notificacions.electroniques.version>[1.4.0,1.5.0)</canigo.integration.notificacions.electroniques.version>\r\n\r\n<dependency>\r\n          <groupId>cat.gencat.ctti</groupId>\r\n          <artifactId>canigo.integration.notificacions.electroniques</artifactId>\r\n          <version>${canigo.integration.notificacions.electroniques.version}</version>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració es realitza automàticament a partir de la eina de suport al desenvolupament.\r\n\r\nSon necessaris els següents arxius de configuració:\r\n\r\n* pica.properties\r\n* pica.signature.properties\r\n* client.axis2.xml\r\n* modules.list\r\n* rampart-1.3.mar\r\n* certificats.jks\r\n* notificacions-electroniques.properties\r\n* app-enotum-config.xml\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/axis2client/conf/client.axis2.xml\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/axis2client/conf/rampart-1.3.mar\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/axis2client/conf/modules.list\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/config/cert/certificats.jks\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/config/cert/pica.signature.properties\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/spring/app-enotum-config.xml\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/config/props/notificacions-electroniques.properties\r\n\r\nPropietat                                         | Requerit | Descripció\r\n------------------------------------------------- | -------- | ----------\r\n*.notificacions.electroniques.picaServiceBeanName | No       | Nom del bean de Spring per a PICA. Per defecte: picaService\r\n*.notificacions.electroniques.urlPica             | Sí       | URL del servei de la PICA\r\n*.notificacions.electroniques.nomEmissor\t\t  | Sí\t\t | Nom de l'emissor\r\n*.notificacions.electroniques.nifEmissor\t\t  | Sí\t     | Nif de l'emissor\r\n\r\nEls valors de urlPica, nifEmisor i nomEmisor s'han de consultar a la OT PICA en requeridors.otpica.ctti@gencat.cat\r\n\r\nAquest mòdul és dependent del [mòdul de la PICA] (/canigo-documentacio-versions-3x-integracio/modul-pica/) amb lo qual també s'ha de configurar aquest.\r\n\r\n## Utilització del Mòdul\r\n\r\n### PicaService\r\n\r\nEl mòdul ENOTUM requereix de la creació del Bean del servei de la pica, per defecte Enotum cerca un bean anomenat picaService. Si es dessitja canviar aquest nom es pot fer afegint al fitxer notificacions-electroniques.propierties la següent propietat:\r\n\r\n\tnotificacions.electroniques.picaServiceBeanName=[nom del bean]\r\n\t\r\nUn exemple del bean que s'ha de crear:\r\n\r\n\t<!-- BEAN DE LA PICA -->\r\n\t<bean id=\"picaService\" parent=\"abstractPicaService\">\r\n        <property name=\"modalitats\">\r\n            <map>\r\n            </map>\r\n        </property>\r\n    </bean>\r\n\r\n### REST\r\n\r\nPer a utilitzar aquest mòdul, cal crear un Controller i un Service:\r\n\r\n**EnotumService.java**\r\n\r\nClasse Java on es realitzarà la lògica de la operació a realitzar i es connecta amb el mòdul de Notificacions electròniques.\r\n\r\n```java\r\nimport org.slf4j.Logger;\r\nimport org.slf4j.LoggerFactory;\r\nimport org.springframework.beans.factory.annotation.Autowired;\r\nimport org.springframework.context.annotation.Lazy;\r\nimport org.springframework.stereotype.Service;\r\n\r\nimport cat.gencat.ctti.canigo.arch.integration.notificacionselectroniques.NotificacionsElectroniquesConnector;\r\nimport cat.gencat.pica.api.peticio.beans.Funcionari;\r\nimport net.gencat.scsp.esquemes.productes.nt.PeticioNtConsultarDetallNotificacioEPDocument;\r\nimport net.gencat.scsp.esquemes.productes.nt.PeticioNtConsultarDetallNotificacioEPDocument.PeticioNtConsultarDetallNotificacioEP;\r\nimport net.gencat.scsp.esquemes.productes.nt.RespostaNtConsultarDetallNotificacioEPDocument;\r\n\r\n@Service(\"enotumService\")\r\n@Lazy\r\npublic class EnotumService {\r\n\r\n\tprivate static final Logger log = LoggerFactory.getLogger(EnotumService.class);\r\n\r\n\t@Autowired\r\n    private NotificacionsElectroniquesConnector enotum;\r\n    \r\n\r\n\r\n\tpublic String testEnotum(){\r\n\t\t\r\n\t\tString message;\r\n\r\n        try{\r\n\r\n        \tString idTramesaNT = \"101230\";\r\n        \t\r\n        \tPeticioNtConsultarDetallNotificacioEPDocument dades = PeticioNtConsultarDetallNotificacioEPDocument.Factory.newInstance();\r\n    \t\tPeticioNtConsultarDetallNotificacioEP peticioNotificacio = PeticioNtConsultarDetallNotificacioEP.Factory.newInstance();\r\n\r\n    \t\t// Petició\r\n    \t\tpeticioNotificacio.setIdNotificacioNT(idTramesaNT);\r\n\r\n    \t\tdades.setPeticioNtConsultarDetallNotificacioEP(peticioNotificacio);\r\n\r\n    \t\tRespostaNtConsultarDetallNotificacioEPDocument resposta = enotum\r\n    \t\t\t\t.getServeisEmpleatPublic(getFuncionari())\r\n    \t\t\t\t.consultarDetallNotificacio(dades);\r\n        \t\r\n            if(resposta.getRespostaNtConsultarDetallNotificacioEP().getErrors() != null){\r\n            \tmessage = resposta.getRespostaNtConsultarDetallNotificacioEP().getErrors().getPICAErrorArray(0).getDescripcio();\r\n            }else{\r\n            \tmessage = resposta.getRespostaNtConsultarDetallNotificacioEP().getDetallNotificacio().getNotificacio().getEstat();\r\n            }\r\n\r\n        }catch(Exception e){\r\n        \tmessage = \"Error al test: \" + e.getMessage();\r\n        \tlog.error(e.getMessage(), e);\r\n        }\r\n        \r\n        return message;\r\n\r\n    }\r\n\t\r\n\t /**\r\n     * Get funcionari\r\n     * @return\r\n     */\r\n    private Funcionari getFuncionari() {\r\n        Funcionari funcionari = new Funcionari();\r\n        funcionari.setNombreFuncionario(\"Nom Funcionari\");\r\n        funcionari.setNifFuncionario(\"55555555A\");\r\n        funcionari.setEmailFuncionario(\"prova@gencat.com\");\r\n        return funcionari;\r\n    }\r\n}\r\n```\r\n\r\n**EnotumServiceController.java**  \r\n\r\nController que publica les operacions disponibles per a qui hagi de consumir-les\r\n\r\n```java\r\nimport org.springframework.beans.factory.annotation.Autowired;\r\nimport org.springframework.http.MediaType;\r\nimport org.springframework.web.bind.annotation.PostMapping;\r\nimport org.springframework.web.bind.annotation.RequestMapping;\r\nimport org.springframework.web.bind.annotation.RestController;\r\n\r\nimport cat.gencat.plantilla32.service.EnotumService;\r\n\r\n@RestController\r\n@RequestMapping(\"/enotum\")\r\npublic class EnotumServiceController {\r\n\r\n\t@Autowired\r\n\tEnotumService enotumService;\r\n\r\n\r\n\t@PostMapping(produces = { MediaType.APPLICATION_JSON_VALUE })\r\n\tpublic String testEnotum() throws Exception {\r\n\t\treturn enotumService.testEnotum();\r\n\t}\r\n}\r\n```\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1lbm90dW0="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1lbm90dW0td3M=":{"date":1426778360000,"title":"Enotum_WS","description":"Notificacions electròniques Web Service.","sections":"Canigó. Documentació versió 3.x","weight":6,"path":"/canigo-documentacio-versions-3x-integracio/modul-enotum-ws","content":"## Propòsit\r\n\r\nEl propòsit d'aquesta documentació és donar a conèixer el mòdul de WebServices de Canigó3 per Enotum, la seva configuració i el seu ús per part de les aplicacions.\r\n\r\n## Descripció Detallada\r\n\r\nEl Servei de Enotum existeixen dues modalitats de consum especials:\r\n\r\n* NT_ENTREGAR_CANVI_ESTAT_NOTIFICACIO: Permet al sistema que va sol?licitar la creació de la notificació telemàtica ser informat de les transicions automàtiques d'estat. E-Notum gestiona el cicle de vida dels estats associats a les notificacions telemàtiques. És responsable de realitzar certs canvis d'estat sobre la base de timeouts. Quan es produeixen aquests canvis d'estat, és necessari notificar-los al sistema que va sol?licitar la creació de la notificació.\r\n* NT_ERROR_ENVIAMENT_NOTIFICACIO: Aquesta modalitat de consum permet el lliurament des de eNotum als BO dels errors que s'ha produït en el tractament de les trameses de notificacions enviades pels backoffice durant el processament de les notificacions.\r\n\r\nAixí doncs, PICA reb les notificacions de l'emissor amb els diferents errors que s'han produït i els envia al BO corresponent.\r\n\r\nAmbdues necessiten la publicació d'un WebService per part del consumidor del Servei (BO).\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer instal.lar el WebService de notificacions electròniques s'han d'afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.integration.notificacions.electroniques.version.ws>[2.2.0,2.3.0)</canigo.integration.notificacions.electroniques.version.ws>\r\n\r\n<dependency>\r\n          <groupId>cat.gencat.ctti</groupId>\r\n          <artifactId>canigo.integration.notificacions.electroniques.ws</artifactId>\r\n          <version>${canigo.integration.notificacions.electroniques.version.ws}</version>\r\n</dependency>\r\n```\r\n\r\ni en l'apartat de repositoris\r\n\r\n```\r\n<repository>\r\n      <id>org.springframework.security.taglibs.facelets</id>\r\n      <url>http://spring-security-facelets-taglib.googlecode.com/svn/repo/</url>\r\n</repository>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració del WS es porta a terme a través de l'arxiu \"app-custom-enotumWS.xml\". Es recomana que es posi en src/main/resources/spring/app-custom-enotumWS.xml.\r\n\r\nEl contingut d'aquest arxiu és el següent:\r\n\r\n```\r\n<bean id=\"notificacionsElectroniquesAppService\" class=\"[Classe on es troba la implementació dels mètodes exposats al WS]\"/>\r\n\r\n    <bean id=\"notificacionsElectroniquesServiceEndpoint\" class=\"cat.gencat.ctti.canigo.arch.integration.notificacionselectroniques.endpoint.NotificacionsElectroniquesEndpoint\">\r\n        <property name=\"NotificacionsElectroniquesService\" ref=\"notificacionsElectroniquesAppService\"/>\r\n    </bean>\r\n\r\n\r\n    <bean id=\"eNOTUMService\" class=\"org.springframework.ws.wsdl.wsdl11.DefaultWsdl11Definition\"\r\n          p:portTypeName=\"eNOTUMService\" //<--Nom del Servei Web (configurable)\r\n          p:locationUri=\"/ws/services/ENotumService/\" //<--Path del Servei Web (configurable)\r\n          p:targetNamespace=\"http://gencat.net/scsp/esquemes/productes/nt/services\">\r\n          <property name=\"SchemaCollection\" ref=\"schemaCollection\"/>\r\n          <property name=\"createSoap11Binding\" value=\"false\"/>\r\n          <property name=\"createSoap12Binding\" value=\"true\"/>\r\n    </bean>\r\n\r\n     <bean id=\"schemaCollection\" class=\"org.springframework.xml.xsd.commons.CommonsXsdSchemaCollection\">\r\n        <property name=\"xsds\">\r\n            <list>\r\n                <value>classpath:cat/gencat/ctti/canigo/arch/support/notificacions/electroniques/config/xsd/NTServices.xsd</value>\r\n               </list>\r\n        </property>\r\n        <property name=\"inline\" value=\"true\"/>\r\n    </bean>\r\n\r\n    <bean id=\"messageFactory\" class=\"org.springframework.ws.soap.saaj.SaajSoapMessageFactory\">\r\n          <property name=\"soapVersion\" value=\"SOAP_12\" />\r\n      </bean>\r\n\r\n     <bean id=\"marshaller\" class=\"org.springframework.oxm.jaxb.Jaxb2Marshaller\"\r\n          p:contextPath=\"net.gencat.scsp.esquemes.productes.nt:net.gencat.scsp.esquemes.productes.nt.notificacions:net.gencat.scsp.esquemes.productes.nt.services\"/>\r\n\r\n    <bean id=\"marshallingPayloadMethodProcessor\" class=\"org.springframework.ws.server.endpoint.adapter.method.MarshallingPayloadMethodProcessor\">\r\n        <constructor-arg ref=\"marshaller\"/>\r\n    </bean>\r\n\r\n    <bean id=\"defaultMethodEndpointAdapter\" class=\"org.springframework.ws.server.endpoint.adapter.DefaultMethodEndpointAdapter\">\r\n        <property name=\"methodArgumentResolvers\">\r\n            <list>\r\n                <ref bean=\"marshallingPayloadMethodProcessor\"/>\r\n            </list>\r\n        </property>\r\n        <property name=\"methodReturnValueHandlers\">\r\n            <list>\r\n                <ref bean=\"marshallingPayloadMethodProcessor\"/>\r\n            </list>\r\n        </property>\r\n    </bean>\r\n```\r\n\r\n## Utilització del Web Service\r\n\r\nPer poder utilitzar el WebService de Enotum en una aplicació Canigó3 s'han de seguir els següents passos;\r\n\r\n1.- Modificar el web.xml de l'aplicació per afegir el servlet següent:\r\n\r\n```\r\n<!-- Web Service Enotum -->\r\n    <servlet>\r\n        <servlet-name>NT_WS</servlet-name>\r\n        <servlet-class>org.springframework.ws.transport.http.MessageDispatcherServlet</servlet-class>\r\n        <init-param>\r\n            <param-name>contextConfigLocation</param-name>\r\n            <param-value>classpath:spring/app-custom-enotumWS.xml</param-value>\r\n        </init-param>\r\n        <init-param>\r\n            <param-name>transformWsdlLocations</param-name>\r\n            <param-value>true</param-value>\r\n        </init-param>\r\n    </servlet>\r\n\r\n    <servlet-mapping>\r\n        <servlet-name>NT_WS</servlet-name>\r\n        <url-pattern>/ws/*</url-pattern>\r\n    </servlet-mapping>\r\n```\r\n\r\nPosar immediatament a sobre de:\r\n\r\n```\r\n<!--\r\nSession timeout: 30 minutes\r\n-->\r\n <session-config>\r\n  <session-timeout>30</session-timeout>\r\n </session-config>\r\n```\r\n\r\n2.- Configurar els beans **notificacionsElectroniquesAppService** i **eNOTUMService** de l'arxiu src/main/resources/spring/app-custom-enotumWS.xml de la següent forma:\r\n\r\n* notificacionsElectroniquesAppService: Nom de la classe que implementaran les accions a portar a terme a partir de la resposta rebuda pel servei. Un exemple:\r\n\r\n```java\r\nimport net.gencat.scsp.esquemes.productes.nt.notificacions.NotificacioCanviEstat;\r\nimport net.gencat.scsp.esquemes.productes.nt.notificacions.NotificacioCanviEstat.Notificacio;\r\nimport net.gencat.scsp.esquemes.productes.nt.notificacions.NotificacioError;\r\nimport org.apache.commons.logging.Log;\r\nimport org.apache.commons.logging.LogFactory;\r\nimport cat.gencat.ctti.canigo.arch.integration.notificacionselectroniques.NotificacionsElectroniquesService;\r\nimport cat.gencat.ctti.canigo.arch.integration.notificacionselectroniques.exepcions.NotificacionsElectroniquesModuleExcepcion;\r\n\r\n\r\npublic class NotificacionsElectroniquesServiceBasicImpl implements NotificacionsElectroniquesService {\r\n\r\n    private static final Log LOGGER = LogFactory.getLog(NotificacionsElectroniquesServiceBasicImpl.class);\r\n    public void entregarCanviEstatNotificacio(NotificacioCanviEstat notificacioCanviEstat) throws NotificacionsElectroniquesModuleExcepcion {\r\n        if (LOGGER.isDebugEnabled()){\r\n            LOGGER.debug(\"Recepció per part del sistema requeridor de notificacions telemàtiques dels canvis d'estat automàtics de la NT.\");\r\n        }\r\n\r\n        if (notificacioCanviEstat != null && notificacioCanviEstat.getNotificacio() != null) {\r\n            if (LOGGER.isDebugEnabled()){\r\n                for (Notificacio notificacio : notificacioCanviEstat.getNotificacio()) {\r\n                    LOGGER.debug(\"Notificació: \" + notificacio.getIdNotificacio() + \". Estat :\" + notificacio.getDescEstat() + \"(\" + notificacio.getCodiEstat()+ \")\");\r\n                }\r\n            }\r\n        } else {\r\n            LOGGER.error(\"Sense notificacions\");\r\n            throw new NotificacionsElectroniquesModuleExcepcion(\"Sense notificacions\");\r\n        }\r\n    }\r\n\r\n    public void errorEnviamentNotificacio(NotificacioError notificacioError) throws NotificacionsElectroniquesModuleExcepcion {\r\n        if (LOGGER.isDebugEnabled()){\r\n            LOGGER.debug(\"Recepció per part del sistema requeridor de notificacions telemàtiques dels errors durant la creació de la NT.\");\r\n        }\r\n\r\n        if (notificacioError != null) {\r\n            if (LOGGER.isDebugEnabled()){\r\n                LOGGER.debug(\"Error en la recepció de la notificació: \" + notificacioError.getIdNotificacio() + \". Codi error: \" + notificacioError.getCodiError());\r\n            }\r\n        } else {\r\n            LOGGER.error(\"Sense error a la notificació\");\r\n            throw new NotificacionsElectroniquesModuleExcepcion(\"Sense error a la notificació\");\r\n        }\r\n    }\r\n}\r\n```\r\n* eNOTUMService: Nom del Bean on es configura el nom del WebService i la ruta d'accés a ell. Un exemple:\r\n\r\n```\r\n<bean id=\"eNOTUMService\" class=\"org.springframework.ws.wsdl.wsdl11.DefaultWsdl11Definition\"\r\n         p:portTypeName=\"eNOTUMService\" //<--Nom del Servei Web (configurable)\r\n         p:locationUri=\"/ws/services/ENotumService/\" //<--Path del Servei Web (configurable)\r\n         p:targetNamespace=\"http://gencat.net/scsp/esquemes/productes/nt/services\">\r\n         <property name=\"SchemaCollection\" ref=\"schemaCollection\"/>\r\n         <property name=\"createSoap11Binding\" value=\"false\"/>\r\n         <property name=\"createSoap12Binding\" value=\"true\"/>\r\n</bean>\r\n```\r\n\r\nEn el cas de l'exemple, el WS es podrà accedir en http://(Host)/(NomApp)/ws/services/ENotumService/eNOTUMService.wsdl\r\n\r\n**IMPORTANT:** Tindre en compte que la url del Servei Web ha de ser coneguda prèviament per Enotum. Normalment s'informa en el document d'alta que la PICA subministra per consumir els serveis d'ENOTUM.\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1lbm90dW0td3M="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1pY2M=":{"date":1426850996000,"title":"ICC","description":"Serveis de normalització d'adreces de l'Institut Cartogràfic de Catalunya.","sections":"Canigó. Documentació versió 3.x","weight":8,"path":"/canigo-documentacio-versions-3x-integracio/modul-icc","content":"## Introducció\r\n\r\nL'objectiu d'aquest connector, és el de proporcionar un punt d'accés als serveis de normalització d'adreces del ICC - Institut Cartogràfic de Catalunya.\r\n\r\n### Propòsit\r\n\r\nEl propòsit del connector és proporcionar una interfície funcional al connector de l'ICC del servei de normalització d'adreces. El servei de geocodificació de l'Institut Cartogràfic de Catalunya permet obtenir una localització geogràfica (coordenades) a partir de la descripció d'un municipi, carrer, adreça , cruïlla (textos), topònim o punt quilomètric d'una carretera.\r\n\r\n### Context i Escenaris d'ús\r\n\r\nEl connector icc es troba dins els connectors de serveis funcionals de la Generalitat.\r\n\r\n### A qui va dirigit\r\n\r\nAquest document va dirigit als següents perfils:\r\n\r\n* Programador. Per conèixer l'ús del connector.\r\n* Arquitecte. Per conèixer quins són els components i la configuració del connector.\r\n\r\n### Documents i Fonts de Referència\r\n\r\n| Referència\r\n| ---------------\r\n| [Guia d'ús de l'API del Connector ICC](/related/canigo/documentacio/modul-icc/Geocodificador_Manual_Integrador_v1.12.pdf \"Guia d'us de l'API del Connector ICC\").\r\n| [Institut Cartogràfic de Catalunya - ICC](http://www.icc.cat/).\r\n\r\n## Descripció Detallada\r\n\r\nAquest connector permet realitzar les següents funcionalitats referents a les següents operacions:\r\n\r\nFuncionalitats\r\n\r\n* **Localitza adreça:** Funcionalitat que permet obtenir una localització geogràfica (coordenades) a partir de la adreça. ex: C.Balmes,5 (Barcelona).\r\n* **Localitza cruilla:** Funcionalitat que permet obtenir una localització geogràfica a partir d'una cruïlla. ex: Av. Diagonal amb Av.Meridiana (Barcelona)\r\n* **Localitza toponim:** Funcionalitat que permet obtenir una localització geogràfica a partir d'un topònim. ex: platja de la barceloneta.\r\n* **Localitza pk:** Funcionalitat que permet obtenir una localització geogràfica a partir del punt quilomètric d'una carretera. ex: carretera B-100 KM 3.\r\n* **Obtenir informació d'un punt:** Funcionalitat que permet obtenir una informació d'un punt. ex: x-> 430477.74 y ->4582122.725.\r\n\r\n### Arquitectura i Components\r\n\r\n#### Interfícies i Components Genèrics\r\n\r\nEs pot trobar el codi font referent a aquest component a la següent url:\r\n\r\nCodi Font:  https://sic.ctti.extranet.gencat.cat/nexus/content/groups/canigo-group-maven2/cat/gencat/ctti/canigo.integration.icc/\r\n\r\n#### Requeriments\r\n\r\nEl connector ICC és compatible amb les versions 1.5 o superior de Java. Per versions inferiors no es garantit el seu correcte funcionament.\r\n\r\n### Instal.lació i Configuració\r\n\r\n#### Instal.lació\r\n\r\nPer tal d'instal-lar el connector ICC es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.integration.icc.version>[1.2.0,1.3.0)</canigo.integration.icc.version>\r\n<dependency>\r\n    <groupId>cat.gencat.ctti</groupId>\r\n    <artifactId>canigo.integration.icc</artifactId>\r\n    <version>${canigo.integration.icc.version}</version>\r\n</dependency>\r\n```\r\n\r\n#### Configuració\r\n\r\nLa configuració es realitza automàticament a partir de la eina de suport al desenvolupament.\r\n\r\nL'eina de desenvolupament genera automàticament el fitxer de propietats necessari per a la configuració del servei.\r\n\r\nUbicació proposada: <PROJECT_ROOT>/src/main/resources/config/props/icc.properties\r\n\r\nPropietat                     | Requerit | Descripció\r\n----------------------------- | -------- | ----------\r\n*.iccService.webServiceServer | Sí       | Endpoint del servei ICC.\r\n*.iccService.contrasenya      | Sí       | contrasenya d'access al servei.\r\n*.iccService.usuari           | Sí       | usuari d'acces al servei.\r\n\r\n\r\nCada aplicació que vulgui utilitzar les funcionalitats del ICC, haurà de seguir el següent procediment:\r\n\r\n1. Emplenar el Document d'Alta que es pot trobar aquí. No s'ha d'emplenar l'apartat d'organisme sol?licitant i persona de contacte. Aquest organisme i persona sempre ha de ser de l'administració. Si una empresa privada desenvolupa l'aplicació, la petició ha de ser feta per algú de l'administració.\r\n2. Emplenar el document d'enquesta que es pot descàrrega d'aquí.\r\n3. Enviar aquests dos documents a la direcció de correu armand.guell@icc.cat demanant l'accés al servei ICC.\r\n\r\nL'usuari i password seran subministrats en aproximadament una setmana després de la petició.\r\n\r\nEls arxius de configuració que contenen els beans del mòdul i que seran carregats per Spring, són automàticament registrats pel core de Canigó, per el que el desenvolupador no ha de definir cap arxiu XML per aixecar el servei.\r\n\r\n### Utilització del servei\r\n\r\nPer accedir al servei ICC, el desenvolupador pot realitzar una crida de forma externa mitjançant el patró 'Dependency Injection'.\r\n\r\nPodem diferenciar dues formes d'injectar-ho:\r\n\r\n* Per XML:\r\n\r\n```\r\n<bean id=\"iccWebServiceClient\" class=\"cat.gencat.ctti.canigo.arch.integration.icc.IccWebServiceClientImpl\">\r\n\t\t<property name=\"webServiceTemplate\" ref=\"webServiceTemplate\"/>\r\n\t\t<property name=\"defaultUri\" value=\"http://www.icc.cat/geocodificador/ws/wss_1.0\" />\t\t\r\n\t</bean>\r\n\r\n\t<bean id=\"webServiceTemplate\" class=\"org.springframework.ws.client.core.WebServiceTemplate\">\r\n\t\t<constructor-arg ref=\"messageFactory\" />\r\n\t\t<property name=\"interceptors\">\r\n\t\t\t<bean class=\"cat.gencat.ctti.canigo.arch.integration.icc.IccSecurity\">\r\n\t\t\t\t<constructor-arg value=\"USUARI\" />\r\n\t\t\t\t<constructor-arg value=\"CONTRASENYA\" />\r\n\t\t\t</bean>\r\n\t\t</property>\r\n\t    <property name=\"messageSender\">\r\n\t        <bean class=\"org.springframework.ws.transport.http.CommonsHttpMessageSender\" />\r\n\t    </property>\r\n\t\t<property name=\"marshaller\" ref=\"marshaller\" />\r\n\t\t<property name=\"unmarshaller\" ref=\"marshaller\" />\r\n\t\t<property name=\"defaultUri\" value=\"http://www.icc.cat/geocodificador/ws/wss_1.0\" />\r\n\t</bean>\r\n\r\n\t<bean id=\"messageFactory\" class=\"org.springframework.ws.soap.saaj.SaajSoapMessageFactory\">\r\n\t\t<property name=\"soapVersion\">\r\n\t\t\t<util:constant static-field=\"org.springframework.ws.soap.SoapVersion.SOAP_12\" />\r\n\t\t</property>\r\n\t</bean>\r\n\t\r\n\t<!-- serializador con JAXB -->\r\n\t<bean id=\"marshaller\" class=\"org.springframework.oxm.jaxb.Jaxb2Marshaller\">\r\n\t\t<property name=\"classesToBeBound\">\r\n\t\t\t<list>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.Adreca</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.ArrayOfPuntGeografic</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.Cruilla</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.IdNom</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.Incidencia</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.InfoAdministrativa</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.Localitzacio</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.LocalitzacioCruilla</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.Localitzacions</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.LocalitzacionsCruilla</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.ObtenirInfoPuntInput</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.PK2</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.Pks</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.Punt</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.PuntGeografic</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.Toponim</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.Toponims</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.Via</value>\r\n\t\t\t</list>\r\n\t\t</property>\r\n\t</bean>\r\n```\r\n\r\n* Per anotacions:\r\n\r\n```\r\n@Autowired\r\n@Qualifier(\"iccWebServiceClient\")\r\nIccWebServiceClient client;\r\n```\r\n\r\n#### Excepcions del servei ICC\r\n\r\nEl servei ICC pot generar excepcions IccModuleException. Aquest tipus d'excepcions les genera el servei ICC en els casos de:\r\n\r\nLes excepccions es poden donar degut a:\r\n\r\n* TimeOut a la petició del servei\r\n* Error en el format de les dades d'entrada i/o sortida\r\n* Error en el binding automàtic amb les dades.\r\n\r\nEn el cas de produir-se un error el servei ICC registra en el fitxer de logs de l'aplicació l'error produit, i llença una excepció IccModuleException a la aplicació amb l'informcació de l'excepció.\r\n\r\n#### Exemple d'utilització del servei ICC\r\n\r\n##### Localitza Adreça\r\n\r\n```java\r\nimport cat.gencat.ctti.canigo.arch.integration.icc.exceptions.IccModuleException;\r\nimport cat.icc.ws.geocodificador.*;\r\n\r\npublic class IccServiceReleaseTest {\r\n\r\n\t@Autowired\r\n\t@Qualifier(\"iccWebServiceClient\")\r\n\tIccWebServiceClient client;\r\n\r\n\tpublic void testLocalitzaAdreca() {\r\n\t\ttry {\r\n\t\t\tAdreca adreca = getAdreca();\r\n\t\t\tLocalitzacions response;\r\n\t\t\tresponse = client.localitzaAdreca(adreca);\r\n\t\t\tAssert.assertTrue(response.getItem().size() > 0);\r\n\t\t} catch (IccModuleException e) {\r\n\t\t\tAssert.assertTrue(false);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate Via getVia() {\r\n\t\tVia via = new Via();\r\n\t\tvia.setNom(\"Mas Massonet\");\r\n\t\treturn via;\r\n\r\n\t}\r\n\r\n\tprivate Adreca getAdreca() {\r\n\t\tAdreca adreca = new Adreca();\r\n\t\tadreca.setPoblacio(\"Blanes\");\r\n\t\tadreca.setVia(getVia());\r\n\t\tadreca.setPortal(18);\r\n\t\tadreca.setCodiPostal(\"no\");\r\n\t\tadreca.setLlogaret(new IdNom());\r\n\t\treturn adreca;\r\n\t}\r\n}\r\n```\r\n\r\n##### Localitza Cruïlla\r\n\r\n```java\r\nimport cat.gencat.ctti.canigo.arch.integration.icc.exceptions.IccModuleException;\r\nimport cat.icc.ws.geocodificador.*;\r\n\r\npublic class IccServiceReleaseTest {\r\n\r\n\t@Autowired\r\n\t@Qualifier(\"iccWebServiceClient\")\r\n\tIccWebServiceClient client;\r\n\r\n\tpublic void testLocalitzaCruilla() {\r\n\t\ttry {\r\n\t\t\tCruilla cruilla = getCruilla();\r\n\t\t\tLocalitzacionsCruilla response = client.localitzaCruilla(cruilla);\r\n\t\t\tAssert.assertTrue(response.getItem().size() > 0);\r\n\t\t} catch (IccModuleException e) {\r\n\t\t\tAssert.assertTrue(false);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate Cruilla getCruilla() {\r\n\t\tVia via1 = new Via();\r\n\t\tvia1.setTipus(\"c.\");\r\n\t\tvia1.setNom(\"Balmes\");\r\n\t\tVia via2 = new Via();\r\n\t\tvia2.setNom(\"*\");\r\n\t\tCruilla cruilla = new Cruilla();\r\n\t\tcruilla.setPoblacio(\"Barcelona\");\r\n\t\tcruilla.getVies().add(via1);\r\n\t\tcruilla.getVies().add(via2);\r\n\t\tcruilla.setComarca(new IdNom());\r\n\t\treturn cruilla;\r\n\t}\r\n}\r\n```\r\n\r\n##### Localitza Punt Quilomètric\r\n\r\n```java\r\nimport cat.gencat.ctti.canigo.arch.integration.icc.exceptions.IccModuleException;\r\nimport cat.icc.ws.geocodificador.*;\r\n\r\npublic class IccServiceReleaseTest {\r\n\r\n\t@Autowired\r\n\t@Qualifier(\"iccWebServiceClient\")\r\n\tIccWebServiceClient client;\r\n\r\n\tpublic void testLocalitzaPK() {\r\n\t\ttry {\r\n\t\t\tPK2 pk = getPk();\r\n\t\t\tPks response = client.localitzaPK(pk);\r\n\t\t\tAssert.assertTrue(response.getItem().size() > 0);\r\n\t\t} catch (IccModuleException e) {\r\n\t\t\tAssert.assertTrue(false);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate PK2 getPk() {\r\n\t\tPK2 pk = new PK2();\r\n\t\tpk.setNomCarretera(\"AP-7\");\r\n\t\tpk.setKM(\"56\");\r\n\t\tpk.setCoordenadesGeografiques(false);\r\n\t\treturn pk;\r\n\t}\r\n}\r\n```\r\n\r\n##### Localitza Toponim\r\n\r\n```java\r\nimport cat.gencat.ctti.canigo.arch.integration.icc.exceptions.IccModuleException;\r\nimport cat.icc.ws.geocodificador.*;\r\n\r\npublic class IccServiceReleaseTest {\r\n\r\n\t@Autowired\r\n\t@Qualifier(\"iccWebServiceClient\")\r\n\tIccWebServiceClient client;\r\n\r\n\tpublic void testLocalitzaToponim() {\r\n\t\ttry {\r\n\t\t\tToponim toponim = getToponim();\r\n\t\t\tToponims response = client.localitzaToponim(toponim);\r\n\t\t\tAssert.assertTrue(response.getItem().size() > 0);\r\n\t\t} catch (IccModuleException e) {\r\n\t\t\tAssert.assertTrue(false);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate Toponim getToponim() {\r\n\t\tToponim topo = new Toponim();\r\n\t\ttopo.setNom(\"Can Clota\");\r\n\t\ttopo.setCoordenadesGeografiques(false);\r\n\t\treturn topo;\r\n\t}\r\n}\r\n```\r\n\r\n##### Obtenir informació d'un punt\r\n\r\nEl punt pot estar en el datum ED50 o en el datum ETRS89 i les coordenades han d'estar en format UTM.\r\n\r\n```java\r\nimport cat.gencat.ctti.canigo.arch.integration.icc.exceptions.IccModuleException;\r\nimport cat.icc.ws.geocodificador.*;\r\n\r\npublic class IccServiceReleaseTest {\r\n\r\n\t@Autowired\r\n\t@Qualifier(\"iccWebServiceClient\")\r\n\tIccWebServiceClient client;\r\n\r\n\tpublic void testObtenirInfoPuntEd50() {\r\n\t\ttry {\r\n\t\t\tObtenirInfoPuntInput obtenirInfoPuntInput = getObtenirInfoPuntInputUTMED50();\r\n\t\t\tInfoAdministrativa response = client.obtenirInfoPunt(obtenirInfoPuntInput);\r\n\t\t\tAssert.assertTrue(response != null);\r\n\t\t} catch (IccModuleException e) {\r\n\t\t\tAssert.assertTrue(false);\r\n\t\t}\r\n\t}\r\n\r\n\tpublic void testObtenirInfoPuntEtrs89() {\r\n\t\ttry {\r\n\t\t\tObtenirInfoPuntInput obtenirInfoPuntInput = getObtenirInfoPuntInputETRS89();\r\n\t\t\tInfoAdministrativa response = client.obtenirInfoPunt(obtenirInfoPuntInput);\r\n\t\t\tAssert.assertTrue(response != null);\r\n\t\t} catch (IccModuleException e) {\r\n\t\t\tAssert.assertTrue(false);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate PuntGeografic getPuntGeograficUTMED50() {\r\n\t\tPuntGeografic punt = new PuntGeografic();\r\n\t\tpunt.setX(428263.75);\r\n\t\tpunt.setY(4582861.0);\r\n\t\treturn punt;\r\n\t}\r\n\r\n\tprivate PuntGeografic getPuntGeograficETRS89() {\r\n\t\tPuntGeografic punt = new PuntGeografic();\r\n\t\tpunt.setX(484937.352);\r\n\t\tpunt.setY(4652370.915);\r\n\t\treturn punt;\r\n\t}\r\n\r\n\tprivate PuntGeografic getPuntGeograficBuit() {\r\n\t\tPuntGeografic punt = new PuntGeografic();\r\n\t\treturn punt;\r\n\t}\r\n\r\n\tprivate ObtenirInfoPuntInput getObtenirInfoPuntInputUTMED50() {\r\n\t\tObtenirInfoPuntInput obtenirInfoPuntInput = new ObtenirInfoPuntInput();\r\n\t\tobtenirInfoPuntInput.setPuntUTMED50(getPuntGeograficUTMED50());\r\n\t\tobtenirInfoPuntInput.setPuntUTMETRS89(getPuntGeograficBuit());\r\n\t\treturn obtenirInfoPuntInput;\r\n\t}\r\n\r\n\tprivate ObtenirInfoPuntInput getObtenirInfoPuntInputETRS89() {\r\n\t\tObtenirInfoPuntInput obtenirInfoPuntInput = new ObtenirInfoPuntInput();\r\n\t\tobtenirInfoPuntInput.setPuntUTMED50(getPuntGeograficBuit());\r\n\t\tobtenirInfoPuntInput.setPuntUTMETRS89(getPuntGeograficETRS89());\r\n\t\treturn obtenirInfoPuntInput;\r\n\t}\r\n\r\n}\r\n```\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1pY2M="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1nZWNhdA==":{"date":1426250442000,"title":"GECAT","description":"Utilització del connector al sistema SAP del Gecat.","sections":"Canigó. Documentació versió 3.x","weight":7,"path":"/canigo-documentacio-versions-3x-integracio/modul-gecat","content":"## Propòsit\r\n\r\nL'objectiu del present document és descriure la metodologia a seguir en la utilització del connector al sistema SAP del Gecat des de qualsevol aplicació Java del Framework J2EE.\r\n\r\nL'abast d'aquest connector es basa en la utilització de les funcions d'alta de factures, consultes i reserves online del SAP de Gecat, així com totes les funcions batch.\r\n\r\nEl connector permet l'accés al SAP mitjançant objectes de consulta. El connector transforma aquests objectes en una cadena de caràcters vàlida per al SAP. La cadena de retorn és transformada novament en un objecte que conté els registres de retorn.\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer poder utilitzar el connector haurem de configurar el projecte perque inclogui dues llibreries dll i diferents jars:\r\n\r\nLes llibreries són sapjcorfc.dll i librfc32.dll i s'han de copiar al directori system32.\r\n\r\nPer fer les operacions sobre el sistema SAP del Gecat és necessària la utilització del jar sapjco-2.1.6, que és el connector propi del SAP per fer les crides a les seves funcions BAPI (RFC).\r\n\r\nLes classes que utilitzarem per fer els objectes d'operacions estan en el jar del connector Gecat09 canigo-connectors-gecat09-2.3.2.jar\r\n\r\nLes classes que utilitzarem per fer les operacions han estat generades amb una eina Open Source anomenada JAXB (Java API for Xml Binding), que genera classes java a partir d'un esquema de xml (XMLSchema). Aquesta eina ens permet no solament generar automàticament classes java sinó també fer validacions per comprovar que les dades que contenen els objectes són vàlides. Per això també haurem d'incloure els jars que necessita JAXB:\r\n\r\n* jaxb-api-1.0.1.jar\r\n* jaxb-libs-1.0.6.jar\r\n* jaxb-impl-1.0.5.jar\r\n* jax-qname-1.1.jar\r\n* namespace-1.0.1.jar\r\n* relaxngDatatype-20020414.jar\r\n* xsdlib-2013.6.1.jar\r\n\r\nPer tal d'instal-lar el mòdul de GECAT es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.integration.gecat.version>[1.2.0,1.3.0)</canigo.integration.gecat.version>\r\n\r\n<dependency>\r\n          <groupId>cat.gencat.ctti</groupId>\r\n          <artifactId>canigo.integration.gecat</artifactId>\r\n          <version>${canigo.integration.gecat.version}</version>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració es realitza automàticament a partir de l'eina de suport al desenvolupament.\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/config/props/sap.properties\r\n\r\nPropietat                | Requerit | Descripció\r\n------------------------ | -------- | ----------\r\n*.sap.client \t         | Sí       | Client\r\n*.sap.username \t         | Sí       | Usuari de connexió\r\n*.sap.password \t         | Sí       | Password de connexió\r\n*.sap.language \t         | Sí       | Idioma\r\n*.sap.hostname \t         | Sí       | Nom del servidor\r\n*.sap.systemNumber \t     | Sí       | SAP system number\r\n*.sap.connectionPool     | No       | Connexió amb pool. Per defecte: true\r\n*.sap.connectionPoolName | No       | Nom del pool. Per defecte: poolCanigoSAP\r\n*.sap.maxNumConnections  | No       | Número de connexions màximes. Per defecte: 5\r\n*.sap.repositoryName     | No       | Nom del repository. Per defecte: ARAsoft\r\n\r\n## Utilització del Mòdul\r\n\r\nLa utilització del Connector es basa principalment en la configuració. L'ús directe des dels clients es permet mitjançant les interfícies definides.\r\n\r\nEl connector del Gecat ofereix tres operacions: alta de factures online, consultes i reserves. Cada operació té una classe que conté tota la informació de l'operació (o crida) i un altra amb la informació que retorna SAP per aquesta operació. Cada classe conté un altra classe per cada línia que tingui l'operació.\r\n\r\nSi per exemple tenim l'operació consultaFactura, que conté una sola línia, daddadesConsulta, haurem de crear un objecte de la classe DadesConsultaFacturaType i un altre de DadesConsultaType. Aquesta última l'omplirem amb totes les dades que facin falta mitjançant els seus mètodes setters (setSocietat, setCodiCreditor, etc..). Un cop omplert del tot aquest objecte (que representa una sola línia), l'assignarem a l'altre (que és el que representa tota la consulta) mitjançant també un mètode setter: dadesConsultaFactura.setDadesConsulta(dadesConsulta). Si tingués més línies, hauríem de fer el mateix per a totes.\r\n\r\nEn el cas en que una mateixa línia pugui aparèixer més d'una vegada la forma de fer les operacions canvia, ja que el conjunt de totes les línies del mateix tipus aniran dins d'una llista.\r\n\r\nUn cop hem creat l'objecte de crida amb totes les dades necessàries, utilitzarem un objecte de la classe GecatConnector per obtenir l'objecte de retorn amb les dades retornades pel SAP.\r\n\r\n### REST\r\n\r\nPer a utilitzar aquest mòdul, cal crear un Controller i un Service:\r\n\r\n**GecatService.java**\r\n\r\nClasse Java on es realitzarà la lògica de la operació a realitzar i es connecta amb el mòdul de Notificacions electròniques.\r\n\r\n```java\r\nimport org.slf4j.Logger;\r\nimport org.slf4j.LoggerFactory;\r\nimport org.springframework.beans.factory.annotation.Autowired;\r\nimport org.springframework.context.annotation.Lazy;\r\nimport org.springframework.stereotype.Service;\r\n\r\nimport cat.gencat.ctti.canigo.arch.integration.gecat.connector.GecatConnector;\r\nimport cat.gencat.ctti.canigo.arch.integration.gecat.consultes.ConsultaTerritori.DadesConsultaTerritoriType;\r\nimport cat.gencat.ctti.canigo.arch.integration.gecat.consultes.ConsultaTerritori.DadesConsultaType;\r\nimport cat.gencat.ctti.canigo.arch.integration.gecat.consultes.ConsultaTerritori.ObjectFactory;\r\nimport cat.gencat.ctti.canigo.arch.integration.gecat.consultes.ConsultaTerritoriRetorn.DadesConsultaTerritoriRetornType;\r\n\r\n@Service(\"gecatService\")\r\n@Lazy\r\npublic class GecatService {\r\n\r\n\tprivate static final Logger log = LoggerFactory.getLogger(GecatService.class);\r\n\r\n\t@Autowired\r\n    private GecatConnector gecatConnector;\r\n    \r\n\r\n\tpublic String testGecat(){\r\n\t\t\r\n\t\tString message;\r\n\r\n\t\ttry {\r\n\r\n            ObjectFactory objectFactory = new ObjectFactory();\r\n\r\n            /**\r\n             * creem l'objecte per fer la consulta\r\n             **/\r\n            DadesConsultaTerritoriType dadesConsultaTerritori = objectFactory.createDadesConsultaTerritoriType();\r\n            DadesConsultaType dadesConsulta = objectFactory.createDadesConsultaType();\r\n            dadesConsulta.setCodiTerritori(\"0217188\");\r\n            dadesConsultaTerritori.setDadesConsulta(dadesConsulta);\r\n            DadesConsultaTerritoriRetornType dadesConsultaRetorn = gecatConnector.consultaTerritori(dadesConsultaTerritori);\r\n\r\n            log.info(\"getCodiTerritori():\" +\r\n                    dadesConsultaRetorn.getDadesRetorn().getCodiTerritori());\r\n            log.info(\"getNomTerritori():\" +\r\n                    dadesConsultaRetorn.getDadesRetorn().getNomTerritori());\r\n\r\n            message = \"Resultat test : \" + dadesConsultaRetorn.getDadesRetorn().getNomTerritori();\r\n          } catch (Exception e) {\r\n        \t  message = \"Error al test : \" + e.getMessage();\r\n        \t  log.error(e.getMessage(),e);\r\n          }\r\n\t\t\r\n\t\treturn message;\r\n    }\r\n\t\r\n}\r\n```\r\n\r\n**GecatServiceController.java**  \r\n\r\nController que publica les operacions disponibles per a qui hagi de consumir-les.\r\n\r\n```java\r\nimport org.springframework.beans.factory.annotation.Autowired;\r\nimport org.springframework.http.MediaType;\r\nimport org.springframework.web.bind.annotation.PostMapping;\r\nimport org.springframework.web.bind.annotation.RequestMapping;\r\nimport org.springframework.web.bind.annotation.RestController;\r\n\r\nimport cat.gencat.plantilla32.service.GecatService;\r\n\r\n@RestController\r\n@RequestMapping(\"/gecat\")\r\npublic class GecatServiceController {\r\n\r\n\t@Autowired\r\n\tGecatService gecatService;\r\n\r\n\t@PostMapping(produces = { MediaType.APPLICATION_JSON_VALUE })\r\n\tpublic String testGecat() throws Exception {\r\n\t\treturn gecatService.testGecat();\r\n\t}\r\n}\r\n```\r\n\r\n\r\n### Consideracions\r\n\r\nCrides a Gecat sense línies repetides\r\n\r\n* Retorn sense línies repetides\r\n\r\nPer mostrar aquest tipus de crida agafarem com exemple la consulta de partida pressupostària.\r\n\r\nPrimerament crearem tots els objectes que necessitarem per fer el procediment:\r\n\r\n```java\r\ncat.gencat.ctti.canigo.arch.integration.gecat.consultes.ConsultaPartidaPressupostaria.ObjectFactory objectFactory = new cat.gencat.ctti.canigo.arch.integration.gecat.consultes.ConsultaPartidaPressupostaria.ObjectFactory();\r\n```\r\n\r\nLa classe ObjectFactory és, com el seu nom indica, una classe per crear objectes d'altres classes. Aquestes classes són les que ofereix JAXB per crear objectes amb una certa estructura predefinida. Crearem un objecte de la classe ObjectFactory per crear els objectes que serviran per fer la crida (objectFactory).\r\n\r\nSeguidament crearem un objecte que representarà la crida completa. Aquest objecte contindrà un objecte per a cada línia que tingui la crida. Aquests objectes són els que s'han de completar amb la informació de la crida.\r\n\r\n```java\r\nDadesConsultaPartidaPressupostariaType dadesConsultaPartidaPressupostaria = objectFactory.createDadesConsultaPartidaPressupostariaType();\r\n\r\nDadesConsultaType dadesConsulta = objectFactory.createDadesConsultaType();\r\ndadesConsulta.setCentreGestor(\"1006\");\r\ndadesConsulta.setEntitatCP(\"1000\");\r\ndadesConsulta.setExercici(\"2002\");\r\ndadesConsulta.setPosicioPressupostaria(\"D/220100100/4551\");\r\ndadesConsulta.setVinculacio(\"S\");\r\ndadesConsultaPartidaPressupostaria.setDadesConsulta(dadesConsulta);\r\n```\r\n\r\nAmb aquest objecte ja podem fer la crida al SAP mitjançant el mètode consultaPartidaPressupostaria de la classe GecatConnector. Aquesta funció requereix de l'objecte de consulta.\r\n\r\n```java\r\nDadesConsultaPartidaPressupostariaRetornType dadesConsultaRetorn = gecatConnector.consultaPartidaPressupostaria(dadesConsultaPartidaPressupostaria);\r\n```\r\n\r\nEn aquest punt ja tenim l'objecte de retorn llest per a ser utilitzat per l'aplicació.\r\n\r\n```java\r\nSystem.out.println(\"getDenominacio():\" + dadesConsultaRetorn.getDadesRetorn().getDenominacio());\r\n```\r\n\r\n* Retorn amb línies repetides\r\n\r\nPer mostrar aquest tipus de crida agafarem com exemple la consulta de creditor.\r\n\r\nPrimerament crearem tots els objectes que necessitarem per fer el procediment:\r\n\r\n```java\r\nnet.gencat.gecat.consultes.ConsultaCreditor.ObjectFactory objectFactory = new net.gencat.gecat.consultes.ConsultaCreditor.ObjectFactory();\r\n```\r\n\r\nLa classe ObjectFactory és, com el seu nom indica, una classe per crear objectes d'altres classes. Aquestes classes són les que ofereix JAXB per crear objectes amb una certa estructura predefinida. Crearem un objecte de la classe ObjectFactory per crear els objectes que serviran per fer la crida (objectFactory).\r\n\r\nSeguidament crearem un objecte que representarà la crida completa. Aquest objecte contindrà un objecte per a cada línia que tingui la crida.\r\n\r\n```java\r\nDadesConsultaCreditorType dadesConsultaCreditor = objectFactory.createDadesConsultaCreditorType();\r\nDadesConsultaType dadesConsulta = objectFactory.createDadesConsultaType();\r\ndadesConsulta.setNIFoCodiCreditor(\"A53062927\");\r\ndadesConsulta.setRegistreInicial(\"001\");\r\ndadesConsulta.setSocietat(\"1000\");\r\ndadesConsultaCreditor.setDadesConsulta(dadesConsulta);\r\n```\r\n\r\nHaurem de passar al connector l'objecte de consulta mitjançant el mètode consultaCreditor de l'objecte gecatConnector:\r\n\r\n```java\r\nDadesConsultaCreditorRetornType dadesConsultaRetorn = gecatConnector.consultaCreditor(dadesConsultaCreditor);\r\n```\r\n\r\nAra ja tenim l'objecte de retorn llest per a ser utilitzat:\r\n\r\n```java\r\nList finalList = dadesConsultaRetorn.getDadesRetorn().getDadaRetorn();\r\nSystem.out.println(\"dadaRetorn.getAdreca:\" + ((DadaRetornType)finalList.get(0)).getAdreca());\r\n```\r\n\r\n**Crides a Gecat amb línies repetides**\r\n\r\nPer mostrar aquest altre tipus de crida prendrem com exemple l'alta de factures habilitats.\r\n\r\nCrearem tots els objectes que necessitarem per fer el procediment:\r\n\r\n```java\r\ncat.gencat.ctti.canigo.arch.integration.gecat.factures.FacturesHabilitatsOnline.ObjectFactory objectFactory = new cat.gencat.ctti.canigo.arch.integration.gecat.factures.FacturesHabilitatsOnline.ObjectFactory();\r\n```\r\n\r\nLa classe ObjectFactory és, com el seu nom indica, una classe per crear objectes d'altres classes. Aquestes classes són les que ofereix JAXB per crear objectes amb una certa estructura predefinida. Crearem un objecte de la classe ObjectFactory per crear els objectes que serviran per fer la crida (objectFactory).\r\n\r\nSeguidament crearem un objecte que representarà la crida completa. Aquest objecte contindrà un objecte per a cada línia (o conjunt de línies) que tingui la crida.\r\n\r\n```java\r\nDadesAltaFacturesHabilitatsOnlineType dadesAltaFacturaHabilitats = objectFactory.createDadesAltaFacturesHabilitatsOnlineType();\r\nDadesGeneralsFacturaType dadesGeneralsFactura = objectFactory.createDadesGeneralsFacturaType();\r\ndadesGeneralsFactura.setDataCompt(\"24051980\");\r\ndadesGeneralsFactura.setDataDocument(\"01\");\r\n.\r\n.\r\n.\r\ndadesGeneralsFactura.setTransaccio(\"ZD21\");\r\ndadesAltaFacturaHabilitats.setDadesGeneralsFactura(dadesGeneralsFactura);\r\n```\r\n\r\nSi la línia pot estar repetida, com en el cas de retencions habilitat subhabilitat, haurem de crear una llista d'objectes que representen una línia:\r\n\r\n```java\r\nRetencionsHabilitatSubhabilitatType retencionsHS = objectFactory.1createRetencionsHabilitatSubhabilitatType();\r\nList retencionsHSList = retencionsHS.getRetencioHabilitatSubhabilitat();\r\nRetencioHabilitatSubhabilitatType retencioHS = objectFactory.\r\ncreateRetencionsHabilitatSubhabilitatTypeRetencioHabilitatSubhabilitatType();\r\n\r\nretencioHS.setImportBase(\"1500\");\r\nretencioHS.setImportRetencio(\"25000\");\r\nretencioHS.setIndicadorRetencio(\"01\");\r\nretencioHS.setTipusRegistre(\"3\");\r\nretencioHS.setOrder(0);\r\nretencionsHSList.add(retencioHS);\r\n\r\nretencioHS = (RetencioHabilitatSubhabilitatType)retencioHS.getClass().newInstance();\r\nretencioHS.setImportBase(\"1600\");\r\nretencioHS.setImportRetencio(\"26000\");\r\nretencioHS.setIndicadorRetencio(\"01\");\r\nretencioHS.setTipusRegistre(\"3\");\r\nretencioHS.setOrder(1);\r\nretencionsHSList.add(retencioHS);\r\n\r\ndadesAltaFacturaHabilitats.setRetencionsHabilitatSubhabilitat(retencionsHS);\r\n```\r\n\r\nFixem-nos que és important donar un ordre a les línies contingudes en la llista:\r\n\r\n```java\r\nretencioHS.setOrder(0);\r\n```\r\n\r\nAmb aquest objecte ja podem fer la crida al SAP, mitjançant el mètode altaFacturesHabilitats de l'objecte gecatConnector:\r\n\r\n```java\r\nDadesConsultaCreditorRetornType dadesConsultaRetorn = gecatConnector.consultaCreditor(dadesConsultaCreditor);\r\n```\r\n\r\nAra ja disposem de l'objecte de retorn per a ser utilitzat:\r\n\r\n```java\r\nList finalList = dadesAltaFacturaRetorn.getDadesRetorn().getDadaRetorn();\r\nSystem.out.println(\"dadaRetorn.getClasseDocument():\" +\r\n((DadaRetornType)finalList.get(0)).getClasseDocument());\r\n```\r\n\r\n### Usuaris de prova\r\n\r\nS'han habilitat dos usuaris per a fer proves amb el connector de Gecat. Aquests usuaris es poden fer servir en les proves de desenvolupament, però mai per a producció.\r\n\r\n* ZBTCCANIGO per a les interfases \"batch\".\r\n* ZINTCANIGO per a les interfases \"on-line\".\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1nZWNhdA=="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1kb2N1bWVudHVt":{"date":1426765232000,"title":"Documentum","description":"Accés al gestor documental corporatiu del CTTI.","sections":"Canigó. Documentació versió 3.x","weight":4,"path":"/canigo-documentacio-versions-3x-integracio/modul-documentum","content":"## Propòsit\r\n\r\nEl propósit del connector és proporcionar una interfície Java per accedir a Documentum. Permetent emmagatzemar i recuperar documents a més d'altres operacions relacionades com crear carpetes i associar propietats.\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació del DFC\r\n\r\nPrevi a la utilització del servei cal instal.lar a la màquina de desenvolupament/servidor la DFC's de la versió de Documentum que es farà servir :\r\n\r\n* Documentum 5.3 \r\n* Documentum 6.5\r\n* Documentum 7.1 \r\n\r\nEn cas de no comptar amb aquests instal·lable, es pot sol·licitar a la bústia canigó <oficina-tecnica.canigo.ctti@gencat.cat>\r\n\r\n\r\n\r\nEls passos a seguir en l'instal.lació són els següents (similars a les 3 versions):\r\n\r\n![Instal.lació documentum pas 1](/related/canigo/documentacio/modul-documentum/image005.jpg \"Instal.lació documentum pas 1\")\r\n\r\n![Instal.lació documentum pas 2](/related/canigo/documentacio/modul-documentum/image006.jpg \"Instal.lació documentum pas 2\")\r\n\r\n![Instal.lació documentum pas 3](/related/canigo/documentacio/modul-documentum/image007.jpg \"Instal.lació documentum pas 3\")\r\n\r\n![Instal.lació documentum pas 4](/related/canigo/documentacio/modul-documentum/image008.jpg \"Instal.lació documentum pas 4\")\r\n\r\nAquí indicarem el host i el port del docBroker que conté el magatzem de claus.\r\n\r\n![Instal.lació documentum pas 5](/related/canigo/documentacio/modul-documentum/image009.jpg \"Instal.lació documentum pas 5\")\r\n\r\n![Instal.lació documentum pas 6](/related/canigo/documentacio/modul-documentum/image010.jpg \"Instal.lació documentum pas 6\")\r\n\r\n![Instal.lació documentum pas 7](/related/canigo/documentacio/modul-documentum/image011.jpg \"Instal.lació documentum pas 7\")\r\n\r\n![Instal.lació documentum pas 8](/related/canigo/documentacio/modul-documentum/image012.jpg \"Instal.lació documentum pas 8\")\r\n\r\n![Instal.lació documentum pas 9](/related/canigo/documentacio/modul-documentum/image013.jpg \"Instal.lació documentum pas 9\")\r\n\r\n![Instal.lació documentum pas 10](/related/canigo/documentacio/modul-documentum/image014.jpg \"Instal.lació documentum pas 10\")\r\n\r\nCom a resultat de la instalació es generarà un arxiu amb la configuració d'accés a documentum.\r\n\r\nEn el cas de Documentum 5.3,  aquest es generarà per defecte a **C:\\WINDOWS\\dmcl.ini** i tindrà el format següent:\r\n```\r\n[DOCBROKER_PRIMARY]\r\nhost =es-hg2r02j\r\nport =1489\r\n\r\n[DMAPI_CONFIGURATION]\r\ncache_queries = T\r\ntoken_storage_enabled=F\r\ntoken_storage_path=D:\\Documentum\\apptoken\r\n```\r\n\r\nEn el cas de Documentum 6.5 i 7.1, aquest es generarà per defecte a **C:\\Documentum\\config\\dfc.properties** i tindrà el format següent:\r\n```\r\ndfc.data.dir=C\\:/Documentum\r\ndfc.registry.mode=windows\r\ndfc.search.ecis.enable=false\r\ndfc.search.ecis.host=\r\ndfc.search.ecis.port=\r\ndfc.tokenstorage.dir=C\\:/Documentum/apptoken\r\ndfc.tokenstorage.enable=false\r\ndfc.docbroker.host[0]=nomHostDocumentum\r\ndfc.docbroker.port[0]=PortHostDocumentum\r\ndfc.globalregistry.repository=NomRepositoriClaus\r\ndfc.globalregistry.username=usernameRepositoriClaus\r\ndfc.globalregistry.password=passRepositoriClaus\r\n```\r\n\r\n### Instal·lació del connector\r\n\r\n\r\nPer tal d'instal- lar el mòdul de Documentum es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\nPer a la versió 5.3 de Documentum:\r\n\r\n```\r\n<canigo.integration.documentum.version>[1.2.0,1.3.0)</canigo.integration.documentum.version>\r\n\r\n<dependency>\r\n          <groupId>cat.gencat.ctti</groupId>\r\n          <artifactId>canigo.integration.documentum</artifactId>\r\n          <version>${canigo.integration.documentum.version}</version>\r\n</dependency>\r\n```\r\n\r\nPer a la versió 6.5\r\n\r\n```\r\n<canigo.integration.documentum.version>[2.2.0,2.3.0)</canigo.integration.documentum.version>\r\n\r\n<dependency>\r\n          <groupId>cat.gencat.ctti</groupId>\r\n          <artifactId>canigo.integration.documentum</artifactId>\r\n          <version>${canigo.integration.documentum.version}</version>\r\n</dependency>\r\n```\r\n\r\nPer a la versió 7.1\r\n\r\n```\r\n<canigo.integration.documentum.version>[3.1.0,3.2.0)</canigo.integration.documentum.version>\r\n\r\n<dependency>\r\n          <groupId>cat.gencat.ctti</groupId>\r\n          <artifactId>canigo.integration.documentum</artifactId>\r\n          <version>${canigo.integration.documentum.version}</version>\r\n</dependency>\r\n```\r\n\r\n#### Dependències amb llibreries del DFC instal·lat\r\nEls connectors tenen dependències amb llibreries de la versió del DFC instal·lat. Aquestes llibreries s'inclouen amb la instal·lació del DFC, a la carpeta **C:\\Program Files\\Documentum\\Shared\\**. Caldrà afegir-les al repositori .m2 local per tal que Maven les resolgui.\r\n\r\nPer a la versió de DFC 7.1 , serà necessari instal·lar les següents llibreries :\r\n```\r\nmvn install:install-file -Dfile=\"dfc.jar\" -DgroupId=dfc -DartifactId=dfc -Dversion=7.1 -Dpackaging=jar\r\nmvn install:install-file -Dfile=\"certj.jar\" -DgroupId=certj -DartifactId=certj -Dversion=5.2 -Dpackaging=jar\r\nmvn install:install-file -Dfile=\"configservice-api.jar\" -DgroupId=configservice -DartifactId=configservice-api -Dversion=7.1 -Dpackaging=jar\r\nmvn install:install-file -Dfile=\"configservice-impl.jar\" -DgroupId=configservice -DartifactId=configservice-impl -Dversion=7.1 -Dpackaging=jar\r\nmvn install:install-file -Dfile=\"jcmFIPS.jar\" -DgroupId=jcmFIPS -DartifactId=jcmFIPS -Dversion=6.1 -Dpackaging=jar\r\nmvn install:install-file -Dfile=\"jcifs-krb5-1.3.1.jar\" -DgroupId=jcifs-krb5 -DartifactId=jcifs-krb5 -Dversion=1.3.1 -Dpackaging=jar\r\nmvn install:install-file -Dfile=\"cryptojce.jar\" -DgroupId=cryptojce -DartifactId=cryptojce -Dversion=6.1 -Dpackaging=jar\r\nmvn install:install-file -Dfile=\"cryptojcommon.jar\" -DgroupId=cryptojcommon -DartifactId=cryptojcommon -Dversion=6.1 -Dpackaging=jar\r\n```\r\n\r\n\r\n\r\n\r\n### Configuració del connector\r\n\r\nLa configuració es realitza automàticament a partir de la eina de suport al desenvolupament.\r\n\r\n#### Propietats del connector\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/config/props/documentum.properties\r\n\r\nPropietat                   | Requerit | Descripció\r\n--------------------------- | -------- | ----------\r\n*.documentum.user           | Sí       | Usuari de Documentum\r\n*.documentum.password       | Sí       | Password de Documentum\r\n*.documentum.docBase        | Sí       | Doc base\r\n*.documentum.dir            | Sí       | Directori de Documentum\r\n*.documentum.pathDirectori  | No       | Path directori\r\n*.documentum.pathFitxer     | No       | Path arxiu\r\n*.documentum.nomFitxer      | No       | Nom d'arxiu\r\n*.documentum.extFitxer      | No       | Extensió d'arxiu\r\n*.documentum.pathFitxer2    | No       | Path segon arxiu\r\n*.documentum.nomFitxer2     | No       | Nom del segon arxiu\r\n*.documentum.extFitxer2     | No       | Extensió d'un segon arxiu\r\n*.documentum.pathFitxerOut  | No       | Directori de sortida\r\n*.documentum.dir3           | No       | Directori\r\n*.documentum.user2          | No       | Usuari 2\r\n*.documentum.password2      | No       | Password 2\r\n*.documentum.ACL            | No       | ACL\r\n*.documentum.ACLDomain      | No       | ACL Domain\r\n*.documentum.cicleVida      | No       | Cicle vida\r\n*.documentum.estat          | No       | Estat\r\n*.documentum.grup           | No       | Grup\r\n\r\n#### Propietats del dfc\r\nTambé caldrà incloure al CLASSPATH del projecte el dfc.properties generat durant la instla·lació del DFC. \r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/dfc.properties\r\n\r\n## Utilització del Mòdul\r\n\r\n### Exemple\r\n\r\nEn aquest exemple tenim dues classes, DocumentumServiceController que és l'endpoint del servei. I DocumentumAplicacioService, que és la classe Java on es realitza la lògica de la operació i es crida al mòdul de Documentum.\r\n\r\n**DocumentumServiceController.java**\r\n\r\n```java\r\n\timport org.springframework.beans.factory.annotation.Autowired;\r\n\timport org.springframework.http.MediaType;\r\n\timport org.springframework.web.bind.annotation.PostMapping;\r\n\timport org.springframework.web.bind.annotation.RequestMapping;\r\n\timport org.springframework.web.bind.annotation.RestController;\r\n\r\n\timport cat.gencat.plantilla32.service.DocumentumAplicacioService;\r\n\r\n\t@RestController\r\n\t@RequestMapping(\"/documentum\")\r\n\tpublic class DocumentumServiceController {\r\n\r\n\t\t@Autowired\r\n\t\tDocumentumAplicacioService documentumAplicacioService;\r\n\r\n\t\t@PostMapping(produces = { MediaType.APPLICATION_JSON_VALUE })\r\n\t\tpublic String testLogin() throws Exception {\r\n\t\t\treturn documentumAplicacioService.testLogin();\r\n\t\t}\r\n\t}\r\n```\r\n\r\n**DocumentumAplicacioService.java**\r\n\r\n```java\r\n\timport org.slf4j.Logger;\r\n\timport org.slf4j.LoggerFactory;\r\n\timport org.springframework.beans.factory.annotation.Autowired;\r\n\timport org.springframework.context.annotation.Lazy;\r\n\timport org.springframework.stereotype.Service;\r\n\r\n\timport cat.gencat.ctti.canigo.arch.integration.documentum.DocumentumConnector;\r\n\timport cat.gencat.ctti.canigo.arch.integration.documentum.DocumentumService;\r\n\timport cat.gencat.ctti.canigo.arch.integration.documentum.impl.DocumentumConfigurator;\r\n\r\n\t@Service(\"documentumAplicacioService\")\r\n\t@Lazy\r\n\tpublic class DocumentumAplicacioService {\r\n\r\n\t\tprivate static final Logger log = LoggerFactory.getLogger(DocumentumAplicacioService.class);\r\n\r\n\t\t@Autowired\r\n\t\tprivate DocumentumService service;\r\n\t\t\r\n\t\t@Autowired\r\n\t\tprivate DocumentumConnector documentum;\r\n\t\t\r\n\t\t@Autowired\r\n\t\tprivate DocumentumConfigurator configurator;\r\n\t\t\r\n\r\n\t\t/**\r\n\t\t * Comprovem que es pot fer login al sistema de Documentum\r\n\t\t */\r\n\t\tpublic String testLogin(){\r\n\t\t\t\r\n\t\t\tString message = null;\r\n\r\n\t\t\ttry{\r\n\t\t\t\tservice.login(configurator.getUser(), configurator.getPassword(),configurator.getDocBase(), this.documentum);\r\n\t\t\t}catch(Exception e){\r\n\t\t\t\tmessage = \"Error al realitzar login\";\r\n\t\t\t\tlog.error(e.getMessage(), e);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tmessage = \"Login correcte\";\r\n\t\t\t\r\n\t\t\treturn message;\r\n\t\t}\r\n\t\t\r\n\t}\r\n```\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1kb2N1bWVudHVt"},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1zZWd1cmV0YXQ=":{"date":1480326534000,"title":"Mòdul Seguretat","description":"Autenticació i autorització d'usuaris","sections":"Canigó. Documentació versió 3.x","weight":9,"path":"/canigo-documentacio-versions-3x-core/modul-seguretat","content":"## Propòsit\r\n\r\nEl Mòdul de Seguretat té com a propòsit principal gestionar l'autenticació i l'autorització dels usuaris en aplicacions Canigó. L'objectiu de l'autenticació és comprovar que l'usuari és qui diu ser, mentre que l'autorització s'encarrega de comprovar que realment té accés als recursos sol·licitats.\r\n\t\r\nCanigó recomana l'ús de Spring Security com a framework base i les extensions que Canigó proporciona.\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer tal d'instal- lar el mòdul de seguretat es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.security.version>[1.2.0, 1.3.0)</canigo.security.version>\r\n<canigo.test.version>[1.2.0,1.3.0)</canigo.test.version>\r\n\r\n<dependency>\r\n\t<groupId>cat.gencat.ctti</groupId>\r\n\t<artifactId>canigo.security</artifactId>\r\n\t<version>${canigo.security.version}</version>\r\n</dependency>\r\n\r\n<dependency>\r\n\t<groupId>cat.gencat.ctti</groupId>\r\n\t<artifactId>canigo.test</artifactId>\r\n\t<version>${canigo.test.version}</version>\r\n\t<scope>test</scope>\r\n</dependency>\r\n\r\n<dependency>\r\n   <groupId>cat.gencat.ctti</groupId>\r\n   <artifactId>canigo.security</artifactId>\r\n   <type>test-jar</type>\r\n   <version>${canigo.security.version}</version>\r\n   <scope>test</scope>\r\n   <classifier>tests</classifier>\r\n</dependency>\r\n\r\n```\r\nAl pom.xml també s'ha d'afegir el plugin executa el test unitari del mòdul de seguretat. \r\nEn el cas de tenir configurat l'execució del test dels mòduls de configuració i/o persistència,\r\ncal excloure la dependència del mòdul de seguretat per tal d'evitar conflictes:\r\n```\r\n<build>\r\n\t...\r\n\t<plugins>\r\n\t\t...\r\n        <plugin>\r\n            <groupId>org.apache.maven.plugins</groupId>\r\n            <artifactId>maven-surefire-plugin</artifactId>\r\n            <executions>\r\n                <execution>\r\n                    <id>base-test</id>\r\n                    <phase>test</phase>\r\n                    <goals>\r\n                        <goal>test</goal>\r\n                    </goals>\r\n                    <configuration>\r\n                        <dependenciesToScan>\r\n\t\t          <dependency>cat.gencat.ctti:canigo.core</dependency>\r\n\t\t          <dependency>cat.gencat.ctti:canigo.persistence.jpa</dependency>\r\n\t\t\t  <dependency>cat.gencat.ctti:canigo.web.rs</dependency>\r\n                        </dependenciesToScan>\r\n\t\t\t<excludes>\r\n\t\t\t  <exclude>%regex[${project.groupId}.*.*Test.*]</exclude>\r\n\t\t\t</excludes>\r\n\t\t\t<classpathDependencyExcludes>\r\n\t\t\t  <classpathDependencyExcludes>cat.gencat.ctti:canigo.security</classpathDependencyExcludes>\r\n\t\t\t</classpathDependencyExcludes>\r\n                    </configuration>\r\n                </execution>\r\n                <execution>\r\n                    <id>cat.gencat.ctti:canigo.security-test</id>\r\n                    <phase>test</phase>\r\n                    <goals>\r\n                        <goal>test</goal>\r\n                    </goals>\r\n                    <configuration>\r\n                        <dependenciesToScan>\r\n                          <dependency>cat.gencat.ctti:canigo.security</dependency>\r\n                        </dependenciesToScan>\r\n\t\t\t<excludes>\r\n\t\t\t  <exclude>%regex[${project.groupId}.*.*Test.*]</exclude>\r\n\t\t\t</excludes>\r\n                    </configuration>\r\n                </execution>\r\n                ...\r\n            </executions>\r\n        </plugin>\r\n\t\t...\r\n\t</plugins>\r\n\t...\r\n</build>\t\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració es realitza automàticament a partir de l'eina de suport al desenvolupament i es compon de les següents parts:\r\n\r\n* Configuració de filtres web\r\n* Configuració de JWT (JSON Web Token)\r\n* Publicació Controladors de Seguretat\r\n* Configuració d'autenticació\r\n* Configuració d'autorització\r\n* Configuració de la font de dades de l'esquema de seguretat\r\n\r\n#### Configuració de filtres web\r\n\r\nSpring Security utilitza un conjunt de filtres per a detectar aspectes de l'autorització i autenticació. Per a fer-los servir definirem en el fitxer 'WEB-INF/web.xml el codi següent:\r\n\r\n```\r\n<filter>\r\n    <filter-name>springSecurityFilterChain</filter-name>\r\n    <filter-class>org.springframework.web.filter.DelegatingFilterProxy</filter-class>\r\n</filter>\r\n<filter-mapping>\r\n    <filter-name>springSecurityFilterChain</filter-name>\r\n    <url-pattern>/*</url-pattern>\r\n</filter-mapping>\r\n```\r\n\r\nPer a més informació consultar la pàgina [Spring Security Doc](http://docs.spring.io/spring-security/site/docs/4.2.x/reference/htmlsingle/#security-filter-chain)\r\n\r\n#### Configuració de JWT (JSON Web Token)\r\n\r\nLa nova versió de Canigó permet treballar amb [JWT](https://jwt.io/). Per això s'ha fet servir la llibreria [Java JWT](https://java.jsonwebtoken.io/). Aquesta llibreria permet autenticar l'usuari amb qualsevol dels mètodes descrits en el següent apartat \"Configuració d'autenticació\". Un cop autenticat l'usuari, el servidor genera un token que serà enviat pel client a la capçalera HTTP a cada petició.\r\n\r\nPer poder configurar JWT es necessita afegir al fitxer de propietats del Servei de Seguretat (security.properties) la següent configuració:\r\n\r\nPropietat                     | Requerit | Descripció                                 | Valor per Defecte\r\n----------------------------- | -------- | -------------------------------------------|------------------\r\n*.jwt.header                  | No       | Nom del header del token JWT\t\t      | Authentication\r\n*.jwt.header.startToken       | No       | Inici del token JWT       \t\t      | Bearer\r\n*.jwt.tokenResponseHeaderName | No       | Nom del header del token JWT        \t      | jwtToken\r\n*.jwt.secret                  | No       | Password per generar el token JWT          | canigo\r\n*.jwt.expiration              | No       | Temps de vida del token JWT       \t      | 3600\r\n*.jwt.siteminderAuthentication| No       | Gicar authentication             \t      | false\r\n\r\nPer provar l'autenticació per token s'ha de cridar a \"http://<app>/api/auth\" amb la capçalera GICAR, en cas d'autenticació per GICAR, o en el cos de la petició en format JSON en altres casos.\r\n```\r\n{ \r\n\tusername = user,\r\n\tpassword  = secret\r\n} \r\n```\r\nAquesta crida ens retornarà un token vàlid. Per a les següents peticions s'ha d'enviar aquest token a la capçalera HTTP de la petició de la següent manera (configuració per defecte):\r\n\r\nAuthentication Bearer eyJhbGciOiJIUzUxMiJ9.eyJleHAiOjE0NzkyMzEzODMsInN1YiI6ImFkbWluIiwiYXV0aG9yaXRpZXMiOiJST0xFX0FETUlOLFJPTEVfVVNFUiJ9.jeApLoXyn4nrdp2iPRkjhoTWmzFNUYOkphnck0gmp1pLygOj1hgN1O1Ps86_jY6ZXaEhXl2Fk-o36SOMQAQGHA\r\n\r\nMés endavant es mostra un exemple de configuració a Canigó de JWT + GICAR.\r\n\r\n#### Publicació Controladors de Seguretat\r\n\r\nPer defecte el mòdul de seguretat publica les api /auth i /login.\r\n\r\nEn cas de no voler publicar-les a la nostra aplicació s'hauria de condicionar la càrrega de Spring Boot de la següent manera:\r\n\r\nAl fitxer de configuració de l'aplicació (AppConfig.java) afegir l'annotació @PropertySource al fitxer boot.properties que s'ha de crear:\r\n\r\n\t@Configuration\r\n\t@PropertySource(\"classpath:/config/props/boot.properties\")\r\n\t@ImportResource({ \"classpath:cat/gencat/ctti/canigo/arch/core/config/canigo-core.xml\" })\r\n\t@EnableTransactionManagement\r\n\tpublic class AppConfig {\r\n\t}\r\n\t\r\nCrear el fitxer /src/main/reources/config/props/boot.properties amb la propietat *publishAuthController* a false:\r\n\r\n\tpublishAuthController=false\r\n\r\n\r\n#### Configuració de l'autenticació\r\n\r\nEn la configuració de l'autenticació tindrem en consideració:\r\n\r\n* Seleccionar el tipus de font contra la que es realitza l'autenticació (per arxiu de propietats, base de dades, LDAP, ...)\r\n* Configurar el formulari d'autenticació web i la seqüència d'accions per realitzar l'autenticació.\r\n\r\nDins d'aquest mòdul trobem els següents proveidors de seguretat:\r\n\r\n* Seguretat In-Memory\r\n* Seguretat Base de dades\r\n* Seguretat LDAP\r\n* Seguretat GICAR\r\n\r\nEls diferents proveidors comparteixen els següents arxius de configuració:\r\n\r\n* security.properties: propietats del servei de seguretat\r\n* app-custom-security.xml: arxiu XML amb la configuració de seguretat.\r\n* SecurityConfig.java: classe Java amb la configuració de seguretat Web.\r\n* security.users.properties: llistat en format pla dels usuaris/password/rols de l'aplicació per al proveïdor \"InMemory\".\r\n\r\nLa disposició dels arxius és la següent:\r\n\r\n* Ubicació: <PROJECT_ROOT>/src/main/resources/config/props/security.users.properties\r\n* Ubicació: <PROJECT_ROOT>/src/main/resources/spring/app-custom-security.xml\r\n* Ubicació: <PROJECT_ROOT>/src/main/java/cat/gencat/nomapp/config/SecurityConfig.java\r\n* Ubicació: <PROJECT_ROOT>/src/main/resources/config/props/security.properties\r\n\r\nA continuació es mostra la classe SecurityConfig per a una configuració basada en GICAR amb token JWT en una aplicació Canigó:\r\n\r\n```\r\npublic class SecurityConfig extends WebSecurityConfigurerAdapter {\r\n\r\n\t@Autowired\r\n\tprivate AuthenticationEntryPoint restAuthenticationEntryPoint;\r\n\r\n\t@Autowired\r\n\tprivate PropertiesConfiguration propertiesConfiguration;\r\n\r\n\t@Autowired\r\n\t@Lazy\r\n\tprivate AuthenticationManager authenticationManager;\r\n\t\r\n\t@Autowired\r\n\t@Lazy\r\n\tprivate AuthenticationSuccessHandler restAuthenticationSuccessHandler;\r\n\r\n\t@Autowired\r\n\t@Lazy\r\n\tprivate DataSource dataSource;\r\n\r\n\t@Override\r\n\tprotected void configure(final HttpSecurity http) throws Exception {\r\n\r\n\t\thttp.authorizeRequests().antMatchers(\"/api/auth\").permitAll().antMatchers(\"/images/*/**\", \"/css/*/**\", \"/js/*/**\", \"/fonts/*/**\")\r\n\t\t\t\t.permitAll().antMatchers(\"/api/info/properties\", \"/api/info/modules\").hasRole(\"ADMIN\").antMatchers(\"/api/equipaments/**\").hasRole(\"USER\");\r\n\r\n\t\thttp.sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS);\r\n\t\thttp.exceptionHandling().authenticationEntryPoint(restAuthenticationEntryPoint);\r\n\t\thttp.addFilterBefore(jwtAuthenticationFilter(), AbstractPreAuthenticatedProcessingFilter.class);\r\n\r\n\t}\r\n\r\n\t@Bean\r\n\t@Autowired\r\n\tpublic ProxyUsernamePasswordAuthenticationFilter proxyUsernamePasswordAuthenticationFilter() {\r\n\t\tfinal ProxyUsernamePasswordAuthenticationFilter proxyUsernamePasswordAuthenticationFilter = new ProxyUsernamePasswordAuthenticationFilter(\"/api/login\",\r\n\t\t\t\tRequestMethod.POST.toString());\r\n\t\tproxyUsernamePasswordAuthenticationFilter.setSiteminderAuthentication(true);\r\n\t\tproxyUsernamePasswordAuthenticationFilter.setAuthenticationManager(authenticationManager);\r\n\t\tproxyUsernamePasswordAuthenticationFilter.setAuthenticationSuccessHandler(restAuthenticationSuccessHandler);\r\n\t\treturn proxyUsernamePasswordAuthenticationFilter;\r\n\t}\r\n\r\n\t@Bean\r\n\tpublic AuthenticationProvider gicarProvider() {\r\n\t\tfinal SiteminderAuthenticationProvider siteminderAuthenticationProvider = new SiteminderAuthenticationProvider();\r\n\t\tsiteminderAuthenticationProvider.setUserDetailsService(gicarUserDetailsService());\r\n\t\treturn siteminderAuthenticationProvider;\r\n\t}\r\n\r\n\t@Bean\r\n\t@Primary\r\n\tpublic UserDetailsService gicarUserDetailsService() {\r\n\t\tfinal GICARUserDetailsServiceImpl gicarUserDetailsService = new GICARUserDetailsServiceImpl();\r\n\t\tgicarUserDetailsService.setHttpGicarHeaderUsernameKey(getHttpGicarHeaderUsernameKey());\r\n\t\tgicarUserDetailsService.setAuthoritiesDAO(authoritiesDAO());\r\n\t\treturn gicarUserDetailsService;\r\n\t}\r\n\r\n\t@Bean\r\n\tpublic AuthoritiesDAO authoritiesDAO() {\r\n\t\tfinal AuthoritiesDAOImpl authoritiesDAOImpl = new AuthoritiesDAOImpl();\r\n\t\tauthoritiesDAOImpl.setDataSource(dataSource);\r\n\t\treturn authoritiesDAOImpl;\r\n\t}\r\n\r\n\t@Override\r\n\t@Autowired\r\n\tprotected void configure(final AuthenticationManagerBuilder auth) throws Exception {\r\n\t\tauth.authenticationProvider(gicarProvider());\r\n\t}\r\n\r\n\t@Bean\r\n\t@Autowired\r\n\tpublic AuthenticationManager authenticationManager(final AuthenticationManagerBuilder auth) {\r\n\t\treturn auth.getOrBuild();\r\n\t}\r\n\r\n\t@Bean\r\n\t@Named(\"jwtAuthenticationService\")\r\n\tpublic AuthenticationService jwtAuthenticationService() {\r\n\t\tfinal JwtAuthenticationService JwtAuthenticationService = new JwtAuthenticationService();\r\n\t\tJwtAuthenticationService.setSiteminderAuthentication(getSiteminderAuthentication());\r\n\t\tJwtAuthenticationService.setTokenResponseHeaderName(getTokenResponseHeaderName());\r\n\t\tJwtAuthenticationService.setHeaderAuthName(getHeaderAuthName());\r\n\r\n\t\treturn JwtAuthenticationService;\r\n\t}\r\n\r\n\t@Bean\r\n\t@Named(\"jwtAuthenticationFilter\")\r\n\tpublic JwtAuthenticationFilter jwtAuthenticationFilter() {\r\n\t\tfinal JwtAuthenticationFilter jwtAuthenticationFilter = new JwtAuthenticationFilter();\r\n\t\tjwtAuthenticationFilter.setHeaderAuthName(getHeaderAuthName());\r\n\t\tjwtAuthenticationFilter.setStartToken(getStartToken());\r\n\t\tjwtAuthenticationFilter.setTokenResponseHeaderName(getTokenResponseHeaderName());\r\n\t\treturn jwtAuthenticationFilter;\r\n\t}\r\n\r\n\t@Bean\r\n\t@Named(\"jwtTokenHandler\")\r\n\tpublic JwtTokenHandler jwtTokenHandler() {\r\n\t\tfinal JwtTokenHandler JwtTokenHandler = new JwtTokenHandler();\r\n\t\tJwtTokenHandler.setExpiration(getExpiration());\r\n\t\tJwtTokenHandler.setSecret(getSecret());\r\n\t\treturn JwtTokenHandler;\r\n\t}\r\n\r\n\tprivate String getSecret() {\r\n\t\tfinal String secret = propertiesConfiguration.getProperty(\"jwt.secret\");\r\n\t\treturn secret != null ? secret : \"canigo\";\r\n\t}\r\n\r\n\tprivate Long getExpiration() {\r\n\t\tfinal Long expiration = new Long(propertiesConfiguration.getProperty(\"jwt.expiration\"));\r\n\t\treturn expiration != null ? expiration : 3600L;\r\n\t}\r\n\r\n\tprivate String getStartToken() {\r\n\t\tfinal String startToken = propertiesConfiguration.getProperty(\"jwt.header.startToken\");\r\n\t\treturn startToken != null ? startToken : \"Bearer\";\r\n\t}\r\n\r\n\tprivate String getHeaderAuthName() {\r\n\t\tfinal String headerAythName = propertiesConfiguration.getProperty(\"jwt.header\");\r\n\t\treturn headerAythName != null ? headerAythName : \"Authentication\";\r\n\t}\r\n\r\n\tprivate String getTokenResponseHeaderName() {\r\n\t\tfinal String tokenResponseHeaderName = propertiesConfiguration.getProperty(\"jwt.tokenResponseHeaderName\");\r\n\t\treturn tokenResponseHeaderName != null ? tokenResponseHeaderName : \"jwtToken\";\r\n\t}\r\n\r\n\tprivate boolean getSiteminderAuthentication() {\r\n\t\tfinal Boolean siteminder = new Boolean(propertiesConfiguration.getProperty(\"jwt.siteminderAuthentication\"));\r\n\t\treturn siteminder != null ? siteminder : false;\r\n\t}\r\n\r\n\tprivate String getHttpGicarHeaderUsernameKey() {\r\n\t\tfinal String gicarHeader = propertiesConfiguration.getProperty(\"security.gicar.httpGicarHeaderUsernameKey\");\r\n\t\treturn gicarHeader != null ? gicarHeader : \"NIF\";\r\n\t}\r\n}\r\n```\r\n\r\n\r\n\r\n#### Configuració de la font d'autorització per base de dades\r\n\r\nPer a configurar la font d'autorització mitjançant base de dades és necessari:\r\n\r\n* Configurar l'arxiu de propietats security.properties.\r\n* Conigurar el proveïdor de seguretat dins de la configuració de seguretat de Spring.\r\n\r\nEls dos arxius es generen i configuren de manera automàtica mitjançant l'eina de desenvolupament.\r\n\r\nLes propietats de l'arxiu security.properties son les següents:\r\n\r\nPropietat                    | Requerit | Descripció\r\n---------------------------- | -------- | ----------------------------------------------------------\r\n*.security.database.jndiName | Si       | Nom JNDI d'accés a la BD. Obligatori per a connexions JNDI\r\n*.security.database.url      | Si       | URL de connexió a la base de dades\r\n*.security.database.username | Si       | Usuari de connexió a la base de dades\r\n*.security.database.password | Si       | Password de connexió a la base de dades\r\n\r\nLa configuració del provider en app-custom-security.xml per aquest proveidor és la següent:\r\n\r\n* Afegim el provider al authentication manager.\r\n* Afegim el tipus de codificador de password per tal de comparar el password de base de dades i el que ens ha proporcionat l'usuari de l'aplicació. Aquest codificador suporta: plaintext, sha, sha-256, md5, md4, ssha. Si en la base de dades tenim emmagatzemat els password d'usuari en md5, i marquem \"password-encode\" com a md5, de manera automàtica, el password proporcionat per l'usuari via formulari de login (j_password) es codificarà en md5 per posteriorment ser comparat amb el emmagatzemat a la base de dades.\r\n\r\n```\r\n<security:authentication-manager>\r\n\t<security:authentication-provider>\r\n                <security:password-encoder hash=\"plaintext\"/>\r\n\t\t<security:jdbc-user-service data-source-ref=\"dataSource\"/>\r\n\t</security:authentication-provider>\r\n</security:authentication-manager>\r\n```\r\n\r\n<div class=\"message warning\">\r\nAccés base de dades\r\n\r\nL'eina de suport al desenvolupament automatitza la instal- lació del mòdul de persistència si aquest no ha estat instal- lat prèviament pel desenvolupador.\r\n</div>\r\n\r\n#### Configuració de l'Autorització per LDAP\r\n\r\nPer a configurar l'acces a LDAP és necessari:\r\n\r\n* Configurar l'arxiu de propietats security.properties.\r\n* Conigurar el proveidor de seguretat dins de la configuració de seguretat de Spring.\r\n\r\nEls dos arxius es generen i configuren de manera automàtica mitjançant l'eina de desenvolupament.\r\n\r\nLes propietats de l'arxiu security.properties son les següents:\r\n\r\nPropietat                           | Requerit | Descripció\r\n----------------------------------- | -------- | -----------------------------------------------------------------------\r\n*.security.ldap.url                 | Si       | Direcció del servidor ldap separat amb dos punts \":\" del port\r\n*.security.ldap.manager.dn          | Sí       | Identificador de l'usuari administrador del LDAP\r\n*.security.ldap.manager.password    | Si       | Password del l'usuari administrador del LDAP\r\n*.security.ldap.user.search.filter  | No       | Filtre de cerca dels usuaris dintre de l'estructura del LDAP. Per defecte: (uid={0})\r\n*.security.ldap.user.search.base    | Si       | String base de la ubicació dels usuaris dintre de l'estructura del LDAP\r\n*.security.ldap.group.search.base   | Si       | String base de la ubicació dels grups dintre de l'estructura del LDAP\r\n*.security.ldap.group.search.filter | No       | Filtre de cerca dels grups dintre de l'estructura del LDAP. Per defecte: (cn={0})\r\n\r\nPer a realitzar les proves en desenvolupament podem instal- lar un servidor LDAP senzill (veure l'apartat 'Eines de Suport' per a més referència).\r\n\r\nConfiguració del provider en **app-custom-security.xml**:\r\n\r\n* Afegim el provider al authentication manager.\r\n* Afegim la connexió al LDAP server\r\n\r\n```\r\n<security:authentication-manager>\r\n    <security:ldap-authentication-provider\r\n        server-ref=\"ldapLocal\"\r\n        user-search-filter=\"${security.ldap.user.search.filter:(uid={0})}\"\r\n        user-search-base=\"${security.ldap.user.search.base}\"\r\n        group-search-base=\"${security.ldap.group.search.base}\"\r\n        group-search-filter=\"${security.ldap.group.search.filter:(cn={0})}\">\r\n\r\n        <security:password-compare/>\r\n    </security:ldap-authentication-provider>\r\n</security:authentication-manager>\r\n\r\n<security:ldap-server url=\"${security.ldap.url}\" id=\"ldapLocal\" manager-dn=\"${security.ldap.manager.dn}\"\r\nmanager-password=\"${security.ldap.manager.password}\"/>\r\n```\r\n\r\n#### Configuració de l'Autorització per arxiu de propietats\r\n\r\nAquest proveidor de seguretat es recolça en un arxiu de propietats per carregar en memòria els usuaris/password/rols de l'aplicació.\r\n\r\nPer a configurar l'acces mitjançant un arxiu de propietats és necessari:\r\n\r\n* Configurar l'arxiu de propietats **security.users.properties**.\r\n* Conigurar el proveidor de seguretat dins de la configuració de seguretat de Spring (**app-custom-security.xml**).\r\n\r\nL'arxiu que conté aquesta configuració **security.users.properties** te el següent format:\r\n\r\n    username=password,grantedAuthority[,grantedAuthority][,enabled|disabled]\r\n\r\nExemple de configuració:\r\n\r\n```\r\nuser=password,ROLE_USER,enabled\r\nadmin=password,ROLE_USER,ROLE_ADMIN,enabled\r\n```\r\n\r\n#### Configuració del provider en **app-custom-security.xml**:\r\n\r\n* Afegim el provider al authentication manager.\r\n* Afegim el tipus de codificador de password per tal de comparar el password de l'arxiu de propietats i el que ens ha proporcionat l'usuari de l'aplicació. Aquest codificador suporta: plaintext, sha, sha-256, md5, md4, ssha.\r\n\r\n```\r\n<security:authentication-manager>\r\n\t<security:authentication-provider>\r\n\t\t<security:password-encoder hash=\"plaintext\"/>\r\n\t\t<security:user-service properties=\"classpath:/config/props/security.users.properties\"/>\r\n\t</security:authentication-provider>\r\n</security:authentication-manager>\r\n```\r\n\r\n#### Configuració de la Font d'Autorització per GICAR\r\n\r\nPer a configurar l'accés a GICAR és necessari:\r\n\r\n* Configurar l'arxiu de propietats **security.properties**.\r\n* Configurar el proveidor de seguretat dins de la configuració de seguretat de Spring.\r\n\r\nEls dos arxius es generen i configuren de manera automàtica mitjançant l'eina de desenvolupament:\r\n\r\nLes propietats de l'arxiu **security.properties** son les següents:\r\n\r\nPer a configurar l'acces a GICAR és necessari configurar l'arxiu de propietats **security.properties**. Aquest arxiu es genera automàticament des de l'eina de suport, i té el següent format:\r\n\r\nPropietat                                   | Requerit | Descripció\r\n------------------------------------------- | -------- | -----------------------------------\r\n*.security.gicar.httpGicarHeaderUsernameKey | No       | Aquesta propietat indica quin és el camp de la capçalera HTTP_GICAR que conté el nom de l'usuari autenticat a GICAR. Per defecte: NIF\r\n\r\nDes de la versió 1.2.7 el servei de seguretat de Canigó suporta de manera automàtica la capçalera `HTTP_GICAR_PSIS` per autenticació amb certificats per usuaris que no estan en el DC (Autenticació Anònima), utilitzant-se com a font de dades alternativa per a tasques d'autententicació.\r\nA la pàgina del [Servei d'autenticació anònima amb GICAR](https://canigo.ctti.gencat.cat/gicar-integracio/auth-anonima/) es pot trobar informació detallada d'aquesta capçalera.\r\n\r\nA continuació es mostra la classe SecurityConfig per a una configuració basada en GICAR sense utilitzar JWT com a sistema d'autenticació.\r\n\r\n```\r\npublic class SecurityConfig extends WebSecurityConfigurerAdapter {\r\n\r\n\t@Autowired\r\n\tprivate AuthenticationEntryPoint restAuthenticationEntryPoint;\r\n\r\n\t@Autowired\r\n\tprivate PropertiesConfiguration propertiesConfiguration;\r\n\r\n\t@Autowired\r\n\t@Lazy\r\n\tprivate AuthenticationManager authenticationManager;\r\n\t\r\n\t@Autowired\r\n\t@Lazy\r\n\tprivate AuthenticationSuccessHandler restAuthenticationSuccessHandler;\r\n\r\n\t@Autowired\r\n\t@Lazy\r\n\tprivate DataSource dataSource;\r\n\r\n\t@Override\r\n\tprotected void configure(final HttpSecurity http) throws Exception {\r\n\r\n\t\thttp.authorizeRequests().antMatchers(\"/api/auth\").permitAll().antMatchers(\"/images/*/**\", \"/css/*/**\", \"/js/*/**\", \"/fonts/*/**\").permitAll()\r\n\t\t\t\t.antMatchers(\"/api/info/properties\", \"/api/info/modules\").hasRole(\"ADMIN\").antMatchers(\"/api/equipaments/**\").hasRole(\"USER\");\r\n        http.exceptionHandling().authenticationEntryPoint(restAuthenticationEntryPoint);\r\n\t\thttp.addFilterBefore(proxyUsernamePasswordAuthenticationFilter(), UsernamePasswordAuthenticationFilter.class);\r\n\t\t\r\n\t}\r\n\t\r\n\t@Override\r\n\t@Autowired\r\n\tprotected void configure(final AuthenticationManagerBuilder auth) throws Exception {\r\n\t\tauth.authenticationProvider(gicarProvider());\r\n\t}\r\n\r\n\t@Bean\r\n\t@Autowired\r\n\tpublic ProxyUsernamePasswordAuthenticationFilter proxyUsernamePasswordAuthenticationFilter() {\r\n\t\tfinal ProxyUsernamePasswordAuthenticationFilter proxyUsernamePasswordAuthenticationFilter = new ProxyUsernamePasswordAuthenticationFilter(\"/api/login\",\r\n\t\t\t\tRequestMethod.POST.toString());\r\n\t\tproxyUsernamePasswordAuthenticationFilter.setSiteminderAuthentication(true);\r\n\t\tproxyUsernamePasswordAuthenticationFilter.setAuthenticationManager(authenticationManager);\r\n\t\tproxyUsernamePasswordAuthenticationFilter.setAuthenticationSuccessHandler(restAuthenticationSuccessHandler);\r\n\t\treturn proxyUsernamePasswordAuthenticationFilter;\r\n\t}\r\n\r\n\t@Bean\r\n\tpublic AuthenticationProvider gicarProvider() {\r\n\t\tfinal SiteminderAuthenticationProvider siteminderAuthenticationProvider = new SiteminderAuthenticationProvider();\r\n\t\tsiteminderAuthenticationProvider.setUserDetailsService(gicarUserDetailsService());\r\n\t\treturn siteminderAuthenticationProvider;\r\n\t}\r\n\r\n\t@Bean\r\n\t@Primary\r\n\tpublic UserDetailsService gicarUserDetailsService() {\r\n\t\tfinal GICARUserDetailsServiceImpl gicarUserDetailsService = new GICARUserDetailsServiceImpl();\r\n\t\tgicarUserDetailsService.setHttpGicarHeaderUsernameKey(getHttpGicarHeaderUsernameKey());\r\n\t\tgicarUserDetailsService.setAuthoritiesDAO(authoritiesDAO());\r\n\t\treturn gicarUserDetailsService;\r\n\t}\r\n\r\n\t@Bean\r\n\tpublic AuthoritiesDAO authoritiesDAO() {\r\n\t\tfinal AuthoritiesDAOImpl authoritiesDAOImpl = new AuthoritiesDAOImpl();\r\n\t\tauthoritiesDAOImpl.setDataSource(dataSource);\r\n\t\treturn authoritiesDAOImpl;\r\n\t}\r\n\r\n\t\r\n\r\n\t@Bean\r\n\t@Autowired\r\n\tpublic AuthenticationManager authenticationManager(final AuthenticationManagerBuilder auth) {\r\n\t\treturn auth.getOrBuild();\r\n\t}\r\n\r\n    private String getHttpGicarHeaderUsernameKey() {\r\n\t\tfinal String gicarHeader = propertiesConfiguration.getProperty(\"security.gicar.httpGicarHeaderUsernameKey\");\r\n\t\treturn gicarHeader != null ? gicarHeader : \"NIF\";\r\n\t}\r\n}\r\n\r\n```\r\n\r\nAmb aquesta configuració ha de ser possible autoritzar un usuari que prèviament ha estat auntenticat en el servei de GICAR. Per aquest motiu és necessari rebre certes dades referents a aquesta autenticació ja realitzada. A la capçalera HTML podrem accedir a aquestes dades:\r\n\r\n```\r\nHTTP_GICAR=CODIINTERN=NRDRJN0001;NIF=11112222W;EMAIL=mail.admin@gencat.net;UNITAT_MAJOR=CTTI;\r\nUNITAT_MENOR=CTTI Qualitat\r\n```\r\n\r\nOn CODIINTERN és el codi intern, el NIF el NIF, EMAIL l'adreça de correu electrònic registrada al Director Corporatiu, UNITAT_MAJOR és l'organització i UNITAT_MENOR és la unitat.\r\n\r\n<div class=\"message warning\">\r\nEn cas de que l'aplicació utilitzi la separació entre codi estàtic i dinàmic és necessari indicar la següent propietat dintre del bean proxyUsernamePasswordAuthenticationFilter:\r\n<br><br>\r\n\r\n<b>&lt;property name=\"filterProcessesUrl\" value=\"/AppJava/j_spring_security_check\" /&gt;</b>\r\n\r\n</div>\r\n\r\n**Logout**\r\n\r\nPer tots els mètodes d'autenticació, el procediment de logoff consisteix en invalidar la sessió, forçant així que el servei de seguretat intervingui en la següent petició solicitant la nova identificació de l'usuari.\r\n\r\nEn el cas de GICAR, però, aquesta autenticació és realitzada per un sistema extern a l'aplicació i, per tant, s'ha de comunicar a aquest sistema extern la intenció de fer el logoff. El mecanisme previst per fer-ho consisteix en una URL de Gicar que, al ser invocada, realitza el logoff.\r\n\r\nAquest enllaç de logout és depenent de l'agent de SiteMinder que l'aplicació fa servir per a comunicar-se amb el Policy Server.\r\n\r\nAixí doncs, els enllaços de logout són els següents:\r\n\r\n* Per a una aplicació ubicada en els apaches corporatius de internet: http://sso.gencat.cat/siteminderagent/forms/logoff.html\r\n* Per a una aplicació ubicada en els apaches corporatius de intranet: http://sso.gencat.intranet/siteminderagent/forms/logoff.html\r\n* Per a una aplicació amb apache \"pròpi\": http://****.gencat.***/siteminderagent/forms/logoff.html;\r\n\r\n## Eines de Suport\r\n\r\n### Servidor LDAP de proves: openLDAP\r\n\r\nEls diferents passos per a instal- lar openLDAP i importar un directori LDAP d'exemple són:\r\n\r\n* Baixar openLDAP per a Windows http://sourceforge.net/projects/openldapwindows/ i instal- lar-ho.\r\n* Canviar la configuració per defecte de openldap. Copiar les dades següents en un fitxer slapd.conf. Copiarem el slapd.conf en la mateixa carpeta que openLDAP.\r\n\r\n```\r\n#######################################################################\r\n# See slapd.conf(5) for details on configuration options.\r\n# This file should NOT be world readable.\r\n#######################################################################\r\nucdata-path ./ucdata\r\ninclude ./etc/schema/core.schema\r\ninclude ./etc/schema/cosine.schema\r\ninclude ./etc/schema/inetorgperson.schema\r\n\r\n# Define global ACLs to disable default read access.\r\n\r\n# Do not enable referrals until AFTER you have a working directory\r\n# service AND an understanding of referrals.\r\n#referral ldap://root.openldap.org\r\n\r\npidfile ./var/run/slapd.pid\r\nargsfile ./var/run/slapd.args\r\n\r\n#######################################################################\r\n# BDB database definitions\r\n#######################################################################\r\n\r\n###database bdb\r\n###suffix \"dc=my-domain,dc=com\"\r\n###rootdn \"cn=Manager,dc=my-domain,dc=com\"\r\n\r\ndatabase bdb\r\nsuffix dc=\"mycompany\",dc=\"com\"\r\nrootdn \"cn=Manager,dc=mycompany,dc=com\"\r\n\r\nrootpw secret\r\nEines de Suport\r\n\r\ndirectory ./var/openldap-data\r\nindex objectClass eq\r\n```\r\n\r\n* Obrir una pantalla \"DOS command\", anar a la carpeta on hem instal- lat el programa i arrancar openLDAP amb la comanda\r\n\r\n```\r\n.\\slapd -d 1\r\n```\r\n\r\nSi tot ha funcionat bé, hauríem de veure una sortida com la següent:  \r\n    \r\n![Execució Open LDAP](/related/canigo/documentacio/modul-seguretat/ServeiSeguretat_img012.jpg.gif)\r\n\r\n* Copiar les dades següents en un fitxer setup.ldif. Aquest fitxer conté un directori LDAP de l'empresa \"mycompany.com\" amb 2 persones: \"gestoruser\" i \"usuari\". Copiarem el setup.ldif en la mateixa carpeta que openLDAP.\r\n\r\n```\r\n### Top level definition\r\n#dn: dc=mycompany,dc=com\r\n#objectClass: top\r\n#objectClass: dcObject\r\n#objectClass: domain\r\n#dc: mycompany\r\n\r\n### organizationalUnit : PEOPLE\r\n# Definition of people\r\ndn: ou=people,dc=mycompany,dc=com\r\nobjectClass: top\r\nobjectClass: organizationalUnit\r\nou: people\r\n\r\n# Gestor User\r\ndn: uid=gestoruser,ou=people,dc=mycompany,dc=com\r\nobjectClass: person\r\nobjectClass: inetOrgPerson\r\ncn: State App\r\ndisplayName: App Admin\r\ngivenName: App\r\nmail: gestor@fake.org\r\ntitle: ROLE_ADMIN\r\nsn: Gestor\r\nuid: gestoruser\r\nuserPassword: gestorpassword\r\n\r\n# usuario normal\r\ndn: uid=usuario,ou=people,dc=mycompany,dc=com\r\nobjectClass: person\r\nobjectClass: inetOrgPerson\r\ncn: State App\r\ndisplayName: App Admin\r\ngivenName: App\r\nmail: usuario@fake.org\r\ntitle: ROLE_USER\r\nsn: Usuario\r\nuid: usuario\r\nuserPassword: usuariopassword\r\n```\r\n\r\nObrir una altra pantalla \"DOS command\", anar a la carpeta on hem instal- lat el programa i importar les dades amb la comanda:\r\n\r\n```\r\nldapadd -x -D \"cn=Manager,dc=mycompany,dc=com\" -W -f setup.ldif\r\n```\r\n\r\nLa contrasenya per defecte és \"secret\".\r\n\r\n### Jxplorer\r\n\r\nComprovarem que la importació de dades ha funcionat amb Jxplorer, un client LDAP Java i opensource.\r\n\r\n* Baixar Jxplorer a la url http://sourceforge.net/projects/jxplorer/ i instal- lar-ho\r\n* Prémer el botó per a connectar-se al nostre directori LDAP.\r\n\r\nLa contrasenya per defecte és \"secret\". La pantalla següent mostra els valors de la diferents paràmetres:\r\n\r\n![Configuració paràmetres JXplorer](/related/canigo/documentacio/modul-seguretat/ServeiSeguretat_img013.jpg.gif)\r\n\r\nSi tot ha funcionat bé, hauríem de veure la pantalla següent:\r\n\r\n![Resultat JXplorer](/related/canigo/documentacio/modul-seguretat/ServeiSeguretat_img014.jpg.gif)\r\n\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1zZWd1cmV0YXQ="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1wYWRybw==":{"date":1426843687000,"title":"Padró","description":"Serveis d'empadronament publicats de la plataforma PICA.","sections":"Canigó. Documentació versió 3.x","weight":9,"path":"/canigo-documentacio-versions-3x-integracio/modul-padro","content":"## Introducció\r\n\r\nL'objectiu d'aquest connector, és el de proporcionar un punt d'accés utilitzant la plataforma PICA cap serveis d'empadronament publicats en aquesta plataforma.\r\n\r\n### Propòsit\r\n\r\nEl propòsit del connector és proporcionar una interfície funcional reduïda al connector de la Pica que simplifica l'utilització dels diferents serveis d'empadronament oferts per la generalitat.\r\n\r\n### Context i Escenaris d'ús\r\n\r\nEl connector PICA-PADRO es troba dins els connectors de serveis funcionals de la Generalitat.\r\n\r\n### A qui va dirigit\r\n\r\nAquest document va dirigit als següents perfils:\r\n\r\n* Programador. Per conèixer l'ús del connector.\r\n* Arquitecte. Per conèixer quins són els components i la configuració del connector.\r\n\r\n## Descripció Detallada\r\n\r\nAquest connector permet utilitzar els diferents serveis del PADRO a través de l'accés a través d'una API de les següents modalitats de consum:\r\n\r\nServeis Síncrons\r\n\r\n* PADRO_COMPROVACIO_CONVIVENTS\r\n* PADRO_DADES_CONVIVENTS_PDF\r\n* PADRO_DADES_CONVIVENTS\r\n* PADRO_DADES_TITULAR\r\n* PADRO_DADES_TITULAR_INE\r\n* PADRO_DADES_TITULAR_PDF\r\n* PADRO_MUNICIPI_RESIDENCIA\r\n* PADRO_NUMERO_CONVIVENTS\r\n* PADRO_RESIDENT\r\n* PADRO_RESIDENT_MUNICIPI\r\n* PADRO_VALIDACIO_CONVIVENTS\r\n\r\nServeis Asíncrons\r\n\r\n* PADRO_TITULAR_CERCA\r\n\r\n## Arquitectura i Components\r\n\r\n### Interfícies i Components Genèrics\r\n\r\nEs pot trobar el codi font referent aquests components a la següent url:\r\n\r\nCodi Font:  https://sic.ctti.extranet.gencat.cat/nexus/content/groups/canigo-group-maven2/cat/gencat/ctti/canigo.integration.padro.pica/\r\n\r\n### Requeriments\r\n\r\nEl connector PADRO és compatible amb les versions 1.5 o superior de Java. Per versions inferiors no es garantit el seu correcte funcionament.\r\n\r\nPer tal de que el connector PADRO funcioni correctament sobre l'aplicació que l'utilitzi, s'ha de tenir configurat el servei [connector genèric de la PICA](/canigo-documentacio-versions-3x-integracio/modul-pica/) 1.2.0.\r\n\r\n## Configuració\r\n\r\nPer configurar el mòdul d'integració PICA-PADRO és necessari configurar els següents arxius:\r\n\r\n1.- Importar el mòdul PICA-PADRO amb el plugin de Canigó 3 de l'eclipse o bé incorporar manualment les seves dependències en el pom.xml de l'aplicació.\r\n\r\nEn el pom.xml:\r\n\r\n```\r\n<canigo.integration.padro.pica.version>[1.2.0,1.3.0)</canigo.integration.padro.pica.version>\r\n...\r\n\r\n<!-- Dependencia del mòdul PICA-PADRO -->\r\n<dependency>\r\n    <groupId>cat.gencat.ctti</groupId>\r\n    <artifactId>canigo.integration.padro.pica</artifactId>\r\n    <version>${canigo.integration.padro.pica.version}</version>\r\n</dependency>\r\n\r\n```\r\n\r\n2.- Crear l'arxiu /config/props/padro.properties amb el següent contingut:\r\n\r\n```\r\n*.padro.pica.finalitat=[finalitat]\r\n*.padro.pica.urlPica=http://preproduccio.pica.intranet.gencat.cat/pica_cataleg/AppJava/services/\r\n*.padro.pica.nifEmisor=[nifEmisor]\r\n*.padro.pica.nomEmisor=[nomEmisor]\r\n*.padro.pica.nomFuncionari=[nomFuncionari]\r\n*.padro.pica.nifFuncionari=[nifFuncionari]\r\n*.padro.pica.emailFuncionari=[emailFuncionari]\r\n```\r\n\r\nEls valors d finalitat, urlPica, nifEmisor i nomEmisor s'han de consultar a la OT PICA en requeridors.otpica.ctti@gencat.cat\r\n\r\nNOTA: El valor per defecte de urlPica es la de l'entorn de Pre-producció.\r\n\r\n3.- Configurar l'arxiu /config/props/pica.properties amb el següent contingut:\r\n\r\n```\r\n*.pica.modes.passwordType=PasswordText\r\n*.pica.requirer.signatureFile=classpath:config/cert/signature.properties\r\n*.pica.requirer.petitionerId=[petitionerId]\r\n*.pica.requirer.transmitionId=[transmitionId]\r\n*.pica.requirer.petitionerName=[petitionerName]\r\n*.pica.requirer.password=[password]\r\n*.pica.requirer.user=[password]\r\n*.pica.axisdefinition.location=classpath:axis2client/\r\n*.pica.trustStore.location=classpath:config/cert/certificats.jks\r\n*.pica.trustStore.type=JKS\r\n*.pica.trustStore.password=[trustStore.password]\r\n```\r\n\r\nEls valors entre [] s'han de consultar a la OT PICA en requeridors.otpica.ctti@gencat.cat\r\n\r\n4.- Configurar l'arxiu /spring/app-integration-padro.xml amb el següent contingut:\r\n\r\n```\r\n<!-- BEAN DE LA PICA -->\r\n<bean id=\"picaService\" class=\"cat.gencat.ctti.canigo.arch.integration.pica.PicaServiceWrapperImpl\" scope=\"prototype\">\r\n    <property name=\"axisDefinition\" value=\"${pica.axisdefinition.location}\"/>\r\n    <property name=\"trustStoreSSLKeystore\" value=\"${pica.trustStore.location}\" />\r\n    <property name=\"trustStoreSSLKeystoreType\" value=\"${pica.trustStore.type}\" />\r\n    <property name=\"trustStoreSSLKeystorePassword\" value=\"${pica.trustStore.password}\" />\r\n    <property name=\"requeridor\" ref=\"requeridor\"/>\r\n    <property name=\"modalitats\">\r\n        <map>\r\n\r\n        </map>\r\n    </property>\r\n</bean>\r\n```\r\n\r\nLes propietats trustStoreSSLKeystore, trustStoreSSLKesytoreType i trustStoreSSLKeystorePassword només són necessàries en cas d'accedir a la url de la PICA mitjançant HTTPS.\r\n\r\n## Utilització del Connector\r\n \r\n### Exemple d'utilització d'un Servei Síncron\r\n\r\n1.- En el bean on es vulgui disposar dels serveis del connector declarar el servei.\r\n\r\n```java\r\n@Autowired\r\nprivate PadroConnectorImpl padroService;\r\n```\r\n\r\n2.- Escollir una modalitat de servei síncrona i cridar-la amb els paràmetres que necessiti. En aquest cas es mostra un exemple amb la modalitat padroComprovacioConvivents:\r\n\r\n```java\r\nString numExpedient = \"CAT-1234567890ABCDEF\";\r\nint tipusDocumentacio = Constants.NIE;\r\nString documentacio = \"X02649265X\";\r\nString codMun = \"999\";\r\nint numConv = 99;\r\nString codProv = \"1\";\r\nint idesCat = 0;\r\n\r\nRespuestaComprobacionConvivientes resposta = padroService.padroComprovacioConvivents(\r\n    numExpedient,\r\n    tipusDocumentacio,\r\n    documentacio,\r\n    codMun,\r\n    codProv,\r\n    numConv,\r\n    idesCat\r\n);\r\n```\r\n\r\nL'estat de finalització dependrà del codi retornat:\r\n\r\n```java\r\nresposta.getCodigoResultado();\r\n```\r\n\r\nPer consultar la totalitat de possibles codis de retorn i el detall exacte dels objectes retornats consultar el document de la PICA Guia d'us del servei de **PADRO v1.5x.pdf** disponible via petició a requeridors.otpica.ctti@gencat.cat\r\n\r\n### Exemple d'utilització d'un Servei Asíncron\r\n\r\n1.- L'únic servei asíncron que ofereix el servei de PADRO és el PADRO_TITULAR_CERCA. Per poder utilitzar aquesta modalitat de consum el connector de Canigó 3 preveu tres mètodes diferents:\r\n\r\n```java\r\npublic RespostaCercaTitular  padroTitularCerca(String numExpedient, int tipusDocumentacio, String documentacio) throws PadroException;\r\npublic EstatAsincron getEstatPadroTitularCerca(CridaAsincronaResponseDocument response) throws PadroException;\r\npublic RespostaCercaTitular getDadesPadroTitularCerca(IPICAServiceAsincron servei) throws PadroException;\r\n```\r\n\r\n2.- El primer serveix per carregar les dades de la consulta al servei i fer la primera petició. Donat que és un servei asíncron retorna un objecte amb l'estat actual de la petició i el temps estimat de finalització d'aquesta.\r\n\r\nIgual que en les peticions asíncrones s'inicialitza el bean del servei del connector;\r\n\r\n```java\r\n@Autowired\r\nprivate PadroConnectorImpl padroService;\r\n```\r\n\r\nEs crida al servei amb les dades pertinents:\r\n\r\n```java\r\nString numExpedient = \"123456\";\r\nint tipusDocumentacio = Constants.NIF;\r\nString documentacio = \"46583836G\";\r\n\r\nRespostaCercaTitular resposta = padroConnector.padroTitularCerca(numExpedient, tipusDocumentacio, documentacio);\r\n```\r\n\r\n3.- El segon serveix per anar comprovant l'estat de la consulta de forma periòdica. Igual que el primer mètode retorna un objecte amb l'estat actual de la petició i el temps estimat per la seva resolució.\r\n\r\n```java\r\nEstatAsincron estat = padroConnector.getEstatPadroTitularCerca(resposta.getResponse());\r\n```\r\n\r\n4.- Finalment el tercer mètode recupera el resultat de la peticó una vegada confirmat que la petició ha finalitzat.\r\n\r\n```java\r\nRespostaCercaTitular dades = padroConnector.getDadesPadroTitularCerca(resposta.getServei());\r\n```\r\n\r\nPer consultar la totalitat de possibles codis de retorn i el detall exacte dels objectes retornats consultar el document de la PICA **Guia d'us del servei de PADRO v1.5x.pdf** disponible via petició a requeridors.otpica.ctti@gencat.cat\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1wYWRybw=="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1wc2dk":{"date":1553185518000,"title":"ARESTA (PSGD)","description":"Plataforma de Serveis de Gestió Documental","sections":"Canigó. Documentació versió 3.x","weight":17,"path":"/canigo-documentacio-versions-3x-integracio/modul-psgd","content":"## Introducció\r\n\r\nL'objectiu d'aquest connector és proporcionar un punt d'accés cap a la Plataforma de Serveis de Gestió Documental (PSGD) també coneguda com a ARESTA.\r\n\r\n## Propòsit\r\n\r\nEl propòsit del connector és proporcionar una interfície funcional que faciliti a les aplicacions l'ús de la PSGD.\r\n\r\n## Context i Escenaris d'ús\r\n\r\nEl connector PSGD es troba dins els connectors de serveis funcionals de la Generalitat.\r\n\r\n## A qui va dirigit\r\n\r\nAquest document va dirigit als següents perfils:\r\n\r\n* Programador. Per conèixer l'ús del connector.\r\n* Arquitecte. Per conèixer quins són els components i la configuració del connector.\r\n\r\n## Documents i Fonts de Referència\r\n\r\n| Nom Document\r\n| ----------\r\n| [PSGD Manual Integració](/related/canigo/documentacio/modul-psgd/PSGD_Manual_Integració_v6.0.pdf).\r\n\r\n## Descripció Detallada\r\n\r\nAquest connector permet realitzar les següents accions:\r\n\r\n**Funcionalitats de Documents**\r\n\r\n* **Alta Document:** Alta d’un nou document en el sistema.\r\n* **Baixa Document:** Baixa lògica d’un document del sistema.\r\n* **Check-Out Document:** Marcatge d’un document com a no modificable per estar en possessió d’un determinat usuari i obtenció del document i les seves signatures.\r\n* **Check-In Document:** Substitució d’un document existent en el sistema per un de nou i marcatge com a document modificable, amb les seves signatures associades, si s’escau\r\n* **Editar Metadades Document:** Modificació de les metadades d’un document del sistema.\r\n* **Obtenir Document:** Obtenció d’un document existent en el sistema i els identificadors únics de les seves versions prèvies.\r\n* **Cercar Documents:** Cerca de documents en funció de les seves metadades i contingut.\r\n\r\n\r\n**Funcionalitats d'Expedients**\r\n\r\n* **Alta Expedient:** Alta d’un nou expedient en el sistema.\r\n* **Baixa Expedient:** Baixa d’un expedient del sistema.\r\n* **Assignar Document:** Assignar un document existent en el sistema a un expedient existent en el sistema.\r\n* **Eliminar Assignació Document:** Eliminar l’assignació d’un document a un expedient.\r\n* **Tancar Expedient:** Tancar un expedient existent en el sistema i generar el foliat.\r\n* **Generar Foliat Parcial:** Generar un document foliat parcial d’un expedient.\r\n\r\n\r\n**Funcionalitats de llistats**\r\n\r\n* **Llista de Tipus Documentals:** Llistar els diferents tipus documentals suportats pel sistema.\r\n* **Llista de Productors:** Llistar els productors de documents.\r\n\r\n\r\n**Funcionalitats de sèries documentals**\r\n\r\n* **Alta/Modificació Sèries Documentals:** Alta d’una nova sèrie documental o modificació d’una existent.\r\n\r\n\r\n## Arquitectura i Components\r\n\r\n### Interfícies i Components Genèrics\r\n\r\nEs pot trobar el codi font i binaris referent a aquest component a la següent url:\r\n\r\nhttp://repos.canigo.ctti.gencat.cat/repository/maven2/cat/gencat/ctti/canigo.integration.psgd/\r\n\r\n### Requeriments\r\n\r\nEl connector PSGD és compatible amb les versions 1.6 o superior de Java. Per versions inferiors no es garantit el seu correcte funcionament.\r\n\r\n## Configuració\r\n\r\nPer configurar el mòdul d'integració PSGD és necessari configurar els següents arxius:\r\n\r\n1.- Importar el mòdul psgd incorporant manualment les seves dependències en el pom.xml de l'aplicació.\r\n\r\nEn el pom.xml;\r\n\r\n```\r\n<canigo.integration.psgd.version>[2.0.1,2.1.0)</canigo.integration.psgd.version>\r\n...\r\n\r\n<!-- Dependencia del mòdul PSGD -->\r\n<dependency>\r\n    <groupId>cat.gencat.ctti</groupId>\r\n    <artifactId>canigo.integration.psgd</artifactId>\r\n    <version>${canigo.integration.psgd.version}</version>\r\n</dependency>\r\n```\r\n\r\n2.- Crear l'arxiu /config/props/psgd.properties amb el següent contingut:\r\n\r\n```\r\n*.psgd.usuari=[usuariPSGD]\r\n*.psgd.password=[passwordPSGD]\r\n*.psgd.url=[urlPSGD]\r\n*.psgd.keystore=[path keystore]\r\n*.psgd.keystore.password=[password keystore]\r\n*.psgd.truststore=[path truststore]\r\n*.psgd.truststore.password=[password truststore]\r\n```\r\n\r\nL’usuari i password per donar d’alta l’aplicació al PSGD s’ha de demanar al gestor del projecte per part de CTTI.\r\n\r\nLa url d'accés dependrà si es vol treballar amb l'entorn de Preproducció (https://preproduccio.gestordocumental.intranet.gencat.cat) o Producció (https://gestordocumental.intranet.gencat.cat).\r\n\r\nEls certificats necessaris per accedir a la url de PSGD s'han de demanar al gestor del projecte per part de CTTI.\r\n\r\nHi ha tres opcions per indicar a l'aplicació on es troba els certificats necessaris:\r\n\r\n* Omplir els valors  referents al keystore/truststore on s'ha incorporat el certificat. S'ha d'indicar si el path pertany al classpath o al sistema de fitxer. Per exemple:\r\n\r\n```\r\n*.psgd.keystore=classpath*:data/psgdKeystore\r\n\r\no\r\n\r\n*.psgd.keystore=file:/aqd/psgd/psgdKeystore\r\n```\r\n\r\n* Deixar sense valor les variables keystore i truststore. L'aplicació utilitzarà el cacerts que tingui configurat JVM. (Per a que funcioni s'ha d'afegir els certificats al cacerts)\r\n\r\n* Deixar sense valor les variables keystore i truststore i indicar el path del keystore a la JVM quan s'inicia l'aplicació amb el següent paràmetre:\r\n\r\n```\r\njavax.net.ssl.trustStore=/aqd/psgd/psgdKeystore\r\n```\r\n\r\n## Utilització del Connector\r\n\r\n### Exemple d'utilització Alta de Document\r\n\r\nRecuperar el bean del servei de PSGD des de la classe on es vol utilitzar:\r\n\r\n```java\r\n@Autowired\r\nprivate PsgdConnectorImpl psgdConnector;\r\n```\r\n\r\nFer la crida a la modalitat del servei desitjat, p.e.:\r\n\r\n```java\r\n\r\n Document document = new Document();\r\n\r\n DocumentMetaData documentMetaData = new DocumentMetaData();\r\n\r\n documentMetaData.setDocumentName(\"prova.txt\");\r\n documentMetaData.setDocumentTypeCode(\"TD01-010\");\r\n documentMetaData.setTitle(\"Prova\");\r\n documentMetaData.setCreatorID(\"canigo\");\r\n documentMetaData.setDocumentDescriptor(\"descriptor\");\r\n documentMetaData.setOrigin(\"0\");\r\n\r\n InputStream documentData = new FileInputStream(\"pathfitxer\")\r\n\r\n document.setDocumentMetaData(documentMetaData);\r\n\r\n CreateDocumentResponse result = psgdConnector.altaDocument(document, documentData);\r\n\r\n```\r\n El objecte de resposta CreateDocumentResponse retorna el ID del document creat.\r\n\r\n```java\r\n String documentID = result.getResult().getResultData().getDocumentCreated().getDocumentID();\r\n```\r\n\r\n* En cas de que retorni error es pot consultar el code i la descripció de la següent manera:\r\n\r\n```java\r\n String code = result.getResult().getCode();\r\n String descripcio = result.getResult().getDescription();\r\n String descExtended = result.getResult().getExtendedDescription();\r\n```\r\n\r\n### Exemple d'utilització Obtenir Documents\r\n\r\nRecuperar el bean del servei de PSGD des de la classe on es vol utilitzar:\r\n\r\n```java\r\n@Autowired\r\nprivate PsgdConnectorImpl psgdConnector;\r\n```\r\n\r\nFer la crida a la modalitat del servei desitjat, p.e.:\r\n\r\n```java\r\nDocumentGetContentData document = new DocumentGetContentData();\r\n\r\ndocument.setDocumentID(\"478fbefa-4de5-49c7-881c-1b2e1d1a8535\");\r\ndocument.setReaderID(\"canigo\");\r\n\r\nDocumentResponse result = psgdConnector.descarregarDocument(document);\r\n\r\n```\r\n\r\n El objecte de resposta DocumentResponse retorna el ID, nom, tipus i mida del document demanat. Així com el document en un ByteArrayOutputStream.\r\n\r\n En cas de voler desar el document demanat a disc es podria fer de la següent manera.\r\n\r\n```java\r\nOutputStream outputStream = new FileOutputStream (\"givefilename\");\r\nresult.getResult().getResultData().getData().writeTo(outputStream);\r\n```\r\n\r\n* En cas de que retorni error es pot consultar el code i la descripció de la següent manera:\r\n\r\n```java\r\n String code = result.getResult().getCode();\r\n String descripcio = result.getResult().getDescription();\r\n String descExtended = result.getResult().getExtendedDescription();\r\n```\r\n\r\nPer consultar la totalitat de possibles codis de retorn consultar el document [PSGD Manual Integració](/related/canigo/documentacio/modul-psgd/PSGD_Manual_Integració_v5.3.pdf).\r\n\r\n## Logs\r\n\r\nSi es vol conéixer la petició JSON que s'està enviant i el JSON que s'està rebent es pot fer a través dels logs.\r\n\r\nAl fitxer Log4j.xml s'ha de posar a debug la classe: cat.gencat.ctti.canigo.arch.integration.psgd.utils.LoggingRequestInterceptor\r\n\r\n```xml\r\n<category name=\"cat.gencat.ctti.canigo.arch.integration.psgd.utils\">\r\n\t<level value=\"debug\"/>\r\n</category>\r\n```\r\n\r\nUn exemple de sortida dels logs:\r\n\r\n```\r\ncanigo Message: DEBUG [main] cat.gencat.ctti.canigo.arch.integration.psgd.utils.LoggingRequestInterceptor - ===========================request begin================================================\r\ncanigo Message: DEBUG [main] cat.gencat.ctti.canigo.arch.integration.psgd.utils.LoggingRequestInterceptor - URI : https://preproduccio.gestordocumental.intranet.gencat.cat/service/extendedServices/search/documents\r\ncanigo Message: DEBUG [main] cat.gencat.ctti.canigo.arch.integration.psgd.utils.LoggingRequestInterceptor - Method : POST\r\ncanigo Message: DEBUG [main] cat.gencat.ctti.canigo.arch.integration.psgd.utils.LoggingRequestInterceptor - Request Body : {\"Token\":\"TICKET_fadafc82507d6158937cd2d5a63e667a5d471f0e\",\"Request\":\"SearchDocuments\",\"RequestData\":{\"DocumentSearchCriteria\":{\"DocumentID\":\"476bf6a5-b9ba-4a2f-86c1-665277b31ea0\",\"DocumentDescriptor\":\"a\",\"FolderSetName\":\"C0001\",\"FolderNumber\":\"1\",\"FolderYear\":\"2016\",\"Title\":\"prova\",\"InputRegistryID\":\"1\",\"OutputRegistryID\":\"1\",\"DocumentDateBefore\":\"24/02/2016\",\"DocumentDateAfter\":\"15/02/2016\",\"DocumentTypeName\":\"TD10-010\",\"Text\":\"Mitja\"}}}\r\ncanigo Message: DEBUG [main] cat.gencat.ctti.canigo.arch.integration.psgd.utils.LoggingRequestInterceptor - ==========================request end================================================\r\ncanigo Message: DEBUG [main] cat.gencat.ctti.canigo.arch.integration.psgd.utils.LoggingRequestInterceptor - ============================response begin==========================================\r\ncanigo Message: DEBUG [main] cat.gencat.ctti.canigo.arch.integration.psgd.utils.LoggingRequestInterceptor - status code: 200\r\ncanigo Message: DEBUG [main] cat.gencat.ctti.canigo.arch.integration.psgd.utils.LoggingRequestInterceptor - status text: OK\r\ncanigo Message: DEBUG [main] cat.gencat.ctti.canigo.arch.integration.psgd.utils.LoggingRequestInterceptor - Response Body : {\"Result\":{\"Code\":\"OK\",\"Description\":\"Successful\",\"ResultData\":{\"SearchDocumentsResults\":{\"Found\":\"1\",\"Documents\":[{\"Document\":{\"DocumentMetaData\":{\"DocumentID\":\"476bf6a5-b9ba-4a2f-86c1-665277b31ea0\",\"DocumentName\":\"prova.docx\",\"DocumentTypeName\":\"TD10-010\",\"DocumentDepartmentUnitID\":\"CTT\",\"Title\":\"Prova\",\"OrganName\":\"Organ\",\"CreatorID\":\"canigo\",\"CreationDate\":\"17/02/2016 14:57:09\",\"Signed\":false,\"OwnerID\":\"canigo\",\"ReaderID\":\"canigo\",\"ReadDate\":\"19/02/2016 13:36:14\",\"BinderID\":\"canigo\",\"BindingDate\":\"23/02/2016 09:58:59\",\"UnbinderID\":\"canigo\",\"UnbindingDate\":\"23/02/2016 09:48:19\",\"BindingFolderID\":\"22e77806-349f-4440-a534-cfd6c9ffeeb8\",\"Folders:\":[{\"FolderID\":\"22e77806-349f-4440-a534-cfd6c9ffeeb8\",\"FolderSetName\":\"C0001\",\"FolderNumber\":\"1\",\"FolderYear\":2016,\"OrganName\":\"CTT\",\"OrganCode\":\"CTT\"}]}}}]}}}}\r\ncanigo Message: DEBUG [main] cat.gencat.ctti.canigo.arch.integration.psgd.utils.LoggingRequestInterceptor - =======================response end=================================================\r\n```\r\n\r\nEs recomana no possar el log a nivell de Debug per a Producció.\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1wc2dk"},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1zYXA=":{"date":1426760726000,"title":"SAP","description":"Interficie d'accés als Backends SAP de la Generalitat.","sections":"Canigó. Documentació versió 3.x","weight":12,"path":"/canigo-documentacio-versions-3x-integracio/modul-sap","content":"## Propòsit\r\n\r\nEl propòsit del connector és proporcionar una interfície simplificada per accedir a backends SAP de la Generalitat.\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer poder utilitzar el connector haurem de configurar el projecte perquè inclogui dues llibreries dll i diferents jars:\r\n\r\nLes llibreries són sapjcorfc.dll i librfc32.dll i s'han de copiar al directori system32.\r\n\r\nPer fer les operacions sobre el sistema SAP és necessària la utilització del jar sapjco-2.1.6, que és el connector propi del SAP per fer les crides a les seves funcions BAPI (RFC).\r\n\r\nLes classes que utilitzarem per fer els objectes d'operacions estan en el jar del connector Gecat09 canigo-connectors-gecat09-2.3.2.jar\r\n\r\nLes classes que utilitzarem per fer les operacions han estat generades amb una eina Open Source anomenada JAXB (Java API for Xml Binding), que genera classes java a partir d'un esquema de xml (XMLSchema). Aquesta eina ens permet no solament generar automàticament classes java sinó també fer validacions per comprovar que les dades que contenen els objectes són vàlides. Per això també haurem d'incloure els jars que necessita JAXB:\r\n\r\n* jaxb-api-1.0.1.jar\r\n* jaxb-libs-1.0.1.jar\r\n* jaxb-impl-1.0.1.jar\r\n* jax-qname-1.1.jar\r\n* namespace-1.0.1.jar\r\n* relaxngDatatype-1.0.1.jar\r\n* xsdlib-1.1.2.jar\r\n\r\nPer tal d'instal-lar el mòdul de SAP es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.integration.sap.version>[1.2.0,1.3.0)</canigo.integration.sap.version>\r\n-\r\n<dependency>\r\n          <groupId>cat.gencat.ctti</groupId>\r\n          <artifactId>canigo.integration.sap</artifactId>\r\n          <version>${canigo.integration.sap.version}</version>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració es realitza automàticament a partir de l'eina de suport al desenvolupament.\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/config/props/sap.properties\r\n\r\n| Propietat                | Requerit     | Descripció\r\n| ------------------------ | ------------ | --------------\r\n| *.sap.client             | Sí           | Client\r\n| *.sap.username           | Sí           | Usuari de connexió\r\n| *.sap.password           | Sí           | Password de connexió\r\n| *.sap.language           | Sí           | Idioma\r\n| *.sap.hostname           | Sí           | Nom del servidor\r\n| *.sap.systemNumber       | Sí           | SAP system number\r\n| *.sap.connectionPool     | No           | Connexió amb pool. Per defecte: true\r\n| *.sap.connectionPoolName | No           | Nom del pool. Per defecte: poolCanigoSAP\r\n| *.sap.maxNumConnections  | No           | Número de connexions màximes. Per defecte: 5\r\n| *.sap.repositoryName     | No           | Nom del repository. Per defecte: ARAsoft\r\n\r\n## Utilització del Mòdul\r\n\r\n### REST\r\n\r\nPer a utilitzar aquest mòdul, cal crear un Controller i un Service:\r\n\r\n**SapService.java**\r\n\r\nClasse Java on es realitza la lògica de la operació a realitzar i es connecta amb el mòdul de SAP.\r\n\r\nEn aquest bean es pot veure:\r\n\r\n* Injecció del conector de SAP via annotacions (@Autowired) de Spring.\r\n* Invocació de la funció BAPI_MATERIAL_GETLIST, taula MATNRSELECTION.\r\n* En la classe MaterialBean s'introduirà el resultat de l'invocació de la funció SAP de manera transparent.\r\n\r\n```java\r\nimport java.util.Collection;\r\n\r\nimport org.slf4j.Logger;\r\nimport org.slf4j.LoggerFactory;\r\nimport org.springframework.beans.factory.annotation.Autowired;\r\nimport org.springframework.context.annotation.Lazy;\r\nimport org.springframework.stereotype.Service;\r\n\r\nimport cat.gencat.ctti.canigo.arch.integration.sap.SapConnector;\r\nimport cat.gencat.plantilla32.model.MaterialBean;\r\n\r\n@Service(\"sapService\")\r\n@Lazy\r\npublic class SapService {\r\n\r\n\tprivate static final Logger log = LoggerFactory.getLogger(SapService.class);\r\n\r\n\t@Autowired\r\n    private SapConnector connector;\r\n\r\n    /**\r\n     * Execució de la funció SAP BAPI_MATERIAL_GETLIST\r\n     *\r\n     */\r\n\tpublic String testSap(){\r\n\t\t\r\n\t\tString message;\r\n\r\n\t\t try{\r\n\t            this.connector.connect();\r\n\t            Collection<Object> col = this.connector.executeFunction(\"BAPI_MATERIAL_GETLIST\",\r\n\t                    \"MATNRSELECTION\", null, MaterialBean.class);\r\n\t            \r\n\t            message = \"Test correcte : \" + col.size();\r\n\r\n\t        }catch(Exception e){\r\n\t        \tmessage = \"Test erròni: \" + e.getMessage();\r\n\t        \tlog.error(e.getMessage(), e);\r\n\t        }finally{\r\n\t            this.connector.disconnect();\r\n\t        }      \r\n        return message;\r\n    }\r\n}\r\n```\r\n\r\n**SapServiceController.java**\r\n\r\nController que publica les operacions disponibles per a qui hagi de consumir-les.\r\n\r\n```\r\nimport org.springframework.beans.factory.annotation.Autowired;\r\nimport org.springframework.http.MediaType;\r\nimport org.springframework.web.bind.annotation.PostMapping;\r\nimport org.springframework.web.bind.annotation.RequestMapping;\r\nimport org.springframework.web.bind.annotation.RestController;\r\n\r\nimport cat.gencat.plantilla32.service.SapService;\r\n\r\n@RestController\r\n@RequestMapping(\"/sap\")\r\npublic class SapServiceController {\r\n\r\n\t@Autowired\r\n\tSapService sapService;\r\n\r\n\r\n\t@PostMapping(produces = { MediaType.APPLICATION_JSON_VALUE })\r\n\tpublic String testSap() throws Exception {\r\n\t\treturn sapService.testSap();\r\n\t}\r\n}\r\n```\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1zYXA="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1wc2lz":{"date":1425571902000,"title":"PSIS","description":"Validació de Signatures electròniques mitjançant els serveis de PSIS oferts per CatCert.","sections":"Canigó. Documentació versió 3.x","weight":11,"path":"/canigo-documentacio-versions-3x-integracio/modul-psis","content":"## Propòsit\r\n\r\nAquest mòdul permet la validació de Signatures electròniques mitjançant els serveis de PSIS oferts per CatCert.\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer tal d'instal- lar el mòdul de PSIS es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```xml\r\n<canigo.integration.psis.version>[1.2.0,1.3.0)</canigo.integration.psis.version>\r\n\r\n<dependency>\r\n          <groupId>cat.gencat.ctti</groupId>\r\n          <artifactId>canigo.integration.psis</artifactId>\r\n          <version>${canigo.integration.psis.version}</version>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració es realitza automàticament a partir de la eina de suport al desenvolupament.\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/config/props/psis.properties\r\n\r\nPropietat          | Requerit | Descripció\r\n------------------ | -------- | -----------\r\n*.psis.urlPica  | Sí       | Url del WebService de PSIS. Valor per defecte: http://preproduccio.pica.intranet.gencat.cat/pica_cataleg/AppJava/services/\r\n*.psis.finalitat   | Sí       | Finalitat de l'accés al servei. \r\n*.psis.nifEmisor   | Sí       | Nif de l'emisor\r\n*.psis.nomEmisor   | Sí       | Nom de l'emisor\r\n*.psis.nomFuncionari| Sí      | Nom del funcionari\r\n*.psis.nifFuncionari| Sí      | Nif del funcionari\r\n*.psis.emailFuncionari| Sí    | Email del funcionari\r\n\r\nEls valors de finalitat, urlPica, nifEmisor i nomEmisor s'han de consultar a la OT PICA en requeridors.otpica.ctti@gencat.cat\r\n\r\nAquest mòdul és dependent del [mòdul de la PICA] (/canigo-documentacio-versions-3x-integracio/modul-pica/) amb lo qual també s'ha de configurar aquest.\r\n\r\n## Utilització del Mòdul\r\n\r\n### PicaService\r\n\r\nEl mòdul PSIS requereix de la creació del Bean del servei de la pica, per defecte Psis cerca un bean anomenat picaService. Si es dessitja canviar aquest nom es pot fer afegint al fitxer psis.propierties la següent propietat:\r\n\r\n\tpsis.picaServiceBeanName=[nom del bean]\r\n\t\r\nUn exemple del bean que s'ha de crear:\r\n\r\n\t<!-- BEAN DE LA PICA -->\r\n\t<bean id=\"picaService\" parent=\"abstractPicaService\">\r\n        <property name=\"modalitats\">\r\n            <map>\r\n            </map>\r\n        </property>\r\n    </bean>\r\n\r\n### REST\r\n\r\nPer a utilitzar aquest mòdul, cal crear un Controller i un Service:\r\n\r\n**PsisService.java**\r\n\r\nClasse Java on es realitzarà la lògica de la operació a realitzar.\r\n\r\nEn aquest exemple es valida la caducitat d'un certificat amb PSIS:\r\n\r\n```java\r\nimport java.io.InputStream;\r\n\r\nimport org.apache.commons.io.IOUtils;\r\nimport org.slf4j.Logger;\r\nimport org.slf4j.LoggerFactory;\r\nimport org.springframework.beans.factory.annotation.Autowired;\r\nimport org.springframework.context.annotation.Lazy;\r\nimport org.springframework.stereotype.Service;\r\n\r\nimport cat.gencat.ctti.canigo.arch.integration.psis.PSISConnector;\r\nimport cat.gencat.ctti.canigo.arch.integration.psis.exceptions.PSISException;\r\nimport net.gencat.pica.psis.schemes.valCertSimpPICARequest.ValCertSimpPICARequestDocument;\r\nimport net.gencat.pica.psis.schemes.valCertSimpPICARequest.ValCertSimpPICARequestDocument.ValCertSimpPICARequest;\r\nimport net.gencat.pica.psis.schemes.valCertSimpPICAResponse.ValCertSimpPICAResponseDocument;\r\n\r\n@Service(\"psisService\")\r\n@Lazy\r\npublic class PsisService {\r\n\t\r\n\t/** Logger  */  \r\n\tprivate static final Logger logger = LoggerFactory.getLogger(PsisService.class);\r\n\r\n\t@Autowired\r\n\tprivate PSISConnector psisServices;\r\n\t\r\n\tprivate static byte[] certificatCaducat = getBytesFromInputStream(Thread.currentThread().getContextClassLoader().getResourceAsStream(\"config/cert/certificatCaducat.crt\"));\r\n\r\n\r\n\t private static byte[] getBytesFromInputStream(InputStream is) {\r\n\t\t byte[] resultat = null;\r\n\t\t try {\r\n\t\t\t resultat = IOUtils.toByteArray(is);\r\n\t\t } catch (Exception e) {\r\n\t\t\t logger.error(e.getMessage(),e);\r\n\t\t }\r\n\t\t return resultat;\r\n\t }\r\n\t \r\n\t public String testValidarCertificatCaducat() {\r\n\t\t logger.debug(\"[testValidarCertificatCaducat]\");\r\n\t\t \r\n\t\t String message;\r\n\t\t try{\r\n\t\t\t ValCertSimpPICARequestDocument document = ValCertSimpPICARequestDocument.Factory.newInstance();\r\n\t\t\t ValCertSimpPICARequest peticioValidar = ValCertSimpPICARequest.Factory.newInstance();\r\n\t\t\t peticioValidar.setCertificat(certificatCaducat);\r\n\t\t\t document.setValCertSimpPICARequest(peticioValidar);\r\n\t\t\t ValCertSimpPICAResponseDocument resposta = psisServices.validarCertificat(document);\r\n\t\t\t if (resposta!=null && resposta.getValCertSimpPICAResponse()!=null && resposta.getValCertSimpPICAResponse().getResultat()!=null){\r\n\t\t\t\t message = \"S'ha verificat la caducitat del certificat amb el següent resultat: \"+ resposta.getValCertSimpPICAResponse().getResultat();\r\n\t\t\t }else{\r\n\t\t\t\t message = \"No s'ha rebut resposta del servei o el format d'aquesta no es l'esperat\";\r\n\t\t\t }\r\n\t\t } catch (PSISException e) {\r\n\t\t\t message = \"S'ha produït un error al servei\";\r\n\t\t\t logger.error(e.getMessage(), e);\r\n\t\t } catch (Exception e) {\r\n\t\t\t message = \"S'ha produït un error general\";\r\n\t\t\t logger.error(e.getMessage(), e);\r\n\t\t }\r\n\t\t \r\n\t\t return message;\r\n\t }\r\n\t \r\n}\r\n```\r\n\r\n**PsisServiceController.java**  \r\nController que publica les operacions disponibles per a qui hagi de consumir-les\r\n\r\n```java\r\nimport org.springframework.beans.factory.annotation.Autowired;\r\nimport org.springframework.http.MediaType;\r\nimport org.springframework.web.bind.annotation.GetMapping;\r\nimport org.springframework.web.bind.annotation.RequestMapping;\r\nimport org.springframework.web.bind.annotation.RestController;\r\n\r\nimport cat.gencat.plantilla32.service.PsisService;\r\n\r\n@RestController\r\n@RequestMapping(\"/psis\")\r\npublic class PsisServiceController {\r\n\r\n\t@Autowired\r\n\tPsisService psisService;\r\n\r\n\t@GetMapping(produces = { MediaType.APPLICATION_JSON_VALUE })\r\n\tpublic String testValidarCertificatCaducat() {\r\n\t\t\r\n\t\tString message = psisService.testValidarCertificatCaducat();\r\n\t\t\r\n\t\treturn message;\r\n\t}\r\n}\r\n```\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1wc2lz"},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1waWNh":{"date":1426250442000,"title":"PICA","description":"Interficie d'accés a la PICA (Plataforma d'Integració i Col.laboració Administrativa).","sections":"Canigó. Documentació versió 3.x","weight":10,"path":"/canigo-documentacio-versions-3x-integracio/modul-pica","content":"## Propòsit\r\n\r\nEl propòsit del connector és proporcionar una interfície java per accedir a la PICA (Plataforma d'Integració i Col.laboració Administrativa).\r\n\r\nEl connector amb la PICA disposa de dos tipus de comunicació, un d'ells a través de web service síncron, i l'altre, mitjançant web service asíncron.\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer tal d'instal-lar el mòdul de PICA es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.integration.pica.version>[1.2.0,1.3.0)</canigo.integration.pica.version>\r\n\r\n<dependency>\r\n          <groupId>cat.gencat.ctti</groupId>\r\n          <artifactId>canigo.integration.pica</artifactId>\r\n          <version>${canigo.integration.pica.version}</version>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració es realitza automàticament a partir de la eina de suport al desenvolupament.\r\n\r\nSon necessaris els següents arxius de configuració:\r\n\r\n* pica.properties\r\n* pica.signature.properties\r\n* client.axis2.xml\r\n* modules.list\r\n* rampart-1.3.mar\r\n* certificats.jks\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/config/props/pica.properties\r\n\r\nPropietat                      | Requerit | Descripció\r\n-----------------------------  | -------- | ---------\r\n*.pica.modes.passwordType      | No       | Tipus de password per a la PICA. Per defecte: PasswordText\r\n*.pica.requirer.signatureFile  | Sí       | Arxiu de configuració de la seguretat\r\n*.pica.requirer.petitionerId   | Sí       | Identificador del solicitant\r\n*.pica.requirer.transmitionId  | Sí       | Identificador de la transmissió\r\n*.pica.requirer.petitionerName | Sí       | Nom del peticionari\r\n*.pica.requirer.user           | Sí       | Usuari que vol consumir un producte/modalitat de la PICA\r\n*.pica.requirer.password       | Sí       | Password de l'usuari que vol consumir un producte/modalitat de la PICA\r\n*.pica.axisdefinition.location | Sí       | Localització de l'arxiu d'axisdefinition\r\n*.pica.trustStore.location     | No       | Localització de l'arxiu de certificats per a la configuració SSL\r\n*.pica.trustStore.type         | No       | Tipus de keystore\r\n*.pica.trustStore.password     | No       | Password de la keystore\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/axis2client/conf/client.axis2.xml\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/axis2client/conf/rampart-1.3.mar\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/axis2client/conf/modules.list\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/config/cert/certificats.jks\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/config/cert/pica.signature.properties\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/spring/app-integration-custom.xml\r\n\r\n\r\n    Important\r\n\r\n    Si l'aplicació ha de ser desplegada en format empaquetat (.war, .ear) caldrà indicar la ubicació de la carpeta de configuració d'axis2 com a Path absolut dins el servidor on desplegarà. Aquest Path s'indicarà sobreescrivint el valor de la propietat pica.axisdefinition.location del fitxer pica.properties amb el Path absolut on s'ha deixat la carpeta d'axis2client als servidors. S'haurà de pactar la ubicació amb els responsables del CPD on desplegarà.\r\n\r\n    Exemple:\r\n    pica.properties:\r\n\r\n        int.pica.axisdefinition.location=file:/export/AppJavaDades/int/.../axis2client/\r\n        pre.pica.axisdefinition.location=file:/export/AppJavaDades/pre/.../axis2client/\r\n        pro.pica.axisdefinition.location=file:/export/AppJavaDades/pro/.../axis2client/\r\n\r\n\r\n\r\n## Utilització del Mòdul\r\n\r\n### REST\r\n\r\n**app-integration-custom.xml**\r\n\r\nAquest arxiu XML conté la configuració de Spring per al servei de PICA. En l'exemple configurem el servei de PICA per invocar el producte/modalitat \"PADRO_MUNICIPI_RESIDENCIA\".\r\n\r\n```\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\r\n\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n\txsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.1.xsd\">\r\n\r\n\r\n\t<bean id=\"picaCanigoService\" parent=\"abstractPicaService\">\r\n\t\t<property name=\"modalitats\">\r\n\t\t\t<map>\r\n\t\t\t\t<entry key=\"PADRO_MUNICIPI_RESIDENCIA\">\r\n\t\t\t\t\t<bean parent=\"producteModalitatBase\">\r\n\t\t\t\t\t\t<property name=\"signat\" value=\"false\"/>\r\n\t\t\t\t\t\t<property name=\"urlPICA\" value=\"${pica.url}\" />\r\n\t\t\t\t\t\t<property name=\"codCertificado\" value=\"${pica.codCertificado}\"/>\r\n\t\t\t\t\t\t<property name=\"codProducto\" value=\"${pica.codProducto}\"/>\r\n\t\t\t\t\t\t<property name=\"finalidad\" value=\"${pica.finalidad}\"/>\r\n\t\t\t\t\t\t<property name=\"nifEmisor\" value=\"${pica.nifEmissor}\"/>\r\n\t\t\t\t\t\t<property name=\"nombreEmisor\" value=\"${pica.nombreEmisor}\"/>\r\n\t\t\t\t\t</bean>\r\n\t\t\t\t</entry>\r\n\t\t\t</map>\r\n\t\t</property>\r\n\t</bean>\r\n</beans>\r\n```\r\n\r\n<div class=\"message warning\">\r\n<b>Propietats específiques</b>\r\n<br><br>\r\nLes propietats pica.url, pica.codCertificado, pica.codProducto, etc, definides en XML de configuració anterior, son propietats específiques de la modalitat o producte invocat, per lo que s'hauran d'introduir manualment a l'arxiu pica.properties per tal de que el PlaceHolderResolver de Spring pugui resoldre el valor de la propietat durant l'arranc de l'aplicació.\r\n</div>\r\n\r\n**PicaAplicacioService.java**\r\n\r\nClasse Java amb la lògica de les peticions que es realitzin, i la connectivitat amb el mòdul de la PICA.\r\n\r\nEn aquesta classe es pot visualiztar:\r\n\r\n* Injecció del servei de PICA via annotacions (@Autowired/@Qualifier) de Spring.\r\n* Invocació del producte/modalitat \"PADRO_MUNICIPI_RESIDENCIA\" definit en el map de modalitats que es troba al fitxer de configuració xml de Spring.\r\n\r\n```java\r\nimport java.io.IOException;\r\nimport java.io.StringReader;\r\nimport java.util.ArrayList;\r\nimport java.util.Iterator;\r\nimport java.util.List;\r\n\r\nimport javax.xml.parsers.DocumentBuilder;\r\nimport javax.xml.parsers.DocumentBuilderFactory;\r\nimport javax.xml.parsers.ParserConfigurationException;\r\n\r\nimport org.slf4j.Logger;\r\nimport org.slf4j.LoggerFactory;\r\nimport org.springframework.beans.factory.annotation.Autowired;\r\nimport org.springframework.beans.factory.annotation.Qualifier;\r\nimport org.springframework.context.annotation.Lazy;\r\nimport org.springframework.stereotype.Service;\r\nimport org.w3c.dom.Document;\r\nimport org.w3c.dom.Element;\r\nimport org.w3c.dom.Node;\r\nimport org.w3c.dom.NodeList;\r\nimport org.xml.sax.InputSource;\r\nimport org.xml.sax.SAXException;\r\n\r\nimport com.generalitat.mp.ws.CridaSincronaResponseDocument;\r\n\r\nimport cat.gencat.ctti.canigo.arch.integration.pica.IPicaServiceWrapper;\r\nimport cat.gencat.pica.api.peticio.beans.DadesEspecifiques;\r\nimport cat.gencat.pica.api.peticio.beans.Funcionari;\r\nimport cat.gencat.pica.api.peticio.beans.Titular;\r\nimport cat.gencat.pica.api.peticio.core.IPICAServiceSincron;\r\n\r\n@Service(\"picaAplicacioService\")\r\n@Lazy\r\npublic class PicaAplicacioService {\r\n\r\n\tprivate static final Logger log = LoggerFactory.getLogger(PicaAplicacioService.class);\r\n\r\n\t@Qualifier(\"picaService\")\r\n\t@Autowired\r\n    private IPicaServiceWrapper serviceWrapper;\r\n    \r\n\tprivate static final int TIPO_DOC_TITULAR_NIF = 2;\r\n\r\n\tpublic String testPica(){\r\n\t\t\r\n\t\tString message;\r\n\r\n\t\t try{\r\n\t            IPICAServiceSincron service = serviceWrapper.getPicaWebServiceSincronInstance(\"PADRO_MUNICIPI_RESIDENCIA\");\r\n\r\n\t            Funcionari func = getFuncionari();\r\n\t            Titular tit = creaTitular();\r\n\r\n\t            List<DadesEspecifiques> datosEspecificosXML = createDadesEspecifiques();\r\n\r\n\t            service.setFuncionari(func);\r\n\t            service.setTitular(tit);\r\n\t            service.setDadesEspecifiques(datosEspecificosXML);\r\n\r\n\t                        //Identificador únic de petició\r\n\t            service.crearPeticio(\"PROVA_OTCANIGO_\" + System.currentTimeMillis());\r\n\r\n\t            //fer peticio\r\n\t            CridaSincronaResponseDocument resp = serviceWrapper.ferPeticioAlServei(service);\r\n\t            //extreure resultat\r\n\t            List<DadesEspecifiques> resposta= serviceWrapper.extreuDadesEspecifiques(service,resp);\r\n\r\n\t            Iterator<DadesEspecifiques> it = resposta.iterator();\r\n\t            while (it.hasNext()) {\r\n\t                DadesEspecifiques object = it.next();\r\n\t                String dadesXML = object.getDadesXML();\r\n\r\n\t                // Parsejar resposta\r\n\t                parseXML(dadesXML);\r\n\t            }\r\n\r\n\t            message = \"Test correcte\";\r\n\r\n\t        }catch(Exception e){\r\n\t        \tmessage = \"Test amb errors: \" + e.getMessage();\r\n\t            log.error(e.getMessage(), e);\r\n\t        }\r\n        \r\n        return message;\r\n\r\n    }\r\n\t\r\n    /**\r\n     * Crea un objecte funcionari\r\n     *\r\n     * return funcionari\r\n     **/\r\n    private Funcionari getFuncionari() {\r\n        Funcionari funcionari = new Funcionari();\r\n        funcionari.setNombreFuncionario(\"Nom Funcionari\");\r\n        funcionari.setNifFuncionario(\"55555555A\");\r\n        funcionari.setEmailFuncionario(\"prova@gencat.com\");\r\n        return funcionari;\r\n    }\r\n\r\n    /**\r\n     * Crea un objecte titular\r\n     *\r\n     * return titular\r\n     **/\r\n\tprivate Titular creaTitular() {\r\n\t    Titular tit = new Titular(  );\r\n\t    tit.setTitularTipoDocumentacion(TIPO_DOC_TITULAR_NIF);\r\n\t    tit.setTitularDocumentacion(\"NIF_TITULAR\"); // Es posa el NIF real\r\n\t    tit.setTitularNombreCompleto(\"NOM_COMPLET_TITULAR\"); // Es posa el nom real\r\n\t    return tit;\r\n\t}\r\n\t\r\n\t\r\n\t    /**\r\n\t     * Crea un objecte dades específiques\r\n\t     *\r\n\t     * return DadesEspecifiques\r\n\t     **/\r\n\tprivate List<DadesEspecifiques> createDadesEspecifiques() {\r\n\t    List<DadesEspecifiques> dadesEspecifiquesXML= new ArrayList<DadesEspecifiques>(  );\r\n\t    StringBuffer sb = new StringBuffer( \"<ns1:request xmlns:ns1=\\\"http://www.gencat.net/tfn\\\">\" );\r\n\t    sb.append( \"<ns1:simpleparam name=\\\"NUMTIT\\\">83746573</ns1:simpleparam>\" );\r\n\t    sb.append( \"<ns1:simpleparam name=\\\"NUMNIF\\\">111111111H</ns1:simpleparam>\" );\r\n\t    sb.append( \"</ns1:request>\" );\r\n\t\r\n\t    DadesEspecifiques dades = new DadesEspecifiques(  );\r\n\t    dades.setIdSolicitud( \"1\" );\r\n\t    dades.setDadesXML( sb.toString(  ) );\r\n\t    dadesEspecifiquesXML.add( dades );\r\n\t\r\n\t    return dadesEspecifiquesXML;\r\n\t}\r\n\t\r\n\t    /**\r\n\t     * Parsejar la resposta deixant constància en format de traces si la crida ha finalitzat o no correctament\r\n\t     *\r\n\t     **/\r\n\tprivate void parseXML(String dadesXML) throws ParserConfigurationException, SAXException, IOException {\r\n\t    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\r\n\t    DocumentBuilder builder = factory.newDocumentBuilder();\r\n\t    InputSource inStream = new InputSource();\r\n\t    boolean error = false;\r\n\t\r\n\t    inStream.setCharacterStream(new StringReader(dadesXML));\r\n\t    Document doc = builder.parse(inStream);\r\n\t    NodeList nodes = doc.getElementsByTagName(\"error\");\r\n\t    if(nodes.getLength() == 0) {\r\n\t        nodes = doc.getElementsByTagName(\"sol:SolicitudError\");\r\n\t        error = true;\r\n\t    }\r\n\t\r\n\t    for(int i=0; i<nodes.getLength(); i++) {\r\n\t        Node node = nodes.item(i);\r\n\t        if(node.getNodeType() == Node.ELEMENT_NODE) {\r\n\t            Element element = (Element)node;\r\n\t            if(!error) {\r\n\t                log.info(dadesXML);\r\n\t            } else {\r\n\t                log.info(element.getTextContent());\r\n\t            }\r\n\t        }\r\n\t    }\r\n\t}\r\n}\r\n```\r\n\r\nCal destacar que l'identificador de la petició ha de ser únic, per aquest motiu es concatena un prefix de text qualsevol amb el timestamp del sistema.\r\n\r\nPer a més informació respecte l'especificació tècnica i funcional podeu contactar amb l'OT PICA.\r\n\r\nEn aquest exemple, els mètodes privats crearFuncionari() i crearTitular() (creats simplement per aquest test) s'encarreguen de setejar les propietats del funcionari que fa la petició i titular sobre el que es fa la petició respectivament. El mètode també privat createDadesEspecifiques() conté una llista de les sol.licituds, en format XML, que s'enviaran dins la petició.\r\n\r\nDins una petició (llista de dades específiques) es poden incloure diverses sol- licituds, els identificadors de les quals han de ser únics dins una mateixa petició. Si volguéssim afegir una altra sol- licitud en l'exemple, només caldria instanciar un nou objecte DadesEspecifiques, amb IdSolicitud=\"2\", un nou StringBuffer amb les dades i afegir-lo a la llista dadesEspecifiquesXML dins del mètode createDadesEspecifiques() de l'exemple.\r\n\r\n**PicaServiceController.java**  \r\n\r\nController que publica les operacions disponibles per a qui hagi de consumir-les\r\n\r\n```java\r\nimport org.springframework.beans.factory.annotation.Autowired;\r\nimport org.springframework.http.MediaType;\r\nimport org.springframework.web.bind.annotation.PostMapping;\r\nimport org.springframework.web.bind.annotation.RequestMapping;\r\nimport org.springframework.web.bind.annotation.RestController;\r\n\r\nimport cat.gencat.plantilla32.service.PicaAplicacioService;\r\n\r\n@RestController\r\n@RequestMapping(\"/pica\")\r\npublic class PicaServiceController {\r\n\r\n\t@Autowired\r\n\tPicaAplicacioService picaAplicacioService;\r\n\r\n\r\n\t@PostMapping(produces = { MediaType.APPLICATION_JSON_VALUE })\r\n\tpublic String testPica() throws Exception {\r\n\t\treturn picaAplicacioService.testPica();\r\n\t}\r\n}\r\n```\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1waWNh"},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1zZ2Rl":{"date":1426854475000,"title":"SGDE","description":"Servei de Gestió del Document Electrònic.","sections":"Canigó. Documentació versió 3.x","weight":14,"path":"/canigo-documentacio-versions-3x-integracio/modul-sgde","content":"## Introducció\r\n\r\nL'SGDE o Servei de Gestió del Document Electrònic ofereix una sèrie de serveis relacionats amb la gestió de documents electrònics. Aquests serveis els ofereixen les plataformes que integren l'SGDE. Actualment existeixen dues:\r\n\r\n* Plataforma Adobe\r\n* STD\r\n\r\nPodeu trobar mes informació sobre els serveis i funcionalitats del SGDE [aquí](/sgde/about/).\r\n\r\n### Propòsit\r\n\r\nEl propòsit del connector és proporcionar una API que pugui ser utilitzada de forma fàcil pels integradors d'aquest connector per consumir els diferents serveis del SGDE.\r\n\r\n### Context i Escenaris d'ús\r\n\r\nEl connector SGDE es troba dins els connectors funcionals de la Generalitat.\r\n\r\n### A qui va dirigit\r\n\r\nAquest document va dirigit als següents perfils:\r\n\r\n* Programador. Per conèixer l'ús del connector.\r\n* Arquitecte. Per conèixer quins són els components i la configuració del connector.\r\n\r\n## Descripció Detallada\r\n\r\nAquest connector ofereix els següents serveis:\r\n\r\n**Serveis Plataforma Adobe**\r\n\r\n* **renderitzarFormulari:** Fusiona un formulari amb la plantilla pdf.\r\n* **renderitzarSignarPDF:** Fusiona un formulari amb la plantilla pdf i posteriorment el signa.\r\n* **renderitzarFormulariPDFadjunts:** Fusiona un formulari amb la plantilla pdf i afegeix els annexos indicats\r\n* **renderitzarFormulariPDFaplanatForms:** Fusiona un formulari amb la plantilla pdf donant com a resultat un PDF aplanat. Realitzat amb el mòdul Forms de LC.\r\n* **renderitzarFormulariPDFAplanat:** Fusiona un formulari amb la plantilla pdf donant com a resultat un PDF aplanat. Realitzat amb el mòdul d'Output de LC.\r\n* **renderitzarFormulariPDFA:** Fusiona un formulari amb la plantilla pdf donant com a resultat un PDF/A, que garanteix la compatibilitat d’aquest document al llarg del temps.\r\n* **renderitzarFormulariPDFaplanatSignat:** Fusiona un formulari amb la plantilla pdf, després l'aplana i el signa.\r\n* **extreureDadesFormulari:** Servei per extreure dades d'un formulari.\r\n* **extreureDadesXML:** Servei que extreu les dades introduïdes en un formulari dinàmic.\r\n* **extreureComentaris:** Servei que extreu els comentaris d'un document PDF.\r\n* **extreureComplexAnnexos:** Servei que extreu els annexos d'un document PDF.\r\n* **extreureAnnexos:** Servei que extreu els annexos d'un document PDF.\r\n* **convertirPdfaImatge:** Servei per convertir un pdf a imatge.\r\n* **convertirPdfaPdfA:** Servei per convertir un PDF a PDF/A.\r\n* **aplanarPDF:** Servei per aplanar un pdf.\r\n* **signarPDF:** Servei per a signar un pdf pla.\r\n* **aplanarSignarPDF:** Servei per aplanar i signar un pdf.\r\n\r\n**Serveis STD**\r\n\r\n* **generarCSV:** Servei per la generació d'un Codi Segur a partir d'un arxiu i una clau.\r\n* **composarPDFStream:** Servei que composa un PDF a partir d'una plantilla i d'un document PDF enviat en Stream en la mateixa petició.\r\n* **composarPDFRemot:** Servei que composa un PDF a partir d'una plantilla i d'un document PDF previament pujat al filesystem del STD.\r\n* **convertirPDF:** Servei que converteix un document Ofimàtic (Word, Excel, PowerPoint, Imatges, OpenOffice,...) en PDF.\r\n* **convertirPDFCercable:** Servei que converteix un document Ofimàtic (Word, Excel, PowerPoint, Imatges, OpenOffice,...) en PDF Cercable.\r\n* **convertirComposarPDF:** Servei que converteix i posteriorment composa un arxiu ofimàtic.\r\n* **convertirComposarPDFCercable:** Servei que converteix i posteriorment composa un arxiu ofimàtic cercable.\r\n* **ferOCR:** Servei que extrau el text inclòs a una imatge i el retorna.\r\n\r\n\r\n### Alta Servei\r\n\r\nPer poder utilitzar l'SGDE s'ha d'estar donat d'alta en el servei. Per poder fer-ho s'han d'enviar un mail a oficina-tecnica.canigo.ctti@gencat.cat sol.licitant l'alta a qualsevol de les plataformes que integren el SGDE:\r\n\r\n* Plataforma Adobe: El mail a de contenir la sol·licitud d'alta a l'aplicació d'AutoServei disponible [aqui](/related/SGDE/formulari-alta-plataforma-adobe.xls \"Formulari d'alta plataforma Adobe del SGDE\").\r\n* STD: El mail ha de redactar-se tal qual es descriu en el manual d'usuari del servei. Aquest mail ha de contenir una plantilla degudament complimentada que es pot trobar aquí.\r\n    1. El Centre de Frameworks i Solucions d'Arquitectura respondrà a aquest mail una vegada doni d'alta l'aplicació amb un mail tipus,\r\n    2. L'alta a qualsevol de les dues plataformes s'han de realitzar primer sobre l'entorn de PRE i posteriorment a l'entorn de PRO.\r\n\r\n### Arquitectura i Components\r\n\r\n#### Interfícies i Components Genèrics\r\n\r\nEs pot trobar el codi font referent a aquest components a la següent url:\r\n\r\nCodi Font:  https://sic.ctti.extranet.gencat.cat/nexus/content/groups/canigo-group-maven2/cat/gencat/ctti/canigo.integration.sgde/\r\n\r\n#### Requeriments\r\n\r\nEl connector SGDE és compatible amb les versions 1.5 o superior de Java. Per versions inferiors no es garantit el seu correcte funcionament.\r\n\r\nEl seu ús esta certificat per funcionar correctament en servidors d'aplicacions WL11g i Tomcat6.x.\r\n\r\n### Instal.lació i Configuració\r\n\r\n#### Instal.lació\r\n\r\nLa instal.lació del connector requereix de la utilització de la llibreria 'canigo.integration.sgde' i les dependències indicades a l'apartat 'Introducció-Versions i Dependències'.\r\n\r\nPer afegir aquesta dependència s'ha de modificar el pom.xml de l'aplicació per incloure les llibreries del Connector.\r\n\r\n```\r\n<dependency>\r\n\t<groupId>cat.gencat.ctti</groupId>\r\n\t<artifactId>canigo.integration.sgde</artifactId>\r\n\t<version>[1.3.0,1.4.0)</version>\r\n</dependency>\r\n\r\n```\r\n\r\nIMPORTANT\r\n\r\nEn el cas de que es vulgui integrar aquest connector en una aplicació que disposi del connector de la PICA, és farà necessari afegir les següents exclusions en aquests últim, per exemple el connector PADRÒ.\r\n\r\n```\r\n<dependency>\r\n\t<groupId>cat.gencat.ctti</groupId>\r\n    <artifactId>canigo.integration.padro.pica</artifactId>\r\n    <version>1.3.0</version>\r\n    <exclusions>\r\n\t\t<exclusion>\r\n\t\t\t<groupId>org.apache.axis2</groupId>\r\n\t\t\t<artifactId>axis2-jaxws</artifactId>\r\n\t\t</exclusion>\r\n\t\t<exclusion>\r\n\t\t\t<groupId>org.apache.woden</groupId>\r\n\t\t\t<artifactId>woden</artifactId>\r\n\t\t</exclusion>\r\n\t\t<exclusion>\r\n\t\t\t<groupId>org.apache.ws.commons.schema</groupId>\r\n\t\t\t<artifactId>XmlSchema</artifactId>\r\n\t\t/exclusion>\r\n    </exclusions>\r\n</dependency>\r\n```\r\n\r\nEl no afegir aquestes exclusions pot provocar que el connector SGDE no funcioni correctament.\r\n\r\n#### Configuració\r\n\r\n\r\n1.- Per poder configurar el connector SGDE és necessari crear un arxiu anomenat app-integration-sgde.xml situat en src/main/resources/spring/ amb el següent contingut:\r\n\r\n```\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\r\n\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:aop=\"http://www.springframework.org/schema/aop\"\r\n\txsi:schemaLocation=\"http://www.springframework.org/schema/beans \r\n           http://www.springframework.org/schema/beans/spring-beans-4.1.xsd\">\r\n\t<!-- BEAN SGDE -->\r\n\t<bean id=\"sgdeService\" class=\"cat.gencat.ctti.canigo.arch.integration.sgde.impl.SGDEServiceImpl\" init-method=\"setupService\" scope=\"prototype\">\r\n    \t<description>\r\n\t\t\tSGDE implementation:\r\n\t\t\t\t- formsWSDLUrl: Url de l'wsdl del servei de formularis per les operacions de: renderitzar, extracció de dades, aplanat, ...\r\n\t\t\t\t- stdWSDLUrl: Url de l'wsdl del servei de Transformació de Documents(STD)\r\n\t\t</description>\r\n    \t<property name=\"formsWSDLUrl\" value=\"${sgde.forms.wsdl.url:http://eformularis.pre.intranet.gencat.cat/ServeisInvocacio/serveis/ServeisInvocacioV2?wsdl}\" />\r\n\t\t<property name=\"stdWSDLUrl\" value=\"${sgde.std.wsdl.url:http://sgde.pre.intranet.gencat.cat/ServeisInvocacioSTD/services/ServeisSTDV2?wsdl}\" />\r\n    </bean>\r\n</beans>\r\n```\r\n\r\non les variables **sgde.forms.wsdl.url** i **sgde.std.wsdl.url** són recuperades de l'arxiu **sgde.properties** que s'ha de crear en src/main/resources/config/props/sgde.properties\r\n\r\n2.- Configuració dels arxius de properties.\r\n\r\nNomés es necessita un arxiu de properties a configurar el sgde.properties.\r\n\r\nEl primer conté només dos paràmetres,\r\n\r\n**sgde.forms.wsdl.url:** Url del WSDL del servei de formularis Adobe.\r\n\r\n* PRE: http://preproduccio.eformularis.intranet.gencat.cat/ServeisInvocacio/serveis/ServeisInvocacioV2?wsdl\r\n* PRO: http://eformularis.intranet.gencat.cat/ServeisInvocacio/serveis/ServeisInvocacioV2?wsdl\r\n\r\n**sgde.std.wsdl.url:** Url del WSDL del STD.\r\n\r\n* PRE: http://preproduccio.sgde.intranet.gencat.cat/ServeisInvocacioSTD/services/ServeisSTDV2?wsdl\r\n* PRO: http://sgde.intranet.gencat.cat/ServeisInvocacioSTD/services/ServeisSTDV2?wsdl\r\n\r\n### Utilització del Connector\r\n\r\n\r\n1.- En el bean on es vulgui disposar dels serveis del connector declarar el servei.\r\n\r\n```java\r\n@Autowired\r\nprivate ISGDEService sgdeService;\r\n```\r\n\r\n2.- Escollir un dels serveis del SGDE, per exemple el de CSV.\r\n\r\n```java\r\nResultSTD res = null;\r\nbyte[] STD_ARXIU_PDF_TEST1 = null;\r\ntry {\r\n    STD_ARXIU_PDF_TEST1 = IOUtils.toByteArray(Thread.currentThread().getContextClassLoader().getResourceAsStream(\"data_sgde/prueba_composar.pdf\"));\r\n    res = sgdeService.generarCSV(\"ctti\", \"cscanigo\", STD_ARXIU_PDF_TEST1, \"cscanigo\");\r\n    log.info(\"[SGDEConnectorService][sgdeGeneracioCSVTest][estat: \" + res.getStatus().intValue() + \"]\");\r\n} catch (Exception e) {\r\n    e.printStackTrace();\r\n}\r\n```\r\n\r\nPer més informació sobre els diferents serveis que ofereix el SGDE consultar la documentació disponible [aquí](/sgde/documentacio/).","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1zZ2Rl"},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1zc2M=":{"date":1426846671000,"title":"SSC","description":"Serveis d'accés al Sistema de Signatura Centralitzada de Catcert.","sections":"Canigó. Documentació versió 3.x","weight":15,"path":"/canigo-documentacio-versions-3x-integracio/modul-ssc","content":"## Introducció\r\n\r\nL'objectiu d'aquest connector és el de proporcionar accés al Sistema de Signatura Centralitzada de Catcert (SSC).\r\n\r\n### Propòsit\r\n\r\nEl propòsit del connector és proporcionar una interfície que utilitzi l'API SmartWrapper per poder donar accés als diferents tipus de signatura que ofereix l'SSC.\r\n\r\n### Context i Escenaris d'ús\r\n\r\nEl connector SSC es troba dins els connectors de serveis funcionals de la Generalitat.\r\n\r\n### A qui va dirigit\r\n\r\nAquest document va dirigit als següents perfils:\r\n\r\n* Programador. Per conèixer l'ús del connector.\r\n* Arquitecte. Per conèixer quins són els components i la configuració del connector.\r\n\r\n### Documents i Fonts de Referència\r\n\r\n| Nom Document\r\n| ------------\r\n| [GuiaIntegracioSSC.v1.1.pdf] (/related/canigo/documentacio/modul-ssc/GuiaIntegracioSSC.v1.1.pdf \"Guia Integració SSC\")\r\n\r\n## Descripció Detallada\r\n\r\nAquest connector permet utilitzar els diferents serveis de signatura del SSC a través d'una API que el mateix connector ofereix. El nucli principal del SSC és el sistema TrustedX que ofereix l'API SmartWrapper per poder trevallar amb ell. És amb aquesta API amb la cual esta constituit aquest connector.\r\n\r\nEls principals serveis que ofereix el connector són els següents:\r\n\r\n* Accés a la plataforma amb certificat: Totes les aplicacions que desitgin utilitzar l'SSC hauran de disposar d'un certificat amb el qual s'autenticaran per utilitzar la plataforma. Aquest certificat s'haurà de demanar a CatCert.\r\n* Us de magatzem de certificats: Una de les principals funcionalitats del SSC és la signatura desatesa. Això s'aconsegueix configurant en el connector un magatzem de certificats que l'SSC utilitzarà pels diferents processos de signatura.\r\n* Tipus de signatura: L'SSC ofereix els següents tipus de signatura.\r\n    * CMS: Attached / Detached\r\n    * CAdES-BES: Attached / Detached\r\n    * CAdES-T: Attached / Detached\r\n    * XMLDSig: enveloping/enveloped/detached\r\n    * XAdES-BES: enveloping/enveloped/detached\r\n    * XAdES-T: enveloping/enveloped/detached\r\n\r\n### Alta Servei\r\n\r\nPer poder utilitzar l'SSC en PRO s'ha d'estar donat d'alta en el servei. Per poder fer-ho s'han de seguir els següents passos:\r\n\r\n1. Enviar un mail a implantacio@aoc.cat sol- licitant l'alta al servei. Aquí s'espera que l'usuari informi del tipus de signatures que vol generar i se l'informarà del tipus de certificats que ha de sol- licitar.\r\n2. Els certificats a sol- litar s'hauran de fer a través de EACAT.\r\n3. Finalment, el client haurà d'omplir un document d'alta al SSC, on haurà d'especificar el certificat amb el que s'autenticarà, així com els certificats de signatura allotjats en TrustedX que utilitzarà per signar.\r\n4. Una vegada validat el document d'alta, se li donarà accés al SSC en PRO.\r\n\r\nDe cara a utilitzar el servei en PRE, els certificats i documentació necessaria es poden demanar obrint una petició a suport@aoc.cat.\r\n\r\n### Arquitectura i Components\r\n\r\n#### Interfícies i Components Genèrics\r\n\r\nEs pot trobar el codi font referent a aquests component a la següent url:\r\n\r\nCodi Font:  https://sic.ctti.extranet.gencat.cat/nexus/content/groups/canigo-group-maven2/cat/gencat/ctti/canigo.integration.ssc/\r\n\r\n#### Requeriments\r\n\r\nEl connector SSC és compatible amb les versions 1.5 o superior de Java. Per versions inferiors no es garantit el seu correcte funcionament.\r\n\r\nDonat que l'SSC s'ha desenvolupat per substituir altres sistemes de signatura anteriors s'ha desenvolupat per que sigui compatible amb components de Canigo 2.3.5 en endevant. Tot i això, s'ha de tindre en compte que conté una sèrie de dependències que podrien arribar a donar conflicte en una aplicació ja desenvolupada. Per aquest motiu es recomana consultar les seves dependències.\r\n\r\n### Instal.lació i Configuració\r\n\r\n#### Instal.lació\r\n\r\nLa instal.lació del connector requereix de la utilització de la llibreria 'canigo.integration.ssc' i les dependències indicades a l'apartat 'Introducció-Versions i Dependències'.\r\n\r\nPer afegir aquesta dependència s'ha de modificar el pom.xml de l'aplicació per incloure la llibreria del Connector.\r\n\r\n```\r\n<dependency>\r\n    <groupId>cat.gencat.ctti</groupId>\r\n    <artifactId>canigo.integration.ssc</artifactId>\r\n    <version>[1.2.0,1.3.0)</version>\r\n</dependency>\r\n```\r\n\r\nEl resultat dels processos de signatura moltes vegades són arrays de bytes que es troben codificats en Base64 amb classes d'Axis. Això fa que per la recuperació d'arxius s'hagi d'incorporar una llibreria més en el proyecte:\r\n\r\n```\r\n<dependency>\r\n\t<groupId>axis</groupId>\r\n\t<artifactId>axis</artifactId>\r\n\t<version>1.2.1</version>\r\n</dependency>\r\n```\r\n\r\n#### Configuració\r\n\r\n\r\n1.- Per poder configurar el connector SSC és necessari crear un arxiu anomenat app-integration-ssc.xml situat en src/main/resources/spring/ amb el següent contingut:\r\n\r\n```\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\r\n\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:aop=\"http://www.springframework.org/schema/aop\"\r\n\txsi:schemaLocation=\"http://www.springframework.org/schema/beans \r\n           http://www.springframework.org/schema/beans/spring-beans-4.1.xsd\">\r\n\r\n\t<!-- BEAN SSC -->\r\n\t<bean id=\"sscService\" class=\"cat.gencat.ctti.canigo.arch.integration.ssc.impl.SscConnectorImpl\" scope=\"prototype\">\r\n\t\t<description>\r\n\t\t\tSSC Service for Canigo 3\r\n\t\t</description>\r\n\t\t<property name=\"host\" value=\"${ssc.host}\"/>\r\n\t\t<property name=\"distinguishedname\" value=\"${ssc.distinguishedname}\" /> \r\n\t</bean>\r\n\t\r\n</beans>\r\n```\r\n\r\non les variables ssc.host i ssc.distinguishedname són recuperades de l'arxiu ssc.properties que s'ha de crear en src/main/resources/config/props/ssc.properties\r\n\r\n2.- Configuiració dels arxius de properties.\r\n\r\nExisteixen dos arxius de properties per poder confiurar l'SSC. El ssc.properties i el smartwrapper.properties.\r\n\r\nEl primer conté només dos paràmetres,\r\n\r\n* ssc.host: Url del servidor on es troba l'SSC.\r\n    * PRE: https://ssc.preproduccio.catcert.cat:8443/trustedx-gw/SoapGateway\r\n    * PRO: https://ssc.catcert.cat:8443/trustedx-gw/SoapGatewayU1T\r\n\r\n* ssc.distinguishedname: Nom del certificat amb el que l'aplicació s'autentica per consumir els serveis del SSC.\r\n\r\nEl segón, anomenat smartwrapper.properties conté la configuració de l'API SmartWrapper de TrustedX i esta documentat en el document [GuiaIntegracioSSC.v1.1.pdf](/related/canigo/documentacio/modul-ssc/GuiaIntegracioSSC.v1.1.pdf \"Guia Integració SSC\").\r\n\r\nLa ubicació d'aquest últim arxiu es recomana que sigui en el directori src/main/resoruces de l'aplicació que utilitzi el connector.\r\n\r\nNOTA: Les dades de proves del connector relacionades amb certificats de proves s'han de demanar a CatCert\r\n\r\n### Utilització del Connector\r\n\r\n\r\n1.- En el bean on es vulgui disposar dels serveis del connector declarar el servei.\r\n\r\n```java\r\n@Autowired\r\nprivate SscConnectorImpl sscService;\r\n```\r\n\r\n2.- Escollir una modalitat de signatura i passar-li els paràmetres que necessiti. En el cas d'aquest exemple es farà una signatura CAdES-BES en mode ATTACHED.\r\n\r\n```java\r\nfinal String path_in = \"path_arxiu_entrada\";\r\nfinal String path_out = \"path_arxiu_sortida\";\r\nfinal String filename = \"HelloWorld.txt\";\r\n\t\t\r\nlog.info(\"[INFO][Arxiu a signar: \" + path_in + filename);\r\nString data = Util.readBinaryFileB64(path_in + filename);\r\n\t\t\r\nString resposta = sscService.signCadesBes(data, Constants.ATTACHED);\r\n\t\t\r\nString destFilename = path_out + filename.substring(0, filename.lastIndexOf(\".\")) + \"_Signature_CAdES_BES_Attached.p7b\";\r\nUtil.writeBinaryFileB64(destFilename, resposta);\r\n```\r\n\r\nPer més informació sobre els diferents mètodes que ofereix el connector SSC es pot consultar l'API.","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1zc2M="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC10cmlidXRz":{"date":1426838963000,"title":"Tributs","description":"Servei de consulta de dades fiscals de la PICA.","sections":"Canigó. Documentació versió 3.x","weight":16,"path":"/canigo-documentacio-versions-3x-integracio/modul-tributs","content":"## Introducció\r\n\r\nL'objectiu d'aquest connector ,es el de proporcionar accés als 3 grans serveis de consulta de dades fiscals que actualment ofereix la PICA. Aquests tres serveis són:\r\n\r\n* AEAT: Agència Estatal de l'Administració Tributària\r\n* ATC: Agència Tributària de Catalunya\r\n* TGSS: Tresoreria General de la Seguretat Social\r\n\r\na més també es troba integrat el servei AEAT_ATC_TGSS que sintetitza una petita suite de les modalitats de servei dels 3 productes anteriors.\r\n\r\n### Propòsit\r\n\r\nEl propòsit del connector és proporcionar una interfície funcional reduïda al connector de la Pica que simplifica l'utilització del servei de consulta de dades fiscals ofert per la generalitat.\r\n\r\n### Context i Escenaris d'ús\r\n\r\nEl connector PICA-TRIBUTS es troba dins els connectors de serveis funcionals de la Generalitat.\r\n\r\n### A qui va dirigit\r\n\r\nAquest document va dirigit als següents perfils:\r\n\r\n* Programador. Per conèixer l'ús del connector.\r\n* Arquitecte. Per conèixer quins són els components i la configuració del connector.\r\n\r\n## Descripció Detallada\r\n\r\n### Introducció\r\n\r\nCom ja s'ha comentat aquest connector sintetitza peticions als tres grans serveis oferts per la PICA relatius a la consulta de dades fiscals.\r\n\r\n### Serveis\r\n\r\n#### Servei AEAT (Agència Estatal de l'Administració Tributària)\r\n\r\nLa seva finalitat és l'obtenció de dades tributàries de l'AEAT per consultar, per part dels gestors públics, les dades relatives als contribuents que ofereix l'Agència Estatal de l'Administració Tributària.\r\n\r\nPer una descripció detallada del servei i de les seves modalitats es pot consultar el document \"Guia d'us del servei AEAT_PICA v1.7.pdf\" disponible en l'àrea privada de http://cttiprojectes.gencat.cat/web/otpica en la secció \"productes Oferts -> Interoperabilitat -> AEAT\"\r\n\r\nModalitats:\r\n\r\n* AEAT_PICA_C1: Està al corrent de pagament/ No està al corrent de pagament.\r\n* AEAT_PICA_C2: Les dades del certificat individual de renda.\r\n* AEAT_PICA_C3: Les dades identificatives del CIF o DNI/NIE corresponent.\r\n* AEAT_PICA_C4: Les dades del certificat de renda per a prestacions socials.\r\n* AEAT_PICA_C5: Les dades del certificat de renda d'agricultors.\r\n* AEAT_PICA_C6: Les dades del certificat de renda per a beques.\r\n* AEAT_PICA_C7: Les dades del certificat de renda per a beques anticipades.\r\n* AEAT_PICA_C8: Les dades del certificat de l'impost d'activitats econòmiques.\r\n\r\nTotes les modalitats anteriors són síncrones.\r\n\r\n#### Servei ATC (Agència Tributària de Catalunya)\r\n\r\nEl servei d'obtenció del certificat de deutes amb la Generalitat de Catalunya té com a objectiu poder consultar per part dels gestors públics les dades que ofereix l'Agència Tributària de Catalunya respecte a deutes amb la Generalitat.\r\n\r\nPer una descripció detallada del servei i de les seves modalitats es pot consultar el document \"Guia d'us del servei de l'ATCv1.4.3.pdf\" disponible en l'àrea privada de http://cttiprojectes.gencat.cat/web/otpica en la secció \"productes Oferts -> Interoperabilitat -> ATC\"\r\n\r\nModalitats:\r\n\r\n* ATC_INF_DEUTES_TMP: Modalitat de servei asíncrona que retorna les dades d'un certificat de deutes amb la Generalitat de Catalunya.\r\n\r\n#### Servei TGSS (Tresoreria General de la Seguretat Social)\r\n\r\nEl servei d'obtenció de dades de la seguretat social de la TGSS té com a objectiu poder consultar, per part dels gestors públics, les dades que ofereix la Tresoreria General de la Seguretat Social.\r\n\r\nPer una descripció detallada del servei i de les seves modalitats es pot consultar el document \"Guia d'us del servei de TGSS v1.6.pdf\" disponible en l'àrea privada de http://cttiprojectes.gencat.cat/web/otpica en la secció \"productes Oferts -> Interoperabilitat -> TGSS\"\r\n\r\nModalitats:\r\n\r\n* TGSS_AL_CORRENT_PAGAMENT: Especifica si una persona o una organització té algun deute amb la seguretat social en el moment de fer la consulta.\r\n* TGSS_INFORME_SITUACIO: Aquest informe especifica si una persona cotitzava a una data determinada, per tant és un possible sinònim de si la persona treballava o no.\r\n* TGSS_ACREDITACIO_AGRARIA_PROPI: Aquest informe especifica les situacions de les acreditacions de jornades agràries en un període de temps determinat pels valors del filtre.\r\n\r\n#### Servei AEAT_ATC_TGSS\r\n\r\nL'objectiu del Servei de consulta de la situació de deute d'un contribuent respecte de AEAT, ATC i TGSS és l'agrupació dels productes AEAT (Agència Estatal de l'Administració Tributària), ATC(Agència Tributària de Catalunya) i TGSS (Tresoreria General de la Seguretat Social) en una sola consulta per a la obtenció de la situació de deute d'un contribuent a AEAT, ATC i TGSS. En concret, és l'agrupació de les modalitats següents:\r\n\r\n-AEAT: Certificat d'obligacions tributàries (AEAT_PICA_C1)<br>\r\n-ATC: Informe de situació de deutes amb la Generalitat de Catalunya (ATC_INF_DEUTES_TMP)<br>\r\n-TGSS: Informe de situació de deutes de la TGSS (TGSS_AL_CORRENT_PAGAMENT)<br>\r\n\r\nPer una descripció detallada del servei i de les seves modalitats es pot consultar el document \"Guia d'us del servei deutes del contribuent AEAT-ATC-TGSS v1.1.pdf\" disponible en l'àrea privada de http://cttiprojectes.gencat.cat/web/otpica en la secció \"productes Oferts -> Interoperabilitat -> AEAT_ATC_TGSS\"\r\n\r\nModalitats:\r\n\r\n* AEAT_ATC_TGSS_CONSULTA_DEUTES: Modalitats de servei asíncrona que llença una petició de consulta sobre les modalitats anteriorment anomenades dels tres serveis de consulta de dades fiscals AEAT, ATC i TGSS.\r\n\r\nTotes les modalitats anteriors són síncrones.\r\n\r\n## Arquitectura i Components\r\n\r\n### Interfícies i Components Genèrics\r\n\r\nEs pot trobar tota el codi font referent aquests components a les següents url's:\r\n\r\nCodi Font:  https://sic.ctti.extranet.gencat.cat/nexus/content/groups/canigo-group-maven2/cat/gencat/ctti/canigo.integration.tributs.pica/ \r\n\r\n### Requeriments\r\n\r\nEl connector TRIBUTS és compatible amb les versions 1.5 o superior de Java. Per versions inferiors no és garantit el seu correcte funcionament.\r\n\r\nPer tal de que el connector TRIBUTS funcioni correctament sobre l'aplicació que l'utilitzi s'ha de tenir configurat el servei [connector genèric de la PICA](/canigo-documentacio-versions-3x-integracio/modul-pica/) 1.2.0.\r\n\r\n## Configuració\r\n\r\n\r\nPer configurar el mòdul d'integració PICA-DNI és necessari configurar els següents arxius:\r\n\r\n1.- Importar el mòdul PICA-DNI amb el plugin de Canigó 3 de l'eclipse o bé incorporar manualment les seves dependències en el pom.xml de l'aplicació.\r\n\r\nEn el pom.xml:\r\n\r\n```\r\n<canigo.integration.tributs.pica.version>[1.2.0,1.3.0)</canigo.integration.tributs.pica.version>\r\n...\r\n\r\n<!-- Dependencia del mòdul PICA-TRIBUTS -->\r\n<dependency>\r\n    <groupId>cat.gencat.ctti</groupId>\r\n\t<artifactId>canigo.integration.tributs.pica</artifactId>\r\n\t<version>${canigo.integration.tributs.pica.version}</version>\r\n</dependency>\r\n```\r\n\r\n2.- Crear l'arxiu /config/props/tributs.properties amb el següent contingut:\r\n\r\n```\r\n*.tributs.pica.nifEmisor=[nifEmisor]\r\n*.tributs.pica.nomEmisor=[nomEmisor] #normalment:\"CONSORCI AOC\"\r\n*.tributs.pica.nomEmisorCAT365=[nomEmisor] #normalment:\"CONSORCI AOC\"\r\n*.tributs.pica.finalitat=[finalitat]\r\n*.tributs.pica.url=http://preproduccio.pica.intranet.gencat.cat/pica_cataleg/AppJava/services/\r\n*.tributs.pica.nomFuncionari=[nomFuncionari]\r\n*.tributs.pica.nifFuncionari=[nifFuncionari]\r\n*.tributs.pica.emailFuncionari=[emailFuncionari]\r\n```\r\n\r\nEls valors d finalitat, urlPica, nifEmisor i nomEmisor s'han de consultar a la OT PICA en requeridors.otpica.ctti@gencat.cat\r\n\r\nNOTA: El valor per defecte de urlPica es la de l'entorn de Pre-producció.\r\n\r\n3.- Configurar l'arxiu /config/props/pica.properties amb el següent contingut:\r\n\r\n```\r\n*.pica.modes.passwordType=PasswordText\r\n*.pica.requirer.signatureFile=classpath:config/cert/signature.properties\r\n*.pica.requirer.petitionerId=[petitionerId]\r\n*.pica.requirer.transmitionId=[transmitionId]\r\n*.pica.requirer.petitionerName=[petitionerName]\r\n*.pica.requirer.password=[password]\r\n*.pica.requirer.user=[password]\r\n*.pica.axisdefinition.location=classpath:axis2client/\r\n*.pica.trustStore.location=classpath:config/cert/certificats.jks\r\n*.pica.trustStore.type=JKS\r\n*.pica.trustStore.password=[trustStore.password]\r\n```\r\n\r\nEls valors entre [] s'han de consultar a la OT PICA en requeridors.otpica.ctti@gencat.cat\r\n\r\n4.- Configurar l'arxiu /spring/app-integration-tributs.xml amb el següent contingut:\r\n\r\n```\r\n<!-- BEAN DE LA PICA -->\r\n<bean id=\"picaService\" class=\"cat.gencat.ctti.canigo.arch.integration.pica.PicaServiceWrapperImpl\" scope=\"prototype\">\r\n    <property name=\"axisDefinition\" value=\"${pica.axisdefinition.location}\"/>\r\n    <property name=\"trustStoreSSLKeystore\" value=\"${pica.trustStore.location}\" />\r\n    <property name=\"trustStoreSSLKeystoreType\" value=\"${pica.trustStore.type}\" />\r\n    <property name=\"trustStoreSSLKeystorePassword\" value=\"${pica.trustStore.password}\" />\r\n    <property name=\"requeridor\" ref=\"requeridor\"/>\r\n    <property name=\"modalitats\">\r\n        <map>\r\n\r\n        </map>\r\n    </property>\r\n</bean>\r\n```\r\n\r\nLes propietats trustStoreSSLKeystore, trustStoreSSLKesytoreType i trustStoreSSLKeystorePassword només són necessàries en cas d'accedir a la url de la PICA mitjançant HTTPS.\r\n\r\n### Utilització del Connector\r\n\r\n#### Exemple d'utilització d'una modalitat de Servei de AEAT\r\n\r\nRecuperar el bean del servei de AEAT des de la classe on es vol utilitzar:\r\n\r\n```java\r\n@Autowired\r\nprivate AeatConnectorImpl aeatConnector;\r\n```\r\n\r\nFer la crida a la modalitat del servei desitjat, p.e.:\r\n\r\n```java\r\nDadesPeticioAEAT peticio = new DadesPeticioAEAT();\r\npeticio.setNom(\"Cristian\");\r\npeticio.setCognom1(\"Casals\");\r\npeticio.setCognom2(\"Molina\");\r\npeticio.setNomComplet(\"Cristian Casals Molina\");\r\npeticio.setTipusDocument(\"NIF\");\r\npeticio.setDocument(\"39361642V\");\r\n\t\r\nC1PICAResponse resposta = aeatConnector.ObligacionsTributaries(peticio);\r\n```\r\n\r\nPer més informació sobre les dades d'entrada i sortida d'aquesta modalitat es pot consultar el document \"Guia d'us del servei AEAT_PICA v1.7.pdf\"\r\n\r\n#### Exemple d'utilització del servei ATC\r\n\r\nRecuperar el bean del servei de ATC des de la classe on es vol utilitzar:\r\n\r\n```java\r\n@Autowired\r\nprivate AtcConnectorImpl atcConnector;\r\n```\r\n\r\nEn aquest cas d'exemple es consumirà la modalitat de servei ATC_INF_DEUTES_TMP que retorna les dades d'un certificat de deutes amb la Generalitat de Catalunya.\r\n\r\nDonat que el servei ATC es consumeix de forma asíncrona la forma correcta per poder consumir-ho es realitza en 3 fases:\r\n\r\n1. Fer petició al Servei\r\n2. Testar l'estat de resolució de la petició\r\n3. Recuperar les dades de la petició\r\n\r\nNOTA: Les dades de nom, cognom1 i 2, nom complet i el valor del document sobre l'exemple son inventades.\r\n\r\n```\r\nDadesPeticioATC peticio = new DadesPeticioATC();\r\n    \t\r\npeticio.setIdioma(\"Català\");\r\npeticio.setNom(\"Nom\");\r\npeticio.setCognom1(\"Cognom1\");\r\npeticio.setCognom2(\"Cognom2\");\r\npeticio.setNomComplet(\"Nom Cognom1 Cognom2\");\r\npeticio.setDocument(\"12341234D\");\r\npeticio.setTipusDocument(\"NIF\");\r\nDataResponse resposta = atcConnector.informeSituacioDeute(peticio); //<-- Petició al servei\r\n    \r\nEstatAsincron estatResposta = atcConnector.getEstatInformeSituacioDeute(resposta.getResponse()); //<-- Comprovació estat petició\r\nint tempsEstimat = estatResposta.getTempsEstimatResposta();\r\n  \r\n...\r\n    \t\r\nInformacio inf = atcConnector.getDadesInformeSituacioDeute(resposta.getServei()); //<-- Recuperació resposta a la petició\r\n```\r\n\r\nPer més informació sobre les dades d'entrada i sortida d'aquesta modalitat es pot consultar el document \"Guia d'us del servei de l'ATCv1.4.3.pdf\"\r\n\r\n#### Exemple d'utilització d'una modalitat de Servei TGSS\r\n\r\nRecuperar el bean del servei de TGSS des de la classe on es vol utilitzar:\r\n\r\n```java\r\n@Autowired\r\nprivate TgssConnectorImpl tgssConnector;\r\n```\r\n\r\nEn aquest cas d'exemple es consumirà la modalitat de servei TGSS_AL_CORRENT_PAGAMENT que especifica si una persona o una organització té algun deute amb la seguretat social en el moment de fer la consulta.\r\n\r\nNOTA: Les dades de nom, cognom1 i 2, nom complet i el valor del document sobre l'exemple son inventades.\r\n\r\n```java\r\nDadesPeticioTGSS peticio = new DadesPeticioTGSS();\r\npeticio.setNom(\"Nom\");\r\npeticio.setCognom1(\"Cognom1\");\r\npeticio.setCognom2(\"Cognom2\");\r\npeticio.setNomComplet(null);\r\npeticio.setTipusDocumentacioInt(Constants.TGSS_NIF);\r\npeticio.setDocument(\"12345678B\");\r\n\r\nRespostaAlCorrentDePagament resposta = tgssConnector.alCorrentPagament(peticio);\r\n```\r\n\r\nPer més informació sobre les dades d'entrada i sortida d'aquesta modalitat es pot consultar el document \"Guia d'us del servei de TGSS v1.6.pdf\"\r\n\r\n#### Exemple d'utilització del servei AEAT_ATC_TGSS\r\n\r\nRecuperar el bean del servei de AEAT_ATC_TGSS des de la classe on es vol utilitzar:\r\n\r\n```java\r\n@Autowired\r\nprivate TgssConnectorImpl tgssConnector;\r\n```\r\n\r\nEn aquest cas d'exemple es consumirà la modalitat de servei AEAT_ATC_TGSS_CONSULTA_DEUTES que retorna les dades conjuntes de les modalitats següents:\r\n\r\n-AEAT: Certificat d'obligacions tributàries (AEAT_PICA_C1)<br>\r\n-ATC: Informe de situació de deutes amb la Generalitat de Catalunya (ATC_INF_DEUTES_TMP)<br>\r\n-TGSS: Informe de situació de deutes de la TGSS (TGSS_AL_CORRENT_PAGAMENT)\r\n\r\nDonat que el servei AEAT_ATC_TGSS es consumeix de forma asíncrona la forma correcta per poder consumir-ho es realitza en 3 fases:\r\n\r\n1. Fer petició al Servei\r\n2. Testar l'estat de resolució de la petició\r\n3. Recuperar les dades de la petició\r\n\r\nNOTA: Les dades de nom, cognom1 i 2, nom complet i el valor del document sobre l'exemple son inventades.\r\n\r\n```java\r\nDadesPeticioAEAT_ATC_TGSS peticio = new DadesPeticioAEAT_ATC_TGSS();\r\n\t\t\t\r\npeticio.setIdioma(\"Català\");\r\npeticio.setTipusDocumentacio(Constants.AAT_NIF);\r\npeticio.setDocument(\"12345678B\");\r\npeticio.setNom(\"Nom\");\r\npeticio.setNomComplet(\"Nom Cognom1 Cognom2\");\r\npeticio.setCognom1(\"Cognom1\");\r\npeticio.setCognom2(\"Cognom2\");\r\n\t\t\t\r\nresposta = aeatAtcTgssConnector.consultaDeutes(peticio); //<-- Petició al servei\r\n\t\t\r\nEstatAsincron estatResposta = aeatAtcTgssConnector.getEstatConsultaDeutes(resposta.getResponse()); //<-- Consulta de l'estat de la petició\r\nint tempsEstimat = estatResposta.getTempsEstimatResposta();\r\n\t\r\n...\r\n\r\nRespostaConsultaDeutes dadesResposta = aeatAtcTgssConnector.getDadesConsultaDeutes(resposta.getServei()); //<-- recuperació de les dades de la petició\r\n```\r\n\r\nPer més informació sobre les dades d'entrada i sortida d'aquesta modalitat es pot consultar el document \"Guia d'us del servei deutes del contribuent AEAT-ATC-TGSS v1.1.pdf\"\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC10cmlidXRz"},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtc3Vwb3J0L21vZHVsLWNvcnJldQ==":{"date":1427456704000,"title":"Correu","description":"Enviament de correu electrònic.","sections":"Canigó. Documentació versió 3.x","weight":1,"path":"/canigo-documentacio-versions-3x-suport/modul-correu","content":"## Propòsit\r\n\r\nAquest mòdul té com a objectiu permetre l'enviament de correus electrònics a una o diverses adreces especificades a qualsevol dels següents recipients:\r\n\r\n* Destinataris principals\r\n* Destinataris secundaris\r\n* Destinataris ocults\r\n\r\nPermet diferents modes d'enviament, tant en text pla, com en mode HTML, i en tots 2 casos oferint la possibilitat d'adjuntar un o més fitxers en mode adjunt o inline. \r\n\r\nVersions i Dependències\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer tal d'instal-lar el mòdul d'enviament de correu es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.support.mailing.version>[1.3.0,1.4.0)</canigo.support.mailing.version>\r\n\r\n<dependency>\r\n\t<groupId>cat.gencat.ctti</groupId>\r\n\t<artifactId>canigo.support.mailing</artifactId>\r\n\t<version>${canigo.support.mailing.version}</version>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració es realitza automàticament a partir de la eina de suport al desenvolupament.\r\n\r\nL'eina de desenvolupament genera automàticament el fitxer de propietats necessari per a la configuració del servei.\r\n\r\nUbicació proposada: <PROJECT_ROOT>/src/main/resources/config/props/mail.properties\r\n\r\nPropietat                | Requerit | Valor Defecte | Descripció\r\n------------------------ | -------- | ------------- | -----------\r\n*.mail.host              | Sí       |               | Nom del servidor de correu sortint (smtp).\r\n*.mail.port              | No       |      25       | Port del servidor de correu sortint (smtp). \r\n*.mail.protocol          | No       |     smtp      | Protocol del servidor de correu sortint (smtp).\r\n*.mail.username          | No       |               | Usuari de connexió al servidor de correu sorting (smtp).\r\n*.mail.password          | No       |               | Password de l'usuari de connexió.\r\n*.mail.defaultEncoding   | No       |     UTF-8     | Encoding per defecte del correu.  \r\n*.mail.maxAttachmentSize | No       |0(sense límits)| Tamany màxim permés dels fitxers adjunts. \r\n*.mail.isSmtpSSLEnabled  | No       |     false     | Habilitar o deshabilitar SSL.\r\n*.mail.debug             | No       |     false     | Activar les traces de debug.\r\n*.mail.timeout           | No       |     8500      | Timeout pel servidor de correu(ms).\r\n\r\n\r\n## Utilització del Mòdul\r\n\r\n### Directe\r\n\r\nA la versió 1.3.0 del mòdul s'ha creat la interfície `cat.gencat.ctti.canigo.arch.support.mailing.FluentMailService` seguint l'especificació *Fluent Builder*, proporcionant més flexibilitat i claredat en la definició dels paràmetres.\r\nUn exemple d'ús directe és el següent:\r\n\r\n```java\r\nimport cat.gencat.ctti.canigo.arch.support.mailing.FluentMailService;\r\n\r\nimport org.springframework.stereotype.Service;\r\n\r\n@Service\r\npublic class MyExampleClass {\r\n\r\n\t@Autowired\r\n\tprivate FluentMailService fluentMailService;\r\n\r\n\tpublic void sendTestEmail(boolean isHtml, boolean isInlineAttachment) {\r\n\r\n\t\tfluentMailService.send(fluentMailService //\r\n\t\t\t\t.from(\"from@test.com\") //\r\n\t\t\t\t.to(\"to@test.com\") //\r\n\t\t\t\t.subject(\"títol\") //\r\n\t\t\t\t.message(\"The results are OK.\", isHtml) //\r\n\t\t\t\t.attachments(new Attachment(logoByteArray, \"companyLogo.gif\", isInlineAttachment),\r\n\t\t\t\t\t\tnew Attachment(pdfInputStream, \"results.pdf\", false)) //\r\n\t\t);\r\n\t}\r\n}\r\n```\r\n\r\n### REST\r\n\r\nPer a utilitzar aquest mòdul, cal crear un Controller i un Service:\r\n\r\n**MailAplicacioService.java**\r\n\r\nClasse Java on es realitzarà la lògica de la operació a realitzar i es connecta amb el mòdul d'enviament de correus.\r\n\r\n```java\r\nimport org.slf4j.Logger;\r\nimport org.slf4j.LoggerFactory;\r\nimport org.springframework.beans.factory.annotation.Autowired;\r\nimport org.springframework.context.annotation.Lazy;\r\nimport org.springframework.stereotype.Service;\r\n\r\nimport cat.gencat.ctti.canigo.arch.support.mailing.MailService;\r\n\r\n@Service(\"mailAplicacioService\")\r\n@Lazy\r\npublic class MailAplicacioService {\r\n\r\n\tprivate static final Logger log = LoggerFactory.getLogger(MailAplicacioService.class);\r\n\r\n\t@Autowired\r\n\tprivate MailService service;\r\n    \r\n\r\n\r\n\tpublic String testEmail(String from, String subject, String body, boolean isHtml, String to){\r\n\t\t\r\n\t\tString message;\r\n\r\n        try{\r\n        \tthis.service.send(from, subject, body, isHtml, to);\r\n        }catch(Exception e){\r\n        \tmessage = \"Error al test: \" + e.getMessage();\r\n        \tlog.error(e.getMessage(), e);\r\n        }\r\n        \r\n        message = \"Test correcte\";\r\n        return message;\r\n\r\n    }\r\n\t\r\n}\r\n```\r\n\r\n**MailServiceController.java**  \r\n\r\nController que publica les operacions disponibles per a qui hagi de consumir-les\r\n\r\n```java\r\nimport org.springframework.beans.factory.annotation.Autowired;\r\nimport org.springframework.http.MediaType;\r\nimport org.springframework.web.bind.annotation.PostMapping;\r\nimport org.springframework.web.bind.annotation.RequestMapping;\r\nimport org.springframework.web.bind.annotation.RequestParam;\r\nimport org.springframework.web.bind.annotation.RestController;\r\n\r\nimport cat.gencat.plantilla32.service.MailAplicacioService;\r\n\r\n@RestController\r\n@RequestMapping(\"/mail\")\r\npublic class MailServiceController {\r\n\r\n\t@Autowired\r\n\tMailAplicacioService mailAplicacioService;\r\n\r\n\r\n\t@PostMapping(produces = { MediaType.APPLICATION_JSON_VALUE })\r\n\tpublic String testEnotum(@RequestParam String from, \r\n\t\t\t@RequestParam String subject,\r\n\t\t\t@RequestParam String body,\r\n\t\t\t@RequestParam boolean isHtml,\r\n\t\t\t@RequestParam String to) throws Exception {\r\n\t\treturn mailAplicacioService.testEmail(from, subject, body, isHtml, to);\r\n\t}\r\n}\r\n```\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtc3Vwb3J0L21vZHVsLWNvcnJldQ=="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtc3Vwb3J0L21vZHVsLWZ1c2lvLWRvY3VtZW50cw==":{"date":1427965562000,"title":"Fusió de documents","description":"Mòdul de fusió de documents.","sections":"Canigó. Documentació versió 3.x","weight":2,"path":"/canigo-documentacio-versions-3x-suport/modul-fusio-documents","content":"## Propòsit\r\n\r\nAquest servei permet aplicar un conjunt de canvis definits per un diccionari sobre un document en format WordML.\r\n\r\nEs parteix d'un document que conté un o més marcadors que han de ser substituits i d'un conjunt de diccionaris de substitució.\r\n\r\nPer cada un dels diccionaris de substitució, el servei de merging realitza la substitució de cada marcador pel valor indicat en el diccionari i el resultat és un nou document, també en format WordML.\r\n\r\nEls marcadors consisteixen en una marca d'inici, un texte-clau i una marca de final.\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer tal d'instal-lar el mòdul de fusió es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.support.merging.version>[1.2.0,1.3.0)</canigo.support.merging.version>\r\n\r\n<dependency>\r\n    <groupId>cat.gencat.ctti</groupId>\r\n    <artifactId>canigo.support.merging</artifactId>\r\n    <version>${canigo.support.merging.version}</version>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració es realitza automàticament a partir de la eina de suport al desenvolupament.\r\n\r\nL'eina de desenvolupament genera automàticament el fitxer de propietats necessari per a la configuració del servei.\r\n\r\nUbicació proposada: <PROJECT_ROOT>/src/main/resources/config/props/merging.properties\r\n\r\nPropietat              | Requerit | Descripció\r\n---------------------- | -------- | ---------------------------------------------------------------------\r\n*.merging.initBookmark | No       | Marca d'inici del texte a substituir (2 caràcters). Per defecte: @@.\r\n*.merging.endBookmark  | No       | Marca de final del texte a substituir (2 caràcters). Per defecte: ##h2. Utilització del Mòdul.\r\n\r\n### Utilització del Mòdul\r\n\r\n### REST\r\n\r\nPer a utilitzar aquest mòdul, cal crear un Controller i un Service:\r\n\r\n**MergingService.java**\r\n\r\nClasse Java on es realitzarà la lògica de la operació a realitzar i es connecta amb el mòdul de Fusió de documents.\r\n\r\n```java\r\nimport java.io.ByteArrayOutputStream;\r\nimport java.io.File;\r\nimport java.io.FileOutputStream;\r\nimport java.io.InputStream;\r\nimport java.util.ArrayList;\r\nimport java.util.HashMap;\r\nimport java.util.List;\r\nimport java.util.Map;\r\n\r\nimport org.slf4j.Logger;\r\nimport org.slf4j.LoggerFactory;\r\nimport org.springframework.beans.factory.annotation.Autowired;\r\nimport org.springframework.context.annotation.Lazy;\r\nimport org.springframework.stereotype.Service;\r\n\r\nimport cat.gencat.ctti.canigo.arch.support.merging.MergeTemplateEngine;\r\n\r\n@Service(\"mergingService\")\r\n@Lazy\r\npublic class MergingService {\r\n\r\n\tprivate static final Logger log = LoggerFactory.getLogger(MergingService.class);\r\n\r\n\t@Autowired\r\n    private MergeTemplateEngine engine;\r\n    \r\n\r\n\r\n\tpublic String testMerging(){\r\n\t\t\r\n\t\tString message;\r\n\r\n\t\tHashMap<String,String> itemsMap = new HashMap<String,String>();\r\n\t\titemsMap.put(\"cosa\", \"Mancha\");\r\n\t\titemsMap.put(\"marca\", \"Funciona\");\r\n\r\n        List<Map<String,String>> dades = new ArrayList<Map<String,String>>();\r\n        dades.add(itemsMap);\r\n\r\n        try{\r\n            InputStream is = Thread.currentThread().getContextClassLoader().getResourceAsStream(\"TestDoc.xml\");\r\n            ByteArrayOutputStream[] os = engine.mergeTemplate(is, dades);\r\n\r\n            FileOutputStream ouputStream = new FileOutputStream(new File(\"c://tmp//file.xml\"));\r\n            ouputStream.flush();\r\n            ouputStream.write(os[0].toByteArray(), 0, os[0].size());\r\n            ouputStream.flush();\r\n            ouputStream.close();\r\n            \r\n\r\n        }catch(Exception e){\r\n        \tmessage = \"Test mergint erroni :\" + e.getMessage();\r\n        \tlog.error(e.getMessage(),e);\r\n        }\r\n        \r\n        message = \"Test merging correcte\";\r\n        \r\n        return message;\r\n\r\n    }\r\n}\r\n```  \r\n\r\n**MergingServiceController.java**\r\n\r\nController que publica les operacions disponibles per a qui hagi de consumir-les\r\n\r\n```java\r\nimport org.springframework.beans.factory.annotation.Autowired;\r\nimport org.springframework.http.MediaType;\r\nimport org.springframework.web.bind.annotation.PostMapping;\r\nimport org.springframework.web.bind.annotation.RequestMapping;\r\nimport org.springframework.web.bind.annotation.RestController;\r\n\r\nimport cat.gencat.plantilla32.service.MergingService;\r\n\r\n@RestController\r\n@RequestMapping(\"/merging\")\r\npublic class MergingServiceController {\r\n\r\n\t@Autowired\r\n\tMergingService mergingService;\r\n\r\n\r\n\t@PostMapping(produces = { MediaType.APPLICATION_JSON_VALUE })\r\n\tpublic String testMerging() throws Exception {\r\n\t\treturn mergingService.testMerging();\r\n\t}\r\n}\r\n```\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtc3Vwb3J0L21vZHVsLWZ1c2lvLWRvY3VtZW50cw=="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtc3Vwb3J0L21vZHVsLXNmdHA=":{"date":1427960649000,"title":"SFTP","description":"Transferència d'arxius de manera segura.","sections":"Canigó. Documentació versió 3.x","weight":4,"path":"/canigo-documentacio-versions-3x-suport/modul-sftp","content":"## Propòsit\r\n\r\nEl servei de SFTP de Canigó permet enviar i rebre arxius entre el servidor on s'executa l'aplicació a altres servidors de forma segura mitjançant l'intercanvi de claus.\r\n\r\nEl servei està basat en les llibreries JSCH i Commons-VFS, la primera es tracta d'un projecte open source que permet la connexió via SSH a qualsevol màquina. La segona llibrería és un projecte també open_source de la Apache Foundation que permet treballar amb més facilitat amb la JSCH, donant eines per crear connexions SFTP (entre d'altres) contra un servidor.\r\n\r\n## Documents i Fonts de Referència\r\n\r\nNom         | URL\r\n----------- | ------------------------------------\r\nJSCH        | [http://www.jcraft.com/jsch/](http://www.jcraft.com/jsch/)\r\nCommons VFS | [http://commons.apache.org/vfs/](http://commons.apache.org/vfs/)\r\n\r\n## Glossari\r\n\r\n**SFTP**  \r\nSecure File Transfer Protocol (Protocol de Transferència Segura d'Arxius), es tracta d'un protocol de transferència de fitxers entre computadors de forma segura.\r\n\r\n**Download**  \r\nRebre arxius des d'un servidor.\r\n\r\n**Upload**  \r\nEnviar arxius a un servidor.\r\n\r\n**Socket**  \r\nPort del servidor habilitat per realitzar la transferència de fitxers/streams mitjançant el protocol SFTP.  \r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer tal d'instal-lar el mòdul d'SFTP es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.support.sftp.version>[1.2.0,1.3.0)</canigo.support.sftp.version>\r\n\r\n<dependency>\r\n\t<groupId>cat.gencat.ctti</groupId>\r\n\t<artifactId>canigo.support.sftp</artifactId>\r\n\t<version>${canigo.support.sftp.version}</version>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració es realitza automàticament a partir de la eina de suport al desenvolupament.\r\n\r\nL'eina de desenvolupament genera automàticament el fitxer de propietats necessari per a la configuració del servei.\r\n\r\nUbicació proposada: <PROJECT_ROOT>/src/main/resources/config/props/sftp.properties\r\n\r\nPropietat |\tRequerit | Descripció\r\n--------- | -------- | ----------\r\n*.sftp.url |Sí | Host del servidor sftp.\r\n*.sftp.port | No | Port del servidor sftp. Valor per defecte: 22.\r\n*.sftp.username | No | Usuari de connexió al servidor de secure ftp (sftp).\r\n*.sftp.password | No | Password de l'usuari de connexió.\r\n*.sftp.identityPath | No | Path del fitxer de claus privades. El fitxer ha de tenir format OpenSSH (RSA o DSA).\r\n*.sftp.strictHostKeyChecking | No | Indica si volem intercanviar claus amb el servidor o no. Valor per defecte: no.\r\n*.sftp.knownHosts | No | Directori on es troba el fitxer de claus SSH.\r\n*.sftp.proxyType  | No | Tipus de proxy.\r\n*.sftp.proxyHost  | No | Adreça del proxy.\r\n*.sftp.proxyPort  | No | Port del proxy. Valor per defecte: 8080.\r\n*.sftp.userDirIsRoot | No | Possibilitat d'indicar els paths relatius al directori home de l'usuari.<br>true --> Paths relatius a partir del directori home<br>false --> Paths absoluts. Valor per defecte.\r\n*.sftp.uploadChecksum | No | Ofereix la possibilitat de generar i pujar un fitxer de checksum.<br>default --> Generarà i farà l'upload d'un fitxer .md5 a més del fitxer indicat.<br>all --> Generarà i farà l'upload d'un fitxer .md5, .sha1 a més del fitxer indicat.<br>md5 --> Generarà i farà l'upload d'un fitxer .md5 a més del fitxer indicat.<br>sha1 --> Generarà i farà l'upload d'un fitxer .sha1 a més del fitxer indicat.<br>none --> No generarà cap fitxer de checksum. El mateix que si no s'informa aquesta propietat.\r\n*.sftp.uploadChecksumException | No | Serveix per a indicar si un error de checksum és bloquejant o no.<br>true --> Si es produeix un error al generar el fitxer de checksum, es llançarà una excepció i no es pujarà el fitxer al servidor.<br>false --> Si es produeix un error al generar el fitxer de checksum, es mostrarà un log d'error, però continuarà la pujada del fitxer indicat al servidor.\r\n*.sftp.downloadChecksum | No | Ofereix la possibilitat de generar i pujar un fitxer de checksum.<br>default --> Validarà que el fitxer descarregat és correcte mitjançant el fitxer .md5.<br>md5 --> Validarà que el fitxer descarregat és correcte mitjançant el fitxer .md5.<br>sha1 --> Validarà que el fitxer descarregat és correcte mitjançant el fitxer .sha1.<br>none --> No realitzarà cap tipus de validació sobre el fitxer descarregat\r\n*.sftp.downloadChecksumValidation | No | Serveix per a indicar el nivell de bloqueig del checksum.<br>exception --> Si no coincideix el checksum generat del fitxer descarregat amb el que hi ha al servidor es llançarà una excepció.<br>log --> Si no coincideix el checksum generat del fitxer descarregat amb el que hi ha al servidor mostrarà un log d'error.<br>none --> Si no coincideix el checksum generat del fitxer descarregat amb el que hi ha al servidor no farà res..\r\n\r\nEls arxius de configuració que contenen els beans del mòdul i que serán carregats per Spring, son automàticament registrats pel core de Canigó, per lo que el desenvolupador no ha de definir cap arxiu XML per aixecar el servei.\r\n\r\n### Utilització del Mòdul\r\n\r\nPer accedir al mòdul de SFTP, el desenvolupador pot realitzar una crida de forma externa mitjançant el patró 'Dependency Injection'.\r\n\r\nPodem diferenciar dues formes d'injectar-ho:\r\n\r\n* Per XML:\r\n\r\n```\r\n<bean id=\"tractamentClients\"  class=\"cat.gencat.demo.mbean.TractamentClient\">\r\n    <property name=\"sftpService\" ref=\"sftpService\" />\r\n</bean>\r\n```\r\n\r\nLa clase TractamentClient tindria la següent estructura:\r\n\r\n```java\r\nimport cat.gencat.ctti.canigo.arch.support.sftp.SftpService;\r\npublic class TractamentClient{\r\n   private SftpService sftpService;\r\n\r\n   public void setSftpService(SftpService service){\r\n       this.sftpService = service;\r\n   }\r\n\r\n   public void execute(){\r\n       sftpService.login();\r\n   }\r\n}\r\n```\r\n\r\nInjecció del mòdul de configuració dins del bean \"tractamentClients\". Spring s'encarregarà d'injectar el mòdul de SFTP executant el mètode setSftpService.\r\n\r\n* Per anotacions:\r\n\r\n```java\r\nimport cat.gencat.ctti.canigo.arch.support.sftp.SftpService;\r\n\r\n@Component(\"tractamentClients\")\r\npublic class TractamentClient{\r\n   @Autowired\r\n   private SftpService sftpService;\r\n\r\n   public void execute(){\r\n       sftpService.login();\r\n   }\r\n}\r\n```\r\n\r\n#### Realitzar connexió\r\n\r\nTenim diferents maneres de realitzar la connexió:\r\n\r\n* Els paràmetres de connexió venen informats a l'arxiu de propietats. El mòdul de SFTP farà servir aquestes propietats per gestionar la connexió al servidor.\r\n\r\n```java\r\nsftpService.login();\r\n```\r\n\r\n\r\n* Si no hem indicat a través de la configuració l'usuari i la contrasenya per realitzar la connexió, s'indicarà manualment en al crida.\r\n\r\n```java\r\nsftpService.login(usuari,contrasenya);\r\n```\r\n\r\n* Servidor, usuari, contrasenya i port no informat.\r\n\r\n```java\r\nsftpService.login(usuari, contrasenya, ftpUrl, ftpPort);\r\n```\r\n\r\nPer realitzar una connexió al servidor a través d'un proxy cal informar les següents propietats a l'arxiu de configuració del mòdul:  \r\n \r\n* sftp.proxyType: Tipus de proxy, pot tenir els valors http o socks.\r\n* sftp.proxyHost: Adreça del host.\r\n* sftp.proxyPort: Port del host.\r\n\r\n\r\n#### Realitzar desconnexió del servidor SFTP\r\n\r\nPer realitzar la desconnexió del servidor FTP seguirem un patró com el mostrat en el següent exemple:\r\n\r\n1. Validem que estem conectats.\r\n2. Desconectem en el cas de estar logats al servidor.\r\n\r\n```java\r\nif (sftpService.isLogged()) {\r\n    sftpService.logout();\r\n}\r\n```\r\n\r\n\r\n#### Realitzar download d'un fitxer\r\n\r\nPer realitzar un download d'un fitxer seguirem un patró com el mostrat en el següent exemple:\r\n\r\n```java\r\nsftpService.login();\r\nif (sftpService.isLogged()) {\r\n    sftpService.downloadFile(fileName, localPath, remotePath);\r\n    sftpService.logout();\r\n}\r\n```\r\n\r\nRealitzarem doncs els següents passos:\r\n\r\n1. Cridem al mètode login() per realitzar la connexió i l'autentificació al servidor remot mitjançant el protocol SFTP.\r\n2. En cas de que la connexió al servidor remot s'hagi realitzat correctament es crida al mètode downloadFile() per realitzar el download del fitxer del servidor remot.\r\n3. Realitzar la desconnexió del servidor SFTP.\r\n\r\nEs crida el mètode downloadFile() que amb els següents paràmetres:\r\n\r\nOrdre | Requerit | Tipus  | Descripció\r\n----- | -------- | ------ | ------------------------------------------------------------------\r\n1     | Si       | String | Nom del fitxer del servidor remot que es vol realitzar el download.\r\n2     | Si       | String | Directori local on es vol guardar el fitxer.\r\n3     | Si       | String | Directori remot on es troba el fitxer a baixar.\r\n\r\nI retorna:\r\n\r\nOrdre | Requerit | Tipus   | Descripció\r\n----- | -------- | ------- | ----------------------------------------------------------------\r\n1     | Si       | boolean | TRUE o FALSE segons s'ha realitzat correcta o incorrectament el procés.\r\n\r\n#### Realitzar upload d'un fitxer\r\n\r\nPer realitzar un upload d'un fitxer seguirem un patró com el mostrat en el següent exemple:\r\n\r\n```java\r\nsftpService.login();\r\nif (sftpService.isLogged()) {\r\n    sftpService.uploadFile(fileName, localPath, remotePath);\r\n    sftpService.logout();\r\n}\r\n```\r\n\r\nRealitzarem doncs els següents passos:\r\n\r\n1. Cridem al mètode login() per realitzar la connexió i l'autentificació al servidor remot mitjançant el protocol SFTP.\r\n2. En cas de que la connexió al servidor remot s'hagi realitzat correctament es crida al mètode uploadFile() per realitzar el upload del fitxer del servidor local al servidor remot.\r\n3. Realitzar la desconnexió del servidor SFTP.\r\n\r\nEs crida el mètode uploadFile() que amb els següents paràmetres:\r\n\r\nOrdre | Requerit  | Tipus  | Descripció\r\n----- | --------- | ------ | -----------------------------------------------------------------\r\n1     | Si        | String | Nom del fitxer del servidor remot que es vol realitzar el upload.\r\n2     | Si        | String | Directori local on es troba el fitxer a pujar.\r\n3     | Si        | String | Directori remot on es vol guardar el fitxer.\r\n\r\n#### Obtenir la llista de noms dels fitxers del servidor remot\r\n\r\nPer obtenir la llista de fitxers en una carpeta d'un servidor remot seguirem un patró com el mostrat en el següent exemple:\r\n\r\n```java\r\nsftpService.login();\r\nif (sftpService.isLogged()) {\r\n    FileObject[] listFiles = sftpService.listFiles(remotePath);\r\n    sftpService.logout();\r\n}\r\n```\r\n\r\nRealitzarem doncs els següents passos:\r\n\r\n1. Cridem al mètode login() per realitzar la connexió i l'autentificació al servidor remot mitjançant el protocol SFTP.\r\n2. En cas de que la connexió al servidor remot s'hagi realitzat correctament es crida al mètode listFiles() per obtenir una llista de fitxers en una carpeta d'un servidor remot.\r\n\r\nEs crida el mètode listFiles() que amb els següents paràmetres:\r\n\r\nOrdre | Requerit | Tipus  | Descripció\r\n----- | -------- | ------ | ----------\r\n1     | Sí       | String | Nom de la carpeta del servidor remot d'on es vol obtenir la llista de fitxers.\r\n\r\nEl mètode retorna un array de FileObject, interfícies de la llibrería Commons VFS que ens donen una sèrie de mètodes per a treballar amb els fitxers remots.\r\n\r\n#### Crear un fitxer al servidor remot\r\n\r\nPer crear un fitxer al servidor remot seguirem un patró com el mostrat en el següent exemple:\r\n\r\n```java\r\nsftpService.login();\r\nif (sftpService.isLogged()) {\r\n    createFile(fileName, remotePath);\r\n    sftpService.logout();\r\n}\r\n```\r\n\r\nRealitzarem doncs els següents passos:\r\n\r\n1. Cridem al mètode login() per realitzar la connexió i l'autentificació al servidor remot mitjançant el protocol SFTP.\r\n2. En cas de que la connexió al servidor remot s'hagi realitzat correctament es crida al mètode createFile() per crear el fitxer en el servidor remot.\r\n\r\nEs crida el mètode createFile() que amb els següents paràmetres:\r\n\r\nOrdre | Requerit | Tipus  | Descripció\r\n----- | -------- | ------ | -----------\r\n1     | Si       | String | Nom del fitxer a crear en el servidor remot.\r\n2     | Si       | String | Directori remot on es vol crear el fitxer.\r\n\r\nEl mètode retorna un boolean TRUE o FALSE segons s'ha realitzat correcta o incorrectament el procés.\r\n\r\n#### Crear un directori al servidor remot\r\n\r\nPer crear un directori al servidor remot seguirem un patró com el mostrat en el següent exemple:\r\n\r\n```java\r\nsftpService.login();\r\nif (sftpService.isLogged()) {\r\n    createFolder(folderName, remotePath);\r\n    sftpService.logout();\r\n}\r\n```\r\n\r\nRealitzarem doncs els següents passos:\r\n\r\n1. Cridem al mètode login() per realitzar la connexió i l'autentificació al servidor remot mitjançant el protocol SFTP.\r\n2. En cas de que la connexió al servidor remot s'hagi realitzat correctament es crida al mètode createFolder() per crear el fitxer en el servidor remot.\r\n\r\nEs crida el mètode createFolder() que amb els següents paràmetres:\r\n\r\nOrdre | Requerit | Tipus  | Descripció\r\n----- | -------- | ------ | -----------\r\n1     | Si       | String | Nom del directori a crear en el servidor remot.\r\n2     | Si       | String | Directori remot on es vol crear el directori.\r\n\r\nEl mètode retorna un boolean TRUE o FALSE segons s'ha realitzat correcta o incorrectament el procés.\r\n\r\n#### Esborrar un fitxer al servidor remot\r\n\r\nPer esborrar un fitxer al servidor remot seguirem un patró com el mostrat en el següent exemple:\r\n\r\n```java\r\nsftpService.login();\r\nif (sftpService.isLogged()) {\r\n    deleteFile(fileName, remotePath);\r\n    sftpService.logout();\r\n}\r\n```\r\n\r\nRealitzarem doncs els següents passos:\r\n\r\n1. Cridem al mètode login() per realitzar la connexió i l'autentificació al servidor remot mitjançant el protocol SFTP.\r\n2. En cas de que la connexió al servidor remot s'hagi realitzat correctament es crida al mètode deleteFile() per crear el fitxer en el servidor remot.\r\n\r\nEs crida el mètode deleteFile() que amb els següents paràmetres: \r\n\r\nOrdre | Requerit | Tipus  | Descripció\r\n----- | -------- | ------ | -----------   \r\n1     | Si       | String | Nom del fitxer a esborrar en el servidor remot.\r\n2     | Si       | String | Directori remot on es troba el fitxer.\r\n\r\nEl mètode retorna un boolean TRUE o FALSE segons s'ha realitzat correcta o incorrectament el procés.\r\n\r\n## Exemples\r\n\r\n### Tests Unitaris\r\n\r\nUn exemple d'utilització del mòdul de SFTP són els tests unitaris.\r\n\r\nS'ha de tenir en compte que s'ha de disposar d'accés a un servidor remot mitjançant el protocol SFTP per poder realitzar els tests.\r\n\r\nSuposem que la configuració del\r\n\r\n```java\r\n/**\r\n * Unit test for mailing service\r\n */\r\n@RunWith(SpringJUnit4ClassRunner.class)\r\n@ContextConfiguration(locations = {\"../../core/config/canigo-core.xml\"})\r\npublic class SftpServiceReleaseTest{\r\n\t// File exchange\r\n\tprivate String fileName\t\t\t\t\t= null;\r\n\tprivate String localPath\t\t\t\t= null;\r\n\tprivate String remotePath\t\t\t\t= null;\r\n\tprivate String tempName \t\t\t\t= null;\r\n\r\n\t@Autowired\r\n\t@Qualifier(\"sftpService\")\r\n\tSftpService sftpService;\r\n\r\n\t@Before\r\n\tpublic void setUp() throws AddressException{\r\n\t\tfileName = \"sftp.properties\";\r\n\t\tremotePath = \"/home/continuum/tmp\";\r\n\t\tlocalPath = this.getClass().getResource(\"/temp/arxiu_pujar.pdf\").getPath();\r\n\t\tlocalPath = localPath.substring(0, (localPath.lastIndexOf(\"/\")+1));\r\n\t}\r\n\r\n\t/**\r\n\t* Documentació.\r\n\t*\r\n\t* @throws Exception Documentació\r\n\t*/\r\n\t@Test\r\n\tpublic void testLogin() throws Exception {\r\n\t\ttry {\r\n\t\t\tAssert.assertTrue(sftpService.login());\r\n\t\t\tif (sftpService.isLogged()) {\r\n\t\t\t\tsftpService.logout();\r\n\t\t\t}\r\n\t\t} catch (SftpModuleException e) {\r\n\t\t\tAssert.fail();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t* Documentació.\r\n\t*\r\n\t* @throws Exception Documentació\r\n\t*/\r\n\t@Test\r\n\tpublic void testLogout() throws Exception {\r\n\t\ttry {\r\n\t\t\tsftpService.login();\r\n\t\t\tAssert.assertTrue(sftpService.logout());\r\n\t\t} catch (SftpModuleException e) {\r\n\t\t\tAssert.fail();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t* Documentació.\r\n\t*\r\n\t* @throws Exception Documentació\r\n\t*/\r\n\t@Test\r\n\tpublic void testLogoutFailed() throws Exception {\r\n\t\ttry {\r\n\t\t\tAssert.assertFalse(sftpService.logout());\r\n\t\t} catch (SftpModuleException e) {\r\n\t\t\tAssert.fail();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t* Documentació.\r\n\t*\r\n\t* @throws Exception Documentació\r\n\t*/\r\n\t@Test\r\n\tpublic void testUploadFile() throws Exception {\r\n\t\ttry {\r\n\t\t\tsftpService.login();\r\n\t\t\tif(sftpService.isLogged()) {\r\n                                sftpService.uploadFile(fileName, localPath, remotePath);\r\n\t\t\t        Assert.assertTrue(sftpService.existsFile(fileName, remotePath));\r\n\t\t\t\tsftpService.logout();\r\n\t\t\t}else{\r\n                                Assert.fail();\r\n                        }\r\n\t\t} catch (SftpModuleException e) {\r\n\t\t\tAssert.fail();\r\n\t\t}\r\n\t}\r\n\r\n}\r\n```\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtc3Vwb3J0L21vZHVsLXNmdHA="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtc3Vwb3J0L21vZHVsLXVwbG9hZA==":{"date":1427460735000,"title":"Pujada d'arxius","description":"Pujada d'arxius al servidor.","sections":"Canigó. Documentació versió 3.x","weight":5,"path":"/canigo-documentacio-versions-3x-suport/modul-upload","content":"## Propòsit\r\n\r\nAquest mòdul permet al servidor obtenir fitxers adjunts als formularis HTML de client. A més aquest mòdul permet llegir el fitxer de forma directa, deser-lo al sistema de fitxers, emmagatzemar-lo en una base de dades o enllaçar-ho amb altres mòduls com pot ser el servei d'antivirus.\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer tal d'instal-lar el mòdul d'upload de fitxers es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.support.fileupload.version>[1.1.0,1.2.0)</canigo.support.fileupload.version>\r\n\r\n<dependency>\r\n  <groupId>cat.gencat.ctti</groupId>\r\n  <artifactId>canigo.support.fileupload</artifactId>\r\n  <version>${canigo.support.fileupload.version}</version>\r\n</dependency>\r\n```\r\n\r\n#### JSF\r\n\r\nPer aplicacions Canigó 3 basades en JSF 2.2 s'ha d'afegir la següent dependència amb la llibreria MyFaces Tomahawk, automàticament a través de l'eina de suport al desenvolupament o bé afegint-la manualment en el pom.xml de l'aplicació:\r\n\r\n```\r\n<tomahawk>1.1.14</tomahawk>\r\n<dependency>\r\n    <groupId>org.apache.myfaces.tomahawk</groupId>\r\n    <artifactId>tomahawk21</artifactId>\r\n    <version>${tomahawk}</version>\r\n    <exclusions>\r\n        <exclusion>\r\n            <artifactId>commons-validator</artifactId>\r\n            <groupId>commons-validator</groupId>\r\n        </exclusion>\r\n        <exclusion>\r\n            <artifactId>itext</artifactId>\r\n            <groupId>com.lowagie</groupId>\r\n        </exclusion>\r\n        <exclusion>\r\n            <artifactId>jstl</artifactId>\r\n            <groupId>javax.servlet</groupId>\r\n        </exclusion>\r\n        <exclusion>\r\n            <artifactId>commons-logging</artifactId>\r\n            <groupId>commons-logging</groupId>\r\n        </exclusion>\r\n        <exclusion>\r\n            <artifactId>batik-awt-util</artifactId>\r\n            <groupId>org.apache.xmlgraphics</groupId>\r\n        </exclusion>\r\n    </exclusions>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració es realitza automàticament a partir de la eina de suport al desenvolupament.\r\n\r\n#### JSF\r\n\r\nEn el cas d'utilitzar la opció de JSF, el que fa és afegir al web.xml el següent filtre per a interceptar les peticions multipart/form-data:\r\n\r\n```\r\n<filter>\r\n    <filter-name>Extensions Filter</filter-name>\r\n    <filter-class>org.apache.myfaces.webapp.filter.ExtensionsFilter</filter-class>\r\n    <init-param>\r\n        <param-name>uploadMaxFileSize</param-name>\r\n        <param-value>20m</param-value>\r\n        <description>Set the size limit for uploaded files.\r\n            Format: 10 - 10 bytes\r\n                    10k - 10 KB\r\n                    10m - 10 MB\r\n                    1g - 1 GB\r\n        </description>\r\n    </init-param>\r\n</filter>\r\n<filter-mapping>\r\n    <filter-name>Extensions Filter</filter-name>\r\n    <url-pattern>*.jsf</url-pattern>\r\n</filter-mapping>\r\n```\r\n\r\nCal afegir manualment en la jsf la següent capçalera:\r\n\r\n```\r\nxmlns:t=\"http://myfaces.apache.org/tomahawk\"\r\n```\r\n\r\n#### Struts + Taglibs\r\n\r\nEn el cas d'utilitzar la opció d'Struts + Taglibs, la configuració del servei es realitza mitjançant un fitxer de propietats.\r\n\r\nUbicació proposada: <PROJECT_ROOT>/src/main/resources/config/props/fileupload.properties\r\n\r\nPropietat | Requerit | Descripció\r\n--------- | -------- | ----------\r\n*.fileUpload.defaultEncoding | No | Direcció IP del servidor Engine Scan del CTTI, responsable dels escaneigs.\r\n*.fileUpload.maxUploadSize   | No | Màxim tamany permés abans que es rebutgin els fitxers. Valor per defecte: -1(no hi ha límit).\r\n*.fileUpload.maxInMemorySize | No | Màxim tamany permés en bytes abans de guardar en disc. Valor per defecte: 10240 (bytes).\r\n*.fileUpload.launchExceptionIfVirusDetected | No | Opció només disponible per a la integració del fileupload i antivirus. Indica si es llençarà una excepció al servei en el cas de que es trobi un virus en l'arxiu pujat. Valor per defecte: true.\r\n\r\n## Utilització del Mòdul\r\n\r\n### JSF\r\n\r\nPer a utilitzar aquest mòdul, cal crear un bean i una jsf:\r\n\r\n***fileUploadBean.java***\r\n\r\n```java\r\n@Component(\"fileUploadBean\")\r\n@Scope(\"singleton\")\r\n@Lazy\r\npublic class FileUploadBean {\r\n\r\n\t@Autowired\r\n\tprivate I18nResourceBundleMessageSource messageResource;\r\n\tprivate UploadedFile uploadedFile;\r\n\r\n\tpublic void submit() {\r\n\r\n\t\ttry {\r\n\t\t\tif(getUploadedFile()!=null & getUploadedFile().getBytes()!=null){\r\n\t\t\t\t// Show succes message.\r\n\t\t\t    FacesContext.getCurrentInstance().addMessage(\"uploadForm\", new FacesMessage(\r\n\t\t\t        FacesMessage.SEVERITY_INFO, messageResource.getMessage(\"fileUploadSuccess\"), null));\r\n\t\t\t}else{\r\n\t\t\t\t// Show succes message.\r\n\t\t\t    FacesContext.getCurrentInstance().addMessage(\"uploadForm\", new FacesMessage(\r\n\t\t\t        FacesMessage.SEVERITY_ERROR, messageResource.getMessage(\"fileUploadError\"), null));\r\n\t\t\t}\r\n\t\t} catch (IOException e) {\r\n\t\t\tFacesContext.getCurrentInstance().addMessage(\"uploadForm\", new FacesMessage(\r\n\t\t\t        FacesMessage.SEVERITY_ERROR, messageResource.getMessage(\"fileUploadError\"), null));\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tpublic UploadedFile getUploadedFile() {\r\n\t\treturn uploadedFile;\r\n\t}\r\n\r\n\tpublic void setUploadedFile(UploadedFile uploadedFile) {\r\n\t\tthis.uploadedFile = uploadedFile;\r\n\t}\r\n\r\n}\r\n```\r\n\r\n**fileUpload.jsf**\r\n\r\n```\r\n<h:form id=\"uploadForm\" enctype=\"multipart/form-data\">\r\n    <h:panelGrid columns=\"3\">\r\n        <h:outputLabel for=\"file\" value=\"#{msg.fileUploadSelectFile}\" />\r\n        <t:inputFileUpload id=\"file\" value=\"#{fileUploadBean.uploadedFile}\" required=\"true\" />\r\n        <h:message for=\"file\" style=\"color: red;\" />\r\n        <h:panelGroup />\r\n        <h:commandButton value=\"#{msg.canigoSubmit}\" action=\"#{fileUploadBean.submit}\" />\r\n        <h:message for=\"uploadForm\" infoStyle=\"color: green;\" errorStyle=\"color: red;\" />\r\n    </h:panelGrid>\r\n</h:form>\r\n\r\n```\r\n\r\n### STRUTS+TAGLIBS\r\n\r\nPer a utilitzar el mòdul cal crear una Acció i una JSP:\r\n\r\n**app-fileupload.xml**\r\n\r\n```\r\n<bean name=\"/fileUpload\" class=\"cat.gencat.ctti.canigo.demo.fileupload.FileUploadAction\" scope=\"prototype\">\r\n    <property name=\"pojoClass\" value=\"cat.gencat.ctti.canigo.demo.fileupload.FileUploadPojo\"></property>\r\n    <property name=\"fileUpload\" ref=\"fileUploadService\" />\r\n    <!-- Configuració dels tags -->\r\n    <property name=\"tagsConfiguration\">\r\n        <map>\r\n            <entry key=\"*\">\r\n                <list>\r\n                    <bean parent=\"formTag\">\r\n                        <property name=\"styleId\" value=\"actionForm\"></property>\r\n                        <property name=\"layout\" value=\"true\"/>\r\n                        <property name=\"validationProperties\">\r\n                            <props>\r\n                                <prop key=\"validationType\">SERVER</prop>\r\n                                <prop key=\"validatorName\">uploadValidations</prop>\r\n                            </props>\r\n                        </property>\r\n                    </bean>\r\n                    <bean parent=\"submitTag\">\r\n                        <property name=\"styleId\" value=\"uploadSubmit\"/>\r\n                        <property name=\"mode\" value=\"N,D,N\"/>\r\n                        <property name=\"reqCode\" value=\"valida\"/>\r\n                        <property name=\"key\" value=\"forms.buttons.valida\"/>\r\n                        <bean parent=\"fileFieldTag\">\r\n                            <property name=\"styleId\" value=\"fileText\"></property>\r\n                            <property name=\"layout\" value=\"false\"></property>\r\n                            <property name=\"mode\" value = \"E,E,E\"></property>\r\n                        </bean>\r\n                    </bean>\r\n                </list>\r\n            </entry>\r\n        </map>\r\n    </property>\r\n</bean>\r\n```\r\n\r\n**FileUploadAction.java**\r\n\r\n```java\r\npublic class FileUploadAction extends DispatchActionSupport {\r\n\r\n\tprivate final String FORWARD_SUCCESS = \"success\";\r\n\r\n\tprivate static final Log log = LogFactory.getLog(FileUploadAction.class);\r\n\r\n\tprivate FileUploadService fileUpload;\r\n\r\n\r\n\t/**\r\n\t * Mètode que es crida pel reqCode=inici\r\n\t * @param mapping ActionMapping\r\n\t * @param form ActionForm\r\n\t * @param request HttpServletRequest\r\n\t * @param response HttpServletResponse\r\n\t * @return ActionForward\r\n\t * @throws Exception exception\r\n\t */\r\n\tpublic ActionForward upload(ActionMapping mapping, ActionForm form, HttpServletRequest request, HttpServletResponse response) throws Exception {\r\n\t\tlog.info(\"FileUploadAction [inici] - Inici\");\r\n\r\n\t\tSpringBindingActionForm actionForm = (SpringBindingActionForm)form;\r\n\t\tFileUploadPojo pojo = (FileUploadPojo) actionForm.getTarget();\r\n\r\n\t\tString[] UPLOADED_FILES = new String[] { \"fitxer\" };\r\n\t\tUploadedFiles uploadedFiles = this.fileUpload.getUploadedFiles(request, UPLOADED_FILES);\r\n\t\tUploadedFile fitxerCarregat = uploadedFiles.getFile(\"fitxer\");\r\n\r\n\t\treturn mapping.findForward(FORWARD_SUCCESS);\r\n\t}\r\n\r\n\tpublic FileUploadService getFileUpload() {\r\n\t\treturn fileUpload;\r\n\t}\r\n\r\n\tpublic void setFileUpload(FileUploadService fileUpload) {\r\n\t\tthis.fileUpload = fileUpload;\r\n\t}\r\n}\r\n```\r\n\r\n**fileUpload.jsp**\r\n\r\n```\r\n<fwk:form styleId=\"actionForm\" action=\"sfileUpload.do?reqCode=upload\" method=\"POST\" enctype=\"multipart/form-data\">\r\n\t<fwk:row>\r\n\t\t<fwk:file styleId=\"fileText\" property=\"fitxer\" key=\"label.fileupload.path\"></fwk:file>\r\n\t</fwk:row>\r\n\t<fwk:row>\r\n\t\t<fwk:submit styleId=\"uploadSubmit\"></fwk:submit>\r\n\t</fwk:row>\r\n</fwk:form>\r\n```\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtc3Vwb3J0L21vZHVsLXVwbG9hZA=="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtc3Vwb3J0L21vZHVsLWxvcGQ=":{"date":1427966947000,"title":"LOPD","description":"Aplicació de protecció de dades.","sections":"Canigó. Documentació versió 3.x","weight":3,"path":"/canigo-documentacio-versions-3x-suport/modul-lopd","content":"## Propòsit\r\n\r\nEl servei de LOPD de Canigó permet assignar un determinat nivell de protecció a les dades de l'aplicació que l'utilitzi.\r\n\r\n## Context i Escenaris d'Ús\r\n\r\nEl servei de LOPD es troba dins dels serveis generals de Canigó.  \r\nEl seu ús és necessari en cas de voler protegir dades sensibles de l'aplicació o d'enregistrar el seu accés.\r\n\r\n## A qui va dirigit\r\n\r\nAquest document va dirigit als següents perfils:\r\n\r\n* Programador. Per conèixer l'ús del servei.\r\n* Arquitecte. Per conèixer quins són els components i la configuració del servei.\r\n\r\n## Glossari\r\n\r\n**LOPD:** Llei Orgànica de Protecció de Dades\r\n\r\n## Descripció Detallada\r\n\r\n###  Arquitectura i Components\r\n\r\n#### Introducció\r\n\r\nEl servei LOPD ofereix suport a les aplicacions basades en Canigó per facilitar el compliment de la LOPD. Donat que l'aplicació dels mecanismes de seguretat afecta únicament a les dades emmagatzemades en la base de dades s'ha definit un sistema d'anotacions per tal de \"marcar\" les dades sensibles en els TO's (Transfer Object).\r\n\r\n#### Instal-lació\r\n\r\nDisposar del mòdul LOPD és pot fer mitjançant dos camins:\r\n\r\n1.- Utilitzar l'eina de l'entorn de treball de Canigó (plugin per l'eclipse). On es podrà seleccionar el servei dintre del grup \"suport\".\r\n\r\nNOTA: L'eina afegeix automàticament un arxiu anomenat lopd.properties situat en src\\main\\resources\\config\\props\\ que conté la llavor utilitzada per fer el xifrat/desxifrat de les dades. En la versió 1.0.0 del servei aquest paràmetre no s'està utilitzant així que no es necessari configurar-lo.\r\n\r\n2.- Afegir de forma manual les dependències del servei.\r\n\r\nModificar el pom.xml afegint:\r\n\r\n```\r\n<properties>\r\n\t<canigo.support.lopd>[1.4.0,1.5.0)</canigo.support.lopd>\r\n</properties>\r\n\r\n<dependency>\r\n      <groupId>cat.gencat.ctti</groupId>\r\n      <artifactId>canigo.support.lopd</artifactId>\r\n      <version>${canigo.support.lopd}</version>\r\n</dependency>\r\n\r\n...\r\n\r\n<build>\r\n...\r\n\t <plugin>\r\n\t\t<groupId>org.codehaus.mojo</groupId>\r\n\t\t<artifactId>aspectj-maven-plugin</artifactId>\r\n\t\t<version>1.10</version>\r\n\t\t<configuration>\r\n\t\t\t<complianceLevel>1.7</complianceLevel>\r\n\t\t\t<source>1.7</source>\r\n\t\t\t<target>1.7</target>\r\n\t\t\t <weaveDependencies>\r\n\t\t\t<weaveDependency>\r\n\t\t\t\t  <groupId>cat.gencat.ctti</groupId>\r\n\t\t\t\t  <artifactId>canigo.support.lopd</artifactId>\r\n\t\t\t</weaveDependency>\r\n\t\t  </weaveDependencies>\r\n\t\t</configuration>\r\n\t\t<executions>\r\n\t\t\t<execution>\r\n\t\t\t\t<goals>\r\n\t\t\t\t\t<goal>compile</goal>\r\n\t\t\t\t</goals>\r\n\t\t\t\t<configuration>\r\n\t\t\t\t\t<complianceLevel>1.7</complianceLevel>\r\n\t\t\t\t\t<source>1.7</source>\r\n\t\t\t\t\t<target>1.7</target>\r\n\t\t\t\t</configuration>\r\n\t\t\t</execution>\r\n\t\t</executions>\r\n\t</plugin>\r\n...\r\n</build>\r\n\r\n```\r\n\r\n#### Components del Servei\r\n\r\nEl servei defineix tres nivells de seguretat diferents i dos tipus d'operacions amb les dades. L'aplicació dels nivells de seguretat està bassada en l'ús d'una anotació especial de seguretat anomenada LOPDSecure.\r\n\r\n**Nivells de seguretat**\r\n\r\nEls nivells de seguretat creats inicialment són els següents:\r\n\r\n* LOW: Nivell de seguretat baix. Enregistrament de la dada.\r\n* MED: Nivell de seguretat mitjà. Enregistrament de la dada.\r\n* HIGH: Nivell de seguretat alt. Enregistrament i xifrat/desxifrat de la dada.\r\n\r\n**Operacions amb dades**\r\n\r\nS'han definit dos tipus d'operacions possibles aplicables en funció del nivell de seguretat.\r\n\r\n* Enregistrament de les dades: Operació que registra l'accés d'una dada per part d'un usuari.\r\n* Xifrat/desxifrat de les dades: Operació que xifra o desxifra una dada accedida per un usuari.\r\n\r\n### Ús del servei\r\n\r\n#### Configuració del servei\r\n\r\nA spring s'ha de configurar el servei per a indiciar la classe que realitza l'enregistrament de les dades i el xifrat/desxifrat de les dades.\r\n\r\n```\r\n\r\n    <!-- Actions -->\r\n<bean id=\"traceOperation\" class=\"cat.gencat.ctti.canigo.arch.support.lopd.operations.trace.impl.TraceImpl\">\r\n</bean>\r\n\r\n <bean id=\"cipherOperation\" class=\"cat.gencat.ctti.canigo.arch.support.lopd.operations.cipher.impl.BouncyCastleAESCipherImpl\">\r\n    <property name=\"key\" value=\"${lopd.secretkey}\"/>\r\n    <!--Optional -->\r\n    <property name=\"charset\" value=\"UTF-8\"/>\r\n</bean>\r\n\r\n<!-- Levels -->\r\n<bean id=\"lowLevel\" class=\"cat.gencat.ctti.canigo.arch.support.lopd.levels.Low\">\r\n    <property name=\"trace\" ref=\"traceOperation\"/>\r\n</bean>\r\n<bean id=\"medLevel\" class=\"cat.gencat.ctti.canigo.arch.support.lopd.levels.Med\">\r\n    <property name=\"trace\" ref=\"traceOperation\"/>\r\n</bean>\r\n<bean id=\"highLevel\" class=\"cat.gencat.ctti.canigo.arch.support.lopd.levels.High\">\r\n    <property name=\"trace\" ref=\"traceOperation\"/>\r\n    <property name=\"cipher\" ref=\"cipherOperation\"/>\r\n</bean>\r\n\r\n<!-- Defined Levels to be used -->\r\n<bean id=\"levels\" class=\"cat.gencat.ctti.canigo.arch.support.lopd.levels.Levels\">\r\n    <property name=\"low\" ref=\"lowLevel\"/>\r\n    <property name=\"med\" ref=\"medLevel\"/>\r\n    <property name=\"high\" ref=\"highLevel\"/>\r\n</bean>\r\n```\r\n\r\nAl fitxer Application.Java s'ha d'afegir el Bean del AspectLOPD\r\n\r\n\t@Bean\r\n    public AspectLOPD aspectLOPD() {\r\n    \t return Aspects.aspectOf(AspectLOPD.class);\r\n    }\r\n\t\r\n#### Anotacions\r\n\r\nCom s'ha indicat en punts anteriors l'aplicació de la seguretat es fa amb una anotació. Aquesta Anotació està dissenyada per posar-se en els mètodes setter i getter de les Entitats responsables de la transferència de les dades entre la base de dades i els objectes de negoci de l'aplicació.\r\n\r\nUn exemple de com utilitzar la nova anotació seria el següent:\r\n\r\n```java\r\nimport javax.persistence.Column;\r\nimport javax.persistence.Entity;\r\nimport javax.persistence.GeneratedValue;\r\nimport javax.persistence.Id;\r\nimport javax.persistence.Table;\r\n\r\nimport org.hibernate.annotations.GenericGenerator;\r\n\r\nimport cat.gencat.ctti.canigo.arch.support.lopd.annotation.LOPDSecure;\r\n\r\n\r\n\r\n@Entity\r\n@Table(name = \"equipaments\")\r\npublic class Equipament {\r\n\t\r\n\tpublic static final String ID = \"id\";\r\n\tpublic static final String NOM = \"nom\";\r\n\tpublic static final String MUNICIPI = \"municipi\";\r\n\r\n\tprivate Long id;\r\n\t\r\n\tprivate String nom;\r\n\t\r\n\tprivate String municipi;\r\n\t\r\n\tpublic Equipament() {\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic Equipament(Long id) {\r\n\t\tthis.id =id;\r\n\t}\r\n\t\r\n\t@Id\r\n\t@GeneratedValue(generator = \"generator\")\r\n\t@GenericGenerator(name = \"generator\", strategy = \"increment\")\r\n\tpublic Long getId() {\r\n\t\treturn id;\r\n\t}\r\n\r\n\tpublic void setId(Long id) {\r\n\t\tthis.id = id;\r\n\t}\r\n\r\n\t\r\n\t@Column(name = \"nom\", nullable = false, unique = true)\r\n\t @LOPDSecure(level = \"LOW\")//<--Nova Anotació de seguretat\r\n\tpublic String getNom() {\r\n\t\treturn nom;\r\n\t}\r\n\r\n\t @LOPDSecure(level = \"LOW\")//<--Nova Anotació de seguretat\r\n\tpublic void setNom(String nom) {\r\n\t\tthis.nom = nom;\r\n\t}\r\n\r\n\t @LOPDSecure(level = \"HIGH\")//<--Nova Anotació de seguretat\r\n\t@Column(name = \"municipi\")\r\n\tpublic String getMunicipi() {\r\n\t\treturn municipi;\r\n\t}\r\n\r\n\t @LOPDSecure(level = \"HIGH\")//<--Nova Anotació de seguretat\r\n\tpublic void setMunicipi(String municipi) {\r\n\t\tthis.municipi = municipi;\r\n\t}\t\r\n\t\r\n\t@Override\r\n\tpublic String toString() {\r\n\t\treturn \"Equipament [nom=\" + nom + \"]\";\r\n\t}\r\n\t\r\n\tpublic void addCustomer() {\r\n\t\tSystem.out.println(\"addCustomer() is running \");\r\n\t}\r\n\r\n}\r\n\r\n```\r\n\r\nCom es pot apreciar l'anotació\r\n\r\n```\r\n@LOPDSecure(value = [NIVELL_SEGURETAT])\r\n```\r\n\r\nestà informada davant de cada setter i getter on es vol que s'apliqui la seguretat. L'anotació pot posar-se davant d'un getter o davant d'un setter per separat, donant així la possibilitat d'aplicar la seguretat només a un determinat tipus d'accés a la dada.\r\nS'ha de tindre en compte que, en el cas especial de la política de seguretat HIGH, l'anotació ha d'anar en el setter i el getter de la dada en qüestió obligatòriament. Si no es fes així, la dada es xifraria i mai es podria recuperar el seu valor original o bé s'interpretaria com a xifrada quan no ho fos i s'intentaria desxifrar, provocant l'alteració del valor mostrat.\r\n\r\nUn altre aspecte important, també en relació a la política HIGH, és que el tipus de la dada que ha de figurar en la base de dades sempre ha de ser format text. Això és així per que el procés de xifrat transforma la dada (del tipus que sigui) en un array de bytes, perdent qualsevol informació del tipus original. S'haurà de tindre especial atenció en el xifrat de dades del tipus numèric o data, per aquest motiu.\r\n\r\n**Consulta de les dades**\r\n\r\nUna vegada aplicades les anotacions sempre que s'accedeixi a una dada on el seu getter o setter hagi sigut anotat es podrà consultar en el log de l'aplicació una traça com la següent:\r\n\r\n```\r\ncanigo Message: 17 05 2018 16:17:48,403 DEBUG [http-nio-8080-exec-1] DEBUG [http-nio-8080-exec-1] cat.gencat.ctti.canigo.arch.support.lopd.annotation.impl.AspectLOPD - [AspectLOPD][level][valor = HIGH]\r\ncanigo Message: 17 05 2018 16:17:58,043 INFO  [http-nio-8080-exec-1] INFO  [http-nio-8080-exec-1] cat.gencat.ctti.canigo.arch.support.lopd.operations.trace.impl.TraceImpl - [LOPD access entry][Property: Municipi][of Class: cat.gencat.can2303.model.Equipament][accessed by user: admin][at: 17/05/2018 04:17:54]\r\n\r\n```\r\n\r\nDe cara al xifrat de les dades, totes les que hagin sigut anotades amb nivell de seguretat HIGH, apareixeran xifrades en base de dades.","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtc3Vwb3J0L21vZHVsLWxvcGQ="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtYW50ZXJpb3JzL3ZlcnNpby0x":{"date":1423239102000,"title":"Versió 1.x","description":"Documentació de la versió 1 del Framework Canigó","sections":"Documentació versions Canigó","taxonomies":[],"weight":2,"path":"/canigo-documentacio-versions-anteriors/versio-1","content":"Des del següent [enllaç](http://gencat.github.io/docs-canigo-v1/) es pot accedir a la darrera versió de la documentació.\r\n\r\n### Changelog\r\n\r\n[1.0.1](https://github.com/gencat/docs-canigo-v1/archive/1.0.1.zip) (15/03/2016)\r\n\r\n- [CAN-2086](http://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2086): Actualitzada documentació connector Documentum per l'upgrade a v7.1.\r\n\r\n[1.0.0](https://github.com/gencat/docs-canigo-v1/archive/1.0.0.zip) (6/2/2015)\r\n\r\n- Versió inicial exportada del Confluence\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtYW50ZXJpb3JzL3ZlcnNpby0x"},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtYW50ZXJpb3JzL3ZlcnNpby0y":{"date":1423239102000,"title":"Versió 2.x","description":"Documentació de la versió 2 del Framework Canigó","sections":"Documentació versions Canigó","taxonomies":[],"weight":1,"path":"/canigo-documentacio-versions-anteriors/versio-2","content":"Des del següent [enllaç](http://gencat.github.io/docs-canigo-v2/) es pot accedir a la darrera versió de la documentació.\r\n\r\n### Changelog\r\n\r\n[1.0.2](https://github.com/gencat/docs-canigo-v2/archive/v1.0.2.zip) (28/01/2016)\r\n\r\n- [CAN-2071](http://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2071): Actualitzada documentació connectors de la PICA.\r\n\r\n[1.0.1](https://github.com/gencat/docs-canigo-v2/archive/v1.0.1.zip) (17/12/2015)\r\n\r\n- [CAN-2057](http://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2057): Actualitzada documentació connector Documentum per l'upgrade a v7.1.\r\n\r\n[1.0.0](https://github.com/gencat/docs-canigo-v2/archive/v1.0.0.zip) (6/2/2015)\r\n\r\n- Versió inicial exportada del Confluence\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtYW50ZXJpb3JzL3ZlcnNpby0y"},"L2Nhbmlnby1kb3dubG9hZC1yZWxhdGVkL3BsdWdpbi1jYW5pZ28=":{"date":1490918400000,"title":"Plugin Canigó per a Eclipse","description":"Plugin d'eclipse per a generar una aplicació Canigó.","sections":"Canigó.","weight":1,"path":"/canigo-download-related/plugin-canigo","content":"## Introducció\r\n\r\n### Propòsit\r\n\r\nEl plugin de Canigó per a Eclipse permet crear de forma automàtica l'esquelet d'una aplicació Canigó. L'aplicació que es crea està orientada a servir com a punt de partida per a la creació d'una aplicació més complex, però des del moment de la seva creació ja és desplegable i funcional.\r\n\r\n*NOTA*: Tot i que les passes d'instal·lació i configuració del plugin són senzilles, [l'entorn de desenvolupament de Canigó](https://canigo.ctti.gencat.cat/canigo/entorn-desenvolupament/) conté un Eclipse amb aquest plugin configurat i llest per ser emprat.\r\n\r\n#### Eclipse 2019-03\r\n\r\nL'última versió del plugin està certificada amb la versió d'Eclipse 2019-03, que podeu trobar al següent enllaç: https://www.eclipse.org/downloads/packages/release/2019-03/r/eclipse-ide-enterprise-java-developers\r\n\r\n### Prerequisit\r\n\r\nAbans de realitzar la instal·lació del plugin Canigó s'ha de configurar el settings.xml del Maven per a tenir referenciats el [repositori de Canigó] (/canigo/download)\r\n\r\n### Instal·lació\r\n\r\nA la pestanya Help de l'Eclipse seleccionar \"Install New Software...\"\r\n\r\n![](/related/canigo/documentacio/plugin-canigo/img1.jpg)\r\n\r\nPrémer sobre el botó Add i afegir el respository de Canigó:\r\nhttp://repos.canigo.ctti.gencat.cat/repository/maven2/cat/gencat/ctti/canigo.plugin/update-site/\r\n\r\n![](/related/canigo/documentacio/plugin-canigo/img2.jpg)\r\n\r\nSeleccionar **Plug-in Canigo 3.2 - Canigo 3.2**\r\n\r\n![](/related/canigo/documentacio/plugin-canigo/img13.jpg)\r\n\r\n## Crear Aplicació Canigó\r\n\r\nA la vista Package Explorer de l'Eclipse fer botó dret: New -> Other\r\n\r\n![](/related/canigo/documentacio/plugin-canigo/img4.jpg)\r\n\r\nSeleccionar Assistent Projectes Canigó -> Crear un Projecte Canigó\r\n\r\n![](/related/canigo/documentacio/plugin-canigo/img10.jpg)\r\n\r\nEl plugin genera una aplicació REST amb un CRUD de demo implementat amb HTML5/Javascript.\r\n\r\nEs dóna llibertat per triar la tecnologia per a realitzar el front-end (AngularJS, Bootstrap, EmberJS...) sempre que es compleixi el PIV de Gencat.\r\n\r\nL'aplicació inicial que es crea amb el plugin inclou d'inici:\r\n\r\n* mòdul de persistència (Base de dades a memòria H2)\r\n* mòdul d'administració de logs\r\n\r\nPer a desplegar l'aplicació només s'ha de compilar \"mvn install\" i arrencar l'aplicació utilitzant Spring Boot.\r\n\r\n![](/related/canigo/documentacio/plugin-canigo/img11.jpg)\r\n\r\nL'aplicació demo porta incorporat Swagger i és aquesta la pantalla que es carrega quan s'accedeix a http://localhost:8080/canigo-api.html\r\n\r\nPer defecte, les APIs REST es publiquen a http://localhost:8080/api/*:\r\n\r\nExemples:\r\n\r\n* http://localhost:8080/api/equipaments/\r\n* http://localhost:8080/api/equipaments/1\r\n\r\nLa url per accedir al mòdul d'administració de logs és http://localhost:8080/loggingAdministration.html\r\n\r\nPer a més informació sobre aquest mòdul consultar la [documentació](/canigo-documentacio-versions-3x-core/modul-logging-admin/)\r\n\r\n## Afegir/Esborrar nous mòduls\r\n\r\nPer afegir o treure mòduls de Canigó el plugin proporciona la possibilitat de fer-ho de forma automàtica.\r\n\r\nS'ha de prémer sobre el projecte, botó dret -> Canigó\r\n\r\n![](/related/canigo/documentacio/plugin-canigo/img9.jpg)\r\n\r\nPer exemple, per a afegir el mòdul de seguretat el plugins ens donarà l'opció a triar si es desitja utilitzar JWT i el provider de seguretat a utilitzar (Arxiu, BBDD, Gicar o LDAP)\r\n\r\n![](/related/canigo/documentacio/plugin-canigo/img12.jpg)\r\n","objectID":"L2Nhbmlnby1kb3dubG9hZC1yZWxhdGVkL3BsdWdpbi1jYW5pZ28="},"L2Nhbmlnby1kb3dubG9hZC1yZWxhdGVkL3JlbGVhc2Utbm90ZXMtY2FuaWdvLTI=":{"date":1427760000000,"title":"Release Notes Canigó 2.3.20","description":"","sections":"Canigó","weight":1,"path":"/canigo-download-related/release-notes-canigo-2","content":"#### Canvis\r\n\r\n- Canvi [CAN-1726](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-1726): Notificacions electròniques <br>\r\n<b>Context</b>: Actualització del connector de la PICA amb el producte NT <br>\r\n<b>Connector afectat</b>: canigo-connectors-nt <br>\r\n<b>Solució</b>: Modificació del connector  <br>\r\n\r\n- Canvi [CAN-1735](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-1735): Actualització connector AEAT PICA  <br>\r\n<b>Context</b>: Actualització del connector de la PICA amb el producte AEAT <br>\r\n<b>Connector afectat</b>: canigo-connectors-pica-tributs <br>\r\n<b>Solució</b>: Modificació del connector  <br>\r\n\r\n- Canvi [CAN-1745](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-1745): Actualització connector AEAT-TGSS  <br>\r\n<b>Context</b>: Actualització del connector de la PICA amb el producte TGSS <br>\r\n<b>Connector afectat</b>: canigo-connectors-pica-tributs <br>\r\n<b>Solució</b>: Modificació del connector  <br>\r\n\r\n- Canvi [CAN-1824](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-1824): Consulta error connector pica  <br>\r\n<b>Context</b>: Arrel d'una consulta sobre el connector de PSIS es detecta que cal actualitzar-ho donat que un dels camp que s'envia a la petició ha passat de ser opcional a obligatori i el connector no deixava informar-ho. <br>\r\n<b>Servei afectat</b>: canigo-connectors-psis <br>\r\n<b>Solució</b>: Modificació del connector  <br>\r\n\r\n#### Bugs sol·lucionats\r\n\r\n- Bug [CAN-1683](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-1683) El connector de DNI no permet informar el camp funcionari <br>\r\n<b>Context</b>: Problemes amb la impossibilitat de poder informar un valor a les crides del connector de la PICA-DNI.<br>\r\n<b>Servei afectat</b>: canigo-connectors-pica-dni<br>\r\n<b>Solució</b>: Modificació del connector <br>\r\n\r\n- Bug [CAN-1765](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-1765) Problemàtica en l'enviament d'e-mails <br>\r\n<b>Context</b>: Problemes del servei a l'hora d'obtenir el Transport<br>\r\n<b>Servei afectat</b>: canigo-services-mailing<br>\r\n<b>Solució</b>: Modificació del connector <br>\r\n\r\n- Bug [CAN-1884](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-1884) Canigó integracions externes per Proxy<br>\r\n<b>Context</b>: Problemes al intentar informar un campal desplegar amb Weblogic si es sobreescriuen certes variables a nivell global d'instància de JVM.<br>\r\n<b>Servei afectat</b>: canigo-services-webservices<br>\r\n<b>Solució</b>: Modificació del servei <br>\r\n\r\n- Bug [CAN-1789](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-1789) Botó submit bloquejat a google chrome<br>\r\n<b>Context</b>: Problemes amb el volum de dades que s'envien a validar mitjançant un formulari.<br>\r\n<b>Servei afectat</b>: canigo-services-client<br>\r\n<b>Solució</b>: Modificació de scripts que intervenen a l'enviament de dades de formularis <br>","objectID":"L2Nhbmlnby1kb3dubG9hZC1yZWxhdGVkL3JlbGVhc2Utbm90ZXMtY2FuaWdvLTI="},"L2Nhbmlnby1kb3dubG9hZC1yZWxhdGVkL3JlbGVhc2Utbm90ZXMtY2FuaWdvLTMy":{"date":1545264000000,"title":"Release Notes Canigó 3.2","description":"","sections":"Canigó","weight":1,"path":"/canigo-download-related/release-notes-canigo-32","content":"#### Release Notes\r\n\r\n[**Canigó 3.2.7**] (https://cstd.ctti.gencat.cat/jiracstd/projects/CAN/fixforversion/10602) (05/12/2018)\r\n\r\n- [Autenticació amb certificat al servei de seguretat per GICAR] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-1915)\r\n- [Gestió d'adjunts en servei de correu electrònic] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-1996)\r\n- [Millores en parametrització connector d'Antivirus] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2327)\r\n- [Suport a tipus de dades JSON a PostgreSQL i MySQL] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2329)\r\n- [Revisió condicionals @ConditionalOnExpression al mòdul web.rs i security] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2343)\r\n- [Revisió nom dels fitxers que carrega els contextes de Spring als tests de canigo.security] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2344)\r\n\r\n[**Canigó 3.2.6**] (https://cstd.ctti.gencat.cat/jiracstd/projects/CAN/fixforversion/10601) (28/09/2018)\r\n\r\n- [Suport a base de dades MongoDB] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2220)\r\n- [Suport a base de dades PostgreSQL] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2251)\r\n\r\n[**Canigó 3.2.5**] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN/fixforversion/10498) (18/06/2018)\r\n\r\n- [Actualitzar Spring i altres llibreries] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2312)\r\n- [Reduïr el nombre de Threads que es crea a canigo.operation.instrumentation] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2295)\r\n- [El módul LOPD no interceptava GET/SET d'entitats] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2303)\r\n- [Configurar el filtre de QueryDSL per a que tracti els números com a Long] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2294)\r\n- [Suport a SAML2 per autenticació amb GICAR] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2222)\r\n\r\n[**Canigó 3.2.4**] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN/fixforversion/10494) (05/04/2018)\r\n\r\n- [No incloure per defecte els endpoints infoProperties i infoModules] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2287)\r\n- [Incorporar Bean mailSender a Canigo support mailing configurable] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2269)\r\n- [Ampliar l'endpoint de canigo.operation.instrumentation] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2273)\r\n\t\r\n[**Canigó 3.2.3**] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN/fixforversion/10464) (20/12/2017)\r\n\r\n- [Desenvolupament de jars amb test unitaris per als mòduls Canigó] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2221)\r\n\r\n[**Canigó 3.2.2**] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN/fixforversion/10463) (29/09/2017)\r\n\r\n- [Augmentar el logs existents en els mòduls de Canigó] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2244)\r\n- [Actualització Llibreries] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2239)\r\n- [Millores per donar suport a les millors pràctiques d'APIs REST] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2218)\r\n\r\n[**Canigó 3.2.1**](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN/fixforversion/10461) (26/06/2017)\r\n\r\n- [Actualització llibreries del mòdul SFTP] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2207)\r\n- [Fer configurable l'scan del Controller AuthController] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2193)\r\n- [Fer configurable el path d'on es carreguen les propietats al Servei de configuració] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2189)\r\n\r\n[**Canigó 3.2.0.1**](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN/fixforversion/10462) (02/06/2017)\r\n\r\n- [Actualització llibreries del mòdul SFTP] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2207)\r\n\r\n[**Canigó 3.2.0**](http://cstd.ctti.gencat.cat/jiracstd/browse/CAN/fixforversion/10450) (31/03/2017)\r\n\r\n- [Actualització plantilla Canigó i plugin Eclipse] (http://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2146)\r\n- [Suport REST i deprecar JSF] (http://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2127)\r\n- [Incorporació noves llibreries] (http://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2125)\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","objectID":"L2Nhbmlnby1kb3dubG9hZC1yZWxhdGVkL3JlbGVhc2Utbm90ZXMtY2FuaWdvLTMy"},"L2Nhbmlnby1kb3dubG9hZC1yZWxhdGVkL3JlbGVhc2Utbm90ZXMtY2FuaWdvLTM0":{"date":1522195200000,"title":"Release Notes Canigó 3.4","description":"","sections":"Canigó","weight":1,"path":"/canigo-download-related/release-notes-canigo-34","content":"#### Release Notes\n\n[**Canigó 3.4.0**] (https://cstd.ctti.gencat.cat/jiracstd/issues/?jql=project+%3D+CAN+AND+fixVersion+%3D+3.4.0) (29/03/2018)\n\n\n- [Actualització tecnologies base] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2358)\n\n\t- Actualització a Java 11, Spring 5, Spring Boot 2\n\t\n\t- Suport a programació amb Streams Reactius\n\t\n\t- Suport a programació reactiva\n\t\n\t- Suport a programació funcional\n\t\n\t- Suport configuració propietats amb yaml\n\t\n\t\n- [Actualització mòdul integració ARESTA/PSGD] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2353)\n","objectID":"L2Nhbmlnby1kb3dubG9hZC1yZWxhdGVkL3JlbGVhc2Utbm90ZXMtY2FuaWdvLTM0"},"L2Nhbmlnby1kb3dubG9hZC1yZWxhdGVkL21hdHJpdXMtY29tcGF0aWJpbGl0YXRz":{"date":1552953600000,"title":"Matrius de Compatibilitats","description":"","sections":"Canigó","weight":1,"toc":true,"path":"/canigo-download-related/matrius-compatibilitats","content":"## Canigó 3.4.x\r\n\r\n|                                                   \t\t| 25/03/2019 (3.4.0)\t|\r\n|---------------------------------------------------\t\t|------------------\t\t|\r\n| **canigo.core**                                   \t\t| 4.0.0         \t\t\t|\r\n|                                                   \t\t|               \t\t\t|\r\n| **canigo.persistence.core**                        \t\t| 2.0.0          \t\t\t|\r\n| canigo.core                                       \t\t| [4.0.0,4.1.0)  \t\t\t|\r\n|                                                   \t\t|               \t\t\t|\r\n| **canigo.persistence.jpa**                         \t\t| 2.0.0         \t\t\t|\r\n| canigo.core                                       \t\t| [4.0.0,4.1.0)  \t\t\t|\r\n| canigo.persistence.core                           \t\t| [2.0.0,2.1.0)  \t\t\t|\r\n|                                                   \t\t|               \t\t\t|\r\n| **canigo.persistence.mongodb**                     \t\t| 2.0.0          \t\t\t|\r\n| canigo.core                                       \t\t| [4.0.0,4.1.0)  \t\t\t|\r\n| canigo.persistence.core                           \t\t| [2.0.0,2.1.0)  \t\t\t|\r\n|                                                   \t\t|               \t\t\t|\r\n| **canigo.security**                                \t\t| 2.0.0         \t\t\t|\r\n| canigo.core                                       \t\t| [4.0.0,4.1.0)  \t\t\t|\r\n|                                                   \t\t|               \t\t\t|\r\n| **canigo.security.saml.rest**                      \t\t| 2.0.0          \t\t\t|\r\n| canigo.core                                       \t\t| [4.0.0,4.1.0)  \t\t\t|\r\n| canigo.security                                   \t\t| [2.0.0,2.1.0) \t\t\t|\r\n|                                                   \t\t|               \t\t\t|\r\n| **canigo.web.core**                                \t\t| 2.0.0         \t\t\t|\r\n| canigo.core                                       \t\t| [4.0.0,4.1.0)  \t\t\t|\r\n|                                                   \t\t|               \t\t\t|\r\n| **canigo.web.rs**                                  \t\t| 2.0.0         \t\t\t|\r\n| canigo.core                                       \t\t| [4.0.0,4.1.0)  \t\t\t|\r\n| canigo.web.core                                   \t\t| [2.0.0,2.1.0) \t\t\t|\r\n|                                                   \t\t|               \t\t\t|\r\n| **canigo.support.fileupload**                      \t\t| 2.0.0         \t\t\t|\r\n| canigo.core                                       \t\t| [4.0.0,4.1.0)  \t\t\t|\r\n| canigo.web.core                                   \t\t| [2.0.0,2.1.0) \t\t\t|\r\n| canigo.integration.antivirus                      \t\t| [2.0.0,2.1.0) \t\t\t|\r\n|                                                   \t\t|               \t\t\t|\r\n| **canigo.support.lopd**                            \t\t| 2.0.0         \t\t\t|\r\n| canigo.core                                       \t\t| [4.0.0,4.1.0)  \t\t\t|\r\n| canigo.security                                   \t\t| [2.0.0,2.1.0) \t\t\t|\r\n|                                                   \t\t|               \t\t\t|\r\n| **canigo.support.mailing**                         \t\t| 2.0.0         \t\t\t|\r\n| canigo.core                                       \t\t| [4.0.0,4.1.0)  \t\t\t|\r\n|                                                   \t\t|               \t\t\t|\r\n| **canigo.support.merging**                         \t\t| 2.0.0         \t\t\t|\r\n| canigo.core                                       \t\t| [4.0.0,4.1.0)  \t\t\t|\r\n|                                                   \t\t|               \t\t\t|\r\n| **canigo.support.ole**                             \t\t| 2.0.0         \t\t\t|\r\n| canigo.core                                       \t\t| [4.0.0,4.1.0)  \t\t\t|\r\n|                                                   \t\t|               \t\t\t|\r\n| **canigo.support.sftp**                            \t\t| 2.0.0         \t\t\t|\r\n| canigo.core                                       \t\t| [4.0.0,4.1.0)  \t\t\t|\r\n|                                                   \t\t|               \t\t\t|\r\n| **canigo.operation.instrumentation**               \t\t| 2.0.0         \t\t\t|\r\n| canigo.core                                       \t\t| [4.0.0,4.1.0)  \t\t\t|\r\n| canigo.web.core                                   \t\t| [2.0.0,2.1.0) \t\t\t|\r\n| canigo.web.rs                                   \t\t\t| [2.0.0,2.1.0) \t\t\t|\r\n|                                                   \t\t|               \t\t\t|\r\n| **canigo.operation.logging**                       \t\t| 2.0.0         \t\t\t|\r\n| canigo.core                                       \t\t| [4.0.0,4.1.0)  \t\t\t|\r\n|                                                   \t\t|               \t\t\t|\r\n| **canigo.integration.antivirus**                   \t\t| 2.0.0         \t\t\t|\r\n| canigo.core                                       \t\t| [4.0.0,4.1.0)  \t\t\t|\r\n|                                                   \t\t|               \t\t\t|\r\n| **canigo.integration.avisosalertes.pica**          \t\t| 2.0.0         \t\t\t|\r\n| canigo.core                                       \t\t| [4.0.0,4.1.0)  \t\t\t|\r\n| canigo.integration.pica                           \t\t| [2.0.0,2.1.0) \t\t\t|\r\n|                                                   \t\t|               \t\t\t|\r\n| **canigo.integration.dni.pica**                    \t\t| 2.0.0         \t\t\t|\r\n| canigo.core                                       \t\t| [4.0.0,4.1.0)  \t\t\t|\r\n| canigo.integration.pica                           \t\t| [2.0.0,2.1.0) \t\t\t|\r\n|                                                   \t\t|               \t\t\t|\r\n| **canigo.integration.documentum(7.1)**             \t\t| 4.0.0         \t\t\t|\r\n| canigo.core                                       \t\t| [4.0.0,4.1.0)  \t\t\t|\r\n|                                                   \t\t|               \t\t\t|\r\n| **canigo.integration.gecat**                       \t\t| 2.0.0         \t\t\t|\r\n| canigo.core                                       \t\t| [4.0.0,4.1.0)  \t\t\t|\r\n| canigo.integration.sap                            \t\t| [2.0.0,2.1.0) \t\t\t|\r\n|                                                   \t\t|               \t\t\t|\r\n| **canigo.integration.icc**                         \t\t| 2.0.0         \t\t\t|\r\n| canigo.core                                       \t\t| [4.0.0,4.1.0)  \t\t\t|\r\n| canigo.integration.icc.datatypes                  \t\t| [2.0.0,2.1.0)  \t\t\t|\r\n|                                                   \t\t|               \t\t\t|\r\n| **canigo.integration.icc.datatypes**               \t\t| 2.0.0         \t\t\t|\r\n| canigo.core                                       \t\t| [4.0.0,4.1.0)  \t\t\t|\r\n|                                                   \t\t|               \t\t\t|\r\n| **canigo.integration.notificacions.electroniques** \t\t| 2.0.0         \t\t\t|\r\n| canigo.core                                       \t\t| [4.0.0,4.1.0)  \t\t\t|\r\n| canigo.integration.pica                           \t\t| [2.0.0,2.1.0) \t\t\t|\r\n|                                                   \t\t|               \t\t\t|\r\n| **canigo.integration.notificacions.electroniques.ws**\t| 3.0.0         \t\t\t|\r\n| canigo.core                                       \t\t| [4.0.0,4.1.0)  \t\t\t|\r\n| canigo.integration.notificacions.electroniques    \t\t| [2.0.0,2.1.0) \t\t\t|\r\n|                                                   \t\t|               \t\t\t|\r\n| **canigo.integration.padro.pica**                  \t\t| 2.0.0         \t\t\t|\r\n| canigo.core                                       \t\t| [4.0.0,4.1.0)  \t\t\t|\r\n| canigo.integration.pica                           \t\t| [2.0.0,2.1.0) \t\t\t|\r\n|                                                   \t\t|               \t\t\t|\r\n| **canigo.integration.pica**                        \t\t| 2.0.0         \t\t\t|\r\n| canigo.core                                       \t\t| [4.0.0,4.1.0)  \t\t\t|\r\n|                                                   \t\t|               \t\t\t|\r\n| **canigo.integration.psgd**                        \t\t| 2.0.1         \t\t\t|\r\n| canigo.core                                       \t\t| [4.0.0,4.1.0)  \t\t\t|\r\n|                                                   \t\t|               \t\t\t|\r\n| **canigo.integration.psis**                        \t\t| 2.0.0         \t\t\t|\r\n| canigo.core                                       \t\t| [4.0.0,4.1.0)  \t\t\t|\r\n| canigo.integration.pica                           \t\t| [2.0.0,2.1.0) \t\t\t|\r\n|                                                   \t\t|               \t\t\t|\r\n| **canigo.integration.sap**                         \t\t| 2.0.0         \t\t\t|\r\n| canigo.core                                       \t\t| [4.0.0,4.1.0)  \t\t\t|\r\n|                                                   \t\t|               \t\t\t|\r\n| **canigo.integration.sarcat**                      \t\t| 2.0.0         \t\t\t|\r\n| canigo.core                                       \t\t| [4.0.0,4.1.0)  \t\t\t|\r\n| canigo.support.sftp                               \t\t| [2.0.0,2.1.0) \t\t\t|\r\n|                                                   \t\t|               \t\t\t|\r\n| **canigo.integration.sarcat.pica**                 \t\t| 2.0.0         \t\t\t|\r\n| canigo.core                                       \t\t| [4.0.0,4.1.0)  \t\t\t|\r\n| canigo.integration.pica                           \t\t| [2.0.0,2.1.0) \t\t\t|\r\n|                                                   \t\t|               \t\t\t|\r\n| **canigo.integration.sgde**                        \t\t| 2.0.0         \t\t\t|\r\n| canigo.core                                       \t\t| [4.0.0,4.1.0)  \t\t\t|\r\n| canigo.operation.instrumentation                  \t\t| [2.0.0,2.1.0) \t\t\t|\r\n|                                                   \t\t|               \t\t\t|\r\n| **canigo.integration.ssc**                         \t\t| 2.0.0         \t\t\t|\r\n| canigo.core                                       \t\t| [4.0.0,4.1.0)  \t\t\t|\r\n| canigo.operation.instrumentation                  \t\t| [2.0.0,2.1.0) \t\t\t|\r\n|                                                   \t\t|               \t\t\t|\r\n| **canigo.integration.tributs.pica**                \t\t| 2.0.0         \t\t\t|\r\n| canigo.core                                       \t\t| [4.0.0,4.1.0)  \t\t\t|\r\n| canigo.integration.pica                           \t\t| [2.0.0,2.1.0) \t\t\t|\r\n|                                                   \t\t|               \t\t\t|\r\n\r\n\r\n## Canigó 3.2.x\r\n\r\n|                                                       \t| 31/03/2017 (3.2.0) \t| 02/06/2017 (3.2.0.1) \t| 26/06/2017 (3.2.1) \t| 29/09/2017 (3.2.2) \t| 20/12/2017 (3.2.3) \t| 05/04/2018 (3.2.4) | 18/06/2018 (3.2.5) | 28/09/2018 (3.2.6)\r\n|-------------------------------------------------------\t|:------------------:\t|:------------------:\t|:------------------:\t|:------------------:\t|:------------------:\t|:------------------:|:------------------:|:------------------:\r\n| **canigo.core**                                       \t|        3.2.0       \t|        3.2.0          |        3.2.1          |        3.2.2       \t|        3.2.3          |                    |        3.2.4     |         \r\n|\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|\t\t\t\t\t\t|\t\t\t\t\t\t|\t\t\t\t\t\t|\t\t\t\t\t\t|\t                    |\t                 |\t\t\t\t\t\t\t|\t\t\t\t\t\r\n| **canigo.persistence.core**                            \t|               \t|                       |                       |               \t|                  |                    |              \t |        1.0.0\r\n| canigo.core                                           \t|       \t|                       |                       |     \t|          |                    |       \t |   [3.2.0,3.3.0)\r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                    |                    \t  \r\n| **canigo.persistence.jpa**                            \t|        1.2.0       \t|                       |                       |        1.2.1       \t|        1.2.2          |                    |        1.2.4       \t |        1.3.0\r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|    [3.2.0,3.3.0)      |                    |    [3.2.0,3.3.0)   \t |   \r\n| canigo.persistence.core                                           \t|       \t|                       |                       |       \t|          |                    |       \t |        1.0.0\r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                    |                    \t  \r\n| **canigo.persistence.mongodb**                            \t|               \t|                       |                       |               \t|                 |                    |               \t |        1.0.0\r\n| canigo.core                                           \t|      \t|                       |                       |      \t|          |                    |       \t |   [3.2.0,3.3.0)\r\n| canigo.persistence.core                                           \t|       \t|                       |                       |       \t|          |                    |       \t |        1.0.0\r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                    |                    \t  \r\n| **canigo.security**                                   \t|        1.2.0       \t|               \t    |        1.2.1       \t|        1.2.2       \t|        1.2.2       \t|                    |        1.2.4       \t \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|       \t            |    [3.2.0,3.3.0)   \t|    [3.2.0,3.3.0)   \t|    [3.2.0,3.3.0)   \t|                    |    [3.2.0,3.3.0)   \t   \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                    |\r\n| **canigo.security.saml.rest**                            \t|               \t    |               \t    |              \t        |              \t        |               \t    |                    |        1.0.0             \t \r\n| canigo.core                                           \t|      \t                |       \t            |                      \t|      \t                |    \t                |                    |    [3.2.0,3.3.0)    \t   \r\n| canigo.security                   \t  \t\t\t\t\t|\t\t\t\t\t\t|\t\t\t\t\t\t|\t\t\t\t\t\t|\t\t\t\t\t\t|\t\t\t\t\t\t|\t\t\t\t\t |    [1.2.0,1.3.0)\r\n| \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|\t\t\t\t\t\t|\t\t\t\t\t\t|\t\t\t\t\t\t|\t\t\t\t\t\t|\t\t\t\t\t\t|\t\t\t\t\t |\t\r\n| **canigo.web.core**                                   \t|        1.2.0       \t|                       |                       |        1.2.1       \t|                       |                    |        1.2.2       \t  \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                    |    [3.2.0,3.3.0)   \t  \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                    |                    \t  \r\n| **canigo.web.jsf**                                    \t|        1.3.0       \t|                       |                       |        1.3.1       \t|                       |                    |        1.3.2       \t             \t  \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                    |    [3.2.0,3.3.0)   \t      \t  \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                    |                    \t  \r\n| **canigo.web.rs**                                      \t|        1.0.0       \t|                       |                       |        1.1.0       \t|        1.1.1          |        1.1.2       |        1.1.3       \t           \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|    [3.2.0,3.3.0)      |    [3.2.0,3.3.0)   |    [3.2.0,3.3.0)   \t         \r\n| canigo.web.core\t\t\t\t\t\t\t\t\t\t\t|    [1.2.0,1.3.0)      |                       |                       |    [1.2.0,1.3.0)      |    [1.2.0,1.3.0)      |    [1.2.0,1.3.0)   |    [1.2.0,1.3.0)              \r\n|\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|\t\t\t\t\t\t|                       |                       |\t\t\t\t\t\t|                       |                    |\t\t\t\t\t\t  \r\n| **canigo.support.fileupload**                         \t|        1.2.0       \t|                       |                       |        1.2.1       \t|                       |                    |        1.2.2       \t  \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                    |    [3.2.0,3.3.0)   \t  \r\n| canigo.web.core                                       \t|    [1.2.0,1.3.0)   \t|                       |                       |    [1.2.0,1.3.0)   \t|                       |                    |    [1.2.0,1.3.0)   \t  \r\n| canigo.integration.antivirus                          \t|    [1.2.0,1.3.0)   \t|                       |                       |    [1.2.0,1.3.0)   \t|                       |                    |    [1.2.0,1.3.0)   \t  \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                    |                    \t  \r\n| **canigo.support.lopd**                               \t|        1.4.0       \t|                       |                       |        1.4.1       \t|                       |                    |        1.4.3       \t  \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                    |    [3.2.0,3.3.0)   \t  \r\n| canigo.security                                       \t|    [1.2.0,1.3.0)   \t|                       |                       |    [1.2.0,1.3.0)   \t|                       |                    |    [1.2.0,1.3.0)   \t  \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                    |                    \t  \r\n| **canigo.support.mailing**                            \t|        1.2.0       \t|                       |                       |        1.2.1       \t|                       |        1.2.2       |        1.2.3       \t    \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |    [3.2.0,3.3.0)   |    [3.2.0,3.3.0)   \t           \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                    |                    \t  \r\n| **canigo.support.merging**                            \t|        1.2.0       \t|                       |                       |        1.2.1       \t|                       |                    |        1.2.2       \t  \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                    |    [3.2.0,3.3.0)   \t  \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                    |                    \t  \r\n| **canigo.support.ole**                                \t|        1.2.0       \t|                       |                       |        1.2.1       \t|                       |                    |        1.2.2       \t  \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                    |    [3.2.0,3.3.0)   \t  \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                    |                    \t  \r\n| **canigo.support.sftp**                               \t|        1.2.0       \t|        1.2.1          |        1.2.1          |        1.2.2       \t|                       |                    |        1.2.3       \t \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|    [3.2.0,3.3.0)      |    [3.2.0,3.3.0)      |    [3.2.0,3.3.0)   \t|                       |                    |    [3.2.0,3.3.0)   \t \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                    |                    \t  \r\n| **canigo.operation.instrumentation**                  \t|        1.2.0       \t|                       |                       |        1.2.1       \t|                       |        1.2.2       |        1.2.4       \t       \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |    [3.2.0,3.3.0)   |    [3.2.0,3.3.0)   \t            \r\n| canigo.web.core                                       \t|    [1.2.0,1.3.0)   \t|                       |                       |    [1.2.0,1.3.0)   \t|                       |    [1.2.0,1.3.0)   |    [1.2.0,1.3.0)   \t \r\n|\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|\t\t\t\t\t\t|                       |                       |\t\t\t\t\t\t|                       |                    |\t\t\t\t\t\t  \r\n| **canigo.operation.instrumentation.jsf**                  |        1.0.0       \t|                       |                       |        1.0.1       \t|                       |                    |        1.0.2       \t               \t  \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                    |    [3.2.0,3.3.0)   \t       \t  \r\n| canigo.web.jsf                                       \t\t|    [1.2.0,1.3.0)   \t|                       |                       |    [1.2.0,1.3.0)   \t|                       |                    |    [1.2.0,1.3.0)   \t       \t  \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                    |                    \t  \r\n| **canigo.operation.logging**                          \t|       1.1.0          \t|                       |                       |       1.1.1          \t|                       |                    |       1.1.2          \t  \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)     \t|                       |                       |    [3.2.0,3.3.0)     \t|                       |                    |    [3.2.0,3.3.0)     \t  \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                    |                    \t  \r\n| **canigo.integration.antivirus**                      \t|        1.3.0       \t|                       |                       |        1.3.1       \t|                       |                    |        1.3.2       \t  \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                    |    [3.2.0,3.3.0)   \t  \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                    |                    \t  \r\n| **canigo.integration.avisosalertes.pica**             \t|        1.2.0       \t|                       |                       |        1.2.1       \t|                       |                    |        1.2.2       \t  \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                    |    [3.2.0,3.3.0)   \t  \r\n| canigo.integration.pica                               \t|    [1.2.0,1.3.0)   \t|                       |                       |    [1.2.0,1.3.0)   \t|                       |                    |    [1.2.0,1.3.0)   \t  \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                    |                    \t  \r\n| **canigo.integration.dni.pica**                       \t|        1.3.0       \t|                       |                       |        1.3.1       \t|                       |                    |        1.3.2       \t  \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                    |    [3.2.0,3.3.0)   \t  \r\n| canigo.integration.pica                               \t|    [1.2.0,1.3.0)   \t|                       |                       |    [1.2.0,1.3.0)   \t|                       |                    |    [1.2.0,1.3.0)   \t  \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                    |                    \t  \r\n| **canigo.integration.documentum(5.3)**                \t|        1.2.0       \t|                       |                       |        1.2.1       \t|                       |                    |        1.2.2       \t  \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                    |    [3.2.0,3.3.0)   \t  \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                    |                    \t  \r\n| **canigo.integration.documentum(6.5)**                \t|        2.2.0       \t|                       |                       |        2.2.1       \t|                       |                    |        2.2.2       \t  \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                    |    [3.2.0,3.3.0)   \t  \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                    |                    \t  \r\n| **canigo.integration.documentum(7.1)**                \t|        3.1.0         \t|                       |                       |        3.1.1         \t|                       |                    |        3.1.2         \t  \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)     \t|                       |                       |    [3.2.0,3.3.0)     \t|                       |                    |    [3.2.0,3.3.0)     \t  \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                    |                    \t  \r\n| **canigo.integration.gecat**                          \t|        1.2.0       \t|                       |                       |        1.2.1       \t|                       |                    |        1.2.2       \t  \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                    |    [3.2.0,3.3.0)   \t  \r\n| canigo.integration.sap                                \t|    [1.2.0,1.3.0)   \t|                       |                       |    [1.2.0,1.3.0)   \t|                       |                    |    [1.2.0,1.3.0)   \t  \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                    |                    \t  \r\n| **canigo.integration.icc**                            \t|        1.2.0       \t|                       |                       |        1.2.1       \t|                       |                    |        1.2.2       \t  \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                    |    [3.2.0,3.3.0)   \t  \r\n| canigo.integration.icc.datatypes                      \t|        1.2.0       \t|                       |                       |        1.2.1       \t|                       |                    |        1.2.1       \t  \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                    |                    \t  \r\n| **canigo.integration.icc.datatypes**                  \t|        1.2.0       \t|                       |                       |        1.2.1       \t|                       |                    |        1.2.2       \t  \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                    |    [3.2.0,3.3.0)   \t  \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                    |                    \t  \r\n| **canigo.integration.notificacions.electroniques**    \t|        1.4.0       \t|                       |                       |        1.4.1       \t|                       |                    |        1.4.2       \t  \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                    |    [3.2.0,3.3.0)   \t  \r\n| canigo.integration.pica                               \t|    [1.2.0,1.3.0)   \t|                       |                       |    [1.2.0,1.3.0)   \t|                       |                    |    [1.2.0,1.3.0)   \t  \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                    |                    \t  \r\n| **canigo.integration.notificacions.electroniques.ws** \t|        2.2.0       \t|                       |                       |        2.2.0       \t|                       |                    |              \t  \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                    |    \t  \r\n| canigo.integration.notificacions.electroniques        \t|    [1.2.0,1.3.0)    \t|                       |                       |    [1.2.0,1.3.0)      |                       |                    |          \t\r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                    |                    \t  \r\n| **canigo.integration.padro.pica**                     \t|        1.2.0       \t|                       |                       |        1.2.1       \t|                       |                    |        1.2.2       \t  \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                    |    [3.2.0,3.3.0)   \t  \r\n| canigo.integration.pica                               \t|    [1.2.0,1.3.0)   \t|                       |                       |    [1.2.0,1.3.0)   \t|                       |                    |    [1.2.0,1.3.0)   \t  \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                    |                    \t  \r\n| **canigo.integration.pica**                           \t|        1.2.0       \t|                       |                       |        1.2.1       \t|                       |                    |        1.2.2       \t  \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                    |    [3.2.0,3.3.0)   \t  \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                    |                    \t  \r\n| **canigo.integration.psgd**                           \t|       1.2.0         \t|                       |                       |       1.2.1         \t|                       |                    |       1.2.2         \t  \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)     \t|                       |                       |    [3.2.0,3.3.0)     \t|                       |                    |    [3.2.0,3.3.0)     \t  \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                    |                    \t  \r\n| **canigo.integration.psis**                           \t|        1.2.0       \t|                       |                       |        1.2.1       \t|                       |                    |        1.2.2       \t  \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                    |    [3.2.0,3.3.0)   \t  \r\n| canigo.integration.pica                               \t|    [1.2.0,1.3.0)   \t|                       |                       |    [1.2.0,1.3.0)   \t|                       |                    |    [1.2.0,1.3.0)   \t  \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                    |                    \t  \r\n| **canigo.integration.sap**                            \t|        1.2.0       \t|                       |                       |        1.2.1       \t|                       |                    |        1.2.2       \t  \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                    |    [3.2.0,3.3.0)   \t  \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                    |                    \t  \r\n| **canigo.integration.sarcat**                         \t|        1.2.0       \t|                       |                       |        1.2.1       \t|                       |                    |        1.2.2       \t  \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                    |    [3.2.0,3.3.0)   \t  \r\n| canigo.support.sftp                                   \t|    [1.2.0,1.3.0)   \t|                       |                       |    [1.2.0,1.3.0)   \t|                       |                    |    [1.2.0,1.3.0)   \t  \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                    |                    \t  \r\n| **canigo.integration.sarcat.pica**                    \t|        1.2.0       \t|                       |                       |        1.2.1       \t|                       |                    |        1.2.2       \t  \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                    |    [3.2.0,3.3.0)   \t  \r\n| canigo.integration.pica                               \t|    [1.2.0,1.3.0)   \t|                       |                       |    [1.2.0,1.3.0)   \t|                       |                    |    [1.2.0,1.3.0)   \t  \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                    |                    \t  \r\n| **canigo.integration.sgde**                           \t|        1.3.0       \t|                       |                       |        1.3.1       \t|                       |                    |        1.3.2       \t  \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                    |    [3.2.0,3.3.0)   \t  \r\n| canigo.operation.instrumentation                      \t|    [1.2.0,1.3.0)   \t|                       |                       |    [1.2.0,1.3.0)   \t|                       |                    |    [1.2.0,1.3.0)   \t  \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                    |                    \t  \r\n| **canigo.integration.ssc**                            \t|        1.2.0       \t|                       |                       |        1.2.1       \t|                       |                    |        1.2.2       \t  \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                    |    [3.2.0,3.3.0)   \t  \r\n| canigo.operation.instrumentation                      \t|    [1.2.0,1.3.0)   \t|                       |                       |    [1.2.0,1.3.0)   \t|                       |                    |    [1.2.0,1.3.0)   \t  \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                    |                    \t  \r\n| **canigo.integration.tributs.pica**                   \t|        1.2.0       \t|                       |                       |        1.2.1       \t|                       |                    |        1.2.2       \t  \r\n| canigo.core                                           \t|    [3.2.0,3.3.0)   \t|                       |                       |    [3.2.0,3.3.0)   \t|                       |                    |    [3.2.0,3.3.0)   \t  \r\n| canigo.integration.pica                               \t|    [1.2.0,1.3.0)   \t|                       |                       |    [1.2.0,1.3.0)   \t|                       |                    |    [1.2.0,1.3.0)   \t  \r\n|                                                       \t|                    \t|                       |                       |                    \t|                       |                    |                    \t  \r\n\r\n\r\n## Canigó 3.1.x\r\n\r\n|                                                       \t| 07/11/2014 (3.1.0) \t| 20/11/2014 (3.1.1) \t| 25/10/2015 (3.1.2) \t| 25/05/2016 (3.1.3) \t| 25/10/2016 (3.1.4) \t|\r\n|-------------------------------------------------------\t|:------------------:\t|:------------------:\t|:------------------:\t|:------------------:\t|:------------------:\t|\r\n| **canigo.core**                                       \t|        3.1.0       \t|        3.1.1       \t|                    \t|                    \t|                    \t|\r\n| **canigo.persistance.jpa**                            \t|        1.1.0       \t|                    \t|                    \t|        1.1.1       \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|    [3.1.0,3.2.0)   \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.security**                                   \t|        1.1.0       \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.web.core**                                   \t|        1.1.0       \t|                    \t|        1.1.1       \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.web.jsf**                                    \t|        1.2.0       \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.web.core                                       \t|    [1.1.0,1.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.web.validators**                             \t|        1.1.0       \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.web.jsf                                        \t|    [1.2.0,1.3.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.support.fileupload**                         \t|        1.1.0       \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.web.core                                       \t|    [1.1.0,1.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.integration.antivirus                          \t|    [1.1.0,1.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.support.lopd**                               \t|        1.1.0       \t|                    \t|        1.3.0       \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|\r\n| canigo.security                                       \t|    [1.1.0,1.2.0)   \t|                    \t|    [1.1.0,1.2.0)   \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.support.mailing**                            \t|        1.1.0       \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.support.merging**                            \t|        1.1.0       \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.support.ole**                                \t|        1.1.0       \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.support.resizeimg**                          \t|        1.1.0       \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.support.sftp**                               \t|        1.1.0       \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.operation.instrumentation**                  \t|        1.1.0       \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.web.core                                       \t|    [1.1.0,1.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.operation.logging**                          \t|                    \t|                    \t|                    \t|                    \t|        1.0.1       \t|\r\n| canigo.core                                           \t|                    \t|                    \t|                    \t|                    \t|    [3.1.0,3.2.0)   \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.integration.antivirus**                      \t|        1.1.0       \t|                    \t|        1.2.0       \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.integration.avisosalertes.pica**             \t|        1.1.0       \t|                    \t|        1.1.1       \t|        1.1.2       \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|    [3.1.0,3.2.0)   \t|    [3.1.0,3.2.0)   \t|                    \t|\r\n| canigo.integration.pica                               \t|    [1.1.0,1.2.0)   \t|                    \t|    [1.1.0,1.2.0)   \t|    [1.1.0,1.2.0)   \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.integration.dni.pica**                       \t|        1.1.0       \t|                    \t|                    \t|        1.2.0       \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|    [3.1.0,3.2.0)   \t|                    \t|\r\n| canigo.integration.pica                               \t|    [1.1.0,1.2.0)   \t|                    \t|                    \t|    [1.1.0,1.2.0)   \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.integration.documentum(5.3)**                \t|        1.1.0       \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.integration.documentum(6.5)**                \t|        2.1.0       \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.integration.documentum(7.1)**                \t|                    \t|                    \t|                    \t|        3.0.0       \t|                    \t|\r\n| canigo.core                                           \t|                    \t|                    \t|                    \t|    [3.1.0,3.2.0)   \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.integration.gecat**                          \t|        1.1.0       \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.integration.sap                                \t|    [1.1.0,1.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.integration.icc**                            \t|        1.1.0       \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.integration.icc.datatypes                      \t|        1.1.0       \t|                    \t|                    \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.integration.icc.datatypes**                  \t|        1.1.0       \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.integration.notificacions.electroniques**    \t|        1.2.0       \t|                    \t|                    \t|        1.3.1       \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|    [3.1.0,3.2.0)   \t|                    \t|\r\n| canigo.integration.pica                               \t|    [1.1.0,1.2.0)   \t|                    \t|                    \t|    [1.1.0,1.2.0)   \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.integration.notificacions.electroniques.ws** \t|        2.1.0       \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.integration.notificacions.electroniques        \t|        1.2.0       \t|                    \t|                    \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.integration.padro.pica**                     \t|        1.1.0       \t|                    \t|                    \t|        1.1.1       \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|    [3.1.0,3.2.0)   \t|                    \t|\r\n| canigo.integration.pica                               \t|    [1.1.0,1.2.0)   \t|                    \t|                    \t|    [1.1.0,1.2.0)   \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.integration.pica**                           \t|        1.1.0       \t|                    \t|        1.1.1       \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.integration.psgde**                          \t|                    \t|                    \t|                    \t|        1.1.0       \t|        1.1.2       \t|\r\n| canigo.core                                           \t|                    \t|                    \t|                    \t|    [3.1.0,3.2.0)   \t|    [3.1.0,3.2.0)   \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.integration.psis**                           \t|        1.1.0       \t|                    \t|        1.1.1       \t|        1.1.2       \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|    [3.1.0,3.2.0)   \t|    [3.1.0,3.2.0)   \t|                    \t|\r\n| canigo.integration.pica                               \t|    [1.1.0,1.2.0)   \t|                    \t|    [1.1.0,1.2.0)   \t|    [1.1.0,1.2.0)   \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.integration.sap**                            \t|        1.1.0       \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.integration.sarcat**                         \t|        1.1.0       \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.support.sftp                                   \t|    [1.1.0,1.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.integration.sarcat.pica**                    \t|        1.1.0       \t|                    \t|        1.1.1       \t|        1.1.2       \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|    [3.1.0,3.2.0)   \t|    [3.1.0,3.2.0)   \t|                    \t|\r\n| canigo.integration.pica                               \t|    [1.1.0,1.2.0)   \t|                    \t|    [1.1.0,1.2.0)   \t|    [1.1.0,1.2.0)   \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.integration.sgde**                           \t|        1.1.0       \t|                    \t|        1.2.0       \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|\r\n| canigo.operation.instrumentation                      \t|    [1.1.0,1.2.0)   \t|                    \t|    [1.1.0,1.2.0)   \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.integration.ssc**                            \t|        1.1.0       \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n| canigo.operation.instrumentation                      \t|    [1.1.0,1.2.0)   \t|                    \t|                    \t|                    \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n| **canigo.integration.tributs.pica**                   \t|        1.1.0       \t|                    \t|        1.1.1       \t|        1.1.2       \t|                    \t|\r\n| canigo.core                                           \t|    [3.1.0,3.2.0)   \t|                    \t|    [3.1.0,3.2.0)   \t|    [3.1.0,3.2.0)   \t|                    \t|\r\n| canigo.integration.pica                               \t|    [1.1.0,1.2.0)   \t|                    \t|    [1.1.0,1.2.0)   \t|    [1.1.0,1.2.0)   \t|                    \t|\r\n|                                                       \t|                    \t|                    \t|                    \t|                    \t|                    \t|\r\n\r\n\r\n## Canigó 3.0\r\n\r\n- [Matriu Compatibilitat 3.0.x](/related/canigo/download/Matriu+Compatibilitat+Canigó3.0.6.pdf)\r\n\r\n\r\n\r\n\r\n\r\n","objectID":"L2Nhbmlnby1kb3dubG9hZC1yZWxhdGVkL21hdHJpdXMtY29tcGF0aWJpbGl0YXRz"},"L2NlbnRyZS1kZS1zdXBvcnQvYWNjZXM=":{"date":1422115902000,"title":"Accés a les eines de suport","description":"Canals de comunicació amb el CS Canigó","sections":"Centre de Suport","weight":2,"path":"/centre-de-suport/acces","content":"Per obtenir suport de l'Oficina Tècnica de Canigó s'han de seguir els seguents passos: \r\n\r\n - Accedir a l'eina de Gestió d'Incidències: Es pot accedir mitjançant l'enllaç [Obtenir Suport](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN).\r\n \r\n <CENTER>![JIRA](/images/cstd/jira.png)</center>\r\n\r\n - Donar d'alta una incidència: Podeu trobar més informació [aquí] (/centre-de-suport-related/obertura-peticions)\r\n - Fer el seguiment\r\n - Tancar la incidència\r\n \r\nPer veure en detall quins son els procediments i protocols que segueix el Centre de Suport Canigó per a cadascuna de les activitats ho pots trobar [aquí] (/centre-de-suport-related/procediments-protocols).\r\n\r\nEn cas de no dispossar d'accés al [JIRA CSTD](https://cstd.ctti.gencat.cat/jiracstd/) podeu enviar un correu a la [bústia de l'Oficina Tècnica de Canigó](mailto:oficina-tecnica.canigo.ctti@gencat.cat).\r\n","objectID":"L2NlbnRyZS1kZS1zdXBvcnQvYWNjZXM="},"L2Nhbmlnby1kb3dubG9hZC1yZWxhdGVkL3JlbGVhc2Utbm90ZXMtY2FuaWdvLTMx":{"date":1427760000000,"title":"Release Notes Canigó 3.1","description":"","sections":"Canigó","weight":1,"path":"/canigo-download-related/release-notes-canigo-31","content":"#### Release Note\r\n\r\n[Canigó 3.1.0](http://cstd.ctti.gencat.cat/jiracstd/browse/CAN/fixforversion/10420)\r\n\r\n[Canigó 3.1.1](http://cstd.ctti.gencat.cat/jiracstd/browse/CAN/fixforversion/10430)\r\n\r\n[Canigó 3.1.2](http://cstd.ctti.gencat.cat/jiracstd/browse/CAN/fixforversion/10431)\r\n\r\n[Canigó 3.1.3](http://cstd.ctti.gencat.cat/jiracstd/browse/CAN/fixforversion/10438)\r\n\r\n[Canigó 3.1.4](http://cstd.ctti.gencat.cat/jiracstd/browse/CAN/fixforversion/10460)\r\n\r\n\r\n\r\n","objectID":"L2Nhbmlnby1kb3dubG9hZC1yZWxhdGVkL3JlbGVhc2Utbm90ZXMtY2FuaWdvLTMx"},"L2NlbnRyZS1kZS1zdXBvcnQvY29udGFjdGE=":{"date":1465575102000,"title":"Contacta amb el CS Canigó","description":"","weight":10,"path":"/centre-de-suport/contacta","content":"* [oficina-tecnica.canigo.ctti@gencat.cat](mailto://oficina-tecnica.canigo.ctti@gencat.cat)\r\n* [Centre de Suport Tecnològic al Desenvolupament](https://cstd.ctti.gencat.cat/jiracstd)\r\n","objectID":"L2NlbnRyZS1kZS1zdXBvcnQvY29udGFjdGE="},"L2NlbnRyZS1kZS1zdXBvcnQvZmFx":{"date":1422115902000,"title":"Preguntes freqüents","description":"Preguntes i peticions més freqüents adreçades al CS Canigó","sections":"Centre de Suport","weight":3,"path":"/centre-de-suport/faq","content":"## Accés al JIRA CSTD\r\n\r\n### Com demanar un usuari d'accés?\r\nEnviant un correu a la bústia <cstd.ctti@gencat.cat> sol·licitant accés al servei [Canigó](https://cstd.ctti.gencat.cat/jiracstd/projects/CAN).\r\n\r\n## Formació\r\n### Com capacitar-se en Canigó?\r\nMitjançant la realització de cursos presencials que es poden sol- licitar a través de la bústia <oficina-tecnica.canigo.ctti@gencat.cat>\r\n\r\n### Com inscriure's en un curs presencial?\r\nEnviar un correu a la bústia <oficina-tecnica.canigo.ctti@gencat.cat> indicant:\r\n\r\n- Curs i data\r\n- Nombre de persones a inscriure i llistat dels seus noms, dnis i correus eletrònics\r\n- Departament/proveïdor\r\n- Projecte\r\n- Motius de la necessitat\r\n\r\n### Com sol.licitar un curs presencial fora de calendari?\r\nEnviar un correu a la bústia <oficina-tecnica.canigo.ctti@gencat.cat> indicant:\r\n\r\n- Curs sol.licitat\r\n- Motius de la necessitat de formació\r\n- Projecte associat\r\n- Proveïdor destinatari de la formació\r\n- Data d'inici desitjada\r\n- Nombre d'assistents previstos\r\n\r\n## Incidències, Peticions de canvi, Consultes i Suport\r\n### Com introduir una incidència, petició de canvi, consulta o petició de suport?\r\nAccedir al servei [CAN del JIRA CSTD](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN) i crear una petició del tipus desitjat.\r\n\r\n## Col.laboracions\r\n### Com informar d'una col- laboració a Canigó?\r\nSi es considera que una funcionalitat pot ser incorporada a Canigó enviar un correu a la bústia <oficina-tecnica.canigo.ctti@gencat.cat> informant dels objectius de la col.laboració, així com de la informació tècnica si es considera necessari. Qualsevol col.laboració serà avaluada per l'Oficina Tècnica.\r\n\r\nEn cas d'aprovació s'adaptarà als estàndards de qualitat, codificació i documentació de Canigó, i es procedirà a la seva integració per una posterior versió.\r\n","objectID":"L2NlbnRyZS1kZS1zdXBvcnQvZmFx"},"L2NlbnRyZS1kZS1zdXBvcnQvcm9hZG1hcA==":{"date":1443139200000,"lastmod":"2018-04-16","title":"Roadmap CS Canigó","description":"Roadmap del CS Canigó: Canigó, SIC i SGDE","sections":"Roadmap","weight":5,"categories":["canigo","sic","sgde"],"path":"/centre-de-suport/roadmap","content":"<!--Aquest és el Roadmap del CS Canigó per als serveis Canigó, SIC i SGDE:\r\n<iframe src='//cdn.knightlab.com/libs/timeline3/latest/embed/index.html?source=1ycTBuP_02_fFQYHePMhAxAnNt70R4GyTP4phJn3EHi8&font=Default&lang=ca&initial_zoom=1&height=600&start_at_slide=20' width='100%' height='600' frameborder='0'></iframe-->\r\n\r\n\r\n<link title=\"timeline-styles\" rel=\"stylesheet\" href=\"https://cdn.knightlab.com/libs/timeline3/latest/css/timeline.css\" />\r\n\r\n<script src=\"/js/sheet2array.js\"></script>\r\n<script src=\"https://cdn.knightlab.com/libs/timeline3/latest/js/timeline.js\"></script>\r\n\r\n<div id='timeline-embed' style=\"width: 100%; height: 600px;\"></div>\r\n\r\n<script type=\"text/javascript\">\r\n\r\n/*\t   $.getJSON(\"https://script.google.com/macros/s/AKfycbwXOwdyefmpRayODliduXDI2m0wCm_TKMiB_tQkkDDKaA4l9WQ/exec?callback=?\", null, function(results){ */\r\n\t   \t\t\t\r\n\t\t\t\tvar additionalOptions = {\r\n\t\t\t    \tstart_at_slide: 53,\r\n\t\t\t        timenav_height: 200,\r\n\t\t\t        height : 650,\r\n\t\t\t        initial_zoom: 12/*,\r\n\t\t\t        language : \"ca\"*/\r\n\t\t\t    }\t   \t\t\t\r\n\r\n\t\t\t    console.log(additionalOptions)\r\n\r\n\t\t\t  \ttimeline = new TL.Timeline('timeline-embed', 'https://docs.google.com/spreadsheets/d/1ycTBuP_02_fFQYHePMhAxAnNt70R4GyTP4phJn3EHi8/pubhtml', additionalOptions);\r\n/*\t   }); */\r\n\r\n\r\n</script>\r\n\r\n*Aquest Roadmap està subjecte a canvis*\r\n<br><br>\r\nAl següent [enllaç](/canigo/roadmap/) es pot trobar el roadmap del Framework Canigó\r\n","objectID":"L2NlbnRyZS1kZS1zdXBvcnQvcm9hZG1hcA=="},"L2NlbnRyZS1kZS1zdXBvcnQtcmVsYXRlZC9lc3RhdC13b3JrZmxvdy1lc3BhaS1zdXBvcnQ=":{"date":1422115902000,"title":"Estats i workflow de l'espai de suport (incidències, consultes i peticions de canvi)","description":"","sections":"Centre de Suport","weight":1,"path":"/centre-de-suport-related/estat-workflow-espai-suport","content":"### Introducció \r\n\r\nL'espai de suport permet reportar diferents activitats relacionades amb el Framework Canigó. Una activitat pot ser una incidència, una consulta o una petició de canvi.\r\n\r\n - Una incidència informa d'un bug en un servei, i per una versió concreta, del Framework Canigó. Aquest bug, si finalment és tal, ha d'acabar generant una petició de canvi (s'ha de fer una actualització del codi font de Canigó).\r\n - Una consulta planteja un dubte relacionat amb l'ús del Framework Canigó o bé amb el propi Framework Canigó.\r\n - De vegades, un projecte concret necessita una funcionalitat no desenvolupada en el Framework Canigó. En aquests casos, es pot sol- licitar una petició de canvi demanant aquesta nova funcionalitat. Per tal de poder valorar correctament la necessitat d'aquesta petició cal que s'informi amb el màxim detall possible el context (situació inicial que requereix del canvi), i necessitat del canvi (per què s'hauria de fer aquest canvi en el Framework. Si s'han provat solucions alternatives, resultat d'aquestes proves, ...).\r\n \r\n Aquests tipus d'activitats tenen definit un workflow que ens permet, en cada moment, identificar l'estat en què es troba l'activitat (si està assignada, si està en progrés, si està pendent, ...).\r\n\r\nEn els següents apartats s'expliquen els diferents estats pels quals pot passar una activitat i el que signifiquen cadascun d'ells. \r\n\r\n#### 1. Incidències i consultes.\r\n\r\n<b>Estats</b>\r\n\r\n - <b>Nou</b>: el reportador ha donat d'alta una nova incidència o consulta. L'OT de Canigó s'encarregarà de classificar (indicar la seva prioritat) i assignar a una persona de l'Oficina Tècnica de Canigó la nova incidència o consulta.<br>\r\n\t\t- Estats següents: <b>Assignat</b>.\r\n - <b>Assignat</b>: la incidència o consulta ha estat assignada a una persona de l'Oficina Tècnica de Canigó que serà l'encarregada de la resolució i seguiment de la mateixa.<br>\r\n\t\t- Estats següents: En <b>progrés</b> (s'ha iniciat la resolució de la incidència o consulta), <b>Assignat</b> (es reassigna aquesta activitat a una altra persona de l'Oficina Tècnica de Canigó).\r\n - <b>En progrés</b>: la persona encarregada de l'activitat ha passat a estudiar la seva resolució.<br>\r\n\t\t- Estats següents: <b>Resolt</b> (la persona encarregada de l'activitat proposa una solució pel problema reportat), <b>Pendent</b> (la persona encarregada de l'activitat considera que falten dades per arribar a la resolució de la mateixa), <b>Assignat</b> (s'escala el problema perquè no es considera una incidència o consulta sinò una petició de canvi que cal estudiar i avaluar, en aquest cas l'activitat s'assignarà a la persona de l'equip encarregada dels Evolutius del Framework Canigó).\r\n - <b>Pendent</b>: l'OT de Canigó està en espera de què el reportador de l'activitat afegeixi les dades que se li han demanat.<br>\r\n\t\t- Estats següents: En <b>progrés</b> (el reportador ha afegit les dades que se li han demanat i es continua amb la resolució de l'activitat), <b>Tancat</b> per \"<b>Falta d'informació</b>\" (en aquest cas han passat tres o més dies des que es va sol- licitar més informació per la resolució de l'activitat i el reportador de la mateixa no l'ha afegida), <b>Assignat</b> (el reportador de l'activitat ha afegit les dades i així ho comunica, opció \"<b>Dades afegides</b>\").\r\n - <b>Resolt</b>: des de l'OT de Canigó s'ha donat una solució per l'activitat reportada.<br>\r\n\t\t- Estats següents: <b>Tancat</b< en aquest cas el reportador de l'activitat pot tancar-la indicant el grau de satisfacció de la solució proposada, valorant-la d'1 a 5. Anàlogament, l'OT de Canigó pot tancar l'activitat per \"<b>Tancada automàticament</b>\" en el cas que el reportador de l'activitat no l'hagi tancat havent transcorregut tres o més dies. Finalment, un altre estat al que es pot arribar a partir d'aquest és \"<b>Assignat</b>\", aquest és l'estat al que s'arriba quan el reportador de l'activitat no queda conforme amb la resolució donada, amb ell indica que vol que la persona encarregada de la resolució de l'activitat proposi una altra solució.\r\n\t\t\r\n####  2. Peticions de canvi.\r\n\r\n<b>Estats</b>\r\n\r\n - <b>Nou</b>: el reportador ha donat d'alta una petició de canvi. L'OT de Canigó s'encarregarà de classificar (indicar la necessitat d'aquest canvi) i assignar-la a una persona de l'Oficina Tècnica de Canigó la nova<br>\r\nEstats següents: <b>Assignat, Resolt.</b>\r\n - <b>Classificat</b>: l'OT ha classificat la necessitat de la petició de canvi.<br>\r\nEstats següents: <b>En valoració</b> en aquest estat, l'OT valora la necessitat del canvi i estudia la seva planificació.\r\n - <b>En valoració</b>: l'OT indica el temps inicial estimat per dur a terme el canvi demanat així com la versió en què es publicarà el canvi.<br>\r\nEstats següents: <b>Aprovat</b> (el canvi demanat s'implementarà per futures versions de Canigó), <b>Pendent</b> (es requereixen mes dades per part del reportador de la petició de canvi per poder fer una valoració correcta de la petició de canvi), <b>Resolt</b> (no cal dur a terme el canvi indicat perquè aquest ja està resolt).\r\n - <b>Aprovat</b>: el canvi demanat s'implementarà per futures versions de Canigó.<br>\r\nEstats següents: <b>Assignat</b>\r\n - <b>Assignat</b>: la petició de canvi ha estat assignada a una persona de l'Oficina Tècnica de Canigó que serà l'encarregada de la implementació del canvi.<br>\r\nEstats següents: <b>En progrés</b>\r\n - <b>En progrés</b>: la persona encarregada de la petició de canvi comença la seva implementació.<br>\r\nEstats següents: <b>Pendent</b> (manca informació per part del reportador del canvi per dur a terme la implementació del canvi) i <b>Resolt</b> (s'ha dut a terme el canvi sol- licitat).\r\n - <b>Pendent</b>: la implementació de la petició de canvi s'ha aturat momentàniament per falta de dades per part del reportador del canvi.<br>\r\nEstats següents: <b>En Progrés</b> (el reportador ha indicat la nova informació i es continua amb la implementació del canvi) i <b>Tancat</b> (el reportador de la petició de canvi no inclou les dades demanades, es tanca la petició de canvi).\r\n - <b>Resolt</b>: s'ha finalitzat el canvi en el codi font del Framework Canigó.<br>\r\nEstats següents: <b>Tancat</b> (s'ha finalitzat el canvi) i <b>Classificat</b> (es reobre la petició de canvi, cal tornar a estudiar-la per classificar-la convenientment).\r\n - <b>Tancat</b>: s'ha finalitzat el canvi.<br>\r\n","objectID":"L2NlbnRyZS1kZS1zdXBvcnQtcmVsYXRlZC9lc3RhdC13b3JrZmxvdy1lc3BhaS1zdXBvcnQ="},"L2NlbnRyZS1kZS1zdXBvcnQvcXVlLWVzLWVsLWNz":{"date":1422115902000,"title":"El Centre de suport Canigó","description":"Què és el Centre de suport Canigó?","sections":"Centre de Suport","weight":1,"path":"/centre-de-suport/que-es-el-cs","content":"El **Centre de Suport Canigó** s'orienta a proporcionar serveis d'acompanyament als Departaments oferint el suport i assessorament tecnològic necessaris per tal d'assolir l'èxit de les seves noves iniciatives tecnològiques així com donar suport al correcte funcionament de les aplicacions i serveis actualment desplegats.\r\n\r\nActualment el Centre de Suport ofereix aquests serveis per a 3 productes diferents:\r\n\r\n* **Framework Canigó**: espai comú de treball per al desenvolupament de noves aplicacions amb tecnologia JEE basades en entorn web. Aquest framework es composa de diferents serveis i proporciona una arquitectura d'aplicacions consistent i única per tots els desenvolupaments.\r\n* **Servei d'Integració Contínua (SIC)**: està composat per diferents sistemes que ens permeten, entre d'altres, el repositori controlat del codi font dels diferents sistemes d'informació de la Generalitat, i la construcció de l'aplicació a partir d'aquest codi i el seu desplegament a les infraestructures de la Generalitat.\r\n* **Plataforma formularis electrònics**: plataforma que permet la interacció amb formularis electrònics basats en Adobe Experience Manager 6.3. Ofereix les funcionalitats d'extracció de dades dels formularis o la seva renderització, a més de la publicació i activació de nous formularis PDF i HTML5.\r\n\r\n## Quins són els seus objectius?\r\n\r\nEls objectius principals del Centre de Suport es poden resumir en els següents aspectes:\r\n\r\nPel que fa als usuaris dels productes del Centre de Suport Canigó:\r\n\r\n* Assegurar l'èxit en la construcció i implantació de les aplicacions basades en els nostres productes.\r\n* Garantir la qualitat dels sistemes que es desenvolupin sobre Canigó.\r\n* Assegurar que tota la informació relacionada amb els productes del centre de suport arriba als col- lectius que la necessiten.\r\n* Oferir formació i suport tècnic especialitzat (incidències, consultes, ...)\r\n\r\nPel que fa als propis productes del Centre de Suport Canigó:\r\n\r\n* Asegurar la seva evolució tant a nivell correctiu com evolutiu.\r\n* Garantir la màxima qualitat dels nostres productes, tant pel que fa al codi com al material de suport.\r\n* Planificar, controlar i produir de forma continuada noves versions o evolucions, seguint les necessitats de la Generalitat.\r\n* Garantir la total integració de Canigó, i els altres productes, en l'entorn TIC de la Generalitat de Catalunya.\r\n","objectID":"L2NlbnRyZS1kZS1zdXBvcnQvcXVlLWVzLWVsLWNz"},"L2NlbnRyZS1kZS1zdXBvcnQtcmVsYXRlZC9vYmVydHVyYS1wZXRpY2lvbnM=":{"date":1422115902000,"title":"Obertura de peticions","description":"","sections":"Centre de Suport","weight":1,"path":"/centre-de-suport-related/obertura-peticions","content":"#### Tipus de peticions\r\n\r\nExisteixen 4 tipus diferents de peticions que es poden obrir pel servei Canigó (Framework J2EE).\r\n\r\n#### Peticions de Canvi\r\n\r\nPeticions indicades quan es creu interessant que el Framework reflecteixi algun canvi important en algun dels seus components o bé sorgeix la necessitat de crear algun component nou.\r\n\r\nTotes les peticions de canvi han d'anar acompanyades d'una explicació detallada dels motius pels quals es sol- licita el canvi.\r\n\r\nEl Centre de Suport avaluarà aquesta petició i conclourà si la desenvolupa o no en base a les necessitats de l'aplicació e impacte que aquest tingui sobre el Framework.\r\n\r\nEn cas de que es desenvolupi el canvi, normalment aquest estarà disponible en la següent versió de Canigó.\r\n\r\n#### Peticions de Consulta\r\n\r\nPeticions orientades a la resolució de qüestions relacionades amb la utilització del Framework de Canigó. En aquest tipus de peticions es poden redactar preguntes relacionades amb problemes derivats de l'ús dels components del Framework, errors de desenvolupament i dubtes varis.\r\n\r\nEl mateix Centre de suport s'encarregarà de canviar la categorització de Consulta a Incidència si es detectés un problema a nivell del Framework dintre de la petició.\r\n\r\n#### Peticions d'Incidència\r\n\r\nPeticions relacionades amb errors detectats dintre d'algun component del Framework. Aquests errors poden ser deguts a un ús incorrecte dels components del Framework. Per tal motiu es recomana llegir la documentació del Framework disponible en el portali en cas de dubte, obrir una petició de Consulta.\r\n\r\n#### Peticions de Suport\r\n\r\nPeticions que sol- liciten que el Centre de Suport de Canigó faci un seguiment més proper de l'aplicació per tal de resoldre algun problema específic o bé acompanyar i assessorar a l'aplicació en el transcurs d'un desenvolupament especial amb Canigó.\r\n\r\n\r\n### Dades de les Peticions\r\n\r\nInicialment s'han d'informar una sèrie de dades en el moment de la creació de la petició. Aquestes dades tot i que no siguin obligatòries per tal de crear la petició en el JIRA si ho són de cara a la resolució d'aquesta.\r\nLa carència d'aquestes dades allarga la resolució de la petició en molts casos i és per aquest motiu que es molt recomanable que s'omplin.\r\n\r\nLes peticions de canvi, incidència i consulta tenen les mateixes dades inicials per poder omplir-se. Comentarem aquelles que no són obligatòries i que es molt recomanable omplir per tal de facilitar la seva resolució per part del Centre de Suport.\r\n\r\n - Sumari: Breu descripció del motiu de la petició.\r\n - Urgència: Urgència que l'implica a l'aplicació la resolució de la petició.\r\n - Àmbit: Indica l'entorn on s'està produint el motiu de la petició si aplica.\r\n - Organisme / Projecte Afectat: Organisme i projecte al qual pertany l'aplicació que està obrint la petició.\r\n - Versions afectades: Informa la versió de Canigó que s'està utilitzant si aplica.\r\n - Components: Informa dels components del Framework afectats pel motiu de la petició si aplica.\r\n - Informador: Persona que informa la petició.\r\n - Descripció: Descripció detallada del motiu de la petició.\r\n - Adjunció: Dona la posibilitat d'afegir arxius adjunts a la petició en el moment de la seva creció.\r\n - Telèfon: Telèfon de contacte amb la persona/es responsables de l'aplicació o creadors de la petició.\r\n - Nivell de bloqueig: Grau de bloqueig que la petició provoca en les tasques a desenvolupar dintre de l'aplicació.\r\n - Servidor d'aplicacions: Servidor d'aplicacions que s'està utilitzant per desplegar l'aplicació si aplica.\r\n - JDK: Versió del Java Development Kit que s'està utilitzant per compilar l'aplicació si aplica.","objectID":"L2NlbnRyZS1kZS1zdXBvcnQtcmVsYXRlZC9vYmVydHVyYS1wZXRpY2lvbnM="},"L2NlbnRyZS1kZS1zdXBvcnQtcmVsYXRlZC9wcm9jZWRpbWVudHMtcHJvdG9jb2xz":{"date":1422115902000,"title":"Procediments i protocols en la gestió d'activitats (incidències, consultes i peticions de canvis)","description":"","sections":"Centre de Suport","weight":1,"path":"/centre-de-suport-related/procediments-protocols","content":"### Pel que fa a l'espai de suport (incidències, consultes i peticions de canvi).\r\n\r\nEn els següents pàgines s'expliquen diferents qüestions de l'espai de suport (incidències, consultes i peticions de canvis).\r\n\r\n - [Estats i workflow de l'espai de suport.] (/centre-de-suport-related/estat-workflow espai suport)\r\n - [Millores en l'espai de suport.] (/centre-de-suport-related/millores-espai-suport)\r\n \r\n### Procediment per classificar un canvi.\r\n\r\nAquí podrà consultar els procediments que es segueixen per classificar i atendre les peticions de canvis: [Procediment de Canvis] ()\r\n\r\n### Procediment per classificar una incidència.\r\n\r\nEn primera instància es tenen en compte el següents paràmetres: <b>àmbit, bloqueig i risc del projecte</b>. D'aquests paràmetres, i consultant unes taules, s'extreu <b>l'impacte del projecte</b>.\r\nEn segona instància es consideren dos paràmetres més: <b>l'impacte del projecte</b> (obtingut al pas anterior) i la <b>urgència de la incidència</b>, d'aquests dos paràmetres, i de nou consultant una altra taula, s'extreu la <b>prioritat de la incidència</b>.\r\n\r\n### Acord de nivell de servei i procediments.\r\n\r\nEl nivell de servei de l'Oficina Tècnica de Canigó considera la prioritat de la incidència per establir uns temps de resposta tant per part de l'OT com per part de l'usuari reportador de la incidència. Es considera, doncs, la següent taula:\r\n\r\n<b>Acords de nivell de servei (en hores)</b>\r\n\r\nPrioritat de la incidència | T0 | T1 | T2\r\n----|----|----|----\r\nMàxima|2|8|4\r\nAlta|2|16|8\r\nMitja|16|24|16\r\nBaixa|16|24|24\r\n\r\nPrioritat de les consultes | T0 | T1 | T2\r\n----|----|----|----\r\nNormal|16|24|24\r\n\r\nOn T0 és el temps màxim que pot transcorre des que es genera una activitat fins que es classifica i s'assigna a una persona de l'equip de l'OT, T1 és el temps màxim que pot transcorre per resoldre l'activitat i T2 és el temps màxim que pot transcorre pel tancament, per part del reportador, de l'activitat.\r\n\r\nPer tant, si una activitat RESOLTA no es tanca en el temps previst, aquesta es tancarà per <b>\"Defecte de forma\"</b>, doncs, implica que l'equip de l'OT ha donat una solució temporal a l'activitat reportada i que la persona reportadora de l'activitat no ha comentat res al respecte; s'entèn, doncs, que la resposta donada ha estat satisfactòria.\r\n\r\nAddicionalment, l'Oficina Tècnica de Canigó podrà tancar activitats reportades per:\r\n\r\n - \"<b>Fora d'àmbit.</b>\"Independentment de l'estat en que es trobi l'activitat, es considera que l'assumpte tractat en l'activitat no és de la competència de l'Oficina Tècnica de Canigó.\r\n - \"<b>Desconeixement del Framework</b>\".Independentment de l'estat en què es trobi l'activitat, es considera que el reportador de l'activitat demostra un desconeixement del framework Canigó, en aquests casos, s'acostumarà a redirigir a l'usuari reportador al Portal de Canigó a l'apartat de [documentació] (/canigo-documentacio).","objectID":"L2NlbnRyZS1kZS1zdXBvcnQtcmVsYXRlZC9wcm9jZWRpbWVudHMtcHJvdG9jb2xz"},"L2Nsb3VkL2NvbXVuaWNhY2lvLXN1cG9ydC1jbG91ZA==":{"date":1516147200000,"title":"Comunicació proveïdors d'aplicacions amb Suport Cloud","description":"Canals de comunicació disponibles pels proveïdors d'aplicacions amb Suport Cloud","sections":"Cloud","categories":["cloud"],"weight":6,"path":"/cloud/comunicacio-suport-cloud","content":"S'oficialitzen el [**CSTD (Centre de Suport Tecnològic al Desenvolupament)**](https://cstd.ctti.gencat.cat/) i [**Remedy**](https://pautic.gencat.cat/) com a canals de comunicació amb l'equip de Suport Cloud. A continuació es descriu quin és l'ús que s'ha de fer de cadascun d'ells:\r\n\r\n<br/>\r\n\r\n#### Aplicacions en servei\r\n\r\nPer les aplicacions que estiguin en servei:\r\n\r\n- **Remedy**\r\n\r\n_Incidències_, _Consultes_ (*) i _Canvis_ que es vulguin fer arribar a l'equip de Suport Cloud s'han de crear a Remedy informant l'aplicació afectada com a \"Service\" i \"A6-N3-CLOUD\" com a \"Assigned Group\".\r\n\r\n(*) per les consultes cal informar el camp “INCIDENT TYPE” el valor “USER SERVICE REQUEST”.\r\n\r\n<div class=\"message information\">\r\nDonat que a les plataformes Cloud gestionades des de Suport Cloud es dóna accés a <b>logs</b> i <b>monitoratge</b> de l'aplicació, per l'agilitat en la resolució de les incidències és vital que el proveïdor d'aplicacions hagi revisat abans tota la informació de la qual disposa. També gràcies als <b>jobs de desplegament</b> del <a href=\"http://canigo.ctti.gencat.cat/sic/\">SIC</a> és autònom per redesplegar el servei afectat. Per tant, només haurien d'arribar incidències a Suport Cloud relacionades amb la plataforma (Ex. indisponibilitat global de la plataforma), que ni tan sols redesplegant el servei puguin resoldre's.\r\n</div>\r\n\r\n<br/>\r\n\r\n#### Aplicacions en fase de projecte\r\n\r\nPer les aplicacions en fase de projecte la comunicació s'ha de fer via **CSTD** al servei [**Servei Acompanyament Suport Cloud**](https://cstd.ctti.gencat.cat/jiracstd/browse/ACOCLD). El proveïdor d'aplicacions ha de crear una petició en aquest servei informant el camp Sumari \"Suport projecte NOM_PROJECTE\". Mentre l'aplicació estigui en fase de projecte tot el suport (Ex. definició d'imatges Docker, definició de descriptors de desplegament,...) es canalitzarà en aquesta petició.\r\n\r\n<br/>\r\n\r\n#### Aplicacions que no han iniciat el procés d'alta dins CTTI\r\n\r\n_Consultes_ i _Suports_ han de realitzar-se al servei [**CS Suport Cloud**](https://cstd.ctti.gencat.cat/jiracstd/browse/CLD).\r\n\r\n<br/>\r\n\r\nEn cas que no es disposi d'usuari al CSTD, cal que el gestor de projecte CTTI de l'aplicació faci arribar la petició d'alta d'usuari al propi [servei CSTD](https://cstd.ctti.gencat.cat/jiracstd/browse/CSTD) o bé enviant un correu a la bústia [cstd.ctti@gencat.cat](mailto:cstd.ctti@gencat.cat).\r\n","objectID":"L2Nsb3VkL2NvbXVuaWNhY2lvLXN1cG9ydC1jbG91ZA=="},"L2NlbnRyZS1kZS1zdXBvcnQtcmVsYXRlZC9taWxsb3Jlcy1lc3BhaS1zdXBvcnQ=":{"date":1422115902000,"title":"Millores en l'espai de suport (incidències, consultes i peticions de canvi).","description":"","sections":"Centre de Suport","weight":1,"path":"/centre-de-suport-related/millores-espai-suport","content":"S'han afegit les següents funcionalitats en l'espai de suport:\r\n\r\n - S'ha afegit un apartat on es poden consultar les activitats més populars (aquelles activitats no resoltes ordenades per vots). Aquest nou apartat es troba a <b>\"Visualitzar Serveis\"</b> > <b>\"Activitats Populars\"</b>.\r\n","objectID":"L2NlbnRyZS1kZS1zdXBvcnQtcmVsYXRlZC9taWxsb3Jlcy1lc3BhaS1zdXBvcnQ="},"L2Nsb3VkL2Rldm9wcy1jbG91ZA==":{"date":1551052800000,"title":"Devops","description":"Model Devops","sections":"Cloud","categories":["cloud","docker","container","paas","openshift","kubernetes","swarm","azure","devops"],"weight":3,"path":"/cloud/devops-cloud","content":"![Devops](/related/cloud/devops.png)\r\n\r\nDevops representa un canvi en la cultura de les Tecnologies de la Informació, centrant-se en el lliurament ràpid de solucions TIC a través de l'adopció de pràctiques àgils i gestió Lean orientades a sistemes d’informació.\r\n\r\nLa implantació de DevOps en el CTTI es recolza sobretot en les eines d'automatització i gestió del codi actualment existents, i que progressivament es van dotant de més funcionalitats per disposar d’una infraestructura cada vegada més programable i dinàmica des d'una perspectiva de cicle de vida de les solucions. \r\n\r\nAquestes eines d’automatització cobreixen en dues grans disciplines:\r\n\r\n- El desenvolupament i desplegament, per tal de permetre dotar de la màxima velocitat des de que es concep una idea fins que aquesta es troba en producció, minimitzant la intervenció manual però mantenint alhora les garanties de qualitat requerides.\r\n- El monitoratge i diagnòstic, per tal de donar visibilitat als responsables de les aplicacions de tots aquells indicadors que permetin avançar-se a qualsevol problema que afecti l’aplicació i a poder-ne diagnosticar les causes.\r\n\r\n\r\n## Objectius del model DEVOPS\r\n\r\n- El responsable i primer contacte de l’aplicació és el Lot d’Aplicacions.\r\n- Maximitzar l’autoservei d’infraestructures.\r\n- Maximitzar l’autonomia del lot d’aplicacions.\r\n- Maximitzar la visibilitat de l’entorn al lot d’aplicacions.\r\n- Maximitzar l’automatització de tasques.\r\n- Minimitzar el temps necessari per a posar una solució en servei.\r\n- Minimitzar la intervenció humana en el tiqueting.\r\n- Eliminar la compartició de recursos entre aplicacions.\r\n\r\nPodeu veure les tasques que són responsabilitat de l'equip de desenvolupament a [Tasques OPS del desenvolupament al Cloud.](https://canigo.ctti.gencat.cat/cloud/ops-cloud/)","objectID":"L2Nsb3VkL2Rldm9wcy1jbG91ZA=="},"L2Nsb3VkL29wcy1DbG91ZA==":{"date":1529107200000,"title":"Tasques OPS del desenvolupament al Cloud","description":"En aquest article es descriuen les tasques OPS del model DEVOPS aplicat als entorns cloud GENCAT.","sections":"Cloud","weight":4,"toc":true,"categories":["cloud","docker","container","kubernetes"],"key":"JUNY2018","path":"/cloud/ops-Cloud","content":"Dins del paradigma de desplegament al Container Cloud, l'equip de desenvolupament ha d'assumir certes tasques que en el model \"On Premise\" son pròpies de l'operativa de CPD.\n\n![Cloud devops](https://canigo.ctti.gencat.cat/related/cloud/cloud_devops.JPG)\n\nLes pròpies tecnologies utilitzades en el catàleg cloud com contenidors, i el desplegament en clouds públics fora del NUS, porta implícita l'assumpció de la responsabilitat de la configuració i el manteniment i securització de tots els elements que componen un desenvolupament. Les pricipals noves tasques que l'equip de desenvolupament haurà d'assumir es poden agrupar en les següents categories.\n\n## Disponibilitat de l’aplicació\nL'equip de desenvolupament ha de definir la parametrització a nivell de monitorització dels elements disponibles dins de la plataforma cloud que s'utilitzi (llindars d'alarmes, helth checks, etc) així com les necessitats de backup per a la seva recuperació i la seva implementació.\n\n## Monitorització de la infraestructura\nL'equip de desenvolupament té accés a la monitorització i defineix els mecanismes per a garantir la disponibilitat dels elements de l'aplicació, i assigna a un nou equip si no s'és autonom en la resolució de la disponibilitat.\n\n## Dimensionament d’una aplicació\nL'equip de desenvolupament ha de dimensionar l'aplicació i el seu creixement en totes les seves vessants, inclouent qualsevol element facturable per ús tal com el consum de xarxa.\n\n## Indicadors tècnics\nL'equip de desenvolupament disposarà de les eines i visibilitat suficient per a extreure els indicadors de rendiment, capacitat i de cost de la seva aplicació.\n\n## Seguretat de l’aplicació\nL'equip de desenvolupament defineix i gestiona la seguretat a nivell no únicament de codi, sinó de Middleware, SO i xarxa. És també responsable de la monitorització dels accessos i de garantir la seguretat d'aquests.\n\n## Gestió del canvi\nL'equip de desenvolupament ha de garantir la vigència no únicament del codi, sinó de també dels Middlewares i SO utilitzats.\n\n## Desplegament de l’aplicació\nL'equip de desenvolupament inclou en el desplegament l'aplicació, el Middleware, la parametrització del middlware i el SO amb la seva parametrització.\n\n## Resposta davant incidències\nL'equip de desenvolupament serà el primer receptor de les incidències i peticions i tindrà les eines per a poder-les resoldre en la seva majoria. Havent d'escalar únicament aquelles que impliquin validació de cost per part del departament o incidències de plataforma. Aquest fet implica que l'aplicació ha d'estar configurada per tal de que la gran majoria de tasques associades a incidències estiguin automatitzades.\n","objectID":"L2Nsb3VkL29wcy1DbG91ZA=="},"L2Nsb3VkL3BsYXRhZm9ybWVzLWNsb3Vk":{"date":1550793600000,"title":"Plataformes Cloud","description":"Plataformes cloud disponibles a la Generalitat de catalunya","sections":"Cloud","weight":2,"categories":["cloud","caas","xpaas","dbaas","iaas"],"path":"/cloud/plataformes-cloud","content":"![Plataformes cloud](/related/cloud/catalegCloud.png)\r\n\r\n## Cloud Privat\r\n\r\n### CaaS\r\n\r\n#### AppAgile\r\n\r\n- http://appagile.io/\r\n- Basat en Openshift: https://www.openshift.com/\r\n- Contenidors docker i orquestració amb Openshift\r\n- Versió:  **OpenShift Container Platform 3.9.65 i Kubernetes 1.9.1.** \r\n\r\n#### SwarmMe\r\n\r\n- Basat en Swarm: https://docs.docker.com/swarm/\r\n- Contenidors docker i orquestració amb Swarm\r\n- Versió: **Docker 17.03.1-ce**\r\n\r\n#### IBM KaaS\r\n\r\n- Basat en Kubernetes: https://kubernetes.io/\r\n- Contenidors docker i orquestració amb Kubernetes\r\n- Versió: **Kubernetes 1.11.5. Docker 17.3.2**\r\n\r\n### DBaaS\r\n\r\n#### AppAgile\r\n\r\n- http://appagile.io/\r\n- Basat en Openshift: https://www.openshift.com/\r\n- S'ofereixen les Bases de dades administrades PostgreSQL i MySQL.\r\n\r\n\r\n## Cloud Públic\r\n\r\n### xPaaS\r\n\r\n#### IBMCloud Runtimes\r\n\r\nBasat en Cloud Foundry\r\nJava, Node.js, PHP, Python, Ruby, Swift i Go\r\nTambé permet runtimes i contenidors personalitzats.\r\n\r\n- https://www.ibm.com/cloud-computing/bluemix/es/runtimes\r\n\r\n#### Azure\r\n\r\n.NET, Java, Node.js, PHP i Python a Windows\r\n.NET Core, Node.js, PHP i Ruby a Linux\r\n\r\n- https://azure.microsoft.com/es-es/services/app-service/web/\r\n\r\n### CaaS\r\n\r\n#### IBMCloud Kubernetes\r\n\r\nContenidors docker desplegats sobre la plataforma Kubernetes\r\n\r\n- https://www.ibm.com/cloud-computing/bluemix/es/containers\r\n- Versió: **Kubernetes 1.12.5. Containerd 1.1.5**\r\n\r\n### DBaaS\r\n\r\n#### Compose\r\n\r\nElasticSearch, MongoDB, PostgreSQL, Redis\r\n\r\n- https://www.compose.com/\r\n\r\n#### Azure\r\n\r\nPrincipalment SQL Server, PostgreSQL i MySQL\r\n\r\n- https://azure.microsoft.com/es-es/services/sql-database/\r\n- https://azure.microsoft.com/es-es/services/mysql/\r\n- https://azure.microsoft.com/es-es/services/postgresql/\r\n\r\n### IaaS\r\n\r\n#### Azure\r\n\r\nMàquines virtuals windows i linux.\r\n\r\n- https://azure.microsoft.com/es-es/\r\n","objectID":"L2Nsb3VkL3BsYXRhZm9ybWVzLWNsb3Vk"},"L2Nsb3VkL3RpcG9sb2dpZXMtY2xvdWQ=":{"date":1551052800000,"title":"Tipologies Cloud","description":"Descripció dels diferents tipus de cloud i les seves característiques més importants","sections":"Cloud","categories":["cloud","docker","container","paas","openshift","kubernetes","swarm","azure"],"weight":1,"path":"/cloud/tipologies-cloud","content":"Bàsicament es poden distingir 3 tipus de cloud:\r\n\r\n- Cloud públic\r\n- Cloud privat\r\n- Cloud hibrid\r\n\r\n### Cloud públic\r\n\r\nEls servidors de cloud estan allotjats a instalacions de tercers i tot i que en alguns casos els recursos són d'us exclusiu, la major part de vegades els recursos són compartits.\r\n\r\nLa connexió als clouds públics es realitza a traves d'internet o alguna VPN.\r\n\r\nCaracterístiques:\r\n\r\n- Integració amb la operativa de l'empresa complexa\r\n- Millores de costos altes\r\n- Escalabilitat i flexibilitat molt altes\r\n- Resposta bona davant de pics de demanda\r\n- Modular i escalable\r\n\r\n### Cloud privat\r\n\r\nEls servidors de cloud estan allotjats a instalacions propies o a centres de dades dedicats d'ús exclusiu.\r\n\r\nLa connexió als clouds privats es realitza a traves de la xarxa interna de la empresa.\r\n\r\nCaracterístiques:\r\n\r\n- Integració amb la operativa de l'empresa senzilla\r\n- Millores de costos moderades\r\n- Escalabilitat i flexibilitat limitades\r\n- Riscos d'obsolescència\r\n- Resposta limitada davant de pics de demanda\r\n- Normalment a mida\r\n\r\n\r\n### Cloud hibrid\r\n\r\nEs una barreja del entre els dos models anteriors, part dels recursos estan en cloud públic i part dels recursos estan en cloud privat.\r\n\r\n- Integració amb la operativa de l'empresa mitja\r\n- Millores de costos intermèdies\r\n- Escalabilitat i flexibilitat mitges\r\n- Adequat per escenaris de desbordament\r\n- Normalment a mida\r\n\r\n## Tipologies Cloud segons el nivell de servei\r\n\r\nDins del món cloud existeixen diferents tipus de cloud en funció del nivell de servei que ofereixen.\r\n\r\nBàsicament es poden distingir 5 tipus de cloud:\r\n\r\n- SaaS\r\n- xPaaS\r\n- DBaaS\r\n- CaaS\r\n- IaaS\r\n\r\n![Tipus de cloud](/related/cloud/tipusCloud.png) \r\n\r\n### SaaS\r\n\r\nAnomenarem així als serveis, que:\r\n\r\n- Estan desplegats i s’executen a infraestructura cloud.\r\n- El servei és compartit entre tots els usuaris.\r\n- Els usuaris només consumeixen el servei. No tenen capacitat de control o administració del mateix, més enllà de configuració a nivell d’usuari.\r\n\r\n### xPaaS\r\n\r\nAnomenarem així als entorns d’execució, que:\r\n\r\n- Són un nivell extra per sobre de la containerització\r\n- Contenen un motor d’execució (p.e. un servidor d’aplicacions) on posarem la nostra aplicació o funcionalitat\r\n- Configurarem:\r\n  - la potència: cpu/ram\r\n  - el nombre d’instàncies que correran en paral·lel per a aconseguir més concurrència\r\n\r\n### DBaaS\r\n\r\nLes bases de dades com a servei són un cas concret de xPaaS on:\r\n  \r\n- la db és una commodity: no hi ha administració, de fet, és transparent on i com corre\r\n- escala automàticament segons els requeriments (volum, índexos, ...)\r\n- el desenvolupador, amb les credencials d’accés, bàsicament guarda i recupera registres\r\n\r\n### IaaS\r\n\r\n- S’aprovisiona infraestructura fins a nivell de Sistema Operatiu.\r\n- Inclou la instal·lació del sistema operatiu, però no el seu manteniment.\r\n- El desenvolupador no gestiona el maquinari, però si tot el programari.\r\n- El desenvolupador disposa de credencials d’administrador per gestionar el servidor com consideri oportú.\r\n- El desenvolupador és responsable d’instal·lar i mantenir tot el programari necessari.\r\n\r\n","objectID":"L2Nsb3VkL3RpcG9sb2dpZXMtY2xvdWQ="},"L2Nsb3VkLWNhYXMvY2F0YWxlZy1jb250ZW5pZG9ycw==":{"date":1550707200000,"title":"Elements del catàleg de contenidors","description":"Descripció de les imatges docker base proporcionades pel CTTI.","sections":"Cloud","weight":1,"toc":true,"categories":["cloud","docker","container","kubernetes","openshift","swarm","appagile","swamme","ibm","caas"],"path":"/cloud-caas/cataleg-contenidors","content":"En aquesta secció es descriuen les diferents imatges docker homologades pel CTTI i utilitzables a les diferents plataformes de contenidors.\r\n\r\n## **Imatges de contenidors base**\r\n\r\nPer facilitar la tasca de desenvolupament i creació d'aplicacions basades en contenidors, CTTI ofereix un conjunt d'imatges certificades i alineades amb les versions del software del [Full de Ruta de Programari](https://qualitat.solucions.gencat.cat/estandards/estandard-full-ruta-programari/).\r\n\r\nPodeu trobar aquestes imatges certificades al [registre privat](https://docker-registry.ctti.extranet.gencat.cat). Si necessiteu més informació d'aquest registre privat, podeu consultar [Registre docker privat](http://canigo.ctti.gencat.cat/cloud-caas/dockerRegistry/).\r\n\r\n**Element**  | **Versió**   | **Imatge Docker**   | **Codi font**\r\n------------ | ------------ |-------------------- |-----------\r\nApache \t\t | 2.4    | docker-registry.ctti.extranet.gencat.cat/gencatcloud/httpd:2.4   | [httpd](https://git.intranet.gencat.cat/3048-intern/imatges-docker/httpd/tree/2.4)\r\nApache GICAR Shibboleth| 1.0.3    |docker-registry.ctti.extranet.gencat.cat/gencatcloud/gicar-shibboleth:1.0.3   | [gicar-shibboleth](https://git.intranet.gencat.cat/3048-intern/imatges-docker/gicar-shibboleth/tree/1.0.3)\r\nApache GICAR Shibboleth Kubernetes/Openshift| 1.0.3    |docker-registry.ctti.extranet.gencat.cat/gencatcloud/gicar-shibboleth-openshift:1.0.3   | [gicar-shibboleth-openshift](https://git.intranet.gencat.cat/3048-intern/imatges-docker/gicar-shibboleth-openshift/tree/1.0.3)\r\nApache Proxy ElasticSearch  \t | 2.4-1.0   |docker-registry.ctti.extranet.gencat.cat/gencatcloud/httpd-proxy-es:2.4-1.0   | [httpd-proxy-es](https://git.intranet.gencat.cat/3048-intern/imatges-docker/httpd-proxy-es/tree/2.4-1.0)\r\nNginx  \t | 1.12   |docker-registry.ctti.extranet.gencat.cat/gencatcloud/nginx:1.12   | [nginx](https://git.intranet.gencat.cat/3048-intern/imatges-docker/nginx/tree/1.12)\r\nNginx  \t | 1.14   |docker-registry.ctti.extranet.gencat.cat/gencatcloud/nginx:1.14   | [nginx](https://git.intranet.gencat.cat/3048-intern/imatges-docker/nginx/tree/1.14)\r\nJava\t\t | 7  | docker-registry.ctti.extranet.gencat.cat/gencatcloud/java:7   | [java](https://git.intranet.gencat.cat/3048-intern/imatges-docker/java/tree/7)\r\nJava\t\t | 8  | docker-registry.ctti.extranet.gencat.cat/gencatcloud/java:8   | [java](https://git.intranet.gencat.cat/3048-intern/imatges-docker/java/tree/8)\r\nMySql \t\t | 5.7   |docker-registry.ctti.extranet.gencat.cat/gencatcloud/mysql:5.7   | [mysql](https://git.intranet.gencat.cat/3048-intern/imatges-docker/mysql/tree/5.7)\r\nNodeJS \t\t | 6   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/node:6   | [node](https://git.intranet.gencat.cat/3048-intern/imatges-docker/node/tree/6)\r\nNodeJS \t\t | 8   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/node:8   | [node](https://git.intranet.gencat.cat/3048-intern/imatges-docker/node/tree/8)\r\nNodeJS \t\t | 10   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/node:10   | [node](https://git.intranet.gencat.cat/3048-intern/imatges-docker/node/tree/10)\r\nPHP \t\t | 7.1   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/apache-php:7.1   | [apache-php](https://git.intranet.gencat.cat/3048-intern/imatges-docker/apache-php/tree/7.1)\r\nPHP \t\t | 7.2   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/apache-php:7.2   | [apache-php](https://git.intranet.gencat.cat/3048-intern/imatges-docker/apache-php/tree/7.2)\r\nPostgres\t | 10.5   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/postgres:10.5   | [postgres](https://git.intranet.gencat.cat/3048-intern/imatges-docker/postgres/tree/10.5)\r\nTomcat  \t | 9.0-java8   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/tomcat:9.0-java8   | [tomcat](https://git.intranet.gencat.cat/3048-intern/imatges-docker/tomcat/tree/9.0-java8)\r\nMaven builder  \t | 1.0-3.5.3-8   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/maven-builder:1.0-3.5.3-8   | [maven builder](https://git.intranet.gencat.cat/3048-intern/imatges-docker/maven-builder/tree/1.0-3.5.3-8)\r\nMaven builder  \t | 1.0-3.6-8   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/maven-builder:1.0-3.6-8   | [maven builder](https://git.intranet.gencat.cat/3048-intern/imatges-docker/maven-builder/tree/1.0-3.6-8)\r\nNpm builder  \t | 1.0-4-2.15   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/npm-builder:1.0-4-2.15  | [npm builder](https://git.intranet.gencat.cat/3048-intern/imatges-docker/npm-builder/tree/1.0-4-2.15)\r\nNpm builder  \t | 1.0-6-3.10   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/npm-builder:1.0-6-3.10  | [npm builder](https://git.intranet.gencat.cat/3048-intern/imatges-docker/npm-builder/tree/1.0-6-3.10)\r\nNpm builder  \t | 1.0-8-5.6    | docker-registry.ctti.extranet.gencat.cat/gencatcloud/npm-builder:1.0-8-5.6   | [npm builder](https://git.intranet.gencat.cat/3048-intern/imatges-docker/npm-builder/tree/1.0-8-5.6 )\r\nNpm builder  \t | 1.0-8-6.4   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/npm-builder:1.0-8-6.4  | [npm builder](https://git.intranet.gencat.cat/3048-intern/imatges-docker/npm-builder/tree/1.0-8-6.4)\r\nNpm builder  \t | 1.0-10-6.4    | docker-registry.ctti.extranet.gencat.cat/gencatcloud/npm-builder:1.0-10-6.4   | [npm builder](https://git.intranet.gencat.cat/3048-intern/imatges-docker/npm-builder/tree/1.0-10-6.4 )\r\n\r\n<br>\r\n**IMPORTANT**: De cara a minimitzar les vulnerabilitats de les aplicacions, es recomana que periòdicament els proveïdors d'aplicacions les reconstrueixin utilitzant aquestes imatges Docker certificades més actualitzades. Per realitzar aquestes tasques de construcció i desplegament s'ha de fer ús de les corresponents pipelines al Jenkins del SIC.\r\n<br>\r\n\r\nLa llista anterior no exclou que no es puguin lliurar contenidors que corrin altres productes i personalitzacions. En qualsevol cas, les imatges construïdes passaran per un servei d'avaluació de vulnerabilitats per a garantir en una primera instància la qualitat d'aquestes.\r\n\r\nPer construir contenidors personalitzats, cal tenir present els [Criteris creació contenidors docker](https://canigo.ctti.gencat.cat/cloud-caas/dockerImages/).\r\n\r\nMés informació sobre Docker: https://www.docker.com/\r\n\r\n### Bases de dades a contenidors\r\n\r\nLes bases de dades a contenidors no disposen de cap servei com backups o gestió d'usuaris. El proveïdor d'aplicacions haurà de fer-se càrrec d'aquests serveis.\r\n\r\nTampoc ofereix un entorn en alta disponibilitat. És una modalitat no recomanada per entorns productius.\r\n\r\n## **Imatges de contenidors obsoletes**\r\n\r\n**Aquestes imatges són obsoletes/no suportades i no tenen manteniment. Poden contenir vulnerabilitats i no està recomanat el seu ús.** \r\n\r\n**En cas d'utilitzar aquestes imatges es recomana l'actualització a les imatges suportades.**\r\n\r\n**Element**  | **Versió**   | **Imatge Docker**   | **Codi font**\r\n------------ | ------------ |-------------------- |-----------\r\nApache \t\t | 2.2    | docker-registry.ctti.extranet.gencat.cat/gencatcloud/httpd:2.2   | [httpd](https://git.intranet.gencat.cat/3048-intern/imatges-docker/httpd/tree/2.2)\r\nApache GICAR Shibboleth| 1.0    |No disponible   | [gicar-shibboleth](https://git.intranet.gencat.cat/3048-intern/imatges-docker/gicar-shibboleth/tree/1.0)\r\nApache GICAR Shibboleth| 1.0.1    |No disponible   | [gicar-shibboleth](https://git.intranet.gencat.cat/3048-intern/imatges-docker/gicar-shibboleth/tree/1.0.1)\r\nApache GICAR Shibboleth| 1.0.2    |docker-registry.ctti.extranet.gencat.cat/gencatcloud/gicar-shibboleth:1.0.2   | [gicar-shibboleth](https://git.intranet.gencat.cat/3048-intern/imatges-docker/gicar-shibboleth/tree/1.0.2)\r\nApache GICAR Shibboleth Kubernetes/Openshift| 1.0    |docker-registry.ctti.extranet.gencat.cat/gencatcloud/gicar-shibboleth-openshift:1.0   | [gicar-shibboleth-openshift](https://git.intranet.gencat.cat/3048-intern/imatges-docker/gicar-shibboleth-openshift/tree/1.0)\r\nApache GICAR Shibboleth Kubernetes/Openshift| 1.0.1    |docker-registry.ctti.extranet.gencat.cat/gencatcloud/gicar-shibboleth-openshift:1.0.1   | [gicar-shibboleth-openshift](https://git.intranet.gencat.cat/3048-intern/imatges-docker/gicar-shibboleth-openshift/tree/1.0.1)\r\nApache GICAR Shibboleth Kubernetes/Openshift| 1.0.2    |docker-registry.ctti.extranet.gencat.cat/gencatcloud/gicar-shibboleth-openshift:1.0.2   | [gicar-shibboleth-openshift](https://git.intranet.gencat.cat/3048-intern/imatges-docker/gicar-shibboleth-openshift/tree/1.0.2)\r\nApache GICAR Openshift| 1.0   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/gicar-openshift:1.0   | No disponible\r\nApache Proxy ElasticSearch  \t | 1.0   |No disponible   | [httpd-proxy-es](https://git.intranet.gencat.cat/3048-intern/imatges-docker/httpd-proxy-es/tree/1.0)\r\nApache Proxy ElasticSearch  \t | 1.1   |No disponible   | [httpd-proxy-es](https://git.intranet.gencat.cat/3048-intern/imatges-docker/httpd-proxy-es/tree/1.1)\r\nApache Proxy ElasticSearch  \t | 2.2-1.0   |docker-registry.ctti.extranet.gencat.cat/gencatcloud/httpd-proxy-es:2.2-1.0   | [httpd-proxy-es](https://git.intranet.gencat.cat/3048-intern/imatges-docker/httpd-proxy-es/tree/2.2-1.0)\r\nApache Proxy ElasticSearch  \t | 2.2-1.1   |docker-registry.ctti.extranet.gencat.cat/gencatcloud/httpd-proxy-es:2.2-1.1   | [httpd-proxy-es](https://git.intranet.gencat.cat/3048-intern/imatges-docker/httpd-proxy-es/tree/2.2-1.1)\r\nHttpd Proxy ElasticSearch  \t | 0.1   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/httpd22-proxy-es:0.1   | No disponible\r\nHttpd Proxy ElasticSearch  \t | 1.0   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/httpd22-proxy-es:1.0   | [httpd-proxy-es](https://git.intranet.gencat.cat/3048-intern/imatges-docker/httpd22-proxy-es/tree/1.0)\r\nHttpd Proxy ElasticSearch  \t | 1.1   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/httpd22-proxy-es:1.1   | [httpd-proxy-es](https://git.intranet.gencat.cat/3048-intern/imatges-docker/httpd22-proxy-es/tree/1.1)\r\nHttpd Proxy ElasticSearch  \t | release-1.0   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/httpd22-proxy-es:release-1.0   | [httpd-proxy-es](https://git.intranet.gencat.cat/3048-intern/imatges-docker/httpd22-proxy-es/tree/1.0)\r\nHttpd Proxy ElasticSearch  \t | release-1.1   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/httpd22-proxy-es:release-1.1   | [httpd-proxy-es](https://git.intranet.gencat.cat/3048-intern/imatges-docker/httpd22-proxy-es/tree/1.1)\r\nNginx  \t | 1.10.3   |docker-registry.ctti.extranet.gencat.cat/gencatcloud/nginx:1.10.3   | [nginx](https://git.intranet.gencat.cat/3048-intern/imatges-docker/nginx/tree/1.10.3)\r\nHAProxy\t\t | 1.2.1        | docker-registry.ctti.extranet.gencat.cat/gencatcloud/haproxy:1.2.1   | [haproxy](https://git.intranet.gencat.cat/3048-intern/imatges-docker/haproxy/tree/1.2.1)\r\nHAProxy\t\t | 1.5.1        | docker-registry.ctti.extranet.gencat.cat/gencatcloud/haproxy:1.5.1   | [haproxy](https://git.intranet.gencat.cat/3048-intern/imatges-docker/haproxy/tree/1.5.1)\r\nMongoDB \t | 3.2   |docker-registry.ctti.extranet.gencat.cat/gencatcloud/mongodb:3.2   | [mongodb](https://git.intranet.gencat.cat/3048-intern/imatges-docker/mongodb/tree/3.2)\r\nMongoDB \t | 3.4   |docker-registry.ctti.extranet.gencat.cat/gencatcloud/mongodb:3.4   | [mongodb](https://git.intranet.gencat.cat/3048-intern/imatges-docker/mongodb/tree/3.4)\r\nMongoDB \t | 3.6   |docker-registry.ctti.extranet.gencat.cat/gencatcloud/mongodb:3.6   | [mongodb](https://git.intranet.gencat.cat/3048-intern/imatges-docker/mongodb/tree/3.6)\r\nNodeJS \t\t | 4  | docker-registry.ctti.extranet.gencat.cat/gencatcloud/node:4   | [node ](https://git.intranet.gencat.cat/3048-intern/imatges-docker/node/tree/4)\r\nNodeJS \t\t | 4.8 (1)  | docker-registry.ctti.extranet.gencat.cat/gencatcloud/node:4.8   | [node ](https://git.intranet.gencat.cat/3048-intern/imatges-docker/node/tree/4.8)\r\nNodeJS \t\t | 6.12  | docker-registry.ctti.extranet.gencat.cat/gencatcloud/node:6.12   | [node ](https://git.intranet.gencat.cat/3048-intern/imatges-docker/node/tree/6.12)\r\nNodeJS \t\t | 6.14 (2)  | docker-registry.ctti.extranet.gencat.cat/gencatcloud/node:6.14   | [node ](https://git.intranet.gencat.cat/3048-intern/imatges-docker/node/tree/6.14)\r\nNodeJS \t\t | 8.9  | docker-registry.ctti.extranet.gencat.cat/gencatcloud/node:8.9   | [node ](https://git.intranet.gencat.cat/3048-intern/imatges-docker/node/tree/8.9)\r\nNodeJS \t\t | 8.12 (3)  | docker-registry.ctti.extranet.gencat.cat/gencatcloud/node:8.12   | [node ](https://git.intranet.gencat.cat/3048-intern/imatges-docker/node/tree/8.12)\r\nNodeJS \t\t | 10.13 (4)  | docker-registry.ctti.extranet.gencat.cat/gencatcloud/node:10.13   | [node ](https://git.intranet.gencat.cat/3048-intern/imatges-docker/node/tree/10.13)\r\nPHP \t\t | 5.6   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/apache-php:5.6   | [apache-php](https://git.intranet.gencat.cat/3048-intern/imatges-docker/apache-php/tree/5.6)\r\nPostgres\t | 9.3    | docker-registry.ctti.extranet.gencat.cat/gencatcloud/postgres:9.3   | [postgres](https://git.intranet.gencat.cat/3048-intern/imatges-docker/postgres/tree/9.3)\r\nPostgres\t | 9.6    | docker-registry.ctti.extranet.gencat.cat/gencatcloud/postgres:9.6   | [postgres](https://git.intranet.gencat.cat/3048-intern/imatges-docker/postgres/tree/9.6)\r\nTomcat  \t | 7   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/tomcat:7   | [tomcat](https://git.intranet.gencat.cat/3048-intern/imatges-docker/tomcat/tree/7)\r\nTomcat  \t | 8.0-java7   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/tomcat:8.0-java7   | [tomcat](https://git.intranet.gencat.cat/3048-intern/imatges-docker/tomcat/tree/8.0-java7)\r\nTomcat  \t | 8.0   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/tomcat:8.0   | [tomcat](https://git.intranet.gencat.cat/3048-intern/imatges-docker/tomcat/tree/8.0)\r\nTomcat  \t | 8.5   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/tomcat:8.5   | [tomcat](https://git.intranet.gencat.cat/3048-intern/imatges-docker/tomcat/tree/8.5)\r\nSftp  \t | 1.0   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/sftp:1.0   | [sftp](https://git.intranet.gencat.cat/3048-intern/imatges-docker/sftp/tree/1.0)\r\nNpm builder  \t | 1.0-2.15.11   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/npm-builder:1.0-2.15.11  | [npm builder](https://git.intranet.gencat.cat/3048-intern/imatges-docker/npm-builder/tree/1.0-2.15.11)\r\nNpm builder  \t | 1.0-3.10.10   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/npm-builder:1.0-3.10.10  | [npm builder](https://git.intranet.gencat.cat/3048-intern/imatges-docker/npm-builder/tree/1.0-3.10.10)\r\nNpm builder  \t | 1.0-5.6.0   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/npm-builder:1.0-5.6.0  | [npm builder](https://git.intranet.gencat.cat/3048-intern/imatges-docker/npm-builder/tree/1.0-5.6.0)\r\n\r\n\r\n### Notes:\r\n\r\n* (1) renombrat a a node:4\r\n* (2) renombrat a a node:6\r\n* (3) renombrat a a node:8\r\n* (4) renombrat a a node:10\r\n","objectID":"L2Nsb3VkLWNhYXMvY2F0YWxlZy1jb250ZW5pZG9ycw=="},"L2Nsb3VkLWNhYXMvY29uc2lkZXJhY2lvbnMtY29udGVuaWRvcnM=":{"date":1550534400000,"title":"Consideracions generals en contenidors","description":"Consideracions generals a tenir present en els contenidors","sections":"Container Cloud","weight":8,"categories":["cloud","docker","container","kubernetes","appagile","swarmme"],"path":"/cloud-caas/consideracions-contenidors","content":"* Els contenidors són volatils. Es poden destruir i reconstruir en qualsevol moment.\r\n* Si es requeriex persistir algun tipus d'informació cal:\r\n\r\n  * tenir un volum persistent que no es destruirà amb el contenidor.\r\n  * utilitzar el suport d'alguna base de dades.\r\n  \r\n* **No està permés l'accés via SSH a cap contenidor.**\r\n* Es requereix que el contenidor sigui autònom, no esta suportat cap tipus de manteniment manual.\r\n* S'intenta sempre afavorir l'escalat horitzontal respecte l'escal·lat vertical.\r\n  * Sempre és millor tenir multiples contenidors petits que tenir-ne pocs de grans.\r\n* Els recursos necessaris en un contenidor són molt més petits que el una aplicació on premise. Cal analitzar amb cura les necessitats de cada aplicació per no malbaratar recursos.\r\n* Per evitar talls de servei es recomana utilitzar HEALTCHECKS/LivenessProve/ReadinessProve.\r\n\r\n","objectID":"L2Nsb3VkLWNhYXMvY29uc2lkZXJhY2lvbnMtY29udGVuaWRvcnM="},"L2Nsb3VkLWNhYXMvY29uZmlndXJhY2lvLWNvbnRlbmlkb3Jz":{"date":1550620800000,"title":"Gestió de configuracions a Contenidors","description":"Model de gestió de configuracions en orquestradors basats en Kubernetes: Kubernetes ,Openshift i Swarm","sections":"Container Cloud","weight":10,"categories":["cloud","docker","container","kubernetes","openshift","Swarm"],"path":"/cloud-caas/configuracio-contenidors","content":"A gestió de configuracions als Orquestradors docker, es poden distingir dos escenaris clarament diferenciats:\r\n\r\n- Gestió de configuracions a Kubernetes i Openshift\r\n- Gestió de configuracions a Swarm\r\n\r\n## Gestió de configuracions a Kubernetes i Openshift\r\n\r\nUna de les funcionalitats que ofereix kubernetes (i Openshift), més enllà del que ofereixen els contenidors dockers, és la gestió de configuracions.\r\n\r\nPer la gestió de configuració, kubernetes ens ofereix els següents components:\r\n\r\n- Variables d'entorn\r\n- ConfigMap\r\n- Secret\r\n\r\n### Variables d'entorn\r\n\r\nCom els seu propi nom indica son variables que s'inclouran al descriptor de desplegament dels pods (**Deployment** a Kubernetes i **DeploymentConfig** a Openshift) que un cop arrenquin els contenidors, son variables d'entorn del sistema operatiu.\r\n\r\nEstà orientat a paràmetres de configuració simples de tipus clau/valor.\r\n\r\nTenen el següent aspecte:\r\n```\r\n...\r\n env:\r\n- name: ENV1_NAME\r\n  value: env1_value\r\n- name: ENV2_NAME\r\n  value: env2_value\r\n...          \r\n```\r\nPodeu trobar més informació a [Define Environment Variables for a Container.](https://kubernetes.io/docs/tasks/inject-data-application/define-environment-variable-container/)\r\n\r\nAddicionalment a les variables d'entorn definides per l'aplicació, Kubernetes exposa unes variables d'entorn que faciliten la comunicació entre pods.\r\n\r\nBàsicament s'exposen unes variables de tipus **{SVCNAME}_SERVICE_HOST** i **{SVCNAME}_SERVICE_PORT** on **{SVCNAME}** és el nom del servei a Kubernetes.\r\n\r\nPodeu trobar més informació a [Discovering services.](https://kubernetes.io/docs/concepts/services-networking/service/#discovering-services)\r\n\r\nPodeu trobar exemples de yamls complets dels descriptors de desplegament a \r\n- [Contenidors AppAgile](https://canigo.ctti.gencat.cat/cloud/contenidors_appagile/)\r\n- [Contenidors Kubernetes](https://canigo.ctti.gencat.cat/cloud/contenidors_kubernetes/)\r\n\r\n### ConfigMap\r\n\r\nEstà orientat a configuracions més complexes. Suporta tant variables del tipus clau valor com fitxers de configuració.\r\n\r\nTenen el següent aspecte:\r\n\r\n```\r\napiVersion: v1\r\nkind: ConfigMap\r\nmetadata:\r\n  name: harbor-jobservice-config\r\ndata:\r\n  LOG_LEVEL: INFO\r\n  CONFIG_PATH: /etc/jobservice/app.conf\r\n  ADMINSERVER_URL: \"http://adminserver:8080\"\r\n  GODEBUG: netdns=cgo\r\n  config: |\r\n    appname = jobservice\r\n    runmode = dev\r\n    \r\n    [dev]\r\n    httpport = 8080\r\n```\r\n\r\nEn aquest cas hi ha variables del tipus clau/valor, com pot ser **LOG_LEVEL** i variables de tipus fitxer de configuracío com pot ser **config**\r\n\r\n#### Accés als ConfigMaps dels des pods\r\n\r\nPer accedir a les propietats/fitxers dels ConfigMaps cal definir-ho als descriptors de desplegament.\r\n\r\nL'accés a les variables clau/valor es realitza a través de les variables d'entorn. Per exemple:\r\n\r\n```\r\n...\r\nenv:\r\n- name: LOG_LEVEL\r\n  valueFrom:\r\n    configMapKeyRef:\r\n      name: harbor-jobservice-config\r\n      key: LOG_LEVEL\r\n...\r\n```\r\n\r\nL'accés als fixers es realitza muntant volums als descriptors de desplegament. Per exemple:\r\n\r\n```\r\n...\r\nvolumeMounts:\r\n- name: config\r\n  mountPath: /jobservice-conf\r\n...\r\nvolumes:\r\n- name: config\r\n  configMap:\r\n    name: harbor-jobservice-config\r\n    items:\r\n    - key: config\r\n      path: app.conf\r\n...\r\n```\r\n\r\n**Nota important: A les versions actuals de Kubernetes i  Openshift, el path complert on es monten els ConfigMaps i els Secrets, són de només lectura. Cal vigilar on es monten els fitxers de configuració, perquè no es podrà escriure cap altre fitxer en tot el path.**\r\n\r\n\r\nPodeu trobar més informació dels ConfigMaps a [Configure a Pod to Use a ConfigMap.](https://kubernetes.io/docs/tasks/configure-pod-container/configure-pod-configmap/)\r\n\r\n\r\n\r\n### Secrets\r\n\r\nEstà orientat a configuracions amb dades sensibles. Suporta tan variables del tipus clau valor com fitxers de configuració. Suporta tant formats text com binari.\r\nEls valors estan codificats en base64.\r\n\r\n**En cap cas, està permés utilitzar variables d'entorn o ConfigMaps per emmagatzemar dades sensibles.**\r\n\r\nTenen el següent aspecte:\r\n\r\n```\r\napiVersion: v1\r\nkind: Secret\r\nmetadata:\r\n  name: jobservice-secret\r\ntype: Opaque\r\ndata:\r\n  UI_SECRET: \"dWlfc2VjcmV0X2Jhc2U2NA==\"\r\n  JOBSERVICE_SECRET: \"am9ic2VydmljZV9zZWNyZXRfYmFzZTY0\"\r\n  SECRET_KEY: \"c2hhcmVkX3NlY3JldF9rZXlfYmFzZTY0\"\r\n  ```\r\n\r\nPer accedir a les propietats/fitxers dels Secrets cal definir-ho als descriptors de desplegament.\r\n\r\nL'accés a les variables clau/valor es realitza a través de les variables d'entorn. Per exemple:\r\n\r\n```\r\n...\r\nenv:\r\n- name: UI_SECRET\r\n  valueFrom:\r\n    secretKeyRef:\r\n      name: jobservice-secret\r\n      key: UI_SECRET\r\n...\r\n```\r\n\r\nL'accés als fixers es realitza muntant volums als descriptors de desplegament. Per exemple:\r\n\r\n```\r\n...\r\nvolumeMounts:\r\n- name: key\r\n  mountPath: /key/jobservice\r\n...\r\nvolumes:\r\n- name: key\r\n  secret:\r\n    secretName: jobservice-secret\r\n    items:\r\n    - key: SECRET_KEY\r\n      path: key  \r\n...\r\n```\r\n\r\n**Nota important: A les versions actuals de Kubernetes i  Openshift, el path complert on es monten els ConfigMaps i els Secrets, són de només lectura. Cal vigilar on es monten els fitxers de configuració, perquè no es podrà escriure cap altre fitxer en tot el path.**\r\n\r\nPodeu trobar més informació dels Secrets a [Secrets](https://kubernetes.io/docs/concepts/configuration/secret/)\r\n\r\n\r\n## Gestió de configuracions a Swarm\r\n\r\nPer la gestió de configuració, kubeSwarmrnetes ens ofereix els següents components:\r\n\r\n- Variables d'entorn\r\n- Secret\r\n\r\n### Variables d'entorn\r\n\r\nSón variables del tipus clau/valor.\r\n\r\nLes variables d'entorn es defineixen en el moment de desplegar el contenidor.\r\nCal proporcionar-les a l'equip de Suport Cloud a l'hora de configurar el desplegament al SIC.\r\n\r\n### Secrets\r\n\r\nEl seu ús està en estudi i encara no està suportat en els desplegaments a SwarmMe.","objectID":"L2Nsb3VkLWNhYXMvY29uZmlndXJhY2lvLWNvbnRlbmlkb3Jz"},"L2Nsb3VkL3Byb2Nlcy1kZXNwbGVnYW1lbnQtY2xvdWQ=":{"date":1550188800000,"title":"Procés de desplegament de solucions Cloud","description":"Descripció simplificada del procés de desplegament de solucions Cloud","sections":"Cloud","categories":["cloud","docker","container","paas","openshift","kubernetes","swarm","azure"],"weight":5,"path":"/cloud/proces-desplegament-cloud","content":"El desplegament de solucions cloud aplica el model DEVOPS.\r\n\r\n## Procés de desplegament CTTI adaptat al Model DEVOPS\r\n\r\n### Resum del procés\r\n\r\n- Creació del document Descripció d'Arquitectura (DA) del projecte\r\n- Obertura del Projecte d'Aprovisionament d'Infraestructura (PAI)\r\n- Conformitat del DA per part de l'equip d'Arquitectura CTTI\r\n- Assignació de CPD\r\n- Reunió de Fase 0\r\n- Oferta econòmica del PAI\r\n- Acceptació Oferta Econòmica del PAI\r\n- Alta de l'aplicació al SIC\r\n- Creació de projectes i assignació de permisos al SIC\r\n- Desenvolupament de l'aplicació\r\n- Primer desplegament de l'aplicació al cloud\r\n  - Aprovisionament de l'entorn d'execució no productiu\r\n  - Configuració de l'aplicació al SIC\r\n  - Primer Desplegament a l'entorn no productiu\r\n  - Validació Aplicació a l'entorn no productiu\r\n  - Estabilització de l'aplicació\r\n  - Aprovisionament de l'entorn d'execució productiu\r\n  - Primer Desplegament a l'entorn productiu\r\n  - Validació Aplicació a l'entorn productiu\r\n- Alta CMDB\r\n- Posada en servei\r\n- Afegir aplicació al servei de monitoratge Cloud\r\n- Tancament de projecte\r\n\r\n### Actors\r\n\r\n- Lot d'Aplicacions\r\n- Unitat d'Integració de solucions\r\n- Gestor de Solucions del Departament/Organisme\r\n- Àrea d'Arquitectura CTTI\r\n- Equip de SIC\r\n- Release manager SIC\r\n- Equip de Suport Cloud\r\n- Bústia de Projectes d'Infraestructura\r\n- Àrea d'Aprovisionament de serveis TIC\r\n- Equip de Cesicat\r\n- Equip de NUS\r\n- CPD\r\n- ...\r\n\r\n### Creació del document Descripció d'Arquitectura (DA) del projecte\r\n\r\nActor: Lot d'Aplicacions\r\n\r\nEl document de Descripció d'Arquitectura inclou les diferents vistes lògiques i físiques del sistema d’informació.\r\n\r\nEs pot consultar el detall del document a l'article [Descripció d'Arquitectura.](https://qualitat.solucions.gencat.cat/lliurables/descripcio_arquitectura/)\r\n\r\n### Obertura del Projecte d'Aprovisionament d'Infraestructura (PAI)\r\n\r\nActors:\r\n\r\n- Gestor de Solucions del Departament/Organisme\r\n- Unitat d'Integració de solucions\r\n\r\nEl gestor de Solucions del Departament/Organisme obrirà un Projecte d'Aprovisionament d'Infraestructura que serà gestionat per l'equip d'Integració de solucions durant la fase de projecte fins a la seva postada en Servei.\r\n\r\n### Conformitat del DA per part de l'equip d'Arquitectura CTTI\r\n\r\nActors:\r\n\r\n- Àrea d'Arquitectura CTTI\r\n- Unitat d'Integració de solucions\r\n- Gestor de Solucions del Departament/Organisme\r\n- Lot d'Aplicacions\r\n\r\nEl DA pot arribar a l'equip d'arquitectura CTTI a través de dos canals:\r\n\r\n- Des de la Unitat d'Integració de solucions. És el canal més habitual i es produeix quan en un pas previ s'ha obert un Projecte d'aprovisionament d'Infraestructura.\r\n- Directament des del Gestor de Solucions del Departament/Organisme. Requereix que posteriorment s'obri un projecte d'Aprovisionament d'Infraestructura.\r\n\r\nL'Àrea d'Arquitectura CTTI realitzarà la validació del DA seguint el procediment \r\n[Gestió de conformitats.](https://portic.ctti.gencat.cat/processosctti/Documents/FM09_Arquitectura,%20qualitat%20i%20est%C3%A0ndards/P09%20Arquitectura,%20qualitat%20i%20est%C3%A0ndards/P09S03N01_Gesti%C3%B3%20de%20Conformitats.pdf)\r\n\r\nEn cas de dubtes o disconformitats, es realitzaran iteracions amb el Lot d'Aplicacions per acabar de definir l'arquitectura definitiva.\r\n\r\nDurant aquesta validació s'identificaran les possibles excepcions i es concretaran els requisits tècnics que cal considerar a l'hora de seleccionar la plataforma cloud on es desplegarà la solució.\r\n\r\n\r\n### Assignació de CPD\r\n\r\nActors:\r\n\r\n- Unitat d'Integració de solucions\r\n- Àrea d'Aprovisionament de serveis TIC\r\n\r\nLa Unitat d'Integració de solucions i l'Àrea d'Aprovisionament de serveis TIC es reuneixen periòdicament per assignar a quina plataforma cloud cal desplegar la solució considerant entre altres els requisits tècnics validats per l'Àrea d'Arquitectura.\r\n\r\n\r\n### Reunió de Fase 0\r\n\r\nActors assistents obligatoris:\r\n\r\n- Lot d'Aplicacions\r\n- Unitat d'Integració de solucions\r\n- Gestor de Solucions del Departament/Organisme\r\n- Equip de SIC\r\n- Equip de Suport Cloud\r\n- Equip de Cesicat\r\n- Equip de NUS\r\n\r\nLa unitat d'Integració de solucions convoca la reunió de Fase 0 amb els actors assistents obligatoris i tots els actors addicionals que consideri necessaris.\r\n\r\nEn aquesta reunió s'acabaran de definir els possibles dubtes que hagin quedat pendents de DA i es definiran els propers passos a seguir.\r\n\r\nUn cop tancat definitivament el DA, la unitat d'Integració de solucions l'enviarà a Bústia de Projectes d'Infraestructura amb la sol·licitud de noves infraestructures.\r\n\r\n\r\n### Oferta econòmica del PAI\r\n\r\nActors:\r\n\r\n- Bústia de Projectes d'Infraestructura\r\n- Suport Cloud\r\n- CPD\r\n\r\nLa Bústia de Projectes d'Infraestructura sol·licitarà l'oferta del PAI a:\r\n\r\n- Suport cloud en el cas de clouds públics.\r\n- CPD en el cas de clouds privats. Suport cloud inicialment realitza una oferta preliminar que posteriorment valida CPD.\r\n\r\n### Acceptació Oferta Econòmica del PAI\r\n\r\nActors:\r\n\r\n- Bústia de Projectes d'Infraestructura\r\n- Gestor de Solucions del Departament/Organisme\r\n\r\nL'equip de la Bústia de Projectes d'Infraestructura envia l'oferta a Gestor de Solucions del Departament/Organisme per a la seva acceptació.\r\n\r\n### Alta de l'aplicació al SIC\r\n\r\nActors:\r\n\r\n\r\n### Creació de projectes i assignació de permisos al SIC\r\n\r\nActors:\r\n\r\n- Release Manager SIC\r\n- Lot d'aplicacions\r\n\r\nLa plataforma SIC disposa d'un model d'autoservei que permet crear projectes i assignar permisos a usuaris. \r\n\r\nPodeu veure més detalls a l'article [Autoservei d'usuaris](https://canigo.ctti.gencat.cat/sic-serveis/autoservei-usuaris/)\r\n\r\n\r\n### Desenvolupament de l'aplicació\r\n\r\nActors:\r\n\r\n- Lot d'aplicacions\r\n- Gestor de Solucions del Departament/Organisme\r\n\r\nEl Lot d'aplicacions desenvolupa l'aplicació amb el suport del Gestor de Solucions del Departament/Organisme.\r\n\r\n### Primer desplegament de l'aplicació al cloud\r\n\r\n#### Aprovisionament de l'entorn d'execució no productiu\r\n\r\nActors:\r\n\r\n- Unitat d'Integració de solucions\r\n- Gestor de Solucions del Departament/Organisme\r\n- Suport Cloud\r\n- CPD\r\n\r\nUn cop es consideri la necessitat de disposar de l'entorn d'execució no productiu, el Gestor de Solucions del Departament/Organisme sol·licitarà a la Unitat d'Integració de solucions l'aprovisionament de l'entorn no productiu.\r\n\r\nSeguidament, la Unitat d'Integració de solucions sol·licitarà la creació de l'entorn a l'equip de Suport Cloud.\r\n\r\nPels clouds públics, suport cloud realitzarà l'aprovisionament de l'entorn.\r\nPels clouds privats, suport cloud sol·licitarà al CPD que gestioni el cloud l'aprovisionament de l'entorn.\r\n\r\n#### Configuració de l'aplicació al SIC\r\n\r\nActors:\r\n\r\n- Lot d'aplicacions\r\n- Suport Cloud\r\n- SIC\r\n\r\nEls equips de SIC i Suport Cloud, amb el suport de Lot d'aplicacions configuren les tasques necessàries a la plataforma SIC per automatitzar els desplegaments i operacions de l'aplicació facilitant l'autonomia del lot d'aplicacions.\r\n\r\nPodeu veure més detalls dels requeriments necessaris per integrar-se amb SIC a:\r\n\r\n- [Integració de contenidors a SIC](https://canigo.ctti.gencat.cat/cloud-caas/integracio-contenidors-sic/)\r\n- [Integració d'aplicacions xPaaS a SIC](https://canigo.ctti.gencat.cat/cloud-xpaas/integracio-xpaas-sic/)\r\n\r\n#### Primer Desplegament a l'entorn no productiu\r\n\r\nActors:\r\n\r\n- Lot d'aplicacions\r\n- Suport Cloud\r\n  \r\nAddicionalment al desenvolupament de les aplicacions, per desplegar als diferents clouds, cal tenir present una sèrie de consideracions específiques de cada cloud que cal tenir present.\r\n\r\nPodeu visitar els articles:\r\n\r\n - [Consideracions en el desplegament de contenidors](https://canigo.ctti.gencat.cat/cloud-caas/consideracions-desplegament/), \r\n  - [Consideracions en el desplegament a plataformes xPaaS](https://canigo.ctti.gencat.cat/cloud-xpaas/consideracions-desplegament/), \r\n  \r\n  per consultar aquestes consideracions.\r\n\r\nSuport Cloud, amb el suport de lot d'aplicacions realitzarà un primer desplegament a l'entorn no productiu, preferentment a traves de la plataforma SIC.\r\n\r\n\r\n#### Validació Aplicació a l'entorn no productiu\r\n\r\nActors:\r\n\r\n- Lot d'aplicacions\r\n- Gestor de Solucions del Departament/Organisme\r\n- Cesicat\r\n- ...\r\n\r\nUn cop desplegada l'aplicació a l'entorn no productiu es realitzaran diverses validacions de l'aplicació:\r\n\r\n- Comunicacions\r\n- Integracions\r\n- Funcionals\r\n- Rendiment\r\n- Seguretat\r\n- ...\r\n\r\nEn aquestes validacions participaran els actors necessaris per a cada tipologia.\r\n\r\n\r\n#### Aprovisionament de l'entorn d'execució productiu\r\n\r\nActors:\r\n\r\n- Unitat d'Integració de solucions\r\n- Gestor de Solucions del Departament/Organisme\r\n- Suport Cloud\r\n- CPD\r\n\r\nUn cop es consideri la necessitat de disposar de l'entorn d'execució productiu, el Gestor de Solucions del Departament/Organisme sol·licitarà a la Unitat d'Integració de solucions l'aprovisionament de l'entorn productiu.\r\n\r\nSeguidament, la Unitat d'Integració de solucions sol·licitarà la creació de l'entorn a l'equip de Suport Cloud.\r\n\r\nPels clouds públics, suport cloud realitzarà l'aprovisionament de l'entorn.\r\nPels clouds privats, suport cloud sol·licitarà al CPD que gestioni el cloud l'aprovisionament de l'entorn.\r\n\r\n\r\n#### Primer Desplegament a l'entorn productiu\r\n\r\nActors:\r\n\r\n- Lot d'aplicacions\r\n- Suport Cloud\r\n  \r\nSuport Cloud, amb el suport de lot d'aplicacions realitzarà un primer desplegament a l'entorn productiu, a través de la plataforma SIC.\r\nLes actuacions necessàries pel desplegament són les mateixes realitzades per l'entorn no productiu\r\n\r\n\r\n#### Validació Aplicació a l'entorn productiu\r\n\r\nActors:\r\n\r\n- Lot d'aplicacions\r\n- Gestor de Solucions del Departament/Organisme\r\n- Cesicat\r\n- ...\r\n\r\nUn cop desplegada l'aplicació a l'entorn no productiu es realitzaran diverses validacions de l'aplicació:\r\n\r\n- Comunicacions\r\n- Integracions\r\n- Funcionals\r\n- ...\r\n\r\nEn aquestes validacions participaran els actors necessaris per a cada tipologia.\r\n\r\n### Alta CMDB\r\n\r\nActors:\r\n\r\n- Lot d'aplicacions\r\n- Gestor de Solucions del Departament/Organisme\r\n- Suport Cloud\r\n- CPD\r\n- Unitat d'Integració de solucions\r\n\r\nUna vegada l'aplicació ha estat validada, els diferents actors generaran la documentació necessària per donar d'alta l'aplicació a la CMDB\r\n\r\nLa documentació serà sol·licitada i enviada a la Bústia de Projectes d'Infraestructura.\r\n\r\n### Posada en servei\r\n\r\n- Bústia de Projectes d'Infraestructura\r\n- Gestor de Solucions del Departament/Organisme\r\n- Unitat d'Integració de solucions\r\n\r\nSota petició de Gestor de Solucions del Departament/Organisme a Bústia de Projectes d'Infraestructura a través de la Unitat d'Integració de solucions, l'aplicació es posa en servei. \r\n\r\n### Afegir aplicació al servei de monitoratge Cloud\r\n\r\n- Suport Cloud\r\n\r\nUn cop l'aplicació està en servei, l'equip de suport cloud afegeix l'aplicació al servei de monitoratge cloud.\r\n\r\n#### Tancament de projecte\r\n\r\n- Lot d'aplicacions\r\n- Bústia de Projectes d'Infraestructura\r\n- Gestor de Solucions del Departament/Organisme\r\n- Unitat d'Integració de solucions\r\n\r\nUn cop l'aplicació està en servei es realitza el tancament del projecte.\r\n\r\n## Comunicació amb CS Cloud\r\n\r\nLa comunicació amb Susport Cloud es realitzarà seguint les directrius definides a [[Comunicació proveïdors d'aplicacions amb Suport Cloud.](https://canigo.ctti.gencat.cat/cloud/comunicacio-suport-cloud/)","objectID":"L2Nsb3VkL3Byb2Nlcy1kZXNwbGVnYW1lbnQtY2xvdWQ="},"L2Nsb3VkLWNhYXMvY29udGVuaWRvcnNfYXBwYWdpbGU=":{"date":1550016000000,"title":"Contenidors AppAgile","description":"Consideracions i exemples respecte els contenidors a AppAgile","sections":"Container Cloud","weight":5,"categories":["cloud","docker","container","paas","openshift","appagile"],"path":"/cloud-caas/contenidors_appagile","content":"## Introducció\nAppAgile és un orquestrador d'imatges docker basat en Openshift que addicionalment està basat en Kubernetes. La versió actual d'AppAgile es basa concretament en la versió **OpenShift Container Platform 3.9.65 i Kubernetes 1.9.1.**\n\nEn aquest article es defineix l'arquitectura tipus d'una aplicació a AppAgile i es proporcionen diversos exemples.\n\n## Imatges\nA l'hora de construir les imatges docker, cal tenir present els criteris definits per la Generalitat de Catalunya i que Openshift, tot i que està basat en docker, té les seves particularitats.\n\nA la plana [Criteris creació contenidors docker](http://canigo.ctti.gencat.cat/cloud/dockerImages/) podeu trobar més informació al respecte. \n\n## Arquitectura\n### Conceptes bàsics\nL'arquitectura bàsica d'una aplicació a AppAgile és bàsicament la mateixa que la de Kubernetes, però amb algunes petites particularitats.\nA grans trets es poden distingir els següents components:\n\n* **Enrutador:** És el punt d'entrada i sortida del tràfic http/https de la plataforma i l'exterior. És responsable d'enrutar el tràfic a cada contenidor concret.\n* **Ruta:** És l'element de configuració on és defineix quin domini correspondrà a un Servei. Permet també la configuració del SSL. Informa a l'enrutador per a que aquest pugui redirigir el tràfic correctament.\n* **Servei:** És l'element de configuració que permet exposar un servei basat en contenidors dins de la plataforma Openshift. Permet mapping de ports\n* **Desplegament:** És l'element de configuració que defineix com es desplegaran els contenidors:\n\n    * Nombre de rèpliques\n    * Imatge a desplegar\n    * Polítiques de recàrrega\n    * Quotes\n    * Variables d'entorn\n    * Ports\n    * Emmagatzematge lògic\n    * Health checks\n    * ...\n\n* **Controlador:** És el component responsable de mantenir els contenidors sempre disponibles seguint els paràmetres configurats al Desplegament.\n* **Pod:** És el conjunt de contenidors que tenen el mateix cicle de vida i és necessari desplegar sempre conjuntament.\n* **Contenidor:** És el component mínim de la plataforma. És el contenidor docker.\n* **Petició d'emmagatzematge:** S'utilitza quan és necessari emmagatzematge persistent. És l'element de configuració que actua de pont entre l'emmagatzematge físic i l'emmagatzematge lògic.\n* **Emmagatzematge:** És l'element de configuració responsable de definir l'emmagatzematge físic.\n* **Secret:** És l'element de configuració responsable de gestionar els elements de configuració amb informació sensible, com poden ser contrasenyes.\n* **Mapa de configuració:** Permet agrupar múltiples variables de configuració. Seria equivalent a un fitxer de propietats en una aplicació.\n\n### Arquitectura AppAgile\nA continuació es realitza la correlació entre els diferents components arquitectònics i els elements concrets a AppAgile i Openshift.\n\n  Component genèric |  Component AppAgile | Observacions  |\n|:-----------------|:---------|:-----------|\n| Enrutador  |  Router | És gestionat per l'administrador de la plataforma. A nivell d'aplicació no és necessari configurar res.|\n| Ruta  |  Route | A nivell d'aplicació cal definir un fitxer yaml de configuració.|\n| Servei  |  Service | A nivell d'aplicació cal definir un fitxer yaml de configuració.|\n| Desplegament  |  DeploymentConfig | A nivell d'aplicació cal definir un fitxer yaml de configuració.|\n| Controlador  |  ReplicationController | És generat directament pel DeploymentConfig. No és necessari configurar res.|\n| Pod  |  Pod | És generat directament pel ReplicationController. No és necessari configurar res.|\n| Contenidor  |  Container | És generat directament pel Pod. No és necessari configurar res.|\n| Petició d'emmagatzematge  |  PersistentVolumeClaim | A nivell d'aplicació cal definir un fitxer yaml de configuració.|\n| Emmagatzematge  |  PersistentVolume | És gestionat per l'administrador de la plataforma. A nivell d'aplicació no és necessari configurar res. Cal fer una petició al fer la sol·licitut inicial de recursos.|\n| Secret  | Secret | A nivell d'aplicació cal definir un fitxer yaml de configuració.|\n| Mapa de configuració  | ConfigMap | A nivell d'aplicació cal definir un fitxer yaml de configuració.|\n\n![Components Openshift](/related/cloud/ArquitecturaOpenshift.png)\n\n## Informació necessària al crear l'aplicació\nQuan és sol·licita la creació d'una aplicació a AppAgile és necessària la següent informació:\n\n* **Unitats i mida de discos persistents** necessaris. Amb aquesta informació l'administrador de la plataforma crearà els PersistentVolume necessaris i farà arribar als responsables de l'aplicació el nom d'aquests Volums.\n* **Memòria RAM** total necessària per tots els contenidors de l'aplicació. Amb aquesta informació s'assignarà una CPU proporcional i es definiran les quotes globals de l'aplicació.\n## Exemples\n### PersistentVolumeClaim\nEn una aplicació el primer element que cal configurar és el PersistentVolumeClaim. Mapejarà PersistentVolume amb el volumes lògics que s'utilitzaran als pods.\n\nTenint present que el PersistentVolume s'anomena per exemple **XXXX-app1-data01-pre** el fitxer yaml seria:\n\n```\napiVersion: v1\nkind: List\nitems:\n- apiVersion: v1\n  kind: PersistentVolumeClaim\n  metadata:\n    name: XXXX-app1-data01-claim\n  spec:\n    accessModes:\n      - ReadWriteOnce\n    resources:\n      requests:\n        storage: 1Gi\n    volumeName: XXXX-app1-data01-pre\n```\n\n### DeploymentConfig\nEl DeploymentConfig és el principal element de configuració de l'aplicació.\n\nConfiguració de l'exemple:\n\n* Nom del projecte: **XXXX-app1-pre**\n* Nom de l'aplicació: **XXXX-app1-server**\n* Nom del deploymentConfig: **XXXX-app1-server-deployment**\n* Nombre de rèpliques: **2**\n* **El pod conté un únic contenidor**.\n* Estratègia de desplegament: **Rolling**. No es recomana modificar, ni variar els seus paràmetres.\n* Quotes: **100 milicores de CPU** i **1024Mb de RAM**\n* Nom de la imatge dels contenidors: **XXXX-app1-pre/XXXX-app1-server:1.0.0**\n* Variables d'entorn dels contenidors:\n\n    * **ENV1_NAME** amb valor **env1_value**\n    * **ENV2_NAME** amb valor **env2_value**\n* Port del contenidor: **8080**\n* **readinessProbe** per identificar quan es pot començar a enviar peticions al contenidor.\n* **livenessProbe** per identificar quan cal reiniciar el contenidor.\n* Volum persistit: dins del contenidor es monta a **/data**. Fà referència al PersistentVolumeClaim anomenat **XXXX-app1-data01-claim** (creat a l'exemple anterior)\n\n```\napiVersion: v1\nkind: List\nitems:\n- apiVersion: v1\n  kind: DeploymentConfig\n  metadata:\n    labels:\n      app: XXXX-app1-server\n    name: XXXX-app1-server-deployment\n  spec:\n    replicas: 2\n    selector:\n      app: XXXX-app1-server\n      deploymentconfig: XXXX-app1-server-deployment\n    strategy:\n      type: Rolling\n      rollingParams:\n        updatePeriodSeconds: 1\n        intervalSeconds: 1\n        timeoutSeconds: 600\n        maxUnavailable: 25%\n        maxSurge: 25%    \n      resources:\n        limits:\n            cpu: 0\n            memory: 0\n        requests:\n            cpu: 0\n            memory: 0\n    template:\n      metadata:\n        labels:\n          app: XXXX-app1-server\n          deploymentconfig: XXXX-app1-server-deployment\n      spec:\n        containers:\n        - image: XXXX-app1-pre/XXXX-app1-server:1.0.0\n          name: XXXX-app1-server\n          env:\n          - name: ENV1_NAME\n            value: env1_value\n          - name: ENV2_NAME\n            value: env2_value            \n          ports:\n          - containerPort: 8080\n            protocol: TCP\n          resources:\n            limits:\n                cpu: 100m\n                memory: 1024Mi\n            requests:\n                cpu: 100m\n                memory: 1024Mi\n          readinessProbe:\n            httpGet:\n                path: /healthz\n                port: 8080\n            initialDelaySeconds: 15\n            timeoutSeconds: 1\n          livenessProbe:\n            tcpSocket:\n                port: 8080\n            initialDelaySeconds: 15\n            timeoutSeconds: 1                                              \n          volumeMounts:\n              - name: XXXX-app1-server-volume\n                mountPath: /data\n        terminationGracePeriodSeconds: 60                \n        volumes:\n          - name: XXXX-app1-server-volume\n            persistentVolumeClaim:\n              claimName: XXXX-app1-data01-claim           \n    test: false\n    triggers:\n    - type: ConfigChange\n    - imageChangeParams:\n        automatic: true\n        containerNames:\n        - XXXX-app1-server\n        from:\n          kind: ImageStreamTag\n          name: XXXX-app1-server:1.0.0\n          namespace: XXXX-app1-pre\n      type: ImageChange\n```\n\n### Service\nA l'exemple es crea un servei per el DeploymentConfig creat anteriorment.\n\nAppAgile només suporta serveis amb protocol HTTP/HTTPS, no suporta altres protocols, com per exemple SSH, JDBC, ...\n\nConfiguració de l'exemple:\n\n* Port exposat per servei: **80**\n* Port intern dels pods: **8080**\n\n```\napiVersion: v1\nkind: List\nitems:\n- apiVersion: v1\n  kind: Service\n  metadata:\n    labels:\n      app: XXXX-app1-server\n    name: XXXX-app1-server\n  spec:\n    ports:\n    - name: 80-tcp\n      port: 80\n      protocol: TCP\n      targetPort: 8080\n    selector:\n      app: XXXX-app1-server\n      deploymentconfig:  XXXX-app1-server-deployment\n```\n\n### Route\nA l'exemple es crea una ruta pel servei creat anteriorment.\n\nConfiguració de l'exemple:\n\n* host: **app1-server.gencat.cat**\n\n```\napiVersion: v1\nkind: Route\nmetadata:\n  name: app1-route\n  namespace: XXXX-app1-pre\n  labels:\n    app: app1-server\nspec:\n  host: app1-server.gencat.cat\n  to:\n    kind: Service\n    name:  XXXX-app1-server\n    weight: 100\n  port:\n    targetPort: 80-tcp\n  wildcardPolicy: None\n```\n\n\n## Informació relacionada\n\n* http://appagile.io/\n* https://docs.openshift.com/container-platform/3.9/","objectID":"L2Nsb3VkLWNhYXMvY29udGVuaWRvcnNfYXBwYWdpbGU="},"L2Nsb3VkLWNhYXMvY29uZmlndXJhY2lvLWdpY2Fy":{"date":1551052800000,"title":"Configuració de Gicar en Contenidors","description":"Descripció del procediment per configurar Gicar a les diferents plataformes de Contenidors.","sections":"Container Cloud","weight":11,"categories":["cloud","docker","container","kubernetes","openshift","Swarm"],"path":"/cloud-caas/configuracio-gicar","content":"La configuració de Gicar a les plataformes de contenidors dependrà de la plataforma en concret.\r\n\r\n## SwarmMe\r\n\r\nLa integració amb Gicar no es fa a la plataforma de contenidors, es realitza al Servidor Web on-premise que fa de proxy pass contra SwarmMe.\r\n\r\nLa integració es fa via agent de Siteminder a l'Apache.\r\nAl tractar-se d'Apaches departamentals on-premise, CPD per defecte ja els configura amb aquesta integració i no cal fer cap configuració addicional.\r\n\r\n## Kubernetes i Openshift\r\n\r\nLa integració amb Gicar es realitza a la plataforma de contenidors.\r\n\r\nLa integració de les aplicacions amb Gicar es realitza amb el protocol SAMLv2 a través de Shibboleth.\r\n\r\nCal utilitzar la imatge docker **gicar-shibboleth-openshift** disponible al [Registre privat](http://canigo.ctti.gencat.cat/cloud-caas/dockerRegistry/) i [Gitlab.](https://git.intranet.gencat.cat/3048-intern/imatges-docker/gicar-shibboleth-openshift/tree/1.0.3)\r\n\r\n\r\n### Fitxers de configuració\r\n\r\n#### Certificats\r\n\r\nCertificat i clau proporcionats per l'equip de Gicar al realitzar la sol·licitud del servei.\r\n\r\nAquests certificats són els mateixos a tots els entorns i identifiquen a l'aplicació davant Gicar.\r\n\r\n#### shib.conf\r\n\r\nFitxer per definir les url's a protegir per Gicar.\r\n\r\nEn general, és el mateix per tots els entorns.\r\n\r\n#### app.conf\r\n\r\nFitxer per definir la configuració específica de d'aplicació:\r\n\r\n* proxyPass\r\n* rewrite\r\n* ...\r\n\r\nEs podria utilitzar el shib.conf, però és més net fer-ho per separat.\r\n\r\n#### idp-metadata.xml\r\n\r\nPresenta diferents configuracions internes per Shibboleth.\r\n\r\nEntre les configuracions destaca el servidor de Shibboleth i alguns certificats interns.\r\n\r\nEs proporcionat per l'equip de Gicar al realitzar la sol·licitud del servei.\r\n\r\n**És diferent per cada entorn.**\r\n\r\nCal utilitzar un **configMap**  par cadascun dels entorns.\r\n\r\n### Variables d'entorn\r\n\r\nCal definir les següents variables d'entorn que identifiquen l'aplicació a Gicar:\r\n\r\n- **url_entityid_gicar** -> application id in gicar\r\n- **url_idp_gicar** -> gicar URL enpoint\r\n- **certificate_name** -> certificate file name\r\n- **server_name** -> public application serverName (with http schema)\r\n\r\n\r\n\r\n## Exemple de configuració a Gicar\r\n\r\n### Creació de la imatge\r\n\r\nCrear una imatge a partir de la imatge certificada i copiar els fitxers necessaris.\r\n\r\nExemple:\r\n\r\n```\r\n\r\nFROM docker-registry.ctti.extranet.gencat.cat/gencatcloud/gicar-shibboleth-openshift:1.0.3\r\n\r\nMAINTAINER xxxx\r\n\r\n# Es copien els recursos estàtics\r\nCOPY /dist/frontend /var/www/html\r\n\r\n# configuració específica de l'aplicació\r\nCOPY conf/app.conf /etc/httpd/conf.d/app.conf\r\nCOPY conf/shib.conf /etc/httpd/conf.d/shib.conf\r\n\r\n# Certificats GICAR\r\nCOPY conf/app.crt /etc/shibboleth/app.crt\r\nCOPY conf/app.key /etc/shibboleth/app.key\r\n\r\n```\r\n\r\n### Descriptors Desplegament\r\n\r\nPassos a seguir:\r\n\r\n- Definir les 4 variables d'entorn al descriptor de desplegament\r\n- Crear un configMap amb el fitxer de configuració **idp-metadata.xml** que correspongui\r\n- Mapejar el fitxers en un volum al descriptor de desplegament\r\n\r\nFragment del descriptor de desplegament:\r\n\r\n```\r\n...\r\nenv:\r\n- name: url_entityid_gicar\r\n  value: https://preproduccio.pgec.gencat.cat\r\n- name: url_idp_gicar\r\n  value: https://preproduccio.idp1-gicar.gencat.cat/idp/shibboleth\r\n- name: certificate_name\r\n  value:  AplicacioProva\r\n- name: server_name\r\n  value: https://preproduccio.pgec.gencat.cat\r\n...\r\nvolumeMounts:\r\n- name: gicar-metadata\r\n  mountPath: /gicar\r\n...\r\nvolumes:\r\n    - name: gicar-metadata\r\n    configMap:\r\n        name: gicar-config\r\n        items:\r\n        - key: idp-metadata\r\n          path: idp-metadata.xml\r\n...\r\n```\r\n\r\nDescriptor del ConfigMap:\r\n```\r\napiVersion: v1\r\nkind: ConfigMap\r\nmetadata:\r\n  name: gicar-config\r\ndata:\r\n  idp-metadata: |\r\n    <?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n    <EntityDescriptor xmlns=\"urn:oasis:names:tc:SAML:2.0:metadata\" xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\" xmlns:shibmd=\"urn:mace:shibboleth:metadata:1.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" entityID=\"https://preproduccio.idp1-gicar.gencat.cat/idp/shibboleth\">\r\n    <IDPSSODescriptor protocolSupportEnumeration=\"urn:mace:shibboleth:1.0 urn:oasis:names:tc:SAML:1.1:protocol urn:oasis:names:tc:SAML:2.0:protocol\">\r\n        <Extensions>\r\n            <shibmd:Scope regexp=\"false\">preproduccio.idp1-gicar.gencat.cat</shibmd:Scope>\r\n        </Extensions>\r\n        <KeyDescriptor>\r\n            <ds:KeyInfo>\r\n                <ds:X509Data>\r\n                    <ds:X509Certificate>\r\n    MIIDkTCCAnmgAwIBAgIBQjANBgkqhkiG9w0BAQUFADBpMSEwHwYDVQQKExhHZW5l\r\n    ...\r\n    ksywNnQ=\r\n                    </ds:X509Certificate>\r\n                </ds:X509Data>\r\n            </ds:KeyInfo>\r\n        </KeyDescriptor>\r\n        <ArtifactResolutionService Binding=\"urn:oasis:names:tc:SAML:1.0:bindings:SOAP-binding\" Location=\"https://preproduccio.idp1-gicar.gencat.cat/idp/profile/SAML1/SOAP/ArtifactResolution\" index=\"1\"/>\r\n        <ArtifactResolutionService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:SOAP\" Location=\"https://preproduccio.idp1-gicar.gencat.cat/idp/profile/SAML2/SOAP/ArtifactResolution\" index=\"2\"/>     \r\n        <NameIDFormat>urn:mace:shibboleth:1.0:nameIdentifier</NameIDFormat>\r\n        <NameIDFormat>urn:oasis:names:tc:SAML:2.0:nameid-format:transient</NameIDFormat>\r\n        <SingleSignOnService Binding=\"urn:mace:shibboleth:1.0:profiles:AuthnRequest\" Location=\"https://preproduccio.idp1-gicar.gencat.cat/idp/profile/Shibboleth/SSO\"/>\r\n        <SingleSignOnService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST\" Location=\"https://preproduccio.idp1-gicar.gencat.cat/idp/profile/SAML2/POST/SSO\"/>\r\n        <SingleSignOnService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST-SimpleSign\" Location=\"https://preproduccio.idp1-gicar.gencat.cat/idp/profile/SAML2/POST-SimpleSign/SSO\"/>\r\n        <SingleSignOnService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect\" Location=\"https://preproduccio.idp1-gicar.gencat.cat/idp/profile/SAML2/Redirect/SSO\"/>\r\n    </IDPSSODescriptor>\r\n    <AttributeAuthorityDescriptor protocolSupportEnumeration=\"urn:oasis:names:tc:SAML:1.1:protocol urn:oasis:names:tc:SAML:2.0:protocol\">\r\n        <Extensions>\r\n            <shibmd:Scope regexp=\"false\">preproduccio.idp1-gicar.gencat.cat</shibmd:Scope>\r\n        </Extensions>\r\n        <KeyDescriptor>\r\n            <ds:KeyInfo>\r\n                <ds:X509Data>\r\n                    <ds:X509Certificate>\r\n    MIIDkTCCAnmgAwIBAgIBQjANBgkqhkiG9w0BAQUFADBpMSEwHwYDVQQKExhHZW5l\r\n    ...\r\n    nsH3Wp6sxmBqsS0ATZOMaqUD6KJz\r\n    ksywNnQ=\r\n                    </ds:X509Certificate>\r\n                </ds:X509Data>\r\n            </ds:KeyInfo>\r\n        </KeyDescriptor>\r\n        <AttributeService Binding=\"urn:oasis:names:tc:SAML:1.0:bindings:SOAP-binding\" Location=\"https://preproduccio.idp1-gicar.gencat.cat/idp/profile/SAML1/SOAP/AttributeQuery\"/>\r\n        <AttributeService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:SOAP\" Location=\"https://preproduccio.idp1-gicar.gencat.cat/idp/profile/SAML2/SOAP/AttributeQuery\"/>\r\n        <NameIDFormat>urn:mace:shibboleth:1.0:nameIdentifier</NameIDFormat>\r\n        <NameIDFormat>urn:oasis:names:tc:SAML:2.0:nameid-format:transient</NameIDFormat>\r\n    </AttributeAuthorityDescriptor>\r\n    </EntityDescriptor>\r\n```\r\n","objectID":"L2Nsb3VkLWNhYXMvY29uZmlndXJhY2lvLWdpY2Fy"},"L2Nsb3VkLWNhYXMvY29uc2lkZXJhY2lvbnMtZGVzcGxlZ2FtZW50":{"date":1550534400000,"title":"Consideracions en desplegaments de contenidors","description":"Consideracions generals a tenir present en desplegaments de contenidors","sections":"Container Cloud","weight":9,"categories":["cloud","docker","container","kubernetes","appagile","swarmme"],"path":"/cloud-caas/consideracions-desplegament","content":"Al desplegar una aplicació a les diferents plataformes de contenidors cal tenir present una sèrie de consideracions.\r\nAlgunes apliquen a qualsevol plataforma, altres apliquen a plataformes en concret.\r\n\r\n- **Tots els desplegaments a les diferents de contenidors es faran via SIC**\r\n- En un desplegament de contenidors es poden identificar quatre blocs clarament diferenciats:\r\n\r\n  - **Custòdia del codi font**. És comú a totes les aplicacions.\r\n  - **Construcció dels artefactes de l'aplicació**. És comú a totes les aplicacions.\r\n  - **Construcció de la imatge docker**. És un pas addicional que no és present en el desplegament d'aplicacions tradicional.\r\n  - **Desplegament pròpiament dit**. Tot i que és comú a totes les aplicacions, desplegar als orquestradors docker presenta certes particularitats que cal tenir present.\r\n\r\n## Custòdia del codi font\r\n\r\nEls artefactes destinats a ser desplegats. Es construiran a partir de codi font repositat al [Servei de custodia de codi font del SIC.](https://canigo.ctti.gencat.cat/sic-serveis/scm/)\r\n\r\n**Es crearà un projecte/repositori diferent per cada component que sigui desplegat com a contenidor.**\r\n\r\n**En cas de generar llibreries que seran compartides per diferents aplicacions es crearà un projecte/repositori per cadascuna d'elles.**\r\n\r\n## Construcció dels artefactes\r\n\r\nÉs important notar que **l'artefacte desplegat serà el mateix a tots els entorns**, això implica que la definició de les propietats específiques de l'entorn han d'estar definides en variables d'entorn o fitxers de configuració.\r\nPodeu trobar més informació de com gestionar la configuració i contrasenyes en contenidors a  [Fitxers de configuració a contenidors](https://canigo.ctti.gencat.cat/cloud-caas/configuracio-contenidors/)\r\n\r\nNotar la necessitat de definir la versió de l'artefacte utilitzant el fitxer **sic.yml** a la carpeta **sic**, amb la propietat **version** que defineix la versió de l'artefacte/imatge.\r\n\r\nAddicionalment a la definició manual de la versió de l'artefacte, en desenvolupaments basats en **maven** es pot generar la versió automàticament a partir de la versió definida al **pom.xml**. Es pot trobar més informació a l'article [Integració d'una aplicació Canigó a SIC 2.0](https://canigo.ctti.gencat.cat/howtos/2017-12-howto-integracio_canigo_sic/)\r\n\r\nLa construcció de l'artefacte es realitzarà al SIC. En cap cas es construirà l'artefacte a la construcció de la imatge docker.\r\n\r\nCal proporcionar l'equip de Sic/Suport Cloud les instruccions necessàries, incloent-hi les eines i versions, per construir els artefactes a desplegar.\r\n\r\nPodeu trobar més informació a [Integració de contenidors a SIC](https://canigo.ctti.gencat.cat/cloud-caas/integracio-contenidors-sic/)\r\n\r\n## Construcció de la imatge docker\r\n\r\nEl CTTI disposa d'un conjunt d'imatges docker homologades que es recomana utilitzar com a base per construir les imatges docker de les diferents aplicacions.\r\nAquestes imatges es poden consultar al [elements de catàleg](https://canigo.ctti.gencat.cat/cloud-caas/cataleg-contenidors/) i suporten les tecnologies més freqüents utilitzades a la Generalitat de Catalunya.\r\n\r\nEn cas de necessitar una imatge d'una tecnologia o producte no suportat, cal tenir present les consideracions indicades a [Criteris creació contenidors docker](https://canigo.ctti.gencat.cat/cloud-caas/dockerImages/)\r\n\r\nA l'hora d'utilitzar les imatges base, en cap cas les copieu i les modifiqueu, feu una imatge que hereti de la imatge base. Dockerfile ex:\r\n\r\n```\r\nFROM docker-registry.ctti.extranet.gencat.cat/gencatcloud/tomcat:9.0-java8\r\n\r\nENV CATALINA_HOME /usr/local/tomcat\r\n\r\nCOPY artefacte ${CATALINA_HOME}/webapps\r\n```\r\n\r\nTotes les imatges base estan repositades al registre docker privat del CTTI i el seu codi font és accessible al gitlab a [Imatges-docker](https://git.intranet.gencat.cat/3048-intern/imatges-docker).\r\n\r\nPodeu trobar més informació a [Registre docker privat.](https://canigo.ctti.gencat.cat/cloud-caas/dockerRegistry/)\r\n\r\n## Desplegament\r\n\r\nEl desplegament a plataformes docker basades en Kubernetes (Kubernetes i Openshift) requereix la creació d'uns descriptors en format yaml.\r\n\r\nAquests descriptors seran creats per l'equip de desenvolupament i es repositaran a un projecte/repositori anomenat **Orchestrators** dins del grup del codi de diàleg del projecte.\r\n\r\nCada entorn i component d'aplicació estarà separat en carpetes. Ex:\r\n\r\n- app1/PRE\r\n- app1/PRO\r\n- app2/PRE\r\n- app2/PRO\r\n- ...\r\n\r\nEn cadascuna d'aquestes carpetes s'inclouran tots els descriptors necessaris.\r\nEls Secrets s'inclouran sense les dades sensibles, que seran gestionades per l'equip de Suport Cloud.\r\n\r\nPodeu trobar més informació respecte als descriptors yaml de cadascuna de les plataformes a:\r\n\r\n- [Contenidors AppAgile](https://canigo.ctti.gencat.cat/cloud-caas/contenidors_appagile/)\r\n- [Contenidors Kubernetes](https://canigo.ctti.gencat.cat/cloud-caas/contenidors_kubernetes/)\r\n\r\nEl desplegament a la plataforma SwarmMe no requereix descriptors específics, però si requereix disposar de la següent informació:\r\n\r\n- namespace\r\n- imatge docker\r\n- xarxa\r\n- mida del contenidor\r\n- domini\r\n- port\r\n- repliques\r\n- paràmetres d'entorn\r\n- ...\r\n\r\nBàsicament són les mateixes dades que s'informen als descriptors yaml.\r\n","objectID":"L2Nsb3VkLWNhYXMvY29uc2lkZXJhY2lvbnMtZGVzcGxlZ2FtZW50"},"L2Nsb3VkLWNhYXMvZG9ja2VySW1hZ2Vz":{"date":1528243200000,"title":"Criteris creació contenidors docker","description":"Criteris per crear les imatges dels contenidors docker que es desplegaran als diferents clouds públics i privats","sections":"Container Cloud","weight":3,"categories":["cloud","docker","container","paas","openshift"],"path":"/cloud-caas/dockerImages","content":"## Introducció\n\nA l'hora de crear les imatges dels diferents contenidors docker per les aplicacions gencat cal establir un conjunt de criteris que garanteixin la seva estabilitat i seguretat.\n\n## Imatges homologades pel CTTI\nL'equip de Suport Cloud del CTTI manté un conjunt d'imatges docker de les tecnologies més utilitzades a la Generalitat de Catalunya. Aquestes imatges són compatibles amb totes les plataformes basades en contenidors disponibles a la Generalitat (AppAgile,Openshift ,Kubernetes).\n\nAquestes imatges docker es poden trobar al **registre docker privat**, al projecte **gencatcloud**.\n\nPodeu trobar més informació respecte al registre privat a [Registre docker privat](http://canigo.ctti.gencat.cat/cloud-caas/dockerRegistry/).\n\n\n## Criteris per escollir la imatge base\n\n* Les imatges de docker es crearan sempre a partir del fitxer Dockerfile, en cap cas es crearan imatges a partir de contenidors.\n* En cas que existeixin imatges homologades pel CTTI de la tecnologia requerida, el Dockerfile particular de cada aplicació haurà de tenir com a base la imatge homologada, utilitzant la directiva **FROM**.\n* En cas que no existeixin imatges homologades pel CTTI de la tecnologia requerida, a l'hora d'escollir les imatges de base es faran servir els següents criteris:\n\t* Imatge oficial de fabricant al [docker hub](https://hub.docker.com/).\n\t* En cas que existeixi una imatge oficial basada en **[Alpine](https://hub.docker.com/_/alpine/)**, s'escollirà aquesta.\n    * En cas que no existeixi una imatge oficial basada en Alpine, s'escollirà la imatge basada en Centos, substituint Centos per la versió d'Oracle Linux Slim corresponent. Aquesta substitució és necessària pel support de pegats de seguretat que ofereix Oracle Linux i no ofereix Centos.\n\t* En cas que no existeixi una imatge oficial basada en Alpine ni Centos, s'escollirà la que recomani el fabricant. Sol ser la que al tag només s'indica la versió.\n* Mai s'escollirà el tag latest. És una versió que va canviant en el temps i genera inestabilitat a les aplicacions. Escollir sempre la versió més tancada possible.\n\n## Criteris generals per la creació de les imatges\n\nAlguns d'aquests criteris no apliquen en cas d'utilitzar les imatges homologades pel CTTI.\n\n* Deixar instal·lat el nombre mínim de paquets al docker, si és necessari instal·lar paquets per realitzar compilacions, desinstal·lar-los un cop realitzada aquesta.\n* Actualitzar els packets del sistema operatiu a l'última versió disponible amb tots els pegats de seguretat aplicats.\n* No deixar el codi font al docker, un cop compilat, eliminar-lo.\n* Incloure a la imatge el script **wait-for-it.sh**, adjuntat a baix, per poder testejar les comunicacions. Notar que requereix tenir el bash instal·lat.\n* No executar mai el procés final de les aplicacions amb l'usuari **root**. La majoria de tecnologies inclouen scripts que utilitzen usuaris específics per arrencar-les.\n* Fixar els uid i gid dels usuaris i grups utilitzats per executar els processos, amb l'objectiu d'evitar escalat de privilegis.\n* Assegurar la seguretat dels directoris definint el propietari i els permisos explícitament. S'adjunta a baix l'script **docker-setup.sh** d'exemple.\n* Executar el procés principal des d'un script, mai directament al Dockerfile.\n* Utilitzar el volum **/data** per desar la informació que cal persistir.\n* No executar múltiples processos a dins de la imatge docker. Docker està pensat per executar un únic procés.\n* **No escriure els logs de l'aplicació a fitxers. Enviar els logs sempre a la sortida estàndard**. D'aquesta manera la plataforma capturarà els logs i no caldrà entrar als contenidors per veure'ls.\n\n## Criteris de seguretat\n\n* Intentar utilitzar l'última versió del producte, sol ser la que té menys vulnerabilitats de seguretat.\n* Per validar la seguretat de les imatges creades, utilitzar l'eina [Clair](https://github.com/coreos/clair). En cas que es detectin vulnerabilitats, intentar eliminar-les instal·lant els patches necessaris.\n* Aplicar totes les configuracions de seguretat recomanades pel fabricant o la comunitat per cada producte en particular.\n\nAbans de desplegar un contenidor a producció, es realitzarà una validació de seguretat utilitzant l'eina Clair. En cas de detectar vulnerabilitats de caràcter greu la imatge no serà desplegada.\n\n## Criteris específics de Openshift\n\n[Openshift](https://www.openshift.com/), tot i que suporta desplegar imatges de docker, presenta uns criteris més restrictius de seguretat que cal tenir present a l'hora de construir el Dockerfile.\n\n* No utilitzar l'usuari **root** ni per executar l'script principal del docker (normalment s'utilitza l'usuari root). Utilitzar la directiva **USER uid** per definir amb quin usuari s'executarà el procés.\n* Cal tenir present que openshift executa el procés amb un id d'usuari aleatori que pertany al grup **root**.\n\t* Aquest usuari es crea a l'executar el docker. No existeix, ni es coneix, en etapa de construcció de la imatge de docker.\n\t* A causa de la característica anterior, és possible que algunes accions que habitualment es fan en etapa de construcció calgui fer-les en etapa d'execució amb alguna shell.\n\t* Cal que les carpetes on el procés escriu dades, pertanyin al grup root. Es pot veure a l'script **docker-setup.sh** inclòs abaix.\n\t* Algunes aplicacions necessiten que l'usuari estigui definit al fitxer /etc/passwd. En aquest cas és necessari utilitzar el paquet **[nss_wrapper](https://cwrap.org/nss_wrapper.html)** per emular els canvis en aquest fitxer. Es pot veure un exemple a la imatge docker [postgres-openshift](https://github.com/gencat/postgres-openshift). Veure la plana web [Openshift. Creating Images. Guidelines. OpenShift Origin-Specific Guidelines. Support Arbitrary User IDs] (https://docs.openshift.org/latest/creating_images/guidelines.html#openshift-origin-specific-guidelines) per més detalls.\n* Utilitzar variables d'entorn per la configuració.\n* Més informació de com construir les imatges de docker està disponible a [Openshift. Creating Images. Guidelines](https://docs.openshift.org/latest/creating_images/guidelines.html).\n\n## Exemples\nPodeu trobar exemples de diferents imatges de docker seguint aquests criteris al [registre docker privat](https://docker-registry.ctti.extranet.gencat.cat) projecte **gencatcloud**.\n\nLes imatges amb extensió **-openshift* són les compatibles amb la plataforma de xPaaS del mateix nom.\n\n## Annexos\n_wait-for-it.sh_\n```\n#!/usr/bin/env bash\n#   Use this script to test if a given TCP host/port are available\n\ncmdname=$(basename $0)\n\nechoerr() { if [[ $QUIET -ne 1 ]]; then echo \"$@\" 1>&2; fi }\n\nusage()\n{\n    cat << USAGE >&2\nUsage:\n    $cmdname host:port [-s] [-t timeout] [-- command args]\n    -h HOST | --host=HOST       Host or IP under test\n    -p PORT | --port=PORT       TCP port under test\n                                Alternatively, you specify the host and port as host:port\n    -s | --strict               Only execute subcommand if the test succeeds\n    -q | --quiet                Don't output any status messages\n    -t TIMEOUT | --timeout=TIMEOUT\n                                Timeout in seconds, zero for no timeout\n    -- COMMAND ARGS             Execute command with args after the test finishes\nUSAGE\n    exit 1\n}\nwait_for()\n{\n    if [[ $TIMEOUT -gt 0 ]]; then\n        echoerr \"$cmdname: waiting $TIMEOUT seconds for $HOST:$PORT\"\n    else\n        echoerr \"$cmdname: waiting for $HOST:$PORT without a timeout\"\n    fi\n    start_ts=$(date +%s)\n    while :\n    do\n        (echo > /dev/tcp/$HOST/$PORT) >/dev/null 2>&1\n        result=$?\n        if [[ $result -eq 0 ]]; then\n            end_ts=$(date +%s)\n            echoerr \"$cmdname: $HOST:$PORT is available after $((end_ts - start_ts)) seconds\"\n            break\n        fi\n        sleep 1\n    done\n    return $result\n}\nwait_for_wrapper()\n{\n    # In order to support SIGINT during timeout: http://unix.stackexchange.com/a/57692\n    if [[ $QUIET -eq 1 ]]; then\n        timeout -t $TIMEOUT $0 --quiet --child --host=$HOST --port=$PORT --timeout=$TIMEOUT &\n    else\n        timeout -t $TIMEOUT $0 --child --host=$HOST --port=$PORT --timeout=$TIMEOUT &\n    fi\n    PID=$!\n    trap \"kill -INT -$PID\" INT\n    wait $PID\n    RESULT=$?\n    if [[ $RESULT -ne 0 ]]; then\n        echoerr \"$cmdname: timeout occurred after waiting $TIMEOUT seconds for $HOST:$PORT\"\n    fi\n    return $RESULT\n}\n# process arguments\nwhile [[ $# -gt 0 ]]\ndo\n    case \"$1\" in\n        *:* )\n        hostport=(${1//:/ })\n        HOST=${hostport[0]}\n        PORT=${hostport[1]}\n        shift 1\n        ;;\n        --child)\n        CHILD=1\n        shift 1\n        ;;\n        -q | --quiet)\n        QUIET=1\n        shift 1\n        ;;\n        -s | --strict)\n        STRICT=1\n        shift 1\n        ;;\n        -h)\n        HOST=\"$2\"\n        if [[ $HOST == \"\" ]]; then break; fi\n        shift 2\n        ;;\n        --host=*)\n        HOST=\"${1#*=}\"\n        shift 1\n        ;;\n        -p)\n        PORT=\"$2\"\n        if [[ $PORT == \"\" ]]; then break; fi\n        shift 2\n        ;;\n        --port=*)\n        PORT=\"${1#*=}\"\n        shift 1\n        ;;\n        -t)\n        TIMEOUT=\"$2\"\n        if [[ $TIMEOUT == \"\" ]]; then break; fi\n        shift 2\n        ;;\n        --timeout=*)\n        TIMEOUT=\"${1#*=}\"\n        shift 1\n        ;;\n        --)\n        shift\n        CLI=\"$@\"\n        break\n        ;;\n        --help)\n        usage\n        ;;\n        *)\n        echoerr \"Unknown argument: $1\"\n        usage\n        ;;\n    esac\ndone\nif [[ \"$HOST\" == \"\" || \"$PORT\" == \"\" ]]; then\n    echoerr \"Error: you need to provide a host and port to test.\"\n    usage\nfi\nTIMEOUT=${TIMEOUT:-15}\nSTRICT=${STRICT:-0}\nCHILD=${CHILD:-0}\nQUIET=${QUIET:-0}\nif [[ $CHILD -gt 0 ]]; then\n    wait_for\n    RESULT=$?\n    exit $RESULT\nelse\n    if [[ $TIMEOUT -gt 0 ]]; then\n        wait_for_wrapper\n        RESULT=$?\n    else\n        wait_for\n        RESULT=$?\n    fi\nfi\nif [[ $CLI != \"\" ]]; then\n    if [[ $RESULT -ne 0 && $STRICT -eq 1 ]]; then\n        echoerr \"$cmdname: strict mode, refusing to execute subprocess\"\n        exit $RESULT\n    fi\n    exec $CLI\nelse\n    exit $RESULT\nfi\n```\n\n_docker-setup.sh_\n```\n#!/bin/sh\n\n# setup directory for data\nmkdir -p /data\nchown -R nginx:0 /data\nchmod g+w -R /data\nchown -R nginx:0 /usr\nchown -R nginx:0 /var\n\nchgrp -R 0 /usr\nchmod -R g+rw /usr\nfind /usr -type d -exec chmod g+x {} +\n\nchgrp -R 0 /var\nchmod -R g+rw /var\nfind /var -type d -exec chmod g+x {} +\n```","objectID":"L2Nsb3VkLWNhYXMvZG9ja2VySW1hZ2Vz"},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1zYXJjYXQ=":{"date":1426781010000,"title":"SARCAT","description":"Serveis que ofereix la plataforma de Sarcat mitjançant la PICA i el seu connector nadiu.","sections":"Canigó. Documentació versió 3.x","weight":13,"path":"/canigo-documentacio-versions-3x-integracio/modul-sarcat","content":"## Propòsit\r\n\r\nAquest mòdul permet consumir els diferents serveis que ofereix la plataforma de Sarcat mitjançant la PICA i el seu connector nadiu. El mòdul permet consumir els serveis oferts pels WebService amb peticions síncrones.\r\n\r\n## Funcionalitats del connector\r\n\r\nEl connector proporciona accés a les següents operacions de Sarcat:\r\n\r\nOperació Sarcat                   | Descripció Funcional | Modalitat PICA | Operació PICA\r\n--------------------------------- | -------------------- | -------------- | -------------\r\nconsultaAssentaments              | Permet obtenir una relació d'assentaments, amb les dades bàsiques, que compleixin uns criteris de filtratge específics. | SARCAT_AL_CONSULTA    | OP_CONSULTA_ASSENTAMENTS\r\ncercaAssentaments                 | Permet obtenir totes les dades d'un assentament concret.                                                               | SARCAT_AL_CONSULTA    |  OP_CERCA_ASSENTAMENTS\r\nrecollirAssentamentsSafataEntrada | Permet recollir assentaments de la safata d'entrada per incorporar-los a d'altres sistemes.                            | SARCAT_AL_CONSULTA    |  OP_RECOLLIR_ENTRADA\r\nrecollirAssentamentsSafataSortida | Permet recollir assentaments de la safata de sortida per incorporar-los a d'altres sistemes.                            | SARCAT_AL_CONSULTA    |  OP_RECOLLIR_SORTIDA\r\nesPresortida                      | Conèixer si un assentament concret és una pre-sortida o una sortida.                                                    | SARCAT_AL_CONSULTA    |  OP_ES_PRESORTIDA\r\ninsertarAssentamentEntrada        | Es registra l'assentament d'entrada i retorna el número d'assentament assignat i la data de registre.                   | SARCAT_AL_ALTA        |  OP_INSERTAR_ASSENTAMENTS_ENTRADA\r\ninsertarAssentamentSortida        | Es registra l'assentament de sortida i retorna el número d'assentament assignat i la data de registre.                  | SARCAT_AL_ALTA        |  OP_INSERTAR_ASSENTAMENTS_SORTIDA\r\ninsertarAssentamentSafata         | Donada la informació d'assentaments d'entrada, els grava i retorna el número de registre de cadascun. Addicionalment comprova la validesa de la destinació externa respecte l'unitat de registre associada a l'assentament.                                                                                            | SARCAT_AL_ALTA        |  OP_INSERTAR_ASSENTAMENTS_SAFATA\r\ninsertarAssentamentPresortida     | Donada la informació X d'assentaments de presortida, els grava i retorna el número de registre de cadascun.             | SARCAT_AL_ALTA        |  OP_INSERTAR_ASSENTAMENTS_PRESORTIDA\r\nnumExp \t\t\t\t\t\t\t  | Permet modificar el número d'expedient prèviament assignat a un assentament d'entrada o sortida realitzat.              | SARCAT_AL_MODIFICACIO |  OP_CANVI_NUM_EXPEDIENT\r\ngetNumsRegistre                   | Permet obtenir un conjunt de números d'assentaments que són reservats per s@rcat de manera exclusiva pel Backoffice que fa la sol- licitud.                                                                                                                                                                             | SARCAT_AL_RESERVA     |  OP_GET_NUM_REGISTRE\r\ncercaAssentamentsHist             | Permet obtenir totes les dades d'un assentament que ha passat pel repositori d'històrics d'assentaments de S@rcat.      | SARCAT_AP_HISTORIC    |  OP_CERCA_ASSENTAMENT_HISTORIC\r\nbaixaAssentament                  | Permet donar de baixa assentaments d'entrada, sortida o presortida prèviament realitzats.                               | SARCAT_AL_BAIXA       |  OP_BAIXA_ASSENTAMENTS\r\nllistarTaulesMestres              | A partir d'una data concreta, s'obtenen totes les actualitzacions realitzades en les taules mestres de S@rcat a partir d'aquesta data.                                                                                                                                                                                   | SARCAT_AL_LLISTA_REG  |  OP_LLISTA_REG\r\nllistarTaulaMestra                | Recuperació de codis o valors possibles per a un determinat concepte o taula mestra.                                    | SARCAT_AP_LLISTA      |  OP_LLISTA_TAULA_MESTRA\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer tal d'instal-lar el mòdul de Sarcat es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.integration.sarcat.pica.version>[1.2.0,1.3.0)</canigo.integration.sarcat.pica.version>\r\n\r\n<dependency>\r\n    <groupId>cat.gencat.ctti</groupId>\r\n    <artifactId>canigo.integration.sarcat.pica</artifactId>\r\n    <version>${canigo.integration.sarcat.pica.version}</version>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració es realitza automàticament a partir de la eina de suport al desenvolupament.\r\n\r\nUbicació proposada: <PROJECT_ROOT>/src/main/resources/config/props/sarcat.properties\r\n\r\nPropietat           | Requerit | Descripció\r\n------------------- | -------- | ----------\r\n*.sarcat.urlPica\t | Sí       | Url del WebService de Sarcat. Valor per defecte: http://preproduccio.pica.intranet.gencat.cat/pica_cataleg/AppJava/services/\r\n*.sarcat.user       | Sí       | Usuari de Sarcat\r\n*.sarcat.password   | Sí       | Password de l'usuari de Sarcat\r\n*.sarcat.finalitat  | Sí       | Finalitat de l'ús del servei (TEST, PRODUCTIU...)\r\n*.sarcat.nifEmisor | Sí       | Nif de l'emissor\r\n*.sarcat.nomEmisor       | Sí       | Nom de l'emissor\r\n*.sarcat.nomFuncionari   | Sí       | Nom del funcionari\r\n*.sarcat.nifFuncionari  | Sí       | Nif del funcionari\r\n*.sarcat.emailFuncionari  | Sí       | Email del funcionari\r\n\r\nEls valors de finalitat, urlPica, nifEmisor i nomEmisor s'han de consultar a la OT PICA en requeridors.otpica.ctti@gencat.cat\r\n\r\nAquest mòdul és dependent del [mòdul de la PICA] (/canigo-documentacio-versions-3x-integracio/modul-pica/) amb lo qual també s'ha de configurar aquest.\r\n\r\n## Utilització del Mòdul\r\n\r\n### REST\r\n\r\nPer a utilitzar aquest mòdul, cal crear un Controller i un Service:\r\n\r\n**SarcatService.java**\r\n\r\nController que publica les operacions disponibles per a qui hagi de consumir-les.\r\n\r\n```java\r\nimport org.slf4j.Logger;\r\nimport org.slf4j.LoggerFactory;\r\nimport org.springframework.beans.factory.annotation.Autowired;\r\nimport org.springframework.context.annotation.Lazy;\r\nimport org.springframework.stereotype.Service;\r\n\r\nimport cat.gencat.ctti.canigo.arch.integration.sarcat.pica.SarcatConnector;\r\nimport cat.gencat.ctti.canigo.arch.integration.sarcat.pica.exceptions.SarcatException;\r\nimport net.gencat.scsp.esquemes.peticion.common.OrdreCerca;\r\nimport net.gencat.scsp.esquemes.peticion.common.TipusAssentament;\r\nimport net.gencat.scsp.esquemes.peticion.consulta.AssentamentCerca;\r\nimport net.gencat.scsp.esquemes.peticion.consulta.AssentamentCerca.ParametresCerca;\r\nimport net.gencat.scsp.esquemes.peticion.consulta.SarcatAlConsultaRequestDocument;\r\nimport net.gencat.scsp.esquemes.peticion.consulta.SarcatAlConsultaRequestDocument.SarcatAlConsultaRequest;\r\nimport net.gencat.scsp.esquemes.peticion.consulta.SarcatAlConsultaResponseDocument.SarcatAlConsultaResponse;\r\n\r\n@Service(\"sarcatService\")\r\n@Lazy\r\npublic class SarcatService {\r\n\r\n\tprivate static final Logger log = LoggerFactory.getLogger(SarcatService.class);\r\n\r\n\t@Autowired\r\n    private SarcatConnector sarcatConnector;\r\n    \r\n\r\n\r\n\tpublic String testSarcat(){\r\n\t\t\r\n\t\tString message;\r\n\r\n\t\ttry {\r\n\r\n            SarcatAlConsultaRequestDocument document = SarcatAlConsultaRequestDocument.Factory.newInstance();\r\n            SarcatAlConsultaRequest request = document.addNewSarcatAlConsultaRequest();\r\n\r\n            AssentamentCerca cerca = request.addNewAssentamentCerca();\r\n            ParametresCerca params =  cerca.addNewParametresCerca();\r\n            params.setDataInici(\"09/03/2011\");\r\n            params.setDataFinal(\"10/03/2011\");\r\n            cerca.setParametresCerca(params);\r\n            cerca.setUrUsuari(\"0001\");\r\n            cerca.setOrdreCerca(OrdreCerca.DATA_ALTA);\r\n            cerca.setTipus(TipusAssentament.ENTRADA);\r\n               cerca.setDescendent(true);\r\n\r\n            SarcatAlConsultaResponse resposta = sarcatConnector.cercaAssentaments(document).getSarcatAlConsultaResponse();\r\n\r\n\t        if (resposta.getError().getCodi() != 0) {\r\n\t        \tmessage = \"Test amb errors: \" + resposta.getError().getCodi()    + \" \" + resposta.getError().getDescripcio();\r\n\t        \tlog.error(resposta.getError().getCodi()    + \" \" + resposta.getError().getDescripcio());\r\n\t        } else {\r\n\t            message = \"Test correcte: \" + resposta.getAssentamentArray().length;\r\n\t        }\r\n\t\r\n\t    } catch (SarcatException e) {\r\n\t    \tmessage = \"Test erròni: \" + e.getMessage();\r\n\t        log.error(e.getMessage(), e);\r\n\t    }\r\n        \r\n        return message;\r\n    }\r\n\t\r\n}\r\n```\r\n\r\n**SarcatServiceController.java**\r\n\r\nController que publica les operacions disponibles per a qui hagi de consumir-les.\r\n\r\n```java\r\nimport org.springframework.beans.factory.annotation.Autowired;\r\nimport org.springframework.http.MediaType;\r\nimport org.springframework.web.bind.annotation.PostMapping;\r\nimport org.springframework.web.bind.annotation.RequestMapping;\r\nimport org.springframework.web.bind.annotation.RestController;\r\n\r\nimport cat.gencat.plantilla32.service.SarcatService;\r\n\r\n@RestController\r\n@RequestMapping(\"/sarcat\")\r\npublic class SarcatServiceController {\r\n\r\n\t@Autowired\r\n\tSarcatService sarcatService;\r\n\r\n\r\n\t@PostMapping(produces = { MediaType.APPLICATION_JSON_VALUE })\r\n\tpublic String testSarcat() throws Exception {\r\n\t\treturn sarcatService.testSarcat();\r\n\t}\r\n}\r\n```\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1zYXJjYXQ="},"L2Nsb3VkLWNhYXMvaW50ZWdyYWNpby1jb250ZW5pZG9ycy1zaWM=":{"date":1550793600000,"title":"Integració de contenidors a SIC","description":"Informació respecte a la integració d'aplicacions basades en contenidors amb el SIC.","sections":"Container Cloud","weight":12,"categories":["cloud","docker","container","kubernetes","openshift","Swarm","sic"],"path":"/cloud-caas/integracio-contenidors-sic","content":"## Informació necessària per la integració amb SIC\r\n\r\n### Kubernetes/Openshift\r\n\r\n- Nom del repositori git del codi font.\r\n- En cas de necessitats de compilació, requeriments i instruccions al respecte.\r\n- Nom de la imatge docker (la versió s'agafa del fitxer sic.yml)\r\n- Path del fitxer Dockerfile.\r\n- Nom del repositori git dels descriptors.\r\n- Nom del descriptor de desplegament de Kubernetes/Openshift.\r\n- Llista de correus electrònics en cas de notificacions de Jenkins.\r\n\r\n### Swarm\r\n\r\n- Nom del repositori git del codi font.\r\n- En cas de necessitats de compilació, requeriments i instruccions al respecte.\r\n- Nom de la imatge docker (la versió s'agafa del fitxer sic.yml)\r\n- Path del fitxer Dockerfile.\r\n- Llista de correus electrònics en cas de notificacions de Jenkins.\r\n- Com que swarm no disposa de descriptors, cal proporcionar addicionalment la següent informació:\r\n  - namespace\r\n  - xarxa\r\n  - mida del contenidor\r\n  - domini\r\n  - port\r\n  - rèpliques\r\n  - paràmetres d'entorn\r\n  - ...\r\n\r\n## Tasques disponibles al SIC per projectes basats en contenidors\r\n\r\n### Kubernetes i Openshift\r\n\r\nPer plataformes basades en Kubernetes (Kubernetes/Openshift), al SIC estan disponibles les següents tasques:\r\n\r\n- Desplegament\r\n- Desplegament de tags\r\n- Reinici\r\n- Parada\r\n- Arrancada\r\n- Desplegament de ConfigMaps\r\n- Actualització d'algunes propietats dels descriptors de deployment/deploymentConfig:\r\n  - Variables d'entorn\r\n  - Quotes\r\n  - Punts de muntatge\r\n\r\n### Swarm\r\n\r\nPer plataformes basades en Swarm (SwarmMe), al SIC estan disponibles les següents tasques:\r\n\r\n- Desplegament\r\n\r\nEstà previst en un futur crear les tasques:\r\n\r\n- Desplegament de tags\r\n- Reinici\r\n- Parada\r\n- Arrancada\r\n\r\nPodeu trobar més informació del SIC a [Servei d'Integració Contínua.](https://canigo.ctti.gencat.cat/sic/)","objectID":"L2Nsb3VkLWNhYXMvaW50ZWdyYWNpby1jb250ZW5pZG9ycy1zaWM="},"L2Nsb3VkLWNhYXMvZG9ja2VyUmVnaXN0cnk=":{"date":1528243200000,"title":"Registre docker privat","description":"Descripció i ús del registre docker privat","sections":"Container Cloud","weight":2,"categories":["cloud","docker","container","openshift","swarm"],"path":"/cloud-caas/dockerRegistry","content":"## Introducció\n\nDocker per defecte està configurat per utilitzar el registre públic [Docker Hub](https://hub.docker.com/) com a repositori d'imatges.\n\nPer persistir i gestionar les imatges docker privades és important disposar un registre docker privat:\n\n* Cal garantir que les imatges docker quedin persistides en algun repositori.\n* Cal garantir que les imatges docker dels diferents projectes no siguin públiques.\n\n**Important: Les imatges base presents al dockerHub de gencatcloud deixaran de ser mantingudes i pròximament esborrades. D'ara endavant, cal utilitzar les imatges base del registre privat.**\n\n## Descripció del registre privat\n\nEl registre privat escollit a la Generalitat de Catalunya és [Harbor](https://vmware.github.io/harbor/).\n\nDestaquen les següents característiques:\n\n* **Gestió d'usuaris RBAC:** Els repositoris docker estan organitzats en Projectes. Permet assignar permisos i rols als diferents usuaris a cada projecte.\n* **Portal web:** Permet navegar per les imatges dels diferents projectes, veure vulnerabilitats, ...\n* **API REST:** La majoria d'operacions efectuades des del portal web, es poden fer via API.\n* **Auditoria:** Totes les acciones que es facin sobre el registre queden registrades per poder ser analitzades en auditories.\n* **Anàlisi de vulnerabilitats:** Totes les imatges repositades al Registre són analitzades amb l'eina [Clair](https://github.com/coreos/clair) per identificar les diferents vulnerabilitats.\n* **Signatura d'Imatges:** Les imatges repositades al registre poden ser signades digitalment de cara a garantir la seva procedència i integritat. Actualment encara no implementat.\n\n## Ús del registre privat\n### Accés\nEl registre docker privat de la Generalitat de Catalunya, està disponible a l'URL pública **https://docker-registry.ctti.extranet.gencat.cat**\n\nÉs un registre privat sense cap repositori públic.\n\n### Permisos\nL'equip de suport cloud subministrarà al proveïdor d'aplicacions un usuari amb els següents permisos:\n\n* Permís de lectura del projecte associat a l'aplicació del projecte.\n* Permís de lectura del projecte **gencatcloud** amb les imatges base mantingudes per l'equip de Suport Cloud.\n\n### Consola web\nEs pot accedir a la consola web introduint a un navegador la url d'accés.\n\n* Des de la consola web es pot navegar pels projectes.\n* Es pot accedir als repositoris d'un projecte fent clic al **projecte**.\n* Es pot accedir a les diferents versions de les imatges d'un repositori fent clic al **repositori**.\n* Per cada imatge, es poden observar les vulnerabilitats fent clic al **tag** de la imatge.\n* Per cada vulnerabilitat es pot observar la descripció de la mateixa fent clic a la **vulnerabilitat**.\n\n### Docker\n#### Descarrega d'una imatge\nPer accedir a les imatges del registre des de docker, cal seguir els següents passos:\n\n* Connectar-se al registre:\n```\ndocker login https://docker-registry.ctti.extranet.gencat.cat\n```\n* Introduir les credencials proporcionades per l'equip de SuportCloud.\n* Fer un pull de la imatge desitjada\n```\ndocker pull docker-registry.ctti.extranet.gencat.cat/gencatcloud/java:8\n```\n* Desconnectar-se del registre:\n```\ndocker logout https://docker-registry.ctti.extranet.gencat.cat\n```\n\n#### Construir una imatge depenent d'una imatge repositada al registre privat\nPer exemple si tenim un dockerfile del tipus:\n\n```\nFROM docker-registry.ctti.extranet.gencat.cat/gencatcloud/java:8\n\nMAINTAINER xxxx\n\nENV APP_DIR=/app\n\nCOPY xxxx.jar ${APP_DIR}\nCOPY run.sh /\n```\n\n**Important notar que el FROM ha d'incloure el registre privat**\n\n* Cal primer connectar-se al registre:\n```\ndocker login https://docker-registry.ctti.extranet.gencat.cat\n```\n* Construir la imatge\n```\ndocker build -t XXXX .\n```\n* Desconnectar-se del registre:\n```\ndocker logout https://docker-registry.ctti.extranet.gencat.cat\n```\n\n## Integració amb SIC\nTotes les aplicacions basades en contenidors desplegades via SIC, estan integrades amb el Registre Docker privat.\nCada imatge que es desplegui a les diferents plataformes docker (AppAgile, Kubernetes o SwarmMe), quedarà repositada al registre privat.\n","objectID":"L2Nsb3VkLWNhYXMvZG9ja2VyUmVnaXN0cnk="},"L2Nsb3VkLWNhYXMvbW9uaXRvcmF0Z2UtY29udGVuaWRvcnM=":{"date":1550793600000,"title":"Monitoratge i traces als contenidors","description":"Informació per accedir  al monitoratge i traces a les diferents plataformes de contenidors.","sections":"Container Cloud","weight":13,"toc":true,"categories":["cloud","docker","container","kubernetes","appagile","swarmme"],"path":"/cloud-caas/monitoratge-contenidors","content":"Dins del marc de la metodologia DevOps, s'ofereixen a lot d'aplicacions un conjunt d'eines per a que monitorin i tinguin accés a les traces dels diferents contenidor.\r\n\r\nA continuació es descriuen les diferents eines a cadascuna de les plataformes disponibles.\r\n\r\n## AppAgile\r\n\r\nAl desplegar una aplicació a AppAgile, es proporciona a lot d'aplicacions un usuari amb permisos de **lectura** del seu projecte a la plataforma AppAgile.\r\n\r\n### Monitoratge\r\n\r\nEs pot accedir a la consola d'AppAgile a la url https://master.appagile.cpd4.intranet.gencat.cat:8443\r\n\r\nDes d'allà es pot consultar de cada projecte la següent informació:\r\n\r\n- Configuració dels diferents elements (Desplegaments, Serveis, Rutes, ...)\r\n- Estat dels desplegaments\r\n- Estat dels pods\r\n- Mètriques dels pods\r\n- Logs dels pods\r\n\r\nPodeu trobar més informació al respecte a [OpenShift Container Platform 3.9 Documentation.](https://docs.openshift.com/container-platform/3.9/welcome/index.html)\r\n\r\nAddicionalment a la consola, també podeu accedir a la informació i configuracions utilitzant el client **oc**.\r\n\r\nPodeu trobar més informació a [Get Started with the CLI.](https://docs.openshift.com/container-platform/3.9/cli_reference/get_started_cli.html)\r\n\r\nPodeu descarregar el client oc a [oc client v3.9 .](https://github.com/openshift/origin/releases/tag/v3.9.0)\r\n\r\n### Logs\r\n\r\nDes de la plataforma d'openshift es poden veure els logs dels pods en temps real. Si necessiteu accedir a logs anteriors o de pods que ja no existeixi, està disponible un Kibana amb tots els logs de l'aplicació amb una retenció de 30 dies.\r\n\r\nPodeu accedir al Kibana a la url https://kibana.appagile.cpd4.intranet.gencat.cat/app/kibana\r\nutilitzant l'usuari porporcionat.\r\n\r\n## IBMCloud Kubernetes\r\n\r\nEn desplegar una aplicació a Kubernetes, es proporciona a lot d'aplicacions un usuari amb permisos de **lectura** del seu projecte a la plataforma Kubernetes.\r\n\r\n### Monitoratge\r\n\r\nAmb aquest usuari us podeu logar a la plataforma d'IBMCloud i accedir via cli i kubectl a la següent informació:\r\n\r\n- Configuració dels diferents elements (Desplegaments, Serveis, Rutes, ...)\r\n- Estat dels desplegaments\r\n- Estat dels pods\r\n- Mètriques dels pods\r\n- Logs dels pods\r\n\r\n#### Instruccions\r\n\r\n##### Instal·lació\r\n\r\nInstal·lar el IBMCloud cli.\r\n\r\nEl podeu descarregar de https://github.com/IBM-Cloud/ibm-cloud-cli-release/releases\r\n\r\n- Instal·lar el plugin **kubernetes-service**\r\n```\r\n        ibmcloud plugin install kubernetes-service -r Bluemix\r\n```\r\n- Instal·lar el cli de kubernetes (kubectl) versió 1.12.5\r\n\r\n    El podeu descarregar de:\r\n  \r\n  - Windows: http://storage.googleapis.com/kubernetes-release/release/v1.12.5/bin/windows/amd64/kubectl.exe\r\n  - Linux: http://storage.googleapis.com/kubernetes-release/release/v1.12.5/bin/linux/amd64/kubectl\r\n\r\n\r\n##### Configuració\r\n\r\n- Loggar-se a Bluemix\r\n```\r\n        ibmcloud login -a https://api.eu-gb.bluemix.net\r\n```\r\n- Posar usuari i contrasenya\r\n- Escollir el compte\r\n```\r\n        1. CENTRE DE TELECOMUNICACIONS?GENERALITAT DE CATALUNYA (db4051d27e4a2eff044e6d5062abdf69) <-> 1449381\r\n```\r\n\r\n- Inicialitzar el container service\r\n  \r\n```\r\n        ibmcloud ks init\r\n    \r\n    respon\r\n\r\n        Using default API endpoint: https://uk-south.containers.bluemix.net\r\n        OK        \r\n```\r\n\r\n- Mostrar el cluster\r\n\r\n```\r\n        ibmcloud ks clusters\r\n\r\n    respon\r\n\r\n        OK\r\n        Nombre        ID                                 Estado   Creado       Trabajadores   Ubicación   Versión         Nombre de grupo de recursos\r\n        cluster_pre   390086041bd947d496e3be8f1ad25487   normal   1 year ago   2              London      1.12.5_1537     default\r\n        cluster_pro   157e6387175449c1bdfff78eed37c4a6   normal   1 year ago   2              London      1.10.12_1543*   default\r\n```\r\n\r\n- Configurar cluster de PRE\r\n  \r\n```\r\n    ibmcloud ks cluster-config cluster_pre\r\n\r\na windows respon alguna cosa similar a \r\n\r\n    SET KUBECONFIG=C:\\Users\\usuari\\.bluemix\\plugins\\container-service\\clusters\\cluster_pre\\kube-config-lon02-cluster_pre.yml\r\n\r\na linux respon alguna cosa similar a\r\n\r\n    export KUBECONFIG=/home/user/.bluemix/plugins/container-service/clusters/cluster_pre/kube-config-lon02-cluster_pre.yml\r\n```\r\n\r\n- Configurar cluster de PRO\r\n  \r\n```\r\n    ibmcloud ks cluster-config cluster_pro\r\n\r\na windows respon alguna cosa similar a \r\n\r\n    SET KUBECONFIG=C:\\Users\\usuari\\.bluemix\\plugins\\container-service\\clusters\\cluster_pro\\kube-config-lon02-cluster_pro.yml\r\n\r\na linux respon alguna cosa similar a\r\n\r\n    export KUBECONFIG=/home/user/.bluemix/plugins/container-service/clusters/cluster_pro/kube-config-lon02-cluster_pro.yml\r\n```\r\n\r\nLes comandes SET/export són les que cal executar per accedir als diferents clusters de Kubernetes.\r\n\r\nPot donar-se el cas que el endpoint de la APi i els noms dels clusters no siguin exactament els mateixos que s'indiquen aquí. L'equip de Suport Cloud us proporcionarà les dades concretes de cadascun.\r\n\r\n##### Configuració variable d'entorn\r\n\r\nUna vegada realitzada la configuració, a cada sessió que necessiteu accedir al cluster de kubernetes amb kubectl, només caldrà executar les comandes SET/export anteriors.\r\n\r\nPeriòdicament, el token d'accés caduca i caldrà repetir el procés de configuració complet.\r\n\r\n### Logs\r\n\r\nAmb la cli de kubernetes  es poden veure els logs dels pods en temps real. Si necessiteu accedir a logs anteriors o de pods que ja no existeixi, està disponible un Kibana amb tots els logs de l'aplicació amb una retenció de 3 dies i amb una mida màxima de 500Mb del logs per dia.\r\n\r\nL'equip de Suport Cloud us proporcionarà la url on podreu accedir als logs.\r\n\r\n\r\n## IBM CaaS Kubernetes\r\n\r\nEn desplegar una aplicació a Kubernetes, es proporciona a lot d'aplicacions un token amb permisos de **lectura** del seu projecte a la plataforma Kubernetes.\r\n\r\n### Monitorització\r\n\r\nAmb aquest token podeu accedir via kubectl a la següent informació:\r\n\r\n- Configuració dels diferents elements (Desplegaments, Serveis, Rutes, ...)\r\n- Estat dels desplegaments\r\n- Estat dels pods\r\n- Mètriques dels pods\r\n- Logs dels pods\r\n\r\n#### Instruccions\r\n\r\n##### Instal·lació\r\n\r\n- Instal·lar el cli de kubernetes (kubectl) versió 1.11.5\r\n\r\n    El podeu descarregar de:\r\n  \r\n  - Windows: http://storage.googleapis.com/kubernetes-release/release/v1.11.5/bin/windows/amd64/kubectl.exe\r\n  - Linux: http://storage.googleapis.com/kubernetes-release/release/v1.11.5/bin/linux/amd64/kubectl\r\n\r\n##### Configuració del fitxer kubeconfig\r\n\r\nAl fitxer kubeconfig, cal configurar els següents elements:- \r\n\r\n- cluster\r\n- user\r\n- context\r\n\r\n###### Cluster\r\n\r\nExecutar:\r\n\r\n```\r\nkubectl config --kubeconfig=<fitxer_configuracio> set-cluster <nom_cluster> --server=https://172.24.149.130 --insecure-skip-tls-verify\r\n```\r\n\r\non:\r\n\r\n- ***cluster*** és el nom del cluster que es desitgi.\r\n- ***fitxer_configuracio*** és el fitxer de configuració que es desitgi.\r\n\r\n###### User\r\n\r\nExecutar:\r\n\r\n```\r\nkubectl config --kubeconfig=<fitxer_configuracio> set-credentials <usuari>  --token=<token>\r\n```\r\n\r\non:\r\n\r\n- ***cluster*** és el nom del cluster que es desitgi.\r\n- ***fitxer_configuracio*** és el fitxer de configuració que es desitgi.\r\n- ***usuari*** és el nom d'usuari que es desitgi.\r\n- ***token*** és el nom token proporcionat per l'equip de Suport Cloud.\r\n\r\n###### Context\r\n\r\nExecutar:\r\n\r\n```\r\nkubectl config --kubeconfig=<fitxer_configuracio> set-context <context> --cluster=<cluster> --namespace=<namespace> --user=<usuari>\r\n```\r\n\r\non:\r\n\r\n- ***fitxer_configuracio*** és el fitxer de configuració que es desitgi.\r\n- ***cluster*** és el nom del cluster que es desitgi.\r\n- ***namespace*** és el nom del namespace del projecte, proporcionat per Suport cloud.\r\n- ***usuari*** és el nom d'usuari que es desitgi.\r\n\r\n\r\n**Tingueu present que els noms escollits als diferents elements han de coincidir.**\r\n\r\n\r\n##### Configuració variable d'entorn\r\n\r\nA cada sessió que necessiteu accedir al cluster de kubernetes amb kubectl , caldrà que configureu la variable d'entorn **KUBECONFIG** apuntant al fitxer de configuració que heu creat al pas anterior.\r\n\r\na windows seria alguna cosa similar a \r\n\r\n    SET KUBECONFIG=<path_a_fitxer_configuracio>\r\n\r\na linux seria alguna cosa similar a\r\n\r\n    export KUBECONFIG=<path_a_fitxer_configuracio>\r\n\r\n### Logs\r\n\r\nAmb la cli de kubernetes  es poden veure els logs dels pods en temps real. Si necessiteu accedir a logs anteriors o de pods que ja no existeixi, està disponible un Kibana.\r\n\r\nL'equip de Suport Cloud us proporcionarà l'usuari i contrasenya per poder accedir als logs.","objectID":"L2Nsb3VkLWNhYXMvbW9uaXRvcmF0Z2UtY29udGVuaWRvcnM="},"L2Nsb3VkLWNhYXMvb3JxdWVzdHJhZG9yc19jb250ZW5pZG9ycw==":{"date":1530489600000,"title":"Orquestradors de contenidors","description":"Consideracions respecte als orquestradors de contenidors","sections":"Container Cloud","weight":4,"categories":["cloud","docker","container","paas","openshift","kubernetes","swarm"],"path":"/cloud-caas/orquestradors_contenidors","content":"## Introducció\n\nEn un entorn productiu, el desplegament utilitzant contenidors, moltes vegades no és suficient, és necessari disposar d'un conjunt de recursos addicionals que siguin capaços d'oferir un nivell de servei prou bo.\nAquests recursos són oferts pels orquestradors.\nAl mercar existeixen diferents eines per orquestrar els contenidors docker.\nLa Generalitat de Catalunya dóna suport als següents orquestradors:\n\n* AppAgile (basat en Openshift)\n* Kubernetes\n* SwarmMe (basat en Swarm)\n\nTot i que conceptualment tenen molts punts en comú, cadascun d'aquests orquestradors presenta components i maneres de treballar particulars.\nEn aquest article es defineix la manera de treballar i els components a utilitzar en cada orquestrador amb l'objectiu de minimitzar l'esforç necessari.\n\n## Aspectes bàsics\nEn un entorn productiu de contenidors, cal tenir present un conjunt d'aspectes més enllà dels propis contenidors.\nEls orquestradors ens ajudaran a assolir alguns dels següents aspectes.\n\n### Registre\nLes imatges de contenidors, un cop creades a partir del Dockerfile, cal repositar-les en un registre.\nDocker ofereix un registre públic amb imatges de tot tipus oferides per fabricants de productes i col·laboradors particulars. És el [Docker Hub](https://hub.docker.com/).\nPer repositar les imatges privades fruit dels diferents desenvolupaments de projectes, cal tenir un registre privat que només permeti accedir a les imatges als usuaris autoritzats.\n\n### Seguretat\nEls contenidors docker s'executen sobre el Docker Engine. Tot i que els contenidors són bastant segurs i cap a fora de la màquina on s'executen només exposen els ports que es defineixen al Dockerfile, si tenim diverses aplicacions, cadascuna amb diversos contenidors cal afegir una capa de seguretat entre elles.\nAddicionalment cal establir una capa de seguretat a la gestió de les diferents aplicacions de manera que cada aplicació pugui ser administrada per un tenant sense que altres tenants puguin accedir a ella. \n\n### Alta disponibilitat i escalat\nEls contenidors docker en si, no ofereixen alta disponibilitat. No està inclòs al concepte de contenidor. La idea per alta disponibilitat és realitzar escalat horitzontal de 2 o més contenidors idèntics.\nÉs necessari un component extern que controli el nombre de contenidors aixecats contínuament.\n\n### Balanceig\nQuan es disposen de més d'un contenidor d'un tipus, és necessari disposar d'un element que faci balanceig entre els diversos contenidors.\n\n### Serveis\nEls contenidors de docker s'exposen com a serveis a través de paràmetres a la comanda d'execució dels contenidors, mapejant ports interns del container amb ports externs del host. És necessària una capa addicional que permeti gestionar d'una manera una mica més àgil i flexible aquesta exposició.  \n\n### Enrutament\nAddicionalment al balanceig, és necessari disposar d'un element enrutador que permeti:\n\n* Configurar certificats SSL\n* Enrutar el transit entre diferents xarxes per oferir per exemple serveis només intranet o internet\n\n### Emmagatzematge\nL'emmagatzematge als contenidors s'estableix a través dels volums. És necessària una gestió addicional dels mateixos que ofereixin una millor granularitat a l'hora de proveir l'emmagatzematge des de diferents fonts.\n\n### Monitorizació de recursos i logs\nEls contenidors Docker normalment es configuren per a què els logs s'enviïn a la sortida estàndard. Quan existeix un volum elevat de containers, la monitorització es pot complicar molt. És necessària algun tipus d'eina que faciliti aquesta monitorització.\n\n### Quotes\nEls contenidors dockers, no tenen cap tipus de quota definida. Poden consumir tots els recursos de maquinari que requereixin. Per garantir l'estabilitat dels entorns productius, és necessari que hi hagi algun component que pugui limitar el consum de recursos de cada contenidor.\n\n### Desplegament\nActualment els cicles de vida de desenvolupament d'aplicacions van cap a models CI/CD i DevOps.\nLa Generalitat de Catalunya disposa de l'eina SIC per realitzar els desplegaments.\nSón necessàries eines que facilitin la integració d'un model de basat en contenidors amb eines de CI/CD com el SIC. \n\n## Comparativa entre orquestradors\n\n### Característiques\n\nAl següent diagrama es descriu:\n\n* Principals components de cada orquestrador\n* Correspondències entre els components de cada orquestrador\n* Components permesos a la Generalitat de Catalunya  \n\n![comparativa entre Orquestradors docker](/related/cloud/comparativaOrquestradors.png)\n\n## Descripció dels orquestradors\n### SwarmMe\nEstà basat en Swarm.\nSwarm és l'orquestrador oficial de docker. Actualment és el menys evolucionat dels tres.\nSwarmMe complementa alguna de les mancances que Swarm presenta (Registre, Sistema centralitzat de logs, eines de desplegament, ...)\n\nPer més informació podeu consultar https://docs.docker.com/engine/swarm/\n\n### Kubernetes\nVa ser creat per Google.\nActualment està evolucionant molt.\nRecentment ha rebut el suport oficial de docker.\n\nPer detalls i exemples podeu visitar la plana http://canigo.ctti.gencat.cat/cloud-caas/contenidors_kubernetes/\n\nPer més informació podeu consultar la web https://kubernetes.io/\n\n### AppAgile\nAppAgile està basat en Openshift Container Platform.\nDesenvolupat per Red Hat, basat en Kubernetes.\nAfegeix funcionalitat addicional a Kubernetes (gestió d'usuaris, segmentació de xarxa, sistema centralitzat de logs).\nAcostuma a portar un endarreriment respecte a l'última versió de kubernetes d'uns tres o quatre mesos.\n\nPer detalls i exemples podeu visitar la plana http://canigo.ctti.gencat.cat/cloud-caas/contenidors_appagile/\n\nPer més informació podeu consultar les webs http://appagile.io/ i https://docs.openshift.com/container-platform/3.5/\n\n## Imatges\nA l'hora de construir les imatges docker, cal tenir present els criteris definits per la Generalitat de Catalunya i que cada orquestrador, tot i que totes les plataformes es basen en docker, té les seves particularitats.\n\nA la plana [Criteris creació contenidors docker](http://canigo.ctti.gencat.cat/cloud-caas/dockerImages/) podeu trobar més informació al respecte. \n\n\n","objectID":"L2Nsb3VkLWNhYXMvb3JxdWVzdHJhZG9yc19jb250ZW5pZG9ycw=="},"L2Nsb3VkLWNhYXMvY29udGVuaWRvcnNfa3ViZXJuZXRlcw==":{"date":1550016000000,"title":"Contenidors Kubernetes","description":"Consideracions i exemples respecte els contenidors a Kubernetes","sections":"Container Cloud","weight":6,"categories":["cloud","docker","container","paas","kubernetes"],"path":"/cloud-caas/contenidors_kubernetes","content":"## Introducció\nKubernetes és un orquestrador desenvolupat inicialment per Google. Sembla que actualment és l'orquestrador que presenta més futur. Recentment ha rebut el suport oficial de Docker.\n\nEn aquest article es defineix l'arquitectura tipus d'una aplicació a Kubernetes i es proporcionen diversos exemples.\n\nA la Generalitat de Catalunya, actualment, Kubernetes està disponible a les següents plataformes:\n* IBM Bluemix al cloud públic. **Versió Kubernetes 1.12.5. Versió containerd 1.1.5**\n* IBM CaaS al cloud privat. **Versió Kubernetes 1.11.5. Versió docker 17.3.2**\n\n\n## Imatges\nA l'hora de construir les imatges docker, cal tenir present els criteris definits per la Generalitat de Catalunya i que Openshift, tot i que està basat en docker, té les seves particularitats.\n\nA la plana [Criteris creació contenidors docker](http://canigo.ctti.gencat.cat/cloud/dockerImages/) podeu trobar més informació al respecte. \n\n## Arquitectura\n### Conceptes bàsics\nL'arquitectura bàsica d'una aplicació a AppAgile és bàsicament la mateixa que la de Kubernetes, però amb algunes petites particularitats.\nA grans trets es poden distingir els següents components:\n\n* **Enrutador:** És el punt d'entrada i sortida del tràfic http/https de la plataforma i l'exterior. És responsable d'enrutar el tràfic a cada contenidor concret.\n* **Ruta:** És l'element de configuració on és defineix quin domini correspondrà a un Servei. Permet també la configuració del SSL. Informa a l'enrutador per a que aquest pugui redirigir el tràfic correctament.\n* **Servei:** És l'element de configuració que permet exposar un servei basat en contenidors dins de la plataforma Openshift. Permet mapping de ports\n* **Desplegament:** És l'element de configuració que defineix com es desplegaran els contenidors:\n\n    * Nombre de rèpliques\n    * Imatge a desplegar\n    * Polítiques de recàrrega\n    * Quotes\n    * Variables d'entorn\n    * Ports\n    * Emmagatzematge lògic\n    * Health checks\n    * ...\n\n* **Controlador:** És el component responsable de mantenir els contenidors sempre disponibles seguint els paràmetres configurats al Desplegament.\n* **Pod:** És el conjunt de contenidors que tenen el mateix cicle de vida i és necessari desplegar sempre conjuntament.\n* **Contenidor:** És el component mínim de la plataforma. És el contenidor docker.\n* **Petició d'emmagatzematge:** S'utilitza quan és necessari emmagatzematge persistent. És l'element de configuració que actua de pont entre l'emmagatzematge físic i l'emmagatzematge lògic.\n* **Emmagatzematge:** És l'element de configuració responsable de definir l'emmagatzematge físic.\n* **Secret:** És l'element de configuració responsable de gestionar els elements de configuració amb informació sensible, com poden ser contrasenyes.\n* **Mapa de configuració:** Permet agrupar múltiples variables de configuració. Seria equivalent a un fitxer de propietats en una aplicació.\n\n### Arquitectura Kubernetes\nA continuació es realitza la correlació entre els diferents components arquitectònics i els elements concrets a Kubernetes.\n\n  Component genèric |  Component Kubernetes | Observacions  |\n|:-----------------|:---------|:-----------|\n| Enrutador  |  Router | És gestionat per l'administrador de la plataforma. A nivell d'aplicació no és necessari configurar res.|\n| Ruta  |  Ingress | A nivell d'aplicació cal definir un fitxer yaml de configuració.|\n| Servei  |  Service | A nivell d'aplicació cal definir un fitxer yaml de configuració.|\n| Desplegament  |  Deployment | A nivell d'aplicació cal definir un fitxer yaml de configuració.|\n| Controlador  |  ReplicaSet | És generat directament pel Deployment. No és necessari configurar res.|\n| Pod  |  Pod | És generat directament pel ReplicationController. No és necessari configurar res.|\n| Contenidor  |  Container | És generat directament pel Pod. No és necessari configurar res.|\n| Petició d'emmagatzematge  |  PersistentVolumeClaim | A nivell d'aplicació cal definir un fitxer yaml de configuració.|\n| Emmagatzematge  |  PersistentVolume | És gestionat per l'administrador de la plataforma. A nivell d'aplicació no és necessari configurar res. Cal fer una petició al fer la sol·licitut inicial de recursos.|\n| Secret  | Secret | A nivell d'aplicació cal definir un fitxer yaml de configuració.|\n| Mapa de configuració  | ConfigMap | A nivell d'aplicació cal definir un fitxer yaml de configuració.|\n\n![Components Kubernetes](/related/cloud/ArquitecturaKubernetes.png)\n\n## Informació necessària al crear l'aplicació\nQuan és sol·licita la creació d'una aplicació a Kubernetes és necessària la següent informació:\n\n* **Unitats i mida de discos persistents** necessaris. Amb aquesta informació l'administrador de la plataforma crearà els PersistentVolume necessaris i farà arribar als responsables de l'aplicació el nom d'aquests Volums.\n* **Memòria RAM** total necessària per tots els contenidors de l'aplicació. Amb aquesta informació s'assignarà una CPU proporcional i es definiran les quotes globals de l'aplicació.\n## Exemples\n### PersistentVolumeClaim\nEn una aplicació el primer element que cal configurar és el PersistentVolumeClaim. Mapejarà PersistentVolume amb el volumes lògics que s'utilitzaran als pods.\n\nConfiguració de l'exemple:\n\n* Namespace del projecte: **XXXX-app1-data01-pre**\n* Nom del volum lògic: **XXXX-app1-data01-claim**\n* Mida del disc: **20Gb**\n\n```\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: XXXX-app1-data01-claim\n  namespace: XXXX-app1-pre\nspec:\n  accessModes:\n  - ReadWriteMany\n  resources:\n    requests:\n      storage: 20Gi\n```\n\n### Deployment\nEl Deployment és el principal element de configuració de l'aplicació.\n\nConfiguració de l'exemple:\n\n* Namespace del projecte: **XXXX-app1-data01-pre**\n* Nom de l'aplicació: **XXXX-app1-server**\n* Nom del deployment: **XXXX-app1-server-deployment**\n* Nombre de rèpliques: **2**\n* **El pod conté un únic contenidor**.\n* Estratègia de desplegament: **RollingUpdate**. No es recomana modificar, ni variar els seus paràmetres.\n* Quotes: **100 milicores de CPU** i **1024Mb de RAM**\n* Nom de la imatge dels contenidors: **XXXX-app1-pre/XXXX-app1-server:1.0.0**\n* Variables d'entorn dels contenidors:\n\n    * **ENV1_NAME** amb valor **env1_value**\n    * **ENV2_NAME** amb valor **env2_value**\n* Port del contenidor: **8080**\n* **readinessProbe** per identificar quan es pot començar a enviar peticions al contenidor.\n* **livenessProbe** per identificar quan cal reiniciar el contenidor.\n* Volum persistit: dins del contenidor es monta a **/data**. Fà referència al PersistentVolumeClaim anomenat **XXXX-app1-data01-claim** (creat a l'exemple anterior)\n* Nom del defaultToken: **default-token-rwj8z**\n\n```\napiVersion: apps/v1beta1\nkind: Deployment\nmetadata:\n  name: XXXX-app1-server-deployment\n  namespace: XXXX-app1-data01-pre\n  labels:\n    app: XXXX-app1-server\nspec:\n  replicas: 2\n  selector:\n    matchLabels:\n      app: XXXX-app1-server\n  strategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxSurge: 25%\n      maxUnavailable: 25%\n  minReadySeconds: 0\n  revisionHistoryLimit: 3       \n  template:\n    metadata:\n      labels:\n        app: XXXX-app1-server\n    spec:\n      containers:\n      - name: XXXX-app1-server\n        image: XXXX-app1-pre/XXXX-app1-server:1.0.0\n        resources:\n          limits:\n            cpu: 100m\n            memory: 1024Mi\n          requests:\n            cpu: 100m\n            memory: 1024Mi\n        imagePullPolicy: Always\n        env:\n        - name: ENV1_NAME\n          value: env1_value                       \n        - name: ENV2_NAME\n          value: env2_value                       \n        ports:\n        - containerPort: 8080\n        readinessProbe:\n          tcpSocket:\n            port: 8080\n          initialDelaySeconds: 5\n          periodSeconds: 10\n        livenessProbe:\n          httpGet:\n            path: /healthz\n            port: 8080\n            httpHeaders:\n            - name: X-Custom-Header\n              value: Awesome\n          initialDelaySeconds: 3\n          periodSeconds: 3      \n        volumeMounts:\n        - mountPath: /data\n          name: XXXX-app1-server\n        - mountPath: /var/run/secrets/kubernetes.io/serviceaccount\n          name: default-token-rwj8z\n          readOnly: true           \n      imagePullSecrets:\n        - name: uk-docker-registry-secret      \n      volumes:\n      - name: *XXXX-app1-server\n        persistentVolumeClaim:\n          claimName: XXXX-app1-data01-claim\n      - name: default-token-rwj8z\n        secret:\n          defaultMode: 420\n          secretName: default-token-rwj8z\n```\n\n### Service\nA l'exemple es crea un servei per el DeploymentConfig creat anteriorment.\n\nKubernetes suporta tant serveis amb protocol HTTP/HTTPS com  serveis amb altres tipus de protocols, com per exemple SSH, JDBC, ...\n\n#### Servei HTTP\nL'aplicació exposa un servei HTTP a través de la IP de l'Ingress.\nConfiguració de l'exemple:\n\n* Port exposat per servei: **80**\n* Port intern dels pods: **8080**\n\n```\napiVersion: v1\nkind: Service\nmetadata:\n  name: XXXX-app1-server\n  namespace: XXXX-app1-data01-pre\n  labels:\n    name: XXXX-app1-server\nspec:\n  ports:\n  - protocol: TCP\n    port: 80\n    targetPort: 8080\n  type: ClusterIP\n  selector:\n    app: XXXX-app1-server\n\n```\n\n#### Servei No HTTP\nL'aplicació exposa un servei no HTTP a través d'una IP pròpia.\nConfiguració de l'exemple:\n\n* Port exposat per servei: **3030**\n* Port intern dels pods: **3731**\n* IP on s'exposa el servei: **169.45.10.144**\n\n```\napiVersion: v1\nkind: Service\nmetadata:\n  labels:\n    name: XXXX-app1-server\n  name: XXXX-app1-data01-pre\n  namespace:  XXXX-app1-server\nspec:\n  ports:\n  - protocol: TCP\n    port: 3030\n    targetPort: 3731\n  selector:\n    app: XXXX-app1-server\n  type: LoadBalancer\n  loadBalancerIP: 169.45.10.144\n```\n\n\n### Ingress\nA l'exemple es crea una ruta pel servei creat anteriorment.\n\nConfiguració de l'exemple:\n\n* host: **app1-server.gencat.cat**\n\n```\napiVersion: extensions/v1beta1\nkind: Ingress\nmetadata:\n  name: app1-route\n  namespace: XXXX-app1-pre\nspec:\n  rules:\n  - host: app1-server.gencat.cat\n    http:\n      paths:\n      - path: /\n        backend:\n          serviceName: XXXX-app1-server\n          servicePort: 80   \n```\n\n\n## Informació relacionada\n\n* https://v1-12.docs.kubernetes.io/","objectID":"L2Nsb3VkLWNhYXMvY29udGVuaWRvcnNfa3ViZXJuZXRlcw=="},"L2Nsb3VkLWNhYXMvZW50b3Jucy1kZXY=":{"date":1550016000000,"title":"Entorns de desenvolupament","description":"Entorns de desenvolupament recomanats compatibles amb les Plataformes Cloud","sections":"Container Cloud","weight":7,"categories":["cloud","docker","container","paas"],"path":"/cloud-caas/entorns-dev","content":"## AppAgile\r\n\r\nPer les [Plataformes Cloud](http://canigo.ctti.gencat.cat/cloud/plataformes-cloud/) basades en OpenShift, es recomana utilitzar [Minishift](https://www.openshift.org/minishift/). La versió a instal·lar ha de ser compatible amb la versió d'OpenShift.\r\n\r\n**Plataforma Cloud**  | **Versió Openshift**   | **Versió Minishift compatible**\r\n------------ | ------------ | ------------\r\nCPD4 AppAgile (privat)  |  3.9.65  | v1.16.1 o superior\r\n\r\n## Bluemix - kubernetes\r\n\r\nEn el cas de Bluemix:\r\n\r\n* Per les [Plataformes Cloud](http://canigo.ctti.gencat.cat/cloud/plataformes-cloud/) basades en Kubernetes, es recomana utilitzar [Minikube](https://kubernetes.io/docs/getting-started-guides/minikube/)\r\n\r\nLa versió a instal·lar de Kubernetes i  Docker en entorns de desenvolupament, ha de ser compatible amb la versió utilitzada en les [Plataformes Cloud](http://canigo.ctti.gencat.cat/cloud/plataformes-cloud/).\r\n\r\n\r\n**Plataforma Cloud**  | **Versió Kubernetes**   |  **Versió Minikube**\r\n------------ | ------------ | ------------\r\nBluemix - Kubernetes  |  1.12.5  | 0.32 o superior\r\n\r\n## IBM CaaS\r\n\r\nEn el cas de IBM CaaS:\r\n\r\nPer les [Plataformes Cloud](http://canigo.ctti.gencat.cat/cloud/plataformes-cloud/) basades en Kubernetes, es recomana utilitzar [Minikube](https://kubernetes.io/docs/getting-started-guides/minikube/)\r\n\r\nLa versió a instal·lar de Kubernetes i Docker en entorns de desenvolupament, ha de ser compatible amb la versió utilitzada en les [Plataformes Cloud](http://canigo.ctti.gencat.cat/cloud/plataformes-cloud/).\r\n\r\n**Plataforma Cloud**  | **Versió Kubernetes**   |  **Versió Minikube**\r\n------------ | ------------ | ------------\r\nCaaS - Kubernetes  |  1.11.5  | 0.28.1 o superior\r\n\r\n## SwarmMe\r\n\r\nPer les Plataformes Cloud basades en Swarm, es recomana utilitzar  [docker-compose](https://docs.docker.com/compose/)\r\n\r\nLa versió a instal·lar de docker-compose en entorns de desenvolupament, ha de ser compatible amb la versió utilitzada en les [Plataformes Cloud](http://canigo.ctti.gencat.cat/cloud/plataformes-cloud/).\r\n\r\n**Plataforma Cloud**  | **Versió Docker**   | **Versió Docker-compose**\r\n------------ | ------------ | ------------\r\nCPD1 SwarmMe (privat)\t| 17.03.1-ce | 1.13.0\r\n\r\n","objectID":"L2Nsb3VkLWNhYXMvZW50b3Jucy1kZXY="},"L2Nsb3VkLWRiYWFzL2NhdGFsZWctZGJhYXM=":{"date":1550707200000,"title":"Elements del catàleg DBaaS","description":"Descripció dels elements DBaaS disponibles a la Generalitat de Catalunya.","sections":"Cloud","weight":1,"toc":true,"categories":["cloud","dbaas","compose","azure"],"path":"/cloud-dbaas/cataleg-dbaas","content":"Els DBaaS són serveis de bases de dades administrades al Cloud.\r\n\r\n## Cloud públic\r\n\r\nActualment, els nostres xPaaS disponibles al cloud públic són:\r\n\r\n- [Compose](https://www.compose.com/)\r\n- Azure database\r\n\r\n\r\n### Compose\r\n\r\nDins de la plataforma Compose, s'ofereixen les següents Bases de dades:\r\n\r\n- MongoDB\r\n- ElasticSearch\r\n- PostgreSQL\r\n- Redis\r\n\r\n### Azure\r\n\r\nDins de la plataforma Azure, s'ofereixen les següents Bases de dades:\r\n\r\n- SQL Server\r\n- PostgreSQL\r\n- MySQL\r\n\r\nA diferència de les bases de dades a contenidors, els DBaaS incorporen serveis de backups i gestió d'accés entre d'altres, a més de proporcionar un entorn en alta disponibilitat. És per aquest motiu que per entorns productius és recomanable el seu ús en lloc de bases de dades en contenidors.\r\n\r\n## Cloud privat\r\n\r\nActualment, els nostres xPaaS disponibles al cloud privat són:\r\n\r\n- AppAgile\r\n\r\n### AppAgile\r\n\r\nAppAgile ofereix Bases de Dades basades en contenidors administrades per CPD4.\r\n\r\nActualment s'ofereixen les següents Bases de dades:\r\n\r\n- PostgreSQL\r\n- MySQL","objectID":"L2Nsb3VkLWRiYWFzL2NhdGFsZWctZGJhYXM="},"L2Nsb3VkLWlhYXMvbW9uaXRvcml0YXRnZS1pYWFz":{"date":1551052800000,"title":"Monitoratge i traces a les plataformes IaaS","description":"Informació per accedir al monitoratge i traces a les diferents plataformes IaaS.","sections":"IaaS Cloud","weight":3,"categories":["cloud","iaas","azure"],"path":"/cloud-iaas/monitoritatge-iaas","content":"Dins del marc de la metodologia DevOps, s'ofereixen a lot d'aplicacions un conjunt d'eines per a que monitorin i tinguin accés a les traces de les diferents plataformes IaaS.\r\n\r\nA continuació es descriuen les diferents eines a cadascuna de les plataformes disponibles.\r\n\r\n## Azure\r\n\r\nAl desplegar una aplicació a Azure, es proporciona a lot d'aplicacions permisos de **lectura** del seu projecte pels usuaris GICAR que sol·liciti.\r\n\r\n### Monitoratge\r\n\r\nDes de la [consola d'Azure](https://portal.azure.com/), és tindrà accés de lectura de les diferents aplicacions.\r\n\r\nDes d'allà es pot consultar de cada Grup de recursos la següent informació:\r\n\r\n- Configuració dels diferents elements:\r\n  - Maquines virtuals\r\n  - Xarxa\r\n  - Security Groups\r\n  - Balancejadors\r\n  - IP's\r\n  - ...\r\n- Mètriques de consum de recursos del les màquines virtuals amb una retenció de 30 dies.\r\n\r\n### Logs\r\n\r\nDes de la consola d'Azure es poden veure els següents logs:\r\n\r\n- Logs d'arrancada de les màquines virtuals.\r\n- Logs del sistema operatiu.\r\n\r\nLa gestió dels logs d'aplicacions, al tractar-se d'un entorn IaaS on només es gestiona la infraestructura i no les aplicacions dependrà del lot d'aplicacions.\r\n","objectID":"L2Nsb3VkLWlhYXMvbW9uaXRvcml0YXRnZS1pYWFz"},"L2Nsb3VkLXhwYWFzL2NhdGFsZWcteHBhYXM=":{"date":1550707200000,"title":"Elements del catàleg xPaaS","description":"Descripció dels elements xPaaS disponibles a la Generalitat de Catalunya.","sections":"Cloud","weight":1,"toc":true,"categories":["cloud","xpaas","ibmcloud","azure","cloudfoundry"],"path":"/cloud-xpaas/cataleg-xpaas","content":"Els xPaaS són runtimes d'execució estàndards i, segons el \"gust\" sobre el que treballem, tindrà denominacions diferents. Anomenarem a tots d'aquesta manera per a unificar conceptes. Actualment, els nostres xPaaS disponibles són:\r\n\r\n- IBMCloud Runtimes\r\n- Azure App Services\r\n\r\n## IBMCloud Runtimes\r\n\r\nBasat en [Cloudfoundry.](https://www.cloudfoundry.org/)\r\nUtilitza uns elements anomenats **Buildpacks** per definir la tecnologia de xPaaS.\r\n\r\nExisteixen molt buildpack diferents. Els més utilitzats són:\r\n\r\n- Liberty for Java\r\n- Node.js\r\n- Go\r\n- PHP\r\n- Python\r\n- Ruby\r\n- Static site (Nginx)\r\n\r\n## Azure  App Services\r\n\r\nSuporta les següents tecnologies en plataforma Windows:\r\n\r\n- .NET\r\n- Java\r\n- Node.js\r\n- PHP \r\n- Python\r\n\r\nSuporta les següents tecnologies en plataforma Linux:\r\n\r\n- .NET Core\r\n- Node.js\r\n- PHP \r\n- Ruby\r\n","objectID":"L2Nsb3VkLXhwYWFzL2NhdGFsZWcteHBhYXM="},"L2Nsb3VkLWlhYXMvY2F0YWxlZy1pYWFz":{"date":1550707200000,"title":"Elements del catàleg IaaS","description":"Descripció dels elements IaaS disponibles a la Generalitat de Catalunya.","sections":"IaaS Cloud","weight":1,"categories":["cloud","iaas","azure"],"path":"/cloud-iaas/cataleg-iaas","content":"Els IaaS són màquines virtuals al Cloud.\r\n\r\nDins dels elements de catàleg, només recomanem el seu ús si la resta d'elements no encaixen: desenvolupament complexos basats en productes que no funcionen en contenidors o buildpacks.\r\n\r\n## Cloud públic\r\n\r\nActualment, els nostres IaaS disponibles al cloud públic són:\r\n\r\n- [Azure](https://azure.microsoft.com)\r\n\r\n\r\n### Azure\r\n\r\nDins de la plataforma Azure, s'ofereixen multiples elements de catàleg, entre els quals destaquen les màquines Virtuals.\r\n\r\nEn cas d'existir la necessitat d'algun element en particular, cal fer una petició d'avaluació a l'equip de Suport Cloud per afegir-lo al catàleg.\r\n\r\n## Cloud privat\r\n\r\nEls IaaS del cloud privat basats en VMWare es tracten com entorns on-premise. ","objectID":"L2Nsb3VkLWlhYXMvY2F0YWxlZy1pYWFz"},"L2Nsb3VkLXhwYWFzL2ludGVncmFjaW8teHBhYXMtc2lj":{"date":1550793600000,"title":"Integració d'aplicacions xPaaS a SIC","description":"Informació respecte a la integració d'aplicacions basades en xPaaS amb el SIC.","sections":"xPaaS Cloud","weight":3,"categories":["cloud","IBMCloud","cloudfoundry","sic"],"path":"/cloud-xpaas/integracio-xpaas-sic","content":"## Informació necessària per la integració amb SIC\r\n\r\n### IBMCloud BuildPacks\r\n\r\n- Nom del repositori git del codi font.\r\n- En cas de necessitats de compilació, requeriments i instruccions al respecte.\r\n- Llista de correus electrònics en cas de notificacions de Jenkins.\r\n- Informació relativa a la construcció de les metadades de desplegament:\r\n  - Buildpack que s'utilitzarà al xPaaS.\r\n  - Nom de l'aplicació\r\n  - Memòria necessària\r\n  - Disc necessari\r\n  - Nombre d'instàncies\r\n  - Path de l'artefacte\r\n  - Serveis que s'utilitzaran\r\n  - Variables d'entorn\r\n  - Domini\r\n\r\n### Altres xPaaS\r\n\r\nPendent de definir.\r\n\r\n## Tasques disponibles al SIC per projectes xPaaS\r\n\r\n### IBMCloud BuildPacks\r\n\r\nPer plataformes basades en BuildPacks d'IBMCloud, al SIC estan disponibles les següents tasques:\r\n\r\n- Desplegament\r\n- Reinici\r\n- Parada\r\n- Arrancada\r\n\r\n### Altres xPaaS\r\n\r\nLa integració amb SIC no està disponible.\r\n\r\nPodeu trobar més informació del SIC a [Servei d'Integració Contínua.](https://canigo.ctti.gencat.cat/sic/)","objectID":"L2Nsb3VkLXhwYWFzL2ludGVncmFjaW8teHBhYXMtc2lj"},"L2Nsb3VkLWlhYXMvY29uc2lkZXJhY2lvbnMtaWFhcw==":{"date":1550534400000,"title":"Consideracions generals en plataformes IaaS","description":"Consideracions generals a tenir present en els aplicacions desplegades a plataformes IaaS","sections":"IaaS Cloud","weight":2,"categories":["cloud","iaas","azure"],"path":"/cloud-iaas/consideracions-iaas","content":"* Només és recomanable utilitzar plataforms IaaS en cas de que l'aplicació no encaixi en un model CaaS o PaaS:\r\n\r\n  * Productes\r\n  * Arquitectures poc estandards\r\n  * ...\r\n\r\n* L'accés a les màquines virtuales es realitzarà sempre a través d VPN.\r\n* No es podrà tenir accés a cap recurs de la plataforma directament a través internet. Caldrà sempre exposar els servei a través de la capa de Balanceig i segurerat definida a la plataforma.  ","objectID":"L2Nsb3VkLWlhYXMvY29uc2lkZXJhY2lvbnMtaWFhcw=="},"L2Nsb3VkLXhwYWFzL2NvbnNpZGVyYWNpb25zLWRlc3BsZWdhbWVudA==":{"date":1550793600000,"title":"Consideracions en desplegaments a XPaaS","description":"Consideracions generals a tenir present en desplegaments sobre plataformes xPaaS","sections":"xPaaS Cloud","weight":2,"categories":["cloud","cloudfoundry","ibmcloud"],"path":"/cloud-xpaas/consideracions-desplegament","content":"Al desplegar una aplicació a les diferents plataformes xPaaS cal tenir present una sèrie de consideracions.\r\nAlgunes apliquen a qualsevol plataforma, altres apliquen a plataformes en concret.\r\n\r\n- **Tots els desplegaments a IBMCloud Buildpack es faran via SIC**\r\n- En un desplegament a una plataforma xPaaS es poden identificar quatre blocs clarament diferenciats:\r\n\r\n  - **Custòdia del codi font**. És comú a totes les aplicacions.\r\n  - **Construcció dels artefactes de l'aplicació**. És comú a totes les aplicacions.\r\n  - **Construcció de les metadades de desplegament**. És un pas addicional que no és present en el desplegament d'aplicacions tradicional.\r\n  - **Desplegament pròpiament dit**. Tot i que és comú a totes les aplicacions, desplegar als xPaaS presenta certes particularitats que cal tenir present.\r\n\r\n## Custòdia del codi font\r\n\r\nEls artefactes destinats a ser desplegats. Es construiran a partir de codi font repositat al [Servei de custòdia de codi font del SIC.](https://canigo.ctti.gencat.cat/sic-serveis/scm/)\r\n\r\n**Es crearà un projecte/repositori diferent per cada component que sigui desplegat.**\r\n\r\n**En cas de generar llibreries que seran compartides per diferents aplicacions es crearà un projecte/repositori per cadascuna d'elles.**\r\n\r\n## Construcció dels artefactes\r\n\r\nÉs important notar que **l'artefacte desplegat serà el mateix a tots els entorns**, això implica que la definició de les propietats específiques de l'entorn han d'estar definides en variables d'entorn.\r\n\r\nNotar la necessitat de definir la versió de l'artefacte utilitzant el fitxer **sic.yml** a la carpeta **sic**, amb la propietat **version** que defineix la versió del artefacte/imatge.\r\n\r\nAddicionalment a la definició manual de la versió de l'artefacte, en desenvolupaments basats en **maven** es pot generar la versió automàticament a partir de la versió definida al **pom.xml**. Es pot trobar més informació a l'article [Integració d'una aplicació Canigó a SIC 2.0](https://canigo.ctti.gencat.cat/howtos/2017-12-howto-integracio_canigo_sic/)\r\n\r\nLa construcció de l'artefacte es realitzarà al SIC.\r\n\r\nCal proporcionar a l'equip de Sic/Suport Cloud les instruccions necessàries, incloent-hi les eines i versions, per construir els artefactes a desplegar.\r\n\r\nPodeu trobar més informació a [Integració d'aplicacions xPaaS a SIC](https://canigo.ctti.gencat.cat/cloud-xpaas/integracio-xpaas-sic/)\r\n\r\n## Construcció de fitxers de metadades de desplegament\r\n\r\nLes metadades de desplegament defineixen propietats i configuracions necessàries a l'hora de desplegar a la plataforma xPaaS.\r\n\r\nLa construcció dels fitxers de metadades es realitzarà al SIC a partir de la informació proporcionada pel lot d'aplicacions.\r\n\r\n### IBMCloud BuildPacks\r\n\r\nInformació necessaria:\r\n\r\n- Buildpack que s'utilitzarà al PaaS.\r\n- Nom de l'aplicació\r\n- Memòria necessària\r\n- Disc necessari\r\n- Nombre d'instàncies\r\n- Path de l'artefacte\r\n- Serveis que s'utilitzaran\r\n- Variables d'entorn\r\n- Domini\r\n\r\n### Altres plataformes\r\n\r\nEn l'actualitat el procés de creació de metadades via SIC no està implementat i es realitzarà manualment per part de l'equip de Suport Cloud.\r\n\r\n## Desplegament\r\n\r\n### IBMCloud BuildPacks\r\n\r\nEl desplegament a la plataforma xPaaS d'IBMCloud es realizarà via SIC.\r\nNo és necessària cap informació addicional més enllà de l'artefacte i les metadades de desplegament.\r\n\r\n### Altres plataformes\r\n\r\nEn l'actualitat el desplegament via SIC no està implementat i es realitzarà manualment per part de l'equip de Suport Cloud.\r\n","objectID":"L2Nsb3VkLXhwYWFzL2NvbnNpZGVyYWNpb25zLWRlc3BsZWdhbWVudA=="},"L2Nsb3VkX29sZC9jYXRhbGVn":{"date":1541548800000,"title":"Elements del catàleg","description":"Docker, xPaaS, DBaaS","sections":"Container Cloud","weight":2,"toc":true,"categories":["cloud","docker","container","paas"],"path":"/cloud_old/cataleg","content":"L'objectiu del \"Container Cloud\" - anomenarem així a les solucions basades en containers (CaaS, Containers as a Service) a cloud públic i privat - , es disposar d'una sèrie d'elements que ens permetin fer córrer el nostre software sobre entorns d'execució \"commodity\", sense conèixer la infraestructura subjacent.\r\n\r\nEn aquest sentit, treballarem amb dos elements principals - xPaaS i Docker - i amb altres solucions com a servei -com algunes bases de dades-:\r\n\r\n## **xPaaS**\r\n\r\nEls xPaaS són runtimes d'execució estàndards i, segons el \"gust\" sobre el que treballem, tindrà denominacions diferents. Anomenarem a tots d'aquesta manera per a unificar conceptes. Actualment, els nostres xPaaS es basaran en Cloud Foundry: \r\n\r\n- **buildpack** (Cloud Foundry), disponible a **cloud públic**\r\n\t* Liberty for Java\r\n\t* Node.js\r\n\t* Go\r\n\t* PHP\r\n\t* Python\r\n\t* Ruby\r\n\t* Static site (Nginx)\r\n\r\n\r\n\r\n### Configuració de l'engine\r\n\r\nCada xPaaS dona suport a diferents versions de l'engine que ha d'executar el codi. Posem com a exemple el [buildpack Node.js de Cloud Foundry](https://github.com/cloudfoundry/nodejs-buildpack). Per tal de configurar la versió 8.x de l'engine de Node.js corresponent a la versió actual CTTI del [full de ruta](https://qualitat.solucions.gencat.cat/estandards/estandard-full-ruta-programari/), cal fer la següent configuració en el fitxer \"package.json\" ubicat a l'arrel de l'aplicació:\r\n\r\n_package.json_\r\n\r\n```\r\n{\r\n\tname: \"AppDemoNodeJS\",\r\n\tversion: \"0.0.1\",\r\n\tprivate: true,\r\n\tscripts: {\r\n\t\tstart: \"node app.js\",\r\n\t\ttest: \"make test\"\r\n\t},\r\n\tengines: {\r\n\t\tnode: \"8.11.1\"\r\n\t},\r\n\tdependencies: {\r\n\t\texpress: \"^4.16.3\",\r\n\t\t...\r\n\t},\r\n\tdevDependencies: {\r\n\t\tmocha: \"^5.2.0\",\r\n\t\t...\r\n\t}\r\n}\r\n```\r\n\r\nCom es pot observar, en la secció engines cal especificar la versió exacte de Node.js amb que volem que s'executi l'aplicació. En cas que no s'especifiqui, el buildpack executarà la versió per defecte que tingui establerta. En el cas del buildpack Node.js de Cloud Foundry coincideix amb la versió que hem indicat en el descriptor \"package.json\" de l'aplicació:\r\n\r\n_manifest.yml_ (veure a [Github](https://github.com/cloudfoundry/nodejs-buildpack/blob/master/manifest.yml))\r\n\r\n```\r\nlanguage: nodejs\r\ndefault_versions:\r\n- name: node\r\n  version: 8.11.1\r\n...\r\n```\r\n\r\n## **Contenidors (Docker)**\r\n\r\nEn quant als contenidors Docker, estan alineades les versions del software del [Full de Ruta de Programari](https://qualitat.solucions.gencat.cat/estandards/estandard-full-ruta-programari/) amb les versions dels contenidors certificats per CTTI. Podeu trobar aquestes imatges certificades al [registre privat](https://docker-registry.ctti.extranet.gencat.cat). Si necessiteu més informació d'aquest registre privat podeu consultar [Registre docker privat](http://canigo.ctti.gencat.cat/cloud/dockerRegistry/).\r\n\r\n**Element**  | **Versió**   | **Imatge Docker**   | **Codi font**\r\n------------ | ------------ |-------------------- |-----------\r\nApache \t\t | 2.4    | docker-registry.ctti.extranet.gencat.cat/gencatcloud/httpd:2.4   | [httpd](https://git.intranet.gencat.cat/3048-intern/imatges-docker/httpd/tree/2.4)\r\nApache GICAR Shibboleth| 1.0.3    |docker-registry.ctti.extranet.gencat.cat/gencatcloud/gicar-shibboleth:1.0.3   | [gicar-shibboleth](https://git.intranet.gencat.cat/3048-intern/imatges-docker/gicar-shibboleth/tree/1.0.3)\r\nApache GICAR Shibboleth Kubernetes/Openshift| 1.0.3    |docker-registry.ctti.extranet.gencat.cat/gencatcloud/gicar-shibboleth-openshift:1.0.3   | [gicar-shibboleth-openshift](https://git.intranet.gencat.cat/3048-intern/imatges-docker/gicar-shibboleth-openshift/tree/1.0.3)\r\nApache Proxy ElasticSearch  \t | 2.4-1.0   |docker-registry.ctti.extranet.gencat.cat/gencatcloud/httpd-proxy-es:2.4-1.0   | [httpd-proxy-es](https://git.intranet.gencat.cat/3048-intern/imatges-docker/httpd-proxy-es/tree/2.4-1.0)\r\nNginx  \t | 1.12   |docker-registry.ctti.extranet.gencat.cat/gencatcloud/nginx:1.12   | [nginx](https://git.intranet.gencat.cat/3048-intern/imatges-docker/nginx/tree/1.12)\r\nNginx  \t | 1.14   |docker-registry.ctti.extranet.gencat.cat/gencatcloud/nginx:1.14   | [nginx](https://git.intranet.gencat.cat/3048-intern/imatges-docker/nginx/tree/1.14)\r\nJava\t\t | 7  | docker-registry.ctti.extranet.gencat.cat/gencatcloud/java:7   | [java](https://git.intranet.gencat.cat/3048-intern/imatges-docker/java/tree/7)\r\nJava\t\t | 8  | docker-registry.ctti.extranet.gencat.cat/gencatcloud/java:8   | [java](https://git.intranet.gencat.cat/3048-intern/imatges-docker/java/tree/8)\r\nMySql \t\t | 5.7   |docker-registry.ctti.extranet.gencat.cat/gencatcloud/mysql:5.7   | [mysql](https://git.intranet.gencat.cat/3048-intern/imatges-docker/mysql/tree/5.7)\r\nNodeJS \t\t | 6   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/node:6   | [node](https://git.intranet.gencat.cat/3048-intern/imatges-docker/node/tree/6)\r\nNodeJS \t\t | 8   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/node:8   | [node](https://git.intranet.gencat.cat/3048-intern/imatges-docker/node/tree/8)\r\nNodeJS \t\t | 10   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/node:10   | [node](https://git.intranet.gencat.cat/3048-intern/imatges-docker/node/tree/10)\r\nPHP \t\t | 7.1   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/apache-php:7.1   | [apache-php](https://git.intranet.gencat.cat/3048-intern/imatges-docker/apache-php/tree/7.1)\r\nPHP \t\t | 7.2   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/apache-php:7.2   | [apache-php](https://git.intranet.gencat.cat/3048-intern/imatges-docker/apache-php/tree/7.2)\r\nPostgres\t | 10.5   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/postgres:10.5   | [postgres](https://git.intranet.gencat.cat/3048-intern/imatges-docker/postgres/tree/10.5)\r\nTomcat  \t | 9.0-java8   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/tomcat:9.0-java8   | [tomcat](https://git.intranet.gencat.cat/3048-intern/imatges-docker/tomcat/tree/9.0-java8)\r\nMaven builder  \t | 1.0-3.5.3-8   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/maven-builder:1.0-3.5.3-8   | [maven builder](https://git.intranet.gencat.cat/3048-intern/imatges-docker/maven-builder/tree/1.0-3.5.3-8)\r\nMaven builder  \t | 1.0-3.6-8   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/maven-builder:1.0-3.6-8   | [maven builder](https://git.intranet.gencat.cat/3048-intern/imatges-docker/maven-builder/tree/1.0-3.6-8)\r\nNpm builder  \t | 1.0-4-2.15   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/npm-builder:1.0-4-2.15  | [npm builder](https://git.intranet.gencat.cat/3048-intern/imatges-docker/npm-builder/tree/1.0-4-2.15)\r\nNpm builder  \t | 1.0-6-3.10   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/npm-builder:1.0-6-3.10  | [npm builder](https://git.intranet.gencat.cat/3048-intern/imatges-docker/npm-builder/tree/1.0-6-3.10)\r\nNpm builder  \t | 1.0-8-5.6    | docker-registry.ctti.extranet.gencat.cat/gencatcloud/npm-builder:1.0-8-5.6   | [npm builder](https://git.intranet.gencat.cat/3048-intern/imatges-docker/npm-builder/tree/1.0-8-5.6 )\r\nNpm builder  \t | 1.0-8-6.4   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/npm-builder:1.0-8-6.4  | [npm builder](https://git.intranet.gencat.cat/3048-intern/imatges-docker/npm-builder/tree/1.0-8-6.4)\r\nNpm builder  \t | 1.0-10-6.4    | docker-registry.ctti.extranet.gencat.cat/gencatcloud/npm-builder:1.0-10-6.4   | [npm builder](https://git.intranet.gencat.cat/3048-intern/imatges-docker/npm-builder/tree/1.0-10-6.4 )\r\n<br>\r\n**IMPORTANT**: De cara a minimitzar les vulnerabilitats de les aplicacions, es recomana que periòdicament els proveïdors d'aplicacions les reconstrueixin utilitzant aquestes imatges Docker certificades més actualitzades. Per realitzar aquestes tasques de construcció i desplegament s'ha de fer ús de les corresponents pipelines al Jenkins del SIC.\r\n<br>\r\n\r\nLa llista anterior no exclou que no es puguin lliurar contenidors que corrin altres productes i personalitzacions. En qualsevol cas, les imatges construïdes passaran per un servei d'avaluació de vulnerabilitats per a garantir en una primera instància la qualitat de les mateixes.\r\n\r\nPer construir contenidors personalitzats, cal tenir present els [Criteris creació contenidors docker](https://canigo.ctti.gencat.cat/cloud/dockerImages/).\r\n\r\nMés informació sobre Docker: https://www.docker.com/\r\n\r\n### Bases de dades a contenidors\r\n\r\nLes bases de dades a contenidors no disposen de cap servei com backups o gestió d'usuaris. El proveïdor d'aplicacions haurà de fer-se càrrec d'aquests serveis.\r\n\r\nTampoc ofereix un entorn en alta disponibilitat. És una modalitat no recomanada per entorns productius.\r\n\r\n## **Contenidors (Docker) Obsolets**\r\n\r\n**Aquest contenidors són obsolets/no suportats i no tenen manteniment. Poden contenir vulnerabilitats i no està recomanat el seu ús.** \r\n\r\n**En cas d'utilitzar aquestes imatges es recomana l'actualització a les imatges suportades.**\r\n\r\n**Element**  | **Versió**   | **Imatge Docker**   | **Codi font**\r\n------------ | ------------ |-------------------- |-----------\r\nApache \t\t | 2.2    | docker-registry.ctti.extranet.gencat.cat/gencatcloud/httpd:2.2   | [httpd](https://git.intranet.gencat.cat/3048-intern/imatges-docker/httpd/tree/2.2)\r\nApache GICAR Shibboleth| 1.0    |No disponible   | [gicar-shibboleth](https://git.intranet.gencat.cat/3048-intern/imatges-docker/gicar-shibboleth/tree/1.0)\r\nApache GICAR Shibboleth| 1.0.1    |No disponible   | [gicar-shibboleth](https://git.intranet.gencat.cat/3048-intern/imatges-docker/gicar-shibboleth/tree/1.0.1)\r\nApache GICAR Shibboleth| 1.0.2    |docker-registry.ctti.extranet.gencat.cat/gencatcloud/gicar-shibboleth:1.0.2   | [gicar-shibboleth](https://git.intranet.gencat.cat/3048-intern/imatges-docker/gicar-shibboleth/tree/1.0.2)\r\nApache GICAR Shibboleth Kubernetes/Openshift| 1.0    |docker-registry.ctti.extranet.gencat.cat/gencatcloud/gicar-shibboleth-openshift:1.0   | [gicar-shibboleth-openshift](https://git.intranet.gencat.cat/3048-intern/imatges-docker/gicar-shibboleth-openshift/tree/1.0)\r\nApache GICAR Shibboleth Kubernetes/Openshift| 1.0.1    |docker-registry.ctti.extranet.gencat.cat/gencatcloud/gicar-shibboleth-openshift:1.0.1   | [gicar-shibboleth-openshift](https://git.intranet.gencat.cat/3048-intern/imatges-docker/gicar-shibboleth-openshift/tree/1.0.1)\r\nApache GICAR Shibboleth Kubernetes/Openshift| 1.0.2    |docker-registry.ctti.extranet.gencat.cat/gencatcloud/gicar-shibboleth-openshift:1.0.2   | [gicar-shibboleth-openshift](https://git.intranet.gencat.cat/3048-intern/imatges-docker/gicar-shibboleth-openshift/tree/1.0.2)\r\nApache GICAR Openshift| 1.0   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/gicar-openshift:1.0   | No disponible\r\nApache Proxy ElasticSearch  \t | 1.0   |No disponible   | [httpd-proxy-es](https://git.intranet.gencat.cat/3048-intern/imatges-docker/httpd-proxy-es/tree/1.0)\r\nApache Proxy ElasticSearch  \t | 1.1   |No disponible   | [httpd-proxy-es](https://git.intranet.gencat.cat/3048-intern/imatges-docker/httpd-proxy-es/tree/1.1)\r\nApache Proxy ElasticSearch  \t | 2.2-1.0   |docker-registry.ctti.extranet.gencat.cat/gencatcloud/httpd-proxy-es:2.2-1.0   | [httpd-proxy-es](https://git.intranet.gencat.cat/3048-intern/imatges-docker/httpd-proxy-es/tree/2.2-1.0)\r\nApache Proxy ElasticSearch  \t | 2.2-1.1   |docker-registry.ctti.extranet.gencat.cat/gencatcloud/httpd-proxy-es:2.2-1.1   | [httpd-proxy-es](https://git.intranet.gencat.cat/3048-intern/imatges-docker/httpd-proxy-es/tree/2.2-1.1)\r\nHttpd Proxy ElasticSearch  \t | 0.1   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/httpd22-proxy-es:0.1   | No disponible\r\nHttpd Proxy ElasticSearch  \t | 1.0   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/httpd22-proxy-es:1.0   | [httpd-proxy-es](https://git.intranet.gencat.cat/3048-intern/imatges-docker/httpd22-proxy-es/tree/1.0)\r\nHttpd Proxy ElasticSearch  \t | 1.1   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/httpd22-proxy-es:1.1   | [httpd-proxy-es](https://git.intranet.gencat.cat/3048-intern/imatges-docker/httpd22-proxy-es/tree/1.1)\r\nHttpd Proxy ElasticSearch  \t | release-1.0   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/httpd22-proxy-es:release-1.0   | [httpd-proxy-es](https://git.intranet.gencat.cat/3048-intern/imatges-docker/httpd22-proxy-es/tree/1.0)\r\nHttpd Proxy ElasticSearch  \t | release-1.1   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/httpd22-proxy-es:release-1.1   | [httpd-proxy-es](https://git.intranet.gencat.cat/3048-intern/imatges-docker/httpd22-proxy-es/tree/1.1)\r\nNginx  \t | 1.10.3   |docker-registry.ctti.extranet.gencat.cat/gencatcloud/nginx:1.10.3   | [nginx](https://git.intranet.gencat.cat/3048-intern/imatges-docker/nginx/tree/1.10.3)\r\nHAProxy\t\t | 1.2.1        | docker-registry.ctti.extranet.gencat.cat/gencatcloud/haproxy:1.2.1   | [haproxy](https://git.intranet.gencat.cat/3048-intern/imatges-docker/haproxy/tree/1.2.1)\r\nHAProxy\t\t | 1.5.1        | docker-registry.ctti.extranet.gencat.cat/gencatcloud/haproxy:1.5.1   | [haproxy](https://git.intranet.gencat.cat/3048-intern/imatges-docker/haproxy/tree/1.5.1)\r\nMongoDB \t | 3.2   |docker-registry.ctti.extranet.gencat.cat/gencatcloud/mongodb:3.2   | [mongodb](https://git.intranet.gencat.cat/3048-intern/imatges-docker/mongodb/tree/3.2)\r\nMongoDB \t | 3.4   |docker-registry.ctti.extranet.gencat.cat/gencatcloud/mongodb:3.4   | [mongodb](https://git.intranet.gencat.cat/3048-intern/imatges-docker/mongodb/tree/3.4)\r\nMongoDB \t | 3.6   |docker-registry.ctti.extranet.gencat.cat/gencatcloud/mongodb:3.6   | [mongodb](https://git.intranet.gencat.cat/3048-intern/imatges-docker/mongodb/tree/3.6)\r\nNodeJS \t\t | 4  | docker-registry.ctti.extranet.gencat.cat/gencatcloud/node:4   | [node ](https://git.intranet.gencat.cat/3048-intern/imatges-docker/node/tree/4)\r\nNodeJS \t\t | 4.8 (1)  | docker-registry.ctti.extranet.gencat.cat/gencatcloud/node:4.8   | [node ](https://git.intranet.gencat.cat/3048-intern/imatges-docker/node/tree/4.8)\r\nNodeJS \t\t | 6.12  | docker-registry.ctti.extranet.gencat.cat/gencatcloud/node:6.12   | [node ](https://git.intranet.gencat.cat/3048-intern/imatges-docker/node/tree/6.12)\r\nNodeJS \t\t | 6.14 (2)  | docker-registry.ctti.extranet.gencat.cat/gencatcloud/node:6.14   | [node ](https://git.intranet.gencat.cat/3048-intern/imatges-docker/node/tree/6.14)\r\nNodeJS \t\t | 8.9  | docker-registry.ctti.extranet.gencat.cat/gencatcloud/node:8.9   | [node ](https://git.intranet.gencat.cat/3048-intern/imatges-docker/node/tree/8.9)\r\nNodeJS \t\t | 8.12 (3)  | docker-registry.ctti.extranet.gencat.cat/gencatcloud/node:8.12   | [node ](https://git.intranet.gencat.cat/3048-intern/imatges-docker/node/tree/8.12)\r\nNodeJS \t\t | 10.13 (4)  | docker-registry.ctti.extranet.gencat.cat/gencatcloud/node:10.13   | [node ](https://git.intranet.gencat.cat/3048-intern/imatges-docker/node/tree/10.13)\r\nPHP \t\t | 5.6   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/apache-php:5.6   | [apache-php](https://git.intranet.gencat.cat/3048-intern/imatges-docker/apache-php/tree/5.6)\r\nPostgres\t | 9.3    | docker-registry.ctti.extranet.gencat.cat/gencatcloud/postgres:9.3   | [postgres](https://git.intranet.gencat.cat/3048-intern/imatges-docker/postgres/tree/9.3)\r\nPostgres\t | 9.6    | docker-registry.ctti.extranet.gencat.cat/gencatcloud/postgres:9.6   | [postgres](https://git.intranet.gencat.cat/3048-intern/imatges-docker/postgres/tree/9.6)\r\nTomcat  \t | 7   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/tomcat:7   | [tomcat](https://git.intranet.gencat.cat/3048-intern/imatges-docker/tomcat/tree/7)\r\nTomcat  \t | 8.0-java7   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/tomcat:8.0-java7   | [tomcat](https://git.intranet.gencat.cat/3048-intern/imatges-docker/tomcat/tree/8.0-java7)\r\nTomcat  \t | 8.0   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/tomcat:8.0   | [tomcat](https://git.intranet.gencat.cat/3048-intern/imatges-docker/tomcat/tree/8.0)\r\nTomcat  \t | 8.5   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/tomcat:8.5   | [tomcat](https://git.intranet.gencat.cat/3048-intern/imatges-docker/tomcat/tree/8.5)\r\nSftp  \t | 1.0   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/sftp:1.0   | [sftp](https://git.intranet.gencat.cat/3048-intern/imatges-docker/sftp/tree/1.0)\r\nNpm builder  \t | 1.0-2.15.11   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/npm-builder:1.0-2.15.11  | [npm builder](https://git.intranet.gencat.cat/3048-intern/imatges-docker/npm-builder/tree/1.0-2.15.11)\r\nNpm builder  \t | 1.0-3.10.10   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/npm-builder:1.0-3.10.10  | [npm builder](https://git.intranet.gencat.cat/3048-intern/imatges-docker/npm-builder/tree/1.0-3.10.10)\r\nNpm builder  \t | 1.0-5.6.0   | docker-registry.ctti.extranet.gencat.cat/gencatcloud/npm-builder:1.0-5.6.0  | [npm builder](https://git.intranet.gencat.cat/3048-intern/imatges-docker/npm-builder/tree/1.0-5.6.0)\r\n\r\n\r\n### Notes:\r\n\r\n* (1) renombrat a a node:4\r\n* (2) renombrat a a node:6\r\n* (3) renombrat a a node:8\r\n* (4) renombrat a a node:10\r\n\r\n## SaaS\r\n\r\n### DBaaS - Base de dades com a servei\r\n\r\n- MongoDB, disponible a **cloud públic**\r\n- ElasticSearch, disponible a **cloud públic**\r\n- PostgreSQL, disponible a **cloud públic**\r\n- SQLServer, disponible a **cloud públic**\r\n- MySQL, disponible a **cloud públic**\r\n\r\nA diferència de les bases de dades a contenidors, els DBaaS si que incorporen serveis de backups i gestió d'accés entre d'altres, a més de proporcionar un entorn en alta disponibilitat. És per aquest motiu que per entorns productius és recomanable el seu ús enlloc de bases de dades en contenidors.\r\n","objectID":"L2Nsb3VkX29sZC9jYXRhbGVn"},"L2Nsb3VkX29sZC9hcQ==":{"date":1462924800000,"title":"Arquitectures tipus","description":"Exemples d'arquitectures","sections":"Container Cloud","weight":5,"toc":true,"categories":["cloud","docker","container","paas"],"path":"/cloud_old/aq","content":"## Introducció\r\n\r\n### Docker-compose\r\n\r\nEls diferents stacks tecnològics descrits en aquesta plana utilitzen [Docker Compose](https://docs.docker.com/compose/).\r\n\r\n#### Desplegament en entorns de desenvolupament\r\n\r\nCal haver [instal·lat](https://docs.docker.com/compose/install/) prèviament Docker Compose.\r\n\r\n## Stack \"tradicional\" JEE\r\n\r\n![Spring](/related/cloud/spring.png \"Spring\") ![JSF](/related/cloud/jsf.jpg \"JSF\")\r\n\r\nAplicació JSF (Java Server Faces) amb context \"/AppJava\" per separació contingut estàtic i dinàmic.\r\n\r\n<div class=\"message warning\">\r\n<b>Avís</b>\r\n<br>\r\nAquest és un stack que ja no s'hauria d'utilitzar per noves aplicacions.\r\n</div>\r\n\r\nPodeu trobar el codi font d'aquesta demo a [Github](https://github.com/gencat/demo-JEE-AppJava).\r\n\r\nComandes per iniciar l'aplicació:\r\n\r\n```\r\n$ git clone https://github.com/gencat/demo-JEE-AppJava.git demo-JEE-AppJava\r\n$ cd demo-JEE-AppJava\r\n$ mvn package\r\n$ docker-compose -f ./src/main/docker/docker-compose.yml up -d\r\n```\r\nAbans d'executar la última comanda és necessari modificar el fitxer \"docker-compose.yml\" ubicat al directori \"demo-JEE-AppJava/src/main/docker\":\r\n\r\n_docker-compose.yml_\r\n```\r\ngicar:\r\n build: ./gicarAppJava/\r\n links:\r\n  - demo\r\n ports:\r\n  - 80:80\r\n environment:\r\n  PS_IP: 169.50.103.27\r\n  AgentConfigDocker: a6-demoFORM\r\n  ContainerHostName: [nom del contenidor]\r\n  AGENTNAME: a6-demoform,[nom de domini.gencat.cat]\r\n  HCOGICAR: a6\r\n  GICARUSER: registre\r\n  GICARPWD: registre\r\n  APPSERVER_PORT_8080_TCP_ADDR: demo\r\n  APPSERVER_PORT_8080_TCP_PORT: 8080 \r\n  context: canigoJSF\r\n volumes:\r\n  - /home/canigo/demo-JEE-AppJava/target/canigoJSF-static:/var/www/html/canigoJSF\r\ndb:\r\n  build: ./bbdd/\r\n  ports:\r\n    - 3306:3306\r\n  environment:\r\n    MYSQL_USER : user\r\n    MYSQL_PASSWORD : password\r\n    MYSQL_ROOT_PASSWORD: root\r\n    MYSQL_DATABASE: demo\r\n  volumes:\r\n   - /home/canigo/demo-JEE-AppJava/mysql-datadir:/var/lib/mysql\r\ndemo:\r\n  build: ./app/\r\n  links:\r\n    - db:mybbdd\r\n  volumes:\r\n   - /home/canigo/demo-JEE-AppJava/target/canigoJSF-dynamic:/opt/tomcat/webapps/canigoJSF\r\n  ports:\r\n   - 8080:8080\r\n   - 8000:8000\r\n```\r\nEls paths \"/home/canigo/...\" han d'adaptar-se als locals.\r\n\r\n- _canigoJSF-static_: directori amb el contingut estàtic de l'aplicació\r\n- _canigoJSF-dynamic_: directori amb el contingut dinàmic de l'aplicació\r\n- _mysql-datadir_: directori amb les dades del MySQL. Es crearà amb tot el contingut en iniciar per primera vegada l'aplicació\r\n\r\n<div class=\"message information\">\r\n<b>Informació</b>\r\n<br>\r\nEl valor \"nom del contenidor\" i el \"nom de domini\" els tria l'usuari. Per exemple:<br><br>\r\n<i>ContainerHostName</i>: dev<br>\r\n<i>AGENTNAME</i>: a6-demoform, provademo.gencat.cat<br><br>\r\nEn cas de voler accedir per domini en comptes de localhost, s'ha de mappejar aquest domini/ip al fitxer host\r\n(En linux /etc/host, en Windows C:\\Windows\\System32\\drivers\\etc\\hosts)\r\n</div>\r\n\r\nEn cas de voler reconstruir les imatges, cal afegir la opció \"--build\" a la comanda \"docker-compose up\":\r\n\r\n```\r\n$ docker-compose -f ./src/main/docker/docker-compose.yml up -d --build\r\n```\r\n\r\nAccedir des d'un navegador web a http://localhost/canigoJSF i introduïr l'usuari \"NIFDEMO\" i contrasenya \"12345678\". Els contenidors triguen a aixecar-se entre 30s i 60s, i per tant, cal esperar a realitzar l'accés aquest temps ja que en cas contrari l'aplicació no respondrà.\r\n\r\n## Stack \"arquitectura moderna\" JEE\r\n\r\n![Spring](/related/cloud/springboot.png \"Spring Boot\") ![Resftul API](/related/cloud/resftulapi.jpg \"Resftul API\") ![HTML5 JS CSS](/related/cloud/htmljscss.png \"HTML5 JS CSS\")\r\n\r\nAplicació basada en serveis REST i presentació desacoblada\r\n\r\nPodeu trobar el codi font d'aquesta demo a [Github](https://github.com/gencat/demo-JEE-REST).\r\n\r\nComandes per iniciar l'aplicació:\r\n\r\n```\r\n$ git clone https://github.com/gencat/demo-JEE-REST.git demo-JEE-REST\r\n$ cd demo-JEE-REST\r\n$ mvn package\r\n$ docker-compose -f ./src/main/docker/docker-compose.yml up -d\r\n```\r\n\r\nAbans d'executar la última comanda és necessari modificar el fitxer \"docker-compose.yml\" ubicat al directori \"demo-JEE-REST/src/main/docker\":\r\n\r\n_docker-compose.yml_\r\n```\r\nlb:\r\n image: docker-registry.ctti.extranet.gencat.cat/gencatcloud/haproxy:1.5.1\r\n links:\r\n  - bookstore\r\n ports:\r\n  - 80:80\r\ndb:\r\n  image: docker-registry.ctti.extranet.gencat.cat/gencatcloud/postgres:9.6\r\n  ports:\r\n    - 5432:5432\r\n  environment:\r\n    POSTGRES_USER: demospringboot\r\n    POSTGRES_PASSWORD: password\r\n  volumes:\r\n    - /home/canigo/demo-JEE-REST/postgres-datadir:/var/lib/postgresql/data\r\nbookstore:\r\n  build: ./app/\r\n  links:\r\n    - db:postgres\r\n  volumes:\r\n   - /home/canigo/demo-JEE-REST/target/:/tmp\r\n  ports:\r\n    - 8080:8080\r\n    - 8000:8000\r\n  command: bash -c \"/wait-for-it.sh postgres:5432 -t 240 && /entrypoint.sh\"\r\n```\r\n\r\nEl paths “/home/canigo/…” han d’adaptar-se als locals.\r\n\r\n- /home/canigo/demo-JEE-REST/target/: directori on es troba el war de l'aplicació\r\n- /home/canigo/demo-JEE-REST/postgres-datadir: directori amb les dades del Postgres. Es crearà amb tot el contingut en iniciar per primera vegada l'aplicació.\r\n\r\nEn cas de voler reconstruir les imatges, cal afegir la opció \"--build\" a la comanda \"docker-compose up\":\r\n\r\n```\r\n$ docker-compose -f ./src/main/docker/docker-compose.yml up -d --build\r\n```\r\n\r\nAccedir des d'un navegador web a http://localhost/ i introduïr l'usuari \"admin\" i contrasenya \"admin\". Els contenidors triguen a aixecar-se entre 30s i 60s, i per tant, cal esperar a realitzar l'accés aquest temps ja que en cas contrari s'obtindrà un error \"503 Service Unavailable\".\r\n\r\n## Stack MEAN\r\n\r\n![MEAN](/related/cloud/stack_mean.png \"MEAN\")\r\n\r\nAplicació basada en MongoDB+Express+AngularJS+NodeJS\r\n\r\nPodeu trobar el codi font d'aquesta demo a [Github](https://github.com/gencat/demo-MEAN).\r\n\r\nComandes per iniciar l'aplicació:\r\n\r\n```\r\n$ git clone https://github.com/gencat/demo-MEAN.git demo-MEAN\r\n$ cd demo-MEAN\r\n$ docker-compose -f ./docker/docker-compose.yml up -d\r\n```\r\n\r\nAbans d'executar la última comanda és necessari modificar el fitxer \"docker-compose.yml\" ubicat al directori \"demo-MEAN/docker\":\r\n\r\n_docker-compose.yml_\r\n```\r\ndb:\r\n  image: docker-registry.ctti.extranet.gencat.cat/gencatcloud/mongodb:3.2\r\n  ports:\r\n    - 27017:27017\r\n    - 28017:28017\r\n  environment:\r\n    MONGODB_USER : user\r\n    MONGODB_PASS : password\r\n    MONGODB_DATABASE : contactlist\r\n  volumes:\r\n    - /home/canigo/demo-MEAN/datadir:/data/db\r\ndemo:\r\n  image: docker-registry.ctti.extranet.gencat.cat/gencatcloud/node:4.8\r\n  links:\r\n    - db:mybbdd\r\n  volumes:\r\n   - /home/canigo/demo-MEAN:/app\r\n  ports:\r\n   - 3000:3000\r\n  command: bash -c \"cd /app && npm install && node server\"\r\n```\r\n\r\nEl paths “/home/canigo/…” han d’adaptar-se als locals.\r\n\r\nEn cas de voler reconstruir les imatges, cal afegir la opció \"--build\" a la comanda \"docker-compose up\":\r\n\r\n```\r\n$ docker-compose -f ./docker/docker-compose.yml up -d --build\r\n```\r\n\r\nAccedir a http://localhost:3000/.\r\n\r\n## Stack LAMP \r\n\r\n![LAMP](/related/cloud/lamp.gif \"LAMP\")\r\n\r\nAplicació basada en Linux+PHP+MySQL\r\n\r\nPodeu trobar el codi font d'aquesta demo a [Github](https://github.com/gencat/demo-LAMP).\r\n\r\nComandes per iniciar l'aplicació:\r\n\r\n```\r\n$ git clone https://github.com/gencat/demo-LAMP.git demo-LAMP\r\n$ cd demo-LAMP\r\n$ docker-compose -f ./docker/docker-compose.yml up -d\r\n```\r\n\r\nAbans d'executar la última comanda és necessari modificar el fitxer \"docker-compose.yml\" ubicat al directori \"demo-LAMP/docker\":\r\n\r\n_docker-compose.yml_\r\n```\r\ndb:\r\n  build: ./bbdd/\r\n  ports:\r\n    - 3306:3306\r\n  environment:\r\n    MYSQL_USER : user\r\n    MYSQL_PASSWORD : password\r\n    MYSQL_ROOT_PASSWORD: root\r\n    MYSQL_DATABASE: demo\r\n  volumes:\r\n   - /home/canigo/demo-LAMP/mysql-datadir:/var/lib/mysql\r\ndemo:\r\n  build: ./app/\r\n  links:\r\n    - db:mybbdd\r\n  volumes:\r\n   - /home/canigo/demo-LAMP:/var/www/html/demo-LAMP\r\n  ports:\r\n   - 80:80\r\n```\r\n\r\nEl paths “/home/canigo/…” han d’adaptar-se als locals.\r\n\r\nEn cas de voler reconstruir les imatges, cal afegir la opció \"--build\" a la comanda \"docker-compose up\":\r\n\r\n```\r\n$ docker-compose -f ./docker/docker-compose.yml up -d --build\r\n```\r\n\r\nAccedir a http://localhost/demo-LAMP/.\r\n\r\n## Altres\r\n\r\nA més de contenidors Docker, també és possible utilitzar xPaaS i DBaaS. Aquests són alguns casos d'èxit:\r\n\r\n### xPaaS + DBaaS\r\n\r\n- Exemple d'aplicació: http://serveisoberts.gencat.cat\r\n- Desplegat a plataforma Cloud Foundry de IBM Bluemix\r\n- Composat per:\r\n\t- Buildpack: NodeJS\r\n\t- DBaaS: MongoDB\r\n\r\n### Docker aplicació + Docker base de dades\r\n\r\n- Exemple d'aplicació: https://jocdelsdrets.gencat.cat\r\n- Desplegat a cluster Kubernetes a IBM Bluemix\r\n- Composat per:\r\n\t- Docker PHP per a la capa d'aplicació\r\n\t- Contenidor MySQL per a la capa de base de dades\r\n","objectID":"L2Nsb3VkX29sZC9hcQ=="},"L2Nsb3VkX29sZC8yMDE4LTA1LTI4LUNMT1VELU9QUy1DbG91ZA==":{"date":1529107200000,"title":"Cloud. Tasques OPS del desenvolupament al Cloud","description":"En aquest article es descriuen les tasques OPS del model DEVOPS aplicat als entorns cloud GENCAT.","sections":"Container Cloud","weight":2,"toc":true,"categories":["cloud","docker","container","kubernetes"],"key":"JUNY2018","path":"/cloud_old/2018-05-28-CLOUD-OPS-Cloud","content":"# Tasques OPS del desenvolupament al Cloud\n\nDins del paradigma de desplegament al Container Cloud, l'equip de desenvolupament ha d'assumir certes tasques que en el model \"On Premise\" son pròpies de l'operativa de CPD.\n\n![Cloud devops](https://canigo.ctti.gencat.cat/drafts/cloud_devops.JPG)\n\nLes pròpies tecnologies utilitzades en el catàleg cloud com contenidors, i el desplegament en clouds públics fora del NUS, porta implícita l'assumpció de la responsabilitat de la configuració i el manteniment i securització de tots els elements que componen un desenvolupament. Les pricipals noves tasques que l'equip de desenvolupament haurà d'assumir es poden agrupar en les següents categories.\n\n## Disponibilitat de l’aplicació\nL'equip de desenvolupament ha de definir la parametrització a nivell de monitorització dels elements disponibles dins de la plataforma cloud que s'utilitzi (llindars d'alarmes, helth checks, etc) així com les necessitats de backup per a la seva recuperació i la seva implementació.\n\n## Monitorització de la infraestructura\nL'equip de desenvolupament té accés a la monitorització i defineix els mecanismes per a garantir la disponibilitat dels elements de l'aplicació, i assigna a un nou equip si no s'és autonom en la resolució de la disponibilitat.\n\n## Dimensionament d’una aplicació\nL'equip de desenvolupament ha de dimensionar l'aplicació i el seu creixement en totes les seves vessants, inclouent qualsevol element facturable per ús tal com el consum de xarxa.\n\n## Indicadors tècnics\nL'equip de desenvolupament disposarà de les eines i visibilitat suficient per a extreure els indicadors de rendiment, capacitat i de cost de la seva aplicació.\n\n## Seguretat de l’aplicació\nL'equip de desenvolupament defineix i gestiona la seguretat a nivell no únicament de codi, sinó de Middleware, SO i xarxa. És també responsable de la monitorització dels accessos i de garantir la seguretat d'aquests.\n\n## Gestió del canvi\nL'equip de desenvolupament ha de garantir la vigència no únicament del codi, sinó de també dels Middlewares i SO utilitzats.\n\n## Desplegament de l’aplicació\nL'equip de desenvolupament inclou en el desplegament l'aplicació, el Middleware, la parametrització del middlware i el SO amb la seva parametrització.\n\n## Resposta davant incidències\nL'equip de desenvolupament serà el primer receptor de les incidències i peticions i tindrà les eines per a poder-les resoldre en la seva majoria. Havent d'escalar únicament aquelles que impliquin validació de cost per part del departament o incidències de plataforma. Aquest fet implica que l'aplicació ha d'estar configurada per tal de que la gran majoria de tasques associades a incidències estiguin automatitzades.\n","objectID":"L2Nsb3VkX29sZC8yMDE4LTA1LTI4LUNMT1VELU9QUy1DbG91ZA=="},"L2Nsb3VkX29sZC9jb250ZW5pZG9yc19hcHBhZ2lsZQ==":{"date":1550016000000,"title":"Contenidors AppAgile","description":"Consideracions i exemples respecte els contenidors a AppAgile","sections":"Container Cloud","weight":7,"categories":["cloud","docker","container","paas","openshift","appagile"],"path":"/cloud_old/contenidors_appagile","content":"## Introducció\nAppAgile és un orquestrador d'imatges docker basat en Openshift que addicionalment està basat en Kubernetes. La versió actual d'AppAgile es basa concretament en la versió **OpenShift Container Platform 3.9.65 i Kubernetes 1.9.1.**\n\nEn aquest article es defineix l'arquitectura tipus d'una aplicació a AppAgile i es proporcionen diversos exemples.\n\n## Imatges\nA l'hora de construir les imatges docker, cal tenir present els criteris definits per la Generalitat de Catalunya i que Openshift, tot i que està basat en docker, té les seves particularitats.\n\nA la plana [Criteris creació contenidors docker](http://canigo.ctti.gencat.cat/cloud/dockerImages/) podeu trobar més informació al respecte. \n\n## Arquitectura\n### Conceptes bàsics\nL'arquitectura bàsica d'una aplicació a AppAgile és bàsicament la mateixa que la de Kubernetes, però amb algunes petites particularitats.\nA grans trets es poden distingir els següents components:\n\n* **Enrutador:** És el punt d'entrada i sortida del tràfic http/https de la plataforma i l'exterior. És responsable d'enrutar el tràfic a cada contenidor concret.\n* **Ruta:** És l'element de configuració on és defineix quin domini correspondrà a un Servei. Permet també la configuració del SSL. Informa a l'enrutador per a que aquest pugui redirigir el tràfic correctament.\n* **Servei:** És l'element de configuració que permet exposar un servei basat en contenidors dins de la plataforma Openshift. Permet mapping de ports\n* **Desplegament:** És l'element de configuració que defineix com es desplegaran els contenidors:\n\n    * Nombre de rèpliques\n    * Imatge a desplegar\n    * Polítiques de recàrrega\n    * Quotes\n    * Variables d'entorn\n    * Ports\n    * Emmagatzematge lògic\n    * Health checks\n    * ...\n\n* **Controlador:** És el component responsable de mantenir els contenidors sempre disponibles seguint els paràmetres configurats al Desplegament.\n* **Pod:** És el conjunt de contenidors que tenen el mateix cicle de vida i és necessari desplegar sempre conjuntament.\n* **Contenidor:** És el component mínim de la plataforma. És el contenidor docker.\n* **Petició d'emmagatzematge:** S'utilitza quan és necessari emmagatzematge persistent. És l'element de configuració que actua de pont entre el emmagatzematge físic i l'emmagatzematge lògic.\n* **Emmagatzematge:** És l'element de configuració responsable de definir l'emmagatzematge físic.\n* **Secret:** És l'element de configuració responsable de gestionar els elements de configuració amb informació sensible, com poden ser contrasenyes.\n* **Mapa de configuració:** Permet agrupar múltiples variables de configuració. Seria equivalent a un fitxer de propietats en una aplicació.\n\n### Arquitectura AppAgile\nA continuació es realitza la correlació entre els diferents components arquitectònics i els elements concrets a AppAgile i Openshift.\n\n  Component genèric |  Component AppAgile | Observacions  |\n|:-----------------|:---------|:-----------|\n| Enrutador  |  Router | És gestionat per l'administrador de la plataforma. A nivell d'aplicació no és necessari configurar res.|\n| Ruta  |  Route | A nivell d'aplicació cal definir un fitxer yaml de configuració.|\n| Servei  |  Service | A nivell d'aplicació cal definir un fitxer yaml de configuració.|\n| Desplegament  |  DeploymentConfig | A nivell d'aplicació cal definir un fitxer yaml de configuració.|\n| Controlador  |  ReplicationController | És generat directament pel DeploymentConfig. No és necessari configurar res.|\n| Pod  |  Pod | És generat directament pel ReplicationController. No és necessari configurar res.|\n| Contenidor  |  Container | És generat directament pel Pod. No és necessari configurar res.|\n| Petició d'emmagatzematge  |  PersistentVolumeClaim | A nivell d'aplicació cal definir un fitxer yaml de configuració.|\n| Emmagatzematge  |  PersistentVolume | És gestionat per l'administrador de la plataforma. A nivell d'aplicació no és necessari configurar res. Cal fer una petició al fer la sol·licitut inicial de recursos.|\n| Secret  | Secret | A nivell d'aplicació cal definir un fitxer yaml de configuració.|\n| Mapa de configuració  | ConfigMap | A nivell d'aplicació cal definir un fitxer yaml de configuració.|\n\n![Components Openshift](/related/cloud/ArquitecturaOpenshift.png)\n\n## Informació necessària al crear l'aplicació\nQuan és sol·licita la creació d'una aplicació a AppAgile és necessària la següent informació:\n\n* **Unitats i mida de discos persistents** necessaris. Amb aquesta informació l'administrador de la plataforma crearà els PersistentVolume necessaris i farà arribar als responsables de l'aplicació el nom d'aquests Volums.\n* **Memòria RAM** total necessaria per tots els contenidors de l'aplicació. Amb aquesta informació s'assignarà una CPU proporcional i es definiran les quotes globals de l'aplicació.\n## Exemples\n### PersistentVolumeClaim\nEn una aplicació el primer element que cal configurar és el PersistentVolumeClaim. Mapejarà PersistentVolume amb el volumes lògics que s'utilitzaran als pods.\n\nTenint present que el PersistentVolume s'anomena per exemple **XXXX-app1-data01-pre** el fitxer yaml seria:\n\n```\napiVersion: v1\nkind: List\nitems:\n- apiVersion: v1\n  kind: PersistentVolumeClaim\n  metadata:\n    name: XXXX-app1-data01-claim\n  spec:\n    accessModes:\n      - ReadWriteOnce\n    resources:\n      requests:\n        storage: 1Gi\n    volumeName: XXXX-app1-data01-pre\n```\n\n### DeploymentConfig\nEl DeploymentConfig és el principal element de configuració de l'aplicació.\n\nConfiguració de l'exemple:\n\n* Nom del projecte: **XXXX-app1-pre**\n* Nom de l'aplicació: **XXXX-app1-server**\n* Nom del deploymentConfig: **XXXX-app1-server-deployment**\n* Nombre de rèpliques: **2**\n* **El pod conté un únic contenidor**.\n* Estratègia de desplegament: **Rolling**. No es recomana modificar, ni variar els seus paràmetres.\n* Quotes: **100 milicores de CPU** i **1024Mb de RAM**\n* Nom de la imatge dels contenidors: **XXXX-app1-pre/XXXX-app1-server:1.0.0**\n* Variables d'entorn dels contenidors:\n\n    * **ENV1_NAME** amb valor **env1_value**\n    * **ENV2_NAME** amb valor **env2_value**\n* Port del contenidor: **8080**\n* **readinessProbe** per identificar quan es pot començar a enviar peticions al contenidor.\n* **livenessProbe** per identificar quan cal reiniciar el contenidor.\n* Volum persistit: dins del contenidor es monta a **/data**. Fà referència al PersistentVolumeClaim anomenat **XXXX-app1-data01-claim** (creat a l'exemple anterior)\n\n```\napiVersion: v1\nkind: List\nitems:\n- apiVersion: v1\n  kind: DeploymentConfig\n  metadata:\n    labels:\n      app: XXXX-app1-server\n    name: XXXX-app1-server-deployment\n  spec:\n    replicas: 2\n    selector:\n      app: XXXX-app1-server\n      deploymentconfig: XXXX-app1-server-deployment\n    strategy:\n      type: Rolling\n      rollingParams:\n        updatePeriodSeconds: 1\n        intervalSeconds: 1\n        timeoutSeconds: 600\n        maxUnavailable: 25%\n        maxSurge: 25%    \n      resources:\n        limits:\n            cpu: 0\n            memory: 0\n        requests:\n            cpu: 0\n            memory: 0\n    template:\n      metadata:\n        labels:\n          app: XXXX-app1-server\n          deploymentconfig: XXXX-app1-server-deployment\n      spec:\n        containers:\n        - image: XXXX-app1-pre/XXXX-app1-server:1.0.0\n          name: XXXX-app1-server\n          env:\n          - name: ENV1_NAME\n            value: env1_value\n          - name: ENV2_NAME\n            value: env2_value            \n          ports:\n          - containerPort: 8080\n            protocol: TCP\n          resources:\n            limits:\n                cpu: 100m\n                memory: 1024Mi\n            requests:\n                cpu: 100m\n                memory: 1024Mi\n          readinessProbe:\n            httpGet:\n                path: /healthz\n                port: 8080\n            initialDelaySeconds: 15\n            timeoutSeconds: 1\n          livenessProbe:\n            tcpSocket:\n                port: 8080\n            initialDelaySeconds: 15\n            timeoutSeconds: 1                                              \n          volumeMounts:\n              - name: XXXX-app1-server-volume\n                mountPath: /data\n        terminationGracePeriodSeconds: 60                \n        volumes:\n          - name: XXXX-app1-server-volume\n            persistentVolumeClaim:\n              claimName: XXXX-app1-data01-claim           \n    test: false\n    triggers:\n    - type: ConfigChange\n    - imageChangeParams:\n        automatic: true\n        containerNames:\n        - XXXX-app1-server\n        from:\n          kind: ImageStreamTag\n          name: XXXX-app1-server:1.0.0\n          namespace: XXXX-app1-pre\n      type: ImageChange\n```\n\n### Service\nA l'exemple es crea un servei per el DeploymentConfig creat anteriorment.\n\nAppAgile només suporta serveis amb protocol HTTP/HTTPS, no suporta altres protocols, com per exemple SSH, JDBC, ...\n\nConfiguració de l'exemple:\n\n* Port exposat per servei: **80**\n* Port intern dels pods: **8080**\n\n```\napiVersion: v1\nkind: List\nitems:\n- apiVersion: v1\n  kind: Service\n  metadata:\n    labels:\n      app: XXXX-app1-server\n    name: XXXX-app1-server\n  spec:\n    ports:\n    - name: 80-tcp\n      port: 80\n      protocol: TCP\n      targetPort: 8080\n    selector:\n      app: XXXX-app1-server\n      deploymentconfig:  XXXX-app1-server-deployment\n```\n\n### Route\nA l'exemple es crea una ruta pel servei creat anteriorment.\n\nConfiguració de l'exemple:\n\n* host: **app1-server.gencat.cat**\n\n```\napiVersion: v1\nkind: Route\nmetadata:\n  name: app1-route\n  namespace: XXXX-app1-pre\n  labels:\n    app: app1-server\nspec:\n  host: app1-server.gencat.cat\n  to:\n    kind: Service\n    name:  XXXX-app1-server\n    weight: 100\n  port:\n    targetPort: 80-tcp\n  wildcardPolicy: None\n```\n\n\n## Informació relacionada\n\n* http://appagile.io/\n* https://docs.openshift.com/container-platform/3.9/","objectID":"L2Nsb3VkX29sZC9jb250ZW5pZG9yc19hcHBhZ2lsZQ=="},"L2Nsb3VkX29sZC9jb250ZW5pZG9yc19rdWJlcm5ldGVz":{"date":1550016000000,"title":"Contenidors Kubernetes","description":"Consideracions i exemples respecte els contenidors a Kubernetes","sections":"Container Cloud","weight":7,"categories":["cloud","docker","container","paas","kubernetes"],"path":"/cloud_old/contenidors_kubernetes","content":"## Introducció\nKubernetes és un orquestrador desenvolupat inicialment per Google. Sembla que actualment és l'orquestrador que presenta més futur. Recentment ha rebut el suport oficial de Docker.\n\nEn aquest article es defineix l'arquitectura tipus d'una aplicació a Kubernetes i es proporcionen diversos exemples.\n\nA la Generalitat de Catalunya, actualment, Kubernetes està disponible a les següents plataformes:\n* IBM Bluemix al cloud públic. **Versió Kubernetes 1.12.5. Versió containerd 1.1.5**\n* IBM CaaS al cloud privat. **Versió Kubernetes 1.11.5. Versió docker 17.3.2**\n\n\n## Imatges\nA l'hora de construir les imatges docker, cal tenir present els criteris definits per la Generalitat de Catalunya i que Openshift, tot i que està basat en docker, té les seves particularitats.\n\nA la plana [Criteris creació contenidors docker](http://canigo.ctti.gencat.cat/cloud/dockerImages/) podeu trobar més informació al respecte. \n\n## Arquitectura\n### Conceptes bàsics\nL'arquitectura bàsica d'una aplicació a AppAgile és bàsicament la mateixa que la de Kubernetes, però amb algunes petites particularitats.\nA grans trets es poden distingir els següents components:\n\n* **Enrutador:** És el punt d'entrada i sortida del tràfic http/https de la plataforma i l'exterior. És responsable d'enrutar el tràfic a cada contenidor concret.\n* **Ruta:** És l'element de configuració on és defineix quin domini correspondrà a un Servei. Permet també la configuració del SSL. Informa a l'enrutador per a que aquest pugui redirigir el tràfic correctament.\n* **Servei:** És l'element de configuració que permet exposar un servei basat en contenidors dins de la plataforma Openshift. Permet mapping de ports\n* **Desplegament:** És l'element de configuració que defineix com es desplegaran els contenidors:\n\n    * Nombre de rèpliques\n    * Imatge a desplegar\n    * Polítiques de recàrrega\n    * Quotes\n    * Variables d'entorn\n    * Ports\n    * Emmagatzematge lògic\n    * Health checks\n    * ...\n\n* **Controlador:** És el component responsable de mantenir els contenidors sempre disponibles seguint els paràmetres configurats al Desplegament.\n* **Pod:** És el conjunt de contenidors que tenen el mateix cicle de vida i és necessari desplegar sempre conjuntament.\n* **Contenidor:** És el component mínim de la plataforma. És el contenidor docker.\n* **Petició d'emmagatzematge:** S'utilitza quan és necessari emmagatzematge persistent. És l'element de configuració que actua de pont entre el emmagatzematge físic i l'emmagatzematge lògic.\n* **Emmagatzematge:** És l'element de configuració responsable de definir l'emmagatzematge físic.\n* **Secret:** És l'element de configuració responsable de gestionar els elements de configuració amb informació sensible, com poden ser contrasenyes.\n* **Mapa de configuració:** Permet agrupar múltiples variables de configuració. Seria equivalent a un fitxer de propietats en una aplicació.\n\n### Arquitectura Kubernetes\nA continuació es realitza la correlació entre els diferents components arquitectònics i els elements concrets a Kubernetes.\n\n  Component genèric |  Component Kubernetes | Observacions  |\n|:-----------------|:---------|:-----------|\n| Enrutador  |  Router | És gestionat per l'administrador de la plataforma. A nivell d'aplicació no és necessari configurar res.|\n| Ruta  |  Ingress | A nivell d'aplicació cal definir un fitxer yaml de configuració.|\n| Servei  |  Service | A nivell d'aplicació cal definir un fitxer yaml de configuració.|\n| Desplegament  |  Deployment | A nivell d'aplicació cal definir un fitxer yaml de configuració.|\n| Controlador  |  ReplicaSet | És generat directament pel Deployment. No és necessari configurar res.|\n| Pod  |  Pod | És generat directament pel ReplicationController. No és necessari configurar res.|\n| Contenidor  |  Container | És generat directament pel Pod. No és necessari configurar res.|\n| Petició d'emmagatzematge  |  PersistentVolumeClaim | A nivell d'aplicació cal definir un fitxer yaml de configuració.|\n| Emmagatzematge  |  PersistentVolume | És gestionat per l'administrador de la plataforma. A nivell d'aplicació no és necessari configurar res. Cal fer una petició al fer la sol·licitut inicial de recursos.|\n| Secret  | Secret | A nivell d'aplicació cal definir un fitxer yaml de configuració.|\n| Mapa de configuració  | ConfigMap | A nivell d'aplicació cal definir un fitxer yaml de configuració.|\n\n![Components Kubernetes](/related/cloud/ArquitecturaKubernetes.png)\n\n## Informació necessària al crear l'aplicació\nQuan és sol·licita la creació d'una aplicació a Kubernetes és necessària la següent informació:\n\n* **Unitats i mida de discos persistents** necessaris. Amb aquesta informació l'administrador de la plataforma crearà els PersistentVolume necessaris i farà arribar als responsables de l'aplicació el nom d'aquests Volums.\n* **Memòria RAM** total necessaria per tots els contenidors de l'aplicació. Amb aquesta informació s'assignarà una CPU proporcional i es definiran les quotes globals de l'aplicació.\n## Exemples\n### PersistentVolumeClaim\nEn una aplicació el primer element que cal configurar és el PersistentVolumeClaim. Mapejarà PersistentVolume amb el volumes lògics que s'utilitzaran als pods.\n\nConfiguració de l'exemple:\n\n* Namespace del projecte: **XXXX-app1-data01-pre**\n* Nom del volum lògic: **XXXX-app1-data01-claim**\n* Mida del disc: **20Gb**\n\n```\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: XXXX-app1-data01-claim\n  namespace: XXXX-app1-pre\nspec:\n  accessModes:\n  - ReadWriteMany\n  resources:\n    requests:\n      storage: 20Gi\n```\n\n### Deployment\nEl Deployment és el principal element de configuració de l'aplicació.\n\nConfiguració de l'exemple:\n\n* Namespace del projecte: **XXXX-app1-data01-pre**\n* Nom de l'aplicació: **XXXX-app1-server**\n* Nom del deployment: **XXXX-app1-server-deployment**\n* Nombre de rèpliques: **2**\n* **El pod conté un únic contenidor**.\n* Estratègia de desplegament: **RollingUpdate**. No es recomana modificar, ni variar els seus paràmetres.\n* Quotes: **100 milicores de CPU** i **1024Mb de RAM**\n* Nom de la imatge dels contenidors: **XXXX-app1-pre/XXXX-app1-server:1.0.0**\n* Variables d'entorn dels contenidors:\n\n    * **ENV1_NAME** amb valor **env1_value**\n    * **ENV2_NAME** amb valor **env2_value**\n* Port del contenidor: **8080**\n* **readinessProbe** per identificar quan es pot començar a enviar peticions al contenidor.\n* **livenessProbe** per identificar quan cal reiniciar el contenidor.\n* Volum persistit: dins del contenidor es monta a **/data**. Fà referència al PersistentVolumeClaim anomenat **XXXX-app1-data01-claim** (creat a l'exemple anterior)\n* Nom del defaultToken: **default-token-rwj8z**\n\n```\napiVersion: apps/v1beta1\nkind: Deployment\nmetadata:\n  name: XXXX-app1-server-deployment\n  namespace: XXXX-app1-data01-pre\n  labels:\n    app: XXXX-app1-server\nspec:\n  replicas: 2\n  selector:\n    matchLabels:\n      app: XXXX-app1-server\n  strategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxSurge: 25%\n      maxUnavailable: 25%\n  minReadySeconds: 0\n  revisionHistoryLimit: 3       \n  template:\n    metadata:\n      labels:\n        app: XXXX-app1-server\n    spec:\n      containers:\n      - name: XXXX-app1-server\n        image: XXXX-app1-pre/XXXX-app1-server:1.0.0\n        resources:\n          limits:\n            cpu: 100m\n            memory: 1024Mi\n          requests:\n            cpu: 100m\n            memory: 1024Mi\n        imagePullPolicy: Always\n        env:\n        - name: ENV1_NAME\n          value: env1_value                       \n        - name: ENV2_NAME\n          value: env2_value                       \n        ports:\n        - containerPort: 8080\n        readinessProbe:\n          tcpSocket:\n            port: 8080\n          initialDelaySeconds: 5\n          periodSeconds: 10\n        livenessProbe:\n          httpGet:\n            path: /healthz\n            port: 8080\n            httpHeaders:\n            - name: X-Custom-Header\n              value: Awesome\n          initialDelaySeconds: 3\n          periodSeconds: 3      \n        volumeMounts:\n        - mountPath: /data\n          name: XXXX-app1-server\n        - mountPath: /var/run/secrets/kubernetes.io/serviceaccount\n          name: default-token-rwj8z\n          readOnly: true           \n      imagePullSecrets:\n        - name: uk-docker-registry-secret      \n      volumes:\n      - name: *XXXX-app1-server\n        persistentVolumeClaim:\n          claimName: XXXX-app1-data01-claim\n      - name: default-token-rwj8z\n        secret:\n          defaultMode: 420\n          secretName: default-token-rwj8z\n```\n\n### Service\nA l'exemple es crea un servei per el DeploymentConfig creat anteriorment.\n\nKubernetes suporta tant serveis amb protocol HTTP/HTTPS com  serveis amb altres tipus de protocols, com per exemple SSH, JDBC, ...\n\n#### Servei HTTP\nL'aplicació exposa un servei HTTP a través de la IP de l'Ingress.\nConfiguració de l'exemple:\n\n* Port exposat per servei: **80**\n* Port intern dels pods: **8080**\n\n```\napiVersion: v1\nkind: Service\nmetadata:\n  name: XXXX-app1-server\n  namespace: XXXX-app1-data01-pre\n  labels:\n    name: XXXX-app1-server\nspec:\n  ports:\n  - protocol: TCP\n    port: 80\n    targetPort: 8080\n  type: ClusterIP\n  selector:\n    app: XXXX-app1-server\n\n```\n\n#### Servei No HTTP\nL'aplicació exposa un servei no HTTP a través d'una IP pròpia.\nConfiguració de l'exemple:\n\n* Port exposat per servei: **3030**\n* Port intern dels pods: **3731**\n* IP on s'exposa el servei: **169.45.10.144**\n\n```\napiVersion: v1\nkind: Service\nmetadata:\n  labels:\n    name: XXXX-app1-server\n  name: XXXX-app1-data01-pre\n  namespace:  XXXX-app1-server\nspec:\n  ports:\n  - protocol: TCP\n    port: 3030\n    targetPort: 3731\n  selector:\n    app: XXXX-app1-server\n  type: LoadBalancer\n  loadBalancerIP: 169.45.10.144\n```\n\n\n### Ingress\nA l'exemple es crea una ruta pel servei creat anteriorment.\n\nConfiguració de l'exemple:\n\n* host: **app1-server.gencat.cat**\n\n```\napiVersion: extensions/v1beta1\nkind: Ingress\nmetadata:\n  name: app1-route\n  namespace: XXXX-app1-pre\nspec:\n  rules:\n  - host: app1-server.gencat.cat\n    http:\n      paths:\n      - path: /\n        backend:\n          serviceName: XXXX-app1-server\n          servicePort: 80   \n```\n\n\n## Informació relacionada\n\n* https://v1-12.docs.kubernetes.io/","objectID":"L2Nsb3VkX29sZC9jb250ZW5pZG9yc19rdWJlcm5ldGVz"},"L2Nsb3VkX29sZC9jb211bmljYWNpby1zdXBvcnQtY2xvdWQ=":{"date":1516147200000,"title":"Comunicació proveïdors d'aplicacions amb Suport Cloud","description":"Canals de comunicació disponibles pels proveïdors d'aplicacions amb Suport Cloud","sections":"Container Cloud","categories":["cloud"],"path":"/cloud_old/comunicacio-suport-cloud","content":"S'oficialitzen el [**CSTD (Centre de Suport Tecnològic al Desenvolupament)**](https://cstd.ctti.gencat.cat/) i [**Remedy**](https://pautic.gencat.cat/) com a canals de comunicació amb l'equip de Suport Cloud. A continuació es descriu quin és l'ús que s'ha de fer de cadascun d'ells:\r\n\r\n<br/>\r\n\r\n#### Aplicacions en servei\r\n\r\nPer les aplicacions que estiguin en servei:\r\n\r\n- **Remedy**\r\n\r\n_Incidències_, _Consultes_ (*) i _Canvis_ que es vulguin fer arribar a l'equip de Suport Cloud s'han de crear a Remedy informant l'aplicació afectada com a \"Service\" i \"A6-N3-CLOUD\" com a \"Assigned Group\".\r\n\r\n(*) per les consultes cal informar al camp “INCIDENT TYPE” el valor “USER SERVICE REQUEST”.\r\n\r\n<div class=\"message information\">\r\nDonat que a les plataformes Cloud gestionades des de Suport Cloud es dóna accés a <b>logs</b> i <b>monitorització</b> de l'aplicació, per l'agilitat en la resolució de les incidències és vital que el proveïdor d'aplicacions hagi revisat abans tota la informació de la qual disposa. També gràcies als <b>jobs de desplegament</b> del <a href=\"http://canigo.ctti.gencat.cat/sic/\">SIC</a> és autònom per redesplegar el servei afectat. Per tant, només haurien d'arribar incidències a Suport Cloud relacionades amb la plataforma (Ex. indisponibilitat global de la plataforma), que ni tan sols redesplegant el servei puguin resoldre's.\r\n</div>\r\n\r\n<br/>\r\n\r\n#### Aplicacions en fase de projecte\r\n\r\nPer les aplicacions en fase de projecte la comunicació s'ha de fer via **CSTD** al servei [**Servei Acompanyament Suport Cloud**](https://cstd.ctti.gencat.cat/jiracstd/browse/ACOCLD). El proveïdor d'aplicacions ha de crear una petició en aquest servei informant el camp Sumari \"Suport projecte NOM_PROJECTE\". Mentre l'aplicació estigui en fase de projecte tot el suport (Ex. definició imatges Docker, definició descriptors de desplegament,...) es canalitzarà en aquesta petició.\r\n\r\n<br/>\r\n\r\n#### Aplicacions que no han iniciat el procés d'alta dins CTTI\r\n\r\n_Consultes_ i _Suports_ han de realitzar-se al servei [**CS Suport Cloud**](https://cstd.ctti.gencat.cat/jiracstd/browse/CLD).\r\n\r\n<br/>\r\n\r\nEn cas que no es disposi d'usuari al CSTD, cal que el gestor de projecte CTTI de l'aplicació faci arribar la petició d'alta d'usuari al propi [servei CSTD](https://cstd.ctti.gencat.cat/jiracstd/browse/CSTD) o bé enviant un correu a la bústia [cstd.ctti@gencat.cat](mailto:cstd.ctti@gencat.cat).\r\n","objectID":"L2Nsb3VkX29sZC9jb211bmljYWNpby1zdXBvcnQtY2xvdWQ="},"L2Nsb3VkLXhwYWFzL21vbml0b3JhdGdlLXhwYWFz":{"date":1551052800000,"title":"Monitoratge i traces a les plataformes xPaaS","description":"Informació per accedir al monitoratge i traces a les diferents plataformes xPaaS.","sections":"xPaaS Cloud","weight":4,"categories":["cloud","xpaas","ibmcloud","azure","cloudfoundry"],"path":"/cloud-xpaas/monitoratge-xpaas","content":"Dins del marc de la metodologia DevOps, s'ofereixen a lot d'aplicacions un conjunt d'eines per a que monitorin i tinguin accés a les traces de les diferents plataformes xPaaS.\r\n\r\nA continuació es descriuen les diferents eines a cadascuna de les plataformes disponibles.\r\n\r\n## IBMCloud BuildPacks\r\n\r\nAl desplegar una aplicació a IBMCloud BuildPack, es proporciona a lot d'aplicacions permisos de **lectura** del seu projecte pels usuaris d'IBMCloud que sol·liciti.\r\n\r\n### Monitoratge\r\n\r\nDes de la [consola d'IBMCloud](https://cloud.ibm.com/), a l'apartat corresponent a **CloudFoundry** és tindrà accés de lectura de les diferents aplicacions.\r\n\r\nDes d'allà es pot consultar de cada projecte la següent informació:\r\n\r\n- Configuració dels diferents elements:\r\n  - Buildpack\r\n  - Nombre d'instàncies\r\n  - Memòria de cada instància\r\n  - Serveis connectats\r\n  - Routes\r\n  - ...\r\n- Mètriques de consum en temps real\r\n- Logs de les aplicacions\r\n\r\n\r\nPodeu trobar més informació al respecte a [IBMCloud Cloud Foundry.](https://www.ibm.com/cloud/cloud-foundry)\r\n\r\n\r\n### Logs\r\n\r\nDes de la plataforma de Cloud Foundry els logs dels pods en temps real. Si necessiteu accedir a logs anteriors o de buildpacks que ja no existeixi, està disponible un Kibana amb tots els logs de l'aplicació amb una retenció de 3 dies i 500Mb màxim per dia.\r\n\r\nPodeu accedir al Kibana directament des de la Plataforma de Cloud Foundry, a l'apartat de logs polsant el botó **View in Kibana.**\r\n\r\n## Azure\r\n\r\nPendent de definir.","objectID":"L2Nsb3VkLXhwYWFzL21vbml0b3JhdGdlLXhwYWFz"},"L2Nsb3VkX29sZC9kb2NrZXJSZWdpc3RyeQ==":{"date":1528243200000,"title":"Registre docker privat","description":"Descripció i ús del registre docker privat","sections":"Container Cloud","weight":6,"categories":["cloud","docker","container","openshift","swarm"],"path":"/cloud_old/dockerRegistry","content":"## Introducció\n\nDocker per defecte està configurat per utilitzar el registre públic [Docker Hub](https://hub.docker.com/) com a repositori d'imatges.\n\nPer persistir i gestionar les imatges docker privades és important disposar un registre docker privat:\n\n* Cal garantir que les imatges docker quedin persistides en algun repositori.\n* Cal garantir que les imatges docker dels diferents projectes no siguin públiques.\n\n**Important: Les imatges base presents al dockerHub de gencatcloud deixaran de ser mantingudes i pròximament esborrades. D'ara endavant, cal utilitzar les imatges base del registre privat.**\n\n## Descripció del registre privat\n\nEl registre privat escollit a la Generalitat de Catalunya és [Harbor](https://vmware.github.io/harbor/).\n\nDestaquen les següents característiques:\n\n* **Gestió d'usuaris RBAC:** Els repositoris docker estan organitzats en Projectes. Permet assignar permisos i rols als diferents usuaris a cada projecte.\n* **Portal web:** Permet navegar per les imatges dels diferents projectes, veure vulnerabilitats, ...\n* **API REST:** La majoria d'operacions efectuades des del portal web, es poden fer via API.\n* **Auditoria:** Totes les acciones que es facin sobre el registre queden registrades per poder ser analitzades en auditories.\n* **Anàlisi de vulnerabilitats:** Totes les imatges repositades al Registre són analitzades amb l'eina [Clair](https://github.com/coreos/clair) per identificar les diferents vulnerabilitats.\n* **Signatura d'Imatges:** Les imatges repositades al registre poden ser signades digitalment de cara a garantir la seva procedència i integritat. Actualment encara no implementat.\n\n## Ús del registre privat\n### Accés\nEl registre docker privat de la Generalitat de Catalunya, està disponible a l'URL pública **https://docker-registry.ctti.extranet.gencat.cat**\n\nÉs un registre privat sense cap repositori públic.\n\n### Permisos\nL'equip de suport cloud subministrarà al proveïdor d'aplicacions un usuari amb els següents permisos:\n\n* Permís de lectura del projecte associat a l'aplicació del projecte.\n* Permís de lectura del projecte **gencatcloud** amb les imatges base mantingudes per l'equip de Suport Cloud.\n\n### Consola web\nEs pot accedir a la consola web introduint a un navegador la url d'accés.\n\n* Des de la consola web es pot navegar pels projectes.\n* Es pot accedir als repositoris d'un projecte fent clic al **projecte**.\n* Es pot accedir a les diferents versions de les imatges d'un repositori fent clic al **repositori**.\n* Per cada imatge, es poden observar les vulnerabilitats fent clic al **tag** de la imatge.\n* Per cada vulnerabilitat es pot observar la descripció de la mateixa fent clic a la **vulnerabilitat**.\n\n### Docker\n#### Descarrega d'una imatge\nPer accedir a les imatges del registre des de docker, cal seguir els següents passos:\n\n* Connectar-se al registre:\n```\ndocker login https://docker-registry.ctti.extranet.gencat.cat\n```\n* Introduir les credencials proporcionades per l'equip de SuportCloud.\n* Fer un pull de la imatge desitjada\n```\ndocker pull docker-registry.ctti.extranet.gencat.cat/gencatcloud/java:8\n```\n* Desconnectar-se del registre:\n```\ndocker logout https://docker-registry.ctti.extranet.gencat.cat\n```\n\n#### Construir una imatge depenent d'una imatge repositada al registre privat\nPer exemple si tenim un dockerfile del tipus:\n\n```\nFROM docker-registry.ctti.extranet.gencat.cat/gencatcloud/java:8\n\nMAINTAINER xxxx\n\nENV APP_DIR=/app\n\nCOPY xxxx.jar ${APP_DIR}\nCOPY run.sh /\n```\n\n**Important notar que el FROM ha d'incloure el registre privat**\n\n* Cal primer connectar-se al registre:\n```\ndocker login https://docker-registry.ctti.extranet.gencat.cat\n```\n* Construir la imatge\n```\ndocker build -t XXXX .\n```\n* Desconnectar-se del registre:\n```\ndocker logout https://docker-registry.ctti.extranet.gencat.cat\n```\n\n## Integració amb SIC\nTotes les aplicacions basades en contenidors desplegades via SIC, estan integrades amb el Registre Docker privat.\nCada imatge que es desplegui a les diferents plataformes docker (AppAgile, Kubernetes o SwarmMe), quedarà repositada al registre privat.\n","objectID":"L2Nsb3VkX29sZC9kb2NrZXJSZWdpc3RyeQ=="},"L2Nsb3VkX29sZC9lbnRvcm5zLWRldg==":{"date":1550016000000,"title":"Entorns de desenvolupament","description":"Entorns de desenvolupament recomanats compatibles amb les Plataformes Cloud","sections":"Container Cloud","weight":7,"categories":["cloud","docker","container","paas"],"path":"/cloud_old/entorns-dev","content":"## AppAgile\r\n\r\nPer les [Plataformes Cloud](http://canigo.ctti.gencat.cat/cloud/plataformes/) basades en OpenShift, es recomana utilitzar [Minishift](https://www.openshift.org/minishift/). La versió a instal·lar ha de ser compatible amb la versió d'OpenShift.\r\n\r\n**Plataforma Cloud**  | **Versió Openshift**   | **Versió Minishift compatible**\r\n------------ | ------------ | ------------\r\nCPD4 AppAgile (privat)  |  3.9.65  | v1.16.1 o superior\r\n\r\n## Bluemix\r\n\r\nEn el cas de Bluemix:\r\n\r\n* Per les [Plataformes Cloud](http://canigo.ctti.gencat.cat/cloud/plataformes/) basades en Kubernetes, es recomana utilitzar [Minikube](https://kubernetes.io/docs/getting-started-guides/minikube/)\r\n* _Apps_: per les apps (xPaaS de CloudFoundry) es recomana utilitzar [PCF Dev](https://pivotal.io/pcf-dev).\r\n\r\nLa versió a instal·lar de Kubernetes i  Docker en entorns de desenvolupament, ha de ser compatible amb la versió utilitzada en les [Plataformes Cloud](http://canigo.ctti.gencat.cat/cloud/plataformes/).\r\n\r\n\r\n**Plataforma Cloud**  | **Versió Kubernetes**   |  **Versió Minikube**\r\n------------ | ------------ | ------------\r\nBluemix - Kubernetes  |  1.12.5  | 0.32 o superior\r\n\r\n## IBM CaaS\r\n\r\nEn el cas de IBM CaaS:\r\n\r\nPer les [Plataformes Cloud](http://canigo.ctti.gencat.cat/cloud/plataformes/) basades en Kubernetes, es recomana utilitzar [Minikube](https://kubernetes.io/docs/getting-started-guides/minikube/)\r\n\r\nLa versió a instal·lar de Kubernetes i Docker en entorns de desenvolupament, ha de ser compatible amb la versió utilitzada en les [Plataformes Cloud](http://canigo.ctti.gencat.cat/cloud/plataformes/).\r\n\r\n**Plataforma Cloud**  | **Versió Kubernetes**   |  **Versió Minikube**\r\n------------ | ------------ | ------------\r\nCaaS - Kubernetes  |  1.11.5  | 0.28.1 o superior\r\n\r\n## SwarmMe\r\n\r\nPer les Plataformes Cloud basades en Swarm, es recomana utilitzar  [docker-compose](https://docs.docker.com/compose/)\r\n\r\nLa versió a instal·lar de docker-compose en entorns de desenvolupament, ha de ser compatible amb la versió utilitzada en les [Plataformes Cloud](http://canigo.ctti.gencat.cat/cloud/plataformes/).\r\n\r\n**Plataforma Cloud**  | **Versió Docker**   | **Versió Docker-compose**\r\n------------ | ------------ | ------------\r\nCPD1 SwarmMe (privat)\t| 17.03.1-ce | 1.13.0\r\n\r\n","objectID":"L2Nsb3VkX29sZC9lbnRvcm5zLWRldg=="},"L2Nsb3VkX29sZC9vcnF1ZXN0cmFkb3JzX2NvbnRlbmlkb3Jz":{"date":1530489600000,"title":"Orquestradors de contenidors","description":"Consideracions respecte als orquestradors de contenidors","sections":"Container Cloud","weight":6,"categories":["cloud","docker","container","paas","openshift","kubernetes","swarm"],"path":"/cloud_old/orquestradors_contenidors","content":"## Introducció\n\nEn un entorn productiu, el desplegament utilitzant contenidors, moltes vegades no és suficient, és necessari disposar d'un conjunt de recursos addicionals que siguin capaços d'oferir un nivell de servei prou bo.\nAquests recursos són oferts pels orquestradors.\nAl mercar existeixen diferents eines per orquestrar els contenidors docker.\nLa Generalitat de Catalunya dóna suport als següents orquestradors:\n\n* AppAgile (basat en Openshift)\n* Kubernetes\n* SwarmMe (basat en Swarm)\n\nTot i que conceptualment tenen molts punts en comú, cadascun d'aquests orquestradors presenta components i maneres de treballar particulars.\nEn aquest article es defineix la manera de treballar i els components a utilitzar en cada orquestrador amb l'objectiu de minimitzar l'esforç necessari.\n\n## Aspectes bàsics\nEn un entorn productiu de contenidors, cal tenir present un conjunt d'aspectes més enllà dels propis contenidors.\nEls orquestradors ens ajudaran a assolir alguns dels següents aspectes.\n\n### Registre\nLes imatges de contenidors, un cop creades a partir del Dockerfile, cal repositar-les en un registre.\nDocker ofereix un registre públic amb imatges de tot tipus oferides per fabricants de productes i col·laboradors particulars. És el [Docker Hub](https://hub.docker.com/).\nPer repositar les imatges privades fruit dels diferents desenvolupaments de projectes, cal tenir un registre privat que només permeti accedir a les imatges als usuaris autoritzats.\n\n### Seguretat\nEls contenidors docker s'executen sobre el Docker Engine. Tot i que els contenidors són bastant segurs i cap a fora de la màquina on s'executen només exposen els ports que es defineixen al Dockerfile, si tenim diverses aplicacions, cadascuna amb diversos contenidors cal afegir una capa de seguretat entre elles.\nAddicionalment cal establir una capa de seguretat a la gestió de les diferents aplicacions de manera que cada aplicació pugui ser administrada per un tenant sense que altres tenants puguin accedir a ella. \n\n### Alta disponibilitat i escalat\nEls contenidors docker en si, no ofereixen alta disponibilitat. No està inclòs al concepte de contenidor. La idea per alta disponibilitat és realitzar escalat horitzontal de 2 o més contenidors idèntics.\nÉs necessari un component extern que controli el nombre de contenidors aixecats contínuament.\n\n### Balanceig\nQuan es disposen de més d'un contenidor d'un tipus, és necessari disposar d'un element que faci balanceig entre els diversos contenidors.\n\n### Serveis\nEls contenidors de docker s'exposen com a serveis a través de paràmetres a la comanda d'execució dels contenidors, mapejant ports interns del container amb ports externs del host. És necessària una capa addicional que permeti gestionar d'una manera una mica més àgil i flexible aquesta exposició.  \n\n### Enrutament\nAddicionalment al balanceig, és necessari disposar d'un element enrutador que permeti:\n\n* Configurar certificats SSL\n* Enrutar el transit entre diferents xarxes per oferir per exemple serveis només intranet o internet\n\n### Emmagatzematge\nL'emmagatzematge als contenidors s'estableix a través dels volums. És necessària una gestió addicional dels mateixos que ofereixin una millor granularitat a l'hora de proveir l'emmagatzematge des de diferents fonts.\n\n### Monitorizació de recursos i logs\nEls contenidors Docker normalment es configuren per a què els logs s'enviïn a la sortida estàndard. Quan existeix un volum elevat de containers, la monitorització es pot complicar molt. És necessària algun tipus d'eina que faciliti aquesta monitorització.\n\n### Quotes\nEls contenidors dockers, no tenen cap tipus de quota definida. Poden consumir tots els recursos de maquinari que requereixin. Per garantir l'estabilitat dels entorns productius, és necessari que hi hagi algun component que pugui limitar el consum de recursos de cada contenidor.\n\n### Desplegament\nActualment els cicles de vida de desenvolupament d'aplicacions van cap a models CI/CD i DevOps.\nLa Generalitat de Catalunya disposa de l'eina SIC per realitzar els desplegaments.\nSón necessàries eines que facilitin la integració d'un model de basat en contenidors amb eines de CI/CD com el SIC. \n\n## Comparativa entre orquestradors\n\n### Característiques\n\nAl següent diagrama es descriu:\n\n* Principals components de cada orquestrador\n* Correspondències entre els components de cada orquestrador\n* Components permesos a la Generalitat de Catalunya  \n\n![comparativa entre Orquestradors docker](/related/cloud/comparativaOrquestradors.png)\n\n## Descripció dels orquestradors\n### SwarmMe\nEstà basat en Swarm.\nSwarm és l'orquestrador oficial de docker. Actualment és el menys evolucionat dels tres.\nSwarmMe complementa alguna de les mancances que Swarm presenta (Registre, Sistema centralitzat de logs, eines de desplegament, ...)\n\nPer més informació podeu consultar https://docs.docker.com/engine/swarm/\n\n### Kubernetes\nVa ser creat per Google.\nActualment està evolucionant molt.\nRecentment ha rebut el suport oficial de docker.\n\nPer detalls i exemples podeu visitar la plana http://canigo.ctti.gencat.cat/cloud/contenidors_kubernetes/\n\nPer més informació podeu consultar la web https://kubernetes.io/\n\n### AppAgile\nAppAgile està basat en Openshift Container Platform.\nDesenvolupat per Red Hat, basat en Kubernetes.\nAfegeix funcionalitat addicional a Kubernetes (gestió d'usuaris, segmentació de xarxa, sistema centralitzat de logs).\nAcostuma a portar un endarreriment respecte a l'última versió de kubernetes d'uns tres o quatre mesos.\n\nPer detalls i exemples podeu visitar la plana http://canigo.ctti.gencat.cat/cloud/contenidors_appagile/\n\nPer més informació podeu consultar les webs http://appagile.io/ i https://docs.openshift.com/container-platform/3.5/\n\n## Imatges\nA l'hora de construir les imatges docker, cal tenir present els criteris definits per la Generalitat de Catalunya i que cada orquestrador, tot i que totes les plataformes es basen en docker, té les seves particularitats.\n\nA la plana [Criteris creació contenidors docker](http://canigo.ctti.gencat.cat/cloud/dockerImages/) podeu trobar més informació al respecte. \n\n\n","objectID":"L2Nsb3VkX29sZC9vcnF1ZXN0cmFkb3JzX2NvbnRlbmlkb3Jz"},"L2Nsb3VkX29sZC9saWZlY3ljbGU=":{"date":1462924800000,"title":"Cicle de vida","description":"Cicle de vida de les aplicacions Cloud containeritzades i xPaas/buildpack","sections":"Container Cloud","weight":4,"categories":[],"path":"/cloud_old/lifecycle","content":"Gràcies a l'ús del Container Cloud el cicle de vida de les aplicacions pot automatitzar-se de forma fàcil. És aquí on el SIC (Servei d'Integració Continua) té un paper essencial, ja que és l'encarregat de proporcionar els processos per assolir aquesta automatització.\n\nExpliquem, des d'un inici, quines són les passes que segueix una aplicació fins a arribar a executar-se en el Container Cloud:\n\n### Definició d'Arquitectura\n\nÉs en aquesta fase on el proveïdor d'aplicacions, conjuntament amb Integració de Solucions, analitzaran si l'aplicació és susceptible d'anar al Container Cloud. Amb el suport de l'equip d'Administració Cloud i Arquitectura CTTI es prendrà una decisió i es determinarà quin és el cloud destí més apropiat.\n\nEls proveïdors d'aplicacions poden adreçar qualsevol petició de consulta o suport al [CS Suport Cloud del CSTD](https://cstd.ctti.gencat.cat/jiracstd/browse/CLD).\n\n### Alta projecte\n\nUn cop el document d'arquitectura hagi estat aprovat, així com el pressupost associat als elements a aprovisionar al cloud, es procedirà a l'alta del projecte.\n\nEn aquesta fase s'aprovisionaran els recursos necessaris en el cloud destí i en el SIC per al desplegament de l'aplicació, així com els usuaris d'accés pels proveïdors d'aplicacions per la monitorització de l'aplicació (logs, consum recursos, ...) i el seu desplegament.\n\n### Construcció i desplegament\n\nLes aplicacions es construiran i desplegaran sempre des del SIC. Els elements utilitzats per la \"containerització\" de les aplicacions seran els següents:\n\n#### _xPaaS_\n\n* Els xPaaS utilitzats seran els buildpacks oficials de CloudFoundry per IBM Bluemix i els xPaaS d'OpenShift per CPD3 Containers. Més informació al [catàleg cloud](http://canigo.ctti.gencat.cat/cloud/cataleg/#xpaas:60ff5dd56c9d5f883640685f4f912b83). \n\n#### _Contenidors (Docker)_\n\n* Les imatges utilitzades per les aplicacions han de ser les [oficials de Gencat](http://canigo.ctti.gencat.cat/cloud/cataleg/#contenidors-docker:60ff5dd56c9d5f883640685f4f912b83), o bé extensions d'aquestes. Aquestes imatges han estat certificades per l'equip d'Administració del Cloud. Qualsevol extensió d'aquestes imatges passarà un procés de validació de vulnerabilitats en el procés de construcció al SIC. En cas que l'extensió introdueixi alguna vulnerabilitat l'aplicació no es desplegarà.\n\nPel que fa als entorns, per defecte existirà un de PROductiu i un altre de PREproductiu. Els desplegaments en aquests entorns es realitzaran seguint l'estratègia de [blue-green deployment](http://martinfowler.com/bliki/BlueGreenDeployment.html).\n\n  \n  \n\nA continuació mostrem un diagrama on s'il·lustra el flux i els diferents equips que intervenen en el cicle de vida d'una aplicació al Container Cloud:\n\n![Cicle de Vida Container Cloud](/related/cloud/lifecycle.png)\n","objectID":"L2Nsb3VkX29sZC9saWZlY3ljbGU="},"L2Nsb3VkX29sZC9wbGF0YWZvcm1lcw==":{"date":1527811200000,"title":"Plataformes Cloud","description":"Bluemix, OpenShift, Azure, ...","sections":"Container Cloud","weight":1,"categories":["cloud","docker","container","paas"],"path":"/cloud_old/plataformes","content":"## Plataformes Cloud\r\n\r\n### Cloud Públic\r\n\r\n* **Bluemix**\r\n\t- https://www.ibm.com/cloud-computing/bluemix/, basat en Cloud Foundry\r\n\t- Concepte xPaaS: buildpack/runtime, https://www.ibm.com/cloud-computing/bluemix/es/runtimes\r\n\t- Contenidors: Docker i orquestració amb Kubernetes https://www.ibm.com/cloud-computing/bluemix/es/containers\r\n\r\n* **Compose.io**\r\n\t- DBaaS: ElasticSearch, MongoDB, PostgreSQL\r\n\r\n_Tot i que és una plataforma Cloud independent a Bluemix, és propietat d'IBM, i s'espera a curt termini que hi estigui totalment integrat donant les mateixes prestacions (monitoratge, backups, etc) que com a plataforma independent_\r\n\r\n* **Azure**\r\n\t- https://azure.microsoft.com\r\n\t- VM: màquines virtuals Windows/Linux\r\n\t- xPaaS: websites/appservice, principalment les .NET\r\n\t- DBaaS: SQL Server, PostgreSQL, MySQL, CosmoBD\r\n\t\r\n### Cloud Privat\r\n\r\n* **AppAgile**\r\n\r\n\t- http://appagile.io/\r\n\t- Basat en Openshift: https://www.openshift.com/\r\n\t- Contenidors: Docker i orquestració amb Openshift\r\n\r\n* **SwarmMe**\r\n\r\n\t- Basat en Swarm: https://docs.docker.com/swarm/\r\n\t- Contenidors: Docker i orquestració amb Swarm","objectID":"L2Nsb3VkX29sZC9wbGF0YWZvcm1lcw=="},"L2Nsb3VkX29sZC9kb2NrZXJJbWFnZXM=":{"date":1528243200000,"title":"Criteris creació contenidors docker","description":"Criteris per crear les imatges dels contenidors docker que es desplegaran als diferents clouds públics i privats","sections":"Container Cloud","weight":6,"categories":["cloud","docker","container","paas","openshift"],"path":"/cloud_old/dockerImages","content":"## Introducció\n\nA l'hora de crear les imatges dels diferents contenidors docker per les aplicacions gencat cal establir un conjunt de criteris que garanteixin la seva estabilitat i seguretat.\n\n## Imatges homologades pel CTTI\nL'equip de Suport Cloud del CTTI manté un conjunt d'imatges docker de les tecnologies més utilitzades a la Generalitat de Catalunya. Aquestes imatges són compatibles amb totes les plataformes basades en contenidors disponibles a la Generalitat (AppAgile,Openshift ,Kubernetes).\n\nAquestes imatges docker es poden trobar al **registre docker privat**, al projecte **gencatcloud**.\n\nPodeu trobar més informació respecte el registre privat a [Registre docker privat](http://canigo.ctti.gencat.cat/cloud/dockerRegistry/).\n\n\n## Criteris per escollir la imatge base\n\n* Les imatges de docker es crearan sempre a partir del fitxer Dockerfile, en cap cas es crearan imatges a partir de contenidors.\n* En cas que existeixin imatges homologades pel CTTI de la tecnologia requerida, el Dockerfile particular de cada aplicació haurà de tenir com a base la imatge homologada, utilitzant la directiva **FROM**.\n* En cas que no existeixin imatges homologades pel CTTI de la tecnologia requerida, a l'hora d'escollir les imatges de base es faran servir els següents criteris:\n\t* Imatge oficial de fabricant al [docker hub](https://hub.docker.com/).\n\t* En cas que existeixi una imatge oficial basada en **[Alpine](https://hub.docker.com/_/alpine/)**, s'escollirà aquesta.\n    * En cas que no existeixi una imatge oficial basada en Alpine, s'escollirà la imatge basada en Centos, substituint Centos per la versió d'Oracle Linux Slim corresponent. Aquesta substitució és necessaria pel support de pegats de seguretat que ofereix Oracle Linux i no ofereix Centos.\n\t* En cas que no existeixi una imatge oficial basada en Alpine ni Centos, s'escollirà la que recomani el fabricant. Sol ser la que al tag només s'indica la versió.\n* Mai s'escollirà el tag latest. És una versió que va canviant en el temps i genera inestabilitat a les aplicacions. Escollir sempre la versió més tancada possible.\n\n## Criteris generals per la creació de les imatges\n\nAlguns d'aquests criteris no apliquen en cas d'utilitzar les imatges homologades pel CTTI.\n\n* Deixar instal·lat el nombre mínim de paquets al docker, si és necessari instal·lar paquets per realitzar compilacions, desinstal·lar-los un cop realitzada aquesta.\n* Actualitzar els packets del sistema operatiu a la última versió disponible amb tots els pegats de seguretat aplicats.\n* No deixar el codi font al docker, un cop compilat, eliminar-lo.\n* Incloure a la imatge el script **wait-for-it.sh**, adjuntat a baix, per poder testejar les comunicacions. Notar que requereix tenir el bash instal·lat.\n* No executar mai el procés final de les aplicacions amb l'usuari **root**. La majoria de tecnologies inclouen scripts que utilitzen usuaris específics per arrencar-les.\n* Fixar els uid i gid dels usuaris i grups utilitzats per executar els processos, amb l'objectiu d'evitar escalat de privilegis.\n* Assegurar la seguretat dels directoris definint el propietari i els permisos explícitament. S'adjunta a baix l'script **docker-setup.sh** d'exemple.\n* Executar el procés principal des d'un script, mai directament al Dockerfile.\n* Utilitzar el volum **/data** per desar la informació que cal persistir.\n* No executar múltiples processos a dins de la imatge docker. Docker està pensat per executar un únic procés.\n* **No escriure els logs de l'aplicació a fitxers. Enviar els logs sempre a la sortida estàndard**. D'aquesta manera la plataforma capturarà els logs i no caldrà entrar als contenidors per veure'ls.\n\n## Criteris de seguretat\n\n* Intentar utilitzar l'última versió del producte, sol ser la que té menys vulnerabilitats de seguretat.\n* Per validar la seguretat de les imatges creades, utilitzar l'eina [Clair](https://github.com/coreos/clair). En cas que es detectin vulnerabilitats, intentar eliminar-les instal·lant els patches necessaris.\n* Aplicar totes les configuracions de seguretat recomanades pel fabricant o la comunitat per cada producte en particular.\n\nAbans de desplegar un contenidor a producció, es realitzarà una validació de seguretat utilitzant l'eina Clair. En cas de detectar vulnerabilitats de caràcter greu la imatge no serà desplegada.\n\n## Criteris específics de Openshift\n\n[Openshift](https://www.openshift.com/), tot i que suporta desplegar imatges de docker, presenta uns criteris més restrictius de seguretat que cal tenir present a l'hora de construir el Dockerfile.\n\n* No utilitzar l'usuari **root** ni per executar l'script principal del docker (normalment s'utilitza l'usuari root). Utilitzar la directiva **USER uid** per definir amb quin usuari s'executarà el procés.\n* Cal tenir present que openshift executa el procés amb un id d'usuari aleatori que pertany al grup **root**.\n\t* Aquest usuari es crea a l'executar el docker. No existeix, ni es coneix, en etapa de construcció de la imatge de docker.\n\t* A causa de la característica anterior, és possible que algunes accions que habitualment es fan en etapa de construcció calgui fer-les en etapa d'execució amb alguna shell.\n\t* Cal que les carpetes on el procés escriu dades, pertanyin al grup root. Es pot veure a l'script **docker-setup.sh** inclòs abaix.\n\t* Algunes aplicacions necessiten que l'usuari estigui definit al fitxer /etc/passwd. En aquest cas és necessari utilitzar el paquet **[nss_wrapper](https://cwrap.org/nss_wrapper.html)** per emular els canvis en aquest fitxer. Es pot veure un exemple a la imatge docker [postgres-openshift](https://github.com/gencat/postgres-openshift). Veure la plana web [Openshift. Creating Images. Guidelines. OpenShift Origin-Specific Guidelines. Support Arbitrary User IDs] (https://docs.openshift.org/latest/creating_images/guidelines.html#openshift-origin-specific-guidelines) per més detalls.\n* Utilitzar variables d'entorn per la configuració.\n* Més informació de com construir les imatges de docker està disponible a [Openshift. Creating Images. Guidelines](https://docs.openshift.org/latest/creating_images/guidelines.html).\n\n## Exemples\nPodeu trobar exemples de diferents imatges de docker seguint aquests criteris al [registre docker privat](https://docker-registry.ctti.extranet.gencat.cat) projecte **gencatcloud**.\n\nLes imatges amb extensió **-openshift* són les compatibles amb la plataforma de xPaaS del mateix nom.\n\n## Annexos\n_wait-for-it.sh_\n```\n#!/usr/bin/env bash\n#   Use this script to test if a given TCP host/port are available\n\ncmdname=$(basename $0)\n\nechoerr() { if [[ $QUIET -ne 1 ]]; then echo \"$@\" 1>&2; fi }\n\nusage()\n{\n    cat << USAGE >&2\nUsage:\n    $cmdname host:port [-s] [-t timeout] [-- command args]\n    -h HOST | --host=HOST       Host or IP under test\n    -p PORT | --port=PORT       TCP port under test\n                                Alternatively, you specify the host and port as host:port\n    -s | --strict               Only execute subcommand if the test succeeds\n    -q | --quiet                Don't output any status messages\n    -t TIMEOUT | --timeout=TIMEOUT\n                                Timeout in seconds, zero for no timeout\n    -- COMMAND ARGS             Execute command with args after the test finishes\nUSAGE\n    exit 1\n}\nwait_for()\n{\n    if [[ $TIMEOUT -gt 0 ]]; then\n        echoerr \"$cmdname: waiting $TIMEOUT seconds for $HOST:$PORT\"\n    else\n        echoerr \"$cmdname: waiting for $HOST:$PORT without a timeout\"\n    fi\n    start_ts=$(date +%s)\n    while :\n    do\n        (echo > /dev/tcp/$HOST/$PORT) >/dev/null 2>&1\n        result=$?\n        if [[ $result -eq 0 ]]; then\n            end_ts=$(date +%s)\n            echoerr \"$cmdname: $HOST:$PORT is available after $((end_ts - start_ts)) seconds\"\n            break\n        fi\n        sleep 1\n    done\n    return $result\n}\nwait_for_wrapper()\n{\n    # In order to support SIGINT during timeout: http://unix.stackexchange.com/a/57692\n    if [[ $QUIET -eq 1 ]]; then\n        timeout -t $TIMEOUT $0 --quiet --child --host=$HOST --port=$PORT --timeout=$TIMEOUT &\n    else\n        timeout -t $TIMEOUT $0 --child --host=$HOST --port=$PORT --timeout=$TIMEOUT &\n    fi\n    PID=$!\n    trap \"kill -INT -$PID\" INT\n    wait $PID\n    RESULT=$?\n    if [[ $RESULT -ne 0 ]]; then\n        echoerr \"$cmdname: timeout occurred after waiting $TIMEOUT seconds for $HOST:$PORT\"\n    fi\n    return $RESULT\n}\n# process arguments\nwhile [[ $# -gt 0 ]]\ndo\n    case \"$1\" in\n        *:* )\n        hostport=(${1//:/ })\n        HOST=${hostport[0]}\n        PORT=${hostport[1]}\n        shift 1\n        ;;\n        --child)\n        CHILD=1\n        shift 1\n        ;;\n        -q | --quiet)\n        QUIET=1\n        shift 1\n        ;;\n        -s | --strict)\n        STRICT=1\n        shift 1\n        ;;\n        -h)\n        HOST=\"$2\"\n        if [[ $HOST == \"\" ]]; then break; fi\n        shift 2\n        ;;\n        --host=*)\n        HOST=\"${1#*=}\"\n        shift 1\n        ;;\n        -p)\n        PORT=\"$2\"\n        if [[ $PORT == \"\" ]]; then break; fi\n        shift 2\n        ;;\n        --port=*)\n        PORT=\"${1#*=}\"\n        shift 1\n        ;;\n        -t)\n        TIMEOUT=\"$2\"\n        if [[ $TIMEOUT == \"\" ]]; then break; fi\n        shift 2\n        ;;\n        --timeout=*)\n        TIMEOUT=\"${1#*=}\"\n        shift 1\n        ;;\n        --)\n        shift\n        CLI=\"$@\"\n        break\n        ;;\n        --help)\n        usage\n        ;;\n        *)\n        echoerr \"Unknown argument: $1\"\n        usage\n        ;;\n    esac\ndone\nif [[ \"$HOST\" == \"\" || \"$PORT\" == \"\" ]]; then\n    echoerr \"Error: you need to provide a host and port to test.\"\n    usage\nfi\nTIMEOUT=${TIMEOUT:-15}\nSTRICT=${STRICT:-0}\nCHILD=${CHILD:-0}\nQUIET=${QUIET:-0}\nif [[ $CHILD -gt 0 ]]; then\n    wait_for\n    RESULT=$?\n    exit $RESULT\nelse\n    if [[ $TIMEOUT -gt 0 ]]; then\n        wait_for_wrapper\n        RESULT=$?\n    else\n        wait_for\n        RESULT=$?\n    fi\nfi\nif [[ $CLI != \"\" ]]; then\n    if [[ $RESULT -ne 0 && $STRICT -eq 1 ]]; then\n        echoerr \"$cmdname: strict mode, refusing to execute subprocess\"\n        exit $RESULT\n    fi\n    exec $CLI\nelse\n    exit $RESULT\nfi\n```\n\n_docker-setup.sh_\n```\n#!/bin/sh\n\n# setup directory for data\nmkdir -p /data\nchown -R nginx:0 /data\nchmod g+w -R /data\nchown -R nginx:0 /usr\nchown -R nginx:0 /var\n\nchgrp -R 0 /usr\nchmod -R g+rw /usr\nfind /usr -type d -exec chmod g+x {} +\n\nchgrp -R 0 /var\nchmod -R g+rw /var\nfind /var -type d -exec chmod g+x {} +\n```","objectID":"L2Nsb3VkX29sZC9kb2NrZXJJbWFnZXM="},"L2NzL2dpY2Fy":{"date":1465488702000,"title":"Oficina Tècnica de GICAR","description":"Contacte amb l'Oficina Tècnica de GICAR","weight":3,"path":"/cs/gicar","content":"De cara a contactar amb l'Oficina Tècnica de GICAR, per a consultes, incidències, o noves integracions, obriu un tiquet a través de:\t\n \n - Remedy, portal d'autoservei: https://pautic.gencat.cat.\t\n - Enviant un correu a [sau.tic@gencat.cat](mailto://sau.tic@gencat.cat) demanant que s'assigni la petició a l'oficina tècnica de GICAR.\t\n Per a obtenir més informació sobre com fer peticions d'integració d'aplicacions, formularis, etc, consultar a la següent adreça: https://portic.ctti.gencat.cat/solucions/soltecnologiques/Pagines/Solucions/Sistemes%20d'informaci%C3%B3%20i%20transversals/38-0.aspx\n","objectID":"L2NzL2dpY2Fy"},"L2NzL3N1YnNjcmlwY2lvbnM=":{"date":1523635902000,"title":"Subscripcions al butlletí de Comunicacions Arquitectura","description":"Gestió de la subscripció al butlletí per part d'un usuari","draft":false,"sections":"","weight":4,"path":"/cs/subscripcions","content":"El CS Canigó publica mensualment un Comunicat amb notícies, destacats i howtos sobre els següents serveis:\n\n* Canigó\n* SIC\n* SGDE\n* GICAR\n* Cloud\n\nA continuació, es descriu com un usuari pot gestionar la seva subscripció.\n\n## Creació de l'usuari per a la gestió de subscripcions als butlletins\n\nLa gestió de subscripcions es duu a terme a través del portal [https://butlletins.gencat.cat](https://butlletins.gencat.cat).\n\nPrimer de tot, cal destacar que l'usuari s'ha de donar d'alta (si no està ja) en aquest web. Per fer-ho cal que s'intenti subscriure al butlletí desitjat. Durant el procés, haurà de loginar-se si ja té un usuari existent o haurà de crear-ne un de nou en cas contrari.\n\n## Procediment de subscripció\n\nPer donar-se d'alta com a subscriptor de les Comunicacions Arquitectura, cal seguir les següents passes:\n\n1. Accedir amb un navegador web a: [https://butlletins.gencat.cat](https://butlletins.gencat.cat).\n2. Desplegar el grup **Tecnologia. Recerca i innovació** i sel·leccionar **Comunicacions Arquitectura**.\n3. Prémer el botó **Següent** (situat al final de la pàgina, cantó dret).\n4. Si mai s'ha donat d'alta com a suscriptor, haurà d'omplir el formulari inferior. En cas contrari, ha de fer login.\n5. Si s'ha hagut de donar d'alta, rebrà un correu de validació al compte de correu indicat. Haurà de confirmar accedint a l'enllaç **Confirmar alta** en el correu rebut.\n6. Finalment, caldrà confirmar al web la suscripció d'alta al butlletí sel·leccionat.\n\n## Procediment de baixa de subscripció\n\nPer donar-se de baixa com a subscriptor de les Comunicacions Arquitectura, cal seguir les següents passes:\n\n1. Accedir amb un navegador web a: [https://butlletins.gencat.cat](https://butlletins.gencat.cat).\n2. Fer login amb el seu usuari.\n3. A la pantalla de benvinguda, apareixeran totes les subscripcions que tingui actives. Cercar la subscripció de **Comunicacions Arquitectura** i prémer el botó de **Baixa** corresponent.\n\nEn cas de dubte, podeu contactar al correu `oficina-tecnica.canigo.ctti@gencat.cat`, on us podrem resoldre els dubtes o problemes que tingueu associats a la subscripció del butlletí.\n\n","objectID":"L2NzL3N1YnNjcmlwY2lvbnM="},"L2NzL2Nsb3Vk":{"date":1465488702000,"title":"Centre de Suport Cloud","description":"Suport al desenvolupament i desplegament d'aplicacions Cloud Públic i Privat basades en contenidors (Docker) i serveis (xPaaS/buildpacks, DBaaS, ...)","draft":false,"weight":2,"path":"/cs/cloud","content":"El **CS de Suport Cloud** donarà resposta a totes aquelles necessitats relacionades amb les solucions de cloud públic i amb el desplegament de solucions basades en tecnologies de containerització (Docker, ...), ja sigui a cloud públic o privat. \n\n<br />\n\n- **JIRA**:[http://cstd.ctti.gencat.cat/jiracstd/browse/CLD](http://cstd.ctti.gencat.cat/jiracstd/browse/CLD)\n\n- **Correu-e**: [suport.cloud@gencat.cat](mailto://suport.cloud@gencat.cat)\n","objectID":"L2NzL2Nsb3Vk"},"L2Rlc3RhY2F0cy8yMDE3LTA4LTAzLVJlY29yZF9wZXRpY2lvbnNfZUZvcm11bGFyaXM=":{"date":1501718400000,"title":"Milió de peticions al servei d'eFormularis","description":"Durant el mes de Juliol s'ha arribat al milió de peticions al servei d'eFormularis, sent el nombre més elevat en la història del servei","key":"AGOST2017","path":"/destacats/2017-08-03-Record_peticions_eFormularis","content":"","objectID":"L2Rlc3RhY2F0cy8yMDE3LTA4LTAzLVJlY29yZF9wZXRpY2lvbnNfZUZvcm11bGFyaXM="},"L2Rlc3RhY2F0cy8yMDE3LTEwLTEwLUFkdmVydGltZW50cy1DaHJvbWUtSFRUUA==":{"date":1507593600000,"title":"Advertiments a Chrome en llocs web HTTP","description":"A partir d'aquest mes d'octubre, Chrome v62 mostrarà l'advertiment 'No segura' quan els usuaris introdueixin text en un formulari d'una pàgina HTTP. Es recomana que els llocs web amb aquestes característiques migrin a HTTPS","sections":["canigo"],"key":"OCTUBRE2017","path":"/destacats/2017-10-10-Advertiments-Chrome-HTTP","content":"","objectID":"L2Rlc3RhY2F0cy8yMDE3LTEwLTEwLUFkdmVydGltZW50cy1DaHJvbWUtSFRUUA=="},"L2Rlc3RhY2F0cy8yMDE4LTA1LTI0LVNJQy1kZXNwbGVnYW1lbnRzLUpCb3Nz":{"date":1527120000000,"title":"SIC. Integració de desplegaments a JBoss al SIC","description":"Aquest mes de maig s'ha integrat els desplegaments de JBoss al SIC. A partir d'ara, el SIC està capacitat per desplegar a servidors JBoss 6 i 7","key":"JUNY2018","path":"/destacats/2018-05-24-SIC-desplegaments-JBoss","content":"","objectID":"L2Rlc3RhY2F0cy8yMDE4LTA1LTI0LVNJQy1kZXNwbGVnYW1lbnRzLUpCb3Nz"},"L2Rlc3RhY2F0cy8yMDE4LTA2LTI2LVVwZ3JhZGVTSUM=":{"date":1529971200000,"title":"SIC. Actualització anual dels productes del SIC","description":"S'està treballant en l'actualització tecnològica planificada de forma anual de la plataforma. En concret, durant el mes de setembre s'actualitzarà la plataforma de d'integració contínua Jenkins a la versió 2.121.1 i la versió de GitLab a la versió 10.8.4.","sections":["sic"],"key":"JULIOL2018","path":"/destacats/2018-06-26-UpgradeSIC","content":"","objectID":"L2Rlc3RhY2F0cy8yMDE4LTA2LTI2LVVwZ3JhZGVTSUM="},"L2Rlc3RhY2F0cy8yMDE4LTA5LTI3LVNHREUtQWN0dWFsaXR6YWNpby10ZWNub2xvZ2ljYS1zdGQ=":{"date":1538006400000,"title":"SGDE. Actualització tecnològica del STD","description":"Durant el primer trimestre del 2019 està previst realitzar una actualització tecnològica del servei STD. Els diferents integradors rebran les comunicacions pertinents per ser informats de les dates més rellevants","sections":["sgde"],"key":"OCTUBRE2018","path":"/destacats/2018-09-27-SGDE-Actualitzacio-tecnologica-std","content":"","objectID":"L2Rlc3RhY2F0cy8yMDE4LTA5LTI3LVNHREUtQWN0dWFsaXR6YWNpby10ZWNub2xvZ2ljYS1zdGQ="},"L2Rlc3RhY2F0cy9lbnRvcm4tZGV2LWNhbmlnby0xXzBfMw==":{"path":"/destacats/entorn-dev-canigo-1_0_3","content":"+++\ndate        = \"2017-03-21\"\ntitle       = \"Publicació entorn de desenvolupament Canigó v1.0.3\"\nenllac\t    = \"http://canigo.ctti.gencat.cat/canigo/entorn-desenvolupament/\"\ndescription = \"Ha estat publicada la versió 1.0.3 de l'entorn de desenvolupament de Canigó. S'ha actualitzat la versió d'Ubuntu a 16.04 LTS\"\nno_index \t  = true\nkey \t\t    = \"ABRIL2017\"\n+++\n","objectID":"L2Rlc3RhY2F0cy9lbnRvcm4tZGV2LWNhbmlnby0xXzBfMw=="},"L2Rlc3RhY2F0cy9zaWMtdHJhc3Bhcy1zYXU=":{"date":1435622400000,"title":"Traspàs a SAU CTTI","description":"Aquest mes de Juny s'ha començat ha treballar en el traspàs de certes tasques operatives (alta d'usuaris, repositoris al SVN, ...) que realitza l'equip del SIC a SAU CTTI. El traspàs no es farà efectiu fins a l'últim trimestre de l'any.","key":"JULIOL2015","path":"/destacats/sic-traspas-sau","content":"Aquest mes de Juny s'ha començat ha treballar en el traspàs de certes tasques operatives (alta d'usuaris, repositoris al SVN, ...) que realitza l'equip del SIC a SAU CTTI. El traspàs no es farà efectiu fins a l'últim trimestre de l'any.","objectID":"L2Rlc3RhY2F0cy9zaWMtdHJhc3Bhcy1zYXU="},"L2Rlc3RhY2F0cy1yZWxhdGVkL2RvbWluaS1ub3U=":{"date":1430092800000,"title":"Nou domini per repositoris Maven","description":"","sections":"Canigó","path":"/destacats-related/domini-nou","content":"Es recomana que les aplicacions Caniǵo accedeixin als repositoris Maven de Canigó utilitzant el nou domini \"repos.canigo.ctti.gencat.cat\".\r\n\r\nLa manera més fàcil de fer-ho sense modificar codi de l'aplicació és mitjançant el fitxer de configuració \"settings.xml\" de la instal·lació de Maven. S'ha d'afegir un mirror al nou domini:\r\n\r\n```\r\n<mirrors>\r\n    <mirror>\r\n      <id>repocanigo</id>\r\n      <name>Repositori Canigo</name>\r\n      <url>http://repos.canigo.ctti.gencat.cat/repository/maven2</url>\r\n      <!-- id del repositori Canigo definit a l'aplicació: http://canigo.ctti.gencat.cat/repository/maven2 -->\r\n      <mirrorOf>canigo</mirrorOf>\r\n    </mirror>\r\n  </mirrors>\r\n\r\n```","objectID":"L2Rlc3RhY2F0cy1yZWxhdGVkL2RvbWluaS1ub3U="},"L2Rlc3RhY2F0cy1yZWxhdGVkL25vdS1mb3JtYXQtY29tdW5pY2F0cw==":{"date":1432857600000,"title":"Nou format dels comunicats del CS Canigó","description":"Des del mes de Juny de 2015 els comunicats que s'emeten des del CS Canigó tenen una nous estils adaptats als corporatius","sections":"Canigó","path":"/destacats-related/nou-format-comunicats","content":"Des del mes de Juny de 2015 els comunicats del CS Canigó tenen una nous estils adaptats als corporatius. Aquesta és la maqueta per els nous butlletins:\r\n\r\n<CENTER>![maqueta_butlleti](/images/destacats/maqueta_butlleti.png)</center>\r\n\r\nAquesta plantilla ha estat modificada per adaptar-la als tipus de continguts que s'emeten en els comunicats del CS Canigó: temes d'interés, notícies, gràfiques d'activitat i howto's.\r\n\r\nPer qualsevol suggeriment per tal de millorar aquests comunicats ens podeu fer arribar els vostres comentaris a la [Bústia del CS Canigó](mailto:oficina-tecnica.canigo.ctti@gencat.cat).","objectID":"L2Rlc3RhY2F0cy1yZWxhdGVkL25vdS1mb3JtYXQtY29tdW5pY2F0cw=="},"L2Rlc3RhY2F0cy1yZWxhdGVkL2RvbWluaS1pYmlibGlvLW5vdQ==":{"date":1450396800000,"title":"Canvi de domini del repositori ibiblio a Maven","description":"","sections":"Canigó","path":"/destacats-related/domini-ibiblio-nou","content":"Recentment el repositori Maven d'*ibiblio* ha canviat de domini. Per tal que les aplicacions Canigó que accedeixen a aquest repositori puguin continuar resolent les dependències en aquest, caldrà actualitar-ne la referència.\r\n\r\nLa manera més fàcil de fer-ho sense modificar codi de l'aplicació és mitjançant el fitxer de configuració \"settings.xml\" de la instal·lació de Maven. S'ha d'afegir un mirror al nou domini:\r\n\r\n```\r\n<mirrors>\r\n   \t<mirror>\r\n\t\t<id>repoibiblio</id>\r\n\t\t<name>Repositori ibiblio</name>\r\n\t\t<url>http://maven.ibiblio.org/maven2/</url>\r\n\t\t<mirrorOf>ibiblio</mirrorOf>\r\n\t</mirror>\r\n</mirrors>\r\n\r\n```","objectID":"L2Rlc3RhY2F0cy1yZWxhdGVkL2RvbWluaS1pYmlibGlvLW5vdQ=="},"L2Rlc3RhY2F0cy1yZWxhdGVkL25vdmEtdmVyc2lvLXBpY2E=":{"date":1453939200000,"title":"Nova versió connector canigó PICA DNI","description":"","sections":"Canigó","key":"FEBRER2016","path":"/destacats-related/nova-versio-pica","content":"S'han publicat les versions 1.1.0 de canigo-connectors-pica-dni per a canigó 2 i 1.2.0 de canigo.integration.dni.pica per a canigó 3.\r\n\r\nAmb els nous canvis per a realitzar una consulta de DNI s'ha d'informar el primer cognom o l'any de naixement de la persona que es cerca, juntament amb els actuals camps obligatoris de documentació i tipus de documentació.\r\n\r\nPer a més informació podeu consultar la [documentació del connector](/canigo-documentacio-versions-3x-integracio/modul-dni/)","objectID":"L2Rlc3RhY2F0cy1yZWxhdGVkL25vdmEtdmVyc2lvLXBpY2E="},"L2Rlc3RhY2F0cy1yZWxhdGVkL3NnZGUtZGVwcmVjYWNpb3Y4":{"date":1436140800000,"title":"Recordatori: Eliminació de la versió v8 del servei d'Eformularis","description":"","sections":"SGDE","path":"/destacats-related/sgde-deprecaciov8","content":"Us recordem que tenim prevista l'eliminació per aquest any 2016 de la versió v8 del WS del servei d'eFormularis. Aquesta és la versió més antiga del WS, la URL de la qual és la següent per als entorns de PRE i PRO respectivament:\r\n\r\n* http://eformularis.pre.intranet.gencat.cat/ServeisInvocacio/services/ServeisAdobe?wsdl\r\n* http://eformularis.intranet.gencat.cat/ServeisInvocacio/services/ServeisAdobe?wsdl\r\n\r\nPreguem que tots els consumidors d'aquesta versió del WS d'eFormularis es posin en contacte amb el CS Canigó enviant-nos un correu a la bústia o bé creant una tasca de Suport al servei STF del JIRA CSTD. En data 15/7 es recopilaran totes les sol·licituds rebudes per ambdós canals i es planificarà conjuntament amb els responsables CTTI de les aplicacions afectades els deadlines per aquesta versió del WS als entorns de PRE i PRO.\r\n","objectID":"L2Rlc3RhY2F0cy1yZWxhdGVkL3NnZGUtZGVwcmVjYWNpb3Y4"},"L2Rlc3RhY2F0cy1yZWxhdGVkL3NnZGUtY2FtcHNyZXF1ZXJpdHM=":{"date":1436140800000,"title":"Recordatori: Obligatorietat de camps àmbit i aplicació als serveis de SGDE","description":"","sections":"SGDE","path":"/destacats-related/sgde-campsrequerits","content":"Us recordem que els camps `ambit` i `aplicacio` passaran a ser obligatoris per a totes les versions del WS publicades a la plataforma. El desplegament d'aquest canvi està planificat pel **28/09/2016** a l'entorn de PRE i el **28/11/2016** a l'entorn de PRO. Per tant, **totes les aplicacions hauran d'haver estat adaptades per informar aquests camps i desplegades en el corresponent entorn abans no es faci efectiu el canvi. En cas contrari les crides seran rebutjades**. Destacar que la validació afegida per aquests camps no suposa  regenerar de nou el client del WS, ja que els camps existeixen, només cal informar-los.\r\n","objectID":"L2Rlc3RhY2F0cy1yZWxhdGVkL3NnZGUtY2FtcHNyZXF1ZXJpdHM="},"L2Rlc3RhY2F0cy1yZWxhdGVkL3VwZ3JhZGUtbmV4dXM=":{"date":1437523200000,"title":"Upgrade Nexus al SIC","description":"","sections":"SIC","path":"/destacats-related/upgrade-nexus","content":"Amb la finalitat de disposar d'un servei actualitzat a les darreres versions de les diferents eines que en formen part s'ha realitzat una actualització del Nexus del SIC. La versió [2.11.3-01](https://support.sonatype.com/entries/94172767-Sonatype-Nexus-2-11-3-Release-Notes) instal·lada, a diferència de la versió anterior existent al SIC, permet configurar repositoris [NuGet](https://www.nuget.org/). NuGet és el gestor de paquets que s'utilitza a .NET, i d'aquesta manera, es segueix preparant el SIC per possibilitar la integració d'aquesta tecnologia.","objectID":"L2Rlc3RhY2F0cy1yZWxhdGVkL3VwZ3JhZGUtbmV4dXM="},"L2Rlc3RhY2F0cy1yZWxhdGVkL3Rlc3QtamFycy1jYW5pZ28=":{"date":1515542400000,"title":"Canigó. Tests unitaris integrats als binaris de Canigó","description":"Amb l'objectiu que els proveïdors d'aplicacions puguin provar el funcionament dels mòduls de Canigó, podent sobreescriure versions de llibreries, es proporcionen binaris amb els tests unitaris integrats. A aquests binaris els coneixem com a test-jars","sections":["Canigó"],"categories":["canigo"],"key":"GENER2018","path":"/destacats-related/test-jars-canigo","content":"Amb l'objectiu que els proveïdors d'aplicacions puguin provar el funcionament dels mòduls de Canigó, podent sobreescriure versions de llibreries, es proporcionen binaris amb els tests unitaris integrats. A aquests binaris els coneixem com a **test-jars**.\r\n\r\nEn ocasions, pot sorgir la necessitat per part del proveïdor d'aplicacions d'utilitzar una versió més recent d'alguna llibreria respecte a la que incorpora Canigó, sense poder esperar a una nova versió del framework que la incorpori. Exemples de llibreries poden ser Spring Framework o Hibernate. Els motius poden ser diversos, principalment:\r\n\r\n- Actualització a una fix version que soluciona algun **bug** que afecta a alguna funcionalitat de l'aplicació\r\n- Actualització a una minor o major version que incorpora alguna **nova funcionalitat** requerida per l'aplicació\r\n\r\nAixò pot presentar un problema si el proveïdor d'aplicacions reemplaça la llibreria sense garanties que els serveis de Canigó afectats continuin funcionant de forma satisfactòria. És per aquest motiu que des del CS Canigó es proporcionen els test-jars i es defineix com utilitzar-los. Un exemple d'ús pràctic el podeu trobar en el [how-to](http://canigo.ctti.gencat.cat/drafts/2018-01-howto-test_jars_canigo/) publicat aquest mes.\r\n\r\nD'inici, no es proporcionen test-jars per a tots els serveis Canigó, sino només pels considerats com a principals:\r\n\r\n- *Servei Core*: \"canigo.core\" versió 3.2.3 o superior\r\n- *Servei Web REST*: \"canigo.web.rs\" versió 1.1.1 o superior\r\n- *Servei de Persistència*: \"canigo.persistence.jpa\" versió 1.2.2 o superior\r\n- *Servei de Seguretat*: \"canigo.security\" versió 1.2.3 o superior\r\n\r\nAquests binaris estan publicats al Nexus del SIC. Els podeu trobar al [repositori Maven públic](https://hudson.intranet.gencat.cat/nexus/#browse/search/maven) cercant pel groupId \"cat.gencat.ctti\", i \"artifactId\" i \"version\" especificats al llistat anterior.\r\n\r\nPer qualsevol dubte relatiu a l'ús dels test-jars a Canigó 3.2, us podeu posar en contacte amb el CS Canigó enviant un correu a [oficina-tecnica.canigo.ctti@gencat.cat](mailto:oficina-tecnica.canigo.ctti@gencat.cat) o bé fent-nos arribar una petició de consulta/suport al [CSTD](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN/).\r\n","objectID":"L2Rlc3RhY2F0cy1yZWxhdGVkL3Rlc3QtamFycy1jYW5pZ28="},"L2RpcmVjdG9yaXMtaW50ZWdyYWNpby9hcnFyZWNvZGly":{"date":1504887102000,"title":"Arquitectures d'autenticació recomanades per aplicacions que requereixen de Windows Authentication","description":"","section":"directoris-integracio","taxonomies":[],"toc":false,"weight":5,"path":"/directoris-integracio/arqrecodir","content":"## Arquitectures d'autenticació recomanades per aplicacions que requereixen de Windows Authentication\r\n\r\nNormalment la infraestructura de les aplicacions de la Generalitat de Catalunya, segueix una arquitectura de tres capes, on tenim un Apache + Servidor d’aplicacions + Base de dades.\r\n\r\n![Integració amb els Directoris de la Generalitat](/related/directoris-integracio/dir - 3capes.PNG)\r\n\r\nEn cas que es necessiti que l’aplicació faci servir Windows Authentication, cal revisar bé com resoldre-la, de cara a que els tokens d’autenticació facin “pass-through” dels frontals i arribin als servidors d’aplicacions que és on es processa aquest token.\r\n \r\nLa implementació de Windows Authentication (Kerberos, Negotiate, o NTLM) es pot dur a terme segons la seva compatibilitat amb “Basic Authentication”.\r\n\r\n### Producte compatible amb “Basic Authentication”.\r\n\r\nActivant “Basic Authentication” les peticions d’autenticació passen a fer-se via HTTP, i com a resultat d’això, les peticions flueixen a través de l’Apache.\r\n\r\n![Integració amb els Directoris de la Generalitat](/related/directoris-integracio/dir - 3capesBasicAuth.PNG)\r\n\r\n•\tAquesta és una solució senzilla, i és la recomanada en cas que el producte o aplicació ho suporti. \r\n•\tTé, com a contrapartida, la pèrdua del Single Sign On amb l’estació de treball de l’usuari, tot i que l’usuari de la màquina i el que es faci servir per a accedir a l’aplicació sigui el mateix.\r\n•\tAquesta opció obliga a instal·lar un certificat digital de servidor a la màquina de l’Apache, per a assegurar que el pas de credencials des del navegador de l’usuari cap al servidor Web de la Generalitat es fa de forma xifrada.\r\n•\tEl proveïdor d’aplicacions ha de validar:\r\no\tQue el producte a integrar sigui compatible amb aquest esquema d’autenticació, i en cas que no, buscar altres maneres de realitzar l’autenticació.\r\no\tQue encara que el producte sigui compatible amb aquest esquema d’autenticació, quan es necessita que diversos servidors recullin els tokens d’autenticació, no sigui un problema el fet de passar els tokens d’autenticació a través d’aquest protocol per a mantenir el Single Sign on entre capes.\r\n\r\n\r\n### Producte no compatible amb “Basic Authentication”.\r\n \r\nDepenent de la tipologia d’autenticació de l’aplicació, es defineixen les següents alternatives: \r\n\r\n\r\n![Integració amb els Directoris de la Generalitat](/related/directoris-integracio/dir - 3capeskerbAuth.PNG)\r\n\r\n\r\n- **Vàlid per Kerberos, Negotiate o NTLM:**\r\n\r\nS’utilitzarà el  IIS com a frontal. Els IIS de forma nativa ja gestionen i recullen la Windows Authentication, aprofitant aquesta funcionalitat per a posar un IIS de frontal, i recollir el testimoni d’autenticació de les aplicacions.\r\n\r\n•\tNativament el IIS pot fer proxy invers dels tokens d’autenticació.\r\n•\tEl proveïdor de l’aplicació ha de validar la solució en entorns de desenvolupament, per tal d’assegurar que l’aplicació és compatible amb aquesta arquitectura.\r\n\r\n\r\n- **Vàlid per Kerberos o Negotiate:**\r\n\r\nS’utilitzarà un Apache com a frontal. L’Apache recull els tiquets Kerberos i els passa a les capes inferiors.\r\n•\tL’Apache ha de fer servir el mòdul que permet autenticació via Kerberos / Negotiate Authentication .\r\n•\tUtilitzant aquest mòdul, l’Apache recull el tiquet Kerberos que s’ha generat en el PC de l’usuari per passar-lo a capes inferiors.\r\n•\tEl proveïdors d’aplicacions ha de \r\n\to\tValidar com l’aplicació a través del seu IIS pot recollir el tiquet de Kerberos i utilitzar-lo per a autenticar. \r\n\to\tValidar la solució en entorns de desenvolupament, per tal d’assegurar que l’aplicació és compatible amb aquesta arquitectura.\r\n\r\nEn cas que cap de les anteriors opcions d’arquitectura pugui ser implantada, l’Àrea d’Arquitectura del CTTI validarà si és possible que l’aplicació pugui funcionar sense frontal, fent que l’IIS jugui el rol de frontal i de servidor d’aplicacions alhora.\r\n","objectID":"L2RpcmVjdG9yaXMtaW50ZWdyYWNpby9hcnFyZWNvZGly"},"L2Rlc3RhY2F0cy1yZWxhdGVkL3NpYy1uZXQ=":{"date":1435622400000,"title":".NET al SIC","description":"","sections":"SIC","path":"/destacats-related/sic-net","content":"La integració del llenguatge .NET al SIC s'està realitzant gràcies a l'ús dels diferents slaves Windows que formen part del nou SIC Multi-CPD. Aquests slaves amb SO Windows permeten la compilació de .NET. Per més informació del nou model SIC MUlti-CPD podeu seguir el següent [enllaç](http://canigo.ctti.gencat.cat/noticies/2015-04-30-SIC-Master-Slave-CPD4/) on es presenta el primer slave posat en marxa a CPD4-TSystems.\r\n\r\nDes de l'equip del SIC s'està treballant en els següents punts:\r\n\r\n* *Custodia de codi*: gestió de versions al SVN del codi font de les aplicacions. Caldrà sol·licitar excepcions per poder emmagatzemar fitxers .dll al SVN.\r\n* *Compilació*: ús del plugin MSBuild de Jenkins per la compilació d'aplicacions .NET. Caldrà especificar la versió de .NET i Visual Studio (mòduls Web i WebApplications). Gestió de dependències amb [NuGet](https://www.nuget.org/).\r\n* *Auditories*: integració amb Fortify (Anàlisi de Seguretat) i CAST (Anàlisi de Qualitat) per auditories de codi.\r\n* *Desplegaments*: desplegaments a IIS amb MSDeploy.\r\n\r\nUn cop hagi finalitzat aquesta integració, es notificarà en un comunicat amb tot el detall pel seu ús per part dels proveïdors d'aplicacions.","objectID":"L2Rlc3RhY2F0cy1yZWxhdGVkL3NpYy1uZXQ="},"L2RpcmVjdG9yaXMtaW50ZWdyYWNpby9JbnRybw==":{"date":1504887102000,"title":"Introducció","description":"Introducció a l'arquitectura de Directoris de la Generalitat","section":"directoris-integracio","taxonomies":[],"toc":false,"weight":2,"path":"/directoris-integracio/Intro","content":"Tota aplicació que requereixi autenticació als Active Directory de la Generalitat de Catalunya (en endavant, directoris) ha de integrar-se als mateixos de la manera més estàndard possible, aprofitant les eines i bones pràctiques posades a disposició del desenvolupament per part de la Generalitat de Catalunya.\r\n\r\nAquesta guia descriu les directrius i recomanacions més rellevants que han de complir els productes i les aplicacions, per portar a terme la integració d’aplicacions que requereixin de Windows Authentication amb els directoris de la Generalitat, per a assolir l’objectiu de poder implementar els serveis d’autenticació i autorització que es requereixin. \r\n\r\nAquesta guia no està dirigida a aplicacions J2EE estàndard, sinó que està pensada específicament per aplicacions i productes tancats que requereixin Windows Authentication per a poder autenticar i autoritzar. Per aquestes aplicacions es recomana fer servir el model que es descriu en la Guia d’Integració d’Aplicacions amb GICAR, donat que el model d’autenticació és molt més escalable, versàtil, flexible i senzill. \r\n\r\nLes directrius indicades en aquest document apliquen:\r\n\r\n- A tots els productes i aplicacions que utilitzin Windows Autentication o susceptibles d’autenticar usuaris amb Directori Actiu.\r\n- A tots els proveïdors de desenvolupament i manteniment d’aplicacions, i també als proveïdors de CPD.\r\n\r\nA continuació, a mode de glossari, es defineixen diversos dels tecnicismes que es citen a la Guia\r\n- AD: Active Directory.\r\n- CN: Common Name. Atribut que identifica un objecte personal d’un directori o un grup.\r\n- CMO: Current Model Operation: infraestructures heretades dels models TIC de la Generalitat anteriors.\r\n- FMO: Future Model Operation: infraestructures noves desplegades arrel del model TIC actual de la Generalitat de Catalunya.\r\n- GICAR: Gestió d’Identitats I Control d’Accés als Recursos. Sistema de gestió d’identitats corporatiu de la Generalitat.\r\n- OU: Unitat Organitzativa d’un directori. És la unitat d’agregació d’un directori sota el qual poden haver-hi altres objectes d’un directori, com podrien ser objectes personals o grups.\r\n- Proxy Invers: configuració que es pot fer en un frontal web (apache o IIS) que permet fer servir el frontal com a punt d’accés únic per accedir als continguts de diversos servidors d’aplicacions.\r\n- Relació de confiança: configuració que es pot dur a terme a dins de un domini, on es permet a els usuaris d’un domini a fer certes operacions en recursos d’un altre domini. Amb aquestes configuracions es permet la interoperabilitat d’operacions d’usuaris entre diferents dominis.\r\n- TIC: Tecnologies de la Informació i les Comunicacions.\r\n- Windows Authenticacion: protocols d’autenticació propis dels sistemes operatius Windows i suportats per la majoria de productes Microsoft.\r\n \r\n","objectID":"L2RpcmVjdG9yaXMtaW50ZWdyYWNpby9JbnRybw=="},"L2RpcmVjdG9yaXMtaW50ZWdyYWNpby9pbnRhcHNkaXI=":{"date":1504887102000,"title":"Integració d'aplicacions per autenticació en el nou model de directoris ","description":"","section":"directoris-integracio","taxonomies":[],"toc":false,"weight":4,"path":"/directoris-integracio/intapsdir","content":"Les aplicacions objecte d’aquesta guia i que autentiquin usuaris a través del protocol de Windows Authentication, seguiran les següents directrius per a integrar-se en el model de directoris:\r\n\r\n### Entorns de desenvolupament per a provar les solucions\r\n\r\nEl proveïdor d’aplicacions haurà de fer les proves unitàries de l’aplicació/producte sobre un entorn de desenvolupament que ell mateix haurà de construir-se, i que haurà de reproduir de forma fidedigna a l’arquitectura de directoris i d’usuaris descrita en el capítol 1.\r\n\r\n### Ús dels dominis per part dels servidors de les aplicacions\r\n\r\n- El servidor Windows (ja sigui per a un IIS, o per a un SQL Server) sobre el qual estigui desplegada l’aplicació, ha d’estar registrat sobre un dels dominis de CPD (cpdx.intranet.gencat.cat). En cap cas el servidor Windows es podrà registrar directament en el domini de lloc de treball (a excepció dels serveis propis de Lloc de treball). El domini de CPD no té usuaris nominals, ja que estan definits a LT2 (domini de lloc de treball).\r\n- El servidor Windows i l’aplicació han d’utilitzar la relació de confiança existent amb els directoris de lloc de treball de LT2 (FMO) per a cercar els usuaris nominals a validar. La relació de confiança sempre serà seguint la següent direcció: AD CPD --> AD LT2.\r\n\r\n### Autenticació\r\n\r\n- L’aplicació ha d’autenticar els usuaris seguint la següent nomenclatura:\r\n• Nom d’usuari: GCA\\<DNI usuari> o  GCB\\<DNI usuari> o  GCC\\<DNI usuari>.\r\n• Contrasenya: ha de ser la de GICAR.\r\n- El proveïdor d’aplicacions, per a la correcta autenticació de l’usuari, haurà de suportar-se en els proveïdors de Lloc de treball per a validar la implantació de les següents recomanacions en les estacions de treball:\r\n• Existència d’un controlador de domini, que li pugui generar els tiquets Kerberos, o que li serveixi per a poder atendre a peticions d’autenticació NTLM. \r\n• Tenir capacitat per a resoldre els dominis dels directoris de lloc de treball de LT2 (FMO). GCA, GCB, i GCC\r\n\r\n### Autorització\r\n\r\n- Quan sigui necessari autoritzar als usuaris, l’aplicació ha d’utilitzar grups de seguretat locals del directori de CPD.\r\n- Els grups locals del directori de CPD, podran contenir:\r\n• Grups universals dels directoris de LT2. \r\nAquesta és l’opció òptima, donat que d’aquesta manera el manteniment de l’autorització dels usuaris sobre el grup local de CPD podrà fer-lo de forma autònoma l’administrador del directori de LT2, posant els usuaris a dins dels grups universals d’autorització de LT2.\r\n• Objectes usuari dels directoris de LT2.\r\nEn el següent esquema s’il·lustra el plantejament dut a terme.\r\n\r\n![Integració amb els Directoris de la Generalitat](/related/directoris-integracio/dir - grups.PNG)\r\n\r\n### Consulta de dades d’usuaris\r\n\r\n• L’aplicació no ha de fer consultes LDAP directament contra els directoris de lloc de treball de la Generalitat.\r\n• L’aplicació ha d’utilitzar els mecanismes proporcionats per GICAR per a la consulta d’usuari (Web Service de GDI). A través d’aquest Web Service es podran consultar les dades dels usuaris de la Generalitat de Catalunya.\r\n\r\nPer a més detall veure el document “Integració amb el Webservice de GICAR”\r\n","objectID":"L2RpcmVjdG9yaXMtaW50ZWdyYWNpby9pbnRhcHNkaXI="},"L2RpcmVjdG9yaXMtaW50ZWdyYWNpby9zaXRhY3R1YWw=":{"date":1504887102000,"title":"Descripció de la situació actual dels directoris de la Generalitat","description":"Mapa actual de Directoris de la Generalitat","section":"directoris-integracio","taxonomies":[],"toc":false,"weight":3,"path":"/directoris-integracio/sitactual","content":"### Context organitzatiu:\r\n\r\nL’actual organització TIC de la Generalitat, contempla els següents elements que són decisius a l’hora d’exposar l’arquitectura de directoris definida:\r\n\r\nProveïdors de Lloc de Treball: cada proveïdor de lloc de treball disposa d’un directori que dóna servei a cadascun dels Lots de lloc de treball, definint els següents interlocutors:\r\n\r\n\t- LT1:  proveïdor  que  gestiona  els  serveis  de  lloc  de  treball  transversals  (Correu, Sharepoint, Lynk, i File)\r\n\r\n\t- LT2A: proveïdor que gestiona el servei de lloc de treball d’Ensenyament ( Plataforma, PC, i Printing)\r\n\t- LT2B: proveïdor que gestiona el servei de lloc de treball de Governació, Empresa i Ocupació, Benestar Social i Família, Economia i Coneixement, Presidència, i Salut ( Plataforma, PC, i Printing)\r\n\t- LT2C: proveïdor que gestiona el servei de lloc de treball de Justícia, Agricultura, Cultura, Territori i Sostenibilitat ( Plataforma, PC, i Printing).\r\n\r\n\tAquests directoris de LT2A, LT2B i LT2C, contenen:\r\n\t- Les identitats de les persones que treballen en cadascun d’aquests departaments de la Generalitat.\r\n\t- Els objectes de les màquines (màquines, impressores, etc)  que s’utilitzen per a treballar en aquests departaments.\r\n\t- Els grups de seguretat que tenen associades totes aquestes persones i objectes de màquina anteriorment definits.\r\n\r\nProveïdors de CPD: cada proveïdor de CPD disposa d’un directori (CPD1 o  CPD2 o  CPD3 o  CPD4).\r\n\r\n\tAquests directoris contenen:\r\n\t- Els objectes de les màquines i servidors que hi ha a cada CPD.\r\n\t- Els usuaris tècnics de servei d’aquests servidors i màquines.\r\n\t- Els grups de seguretat corresponents als anteriors objectes i usuaris tècnics.\r\n\r\nA banda d’això, els directoris de CPD:\r\n\r\n\t- Actuaran fent les funcions de DNS pels servidors del propi CPD (resolent els dominis interns de les màquines del CPD). Així doncs, el servidors DNS centrals del nus XCAT, delegaran la zona cpdx.intranet.gencat.cat i cpdxpre.intranet.gencat.cat als directoris de CPD.\r\n\r\n\t- Actuaran fent funcions de NTP pels servidors del propi CPD. Recolliran l’hora dels servidors NTP de nus i seran els encarregats de distribuir-la pels servidors del propi CPD.\r\n\r\n### La gestió d'identitats corporativa:\r\n\r\nA l’hora d’avaluar les relacions entre directoris de lloc de treball de LT1 i LT2, cobra un paper clau la Gestió d’Identitats Corporativa (Gestió d’Identitats i Control d’Accés als Recursos – GICAR), donat que és l’element encarregat d’automatitzar i normalitzar les següents tasques:\r\n- Alta, baixa, i modificació dels usuaris de la Generalitat en els corresponents directoris de lloc de treball LT2 (FMO).\r\n- Canvi de contrasenya i suspensió dels usuaris en els diferents directoris.\r\n\r\nEn la següent il·lustració es mostra el flux de propagació de la informació dels usuaris establert:\r\n\r\n![Integració amb els Directoris de la Generalitat](/related/directoris-integracio/dir - gicar.PNG)\r\n\r\n•\tEls  interlocutors  de  RRHH  dels  diferents  departaments  treballen  sobre  les  eines  que  tenen establertes a per a dur a terme l’alta, la baixa i la modificació dels usuaris (GIP/SIP i GDI).\r\n\r\n•\tL’eina de gestió d’identitats corporativa (GICAR), detecta els canvis produïts per les diferents eines de RRHH, i a través d’aquests canvis gestiona el cicle de vida de les identitats.\r\n\r\n•\tGICAR aprovisiona aquests canvis als directoris de Lloc de treball de forma automàtica (LT1, i LT2A, LT2B, i LT2C).\r\n\r\n### Els directoris de LT1 i LT2\r\n\r\nEls noms de domini que tenen els directoris de lloc de treball de LT1 i LT2, són els següents:\r\n\r\n\t\tLT1\t\t•\tPRO: ssccit.gencat\r\n\r\n\t\tLT2A\t•\tPRE: GCAPRE.intranet.gencat.cat\r\n\t\t\t\t•\tPRO: GCA.intranet.gencat.cat\r\n\r\n\t\tLT2B\t•\tPRE: GCBPRE.intranet.gencat.cat\r\n\t\t\t\t•\tPRO: GCB.intranet.gencat.cat\r\n\r\n\t\tLT2C\t•\tPRE: GCCPRE.intranet.gencat.cat\r\n\t\t\t\t•\tPRO: GCC.intranet.gencat.cat\r\n\r\nL’estructura lògica interna dels directoris de lloc de treball, ha de ser, la que es descriu a continuació.\r\nA més de les OUs i contenidors generats per defecte per un domini basat en Windows (com els contenidors \"Users\" i \"Computers\" o la unitat organitzativa \"Domain Controllers\"), el directori ha de contenir les següents cinc Unitats Organitzatives:\r\n\r\n\t- Persones\r\n\t- Grups\r\n\t- Usuaris Tècnics Funcionals\r\n\t- Usuaris Tècnics de Servei\r\n\t- Equips\r\n\r\n, tal com es mostra en el dibuix:\r\n\r\n![Integració amb els Directoris de la Generalitat](/related/directoris-integracio/dir-ous.PNG)\r\n\r\n\r\n\r\n- **Branca Persones**\r\n\r\nLa OU de \"Persones\" ha de contenir tots els comptes d'usuari que han d’estar en els directoris, i que han d’estar vinculats amb identitats donades d'alta a GICAR. La OU de “Persones” estarà organitzada pels departaments als quals dóna suport el LOT en qüestió. Dins de cada una d’aquestes OU departamentals existiran 3 unitats organitzatives:\r\n\r\n•\t“Pendents  Alta”  la  qual  serà  la  OU  on  GICAR  deixa  els  usuaris  pertanyents  a  cada  un  dels departaments quan són creats i previ pas a ser mogut manualment per un administrador a la seva OU definitiva (es mouran a una dels OUs corresponents als organismes pertanyents a aquest departament).\r\n•\t“Pendents Baixa” la qual allotjarà els usuaris que en breu seran donats de baixa. GICAR gestiona automàticament i de forma automatitzada l’alimentació d’aquestes OU’s.\r\n•\t“Organismes”  la  qual  estarà  composta  per  una  OU  per  cadascun  dels  organismes  dependents d'aquest departament.\r\n\r\n![Integració amb els Directoris de la Generalitat](/related/directoris-integracio/dir-ous-persones.PNG)\r\n  \r\nLa branca d’Organisme tindrà definida l’estructura d’arbre que el lot hagi definit per a gestionar el lloc de treball d’aquell departament. És una branca la qual la seva estructura serà definida segons criteri del proveïdor de lloc de treball, tanmateix es demana que aquesta estructura es defineixi el més semblant possible a la estructura organitzativa del departament o organisme al qual se li doni servei, i que aquesta estructura pugui facilitar implementar polítiques de seguretat sobre els usuaris que estiguin dins d’aquesta branca.\r\n\r\nLa clau pública del certificat X509 de l’usuari podrà estar emmagatzemada en els directoris de lloc de treball, com un atribut més de la identitat. Aquesta clau pública s’emmagatzemarà en l’atribut “X509-Cert” de la identitat. \r\n\r\n\r\n- **Branca de Grups**\r\n\r\nLa OU \"Grups\" ha d’estar dividida per la OU \"Departamentals\" i la OU “Corporatius\". \r\n\r\nLa OU \"Departamentals\" estarà organitzada per departament, i dins d'aquesta OU es proposa l'estructura:\r\n\r\n\t•\tUna OU per organisme: l’estructura d'OU’s ubicada dins d'aquesta és una aproximació a l'actual estructura d'OUs existents dins dels dominis actuals, i facilita la identificació dels grups migrats dins del nou domini.\r\n\r\n\t•\tUna OU per aplicació o accés a recurs (\"Aplicació N\"): es crearan tantes OUs com aplicacions o accessos a tipus de recurs. Per exemple, si es requereix crear grups d'usuaris per crear unitat de xarxa, es crearà una OU anomenada \"Assignació Unitats de xarxa\", i dins d'aquesta es crearien els grups d'usuari necessaris als quals se'ls configurarà una unitat de xarxa.\r\n\r\nAddicionalment els següents grups es generaran a la OU “Departamentals”:\r\n\r\n\t•\tNadiu_DeptN: donarà accés a les aplicacions/recursos propis d'un departament amb el rol d'usuari intern del departament. Tot usuari intern del departament tindrà aquest grup.\r\n\r\n\t•\tConvidat_DeptN: donarà accés a les aplicacions/recursos propis d'un departament amb el rol d'usuari convidat. Tot usuari extern del departament tindrà aquest grup.\r\n\r\n\t•\tDeshabilitat_DeptN: donarà accés a les aplicacions/recursos propis d'un departament amb el rol que sigui, a posteriori que aquests usuaris s'hagin donat de baixa.\r\n\r\nLa OU \"Corporatius\" inclou tres grups generats per GICAR i els membres del grup també seran subministrats per la mateixa eina. Són grups d'ús optatiu:\r\n\r\n\t•\tNadiu_Corporatiu: donarà accés a les aplicacions/recursos corporatius amb el rol d'usuari intern de la Generalitat. Tot usuari intern de la Generalitat tindrà aquest grup.\r\n\r\n\t•\tConvidat_Corporatiu:  donarà  accés  a  les  aplicacions/recursos  corporatius  amb  el  rol d'usuari extern a la Generalitat. Tot usuari extern de la Generalitat tindrà aquest grup.\r\n\r\n\t•\tDeshabilitat_Corporatiu: donarà accés a les aplicacions/recursos corporatius encara que l'usuari ja no formi part de la Generalitat.\r\n\r\n\r\nA través d’aquests grups definits en la branca de grups és possible fer que les aplicacions puguin autoritzar a un conjunt d’usuaris en concret.\r\n\r\nEs recomana que les aplicacions corporatives que hagin de ser usades per personal intern utilitzin els grups Nadiu_Corporatiu per a treballar.\r\n\r\nPer altra banda, es recomana que les aplicacions departamentals que hagin de ser usades per personal intern dels departaments, utilitzin el grup Nadiu_DeptN per a poder treballar.\r\n\r\n\r\n- **Branca d’usuaris tècnics funcionals.**\r\n\r\nAquesta branca tindrà una estructura igual a la OU ‘Departamentals’ de dins de la OU de ‘Grups’. D’aquest arbre d’OU’s penjarà una OU per a cada aplicació. Dins de cadascuna d’aquestes OU’s d’aplicació estaran ubicats els usuaris tècnics funcionals. La nomenclatura d’aquests usuaris es deixarà a criteri del proveïdor de Lloc de Treball.\r\n\r\n\r\n- **Branca d’usuaris tècnics de servei.**\r\n\r\nAquesta branca tindrà una estructura igual a la OU ‘Departamentals’ de dins de la OU de ‘Grups’. D’aquest arbre d’OU’s penjarà una OU per a cada aplicació. Dins de cadascuna d’aquestes OU’s d’aplicació, estaran ubicats els usuaris tècnics de serveis. La nomenclatura d’aquests usuaris es deixarà a criteri del proveïdor de Lloc de Treball.\r\n\r\n\r\n- **Branca d’equips**\r\n\r\nAquesta branca serà lliure, a partir dels criteris de gestió de la mateixa que defineixi el proveïdor de Lloc de Treball.\r\n\r\n\r\n- **Convivència amb els directoris de lloc de treball NO TRANSFORMATS (CMO)**\r\n\r\nFins al desplegament del nou model TIC, cada departament tenia el seu directori departamental NO TRANSFORMAT (CMO). Aquests directoris són els utilitzats per les estacions de treball no transformades (antics lots de lloc de treball de l’anterior model TIC, que s’extingiran un cop s’hagi fet la transformació de lloc de treball dels PC’s d’aquell departament), i per les aplicacions que encara no s’han migrat cap al directori de CPD.\r\n\r\nMentre el lloc de treball de l’usuari no s’hagi transformat, s’ha de considerar que els PC’s dels usuaris estaran al domini de lloc de treball CMO. Això és clau tenir-ho present de cara a avaluar si les aplicacions podran funcionar correctament en aquest entorn.\r\n\r\nEls directoris de lloc de treball CMO contenen:\r\n•\tUsuaris.\r\n•\tEquips PC no transformats.\r\n•\tServidors.\r\n•\tGrups d’autorització (aplicacions i servidor de fitxers).\r\n\r\nL’estructura i nomenclatura de dominis d’aquests directoris és No Homogènia entre departaments, i no és objectiu d’aquest document descriure-la.\r\n\r\n### Els directoris de CPD\r\n\r\nCada CPD disposa d’un directori que té com a objectiu donar suport als servidors Windows que calgui donar d’alta en cada CPD.\r\n\r\nAquests directoris tenen les següents funcions:\r\n•\tRegistrar en domini els servidors donats d’alta.\r\n•\tDisposar de grups d’autorització d’accés als serveis de CPD.\r\n•\tDisposar d’usuaris tècnics per a aixecar serveis i arrencar processos.\r\n\r\nL’estructura d’aquests directoris de CPD és la mateixa que els directoris LT1 i LT2 FMO, amb la diferència de que els directoris de CPD no contenen usuaris personals (únicament disposen d’usuaris tècnics), donat que aquests usuaris es troben definits als directoris de LT1 i de LT2.\r\n\r\nEls noms de domini que tenen els directoris de CPD, són els següents:\r\n\r\n\t\tCPD1\t•\tPRE: CPD1PRE.intranet.gencat.cat\r\n\t\t\t\t•\tPRO: CPD1.intranet.gencat.cat\r\n\t\tCPD2\t•\tPRE: CPD2PRE.intranet.gencat.cat\r\n\t\t\t\t•\tPRO: CPD2.intranet.gencat.cat\r\n\t\tCPD3\t•\tPRE: CPD3PRE.intranet.gencat.cat\r\n\t\t\t\t•\tPRO: CPD3.intranet.gencat.cat\r\n\t\tCPD4\t•\tPRE: CPD4PRE.intranet.gencat.cat\r\n\t\t\t\t•\tPRO: CPD4.intranet.gencat.cat\r\n\r\n\r\n### Relacions de confiança entre els directoris de la Generalitat\r\n\r\nEl model preveu que existeixin les següents relacions de confiança entre les diferents tipologies de directori:\r\n\r\n\r\n![Integració amb els Directoris de la Generalitat](/related/directoris-integracio/dir - relconf.PNG)\r\n  \r\n\r\nEn el següent diagrama es mostren les relacions de confiança previstes entre directoris.\r\n\r\n\r\n![Integració amb els Directoris de la Generalitat](/related/directoris-integracio/dir - relconf - diag.PNG)\r\n\r\n","objectID":"L2RpcmVjdG9yaXMtaW50ZWdyYWNpby9zaXRhY3R1YWw="},"L2dpY2FyL2Rlc2NyaXBjaW8=":{"date":1465402302000,"title":"Descripció del servei","description":"Informació general del servei GICAR","sections":"GICAR","taxonomies":[],"toc":true,"weight":1,"path":"/gicar/descripcio","content":"Aquesta guia descriu els aspectes més rellevants per portar a terme la integració d’aplicacions amb la plataforma de Gestió d’Identitats i Control d’Accés als Recursos (en endavant GICAR). GICAR és l’eina amb que s’ha dotat a la Generalitat de Catalunya per a la gestió centralitzada de les identitats de persones que interactuen amb els sistemes d’informació.\n\nGICAR proveeix principalment dos grans funcionalitats:\n\n<br />\n\n1. **Autenticació**: on es descriuen els mecanismes per integrar el model d’autenticació de GICAR amb les aplicacions que s’hi vagin integrant. \n\n\tEn el següent esquema s’especifica a mode general quines són les aplicacions que es recomana que siguin integrades amb GICAR a nivell d’autenticació, i quines es recomana que s’integrin per altres sistemes d’autenticació.\n\n\t![Integració Aplicacions GICAR](/related/gicar/tipus-autenticacio.png)\n\n\tPer aplicacions que calgui integrar-les amb sistemes d’autenticació basats en Windows Autentication, caldria adreçar-se a la “Guia d’Integració amb els directoris del nou model TIC”\n\n\t<br /><br />\n\n1. **Provisió**: on es descriuen els mecanismes per poder gestionar els recursos (aplicacions) a les que té accés una identitat del Directori Corporatiu.\n\n\tEs important remarcar que el Directori Corporatiu és el dipòsit central d’identitats de GICAR i que, per tant, és requisit indispensable estar al Directori Corporatiu per poder gaudir de tots els serveis i funcionalitats que aporta la plataforma.\n\n### Esquema general de GICAR\n\nPer facilitar la comprensió de la plataforma de Gestió d’Identitats, s’inclou a continuació un esquema de l’arquitectura de capes que configuren la plataforma GICAR.\n\n\n![Integració Aplicacions GICAR](/related/gicar/esquema-general-gicar.png)\n\n\nLa plataforma GICAR es fonamenta bàsicament en dos objectius principals:\n- Facilitar la gestió de les identitats (persones) de treballen o col•laboren amb la Generalitat de Catalunya (funcionaris, interins, empreses públiques, externs, etc).\n- Facilitar la gestió i el control de l’accés als recursos per part de les identitats, entenent com a recurs qualsevol eina, sistema d’informació o aplicació necessari per a què el professional desenvolupi les seves funcions.\n\nTal i com s’ha indicat, el dipòsit central d’identitats de GICAR és el Directori Corporatiu de la Generalitat de Catalunya. Aquest Directori permet gestionar els següents tipus de col•lectius d’identitats:\n\n- El col·lectiu T1: professionals de la Generalitat de Catalunya gestionats des de l’aplicació de personal GIP/SIP, és a dir, tots aquells que cobren la seva nòmina des de l’aplicació de personal.  En general, funcionaris que treballen als departaments.\n\n- El col·lectiu T2: professionals de la Generalitat no gestionats des de l’aplicació de personal GIP/SIP, és a dir, tots aquells que no cobren la seva nòmina des de GIP/SIP.  En general, personal d’empreses públiques, consorcis, ...\n\n- El col·lectiu T3: professionals que col•laboren amb la Generalitat. En general, treballadors temporals, oficines liquidadores, personal d’altres administracions / organismes / ens locals, becaris, ...\n\n\nActualment es disposa de dues vies per donar d’alta/baixa/modificar identitats del Directori Corporatiu, que es descriuen a continuació:\n\n1.\tVia GIP/SIP: utilitzat només per identitats del col.lectiu T1. Quan una identitat modifica el seu estat en el GIPSIP (Alta/Baixa/Modificació), es llança un procés batch que alimenta el Directori Corporatiu amb els canvis que han tingut lloc. El GIPSIP sempre actuarà com a mestre de dades del Directori per identitats tipus T1.\n\n2.\tVia GDI (Gestió d’Identitats): eina que permet fer l’alta / baixa / modificació d’identitats T1, T2, T3 i no-nominals al Directori Corporatiu. Per les identitats T1, un cop se’ls ha assignat un Lloc de Treball, passaran a dependre exclusivament de GIP/SIP i amb GDI no es podran modificar. \n\nPel que fa als mecanismes d’autenticació d’usuaris, la plataforma disposa de la següent eina:\n\n- SiteMinder: que s’ocupa de l’autenticació d’identitats al Directori Corporatiu que intenten accedir a aplicacions Web (ja sigui amb usuari i contrasenya o bé amb certificat Digital). És una eina, com es veurà en el següent punt, que permet disposar de Single Sign On d’aplicacions Web. A banda del Directori Corporatiu, aquest component també permet autenticar usuaris de les administracions locals de Catalunya (a través del directori de l’EACAT), i permet autenticar certificats digitals vàlids, a través del servei de PSIS del Consorci AOC.\n\nPel que fa als mecanismes de provisió i control d’accés a recursos, GICAR aporta les següents funcionalitats:\n\n- Disposa d’una eina de Workflow per gestionar les peticions d’alta/baixa/modificació d’accés a recursos (aplicacions)\n- Disposa d’una eina de recordatori de contrasenya, que permet que cada identitat del Directori Corporatiu es gestioni la seva pròpia contrasenya.\n- Disposa d’una eina per sincronitzar la contrasenya de diferents aplicacions.\n- Permet controlar i administrar l’accés a les aplicacions integrades en GICAR\n\nActualment la plataforma de Gestió d’Identitats disposa de dos entorns:\n\n- Entorn de Pre-Producció\n- Entorn de Producció\n","objectID":"L2dpY2FyL2Rlc2NyaXBjaW8="},"L2dpY2FyL3Byb3Zpc2lvLXJlY3Vyc29z":{"date":1465402302000,"title":"Provisió de recursos i aplicacions","description":"","sections":"GICAR","taxonomies":[],"toc":false,"weight":4,"path":"/gicar/provisio-recursos","content":"La plataforma GICAR ofereix un altre ventall de funcionalitats relacionades amb el Control d’Accés a Recursos. Els conceptes bàsics a conèixer es descriuen a continuació:\r\n\r\n1. **Provisió d’usuaris**: GICAR disposa d’un dipòsit central d’informació on s’emmagatzemen atributs relatius al tipus d’autorització que té l’usuari per accedir als repositoris/directoris finals (recursos). Mitjançant aquesta eina es pot aprovisionar/ deprovisionar informació de l’usuari en cadascun dels recursos als que té accés. D’aquesta manera, el sistema permet gestionar l’accés a recursos finals i disposar d’una eina de traçabilitat i control centralitzada.\r\n\r\n1. **Reconciliació**: és el procés mitjançant el qual la plataforma de provisioning garanteix la integritat entre la informació del dipòsit central i la informació d’usuari en el recurs/directori final. Solen ser processos nocturns o de cap de setmana per l’elevat volum de comprovacions que es realitzen.\r\n\r\n1. **Workflow**: eina de la plataforma GICAR utilitzada per aplicar controls de negoci i tecnològics prèviament al provés de provisió/ deprovisió de comtes d’usuari en els recursos/ directori finals. És un portal tipus self-service al que tots els usuaris del Directori Corporatiu poden accedir per efectuar les seves peticions d’accés a recursos. Les fases d’autorització i validació estan reservades a identitats concretes per cada recurs.\r\n\r\n1. **Autogestió de Contrasenyes**: eina de la plataforma GICAR que permet que una identitat del Directori Corporatiu (DC) s’autogestioni la contrasenya del DC mitjançant la resposta de desafiaments prèviament configurats per l’usuari. Actualment, l’usuari ha de respondre 3 preguntes i, en el cas de respondre-les correctament, pot canviar-se la contrasenya.\r\n\r\n1. **Sincronització de Contrasenyes**: eina de la plataforma GICAR que permet sincronitzar la contrasenya d’un recurs/ directori amb la contrasenya del Directori Corporatiu. Es tracta d’un mecanisme bidireccional. \r\n\r\n## Arquitectura i elements pel Control d’Accés a Recursos.\r\n\r\nEn el següent esquema s’inclouen els diferents elements de la plataforma GICAR que intervenen en la gestió del control d’accés a recursos:\r\n\r\n![Integració Aplicacions GICAR](/related/gicar/arq_apr.png)\r\n\r\nTal i com s’observa en l’esquema anterior, els elements de la plataforma són:\r\n\r\n1. **OIM (Oracle Identity Manager)**: és l’eina de Gestió d’Identitats i control d’accés a recursos de la Generalitat de Catalunya. Es descriuen a continuació algunes de les característiques més remarcables:\r\n\r\n\t- És eina sincronitzada amb el Directori Corporatiu de la Generalitat per garantir la integritat de la informació.\r\n\r\n\t- La seva funció més important és la provisió de comptes d’usuaris o deprovisió en els recursos finals integrats a la plataforma. Aquesta funció facilita enormement els procesos de gestió i administració d’usuaris de les aplicacions finals.\r\n\r\n\t- Permet disposar de traçabilitat d’accions realitzades en els recursos integrats (alta en un recurs, baixa, modificació, bloqueig, sincronisme de contrasenya, etc)\r\n\r\n\t- Disposa d’un mòdul de sincronisme de contrasenyes amb el Directori Corporatiu que propaga la contrasenya en cas que es vegi modificada cap a o des dels recursos integrats.\r\n\r\n\t- Es poc intrusiu amb els recursos/ aplicacions finals donat que els connectors d’aprovisionament es troben integrats dins la pròpia plataforma i no cal cap tipus d’instal.lació en l’aplicació client.\r\n\r\n\t- Permet activar automatismes de control que analitzen l’estat de les identitats i que poden forçar canvis d’estat en funció de paràmetres prèviament definits.\r\n\r\n\t- Integrat amb l’eina de workflow (explicada posteriorment). OIM recull informació de l’estat d’una identitat pel que fa a l’accés a recursos (bloquejat, actiu, etc)\r\n\r\n\t- Fa servir una base de dades Oracle com a dipòsit d’informació.\r\n\r\n\t- Disposa d’una eina d’autogestió de contrasenyes, que li permet a tot usuari del Directori Corporatiu modificar-se la contrasenya en el cas de respondre correctament al 3 preguntes prèviament emmagatzemades en OIM (desafiaments-resposta)\r\n\r\n1.\t**Workflow**: eina que controla l’estat de les peticions, autoritzacions i aprovacions d’accés a recursos. Fa ús de la mateixa BBDD d’OIM per emmagatzemar tota la informació (Estats de la petició, validadors, etc) \r\n\r\n\tLa provisició o deprovisió de recursos requereix en la majoria de casos d’aprovacions parcials per a que aquestes accions es portin a terme. La funció del portal de workflow és precisament aquesta: permet fer peticions d’alta, baixa i modificació d’accés a recursos, veure quines peticions té pendents d’aprovar un responsable, aprovador o autoritzador, saber a quins recursos ja té accés una identitat, quin és l’estat de les peticions, etc.\r\n\r\n\tLa implantació d’una eina de fluxos de treball (Workflow) aporta molts beneficis:\r\n\r\n\t- Obliga a ordenar i estructurar els fluxos de treball per tal de poder automatitzar la seqüència d’accions a portar a terme i identificar a totes les persones que hi intervenen.\r\n\t- Permet establir mecanismes de control i seguiment dels procediments organitzatius.\r\n\t- Independitza el mètode i flux de treball de les persones que l’executen.\r\n\t- Facilita la mobilitat del personal.\r\n\t- Agilitza el procés d’intercanvi d’informació i agilitza la pressa de decisions d’una organització.\r\n\t- Redueix el paper i les accions manuals, a través de l’automatització.\r\n\t- Es guarden traces de totes les accions portades a terme dins d’un flux.\r\n\t- Els actors d’un flux poden consultar l’estat de les peticions en què hi intervenen.\r\n\t- L’eina permet delegació de funcions\r\n\r\n\tLes fases d’un flux de treball (workflow) per demanar accés, modificació o baixa d’un recurs/ Identitat es descriuen a continuació:\r\n\r\n\t- Creació d’una sol·licitud (petició): en aquesta fase, una identitat del Directori Corporatiu fa una petició d’accés/baixa a un recurs per ell mateix o per una persona que depèn d’ell. \r\n\r\n\t- Autorització orgànica: és l’autorització de la sol·licitud per part d’un responsable orgànic (responsable d’identitat). Aquesta validació es podrà escalar tantes vegades com sigui necessari, fins que algú l’aprovi o denegui.\r\n\r\n\t- Validació tècnica: aquesta validació serà portada a terme per part del responsable del recurs implicat en la petició (pot ser alta o baixa del recurs). Aquesta validació podrà incloure tantes validacions consecutives com calgui ja sigui de responsables funcionals, de responsables de dades, d’administradors d’aplicació, etcètera.\r\n\r\n\t![Integració Aplicacions GICAR](/related/gicar/wf-fases.png)\r\n\r\n\tEs mostra a continuació una mostra de l’aspecte visual del portal de workflow que podrà ser usat pels usuaris per fer peticions, veure autoritzacions pendents, fer aprovacions tècniques, etc:\r\n\r\n\t![Integració Aplicacions GICAR](/related/gicar/wf-home.png)\r\n\r\n\tEsmentar que l’eina de workflow, addicionalment a la realització de peticions d’alta o baixa de recursos, també permet sol.licitar l’alta i baixa d’identitats tipus T3 al Directori Corporatiu.\r\n\r\n1.\t**BBDD OIM**: Base de dades on es guarda tota la informació relativa a una identitat:\r\n\r\n\t- Recursos als que té accés\r\n\r\n\t- Estat de les peticions de recursos per una identitat\r\n\r\n\t- Rols amb els que s’ha aprovisionat la identitat\r\n\r\n\t- Etc.\r\n\r\n1.\tRecursos Finals: recursos gestionats per OIM. OIM té la capacitat de connectar-se a aquests recursos per aprovisionar o eliminar comptes d’usuari, així com per validar la integritat de la informació entre OIM i el recurs final (procés de reconciliació).\r\n\r\n## Tipus d'aprovisionament\r\n\r\nTal i com s’ha indicat, l’aprovisionament és l’acció de crear comptes d’usuari en els recursos finals. D’igual forma, el deprovisionament és l’acció d’eliminar comptes d’usuari en els recursos prèviament aprovisionats.\r\n\r\nTant l’aprovisionament com el deprovisionament de comptes d’usuari acostuma a efectuar-se com a resultat d’un procés de workflow. Aquest aprovisionament, deprovisionament pot ser:\r\n\r\n- **Automàtic**: a través d’un connector entre OIM i la taula/repositori de comptes d’usuari i rols de l’aplicació, OIM enviarà la informació establerta a l’aplicació per crear o eliminar una compte d’usuari o bé modificar-ne el rol. Tots aquests canvis, quedaran registrats en OIM i es disposarà de traçabilitat de totes les accions efectuades.\r\n\r\n- **Semi-Automàtic**: pràcticament idèntic a l’Automàtic, però en aquest cas es considera necessària la intervenció humana per perfilar el compte d’usuari aprovisionat en el recurs.\r\n\r\n- **Manual**: a diferència dels altres mecanismes, en aquest cas l’administrador de l’aplicació rep notificació com a resultat del workflow, realitza les modificacions en el recurs afectat i finalment és l’administrador qui tanca el workflow. En aquest cas, no és necessari el desenvolupament de cap connector donat que totes les accions són manuals. Amb el tancament del workflow, OIM té coneixment de les accions que s’han efectuat en el recurs final.\r\n\r\n<img src=\"/related/gicar/modes-aprov.png\" style=\"width:75%\" />\r\n\r\n## Fases per donar accés a un recurs\r\n\r\nUn cop descrites les eines que formen part de la Plataforma GICAR per gestionar els recursos als que té accés una identitat, es descriu a continuació el procés que es segueix (des de l’inici) per donar accés a una identitat a un recurs:\r\n\r\n- Alta de la Identitat al Directori Corporatiu (requisit indispensable): mitjançant l’eina GDI o bé via procés de càrrega des de GIPSIP, es dóna d’alta la identitat al Directori Corporatiu.\r\n\r\n- Accés al Portal de Workflow per sol.licitar accés al recurs (per exemple, la intranet)\r\n\tUna identitat del DC (qualsevol) accedeix al porta i sol.licita un recurs per ell o per una altra identitat.\r\n\tUn autoritzador orgànic s’ocuparà d’autoritzar l’alta.\r\n\tUn validador tècnic s’ocuparà d’una segona validació.\r\n\r\n- Finalitzat correctament el workflow, OIM aprovisiona dades de la identitat al recurs final (creació del compte d’usuari i assignació d’un rol determinat)\r\n\r\n- Si es considera necessari, un administrador de l’aplicació perfila el rol de l’usuari.\r\n\r\n- A partir d’aquest moment, en OIM consta que aquest usuari té accés al recurs aprovisionat i amb el rol que s’hagi sol.licitat.\r\n\r\nEn cas d’estar interessats amb la modalitat d’integració d’aprovisionament d’usuaris amb GICAR poseu-nos amb contacte amb el responsables del servei GICAR de cara a avaluar l’abast del projecte.","objectID":"L2dpY2FyL3Byb3Zpc2lvLXJlY3Vyc29z"},"L2dpY2FyLWludGVncmFjaW8vYXV0aC1hbm9uaW1h":{"date":1543485600000,"title":"Servei d’autenticació anònima amb GICAR","description":"","sections":"gicar-integracio","taxonomies":[],"weight":4,"path":"/gicar-integracio/auth-anonima","content":"GICAR ofereix també un servei per tal d’autenticar usuaris amb certificat digital (autenticació per a col·lectiu de ciutadania) independentment de que estiguin o no en el Directori Corporatiu de la Generalitat. Aquest servei és útil per a aplicacions que han de ser accedides per col·lectius d’usuaris que no poden ser identificats ni com a T1, T2, ni com a T3, i que per tant no tenen relació laboral amb la Generalitat.\r\n\r\nHi ha la possibilitat d’indicar a GICAR que, per una aplicació en concret, permeti, amb certificat digital, l’accés a usuaris que no pertanyin al Directori Corporatiu de la Generalitat. Això s’aconsegueix protegint el recurs en qüestió amb l’esquema d’autenticació anònima.\r\n\r\n## Descripció del procés d’autenticació utilitzant l’esquema d’autenticació anònima.\r\n  \r\nEl procés que segueix GICAR per a autenticar usuaris és el que s’indica en el següent esquema:\r\n\r\n![Integració Aplicacions GICAR](/related/gicar/diagrama-autenticacio-anonima.png)\r\n\r\nA continuació es descriuen els passos que segueix GICAR en aquest esquema d’autenticació:\r\n\r\nSi l’usuari no té cap sessió activa li apareixerà un formulari de login, per tal d’introduir les seves credencials, o autenticar-se amb certificat digital. En aquest punt, i tenint en compte l’esquema d’autenticació anònima hi ha tres opcions, que retornen la següent informació:\r\n\r\n\r\n1.\t**Autenticació amb usuari i contrasenya per usuaris que estan en el DC**:\r\n\r\n\tAquesta opció només serà vàlida si l’usuari està donat d’alta en el Directori Corporatiu. SiteMinder validarà que les credencials introduïdes per l’usuari siguin les correctes en el DC, i, si això es compleix, retornarà la informació bàsica de l’usuari a l’aplicació a través de la capçalera HTTP_GICAR i HTTP_GICAR_ID. Exemples de les capçaleres\r\n\r\n\r\n\t\tHTTP_GICAR (conté les dades de l’usuari al DC) = “CODIINTERN=NRDRJN0001;NIF=11112222W;EMAIL=mail.admin@gencat.net;UNITAT_MAJOR=CTTI;UNITAT_MENOR=CTTI Qualitat”\r\n\r\n\t\tHTTP_GICAR_ID (conté el NIF de l’usuari al DC) --> 11112222W\r\n\r\n\r\n2.\t**Autenticació amb certificat per usuaris que estan en el DC**:\r\n\r\n\tAquesta casuística es dóna quan un usuari intenta accedir al recurs protegit per GICAR amb certificat digital, i aquest es troba en el Directori Corporatiu de la Generalitat. Les capçaleres que es rebran en aquest cas seran les següents:\r\n\r\n\t\tHTTP_GICAR (conté les dades de l’usuari al DC) = “CODIINTERN=NRDRJN0001;NIF=11112222W;EMAIL=mail.admin@gencat.net;UNITAT_MAJOR=CTTI;UNITAT_MENOR=CTTI Qualitat”\r\n\r\n\t\tHTTP_GICAR_ID (conté el NIF de l’usuari) --> 11112222W\r\n\r\n\t\tDe forma opcional i sota petició es podran sol·licitar les següents capçaleres:\r\n\r\n\t\tHTTP_GICAR_CERT (conté el classification level, el issuer, el subject, i el OID del certificat)  --> CLASIFICATIONLEVEL=4;CERTISSUER=C=ES, O=Agencia Catalana de Certificacio (NIF Q-0801176-I), L=Passatge de la Concepcio 11 08008 Barcelona, OU=Serveis Publics de Certificacio ECV-2, OU=Vegeu https://www.catcert.net/verCIC-2 (c)03, OU=Secretaria d'Administracio i Funcio Publica, CN=EC-SAFP;CERTSUBJECT=C=ES, O=Centre Telecomunicacions i Tecnologies de la Informació, OU=Serveis Públics de Certificació CPISR-1, OU=Vegeu https://www.catcert.cat/verCPISR-1 (c)03, SN=GARCIA GARCIA, G=ALBERT, SERIALNUMBER=46587898A, CN=CPISR-1 ALBERT GARCIA GARCIA;CERTIFICATEPOLICY=1.3.6.1.4.1.15096.1.3.1.81\r\n\r\n\t\tHTTP_GICAR_PSIS: que contindrà la resposta de PSIS completa, i estarà enzipada i codificada en base64. Un cop descodificada i desenzipada s’obtindran les dades en la forma que s’especifica en l’apartat \"Descripció del procés per a obtenir la informació de la capçalera HTTP_GICAR_PSIS\" d'aquesta mateixa pàgina.\r\n\r\n\tCal destacar que la capçalera HTTP_GICAR_PSIS és la única capçalera indicada per a obtenir la informació de les diferents entitats de certificació que permet autenticar GICAR, o de nom i cognoms d’usuari autenticat, donat que és la única que conté les dades de forma estructurada.\r\n\r\n\r\n3.\t**Autenticació amb certificat per usuaris que no estan en el DC (Autenticació Anònima)**:\r\n\r\n\tAquesta casuística es dóna quan un usuari intenta accedir al recurs protegit per GICAR amb certificat digital, i aquest no pertany al Directori Corporatiu de la Generalitat. Les capçaleres que es rebran en aquest cas seran les següents:\r\n\r\n\t\tHTTP_GICAR_ID (conté el NIF de l’usuari) --> 11112222W\r\n\r\n\t\tHTTP_GICAR_CERT (conté el classification level, el issuer, el subject, i el OID del certificat)  --> CLASIFICATIONLEVEL=4;CERTISSUER=C=ES, O=Agencia Catalana de Certificacio (NIF Q-0801176-I), L=Passatge de la Concepcio 11 08008 Barcelona, OU=Serveis Publics de Certificacio ECV-2, OU=Vegeu https://www.catcert.net/verCIC-2 (c)03, OU=Secretaria d'Administracio i Funcio Publica, CN=EC-SAFP;CERTSUBJECT=C=ES, O=Centre Telecomunicacions i Tecnologies de la Informació, OU=Serveis Públics de Certificació CPISR-1, OU=Vegeu https://www.catcert.cat/verCPISR-1 (c)03, SN=GARCIA GARCIA, G=ALBERT, SERIALNUMBER=46587898A, CN=CPISR-1 ALBERT GARCIA GARCIA;CERTIFICATEPOLICY=1.3.6.1.4.1.15096.1.3.1.81\r\n\r\n\t\tHTTP_GICAR_PSIS: que contindrà la resposta de PSIS completa, i estarà enzipada i codificada en base64. Un cop descodificada i desenzipada s’obtindran les dades en la forma que s’especifica en l’annex D.\r\n\r\n\tCal destacar que la capçalera HTTP_GICAR_PSIS és la única capçalera indicada per a obtenir la informació de les diferents entitats de certificació que permet autenticar GICAR, o de nom i cognoms d’usuari autenticat, donat que és la única que conté les dades de forma estructurada.\r\n\r\n\tEn el cas de voler obtenir si un usuari s’ha autenticat amb usuari o contrasenya, o amb certificat:\r\n\r\n\t- Si la capçalera GICAR_PSIS ve informada, l’usuari s’haurà autenticat amb certificat.\r\n\r\n\t- Si la capçalera GICAR_PSIS NO ve informada, l’usuari NO s’haurà autenticat amb certificat. La capçalera GICAR_PSIS només apareix quan un usuari s’ha autenticat amb certificat.\r\n\r\n\tEn cas de voler obtenir el nom i cognoms de la persona que s’ha autenticat amb certificat, o altres dades del Certificat (excepte el DNI de l’usuari autenticat el qual es pot recuperar fàcilment amb la capçalera HTTP_GICAR_ID), es recomana fer-ho sempre amb la capçalera HTTP_GICAR_PSIS.\r\n\r\n\r\n## Tipus de certificats admesos pel servei d’autenticació anònima de GICAR.\r\n\r\nEl servei d’autenticació anònima de GICAR està preparat per a poder realitzar l’autenticació de qualsevol certificat reconegut per CatCert (Agència Catalana de Certificació). Actualment les següents entitats són reconegudes per CatCert:\r\n\r\n- Agència Catalana de Certificació (CATCert)\r\n\t\r\n\t- Entitat de certificació Secretaria d'Administració i Funció Pública (EC-SAFP)\r\n\t- Entitat de certificació Administració Local (EC-AL)\r\n\t- Entitat de certificació Parlament (EC-PARLAMENT)  \r\n\t- Entitat de certificació Universitats i Recerca (EC-UR)\r\n\t- Entitat de certificació Universitat Rovira i Virgili (EC-URV)\r\n\t- Entitat de certificació idCAT (EC-idCAT)\r\n\t- Entitat de certificació Sector Públic (EC-SectorPublic)\r\n\t- Entitat de certificació Ciutadania (EC-Ciutadania)\r\n\r\n- Autoridad de Certificación de la Abogacía (AC Abogacía)\r\n- Autoritat de Certificació de la Comunitat Valenciana (ACCV)\r\n- Agencia Notarial de Certificación (ANCert)\r\n- Asociación Nacional de Fabricantes - Autoridad de Certificación (ANF)\r\n- Camerfima - Certificados Camerales\r\n- Ceres Fábrica Nacional de Moneda y Timbre - Real Casa de la Moneda FNMT - RCM)\r\n- Direcció General de Policia (DNI-E)\r\n- Firmaprofesional\r\n- HealthSign\r\n- Intercambio Electrónico de Datos i Comunicaciones, SL (AC EDICOM)\r\n- Izenpe\r\n- Netfocus (no dóna serveis com a Prestador de Serveis de Certificació)\r\n- AC Organización Médica Colegial de España (OMC)\r\n- Servicio de Certificación de Registradores del Colegio de Registradores de la Propiedad y Mercantiles de España (SCR- CORPME)\r\n\r\n## Descripció del procés per a obtenir la informació de la capçalera HTTP_GICAR_PSIS:\r\n\r\nLa capçalera HTTP_GICAR_PSIS, si l'usuari s'ha autenticat amb certificat, contindrà la resposta de PSIS completa, i estarà enzipada i codificada en base64. Un cop descodificada i desenzipada la resposta tindrà la següent forma (en groc el nom dels atributs, i en blau el valor que prenen els mateixos:\r\n\r\n\t<dss:VerifyResponse Profile=\"urn:oasis:names:tc:dss:1.0:profiles:XSS\" xmlns:dss=\"urn:oasis:names:tc:dss:1.0:core:schema\" xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\">\r\n\t  <dss:Result>\r\n\t    <dss:ResultMajor>urn:oasis:names:tc:dss:1.0:resultmajor:Success</dss:ResultMajor>\r\n\t    <dss:ResultMinor>urn:oasis:names:tc:dss:1.0:profiles:XSS:resultminor:valid:certificate:Definitive</dss:ResultMinor>\r\n\t  </dss:Result>\r\n\t  <dss:OptionalOutputs>\r\n\t    <dss:ProcessingDetails>\r\n\t      <dss:ValidDetail Type=\"urn:oasis:names:tc:dss:1.0:detail:ValidityInterval\">\r\n\t        <dss:Message xml:lang=\"en\">The signing key is inside its static validity interval.</dss:Message>\r\n\t      </dss:ValidDetail>\r\n\t      <dss:ValidDetail Type=\"urn:oasis:names:tc:dss:1.0:detail:IssuerTrust\">\r\n\t        <dss:Message xml:lang=\"en\">The issuer of the given key is trusted.</dss:Message>\r\n\t      </dss:ValidDetail>\r\n\t      <dss:ValidDetail Type=\"urn:oasis:names:tc:dss:1.0:detail:RevocationStatus\">\r\n\t        <dss:Message xml:lang=\"en\">The signing key is not revoked.</dss:Message>\r\n\t      </dss:ValidDetail>\r\n\t    </dss:ProcessingDetails>\r\n\t    <urn:X509CertificateInfo xmlns:urn=\"urn:oasis:names:tc:dss:1.0:profiles:XSS\">\r\n\t      <urn:Attribute Name=\"urn:catcert:psis:certificateAttributes:Title\">\r\n\t        <urn1:AttributeValue xsi:type=\"xs:string\"  xmlns:urn1=\"urn:oasis:names:tc:SAML:2.0:assertion\" >Càrrec de prova</urn1:AttributeValue>\r\n\t      </urn:Attribute>\r\n\t      <urn:Attribute Name=\"urn:oasis:names:tc:dss:1.0:profiles:XSS:certificateAttributes:CertificatePolicies\">\r\n\t        <urn1:AttributeValue xsi:type=\"xs:string\"  xmlns:urn1=\"urn:oasis:names:tc:SAML:2.0:assertion\" >1.3.6.1.4.1.15096.1.3.1.81.2.4</urn1:AttributeValue>\r\n\t      </urn:Attribute>\r\n\t      <urn:Attribute Name=\"urn:catcert:psis:certificateAttributes:CertificateType\">\r\n\t        <urn1:AttributeValue xsi:type=\"xs:string\"  xmlns:urn1=\"urn:oasis:names:tc:SAML:2.0:assertion\" >Corporativo de persona física</urn1:AttributeValue>\r\n\t      </urn:Attribute>\r\n\t      <urn:Attribute Name=\"urn:catcert:psis:certificateAttributes:ClassificationLevel\">\r\n\t        <urn1:AttributeValue xsi:type=\"xs:integer\"  xmlns:urn1=\"urn:oasis:names:tc:SAML:2.0:assertion\" >4</urn1:AttributeValue>\r\n\t      </urn:Attribute>\r\n\t      <urn:Attribute Name=\"urn:oasis:names:tc:dss:1.0:profiles:XSS:certificateAttributes:IssuerDistinguishedName:commonName\">\r\n\t        <urn1:AttributeValue xsi:type=\"xs:string\"  xmlns:urn1=\"urn:oasis:names:tc:SAML:2.0:assertion\" >EC-SAFP</urn1:AttributeValue>\r\n\t      </urn:Attribute>\r\n\t      <urn:Attribute Name=\"urn:catcert:psis:certificateAttributes:Department\">\r\n\t        <urn1:AttributeValue xsi:type=\"xs:string\"  xmlns:urn1=\"urn:oasis:names:tc:SAML:2.0:assertion\" >Departament de prova</urn1:AttributeValue>\r\n\t      </urn:Attribute>\r\n\t      <urn:Attribute Name=\"urn:catcert:psis:certificateAttributes:issuerCA\">\r\n\t        <urn1:AttributeValue xsi:type=\"xs:string\"  xmlns:urn1=\"urn:oasis:names:tc:SAML:2.0:assertion\" >EC-SAFP</urn1:AttributeValue>\r\n\t      </urn:Attribute>\r\n\t      <urn:Attribute Name=\"urn:catcert:psis:certificateAttributes:KeyOwnerNIF\">\r\n\t        <urn1:AttributeValue xsi:type=\"xs:string\"  xmlns:urn1=\"urn:oasis:names:tc:SAML:2.0:assertion\" >00000000C</urn1:AttributeValue>\r\n\t      </urn:Attribute>\r\n\t      <urn:Attribute Name=\"urn:oasis:names:tc:dss:1.0:profiles:XSS:certificateAttributes:KeyUsages\">\r\n\t        <urn1:AttributeValue xsi:type=\"xs:string\"  xmlns:urn1=\"urn:oasis:names:tc:SAML:2.0:assertion\" >digitalSignature,nonRepudiation</urn1:AttributeValue>\r\n\t      </urn:Attribute>\r\n\t      <urn:Attribute Name=\"urn:catcert:psis:certificateAttributes:LegalEntityCIF\">\r\n\t        <urn1:AttributeValue xsi:type=\"xs:string\"  xmlns:urn1=\"urn:oasis:names:tc:SAML:2.0:assertion\" >Q0000000C</urn1:AttributeValue>\r\n\t      </urn:Attribute>\r\n\t      <urn:Attribute Name=\"urn:oasis:names:tc:dss:1.0:profiles:XSS:certificateAttributes:SubjectDistinguishedName:organizationName\">\r\n\t        <urn1:AttributeValue xsi:type=\"xs:string\"  xmlns:urn1=\"urn:oasis:names:tc:SAML:2.0:assertion\" >Organització de prova</urn1:AttributeValue>\r\n\t      </urn:Attribute>\r\n\t      <urn:Attribute Name=\"urn:catcert:psis:certificateAttributes:professionalAssociations:ProfessionalAssociationInitials\"/>\r\n\t      <urn:Attribute Name=\"urn:catcert:psis:certificateAttributes:professionalAssociations:ProfessionalAssociationName\"/>\r\n\t      <urn:Attribute Name=\"urn:catcert:psis:certificateAttributes:professionalAssociations:ProfessionalAssociationNumber\"/>\r\n\t      <urn:Attribute Name=\"urn:catcert:psis:certificateAttributes:professionalAssociations:ProfessionalAssociationZone\"/>\r\n\t      <urn:Attribute Name=\"urn:catcert:psis:certificateAttributes:professionalAssociations:ProfessionalAssociationEmployeeNumber\"/>\r\n\t      <urn:Attribute Name=\"urn:oasis:names:tc:dss:1.0:profiles:XSS:certificateAttributes:SerialNumber\">\r\n\t        <urn1:AttributeValue xsi:type=\"xs:integer\"  xmlns:urn1=\"urn:oasis:names:tc:SAML:2.0:assertion\" >101517613294820238970587798414002567257</urn1:AttributeValue>\r\n\t      </urn:Attribute>\r\n\t      <urn:Attribute Name=\"urn:oasis:names:tc:dss:1.0:profiles:XSS:certificateAttributes:SubjectDistinguishedName:commonName\">\r\n\t        <urn1:AttributeValue xsi:type=\"xs:string\"  xmlns:urn1=\"urn:oasis:names:tc:SAML:2.0:assertion\" >CPISR-1 C Persona Física de la Peça de Proves</urn1:AttributeValue>\r\n\t      </urn:Attribute>\r\n\t      <urn:Attribute Name=\"urn:oasis:names:tc:dss:1.0:profiles:XSS:certificateAttributes:SubjectDistinguishedName:givenName\">\r\n\t        <urn1:AttributeValue xsi:type=\"xs:string\"  xmlns:urn1=\"urn:oasis:names:tc:SAML:2.0:assertion\" >Persona Física</urn1:AttributeValue>\r\n\t      </urn:Attribute>\r\n\t      <urn:Attribute Name=\"urn:oasis:names:tc:dss:1.0:profiles:XSS:certificateAttributes:SubjectDistinguishedName:surname\">\r\n\t        <urn1:AttributeValue xsi:type=\"xs:string\"  xmlns:urn1=\"urn:oasis:names:tc:SAML:2.0:assertion\" >de la Peça de Proves</urn1:AttributeValue>\r\n\t      </urn:Attribute>\r\n\t      <urn:Attribute Name=\"urn:oasis:names:tc:dss:1.0:profiles:XSS:certificateAttributes:SubjectDistinguishedName:title\">\r\n\t        <urn1:AttributeValue xsi:type=\"xs:string\"  xmlns:urn1=\"urn:oasis:names:tc:SAML:2.0:assertion\" >Càrrec de prova</urn1:AttributeValue>\r\n\t      </urn:Attribute>\r\n\t      <urn:Attribute Name=\"urn:oasis:names:tc:dss:1.0:profiles:XSS:certificateAttributes:SubjectEmail\">\r\n\t        <urn1:AttributeValue xsi:type=\"xs:string\"  xmlns:urn1=\"urn:oasis:names:tc:SAML:2.0:assertion\" >correue@catcert.cat</urn1:AttributeValue>\r\n\t      </urn:Attribute>\r\n\t      <urn:Attribute Name=\"urn:oasis:names:tc:dss:1.0:profiles:XSS:certificateAttributes:SubjectPublicKeyAlgorithm\">\r\n\t        <urn1:AttributeValue xsi:type=\"xs:string\"  xmlns:urn1=\"urn:oasis:names:tc:SAML:2.0:assertion\" >RSA</urn1:AttributeValue>\r\n\t      </urn:Attribute>\r\n\t      <urn:Attribute Name=\"urn:oasis:names:tc:dss:1.0:profiles:XSS:certificateAttributes:Version\">\r\n\t        <urn1:AttributeValue xsi:type=\"xs:integer\"  xmlns:urn1=\"urn:oasis:names:tc:SAML:2.0:assertion\" >3</urn1:AttributeValue>\r\n\t      </urn:Attribute>\r\n\t      <urn:Attribute Name=\"urn:catcert:psis:certificateAttributes:VinculatedCompanyCIF\">\r\n\t        <urn1:AttributeValue xsi:type=\"xs:string\"  xmlns:urn1=\"urn:oasis:names:tc:SAML:2.0:assertion\" >Q0000000C</urn1:AttributeValue>\r\n\t      </urn:Attribute>\r\n\t      <urn:Attribute Name=\"urn:catcert:psis:certificateAttributes:VinculatedCompanyName\">\r\n\t        <urn1:AttributeValue xsi:type=\"xs:string\"  xmlns:urn1=\"urn:oasis:names:tc:SAML:2.0:assertion\" >Organització de prova</urn1:AttributeValue>\r\n\t      </urn:Attribute>\r\n\t      <urn:Attribute Name=\"urn:catcert:psis:certificateAttributes:VinculatedPersonFullName\">\r\n\t        <urn1:AttributeValue xsi:type=\"xs:string\"  xmlns:urn1=\"urn:oasis:names:tc:SAML:2.0:assertion\" >CPISR-1 C Persona Física de la Peça de Proves</urn1:AttributeValue>\r\n\t      </urn:Attribute>\r\n\t      <urn:Attribute Name=\"urn:catcert:psis:certificateAttributes:VinculatedPersonName\">\r\n\t        <urn1:AttributeValue xsi:type=\"xs:string\"  xmlns:urn1=\"urn:oasis:names:tc:SAML:2.0:assertion\" >Persona Física</urn1:AttributeValue>\r\n\t      </urn:Attribute>\r\n\t      <urn:Attribute Name=\"urn:catcert:psis:certificateAttributes:VinculatedPersonNIForNIE\">\r\n\t        <urn1:AttributeValue xsi:type=\"xs:string\"  xmlns:urn1=\"urn:oasis:names:tc:SAML:2.0:assertion\" >00000000C</urn1:AttributeValue>\r\n\t      </urn:Attribute>\r\n\t      <urn:Attribute Name=\"urn:catcert:psis:certificateAttributes:VinculatedPersonSurname\">\r\n\t        <urn1:AttributeValue xsi:type=\"xs:string\"  xmlns:urn1=\"urn:oasis:names:tc:SAML:2.0:assertion\" >de la Peça de Proves</urn1:AttributeValue>\r\n\t      </urn:Attribute>\r\n\t    </urn:X509CertificateInfo>\r\n\t  </dss:OptionalOutputs>\r\n\t</dss:VerifyResponse>\r\n\r\nA continuació, a la següent taula es detalla el sentit de cada atribut:\r\n\r\n\tTitle: Càrrec de la persona dins de l’organització\r\n\tCertificatePolicies: OID del certificat\r\n\tCertificateType: Tipologia de certificat\r\n\tClassificationLevel: Nivell de classificació de seguretat del certificat\r\n\tIssuerDistinguishedName: Tipus de certificat dins de la CA\r\n\tVinculatedCompanyCIF: CIF de l’empresa a la que pertany l’usuari\r\n\tDepartment: Departament o organització a la qual pertany l’usuari\r\n\tKeyOwnerNIF: NIF del propietari del certificat\r\n\tKeyUsages: Utilització que se li pot donar al certificat\r\n\tSerialNumber: Número de serie del certificat\r\n\tcommonName: Common Name del certificat\r\n\tgivenName: Nom de l’usuari propietari del certificat\r\n\tsurname: Cognoms\r\n\tSubjectEmail: Mail de l’usuari propietari del certificat\r\n\tSubjectPublicKeyAlgorithm: Algorisme de xifrat del certificat\r\n\tVersion: Versió certificat\r\n\r\n\r\n\r\nPer últim, es copia a continuació un fragment de codi en llenguatge Java que mostra el procediment per accedir a la capçalera HTTP_GICAR_PSIS:\r\n\r\n\timport java.io.*;\r\n\timport java.util.zip.*;\r\n\timport sun.misc.BASE64Decoder;\r\n\timport javax.servlet.http.*;\r\n\r\n\tHttpServletRequest httpRequest = /*Objecte request amb la petició autenticada*/\r\n\r\n\t/*Obtenim la capçalera HTTP_GICAR_PSIS del “request”*/\r\n\tString headerPSIS = httpRequest.getHeader(“HTTP_GICAR_PSIS”);\r\n\r\n\r\n\tBASE64Decoder decoder = new BASE64Decoder();\r\n\t/*Decodifiquem la capçalera en base 64 per obtenir el byte[ ] amb el zip que conté la resposta de PSIS*/\r\n\tbyte[] psisZip = decoder.decodeBuffer(headerPSIS);\r\n\r\n\t/*Obtenim un ZipInputStream a partir del byte[ ]*/\r\n\tInputStream bIn = new ByteArrayInputStream(psisZip);\r\n\tZipInputStream zipIn = new ZipInputStream(bIn);\r\n\r\n\t/*Agafem la primera entrada del ZIP, només hi ha una*/\r\n\tZipEntry zipEntry = zipIn.getNextEntry();\r\n\t                               \r\n\t/*Fem servir el buffer “bOut” per guardar el xml desenzipat*/\r\n\tByteArrayOutputStream bOut = new ByteArrayOutputStream();\r\n\t                               \r\n\tint nRead;\r\n\tbyte[] data = new byte[1024];\r\n\r\n\t/*Obtenim el contingut del zip i el copiem al buffer en blocs de 1024 bits*/\r\n\twhile ((nRead = zipIn.read(data, 0, data.length)) != -1) {\r\n\t  bOut.write(data, 0, nRead);\r\n\t}\r\n\r\n\tbOut.flush();\r\n\r\n\t/*En aquest punt tenim al buffer “bOut” el contingut xml de la resposta PSIS */\r\n","objectID":"L2dpY2FyLWludGVncmFjaW8vYXV0aC1hbm9uaW1h"},"L2dpY2FyL2ludGVncmFjaW8td3M=":{"date":1534508142000,"title":"Webservice","description":"Com integrar-se amb el Webservice de GICAR","sections":"GICAR","taxonomies":[],"toc":true,"weight":3,"path":"/gicar/integracio-ws","content":"Actualment, l’aplicació GDI permet realitzar una sèrie d’actuacions sobre les identitats presents en el Directori Corporatiu. L’objectiu del Web Service de GDI es proporcionar aquestes mateixes funcionalitats, per tal que tant usuaris i/o aplicacions puguin disposar d’elles de manera externa a l’eina GDI. Així doncs, el Web Service servirà de connector per a terceres persones, permetent la seva integració amb GICAR.\r\n\r\nLa solució adoptada proporciona una comunicació senzilla mitjançant missatges i documents amb format XML entre les diferents aplicacions Web. En concret, es fa ús del protocol SOAP, que es una particularització de XML.\r\n\r\nEl xifrat de tots els missatges està assegurat a nivell del servidor d’aplicacions (jboss) i es força la comunicació TLS/SSL en totes les comunicacions amb el Web Service, amb certificat de servidor i sense requeriment de certificat en el client.\r\n\r\nA continuació s’especifiquen les dades de connexió al WebService dels diferents entorns PRE i PRO\r\n\r\n![Integració Aplicacions GICAR](/related/gicar/connexio-ws-gicar.png)\r\n\r\n## Arquitectura\r\n\r\nA continuació s’exposa un senzill diagrama indicant les connexions entre les màquines:\r\n\r\n![Integració Aplicacions GICAR](/related/gicar/esquema-ws.png)\r\n\r\nTota comunicació cap al GDI vindrà proporcionada pel Web Service, utilitzant preferiblement per a les comunicacions un canal segur SSL per tal d’assegurar protecció a nivell de transport. Tal i com ja s’ha indicat, totes les operacions s’indicaran mitjançant documents XML amb protocol SOAP i amb una estructura predefinida. A més a més, tot document XML caldrà que inclogui l’estàndard ‘Username Token’ per tal de transmetre un identificador junt amb una contrasenya que servirà per a autenticar-se en el sistema (més informació sobre l’estructura de les peticions en 4.3 Llistat d’operacions disponibles).\r\n\r\nAltres sistemes que intervenen en els processos i que s’exposen en el diagrama són:\r\n\r\n- Directori Corporatiu: sistema final a on s’emmagatzemen les dades dels diferents usuaris.\r\n- Oracle Identity Manager (OIM): l’altre sistema final a on es controlen els diferents estats dels usuaris.\r\n- Repositori de gestors: base de dades a on consten els diferents usuaris / aplicacions que tenen permès accedir a les funcionalitats que s’ofereixen, així com de quins privilegis disposen.\r\n\r\n## Flux de peticions\r\n\r\nA continuació es mostra la interacció entre els sistemes per a una petició genèrica al Web Service:\r\n\r\n![Integració Aplicacions GICAR](/related/gicar/flux-ws.png)\r\n\r\n1. S’envia la petició en un document amb format XML i protocol SOAP. \r\n\r\n2. El Web Service extraurà la capçalera que inclou la informació relativa a l’autenticació. Es realitza una validació contra el Directori Corporatiu. Per tal de consumir el WebService caldrà doncs disposar d’un usuari de connexió al WS i caldrà ser demanar a l’Equip GICAR.\r\n\r\n3. Si l’usuari o aplicació passa aquest primer control d’autenticació, es procedirà a comprovar si aquest disposa dels privilegis necessaris per a la petició en qüestió. Per tant, es realitza una segona validació contra el repositori de gestors.\r\n\r\n4. Una vegada s’hagi autenticat correctament a l’usuari o aplicació, es farà una primera validació del contingut del missatge. Es comprovarà que la seva estructura es la correcta i que el format dels camps especificats compleix les especificacions donades (Annex A).\r\n\r\n5. Si la petició supera tots els punts anteriors, es procedirà a executar la sol•licitud. En el cas de que la petició no passi correctament alguna de les comprovacions anteriors, es retornarà a l’usuari un missatge indicant l’error i es procedirà a finalitzar el flux.\r\n\r\n6. Un cop s’ha executat l’acció requerida, s’informarà al peticionari a través d’un missatge de resposta amb una estructura predefinida.\r\n\r\n## Llistat d’operacions disponibles\r\n\r\nLes operacions que s’implementaran en el Web Service són:\r\n\r\n- enableUser: activa la identitat d’un usuari del Directori Corporatiu.\r\n- disableUser: desactiva a un usuari present en el Directori.\r\n- setPasswordUser: insereix una nova contrasenya per a l’usuari indicat.\r\n- lookupUser: busca a un usuari en el Directori i retorna informació sobre ell.\r\n- searchUsers: retorna un llistat amb els usuaris del Directori que compleixin una sèrie de condicions.\r\n\r\nS’ha predefinit per a cadascuna d’aquestes operacions una estructura determinada així com una sèrie de variables que es poden inserir. El Web Service validarà per a cada petició que aquesta s’ajusti al format requerit. \r\n\r\nA continuació es detalla per a cada operació quina estructura ha de tenir, així com les possibles respostes que es retornarà.\r\n\r\n## Capçalera d’autenticació\r\n\r\nTal i com ja s’ha introduït en punts anteriors d’aquest mateix document, el Web Service requereix que totes les operacions incorporin unes credencials per tal d’autenticar els peticionaris contra el Directori Corporatiu. Posteriorment es realitzarà una segona validació d’aquestes credencials per a comprovar si l’usuari/aplicació en qüestió està autoritzat per a demanar-les. \r\nMés informació sobre els diferents mètodes de protecció del Web Service es pot trobar a:\r\n\r\nhttp://www.oasis-open.org/committees/tc_home.php?wg_abbrev=wss\r\n\r\nEn concret, es demana que s’incorporin en els missatges enviats l’estàndard “Username Token” per tal d’informar d’un identificador i una contrasenya. Aquest element vindrà incorporat en una capçalera en el inici de totes les peticions, tal i com es mostra en l’exemple següent:\r\n\r\n\t<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\t\t<soapenv:Envelope\r\n\t\txmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\"\r\n\t\txmlns:xsd=\"http://www.w3.org/2001/XMLSchema\"\r\n\t\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">\r\n\r\n\t<soapenv:Header>\r\n\r\n\t<wsse:Security xmlns:wsse=\"http://docs.oasisopen.\r\n\torg/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\"\r\n\tsoapenv:mustUnderstand=\"1\">\r\n\t<wsse:UsernameToken xmlns:wsu=\"http://docs.oasisopen.\r\n\torg/wss/2004/01/oasis-200401-wss-wssecurity-utility-\r\n\t1.0.xsd\" wsu:Id=\"UsernameToken-20201168\">\r\n\t<wsse:Username>11111111H</wsse:Username>\r\n\t<wsse:Password Type=\"http://docs.oasisopen.\r\n\torg/wss/2004/01/oasis-200401-wss-username-tokenprofile-\r\n\t1.0#PasswordText\">xxxxxxxx</wsse:Password>\r\n\t</wsse:UsernameToken>\r\n\t</wsse:Security>\r\n\r\n\r\n\t</soapenv:Header>\r\n\r\n\t<soapenv:Body>\r\n\r\n\t<spmlRequest xmlns=\"http://ws.gdi.sia.es\">\r\n\r\n\t...... ......\r\n\t...... ......\r\n\r\n\t</spmlRequest>\r\n\t</soapenv:Body>\r\n\t</soapenv:Envelope>\r\n\r\nCom es pot observar, les credencials d’autenticació estan presents en la capçalera i, per tant, són visibles per a qualsevol que sigui capaç de capturar el missatge. Es per això que es força que tota comunicació que s’estableixi amb el Web Service es realitzi a través d’un canal segur TLS/SSL amb certificat de servidor i sense necessitat de certificat al client. D’aquesta manera s’incorpora una capa de seguretat a nivell de transport que acaba de protegir del tot la comunicació.\r\n\r\nLa spmlRequest ha d'anar codificada en Base64, i la resposta que s'obtindrà del Webservice també anirà codificada en Base64.\r\n\r\n## Mètode enableUser\r\n\r\n- L’objectiu del mètode es habilitar a un usuari ja present el Directori Corporatiu.\r\n- Cal especificar el NIF de la identitat afectada (camp psoID).\r\n\r\nUn exemple de petició seria:\r\n\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<resumeRequest xmlns=”urn:oasis:names:tc:SPML:2:0” xmlns:dsml=”urn:oasis:names:tc:DSML:2:0:core”>\r\n\t<psoID ID=”11111111H”>\r\n\t<targetID ID=”GICAR”/>\r\n\t<containerID ID=”Persones”/>\r\n\t</psoID>\r\n\t</resumeRequest>\r\n\r\n•\tUn exemple de resposta confirmant que s’ha realitzat el canvi seria:\r\n\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<ns1:resumeResponse xmlns:ns1=”urn:oasis:names:tc:SPML:2:0:core” status=”success”/>\r\n\r\nEn el cas de que aparegui algun error es retornarà:\r\n\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<ns1:resumeResponse xmlns:ns1=“urn:oasis:names:tc:SPML:2:0:core” status=”failure”>\r\n\t<Error code=”NNNN” desc=”xxxxxxxxxx”/>\r\n\t</ns1:resumeResponse>\r\n\r\n## Mètode disableUser\r\n\r\n- Mètode encarregat de desactivar a un usuari en el Directori Corporatiu.\r\n- Cal indicar el NIF de la identitat (camp psoID).\r\n\r\nA continuació es mostra un exemple de petició:\r\n\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<suspendRequest xmlns=”urn:oasis:names:tc:SPML:2:0” xmlns:dsml=”urn:oasis:names:tc:DSML:2:0:core”>\r\n\t<psoID ID=”11111111H”>\r\n\t<targetID ID=”GICAR”/>\r\n\t<containerID ID=”Persones”/>\r\n\t</psoID>\r\n\t</suspendRequest>\r\n\r\nSi tot es correcte, es retorna:\r\n\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<ns1:suspendResponse xmlns:ns1=”urn:oasis:names:tc:SPML:2:0:core” status=”success”/>\r\n\r\nEn cas de que es trobi algun error, aquest es notificarà:\r\n\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<ns1:suspendResponse xmlns:ns1=“urn:oasis:names:tc:SPML:2:0:core” status=”failure”>\r\n\t<Error code=”NNNN” desc=”xxxxxxxxxx”/>\r\n\t</ns1:suspendResponse>\r\n\r\n## Mètode setPasswordUser\r\n\r\n- Mètode encarregat de modificar la contrasenya d’un usuari del Directori Corporatiu.\r\n- Cal indicar el NIF de l’usuari (camp psoID) i la nova contrasenya (camp password).\r\n\r\nUn exemple de petició seria:\r\n\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<setPasswordRequest xmlns=”urn:oasis:names:tc:SPML:2:0”\r\n\txmlns:dsml=”urn:oasis:names:tc:DSML:2:0:password”>\r\n\t<psoID ID=”11111111H”>\r\n\t<targetID ID=”GICAR”/>\r\n\t<containerID ID=”Persones”/>\r\n\t</psoID>\r\n\t<password>contrasenya</password>\r\n\t</setPasswordRequest>\r\n\r\nSi tot es correcte, es retornarà:\r\n\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<ns1:setPasswordResponse xmlns:ns1=“urn:oasis:names:tc:SPML:2:0:password” status=”succes”/>\r\n\r\nPer finalitzar, en el cas de que hagi sorgit un error es retornarà el seu codi així com una breu descripció del mateix:\r\n\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<ns1:setPasswordResponse xmlns:ns1=“urn:oasis:names:tc:SPML:2:0:password” status=”failure”>\r\n\t<Error code=”NNNN” desc=”xxxxxxxxxx”/>\r\n\t</ns1:setPasswordResponse>\r\n\r\n\r\n## Mètode lookupUser\r\n\r\n- Mètode usat per a fer una cerca d’un usuari en el Directori Corporatiu i recuperar informació de certs atributs.\r\n- Cal indicar el NIF de la identitat a buscar informació dins de la petició.\r\n- Annexat a aquest mateix document es troba un llistat dels camps disponibles en el GDI que són els que es podran retornar en aquesta consulta\r\n\r\nL’estructura de la petició es:\r\n\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<lookupRequest returnData=”everything” xmlns=”urn:oasis:names:tc:SPML:2:0”>\r\n\t<psoID ID=”11111111H” xmlns=”urn:oasis:names:tc:SPML:2:0”/>\r\n\t</lookupRequest>\r\n\r\nSi tot es correcte, la informació es retornarà estructurada com un llistat tal i com es mostra a continuació:\r\n\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<ns1:lookupResponse xmlns:ns1=”urn:oasis:names:tc:SPML:2:0” status = “succes”>\r\n\t<ns1:pso>\r\n\t<ns1:psoID ID=”11111111H”/>\r\n\t<ns1:data>\r\n\t<ns2:attr xmlns:ns2=”urn:oasis:names:tc:DSML:2:0:core” name=”employeeID”>\r\n\t<ns2:value>11111111H</ns2:value>\r\n\t</ns2:attr>\r\n\t<ns3:attr xmlns:ns3=”urn:oasis:names:tc:DSML:2:0:core” name=”gencatFirstCognom”>\r\n\t<ns3:value>Martinez</ns3:value>\r\n\t</ns3:attr>\r\n\t<ns4:attr xmlns:ns4=”urn:oasis:names:tc:DSML:2:0:core” name=”gencatSecondCognom”>\r\n\t<ns4:value>Delgado</ns3:value>\r\n\t</ns4:attr>\r\n\r\n\t...           ...         ...\r\n\r\n\t</ns1:data>\r\n\t</ns1:pso>\r\n\t</ns1:lookupResponse>\r\n\r\n\r\nEn cas d’error en algun punt de la validació o en l’execució de la petició es retornarà:\t\r\n\t\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<ns1:lookupResponse xmlns:ns1=“urn:oasis:names:tc:SPML:2:0:core” status=”failure”>\r\n\t<ns1:pso>\r\n\t<ns1:psoID ID=”11111111H”/>\r\n\t<Error code=”NNNN” desc=”xxxxxxxxxx”/>\r\n\t</ns1:pso>\r\n\t</ns1:lookupResponse>\r\n\r\nA través d'aquest mètode només és possible trobar usuaris catalogats com a \"No Sensibles\" a GICAR.\r\n\r\n## Mètode searchUsers\r\n\r\n\r\n- Mètode encarregat de realitzar una cerca d’usuaris en el Directori Corporatiu. Retorna el NIF i el codi intern (identificador) dels usuaris que compleixin amb els paràmetres de la cerca especificats.\r\n- Caldrà establir com a mínim un paràmetre per a fer la cerca.\r\n- Es podrà utilitzar varis paràmetres de cerca units mitjançant els operadors lògics AND i/o OR.\r\n\r\nCas d’us 1: saber quins usuaris compleixen amb els criteris demanats sense obtenir el detall dels atributs dels usuaris:\r\n\r\nPer exemple, podríem enviar com a petició:\r\n\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<searchRequest returnData=”identifier” xmlns=”urn:oasis:names:tc:SPML:2:0:search” xmlns:dsml=”urn:oasis:names:tc:DSML:2:0:core”>\r\n\t<query scope=”pso”>\r\n\t<basePsoID ID=””/>\r\n\t<and>\r\n\t<dsml:filter>\r\n\t<dsml:equalityMatch name=”givenName”>\r\n\t<dsml:values>Perico</dsml:values>\r\n\t</dsml:equalityMatch>\r\n\t</dsml:filter>\r\n\t<dsml:filter>\r\n\t<dsml:equalityMatch name=”gencatFirstCognom”>\r\n\t<dsml:values>Martínez</dsml:values>\r\n\t</dsml:equalityMatch>\r\n\t</dsml:filter>\r\n\t</and>\r\n\t</query>\r\n\t</searchRequest>\r\n\r\nUna petició com l’anterior retornaria una resposta com:\r\n\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<ns1:searchResponse xmlns:ns1=”urn:oasis:names:tc:SPML:2:0:search” status=”success”>\r\n\t<ns1:pso>\r\n\t<ns2:psoID xmlns:ns2=”urn:oasis:names:tc:SPML:2:0” ID=”11111111H”/>\r\n\t<ns3:data xmlns:ns3=”urn:oasis:names:tc:SPML:2:0”>\r\n\t<ns4:attr xmlns:ns4=”urn:oasis:names:tc:DSML:2:0:core” name=”codiintern”>\r\n\t<ns4:value>JPNX0001</ns4:value>\r\n\t</ns4:attr>\r\n\t</ns3:data>\r\n\t</ns1:pso>\r\n\t<ns1:pso>\r\n\t<ns5:psoID xmlns:ns5=”urn:oasis:names:tc:SPML:2:0” ID=”12345678Z”/>\r\n\t<ns6:data xmlns:ns6=”urn:oasis:names:tc:SPML:2:0”>\r\n\t<ns7:attr xmlns:ns7=”urn:oasis:names:tc:DSML:2:0:core” name=”codiintern”>\r\n\t<ns7:value>JTNX0001</ns4:value>\r\n\t</ns7:attr>\r\n\t</ns6:data>\r\n\t</ns1:pso>\r\n\t</ns1:searchResponse>\r\n\r\n\r\nObtenint el NIF i el codi intern dels usuaris.\r\n\r\nEn canvi, si hi hagués algun problema es retornaria:\r\n\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<ns1:searchResponse xmlns:ns1=“urn:oasis:names:tc:SPML:2:0:search” status=”failure”>\r\n\t<Error code=”NNNN” desc=”xxxxxxxxxx”/>\r\n\t</ns1:searchResponse>\r\n\r\n\r\nCas d’us 2: obtenir dades de detall dels usuaris que compleixen amb els criteris de cerca:\r\n\r\nEn aquest cas cal informar el valor searchRequest returnData a Everything.\r\n\r\nPer exemple, podríem enviar com a petició:\r\n\r\n\t<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\t<searchRequest returnData=\"everything\" xmlns=\"urn:oasis:names:tc:SPML:2:0:search\" xmlns:dsml=\"urn:oasis:names:tc:DSML:2:0:core\">\r\n\t\t<query scope=\"pso\">\r\n\t\t\t<basePsoID ID=\"\" />\r\n\t\t\t\t<dsml:filter>\r\n\t\t\t\t\t<dsml:equalityMatch name=\"employeeID\">\r\n\t\t\t\t\t\t<dsml:values>257*</dsml:values>\r\n\t\t\t\t\t</dsml:equalityMatch>\r\n\t\t\t\t</dsml:filter>\t\t\r\n\t\t</query>\r\n\t</searchRequest>\r\n\r\n\r\nUna petició com l’anterior retornaria una resposta com:\r\n\r\n\t<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\t<ns1:searchResponse xmlns:ns1=\"urn:oasis:names:tc:SPML:2:0:search\" status=\"success\">\r\n\t\t<ns1:pso>\r\n\t\t\t<ns2:psoID xmlns:ns2=\"urn:oasis:names:tc:SPML:2:0\" ID=\"25711341D\" />\r\n\t\t\t<ns3:data xmlns:ns3=\"urn:oasis:names:tc:SPML:2:0\">\r\n\t\t\t\t<ns4:attr xmlns:ns4=\"urn:oasis:names:tc:DSML:2:0:core\" name=\"codiintern\">\r\n\t\t\t\t\t<ns4:value>GCNRMR0001</ns4:value>\r\n\t\t\t\t</ns4:attr>\r\n\t\t\t</ns3:data>\r\n\t\t\t<ns5:data xmlns:ns5=\"urn:oasis:names:tc:SPML:2:0\">\r\n\t\t\t\t<ns6:attr xmlns:ns6=\"urn:oasis:names:tc:DSML:2:0:core\" name=\"carLicense\">\r\n\t\t\t\t\t<ns6:value>actiu</ns6:value>\r\n\t\t\t\t</ns6:attr>\r\n\t\t\t</ns5:data>\r\n\t\t\t<ns7:data xmlns:ns7=\"urn:oasis:names:tc:SPML:2:0\">\r\n\t\t\t\t<ns8:attr xmlns:ns8=\"urn:oasis:names:tc:DSML:2:0:core\" name=\"givenName\">\r\n\t\t\t\t\t<ns8:value>Marta</ns8:value>\r\n\t\t\t\t</ns8:attr>\r\n\t\t\t</ns7:data>\r\n\t\t\t<ns9:data xmlns:ns9=\"urn:oasis:names:tc:SPML:2:0\">\r\n\t\t\t\t<ns10:attr xmlns:ns10=\"urn:oasis:names:tc:DSML:2:0:core\" name=\"gencatFirstCognom\">\r\n\t\t\t\t\t<ns10:value>Cano</ns10:value>\r\n\t\t\t\t</ns10:attr>\r\n\t\t\t</ns9:data>\r\n\t\t\t<ns11:data xmlns:ns11=\"urn:oasis:names:tc:SPML:2:0\">\r\n\t\t\t\t<ns12:attr xmlns:ns12=\"urn:oasis:names:tc:DSML:2:0:core\" name=\"gencatSegonCognom\">\r\n\t\t\t\t\t<ns12:value>Rodríguez</ns12:value>\r\n\t\t\t\t</ns12:attr>\r\n\t\t\t</ns11:data>\r\n\t\t\t<ns13:data xmlns:ns13=\"urn:oasis:names:tc:SPML:2:0\">\r\n\t\t\t\t<ns14:attr xmlns:ns14=\"urn:oasis:names:tc:DSML:2:0:core\" name=\"physicalDeliveryOfficeName\">\r\n\t\t\t\t\t<ns14:value>Centre de Treball Entitat Externa</ns14:value>\r\n\t\t\t\t</ns14:attr>\r\n\t\t\t</ns13:data>\r\n\t\t\t<ns15:data xmlns:ns15=\"urn:oasis:names:tc:SPML:2:0\">\r\n\t\t\t\t<ns16:attr xmlns:ns16=\"urn:oasis:names:tc:DSML:2:0:core\" name=\"department\">\r\n\t\t\t\t\t<ns16:value>ECONOMIA I FINANCES</ns16:value>\r\n\t\t\t\t</ns16:attr>\r\n\t\t\t</ns15:data>\r\n\t\t\t<ns17:data xmlns:ns17=\"urn:oasis:names:tc:SPML:2:0\">\r\n\t\t\t\t<ns18:attr xmlns:ns18=\"urn:oasis:names:tc:DSML:2:0:core\" name=\"gencatResponsable\">\r\n\t\t\t\t\t<ns18:value>40953247E</ns18:value>\r\n\t\t\t\t</ns18:attr>\r\n\t\t\t</ns17:data>\r\n\t\t</ns1:pso>\r\n\t</ns1:searchResponse>\r\n \r\nA través d'aquest mètode només és possible trobar usuaris catalogats com a \"No Sensibles\" a GICAR.\r\n\r\n\r\n## Mètode searchUsersSensibles\r\n\r\nA partir d'aquest mètode, si es disposen de permisos per a poder-ho fer és possible poder obtenir una mínima informació dels usuaris sensibles que estan donats d'alta a GICAR.\r\n\r\n- Mètode encarregat de realitzar una cerca d’usuaris en el Directori Corporatiu. Retorna el NIF, el electrònic i el codi de la unitat menor dels usuaris que compleixin amb els paràmetres de la cerca especificats.\r\n- Caldrà establir com a mínim un paràmetre per a fer la cerca.\r\n- Es podran utilitzar múltiples paràmetres de cerca units mitjançant els operadors lògics AND i/o OR.\r\n\r\nA continuació s'exposa una petició d'exemple:\r\n\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<searchRequest returnData=”identifier” xmlns=”urn:oasis:names:tc:SPML:2:0:search” xmlns:dsml=”urn:oasis:names:tc:DSML:2:0:core”>\r\n\t<query scope=”pso”>\r\n\t<basePsoID ID=””/>\r\n\t<and>\r\n\t<dsml:filter>\r\n\t<dsml:equalityMatch name=”givenName”>\r\n\t<dsml:values>Perico</dsml:values>\r\n\t</dsml:equalityMatch>\r\n\t</dsml:filter>\r\n\t<dsml:filter>\r\n\t<dsml:equalityMatch name=”gencatFirstCognom”>\r\n\t<dsml:values>Martínez</dsml:values>\r\n\t</dsml:equalityMatch>\r\n\t</dsml:filter>\r\n\t</and>\r\n\t</query>\r\n\t</searchRequest>\r\n\r\nI com a resposta en aquest cas es retornaria el següent:\r\n\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<ns1:searchResponse xmlns:ns1=”urn:oasis:names:tc:SPML:2:0:search” status=”success”>\r\n\t<ns1:pso>\r\n\t<ns2:psoID xmlns:ns2=”urn:oasis:names:tc:SPML:2:0” ID=”11111111H”/>\r\n\t<ns3:data xmlns:ns3=”urn:oasis:names:tc:SPML:2:0”>\r\n\t<ns4:attr xmlns:ns4=”urn:oasis:names:tc:DSML:2:0:core” name=” gencatCompanyCodi”>\r\n\t<ns4:value>GDI01</ns4:value>\r\n\t</ns4:attr>\r\n\t<ns5attr xmlns:ns4=”urn:oasis:names:tc:DSML:2:0:core” name=”mail”>\r\n\t<ns5:value>correo@xxxx.yyy</ns4:value>\r\n\t</ns5:attr>\r\n\t</ns3:data>\r\n\t</ns1:pso>\r\n\t<ns1:pso>\r\n\t<ns5:psoID xmlns:ns5=”urn:oasis:names:tc:SPML:2:0” ID=”12345678Z”/>\r\n\t<ns6:data xmlns:ns6=”urn:oasis:names:tc:SPML:2:0”>\r\n\t<ns7:attr xmlns:ns7=”urn:oasis:names:tc:DSML:2:0:core” name=” gencatCompanyCodi”>\r\n\t<ns7:value>AG</ns4:value>\r\n\t</ns7:attr>\r\n\t<ns8attr xmlns:ns4=”urn:oasis:names:tc:DSML:2:0:core” name=”mail”>\r\n\t<ns8:value>zzzz@xxxx.yyy</ns4:value>\r\n\t</ns8:attr>\r\n\t</ns6:data>\r\n\t</ns1:pso>\r\n\t</ns1:searchResponse>\r\n","objectID":"L2dpY2FyL2ludGVncmFjaW8td3M="},"L2dpY2FyLWludGVncmFjaW8vbWlncmFjaW8tc2FjZQ==":{"date":1465402302000,"title":"Migració de SACE a GICAR","description":"","sections":"GICAR","taxonomies":[],"weight":7,"path":"/gicar-integracio/migracio-sace","content":"Per motius històrics diverses aplicacions de la Generalitat fan encara l’ús del Servei d’Autenticació Centralitzat (més conegut com a SACE). Aquest és un servei obsolescent que està en fase d’extinció, i es recomana a totes les aplicacions que encara facin ús d’aquest servei, la migració de l’autenticació cap a GICAR.\r\n\r\nAquest apartat pretén donar unes directrius bàsiques sobre com abordar la migració d’una aplicació web integrada amb SACE vers GICAR. Es començarà explicant com s’integren actualment les aplicacions amb el SACE, i a continuació s’exposarà quin és el mecanisme que es proposa per a migrar l’autenticació a GICAR.\r\n\r\n## Funcionament actual de l’autenticació de les aplicacions amb el SACE\r\n\r\nLa manera d’integrar-se amb el SACE, consistia en fer una crida HTTPS a una adreça, passant com a informació un fitxer XML, que de sortida contindrà les dades requerides.\r\n\r\nhttps://sace.xxx.gencat.intranet/SACE/SACE_Logon.aspx\r\n\r\nOn xxx es dc, prepdc i desenvdc per als entorns de Producció, pre-producció i desenvolupament, respectivament. \r\n\t\r\nL’estructura del fitxer XML d’entrada i sortida de dades així com la informació que conté i el seu significat, s’especifica a continuació:\r\n\r\n![Integració Aplicacions GICAR](/related/gicar/xmlsace.png)\r\n\r\nEl codi d’operació pot estar informat amb els següents valors:\r\n\r\n![Integració Aplicacions GICAR](/related/gicar/saceoperacions.png)\r\n\r\nEls paràmetres d’entrada seran recollits via POST per un camp que es diu XMLIn. Anàlogament, els paràmetres de sortida seran enviats via POST a la pàgina que s’indica en el tag <URL_RETORN> dins del contingut d’un camp que es diu  XMLOut.\r\n\r\nAquest funcionament feia necessari que les aplicacions haguessin de construir-se i presentar un formulari de login, i que aquest formulari de login, o un element dinàmic relacionat, hagués de gestionar els següents punts:\r\n\r\n1.\tTenir tota la lògica de crida a SACE i d’enviament de paràmetres.\r\n2.\tEnviament de paràmetres de SACE cap a l’aplicació.\r\n3.\tParsejat dels paràmetres retornats per SACE.\r\n4.\tGeneració de la sessió de l’usuari en base a aquests paràmetres obtinguts\r\n\r\nEsquemàticament l’aplicació està funcionant ara mateix de la següent manera:\r\n\r\n![Integració Aplicacions GICAR](/related/gicar/sacejsp.png)\r\n\r\n## Proposta de canvi de migració de SACE cap a GICAR\r\n\r\nA continuació es descriu una estratègia orientada a la substitució del SACE per GICAR per a les aplicacions que utilitzen SACE. Comentar que l’estratègia que es descriu a continuació és la recomanada per a fer aquest tipus de migracions de SACE a GICAR, però no és la forma recomanada per a realitzar les intragracions amb GICAR per una aplicació que es construeixi des de 0.\r\n\r\nEn primer lloc el canvi suposa que a nivell de CPD, calgui instal·lar l’agent de SiteMinder sobre el servidor web on resideixi l’aplicació.\r\n\r\nA nivell d’aplicacions el canvi proposat es basa en substituir el formulari de login propietari de l’aplicació anterior, per un JSP, ASP, PHP (element dinàmic de servidor), que estarà protegit a nivell de SiteMinder, que es limiti a fer el següent:\r\n\r\n1.\tCapturar les següents capçaleres HTTP:\r\n\r\n- HTTP_GICAR_ID (conté el NIF de l’usuari) --> 11112222W\r\nCaptura obligatòria, a partir del qual s’obtindria el DNI de l’usuari autenticat.\r\n\r\n- HTTP_GICAR (conté les dades de l’usuari al DC) = “CODIINTERN=NRDRJN0001;NIF=11112222W;EMAIL=mail.admin@gencat.net;UNITAT_MAJOR=CTTI;UNITAT_MENOR=CTTI Qualitat”\r\nCaptura addicional, a partir del qual s’obtindrien altres dades de l’usuari autenticat.\r\n\r\n2.\tGenerar la sessió de l’aplicació en base a aquests paràmetres obtinguts en anterioritat.\r\n\r\nAquest element JSP, ASP, PHP seria l’únic punt de l’aplicació que estaria protegit per SiteMinder, d’aquesta forma aquest JSP, quan fos accedit pel navegador de l’usuari, faria saltar el formulari de login de GICAR, i demanaria les credencials a l’usuari.\r\n\r\nPer tant, un cop fet això la traça de navegació de l’usuari seria la següent:\r\n\r\n1. L’usuari accedirà a la url l’aplicació web, a la zona on habitualment li demana fer login. Aquesta zona farà un HTTP-REDIRECT al component dinàmic desenvolupat. \r\n\r\n1. Saltaria la protecció de GICAR (SiteMinder) al intentar accedir al element dinàmic.\r\n\r\n1. L’usuari introdueix la seva credencial (usuari o contrasenya /certificat). \r\n\r\n1. L’agent de SiteMinder genera les capçaleres HTTP corresponents, que indiquen que l’usuari està loguinat a GICAR.\r\n\r\n1. L’element dinàmic desenvolupat captura les capçaleres de GICAR, i genera la sessió a l’usuari en l’aplicació.\r\n\r\n![Integració Aplicacions GICAR](/related/gicar/funcionament-migracio-sace-gicar.png)\r\n\r\nD’aquesta manera, es substitueix el formulari i les llibreries que fan les crides cap a SACE per una URL protegida per GICAR i una llibreria que recull les capçaleres HTTP i generen la sessió de l’aplicació.\r\n\r\nAddicionalment al mètode proposat anteriorment (on només es proposa la protecció amb GICAR d’un únic element dinàmic que és el que recull les capçaleres de GICAR i el que genera la sessió de l’aplicació), també és possible tècnicament que totes les URLs de l’aplicació puguin ser protegides amb GICAR (de fet és el recomanable a nivell de seguretat). El fet de fer-ho d’una forma o d’una altra, depèn del grau d’interacció que tingui aquesta aplicació amb altres elements externs, que impossibilitin la protecció total de l’aplicació amb SiteMinder.\r\n","objectID":"L2dpY2FyLWludGVncmFjaW8vbWlncmFjaW8tc2FjZQ=="},"L2dpY2FyLWludGVncmFjaW8vaW50ZWdyYWNpbw==":{"date":1465402302000,"title":"Tasques per a integrar una aplicació amb SiteMinder","description":"","sections":"GICAR","taxonomies":[],"weight":2,"path":"/gicar-integracio/integracio","content":"Per tal de realitzar la integració d’una aplicació amb SiteMinder (instal·lació de l’agent al frontal web propi de l’aplicació) s’haurà de seguir el següent procediment:\r\n\r\n1. Obertura dels ports dels firewalls per connectar l’Agent de SiteMinder amb el SiteMinder Policy Server. El responsable de l’aplicació sol·licitarà l’obertura dels ports següents:\r\n\r\n\t![Integració Aplicacions GICAR](/related/gicar/taula-ports-sm.png)\r\n\r\n1. L’interlocutor de CPD interessat en dur a terme la integració, haurà d’omplir el formulari “Petició d’integració d’una aplicació v3.xls” i enviar-les al sau.tic@gencat.cat, amb la capçalera _PET_ORD_9.34 GICAR_ENTORN_Integració XXXX \r\n\r\n1.\tL’Administrador de GICAR, aplicarà les configuracions pertinents, i omplirà el formulari i el retornarà al sol·licitant.\r\n \r\n1.\tEl tècnic de sistemes instal·larà  l’Agent de SiteMinder en el Servidor Web on resideix el frontal a protegir per SiteMinder, fent ús de la informació lliurada en l’apartat 3 .\r\n\r\n1.\tL’administrador de GICAR, consensuadament amb els responsables de l’aplicació, aplica les polítiques de seguretat en SiteMinder.\r\n\r\n1.\tL’integrador de l’aplicació haurà de modificar l’aplicació per poder capturar i tractar les capçaleres HTTP que li envia SiteMinder un cop l’usuari ha estat validat al Directori Corporatiu .\r\n\r\n**Si l’usuari s’ha autenticat amb usuari i contrasenya contra el  obtindrà les següents capçaleres:**\r\n\r\n* **HTTP_GICAR (conté les dades de l’usuari al DC)** = “CODIINTERN=NRDRJN0001;NIF=11112222W;EMAIL=mail.admin@gencat.net;UNITAT_MAJOR=CTTI;UNITAT_MENOR=CTTI Qualitat”\r\n\r\n* **HTTP_GICAR_ID (conté el NIF de l’usuari al DC)** --> 11112222W\r\n\r\nEls detalls d’aquests camps es poden veure en la següent taula:\r\n\r\n![Integració Aplicacions GICAR](/related/gicar/taula-capçalera-gicar.png)\r\n\r\nSi l’usuari s’ha autenticat amb certificat:\r\n\r\n* **HTTP_GICAR (conté dades si l’usuari està al DC, sino ve buida)** = “CODIINTERN=NRDRJN0001;NIF=11112222W;EMAIL=mail.admin@gencat.net;UNITAT_MAJOR=CTTI;UNITAT_MENOR=CTTI Qualitat”\r\n\r\n* **HTTP_GICAR_ID (conté el NIF de l’usuari)** --> 11112222W\r\n\r\nSota petició podran obtenir-se també les següents capçaleres:\r\n\r\n* **HTTP_GICAR_CERT** (conté el classification level, el issuer, el subject, i el OID del certificat)  --> CLASIFICATIONLEVEL=4;CERTISSUER=C=ES, O=Agencia Catalana de Certificacio (NIF Q-0801176-I), L=Passatge de la Concepcio 11 08008 Barcelona, OU=Serveis Publics de Certificacio ECV-2, OU=Vegeu https://www.catcert.net/verCIC-2 (c)03, OU=Secretaria d'Administracio i Funcio Publica, CN=EC-SAFP;CERTSUBJECT=C=ES, O=Centre Telecomunicacions i Tecnologies de la Informació, OU=Serveis Públics de Certificació CPISR-1, OU=Vegeu https://www.catcert.cat/verCPISR-1 (c)03, SN=GARCIA GARCIA, G=ALBERT, SERIALNUMBER=46587898A, CN=CPISR-1 ALBERT GARCIA GARCIA;CERTIFICATEPOLICY=1.3.6.1.4.1.15096.1.3.1.81\r\n\r\n* **HTTP_GICAR_PSIS**: que contindrà la resposta de PSIS completa, i estarà enzipada i codificada en base64. Un cop descodificada i desenzipada s’obtindran les dades en la forma que s’especifica en l’annex D.\r\n\r\nA partir d’aquest moment, l’aplicació determinarà els privilegis que té l’usuari que hi accedeix.\r\n\r\n\r\n","objectID":"L2dpY2FyLWludGVncmFjaW8vaW50ZWdyYWNpbw=="},"L2dpY2FyLWludGVncmFjaW8vYXV0aC1taXh0YQ==":{"date":1465402302000,"title":"Servei d’autenticació mixt","description":"Descripció del servei per a usuaris de la Generalitat i per usuaris de l’Administració local (EACAT)","sections":"GICAR","taxonomies":[],"weight":5,"path":"/gicar-integracio/auth-mixta","content":"A través d’aquest mecanisme, les aplicacions de la Generalitat que així ho necessitin, podran delegar la seva autenticació, alhora i de forma federada, contra el directori de usuaris de la Generalitat, i el directori d’usuaris de l’EACAT (Administració Local – Ajuntaments i Consells Comarcals), amb usuari i contrasenya. \r\n\r\nAquesta modalitat d’integració permetrà que les aplicacions que s’integrin amb GICAR i que així ho requereixin, amb una sola integració, puguin delegar l’autenticació contra el col·lectiu d’identitats de GENCAT o, en cas que la identitat no es trobi a GENCAT, contra l’EACAT.\r\n\r\nL’atribut que s’utilitza per a establir el login contra els dos directoris és el NIF (ja és l’atribut que ara mateix s’utilitza per a fer login actualment per les aplicacions integrades amb GICAR i és l’atribut que l’AOC ens ha posat a disposició de l’EACAT per a fer aquesta integració).\r\n\r\nCal destacar que quan l’usuari s’hagi identificat ok contra el Directori de l’EACAT, GICAR només podrà retornar a les aplicacions integrades, com a atribut de resposta, el DNI de l’usuari autenticat (només assegurem que l’usuari és qui diu ser). \r\n\r\nEl que fa GICAR en aquest nou muntatge és:\r\n\r\n- Primer autenticar l’usuari si ve amb certificat (capçaleres estàndard de GICAR): GICAR_ID --> NIF\r\n- En cas que s’hagi autenticat amb usuari i contrasenya, l’anem a buscar primer a DC: GICAR_ID --> NIF\r\n- En cas que no estigui a DC l’anem a buscar a l’EACAT: GICAR_ID, EACAT_ID --> NIF (L’usuari només s’autenticarà al directori del EACAT, si i només si, no està al directori de la Generalitat)\r\n\r\nEs pot veure aquest funcionament en la següent figura:\r\n\r\n![Integració Aplicacions GICAR](/related/gicar/diagrama-autenticacio-eacat.png)\r\n\r\nApuntar que hi ha una capçalera que indica a quin directori s’ha autenticat l’usuari, que és la capçalera HTTP_SM_AUTHDIRNAME. Contindrà els valors “DC” o “EACAT” en funció d’on s’hagi autenticat l’usuari.\r\n\r\nEn resum, les capçaleres HTTP que es lliuraran a l’aplicació final integrada, en funció de com s’hagi autenticat l’usuari seran:\r\n\r\n1. Accés amb certificat:\r\n\r\n\t- GICAR_ID --> 00000000T\r\n\r\n \t- HTTP_GICAR_PSIS --> que contindrà la resposta de PSIS completa, i estarà enzipada i codificada en base64. Un cop descodificada i desenzipada s’obtindran les dades en la forma que s’especifica en l’annex D.\r\n\r\n    - SM_AUTHDIRNAME  Contindrà la cadena “Policy Store”\r\n\r\n1. Accés amb usuari del Directori Corporatiu GENCAT\r\n\r\n\t- GICAR_ID --> 00000000T\r\n\r\n \t- GICAR --> CODIINTERN=NFCTPR0001;NIF=00000000T;EMAIL=;UNITAT_MAJOR=CTTI (Cent.Telec.i Tecnol.Inf);UNITAT_MENOR=CTTI (Cent.Telec.i Tecnol.Inf)\r\n\r\n\t- SM_AUTHDIRNAME --> Contindrà la cadena “DC”\r\n\r\n1. Accés amb usuari EACAT (Directori EACAT)\r\n\r\n\t- EACAT_ID --> 00000000T\r\n\r\n\t- GICAR_ID --> 00000000T\r\n\r\n\t- SM_AUTHDIRNAME --> Contindrà la cadena “EACAT”\r\n\r\n","objectID":"L2dpY2FyLWludGVncmFjaW8vYXV0aC1taXh0YQ=="},"L2dpY2FyLWludGVncmFjaW8vc2l0ZW1pbmRlcg==":{"date":1465402302000,"title":"Siteminder","description":"Característiques i arquitectura","sections":"GICAR","taxonomies":[],"weight":1,"path":"/gicar-integracio/siteminder","content":"GICAR disposa d’una eina, el SiteMinder, per facilitar l’autenticació d’aplicacions web. A continuació es veurà que és Siteminder, quines són les seves característiques principals, els elements dels quals es composa (Servidor de Polítiques, Agents, Servidor Web i els diferents directoris) i les tasques que s’han de realitzar per tal d’integrar-ne una aplicació. \n\nA part de tots el punts anteriors que enfoquen l’autenticació de l’usuari contra el Directori Corporatiu de la Generalitat (empleat públic de la Generalitat), s’exposaran quins són els passos a seguir per tal de que GICAR pugui proporcionar a una aplicació el servei d’autenticació anònima mitjançant l’ús d’un certificat digital. \n\nEn cas que l’aplicació a integrar tingui la necessitat de que sigui accedida per usuaris de la Generalitat, i per usuaris de les administracions locals catalanes (AAL), GICAR permet també autenticar aquests usuaris gràcies al servei de validació que proporciona GICAR contra el Directori del Consorci AOC (EACAT). \n\nAixí doncs i a mode de resum, GICAR permet l’autenticació als següents col·lectius i amb les següents modalitats:\n\n![Integració Aplicacions GICAR](/related/gicar/taula-modalitats-autenticacio.png)\n\nPer últim en l’apartat 3.8 s’exposa com fer la integració d’una aplicació amb GICAR utilitzant com a protocol d’integració SAML2, indicat per a aplicacions que només puguin delegar l’autenticació a GICAR a través de SAML2.\n\n\n## Característiques de SiteMinder\n\nSiteMinder és l’eina de la plataforma GICAR que, de forma centralitzada i en alta disponibilitat, s’utilitza per gestionar les polítiques d’accés dels usuaris a les aplicacions web. Per tant, les aplicacions deleguen completament el procés d’autenticació en SiteMinder.\n\nQuan una aplicació està protegida, quan l’usuari intenta accedir-hi,  SiteMinder li demana a l’usuari les credencials (usuari i contrasenya, o certificat digital) i posteriorment es fa una validació d’aquestes al Directori Corporatiu de la Generalitat de Catalunya. En el cas que el resultat sigui positiu, SiteMinder li lliura a l’aplicació final unes capçaleres HTTP amb informació de l’usuari validat. A partir d’aquest moment, l’aplicació és la que determina quins permisos d’accés o privilegis té l’usuari dins l’aplicació (Autorització).\n\nEn resum, les característiques més rellevants de SiteMinder són:\n\n- Seguretat Centralitzada, amb la capacitat d’aplicar polítiques diferents en funció del tipus d’usuari, del col·lectiu al que pertany, del departament, etc.\n- Permet disposar d’un entorn de Single Sign On, amb contrasenya única del Directori (autenticació única)\n- Alta Disponibilitat dels Servidors de Polítiques\n- Disposa d’un registre d’accessos (log) molt complert per processos d’auditoria.\n- Servei d’administració per tal de realitzar, per exemple, el manteniment del Servidor de Polítiques.\n\n\n## Arquitectura i elements de SiteMinder\n\nEl següent gràfic mostra l’arquitectura dels elements de GICAR responsables del procés d’autenticació:\n\n![Integració Aplicacions GICAR](/related/gicar/arquitectura-siteminder.png)\n\nTal i com s’observa en el gràfic, l’arquitectura de SiteMinder la integren els elements que es descriuen a continuació:\n\n- SiteMinder Policy Server proporciona i centralitza la gestió de polítiques, autenticació i auditoria per a aplicacions web. El Policy Server és el responsable de:\n\t- Aplicar una política de control d’accés sobre les aplicacions integrades.\n\t- Realitzar, quan sigui necessari, l’autenticació d’usuari.\n\t- Permetre l’accés a determinats recursos d’aquells únicament dels usuaris autoritzats.\n\t- Facilitar a les aplicacions les dades necessàries per a la identificació de l’usuari que accedeix al recurs.\n\t- Oferir SSO (Single Sign-On) entre totes les aplicacions integrades.\n\t- Separar la lògica d’autenticació de la lògica d’aplicació. Això permet modificar el procediment d’autenticació sense afectar a l’aplicació així com aplicar polítiques centralitzades de contrasenyes.\n\t\n- Agent de SiteMinder: Es tracta d’una extensió del servidor web (un filtre ISAPI en el cas de l’IIS, un mòdul mod en el cas d’Apache) que intercepta les peticions abans de ser processades, tot aplicant la política definida al servidor central. S’instal·la en el Servidor Web on resideix el frontal de l’aplicació i s’ocupen d’interceptar les peticions d’accés a les pàgines web d’aquest servidor. Aquestes peticions són enviades al Servidor de Polítiques de SiteMinder per determinar si l’aplicació està protegida i requereix d’autenticació.\nEn línies generals, SiteMinder intercepta totes les peticions rebudes pel servidor web i, abans de passar-la a l’aplicació, verifica que l’usuari estigui autenticat.\n\n![Integració Aplicacions GICAR](/related/gicar/arquitectura-siteminder2.png)\n\n- Directori Corporatiu: és el repositori central d’identitats utilitzat per SiteMinder per comprovar la validesa o no d’una identitat que intenta accedir a una aplicació web protegida. En el Directori Corporatiu és on resideix la contrasenya única utilitzada per validar totes les aplicacions integrades amb SiteMinder.\n\n- Servidor Web: es on resideix el frontal de l’aplicació web a protegir i on cal instal.lar l’agent de SiteMinder.\n","objectID":"L2dpY2FyLWludGVncmFjaW8vc2l0ZW1pbmRlcg=="},"L2dpY2FyLWludGVncmFjaW8vc2FuZGJveA==":{"date":1465402302000,"title":"Entorn de desenvolupament GICAR","description":"Entorn Sandbox per a simular el funcionament de GICAR","sections":"GICAR","taxonomies":[],"draft":false,"weight":8,"path":"/gicar-integracio/sandbox","content":"A continuació s'exposa com simular GICAR en entorns de desenvolupament, amb l'objectiu de que els proveïdors de desenvolupament tinguin una forma senzilla de simular GICAR i testejar-lo sense necessitat de disposar, per exemple, de connexió a la Xarxa de la Generalitat, ni de demanar configuracions a l'Oficina Tècnica de GICAR.\n\nEs presenten dues estratègies per a fer-ho:\n\n## Apache amb capçaleres estàtiques\n\nConfigurant el frontal web apache de cara a que generi de forma automàtica les capçaleres de GICAR. S’ha d’afegir a l’arxiu httpd.conf, el següent:\n\n- Habilitar el mod_header en el apache.\n\n- Generar les següents capçaleres a nivell d'apache utilitzant les següents directives:\n\n\t- RequestHeader set GICAR_ID “00000000T”\n\t- RequestHeader set GICAR “CODIINTERN=NRDRJN0001;NIF=00000000T;EMAIL=mail.admin@gencat.net;UNITAT_MAJOR=CTTI;UNITAT_MENOR=CTTI Qualitat”\n\nAquesta configuració fa que l’Apache afegeixi la capçalera GICAR i GICAR_ID, amb valor fix, dins de totes les peticions HTTP rebudes.\n\n## Docker\n\n<span style=\"color:red\">\nTemporalment aquesta funcionalitat està indisponible.\n</style>\n\nHem creat un contenidor Docker exacte als Apache-GICAR que es poden trobar als CPDs de la Generalitat. Aixecant a l'entorn del desenvolupador aquest  contenidor, amb connexió a un Policy Server de desenvolupament que és visible des dels entorns dels proveïdors, es pot simular el funcionament real d'una aplicació integrada amb GICAR d'una manera molt senzilla (només permet simular proves amb usuari i contrasenya, no amb certificat digital).\n\nPer a fer això cal seguir el següent procediment:\n\n1. El proveïdor de desenvolupament s'ha d'instal·lar el docker engine que permet gestionar imatges i contenidors (https://www.docker.com/products/docker-engine), o bé utilitzar l'entorn de desenvolupament de Canigó (http://canigo.ctti.gencat.cat/canigo/entorn-desenvolupament/).\n\n1. Dockerfile GICAR (https://hub.docker.com/r/gencatcloud/gicar/) :\n\n\t\tFROM  centos:6.6\n\n\t\tRUN yum install httpd glibc libstdc++ ncurses perl unzip tar xz -y\n\n\t\tENV httpd /etc/httpd\n\n\t\tRUN mkdir -p ${httpd}/CA/webagent\n\n\t\tRUN curl -o ${httpd}/CA/webagent.tar.xz http://canigo.ctti.gencat.cat/related/cloud/fitxers-suport/webagent.tar.xz\n\t\tRUN tar xfvJ ${httpd}/CA/webagent.tar.xz -C ${httpd}/CA/\n\t\tRUN rm ${httpd}/CA/webagent.tar.xz\n\n\t\tRUN curl -o ${httpd}/conf/config.zip http://canigo.ctti.gencat.cat/related/cloud/fitxers-suport/config.zip\n\t\tRUN unzip  -o ${httpd}/conf/config.zip -d  ${httpd}/conf/\n\t\tRUN rm ${httpd}/conf/config.zip\n\n\t\tENV NETE_WA_ROOT ${httpd}/CA/webagent\n\t\tENV NETE_WA_PATH ${NETE_WA_ROOT}/bin\n\t\tENV CAPKIHOME ${httpd}/CA/webagent/CAPKI\n\t\tENV LD_LIBRARY_PATH ${NETE_WA_ROOT}/bin:${NETE_WA_ROOT}/bin/thirdparty:${LD_LIBRARY_PATH}\n\t\tENV PATH ${NETE_WA_PATH}:${PATH}\n\n\t\tRUN mv ${httpd}/conf/headers.cgi /var/www/cgi-bin/\n\t\tRUN mv ${httpd}/conf/index.html /var/www/html/\n\t\tRUN chmod 755 -R /var/www/cgi-bin/\n\t\tRUN chmod 755 -R /var/www/html/\n\n\t\tRUN echo \"#!/bin/bash\" > /entrypoint.sh\n\t\tRUN echo \"set -m\" >> /entrypoint.sh\n\t\tRUN echo \"/usr/sbin/apachectl -D FOREGROUND &\" >> /entrypoint.sh\n\t\t#RUN echo \"sleep 30\" >> /entrypoint.sh\n\t\tRUN echo \"/etc/httpd/CA/webagent/bin/smreghost -i \\$PS_IP -u \\$GICARUSER -p \\$GICARPWD -hn \\$ContainerHostName -hc \\$HCOGICAR -f /etc/httpd/conf/Smhost.conf -o\" >> /entrypoint.sh\n\t\tRUN echo \"sed -i -- 's/\\\\\\$AgentConfigDocker/'\\\"\\$AgentConfigDocker\\\"'/g' /etc/httpd/conf/WebAgent.conf\" >>  /entrypoint.sh\n\t\tRUN echo \"sed -i -- 's/\\\\\\$AGENTNAME/'\\\"\\$AGENTNAME\\\"'/g' /etc/httpd/conf/LocalConfigGicar.conf\" >> /entrypoint.sh\n\t\tRUN echo \"chown apache:apache /etc/httpd/conf/Smhost.conf\" >> /entrypoint.sh\n\t\tRUN echo \"fg\" >> /entrypoint.sh\n\n\t\tRUN chmod 755 /entrypoint.sh\n\n\t\t#Copiem el fitxer wait-for-it\n\t\tCOPY wait-for-it.sh /\n\t\tRUN chmod 755 /wait-for-it.sh\n\n\t\tCMD [\"/entrypoint.sh\"]\n\n1. Executar la següent comanda per a generar la imatge de l'apache GICAR:\n\n\t\t$ docker build -t gicar_dev .\n\n1. Per a demanar la configuració per a arrencar el Docker d'apache GICAR, cal omplir el següent formulari:\n\n\t<div class=\"form col-xs-12 col-md-12\" id=\"form-sandbox\">\n\t<form action='http://formularis.gencat.cat/gencat_forms/AppJava/submitFormulari.do' method='post'>\n\n\t<div class=\"col-xs-12 col-md-4 \">\n\t<label>Peticionari<span class=\"red\">*</span></label><input name='peticionari' type='text' class=\"form-control\" />\n\t</div>\n\t<div class=\"col-xs-12 col-md-4 \">\n\t<label>NIF<span class=\"red\">*</span></label><input name='NIF' type='text' class=\"form-control\" />\n\t</div>\n\t<div class=\"col-xs-12 col-md-4 \">\n\t<label>Correu<span class=\"red\">*</span></label><input name='correu' type='text' class=\"form-control\" />\n\t</div>\n\n\t<div class=\"col-xs-12 col-md-6 \">\n\t<label>Lot d'aplicacions<span class=\"red\">*</span></label><br />\n\t<select name='lot_aplicacions' class=\"form-control custom_select hasCustomSelect\" >\n\t\t<option value='A1'>A1</option>\n\t\t<option value='A2'>A2</option>\n\t\t<option value='A3'>A3</option>\n\t\t<option value='A4'>A4</option>\n\t\t<option value='A5'>A5</option>\n\t\t<option value='A6'>A6</option>\n\t\t<option value='A7'>A7</option>\n\t\t<option value='A8'>A8</option>\n\t\t<option value='A9'>A9</option>\n\t\t<option value='A10'>A10</option>\n\t\t<option value='A11'>A11</option>\n\t</select>\n\t</div>\n\n\t<div class=\"col-xs-12 col-md-12\">\n\t<label>Observacions (informeu els patrons d'url a protegir, així com qualsevol altra qüestió relacionada)<span class=\"red\">*</span></label><textarea name='observacions' class=\"form-control\"> </textarea>\n\t</div>\n\n\t<div class=\"col-xs-12 col-md-3\">\n\t<input id=\"codeCaptcha\" type=\"hidden\" value=\"433905973\" name=\"captchaCode\"/>\n\t<script type=\"text/javascript\">\n\t\t$(function(){\n\t\t\t$(\"#refreshKaptchaImage\").click(function () {\n\t\t\t\tvar valor =  Math.floor(Math.random()*1000000000);\n\t\t\t\t$(\"#codeCaptcha\").attr(\"value\", valor)\n\t\t\t\t$(\"#kaptchaImage\").hide().attr(\"src\", \"http://formularis.gencat.cat/gencat_forms/AppJava/generarKaptcha?kaptchaCode=\"+valor).fadeIn();\n\t\t\t\t$(\"#captchaAnswer\").attr(\"value\", \"\");\n\t\t\t});\n\t\t});\n\t</script>\n\n\t<br />\n\t<img id=\"kaptchaImage\" src=\"http://formularis.gencat.cat/gencat_forms/AppJava/generarKaptcha?kaptchaCode=433905973\" width=\"200\"/>\n\t<img id=\"refreshKaptchaImage\" src=\"http://formularis.gencat.cat/gencat_forms/images/refrescar.png\" style=\"vertical-align: top; cursor:pointer;\"/>\n\n\t<br />\n\t<input type=\"text\" id=\"captchaAnswer\" name=\"captchaAnswer\" class=\"form-control\"/>\n\t<br />\n\t</div>\n\n\t<div class=\"col-xs-12 col-md-12\">\n\t<input type='submit' class=\"btn bgRed white margin_top_xs\" />\n\t</div>\n\t<textarea name='meta_inf' style='display:none;'>\n\t\t<meta-informacio>\n\t\t\t<idFormulari>52697</idFormulari>\n\t\t\t<idioma>ca_ES</idioma>\n\t\t</meta-informacio>\n\t</textarea>\n\n\t</form>\n\t</div>\n\t<div  class=\"clearfix\">&nbsp;</div>\n\n1. Amb les dades que se us proporcionin, podreu arrencar el contenidor amb la següent comanda:\n\n\t\t$ docker run -d -p 80:80 -e \"PS_IP=[ip]\" -e \"AgentConfigDocker=[aco]\" -e \"ContainerHostName=[nom del contenidor]\" -e \"AGENTNAME=[agent_name],[nom de domini]\" -e \"HCOGICAR=[hco]\" -e \"GICARUSER=[user]\" -e \"GICARPWD=[pwd]\" -e \"APPSERVER_PORT_8080_TCP_ADDR=localhost\" -e \"APPSERVER_PORT_8080_TCP_PORT=8080\" --name gicar_dev gicar_dev\n\n\n1. Si necessiteu configuracions específiques per a connectar al vostre servidor d'aplicacions, podeu per fer el següent:\n\n\t- Descarregueu el httpd.conf que s'inclou config.zip del Dockerfile\n\n\t- Creeu la imatge de base de gicar_dev\n\n\t- Creeu la vostra imatge personalitzada de gicar\n\n\t\t\tFROM  gicar_dev\n\n\t\t\t# instal·la els mòduls necessaris, ajp, mod_wl, ...\t\n\n\t\t\tRUN ...\t\n\n\t\t\t# copia el fitxer personalitzat httpd.conf a la ruta correcta\n\t\t\t\n\t\t\tCOPY myhttpd.conf /etc/httpd/conf/httpd.conf\n","objectID":"L2dpY2FyLWludGVncmFjaW8vc2FuZGJveA=="},"L2dpY2FyLWludGVncmFjaW8taW50cm8vdGlwb2xvZ2llcy1pbnRlZ3JhY2lv":{"date":1533312702000,"title":"Modalitats d'integració possibles","description":"Modalitats d'integració possibles d'autenticació amb GICAR","section":"gicar-integracio-intro","taxonomies":[],"toc":true,"weight":1,"path":"/gicar-integracio-intro/tipologies-integracio","content":"En aquest apartat es descriuen les diferents modalitats d'inetgració de l'autenticació amb GICAR que s'ofereixen. En la següent taula es citen les diferents casuístiques d'aplicacions que es despleguen a la Generalitat versus la modalitat d'integració de l'autenticació recomanada.\n\n![Integració Aplicacions GICAR](/related/gicar/mod-autentic.png)\n\nEl 1 significa l'opció recomanada i el 3 l'opció menys recomanada, que només es proposa abordar-la si no és possible abordar les opcions anteriors.\n\nA continuació s'exposen de forma resumida les modalitat d'integració proposades:\n\n\n**(*1). Amb la modalitat d’integració per SiteMinder** es poden assolir les següents modalitats d’autenticació:\n\n- Autenticació amb Usuari i contrasenya contra el Directori Corporatiu.\n- Autenticació amb Certificat amb usuari que estigui al Directori Corporatiu.\n- Autenticació amb Certificat amb usuari que no està al Directori Corporatiu.\n- Autenticació contra el directori de l’EACAT.\n\nEntenem per aquesta modalitat d’autenticació aquella en que en un frontal web que està a XCAT té un agent de SiteMinder instal·lat i utilitza aquest agent per a validar les autenticacions. Aquesta modalitat d’autenticació requereix que el fontal web de l’aplicació estigui a dins del nus XCAT.\n\n\n**(*2). Amb la modalitat d’integració per agent de Shibboleth**:\n\n- Autenticació amb Usuari i contrasenya contra el Directori Corporatiu.\n- Autenticació amb Certificat amb usuari que estigui al Directori Corporatiu.\n- Autenticació amb Certificat amb usuari que no està al Directori Corporatiu.\n- Autenticació contra el Valid del AOC (idCat SMS i Certificat digital).\n\nAmb aquesta modalitat es pot possibilitar que l'usuari pugui escollir quina modalitat d'autenticació vol utilitzar en el moment d'autenticar-se.\n\nEntenem per aquesta modalitat d’autenticació aquella en que en un frontal web que pot estar a XCAT o fora de XCAT té un agent de Shibboleth instal·lat i utilitza aquest agent per a validar les autenticacions. Aquesta modalitat d’autenticació permet que el frontal web estigui dins o fora de XCAT i és el més apropiat per a aplicacions que estan al núvol.\n\n\n**(*3). Amb la modalitat de SAML Out of the box** :\n\n- Autenticació amb Usuari i contrasenya contra el Directori Corporatiu.\n- Autenticació amb Certificat amb usuari que estigui al Directori Corporatiu.\n- Autenticació amb Certificat amb usuari que no està al Directori Corporatiu.\n- Autenticació contra el Valid del AOC (idCat SMS i Certificat digital).\n\nEntenem per aquesta modalitat d’autenticació aquella en que l’aplicació nativament pot parlar protocol SAML2 contra GICAR. Aquesta modalitat d’autenticació permet que l’aplicació pugui fer login contra GICAR ja estigui l’aplicació dins del nus o no.\n\n\n**(*4). Amb la modalitat de Canigó SAML2**:\n\n- Autenticació amb Usuari i contrasenya contra el Directori Corporatiu.\n- Autenticació amb Certificat amb usuari que estigui al Directori Corporatiu.\n- Autenticació amb Certificat amb usuari que no està al Directori Corporatiu.\n- Autenticació contra el Valid del AOC (idCat SMS i Certificat digital).\n\nEntenem per aquesta modalitat d’autenticació aquella en que una aplicació construïda amb Canigó fa servir la llibreria de Canigó de SAML2 per a integrar-se directament amb GICAR sense necessitat d’altres dependències.\n\n\n**(*5). Amb la modalitat de ADFS-GICAR**:\n\n- Autenticació amb Usuari i contrasenya contra el Directori Corporatiu.\n- Autenticació amb Certificat amb usuari que estigui al Directori Corporatiu.\n- Autenticació amb Certificat amb usuari que no està al Directori Corporatiu.\n- Autenticació contra el Valid del AOC (idCat SMS i Certificat digital).\n\nAmb aquesta modalitat es pot possibilitar que l'usuari pugui escollir quina modalitat d'autenticació vol utilitzar en el moment d'autenticar-se.\n\nEntenem per aquesta modalitat d’autenticació aquella en que l’aplicació (habitualment .NET o Microsoft) necessita utilitzar un ADFS per a poder establir la connectivitat contra GICAR.\n\n**(*6). Amb la modalitat de AD, LDAP, o BBDD aprovisionada per GICAR**:\n\n- Autenticació amb Usuari i contrasenya contra el Directori Corporatiu.\n\nEntenem per aquesta modalitat d’autenticació aquella en que l’aplicació delega l’autenticació a un directori actiu, LDAP o BBDD que GICAR aprovisiona. GICAR en aquesta BBDD pot sincronitzar l’usuari amb la seva contrasenya.\n","objectID":"L2dpY2FyLWludGVncmFjaW8taW50cm8vdGlwb2xvZ2llcy1pbnRlZ3JhY2lv"},"L2dpY2FyLWludGVncmFjaW8vd29ya2Zsb3c=":{"date":1465402302000,"title":"Procés d'autenticació amb Siteminder","description":"Descripció del procés i finalització de la sessió activa","sections":"GICAR","taxonomies":[],"weight":3,"path":"/gicar-integracio/workflow","content":"A continuació es descriuen els passos que SiteMinder segueix per portar a terme l’autenticació d’un usuari, i disposar d’un entorn de Single Sign On Web:\r\n\r\n1.\tL’usuari intenta accedir al recurs protegit. Si l’usuari no ha iniciat cap sessió o aquesta ha caducat, l’agent de SiteMinder instal·lat interceptarà la petició per tal de que es produeixi un desafiament d’autenticació (Punt 2). Altrament, si l’usuari té una sessió activa, aquest accedirà directament a l’aplicació.\r\n\r\n1.\tL’Agent de SiteMinder instal·lat en el Servidor Web on resideix el frontal de l’aplicació en qüestió intercepta la petició (primer filtre de virtual hosts) podent:\r\n\r\n\t- Ignorar-la: en el cas que sigui un domini que s’hagi decidit ignorar de la protecció de SiteMinder\r\n\t- Enviar la petició al SiteMinder Policy Server que analitzarà el tipus de protecció, si hi ha una sessió activa, etc.\r\n\r\n1.\tSiteMinder avalua si es tracta d’un recurs protegit\r\n\r\n\t- Si està protegit, SiteMinder avalua si l’usuari té una sessió activa.\r\n\t- Si no té sessió activa, se li  demanen a l’usuari les seves credencials o el Certificat Digital. SiteMinder farà una validació de les credencials al Directori Corporatiu i s’assegurarà de la validesa del certificat. Si tot és correcte, s’obrirà una nova sessió per a l’usuari validat.\r\n\r\n1.\tFeta la validació, SiteMinder (via l’agent) envia a l’aplicació les capçaleres HTTP (indicades en el punt anterior) per a que l’aplicació conegui la identitat de l’usuari validat.\r\n\r\n\tEsmentar que és el browser (client web) de l’usuari el que genera en local la cookie de sessió, mitjançant el qual SiteMinder determina si una sessió està activa o no, així com el temps d’expiració de la mateixa.\r\n\r\n\t![Integració Aplicacions GICAR](/related/gicar/esquema-acces.png)\r\n\r\n1.\tA partir d’aquest moment, és la pròpia aplicació (amb les capçaleres rebudes que identifiquen a la persona autenticada) qui determina si l’usuari està autoritzat, amb quins permisos, etc..\r\n\r\n![Integració Aplicacions GICAR](/related/gicar/esquema-acces2.png)\r\n\r\n## Finalització de la sessió activa\r\n\r\nHi ha dues maneres de terminar una sessió amb GICAR: o bé a través del formulari de logoff específic de GICAR, o bé a partir d’un timeout.\r\n\r\nEl timeout es un paràmetre definit en els Policy Servers que provoca la terminació de la sessió en el cas que s’hagi superat un cert temps sense activitat. Aquest temps màxim d’inactivitat pot ser diferent per cada aplicació. En el cas d’accedir a una aplicació amb GICAR i fer ús del Single Sign On per a accedir a una altra, cal tenir en compte que el temps de timeout no es veurà modificat i seguirà mantenint el valor que estigués indicat per a la primera aplicació.\r\n\r\nUna altra manera per a terminar la sessió, es que l’aplicació invoqui el formulari de logoff que posa a disposició GICAR. Aquest formulari realitza l’esborrat de les cookies associades a la sessió, cosa que provoca la seva finalització. Així doncs, només cal que l’aplicació invoqui una de les URL següents segons l’entorn en que es trobi:\r\n\r\nSi l’aplicació té domini xxx.gencat.cat:\r\n \r\n- A PRE: en funció del que indiquin els administradors de GICAR es farà servir un link o un altre:\r\n\r\n\t- https://preproduccio.idp1-gicar.gencat.cat/siteminderagent/forms/logoff.fcc \r\n\t- https://preproduccio.idp4-gicar.gencat.cat/siteminderagent/forms/logoff.fcc \r\n\r\n- A PRO: en funció del que indiquin els administradors de GICAR es farà servir un link o un altre:\r\n\r\n\t- https://idp1-gicar.gencat.cat/siteminderagent/forms/logoff.fcc \r\n\t- https://idp4-gicar.gencat.cat/siteminderagent/forms/logoff.fcc \r\n\r\nSi l’aplicació té un domini aliè a xxx.gencat.cat, caldrà consultar el tema als responsables de GICAR.\r\n\r\n","objectID":"L2dpY2FyLWludGVncmFjaW8vd29ya2Zsb3c="},"L2dpY2FyLXNhbWwyL2F1dGgtc2FtbDItZmV0LWEtbWlkYQ==":{"date":1534506342000,"title":"Aplicació feta a mida autenticant via SAML2 sense ús d'Apache-Shibboleth","description":"Aplicació feta a mida consumint servei d'autenticació SAML2 sense ús d'Apache-Shibboleth","sections":"gicar-saml2","taxonomies":[],"toc":false,"weight":3,"path":"/gicar-saml2/auth-saml2-fet-a-mida","content":"Com es deia en la introducció, GICAR disposa d’un “Identity Provider”, construït amb la tecnologia Shibboleth, amb capacitat de facilitar tiquets SAML2 a les aplicacions. \r\n\r\nA continuació es detalla quins són els dominis del Identity Provider als que caldrà accedir per a generar el tiquet de SAML2.\r\n\r\n\tPRE: \r\n\thttps://preproduccio.idp1-gicar.gencat.cat/idp/profile/SAML2/Redirect/SSO (per autenticació contra el Directori Corporatiu)\r\n\thttps://preproduccio.idp4-gicar.gencat.cat/idp/profile/SAML2/Redirect/SSO (per autenticació contra el Directori Corporatiu + Autenticació Anònima)\r\n\r\n\tPRO: \r\n\thttps://idp1-gicar.gencat.cat/idp/profile/SAML2/Redirect/SSO (per autenticació contra el Directori Corporatiu)\r\n\thttps://idp4-gicar.gencat.cat/idp/profile/SAML2/Redirect/SSO (per autenticació contra el Directori Corporatiu + Autenticació Anònima)\r\n\r\n**En cas que l'aplicació feta a mida estigui feta amb Canigó es recomana l'ús de la llibreria de Canigó per a la integració amb GICAR via SAML2.**\r\nA través d'aquesta modalitat d'autenticació el framework Canigó és capaç d'integrar-se directament amb GICAR sense necessitat de cap llibreria externa. En aquest cas, veure documentació de Canigó [aquí](https://canigo.ctti.gencat.cat/howtos/2018-08-Canigo-SAML/).\r\n\r\n**En cas que l’aplicació no estigui feta amb Canigó, caldrà que el desenvolupador duguin a terme una de les següents dues opcions:**\r\n\r\n***- OPCIÓ 1:*** \r\nIncorporar llibreries de tercers a l'aplicació per a generar i llegir la petició SAML2. Com a referència principal es pot cosultar la web https://www.samltool.com/, la qual disposa de nombrosos exemples i llibreries fetes en diverses tecnologies per a tractar les peticions SAML2.\r\n\r\n***- OPCIO 2:*** \r\nConstruir la petició SAML2 amb el codi javascript adjunt i decodificar-lo/desxifrar-lo posteriorment:\r\n\r\nPer a dur a terme aquesta opció, cal construir un SAMLRequest que ha de contenir exactament la següent informació, estructurada de la següent forma:\r\n\r\n\t<?xml version=\"1.0\"?> <samlp:AuthnRequest xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\" Consent=\"urn:oasis:names:tc:SAML:2.0:consent:unspecified\" Version=\"2.0\" Destination=\"https://DOMINI _A_ESPECIFICAR_PER_L’EQUIP_GICAR/idp/profile/SAML2/Redirect/SSO\" ID=\"xxxxxxxxxxxxxxxxxxxxx\" IssueInstant=\"2014-12-24T10:35:25.4269359Z\" IsPassive=\"false\" xmlns:samlp=\"urn:oasis:names:tc:SAML:2.0:protocol\"> <saml:Issuer>https://URL del servei peticionari</saml:Issuer> <samlp:NameIDPolicy AllowCreate=\"True\" Format=\"urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified\" /> </samlp:AuthnRequest>\r\n\r\nEn cas que l’aplicació no pugui generar un SAMLRequest amb aquesta parametrització, no podrà integrar-se directament contra GICAR via SAML2, i haurà d’analitzar una altra via d’integració.\r\n\r\nA continuació es proporciona un fragment de codi Javascript que, posat a dins d'una aplicació, permet redirigir a l'usuari cap a GICAR, generant automàticament un SAMLRequest.\r\n\r\n\t<script src=\"rawdeflate.js\"></script>\r\n\r\n\t<script>\r\n\r\n\t//dades de l aplicacio a integrar\r\n\tvar entityid=\"entity ID de l'aplicació integrada definida a GICAR\";\r\n\tvar AssertionConsumerServiceURL=\"URL de refirecció on espera el POST amb el SAMLResponse l'aplicació\";\r\n\r\n\t//url endpoint de GICAR a utilitzar\r\n\tvar endpointGICAR=\"https://A-DEFINIR-gicar.gencat.cat/idp/profile/SAML2/Redirect/SSO?SAMLRequest=\";\r\n\r\n\t//calculem el id de la peticio\r\n\tvar randomnumber = +new Date();\r\n\t//calculem la data d'emissio de la peticio. El desitjable és que la data de la petició es calculi en el servidor web i no en Javascript. Aquest fragment de codi per a calcular la data en Javascript és només per a fer proves, en entorn de producció la data s'hauria de calcular al servidor web de cara a assegurar que estigui generada per un rellotge sincronitzar amb un servidor NTP.\r\n\tvar d = new Date();\r\n\tvar curr_date = d.getDate();\r\n\tvar curr_month = d.getUTCMonth()+1;\r\n\tvar curr_month2 = (curr_month<10?'0':'') + curr_month;\r\n\tvar curr_year = d.getFullYear();\r\n\tvar ymd= curr_year+\"-\"+curr_month2+\"-\"+ curr_date+\"T\";\r\n\tvar curr_hour = d.getUTCHours();\r\n\tvar curr_min = d.getUTCMinutes();\r\n\tvar curr_min2 = (curr_min<10?'0':'') + curr_min;\r\n\tvar curr_sec = d.getUTCSeconds();\r\n\tvar curr_msec = d.getUTCMilliseconds();\r\n\tvar hms=curr_hour + \":\" + curr_min2 + \":\" + curr_sec + \".\" + curr_msec;\r\n\tvar datasaml=ymd+hms;\r\n\r\n\t//generem samlrequest en pla\r\n\tvar samlrequestpla=\"<?xml version=\\\"1.0\\\"?> <samlp:AuthnRequest xmlns:saml=\\\"urn:oasis:names:tc:SAML:2.0:assertion\\\" Version=\\\"2.0\\\" ID=\\\"b\"+randomnumber+\"a\\\" IssueInstant=\\\"\"+datasaml+\"\\\" AssertionConsumerServiceURL=\\\"\"+AssertionConsumerServiceURL+\"\\\" ProtocolBinding=\\\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST\\\" IsPassive=\\\"false\\\" xmlns:samlp=\\\"urn:oasis:names:tc:SAML:2.0:protocol\\\"> <saml:Issuer>\"+entityid+\"</saml:Issuer> </samlp:AuthnRequest>\";\r\n\r\n\t//fem deflate i codificacio en base64\r\n\tvar samlrequestb64 = btoa(RawDeflate.deflate(samlrequestpla));\r\n\r\n\t//codifiquem url\r\n\tvar samlrequest=encodeURIComponent(samlrequestb64);\r\n\r\n\r\n\tvar targeturl=endpointGICAR+samlrequest;\r\n\r\n\t//fem el redirect\r\n\twindow.location.replace(targeturl);\r\n\t</script>\r\n\r\nAquest fragment de codi font té una dependència amb la llibreria \"rawdeflate.js\" que pot ser descarregada del següent [enllaç] (/related/gicar/rawdeflate.js)\r\n\r\nCaldrà que l'equip desenvolupador faci una petició a l’equip GICAR per a incorporar aquesta aplicació com a consumidora del Identity Provider. Com a mínim els responsables de l'aplicació hauran de facilitar la següent informació a l’equip GICAR per a poder autenticar aquest servei:\r\n\r\n- entityID = Haurà de contenir el valor del SAML:Issuer indicat en el SAMLRequest de les peticions que farà l’aplicació. Serà normalment la URL del servei peticionari.\r\n\r\n- Certificat = Certificat X509 que farà servir l’aplicació consumidora per a desencriptar els tiquets SAML que haurà emès GICAR.\r\n\r\n- AssertionConsumerService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST\" = S’haurà d’indicar a quina URL de l’aplicació GICAR haurà de redirigir un cop feta l’autenticació. Serà la URL on es farà la corresponent redirecció, i on es passarà per paràmetre l’atribut SAMLResponse amb el contingut de les respostes que haurà de decodificar i desencriptar l’aplicació.\r\n\r\nCaldrà addicionalment que el desenvolupador especifiqui quina informació voldrà rebre referent a l’usauri que s’haurà autenticat.\r\n\r\n- Caldrà finalment que el desenvolupador decodifiqui el paràmetre SAMLResponse que GICAR retornarà. Aquest paràmetre SAMLResponse contindrà tots els claims de resposta xifrats per defecte, i en casos excepcionals i per necessitats de l'aplicació serà possible que GICAR els envii en clar (assumint que el pas del paràmetre es farà per HTTPS). Caldrà que de la resposta decodificada i desencriptada el desenvolupador capturi la següent informació:\r\n\r\n\tAtribut: urn:oid:1.3.6.1.4.1.5923.1.1.1.6; Valor: NIF de l'usuari\r\n\r\n","objectID":"L2dpY2FyLXNhbWwyL2F1dGgtc2FtbDItZmV0LWEtbWlkYQ=="},"L2dpY2FyLXNhbWwyL2F1dGgtc2FtbDItcGFzc2FyZWxhZ2ljYXJ2YWxpZA==":{"date":1539187902000,"title":"Passarel·la GICAR - Vàlid de l'AOC","description":"Solució basada en SAML2 per a delegar l'autenticació de forma hibrida a GICAR i a Vàlid","sections":"gicar-saml2","taxonomies":[],"toc":true,"weight":5,"path":"/gicar-saml2/auth-saml2-passarelagicarvalid","content":"Aquesta solució està pensada principalment per aplicacions que basen la seva font d’autenticació amb la solució GICAR, amb la qual cosa són aplicacions utilitzades per funcionaris, però que també són aplicacions utilitzades per ciutadans.\n\nFins ara, la única solució que donava GICAR per aquest tipus d’aplicacions era l’autenticació amb certificat digital.\n\nA partir d’ara, a través d’aquesta nova passarel·la, també s’oferirà a aquestes aplicacions que ho sol·licitin, la integració amb el Vàlid del Consorci AOC (IdCatSMS), addicionalment a la integració amb GICAR.\n\nAquesta solució presenta els següents punts destacables:\n\n- **Autenticació hibrida de GICAR + Vàlid per a les aplicacions**. Amb aquesta passarel·la es compatibilitza l’autenticació de GICAR i la de Vàlid, permetent que les aplicacions puguin ser accedides amb un sistema d’autenticació o l’altre.\n\n- **No cal tocar codi de l’aplicació si ja està integrada amb GICAR**. La passarel·la genera una mateixa resposta per part dels dos sistemes d’autenticació cap a les aplicacions. A partir d’ara no cal tocar el codi de les aplicacions per a poder-les autenticar contra Vàlid si aquesta ja està integrada amb GICAR. --> Estalvi a nivell de desenvolupament per part del departament.\n\n- **Abstracció de la complexitat de Vàlid per part de les aplicacions**. Encapsulament de tota la complexitat de les crides a Vàlid dins d’aquesta passarel·la, i l’aplicació només ha de recollir la resposta que aquest servei li retorna en el format que retorna GICAR l’usuari autenticat. --> Estalvi a nivell de desenvolupament per part del departament.\n\nAquesta solució es pot configurar de cara a que l'autenticació sigui només contra Vàlid o per a que deixi elegir als usuaris entre GICAR i Vàlid.\n\n## Funcionament de la solució:\n\nA continuació es presenta la vista global de com funciona aquesta modalitat d'integració:\n\nL’experiència d’usuari amb aquest contenidor seria la següent:\n\n- L’usuari accediria a un path protegit de l’aplicació, se li presenta a l’usuari i formulari de login amb les opcions d’accedir\n\t- Via Vàlid(idcat mòbil o certificat)\n\t- Via GICAR\n\n![Integració amb GICAR](/related/gicar/valid1.png)\n \n- Si l’usuari selecciona via GICAR el formulari canvia el domini de la petició a aplicacions.ensenyament.gencat.cat i salta la protecció GICAR actual de SiteMinder.\n\n![Integració amb GICAR](/related/gicar/valid2.png)\n\n- Si l’usuari selecciona via Vàlid:\n\t- el formulari redireccionarà a Vàlid. \n\t- L’usuari s’autenticarà en Vàlid \n\t- introduiria el NIF i mòbil en la pantalla del Valid\n\n\n![Integració amb GICAR](/related/gicar/valid3.png)\n\n\n- I després posaria el SMS rebut al mòbil:\n\n \n![Integració amb GICAR](/related/gicar/valid4.png)\n\n- Vàlid retornarà la petició al domini de l’aplicació\n\n- El contenidor recollirà el SAMLResponse i generarà les headers de GICAR  que esperen les aplicacions. Per tant en aquest punt tant si l’autenticació s’hagués fet via GICAR com via Vàlid l’aplicació sempre rebria la mateixa capçalera GICAR_ID amb el DNI de l’usuari autenticat, i la capçalera GICAR per tant això assegura compatibilitat amb totes les aplicacions actuals.\n\n\n## Implementació tècnica de la solució:\n\nPer a implementar tècnicament la solució cal seguir els passos exposats a l'apartat **\"Aplicació autenticant via SAML2 a través d'Apache-Shibboleth\"** (https://canigo.ctti.gencat.cat/gicar-saml2/auth-saml2-shibboleth/).\n\nUn cop es disposa el frontal de l'aplicació integrat amb l'agent de Shibboleth es pot configurar aquest agent de Shibboleth (al cloud, via contenidor, o on premise) de cara a que faci una de les següents dues opcions:\n\n- Delegui l'autenticació a GICAR o Vàlid i que l'usuari pugui escollir quin sistema d'autenticació vol utilitzar.\n- Delegar directament l'autenticació a Vàlid. \n\nEl proveïdor d'aplicacions haurà de contactar amb la OTGICAR de cara a que li transmeti quines són exactament les configuracions que caldran per a fer funcionar aquesta solució.\n","objectID":"L2dpY2FyLXNhbWwyL2F1dGgtc2FtbDItcGFzc2FyZWxhZ2ljYXJ2YWxpZA=="},"L2dpY2FyLXNhbWwyL2F1dGgtc2FtbDItYWRmcw==":{"date":1534435902000,"title":"Aplicació Microsoft/.NET integrada amb GICAR via ADFS","description":"","sections":"gicar-saml2","taxonomies":[],"toc":true,"weight":4,"path":"/gicar-saml2/auth-saml2-adfs","content":"Aquesta documentació defineix les especificacions tècniques per a la integració de la federació d’identitats de GICAR implantat sobre el producte Shibboleth per accedir a aplicacions desenvolupades en tecnologies Microsoft mitjançant ADFS (Active Directory Federation Services) de Microsoft.\r\n\r\nEn aquest tutorial s'explica exactament com integrar un Sharepoint amb aquesta tipologia d'integració.\r\n\r\nA continuació es presenta la vista global del sistema:\r\n\r\n![Integració amb GICAR](/related/gicar/saml-ShibAdfsShp.png)\r\n\r\nLa seqüència es la següent:\r\n\r\n1. El client amb el seu navegador intenta accedir a una aplicació web desplegada sobre Sharepoint.\r\n\r\n2. Sharepoint detecta que el recurs està protegit i redirigeix l’usuari cap a AD FS.\r\n\r\n3. El servei AD FS presenta a l’usuari la pàgina WAYF (Where Are you From) per a que l’usuari indiqui on es vol autenticar (actualment aquesta pàgina no es presenta ja que només es pot autenticar amb GICAR).\r\n\r\n4. El navegador del client es redirigeix cap a l’Identity Provider de GICAR (Shibboleth) e inicia una transacció d’autenticació sota el protocol SAML 2.0.\r\n\r\n5. Se li presenta al client el formulari de captura de credencials de GICAR.\r\n\r\n6. Es validen les credencials.\r\n\r\n7. L’Identity Provider genera un token en format SAML 2.0 amb la informació de l’usuari autentica i redirigeix l’usuari cap a l’ADFS.\r\n\r\n8. L’ADFS verifica el token rebut i modifica la informació per adaptar-la a la que necessita Sharepoint i finalment deixa passar l’usuari cap a Sharepoint amb aquesta informació. Sharepoint presentarà l’aplicació web sol·licitada en el punt 1.\r\n\r\n## Configuració de l'ADFS per autenticar contra GICAR:\r\n\r\n**Importar el certificat a la màquina de l'ADFS**\r\n\r\nA la màquina on es trobat instal·lat el servei ADFS realitzar els següents passos:\r\n\r\n- Demanar a la OTGICAR el certificat del Idnetity Provider de GICAR i copiar-lo a la màquina de l'ADFS.\r\n- A la màquina del ADFS, en la finestra Certificate, a la pestanya General, clicar a  Install Certificate per iniciar el Certificate Import Wizard.\r\n- Clicar sobre el botó  Next.\r\n- A la finestra Certificate Store, clicar sobre la opció Place all certificates in the following store.\r\n- Clicar sobre el botó Browse, i llavors clicar sobre el botó Show physical stores.\r\n- Sobre la carpeta Trusted Root Certificate Authorities, seleccionar Local Computer, i llavors clicar sobre el botó OK.\r\n- Clicar sobre el botó Next, Finish, OK i finalment sobre el botó OK.\r\n\r\n**Afegir Identity Provider (Shibboleth) com un Claim Provider**\r\n\r\nFent servir PowerShell s’afegeix l’Identity Provider a ADFS, obrint  una consola de comandes i executant les següents comandes Powershell:\r\n\r\n\tAdd-PSSnapIn Microsoft.Adfs.PowerShell\r\n\r\n\tAdd-ADFSClaimsProviderTrust -Name \"Shibboleth IdP\" –MetadataFile https://idp-gicar.gencat.cat/idp/profile/Metadata/SAML\r\n\r\n\tSet-ADFSClaimsProviderTrust –TargetName \"Shibboleth IdP\" –SignatureAlgorithm http://www.w3.org/2000/09/xmldsig#rsa-sha1\r\n\r\n\r\nEn cas que l’ADFS no tingui sortida a Internet, l’arxiu metadata del Shibboleth es pot copiar en una ruta local dins del servidor on està hostatjat l’ADFS. En aquest cas, en la primera sentència anterior s’ha de canviar el path del “MetadataFile” per la ruta local del servidor. \r\n\r\nPer altra banda, i també fent servir PowerShell, s’han d’executar les següents comandes per tal de que l’ADFS no comprovi la validesa dels certificats contra CatCert (ja que, si no hi ha sortida cap Internet, el sistema no funcionarà). \r\n\r\n\tAdd-PSSnapIn Microsoft.Adfs.PowerShell\r\n\r\n\tSet-AdfsClaimsProviderTrust –TargetName “Shibboleth IdP” –SigningCertificateRevocationCheck “None”\r\n\tSet-AdfsClaimsProviderTrust –TargetName “Shibboleth IdP” –EncryptionCertificateRevocationCheck “None”\r\n\r\n\tSet-AdfsRelyingPartyTrust –TargetName “Sharepoint” –SigningCertificateRevocationCheck “None”\r\n\r\n\r\n**Afegir Claim rules per a Identity Provider**\r\n\r\nLes Claim Rules defineixen com els atributs rebuts en el token SAML 2.0 generat per l’Identity Provider es transformen en atributs de ADFS.\r\n\r\nCal seguir els següents passos:\r\n- Obrir la consola de gestió de ADFS. En el menú Start, clicar sobre Administrative tools, i llavors clicar sobre AD FS Management.\r\n- Després que el snap-in es carrega, clicar al node Trust Relationships, i llavors seleccionar Claims Provider Trusts.\r\n- En el panell central de AD FS Management, fer click amb el botò dret Shibboleth IdP, i llavors fer click sobre Edit Claim Rules.\r\n- A la pestanya Acceptance Transform Rules, clicar sobre el botó Add Rule.\r\n- A la plana Select Rule Template, seleccionar Send Claims Using a Custom Rule, i llavors pitjar sobre el botó Next.\r\n- A la plana Configure Rule, dintre de la capsa Claim rule name, escriure “Transform mail to E-Mail Address”.\r\n- A la finestra Custom Rule, escriure o copiar/enganxar el següent text:\r\n\r\n\tc:[Type == \"urn:oid:0.9.2342.19200300.100.1.3\"]\r\n\t => issue(Type = \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress\", Issuer = c.Issuer, OriginalIssuer = c.OriginalIssuer, Value = c.Value, ValueType = c.ValueType);\r\n\r\n- Fer click sobre el botó Finish.\r\n- A la pestanya Acceptance Transform Rules, fer click sobre el botó Add Rule.\r\n- A la plana Select Rule Template, seleccionar Send Claims Using a Custom Rule, i llavors fer click sobre el botó Next.\r\n- A la plana Configure Rule, en la capta Claim rule name, escriure “Transform NIF to Name”.\r\n- A la finestra Custom Rule, escriure o copiar/enganxar el següent text:\r\n\r\n\tc:[Type == \"urn:oid:1.3.6.1.4.1.5923.1.1.1.6\"]\r\n\t=> issue(Type = \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\", Issuer = c.Issuer, OriginalIssuer = c.OriginalIssuer, Value = c.Value, ValueType = c.ValueType);\r\n\r\n- Fer click sobre Finish, i finalment sobre OK.\r\n\r\n\r\n**Configurar Sharepoint com a Relying Party**\r\n\r\nDintre de ADFS cal configurar Sharepoint com un “relying party” dels atributs proporcionats per ADFS.\r\n\r\n- Obrir la consola de gestió de. En el menú Start, fer click a Administrative Tools, i llavors fer click sobre AD FS 2.0 Management.\r\n- Després que l’snap-in s’ha carregat, fer click sobre el node Trust Relationships, i llavors seleccionar Relying Party Trusts.\r\n\r\n![Integració amb GICAR](/related/gicar/gicar-adfs1.png)\r\n \r\n- Fer click amb el botó dret sobre Relying Party Trusts i llavors fer click sobre Add Relying Party Trust per iniciar el “Relying Party trust wizard”. \r\n\r\n![Integració amb GICAR](/related/gicar/gicar-adfs2.png)\r\n \r\n- Fer click sobre el botó Start per iniciar el procés d’afegir una aplicació web Sharepoint 2010 com a Relying Party.\r\n\r\n![Integració amb GICAR](/related/gicar/gicar-adfs3.png)\r\n \r\n- A la plana Select Data Source, seleccionar Enter data about the Relying party manually, i fer click sobre el botó Next.\r\n\r\n![Integració amb GICAR](/related/gicar/gicar-adfs4.png)\r\n \r\n- A la plana Specify Display Name, introduir el nom per mostrar, per exemple “SharePoint” i opcionalment una descripció, llavors fer click sobre Next.\r\n\r\n![Integració amb GICAR](/related/gicar/gicar-adfs5.png)\r\n \r\n- A la plana Choose Profile seleccionar AD FS 2.0 profile i fer click sobre Next.\r\n\r\n![Integració amb GICAR](/related/gicar/gicar-adfs6.png)\r\n \r\n- A la plana Configure Certificate, es pot seleccionar un certificat per xifrar el token intercanviat entre ADFS i Sharepoint però no es necessari ja que la connexió amb Sharepoint ja es fa sobre SSL.  Fer click sobre Next.\r\n\r\n![Integració amb GICAR](/related/gicar/gicar-adfs7.png)\r\n \r\n- Marcar el checkbox  Enable support for the WS-Fed Passive protocol.  Per la URL del protocol, introduir la URL del site root per a la aplicació web Sharepoint amb la terminació “_trust/”. Fer click  a Next.\r\n\r\n![Integració amb GICAR](/related/gicar/gicar-adfs8.png)\r\n \r\n- A la plana Configure Identifiers, s’indica un “realm” que l’aplicació web passarà a ADFS 2.0 quan un usuari accedeix a l’aplicació.  \r\nEl  “realm” normalement es crea en el format urn:foo:bar.  Cal tenir en compte aquest nom ja que es necessitarà en configurar Sharepoint Fer click sobre Next.\r\n\r\n![Integració amb GICAR](/related/gicar/gicar-adfs9.png)\r\n \r\n- A la plana Choose Issuance Authorization Rules no cal fer res, fer click a Next. \r\n\r\n![Integració amb GICAR](/related/gicar/gicar-adfs10.png)\r\n \r\n- A la plana Ready to Add Trust, revisar la configuració i fer click a Next per continuar.\r\n\r\n![Integració amb GICAR](/related/gicar/gicar-adfs11.png)\r\n \r\n- Deixar marcat el checkbox Open the Edit Claim Rules dialog for this relying party trust when the wizard closes per continuar en el següent punt.\r\n\r\n**Configurar Claim Rules per a Sharepoint**\r\n\r\nCom a continuació del pas anterior (o fent click amb el botó dret sobre el “Relying Party” amb nom “Sharepoint” i seleccionat “Edit Claim Rules”), es poden configurar les regles que transformen els atributs de ADFS en els atributs que necessita Sharepoint.\r\n \r\n- Primer accedim a la pantalla d’edició de regles.\r\n\r\n![Integració amb GICAR](/related/gicar/gicar-adfs12.png)\r\n \r\n- A la pestanya Issuance Transform Rules, fer click al botó Add Rule. \r\n\r\n![Integració amb GICAR](/related/gicar/gicar-adfs13.png)\r\n \r\n- A la plana Select Rule Template, seleccionar Pass Through or Filter an Incoming Claim, i llavors fer click a Next.\r\n\r\n![Integració amb GICAR](/related/gicar/gicar-adfs14.png)\r\n \r\n- A la plana Configuration Rule, introduir els següents valors:\r\n\r\n\tName\t\t\t\t\tValue\r\n\tClaim rule name\t\t\t“E-Mail Address Claim from Shibboleth”\r\n\tIncoming claim type\t\tE-Mail Address\r\n\r\n- Deixar seleccionada la opció Pass through all claim values i fer click a Finish.\r\n\r\n- Repetir el mateix procés a Issuance Transform Rules amb els següents valors: \r\n\r\n\tName\t\t\t\t\tValue\r\n\tClaim rule name\t\t\t“NIF Claim from Shibboleth”\r\n\tIncoming claim type\t\tName\r\n\r\n\r\n## CONFIGURACIÓ SHAREPOINT\r\n\r\n**Creació de Trusted Identity Provider corresponent a ADFS**\r\n\r\nEl passos que es descriuen a continuació assignen ADFS com un proveïdor d’identitats de confiança per a Sharepoint, cal obrir la consola de gestió PowerShell per  SharePoint 2010 com a usuari administrador i realitzar les següents accions:\r\n\r\n- Obtenir el certificat de firma de ADFS, a la màquina on està ADFS accedir a la consola de gestió de ADFS i visitar a l’arbre de navegació el node ADFS -> Service -> Certificates. Accedir al certificat de firma (Token-signing) i obtenir un copia que guardarem a la màquina de Sharepoint a “C:\\share\\adfs.cer” \r\n\r\n- Fer click a Start, All programs, Microsoft SharePoint 2010 Products and SharePoint Management Shell i executar a Windows PowerShell les següents instruccions:\r\n\r\n\t$certPath = “c:\\share\\adfs.cer”\r\n\t$cert = New-Object System.Security.Cryptography.X509Certificates.X509Certificate2(\"$certPath\")\r\n\r\n- Creació de una nova autoritat proveïdora arrel a Sharepoint executant la següent comanda:\r\n\r\n\tNew-SPTrustedRootAuthority -Name \"IDMGT ADFS Token Signing Trusted Root Authority\" -Certificate $cert\r\n\r\n\r\n- Creació de la vinculació amb els atributs que SharePoint 2010 farà servir (email i name que conté el NIF):\r\n\r\n\t$map1 = New-SPClaimTypeMapping -IncomingClaimType \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress\" -IncomingClaimTypeDisplayName \"EmailAddress\" –SameAsIncoming\r\n\r\n\t$map2 = New-SPClaimTypeMapping -IncomingClaimType \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\" -IncomingClaimTypeDisplayName \"Name\" –SameAsIncoming\r\n\r\n- Creació de la variable “realm” (única pel site), ha de coincidir amb la indicada a ADFS a l’apartat “Configurar Sharepoint com a Relying Party”.\r\n\r\n\t$realm = \"urn:sharepoint:portal\"\r\n\r\n\t$signinurl = “https://<adfs_domain>/adfs/ls”\r\n\r\n- Creació i configuració del nou SPTrustedIdentityTokenIssuer per a que SharePoint 2010 accepti assercions SAML (WS-Fed Passive only). \r\n\r\n\t$ap = New-SPTrustedIdentityTokenIssuer -Name \"ADFSv2-sts.idmgt.demo\" -Description \"ADFSv2-sts.idmgt.demo\" -realm $realm -ImportTrustCertificate $cert -ClaimsMappings $map1,$map2 -SignInUrl $signinurl -IdentifierClaim $map1.InputClaimType\r\n\r\n- Revisar el  SPTrustedIdentityTokenIssuer amb la següent instrucció:\r\n\r\n\tGet-SPTrustedIdentityTokenIssuer –Identity \"ADFSv2-sts.idmgt.demo\"\r\n\r\n- Tancar la consola de comandes.\r\n\r\n**Declaració del Trusted Identity Provider per a la aplicació web**\r\n\r\nPer associar ADFS (Trusted Identity Provider) a la aplicació web cal seguir els següents pasos:\r\n\r\n- Fer click a Start, All programs, Microsoft SharePoint Products and SharePoint Central Administration.\r\n\r\n- Sota Application Management, fer click sobre l’enllaç Manage Web Applications.\r\n\r\n- Seleccionar a la llista l’aplicació web que farà servir AD FS 2.0 per i fer click a  Authentication Providers en el menu principal.\r\n\r\n- A la plana Authentication Provider, fer click a l’enllaç en el quadre de que correspon a la zona apropiada en que es farà servir per autenticar. Probablement Default Zone si no hi cap altre configurada amb aquest propòsit.\r\n\r\n- A la plana Edit Authentication, baixar fins la secció Claims Authentication Types.\r\n\r\n![Integració amb GICAR](/related/gicar/gicar-adfs15.png)\r\n \r\n- Seleccionar Trusted Identity Provider i llavors “ADFSv2-sts.idmgt.demo” a la llista.\r\n- Fer click a Save\r\n- Tancar  SharePoint Central Administration.\r\n \r\n","objectID":"L2dpY2FyLXNhbWwyL2F1dGgtc2FtbDItYWRmcw=="},"L2dpY2FyLXNhbWwyL2F1dGgtc2FtbDItaW50cm8=":{"date":1533571902000,"title":"Descripció del protocol d’autenticació SAML2","description":"Descripció del funcionament del protocol d'autenticació SAML2","sections":"gicar-saml2","taxonomies":[],"toc":true,"weight":1,"path":"/gicar-saml2/auth-saml2-intro","content":"En cas que l’aplicació a integrar estigui preparada per a treballar amb mecanismes de delegació de l’autenticació a través de protocol SAML2, GICAR disposa de mecanismes per a possibilitar aquesta delegació de l’autenticació a través d’aquest protocol. El producte que utilitza GICAR per a proveir aquesta funcionalitat és el Shibboleth.\n\nEl Shibboleth de GICAR recull les capçaleres HTTP generades en una sessió de SiteMinder, i genera un ticket SAML2 amb la informació continguda en aquestes capçaleres, que pot rebre una aplicació.\n\nEn aquests casos és recomanable que l’equip tècnic de l’aplicació contacti amb l’Equip GICAR, per tal de fer un estudi de les possibilitats reals de que l’aplicació delegui l’autenticació a un identity provider extern. Un cop fet aquest estudi en cas que sigui viable es configurarà en l’aplicació aquesta delegació de l’autenticació contra el servei GICAR.\n\nEs detalla a continuació com funciona una integració mitjançant protocol SAML. Cal comentar abans de descriure el funcionament a què fan referència els següents conceptes:\n\n- El \"ServiceProvider\" és l’aplicació integrada que demana l’autenticació.\n- El “User Agent” és el navegador de l’usuari.\n- L’\"Identity Provider\" és el proveïdor d’identitats de GICAR.\n\n1. Al protocol SAML2, el fluxe el comença l’aplicació integrada que demana l’autenticació (Service Provider). Aquesta, a través d’un HTTP Redirect, sol·licita al Identity Provider un tiquet SAML2.\n\nD’aquesta manera, l’aplicació consumidora (service provider) de tiquets SAML2 farà un posts a les URL del Identity Provider per a obtenir un tiquet SAML2 vàlid de la següent manera, utilitzant el servei de Redirect/SSO.\n\n\thttps://preproduccio.idp1-gicar.gencat.cat/idp/profile/SAML2/Redirect/SSO?SAMLRequest=7b0HYBxJliUmL23Ke39K9UrX4HShCIBgEyTYkEAQ7MGIzeaS7B1pRyMpqyqBymVWZV1mFkDM7Z28995777333nvvvfe6O51OJ%2fff%2fz9cZmQBbPbOStrJniGAqsgfP358Hz8iHjfZolw9Ol638%2bWr%2fBet86ZNz55%2b9lEx2957uPPpw%2f2HD7YPZvn%2b9v7O3mz74MHu%2bfbu%2fZ17ef7w%2fvnO7N5H6U%2fmdVNUy88%2b2hvvfJSeNc06P1s2bbZs6aOd3f3tnQfbuw%2fe7N57tL%2f36P7%2b%2bP7ew5%2f6KH1K%2fRTLrOU35227ah7dvbuq81VdzdbTaVGNi9lq%2b6KYZvX4Il9Os3ZM%2f79LH1Kr6rwo87uvj794vnf3VT4r6nza3n39%2bsuP0pNq2eToeV0vH1VZUzSPltkibx6100do%2f4iQfDSVRo%2fWy2aVT4vzIp99lL5blMvmERNj89vUfVtNq%2fKjo8c82Fpe3fxS1jR5jcF%2bdITByljH2ey8GU%2fbtvCHiA%2fvUuvLYpo3d9t63bSP70pPRzpZLwj%2b2dOXVVlMr9NnVb3INox4d7zLn9CEnnPTcNzHZVldndR51uaffUS95R%2bld48e3%2b1zxdH%2fAw%3d%3d&RelayState=dab8b17c-460d-455e-ac8d-6d8f763afe43\n\nLes URLs de petició del Identity Provider: https://preproduccio.idp1-gicar.gencat.cat/idp/profile/SAML2/Redirect/SSO\n\nEl paràmetre SAMLRequest, el qual conté les dades del servidor que demana el tiquet SAML2: \n\n\tSAMLRequest=7b0HYBxJliUmL23Ke39K9UrX4HShCIBgEyTYkEAQ7MGIzeaS7B1pRyMpqyqBymVWZV1mFkDM7Z28995777333nvvvfe6O51OJ%2fff%2fz9cZmQBbPbOStrJniGAqsgfP358Hz8iHjfZolw9Ol638%2bWr%2fBet86ZNz55%2b9lEx2957uPPpw%2f2HD7YPZvn%2b9v7O3mz74MHu%2bfbu%2fZ17ef7w%2fvnO7N5H6U%2fmdVNUy88%2b2hvvfJSeNc06P1s2bbZs6aOd3f3tnQfbuw%2fe7N57tL%2f36P7%2b%2bP7ew5%2f6KH1K%2fRTLrOU35227ah7dvbuq81VdzdbTaVGNi9lq%2b6KYZvX4Il9Os3ZM%2f79LH1Kr6rwo87uvj794vnf3VT4r6nza3n39%2bsuP0pNq2eToeV0vH1VZUzSPltkibx6100do%2f4iQfDSVRo%2fWy2aVT4vzIp99lL5blMvmERNj89vUfVtNq%2fKjo8c82Fpe3fxS1jR5jcF%2bdITByljH2ey8GU%2fbtvCHiA%2fvUuvLYpo3d9t63bSP70pPRzpZLwj%2b2dOXVVlMr9NnVb3INox4d7zLn9CEnnPTcNzHZVldndR51uaffUS95R%2bld48e3%2b1zxdH%2fAw%3d%3d \n\nA continuació es presenta una petició típica d’un tiquet SAML2, decodificada en Base64\n\n1.\tUn cop enviada la sol·licitud d’autenticació del service provider cap al Identity Provider, en funció dels paràmetres continguts en el SAMLRequest, salta el formulari de login de GICAR. L’usuari s’autentica amb usuari i contrasenya o certificat.\n\n1.\tUn cop l’usuari s’ha autenticat, el identity provider torna a redirigir a l’usuari cap a la URL del service provider retornant via POST al service provider dos paràmetres:\n\n\t- SAMLResponse: la qual conté la resposta a la petició d’autenticació feta amb anterioritat, codificada en base 64. Després d’haver estat decodificat un valor tipus d’aquesta resposta podria ser el següent:\n\n\t\t\t<?xml version=\"1.0\" encoding=\"UTF-8\"?><saml2p:Response xmlns:saml2p=\"urn:oasis:names:tc:SAML:2.0:protocol\" Destination=\"https://adfs.ctti.gencat.cat/adfs/ls/\" ID=\"_133a920d5ca854a8a7979f1c3162eb60\" InResponseTo=\"id-5f5c7321-fe8a-4941-a5ec-4d48f027a7c8\" IssueInstant=\"2014-10-07T06:13:51.250Z\" Version=\"2.0\"><saml2:Issuer xmlns:saml2=\"urn:oasis:names:tc:SAML:2.0:assertion\" Format=\"urn:oasis:names:tc:SAML:2.0:nameid-format:entity\">https://idp-gicar.gencat.cat/idp/shibboleth</saml2:Issuer><saml2p:Status><saml2p:StatusCode Value=\"urn:oasis:names:tc:SAML:2.0:status:Success\"/></saml2p:Status><saml2:EncryptedAssertion xmlns:saml2=\"urn:oasis:names:tc:SAML:2.0:assertion\"><xenc:EncryptedData xmlns:xenc=\"http://www.w3.org/2001/04/xmlenc#\" Id=\"_cf60828ecfbe1f9a1630ecfd411180e5\" Type=\"http://www.w3.org/2001/04/xmlenc#Element\"><xenc:EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#aes128-cbc\" xmlns:xenc=\"http://www.w3.org/2001/04/xmlenc#\"/><ds:KeyInfo xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\"><xenc:EncryptedKey Id=\"_57045e4cf2bdf58b89dc50bf71741783\" xmlns:xenc=\"http://www.w3.org/2001/04/xmlenc#\"><xenc:EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p\" xmlns:xenc=\"http://www.w3.org/2001/04/xmlenc#\"><ds:DigestMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\" xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\"/></xenc:EncryptionMethod><ds:KeyInfo><ds:X509Data><ds:X509Certificate>.............DADES XIFRADES..................................... =</xenc:CipherValue></xenc:CipherData></xenc:EncryptedKey></ds:KeyInfo><xenc:CipherData xmlns:xenc=\"http://www.w3.org/2001/04/xmlenc#\"><xenc:CipherValue>...................................DADES XIFRADES.............................................==</xenc:CipherValue></xenc:CipherData></xenc:EncryptedData></saml2:EncryptedAssertion></saml2p:Response>\n\n\t- RelayState: El qual torna a prendre el mateix valor que amb anterioritat.\n\n1.\tL’aplicació captura el SAMLResponse, i decodifica el contingut d’aquest tiquet. Si el resultat del SAML Response significa que el Identity Provider dóna per bona l’autenticació, el Service Provider deixarà passar a l’usuari.\n\n![Integració Aplicacions GICAR](/related/gicar/saml.png)\n\nA continuació es facilita un exemple de SAMLResponse generat per GICAR, codificat en base64, i retornat via POST a l'aplicació:\n\n\t<?xml version=\"1.0\" encoding=\"UTF-8\"?><saml2p:Response xmlns:saml2p=\"urn:oasis:names:tc:SAML:2.0:protocol\" Destination=\"https://preproduccio.gram.gencat.cat/api/backoffice/v1/authenticate\" ID=\"_c598ef62b4c5cb25f1ca07ae4d4439e5\" InResponseTo=\"b1500279647918a\" IssueInstant=\"2017-07-17T08:22:39.386Z\" Version=\"2.0\"><saml2:Issuer xmlns:saml2=\"urn:oasis:names:tc:SAML:2.0:assertion\" Format=\"urn:oasis:names:tc:SAML:2.0:nameid-format:entity\">https://preproduccio.idp1-gicar.gencat.cat/idp/shibboleth</saml2:Issuer><saml2p:Status><saml2p:StatusCode Value=\"urn:oasis:names:tc:SAML:2.0:status:Success\"/></saml2p:Status><saml2:EncryptedAssertion xmlns:saml2=\"urn:oasis:names:tc:SAML:2.0:assertion\"><xenc:EncryptedData xmlns:xenc=\"http://www.w3.org/2001/04/xmlenc#\" Id=\"_5893e5b42d7e58e3df4a4299c531d40f\" Type=\"http://www.w3.org/2001/04/xmlenc#Element\"><xenc:EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#aes128-cbc\" xmlns:xenc=\"http://www.w3.org/2001/04/xmlenc#\"/><ds:KeyInfo xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\"><xenc:EncryptedKey Id=\"_3508ee822d00bc83ca4604042d993d21\" xmlns:xenc=\"http://www.w3.org/2001/04/xmlenc#\"><xenc:EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p\" xmlns:xenc=\"http://www.w3.org/2001/04/xmlenc#\"><ds:DigestMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\" xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\"/></xenc:EncryptionMethod><ds:KeyInfo><ds:X509Data><ds:X509Certificate>MIIDYjCCAkqgAwIBAgIBajANBgkqhkiG9w0BAQUFADBpMSEwHwYDVQQKExhHZW5lcmFsaXRhdCBk ZSBDYXRhbHVueWExDTALBgNVBAsTBENUVEkxETAPBgNVBAMTCEdJQ0FSLUNBMSIwIAYJKoZIhvcN AQkBFhNnZGkuY3R0aUBnZW5jYXQuY2F0MB4XDTE3MDcwNzE0MTkwMFoXDTQ3MDcwNzE0MTkwMFow DzENMAsGA1UEAxMER1JBTTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAKQeB0mI24Oj YBRDQCepk3bcN+M7QBt89Kq+4nWBYE4bI6DT/Rm7NoS4lV/0a3OmYvZBbjo4kwShzj3zHowK3hNR wHEsmLNMPb8MlYroeHCVOH50LZNsvCjDsineb4C+zWeVlUOW/XK7UeYfqOb9KwhLOSnXu45chW9U F4ydHACbxG2l5Uycx6Ibi9TAigNA64iZhxzTqbqx5HPjm3qlkJNdJgvNQMf1op5X60SB/adXy6yH vqYAPuuF1kbxbo4WhfPoVcGPXO4CIDomwElFHMO0lRr7zO2oS8pC800a1QBe4W/yPuqGDNq5It1l /zznNPin/XO7At5mZo9A9fRCeTsCAwEAAaNvMG0wDAYDVR0TAQH/BAIwADAdBgNVHQ4EFgQUe4tj 5wwgHs2ebQx0MTFpBwIFZLQwCwYDVR0PBAQDAgXgMBEGCWCGSAGG+EIBAQQEAwIGQDAeBglghkgB hvhCAQ0EERYPeGNhIGNlcnRpZmljYXRlMA0GCSqGSIb3DQEBBQUAA4IBAQBihTW80FDlL/FfHzhI mrz4dhPc2hZkteKwKrCyFQb1+fCOcLW9fWvRiJrnIeNpkhweyaX3B2GBQmo/vL/VON9cMGWG66rg UkIsma/rnszefwCdkUC3lKAVhkWOcAAm9DTf71IwbLmBPRb2dGrbSuMFQebs+y9KM9pGe5S0kZ4X bzPWvEBBN3qFNo/zVvppYfdKHzh1+pwcc3LY4zjnBleKfqlx2W1xjjm/R+y9j6iVHZrIocMmxXmd I4mbuXhfZmWi0AmSNGmFcF00RPKdrlS+YuLOoM2pqXn6K15vtD6U4SFbC3gT4TtgvD4CZ0ejkXmT 0gumMTYpP5JjJH2GfyM3</ds:X509Certificate></ds:X509Data></ds:KeyInfo><xenc:CipherData xmlns:xenc=\"http://www.w3.org/2001/04/xmlenc#\"><xenc:CipherValue>OWqVh4Qcn4lXpmkSBGxbSeDXM7gqv4P0Cj1VsaxA/q74yP7M8naICurbglQx1W/SCTkyhQ5jW0BIRvdhAm6ofh0rhSYOkUMiJqpRJkzAvdq37B0l3fdCZSSng5+n4lCLtPbg/uCp19gFWRM6pv+lkCBJaIjQlA2xqaozaVpvt/xeAI8KYM5MZg6PkObO34PXsKslJSYIxu3JzZ4clPnq8FE4AmH8rTbzKUPpOAYRmf93LkrNuDpcZXg8wlYjaOZoXH03isdtfENPhEGCec1yasrRjFlLdd0u3ry5ElRWdCf6eHeIEZBSB6pHv1dKXXZM11CIS2u8PkvvfPGBg5Q6lg==</xenc:CipherValue></xenc:CipherData></xenc:EncryptedKey></ds:KeyInfo><xenc:CipherData xmlns:xenc=\"http://www.w3.org/2001/04/xmlenc#\"><xenc:CipherValue>**xxxxxxxxxxxxxxxxx-DADES DE L'USUARI XIFRADES-xxxxxxxxxxxxxxxxxxxxxx**</xenc:CipherValue></xenc:CipherData></xenc:EncryptedData></saml2:EncryptedAssertion></saml2p:Response>\n\t\nDecodificant el SAMLResponse es podran obtenir els següents atributs del XML de resposta SAML:\nAtribut: urn:oid:0.9.2342.19200300.100.1.1; \nValor: Codi intern de l'usuari\n\nAtribut: urn:oid:1.3.6.1.4.1.5923.1.1.1.6; \nValor: NIF de l'usuari\n\nPel cas de GICAR ens podem trobar amb diverses modalitats d'autenticació que fan ús del protocol SAML. Són les següents:\n\n1. [Aplicació feta a mida que es faci a mida les crides SAML2](https://canigo.ctti.gencat.cat/gicar-saml2/auth-saml2-fet-a-mida/)\n1. [A través de la modalitat de Canigó SAML2](https://canigo.ctti.gencat.cat/gicar-saml2/auth-saml2-fet-a-mida/)\n1. [A través de ADFS](https://canigo.ctti.gencat.cat/gicar-saml2/auth-saml2-adfs/)\n1. Aplicacions que ja suporten SAML2 \"out-of-the-box\"\n1. [A través de l'Apache amb mòdul de Shibboleth instal·lat](https://canigo.ctti.gencat.cat/gicar-saml2/auth-saml2-shibboleth/)\n\n","objectID":"L2dpY2FyLXNhbWwyL2F1dGgtc2FtbDItaW50cm8="},"L2dpY2FyLXNhbWwyL2F1dGgtc2FtbDItc2hpYmJvbGV0aA==":{"date":1534504842000,"title":"Aplicació autenticant via SAML2 a través d'Apache-Shibboleth","description":"Descripció de com utilitzar la imatge de contenidor o com desplegar-ho On Premise.","sections":"gicar-saml2","taxonomies":[],"toc":false,"weight":2,"path":"/gicar-saml2/auth-saml2-shibboleth","content":"Es disposa d'una modalitat d'integració on un frontal apache es pot integrar amb GICAR a través de Shibboleth-SAML2. En aquesta modalitat es desplega en l'apache el mòdul de \"service provider\" de Shibboleth i aquest possibilita les redireccions d'autenticació de l'aplicació contra GICAR.\r\n\r\nA banda d'això aquesta modalitat d'integració abstreu completament el desenvolupador de la complexitat d'entendre el detall de funcionament del protocol SAMLv2 donat que el mòdul transforma la resposta de SAMLv2 en les headers de GICAR estàndard.\r\n\r\nAquesta modalitat d'integració està indicada per aplicacions fetes a mida, o per aplicacions que siguin capaces de delegar l'autenticació a través de Headers (com les que s'integren directament amb SiteMinder), i està especialment recomanada per aplicacions que es despleguin al Cloud Públic, donat que, a diferència de la integració amb SiteMinder, aquesta modalitat d'integració permet que una aplicació que no tingui el frontal a dins de XCAT pugui fer login contra GICAR. \r\n\r\n## Sobre plataformes Cloud:\r\n\r\nPer a poder possibilitar això es disposa d'una imatge de **contenidor Apache-GICAR-Shibboleth** que permet fer de forma senzilla aquesta integració. El desenvolupador per a poder utilitzar aquesta integració només ha d'indicar quina és la URL que se securitzarà amb aquesta modalitat d'integració, i a partir d'aquí es proporcionarà al desenvolupador tota la informació per a poder aixecar fàcilment el contenidor. Veure el següent [enllaç](https://canigo.ctti.gencat.cat/cloud/cataleg/) on es pot obtenir informació sobre com obtenir aquesta plantilla de contenidor.\r\n\r\nPer a poder arrencar aquesta imatge de contenidor cal tenir present la següent informació:\r\n\r\n- Existeixen dues carpetes amb fitxers de configuració dins d'aquesta imatge docker:\r\n\t- La carpeta \"sp_gicar_default\" conté els fitxers de configuració i binaris que no s'han de modificar per a arrencar l'aplicació.\r\n\t- La carpeta \"sp_gicar_conf_aplicacio\" conté l'aplicació particular per a l'aplicació que es vol arrencar amb aquest contenidor. Per defecte conté una configuració per arrencar el contenidor en mode proves contra l'entorn de PRE de GICAR, i conté un fitxer \"cgi\" per a poder veure les capçaleres generades per GICAR. Dins d'aquesta carpeta caldrà doncs posar els següents fitxers de cara a que el contenidor pugui arrencar correctament:\r\n\r\n\t\t- certificats (fitxers .key i .crt) els quals serveixen per a establir el canal d'encriptació entre el proveïdor d'identitats GICAR i l'apache.\r\n\t\t- El fitxer \"idp-metadata.xml\" el qual defineix les propietats del proveïdor d'identitats GICAR. Aquest fitxer és diferent entre PRE i PRO.\r\n\t\t- El fitxer \"shib.conf\" el qual defineix que es protegirà amb aquesta modalitat de protecció.\r\n\r\n\r\n- Un cop incorporats aquests fitxers per a construïr la imatge (build) cal fer el següent:\r\n\r\n \t\tdocker build -t gencatcloud/gicar-shibboleth:1.0.3 .\r\n\r\n- Un cop fet el build per a aixecar una instància de la imatge cal fer el següent:\r\n\r\n\t\tdocker run -ti --rm  --name gicar-shibboleth -p 80:80 -p 443:443 -e \"url_entityid_gicar=[nom entityID aplicacio]\" -e \"url_idp_gicar=[nom entityID IDP]\"  -e \"certificate_name=[nom fitxer certificat sense .cer o .key]\" -e \"server_name=[schema i host de l'aplicació]\" gencatcloud/gicar-shibboleth:1.0.3\r\n\r\nCal tenir en compte que l'ordre d'arrencada del contenidor conté els següents paràmetres els quals seran proporcionats per l'OTGICAR/Suport Cloud/Integració de Solucions en el moment d'abordar el projecte:\r\n\r\n\t- url_entityid_gicar -> application id in gicar\r\n\r\n\t- url_idp_gicar -> gicar URL enpoint\r\n\r\n\t- certificate_name -> certificate file name\r\n\r\n\t- server_name -> public application serverName (with http schema) \r\n\r\n\r\n\r\nPer exemple:\r\n\r\n\tdocker run -ti --rm  --name gicar-shibboleth -p 80:80 -p 443:443 -e \"url_entityid_gicar=https://preproduccio.dockersaml.gencat.cat\" -e \"url_idp_gicar=https://preproduccio.idp1-gicar.gencat.cat/idp/shibboleth\" -e \"certificate_name=AplicacioProva\" -e \"server_name=https://preproduccio.dockersaml.gencat.cat\" gencatcloud/gicar-shibboleth:1.0.3\r\n\r\n\r\nPer a provar la solució amb la configuració de proves que ve per defecte, cal fer el següent:\r\n\r\n- Afegir el domini preproduccio.dockersaml.gencat.cat associat a la teva IP al teu fitxer hosts de la teva màquina.\r\n- En un navegador accedir a https://preproduccio.dockersaml.gencat.cat/cgi-bin/headers.cgi.\r\n- Després de l'autenticació es redireccionarà al CGI on es podran veure les headers generades.\r\n\r\nNOTES A TENIR EN COMPTE:\r\n\r\n- **NOM DE LA HEADER A CAPTURAR**. Aquest contenidor està basat en una imatge d'Apache 2.4. En apaches 2.4 per temes de seguretat s'impedeix crear requestHeaders que continguin \"underscores\" (_). Això impacta directament a aplicacions que busquin la capçalera \"GICAR_ID\" per autenticar, donat que fent servir aquesta modalitat d'autenticació no la trobaran. **En aquest cas caldrà que les aplicacions busquin la capçalera \"GICAR-ID\" enlloc de la capçalera \"GICAR_ID\".** La header GICAR se seguirà dient de la mateixa manera al no contenir underscores.\r\n\r\n- **URL's de LOGOFF**. Les url's de logoff d'aquesta modalitat d'integració varien envers les URL's de logoff que es fan servir si es fa integració directa amb SiteMinder. En aquest cas, caldrà que les aplicacions cridin la següent URL de logoff per a destruir les sessions generades:\r\n\r\n\t\tA PREPRODUCCIÓ: https://<domini_aplicació>/Shibboleth.sso/Logout?return=https://preproduccio.idp1-gicar.gencat.cat/siteminderagent/forms/logoff.fcc\r\n\r\n\t\tA PRODUCCIÓ: https://<domini_aplicació>/Shibboleth.sso/Logout?return=https://idp1-gicar.gencat.cat/siteminderagent/forms/logoff.fcc\r\n\r\n\r\n## Sobre plataformes On Premise:\r\n\r\nAquest muntatge també és possible dur-lo a terme en entorns on premise. Per a dur-lo a terme es pot seguir el següent tutorial (basat en entorn RedHat7 amb un OHS instal·lat):\r\n\r\n### Instal·lar l'agent de Shibboleth sobre l'apache:\r\n\r\n**Instal·lant via \"Yum\":**\r\n\r\nCreem el fitxer següent amb permissos 644(root)\r\n\r\n\t/etc/yum.repos.d/sib.repo\r\n\r\namb el següent contingut:\r\n\r\n\t[security_shibboleth]\r\n\tname=Shibboleth (CentOS_CentOS-6)\r\n\ttype=rpm-md\r\n\tbaseurl=http://download.opensuse.org/repositories/security:/shibboleth/CentOS_CentOS-6/\r\n\tgpgcheck=1\r\n\tgpgkey=http://download.opensuse.org/repositories/security:/shibboleth/CentOS_CentOS-6/repodata/repomd.xml.key\r\n\tenabled=1\r\n\r\nUn cop definit el repositori ja podem executar el yum d'instal·lació\r\n\r\n\t$sudo yum install shibboleth.x86_64\r\n\r\n\r\n**Després de la instal·lació:**\r\n\r\nUn cop feta la instal·lació el Shibboleth restarà com a servei de sistema i podrem trobar els fitxers necessaris als següents paths:\r\n\r\n•\tConfiguració: /etc/shibboleth/shibboleth2.xml\r\n•\tshibd: /usr/bin\r\n•\tmod_shib: els moduls estan disponibles a /usr/lib/shibboleth/\r\n•\tEls fitxers de logs estan a /var/log/shibboleth I a /var/log/shibboleth-www/native.log\r\n\r\n**Configuració de l'apache:**\r\n\r\nCal afegir els següents paràmetres a la configuració de la instància de l'OHS, en el nostre cas el trobem al fitxer \r\n\r\n/home/oracle/Oracle/Middleware/Oracle_Home/user_projects/domains/base_domain/config/fmwconfig/components/OHS/instances/gicar/httpd.conf\r\n\r\n\tLoadModule mod_shib \"/usr/lib64/shibboleth/mod_shib_22.so\"\r\n\r\n\t#\r\n\t# Ensures handler will be accessible.\r\n\t#\r\n\r\n\t<Location /Shibboleth.sso>\r\n\t  AuthType None\r\n\t  Require all granted\r\n\t</Location>\r\n\t \r\n\t#\r\n\t# Used for example style sheet in error templates.\r\n\t#\r\n\t<IfModule mod_alias.c>\r\n\t  <Location /shibboleth-sp>\r\n\t    AuthType None\r\n\t    Require all granted\r\n\t  </Location>\r\n\t  Alias /shibboleth-sp/main.css /usr/share/shibboleth/main.css\r\n\t</IfModule>\r\n\r\n\t#\r\n\t# Configure the module for content.\r\n\t#\r\n\t# You MUST enable AuthType shibboleth for the module to process\r\n\t# any requests, and there MUST be a require command as well. To\r\n\t# enable Shibboleth but not specify any session/access requirements\r\n\t# use \"require shibboleth\".\r\n\t#\r\n\t<Location /secure>\r\n\t  AuthType shibboleth\r\n\t  ShibRequestSetting requireSession 1\r\n\t  require shib-session\r\n\t  ShibUseHeaders On\r\n\t</Location>\r\n\r\nA través de les directives \"Location\" es com es securitzen els directoris securitzats amb aquest mecanisme. \r\n\r\n\r\n### Reinici del servei de shibboleth SP\r\n\r\nShibboleth s'instala com a servei I el gestionarem com a tal\r\n\r\n•\tInici:\r\n\r\n\t$sudo service shibd start\r\n\r\n•\tAturada\r\n\r\n\t$sudo service shibd stop\r\n\r\n•\tReinici\r\n\r\n\t$sudo service shibd restart\r\n\r\n•\tEstat\r\n\r\n\t$sudo service shibd status\r\n\r\nTambé podem executar directament el fitxer binari \r\n\r\n\r\n### Definició de variables d'entorn\r\n\r\nEl propi RHEL6 proporciona unes llibreries libcurl basades en Netscape Security Services stack (NSS) en comptes de openSSL per tal de fer la negociació de SSL per a escenaris que incloguin IDPs SAML 1.1 y consulta d'atributs mitjançant intercanvis SOAP.\r\n\r\nPer evitar això, hem d'indicar que agafin la variable d'entorn LD_LIBRARY_PATH amb la llibreria que ens interesi.\r\n\r\nEns haurem d'assegurar que el fitxer /etc/sysconfig/shibd conté la següent informació:\r\n\r\n\r\n\t# User account for shibd\r\n\tSHIBD_USER=shibd\r\n\r\n\t# Umask for shibd\r\n\t# SHIBD_UMASK=022\r\n\r\n\t# Wait period (secs) for configuration (and metadata) to load\r\n\tSHIBD_WAIT=30\r\n\r\n\t# Override OS-supplied libcurl\r\n\texport LD_LIBRARY_PATH=/opt/shibboleth/lib64\r\n\r\n\r\n### Configuració del shibboleth SP\r\n\r\nEn aquest punt, demanar suport a la OTGICAR donat que es facilitarà tota la informació necessària per a poder configurar el mòdul de Shibboleth d'acord al tipus d'instal·lació que s'està duent a terme.\r\n","objectID":"L2dpY2FyLXNhbWwyL2F1dGgtc2FtbDItc2hpYmJvbGV0aA=="},"L2hvd3Rvcy8yMDE2LTEwLUhvd3RvLUNhbmlnby1HZXN0aW8tRXJyb3JzLUdsb2JhbHM=":{"date":1477785600000,"title":"Gestió global d'errors a una aplicació Canigó","description":"How To de com gestionar els errors de forma global a una aplicació Canigó Rest.","sections":["Canigo","howtos"],"categories":["canigo"],"key":"NOVEMBRE2016","path":"/howtos/2016-10-Howto-Canigo-Gestio-Errors-Globals","content":"### A qui va dirigit\r\n\r\nAquest how-to va dirigit a tots aquells desenvolupadors/arquitectes que desenvolupin una aplicació REST amb Canigó 3.1 i vulguin gestionar els errors de forma global.\r\n\r\n### Versió de Canigó\r\n\r\nEls passos descrits en aquest document apliquen a la versió 3.1.x del Framework Canigó.\r\n\r\n### Introducció\r\n\r\nEn aquest HowTo s’explica com gestionar els errors utilitzant @ControllerAdvice a una aplicació Canigó Canigó 3.1 REST. Per a fer-ho desplegarem l’aplicació demo que genera el plugin de Canigó i i afegirem la gestió d'errors.\r\n\r\nPer a mostrar el funcionament de @ControllerAdvice crearem un MockController que llençi els errors, que seran capturats pel nostre ControllerAdvice i aquest retornarà un ResponseError amb el codi i missatge de l'error en qüestió. \r\n\r\n### Afegir Llibreries\r\n\r\nEn aquest how to es genera un handler per a excepcions del tipus AuthenticationException i AccessDeniedException del mòdul de seguretat de Spring, així que l'afegim al pom.xml de l'aplicació. \r\n\r\nSi la vostra aplicació ja utilitza el mòdul de seguretat de Canigó, aquesta dependència ja es trobarà a la vostra aplicació.\r\n\r\n    <!-- SPRING SECURITY -->\r\n\t<dependency>\r\n\t\t<groupId>org.springframework.security</groupId>\r\n\t\t<artifactId>spring-security-core</artifactId>\r\n\t\t<version>${spring.security.version}</version>\r\n\t</dependency>\r\n\t\r\n### Response Error\r\n\r\nPrimer de tot es crea l'objecte ResponseError, per a utilitzar-lo com a resposta d'error genèrica\r\n\r\nEn aquest howto s'ha creat al path cat.gencat.canigorest311.model.response:\r\n\r\n\tpackage cat.gencat.canigorest311.model.response;\r\n\r\n\timport java.io.Serializable;\r\n\r\n\tpublic class ResponseError implements Serializable {\r\n\r\n\t\tprivate static final long serialVersionUID = 3626211819197624092L;\r\n\t\tprivate int code;\r\n\t\tprivate String message;\r\n\r\n\t\tpublic ResponseError() {\r\n\t\t\tsuper();\r\n\t\t}\r\n\r\n\t\tpublic ResponseError(final int code, final String message) {\r\n\t\t\tsuper();\r\n\t\t\tthis.code = code;\r\n\t\t\tthis.message = message;\r\n\t\t}\r\n\r\n\t\tpublic int getCode() {\r\n\t\t\treturn code;\r\n\t\t}\r\n\r\n\t\tpublic void setCode(int code) {\r\n\t\t\tthis.code = code;\r\n\t\t}\r\n\r\n\t\tpublic String getMessage() {\r\n\t\t\treturn message;\r\n\t\t}\r\n\r\n\t\tpublic void setMessage(String message) {\r\n\t\t\tthis.message = message;\r\n\t\t}\r\n\r\n\t}\r\n\r\n### Excepcions específiques\r\n\r\nCada aplicació pot tenir les seves exceptions específiques per tractar errors controlats a la seva lògica. Com a exemple en aquest howto es crea l'objecte ResourceNotFoundException, que s'utilitzaria en cas d'intentar accedir a un Resource de l'aplicació i no trobar-lo.\r\n\r\nEn aquest howto s'ha creat al path cat.gencat.canigorest311.model.exception:\r\n\r\n\tpackage cat.gencat.canigorest311.model.exception;\r\n\r\n\tpublic class ResourceNotFoundException extends RuntimeException {\r\n\r\n\t\tprivate static final long serialVersionUID = 354698655002619627L;\r\n\r\n\t\tprivate long resourceId;\r\n\r\n\t\tpublic ResourceNotFoundException(long resourceId) {\r\n\t\t\tthis.setResourceId(resourceId);\r\n\t\t}\r\n\r\n\t\tpublic long getResourceId() {\r\n\t\t\treturn resourceId;\r\n\t\t}\r\n\r\n\t\tpublic void setResourceId(long resourceId) {\r\n\t\t\tthis.resourceId = resourceId;\r\n\t\t}\r\n\t}\r\n\r\n### Handler per a les excepcions\r\n\r\nEs crea l'objecte GlobalDefaultExceptionHandler per a gestionar totes les excepcions.\r\n\r\nEn aquest objecte es pot crear un Handler per a totes les excepcions que es dessitgin controlar, en aques howto es controlen les següents:\r\n\t- MultipartException\r\n\t- AuthenticationException\r\n\t- AccesDeniedException\r\n\t- ResourceNotFoundException (Aquesta és la que s'ha creat al punt anterior)\r\n\t- Exception (Per a controlar tots els errors no controlats)\r\n\t\r\nAquest objecte ha de tenir l'annotació @ControllerAdvice a nivell de classe.\r\n\r\n\t@ControllerAdvice\r\n\tpublic class GlobalDefaultExceptionHandler\r\n\r\nEls mètodes que actuen com Handlers de les exceptions han de tenir el tag @ExceptionHandler amb la classe d'excepció que controlen.\r\n\r\n\t@ExceptionHandler(MultipartException.class)\r\n\t@ResponseStatus(value = HttpStatus.BAD_REQUEST)\r\n\t@ResponseBody\r\n\tpublic ResponseError defaultErrorHandlerMultipartException(final HttpServletRequest request, final HttpServletResponse response, final MultipartException e)\r\n\t\r\nEl fitxer resultant s'ha creat al path cat.gencat.canigorest311.service.exception.handler:\r\n\r\n\tpackage cat.gencat.canigorest311.service.exception.handler;\r\n\r\n\timport javax.servlet.http.HttpServletRequest;\r\n\timport javax.servlet.http.HttpServletResponse;\r\n\r\n\timport org.apache.commons.logging.Log;\r\n\timport org.apache.commons.logging.LogFactory;\r\n\timport org.springframework.http.HttpStatus;\r\n\timport org.springframework.security.access.AccessDeniedException;\r\n\timport org.springframework.security.core.AuthenticationException;\r\n\timport org.springframework.web.bind.annotation.ControllerAdvice;\r\n\timport org.springframework.web.bind.annotation.ExceptionHandler;\r\n\timport org.springframework.web.bind.annotation.ResponseBody;\r\n\timport org.springframework.web.bind.annotation.ResponseStatus;\r\n\timport org.springframework.web.multipart.MultipartException;\r\n\r\n\timport cat.gencat.canigorest311.model.exception.ResourceNotFoundException;\r\n\timport cat.gencat.canigorest311.model.response.ResponseError;\r\n\r\n\t@ControllerAdvice\r\n\tpublic class GlobalDefaultExceptionHandler {\r\n\r\n\t\tprivate static final Log LOGGER = LogFactory.getLog(GlobalDefaultExceptionHandler.class);\r\n\r\n\t\tprivate static final String RESOURCE_NOT_FOUND_MSG = \"Resource no trobat\";\r\n\r\n\t\tprivate static final String UNAUTHORIZED_MSG = \"No es troba autoritzat per accedir a aquest recurs\";\r\n\r\n\t\tprivate static final String MULTIPART_BAD_REQUEST_MSG = \"Petició incorrecta\";\r\n\r\n\t\t@ExceptionHandler(MultipartException.class)\r\n\t\t@ResponseStatus(value = HttpStatus.BAD_REQUEST)\r\n\t\t@ResponseBody\r\n\t\tpublic ResponseError defaultErrorHandlerMultipartException(final HttpServletRequest request, final HttpServletResponse response,\r\n\t\t\t\tfinal MultipartException e) {\r\n\t\t\tLOGGER.error(e.getMessage(), e);\r\n\t\t\treturn new ResponseError(HttpStatus.BAD_REQUEST.value(), MULTIPART_BAD_REQUEST_MSG);\r\n\t\t}\r\n\r\n\t\t@ExceptionHandler(Exception.class)\r\n\t\t@ResponseStatus(value = HttpStatus.INTERNAL_SERVER_ERROR)\r\n\t\t@ResponseBody\r\n\t\tpublic ResponseError defaultErrorHandlerException(final HttpServletRequest request, final HttpServletResponse response, final Exception e) {\r\n\t\t\tLOGGER.error(e.getMessage(), e);\r\n\t\t\treturn new ResponseError(HttpStatus.INTERNAL_SERVER_ERROR.value(), e.getLocalizedMessage());\r\n\r\n\t\t}\r\n\r\n\t\t@ExceptionHandler(value = { AuthenticationException.class, AccessDeniedException.class })\r\n\t\t@ResponseStatus(value = HttpStatus.UNAUTHORIZED)\r\n\t\t@ResponseBody\r\n\t\tpublic ResponseError defaultErrorHandlerAuthenticationException(final Exception e) {\r\n\t\t\tLOGGER.error(e.getMessage(), e);\r\n\t\t\treturn new ResponseError(HttpStatus.UNAUTHORIZED.value(), UNAUTHORIZED_MSG);\r\n\r\n\t\t}\r\n\r\n\t\t@ExceptionHandler(ResourceNotFoundException.class)\r\n\t\t@ResponseStatus(HttpStatus.NOT_FOUND)\r\n\t\t@ResponseBody\r\n\t\tpublic ResponseError resourceNotFound(final ResourceNotFoundException e) {\r\n\t\t\tfinal long resourceId = e.getResourceId();\r\n\t\t\tLOGGER.info(\"Resource Not Found idResource: \" + resourceId);\r\n\r\n\t\t\treturn new ResponseError(HttpStatus.NOT_FOUND.value(), RESOURCE_NOT_FOUND_MSG);\r\n\t\t}\r\n\t}\r\n\r\n\r\n### Proves\r\n\r\nPer a comprovar el funcionament es crea un MockController, el qual cridarem des de el navegador i llençarà una excepció que serà capturada pel nostre handler, GlobalDefaultExceptionHandler.\r\n\r\nEa crea al path cat.gencat.canigorest311.endpoints:\r\n\r\n\tpackage cat.gencat.canigorest311.endpoints;\r\n\r\n\timport org.springframework.http.MediaType;\r\n\timport org.springframework.web.bind.annotation.PathVariable;\r\n\timport org.springframework.web.bind.annotation.RequestMapping;\r\n\timport org.springframework.web.bind.annotation.RequestMethod;\r\n\timport org.springframework.web.bind.annotation.RestController;\r\n\timport cat.gencat.canigorest311.model.exception.ResourceNotFoundException;\r\n\r\n\t@RestController\r\n\tpublic class MockController {\r\n\r\n\t\t@RequestMapping(method = RequestMethod.GET, value = \"/resource/{id}\", produces = MediaType.APPLICATION_JSON_VALUE)\r\n\t\tpublic void mockResourceNotFoundException(@PathVariable final long id) {\r\n\t\t\tthrow new ResourceNotFoundException(id);\r\n\t\t}\r\n\t}\r\n\r\n### Resultat\r\n\r\nUna vegada desplegada l'aplicació, si fem la crida a \"localhost:8081/CanigoRest311/api/resource/2\" per pantalla es mostra l'objecte ResponseError:\r\n\r\n{\r\ncode: 404,\r\nmessage: \"Resource no trobat\"\r\n} \r\n\t","objectID":"L2hvd3Rvcy8yMDE2LTEwLUhvd3RvLUNhbmlnby1HZXN0aW8tRXJyb3JzLUdsb2JhbHM="},"L2hvd3Rvcy8yMDE3LTAzLVNlY3VyaXR6YXJfRWxhc3RpY1NlYXJjaF9BcGFjaGU=":{"date":1488326400000,"title":"Securitzar accés a Elasticsearch des d'una pàgina web","description":"Securitzar accés a Elasticsearch des d'una pàgina web","section":"howtos","categories":["cloud"],"key":"MARÇ2017","path":"/howtos/2017-03-Securitzar_ElasticSearch_Apache","content":"### A qui va dirigit\r\n\r\nAquest how-to va dirigit a tots aquells proveïdors d'aplicacions que utilitzin Elasticsearch (ES) i vulguin securitzar la connexió amb l'ES des de navegadors web.\r\n\r\n### Introducció\r\n\r\nEn cas que l'accés a un ES es realitzi directament des del navegador de l'usuari, cal que el client disposi de les credencials d'accés a aquest ES, amb les vulnerabilitats de seguretat que això pot implicar.\r\n\r\nPer evitar-ho es proposa aprovisionar un proxy intermig que sigui qui disposi d'aquestes credencials i així evitar-ne la potencial sostracció.\r\n\r\nEn aquest HowTo expliquem com configurar un Apache 2.2 / 2.4 per a que faci aquesta funció de proxy cap a l'ES.\r\n\r\n### Elasticsearch\r\n\r\nPer aquest howto hem instal·lat mitjançant Docker un [ES] (https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html)\r\n\r\nHem modificat el fitxer \"elasticsearch.yml\" per a configurar el CORS:\r\n\r\n\thttp.host: 0.0.0.0\r\n\r\n\thttp.cors.enabled : true\r\n\t \r\n\thttp.cors.allow-origin : \"*\"\r\n\thttp.cors.allow-methods : OPTIONS, HEAD, GET, POST, PUT, DELETE\r\n\thttp.cors.allow-headers : X-Requested-With,X-Auth-Token,Content-Type, Content-Length\r\n\r\nUna vegada desplegat al accedir a http://localhost:9200 el navegador ens ha de mostrar:\r\n\r\n\t{\r\n\t\tname: \"OOHe2gg\",\r\n\t\tcluster_name: \"docker-cluster\",\r\n\t\tcluster_uuid: \"pzOqu-XkRvGMKM08gcCUVw\",\r\n\t\tversion: {\r\n\t\tnumber: \"5.2.2\",\r\n\t\tbuild_hash: \"f9d9b74\",\r\n\t\tbuild_date: \"2017-02-24T17:26:45.835Z\",\r\n\t\tbuild_snapshot: false,\r\n\t\tlucene_version: \"6.4.1\"\r\n\t},\r\n\t\ttagline: \"You Know, for Search\"\r\n\t}\r\n\t\r\n### Exemple aplicació Angular\r\n\r\nHem utilitzat la [següent aplicació AngularJS] (https://github.com/spalger/elasticsearch-angular-example) per l'accés a l'ES.\r\n\r\nUna vegada seguits els passos pel seu desplegament, accedim amb el navegador al fitxer index.html i ens trobem amb el següent error:\r\n\r\n![](/related/canigo/howto/imatges/20170301.JPG)\r\n\r\nAquest error és degut al fet que tenim l'ES securitzat i no hem especificat les credencials al index.html. Com que precisament és això el que volem evitar, aprovisionem un Apache amb les credencials d'accés a l'ES.\r\n\r\n### Configuració Apache\r\n\r\nPer aquest Howto hem desplegat un Apache amb [Docker] (https://hub.docker.com/r/gencatcloud/httpd/) amb els següents canvis al fitxer httpd.conf:\r\n\r\nHem afegit els següents mòduls:\r\n\t\r\n\tLoadModule headers_module modules/mod_headers.so\r\n\tLoadModule proxy_http_module modules/mod_proxy_http.so\r\n\t\r\nI realitzat la següent configuració per la funcionalitat de proxy cap a l'ES:\r\n\r\n**Apache 2.4**\r\n\r\n\t<Location \"/\">\r\n\t\tRequestHeader set Authorization \"Basic ZWxhc3RpYzpjaGFuZ2VtZQ==\"\r\n\t\tRequire ip 192.168.99.1\r\n\t\tProxyPass        \"http://127.0.0.1:9200/\"\r\n\t\tProxyPassReverse \"http://127.0.0.1:9200/\"\r\n\t</Location>\r\n\t\r\non\r\n* http://127.0.0.1:9200/ és la URL d'accés a l'ES\r\n* 192.168.99.1 és la IP/Host de l'aplicació. En cas d'especificar un domini enlloc d'una IP s'haurà de fer de la següent manera \"Require host <domini>\"\r\n\r\n**Apache 2.2**\r\n\t\r\n\t<Location \"/\">\r\n\t\tRequestHeader set Authorization \"Basic ZWxhc3RpYzpjaGFuZ2VtZQ==\"\r\n\t\t\r\n\t\tOrder deny,allow\r\n\t\tDeny from all\r\n\t\tAllow from 192.168.99.1\r\n\t\t\r\n\t\tProxyPass        \"http://127.0.0.1:9200/\"\r\n\t\tProxyPassReverse \"http://127.0.0.1:9200/\"\r\n\t</Location>\r\n\t\r\n\r\nLes credencials d'accés del nostre ES són (usuari=elastic, password=changeme).\r\n\r\nAquestes credencials s'han d'especificar codificades en BASE64 en la sentència RequestHeader en format \"user:password\":\r\n\r\n\telastic:changeme ---> ZWxhc3RpYzpjaGFuZ2VtZQ==\r\n\t\r\nEn aquest exemple hem afegit per seguretat (whitelist) la sentència **Require ip**. Aquesta sentència permet indicar les IPs per les que el proxy accepta sol·licituds.\r\n\t\r\nModifiquem el index.html per a canviar la url d'accés per a que apunti al proxy:\r\n\r\n\t host: 'http://192.168.99.100:9200' (ES) -->  host: 'http://192.168.99.100' (proxy),\r\n\t \r\nAra al accedir a l'index.html el navegador ens mostrarà correctament l'estat de l'ES:\r\n\r\n![](/related/canigo/howto/imatges/20170302.JPG)\r\n\r\n### Elasticsearch per HTTPS i balancejat\r\n\r\nEn cas que el nostre Elasticsearch només es pugui accedir per HTTPS (Per exemple un Elasticsearch desplegat a Compose) i tingui més d'un node s'ha de modificar la configuració al Apache de la següent manera:\r\n\r\nPrimer de tot afegir el mòdul ssl:\r\n\r\n\tLoadModule ssl_module modules/mod_ssl.so\r\n\tLoadModule proxy_balancer_module modules/mod_proxy_balancer.so\r\n\t\r\n**Apache 2.2**\r\n\r\n\t<VirtualHost *:80>\r\n\r\n\t\tSSLProxyEngine On\r\n\t\t\r\n\t\t<Proxy balancer://mycluster>\r\n\t\t\tBalancerMember https://${ELASTIC_HOSTNAME1}:${ELASTIC_PORT1}/\r\n\t\t\tBalancerMember https://${ELASTIC_HOSTNAME2}:${ELASTIC_PORT2}/\r\n\t\t\t# Set counting algorithm to more evenly distribute work: \r\n\t\t\tProxySet lbmethod=byrequests\r\n\t\t</Proxy>\r\n\t\t\r\n\t\t<Location \"/\">\r\n\t\t\tRequestHeader set Authorization \"Basic ${ELASTIC_CREDENTIALS}\"\r\n\t\t\t\r\n\t\t\tOrder deny,allow\r\n\t\t\tDeny from all\r\n\t\t\tAllow from 192.168.99.1\r\n\t\t\t\r\n\t\t\tProxyPass balancer://mycluster/\r\n\t\t\tProxyPassReverse balancer://mycluster/\r\n\t\t</Location>\r\n\t</VirtualHost>\r\n\t\r\n**Apache 2.4**\r\n\r\n\t<VirtualHost *:80>\r\n\r\n\t\tSSLProxyEngine On\r\n\t\t\r\n\t\t<Proxy balancer://mycluster>\r\n\t\t\tBalancerMember https://${ELASTIC_HOSTNAME1}:${ELASTIC_PORT1}/\r\n\t\t\tBalancerMember https://${ELASTIC_HOSTNAME2}:${ELASTIC_PORT2}/\r\n\t\t\t# Set counting algorithm to more evenly distribute work: \r\n\t\t\tProxySet lbmethod=byrequests\r\n\t\t</Proxy>\r\n\t\t\r\n\t\t<Location \"/\">\r\n\t\t\tRequestHeader set Authorization \"Basic ${ELASTIC_CREDENTIALS}\"\r\n\t\t\t\r\n\t\t\tRequire ip 192.168.99.1\r\n\t\t\t\r\n\t\t\tProxyPass balancer://mycluster/\r\n\t\t\tProxyPassReverse balancer://mycluster/\r\n\t\t</Location>\r\n\t</VirtualHost>\r\n\t\r\nOn $ELASTIC_CREDENTIALS són les credentials en Base64 (De la mateixa manera que a l'exemple HTTP), i $ELASTIC_HOSTNAME1:${ELASTIC_PORT1} , $ELASTIC_HOSTNAME2:${ELASTIC_PORT2} són les dos url de connexió amb Elasticsearch.\r\n","objectID":"L2hvd3Rvcy8yMDE3LTAzLVNlY3VyaXR6YXJfRWxhc3RpY1NlYXJjaF9BcGFjaGU="},"L2hvd3Rvcy8yMDE3LTA0LUJhdGNoLWluc2VydHMtdXBkYXRlcy1jYW5pZ28zMg==":{"date":1491350400000,"title":"Batch inserts/updates a una aplicació Canigó 3.2","description":"Batch inserts/updates a una aplicació Canigó 3.2","section":"howtos","categories":["canigo"],"key":"ABRIL2017","path":"/howtos/2017-04-Batch-inserts-updates-canigo32","content":"### A qui va dirigit\n\nAquest how-to va dirigit a tots aquells desenvolupadors/arquitectes que vulguin realitzar un gran volum d'inserts/updates a una aplicació Canigó 3.2.\n\n### Versió de Canigó\n\nEls pasos descrits en aquest document apliquen a la versió 3.2.x del Framework Canigó.\n\n### Introducció\n\nEn aquest HowTo s'explica com realitzar Batch Inserts amb una aplicació Canigó 3.2. \n\nCanigó 3.2 utilitza el framework Spring Data que proporciona un mètode *save(Iterable entities)* que es pot realitzar per a fer inserts/updates massius, però aquest mètode internament simplement crida al mètode simple *save(S entity)* amb lo qual no hi ha cap benefici de rendiment entre utilitzar aquest mètode o fer diverses crides al mètode *save(S entity)*\n\nPer aquesta raó el mòdul de persistència de Canigó 3.2 proporciona el mètode *bulkSave(Iterable entities)* que optimitza el rendiment quan es realitza un gran volum d'inserts/updates.\n\nAquest Howto es basa en l'aplicació que genera el [plugin de Canigó](/canigo-download-related/plugin-canigo)\n\n### EquipamentService\n\nA la classe EquipamentService creem dos mètodes, SaveIterable amb el qual realitzarem una inserció massiva utilitzant el mètode proporcionat per Spring Data, i un altre mètode saveBatch utilitzant el mètode proporcionat pel mòdul de persitència de Canigó 3.2\n\n**saveIterable**\n\n\tpublic void saveIterable (){\n\t\t\n\t\tList<Equipament> equipaments = new ArrayList<Equipament>();\n\t\t\n\t\tfor (int i = 0; i < 250000; i++){\n\n\t\t\tEquipament e = new Equipament();\n\t\t\te.setMunicipi(\"Municipi\" + System.currentTimeMillis());\n\t\t\te.setNom(\"Nom\" + System.currentTimeMillis());\n\t\t\t\n\t\t\tequipaments.add(e);\n\t\t\t\n\t\t\tif (i % BATCH_SIZE == 0) {\n\t\t\t\trepository.save(equipaments);\n\t\t\t\tequipaments.clear();\n\t\t\t}\n\t\t}\n\t\t\n\t\trepository.save(equipaments);\n\t}\n\t\n**saveBatch**\n\n\tpublic void saveBatch (){\n\t\t\n\t\tList<Equipament> equipaments = new ArrayList<Equipament>();\n\t\t\n\t\tfor (int i = 0; i < 250000; i++){\n\n\t\t\tEquipament e = new Equipament();\n\t\t\te.setMunicipi(\"Municipi\" + System.currentTimeMillis());\n\t\t\te.setNom(\"Nom\" + System.currentTimeMillis());\n\t\t\t\n\t\t\tequipaments.add(e);\n\t\t\t\n\t\t\tif (i % BATCH_SIZE == 0) {\n\t\t\t\trepository.bulkSave(equipaments);\n\t\t\t\tequipaments.clear();\n\t\t\t}\n\t\t}\n\t\t\n\t\trepository.save(equipaments);\n\t}\n\t\nTots dos mètodes el que fan és inserir a BBDD 250.000 registres en blocs de 50.\n\n\tprivate static final int BATCH_SIZE = 50;\n\n### ResultBatchDTO\n\nCreem un DTO per a mostrar el resultat de tots dos mètodes:\n\n\tpackage cat.gencat.plantillarest.model.dto;\n\n\timport java.io.Serializable;\n\n\tpublic class ResultBatchDTO implements Serializable{\n\n\t\tprivate static final long serialVersionUID = 1L;\n\n\t\tprivate Long tempsSaveIterable;\n\t\t\n\t\tprivate Long tempsBulkSave;\n\t\t\n\t\tpublic ResultBatchDTO() {\n\t\t\t\n\t\t}\n\n\t\tpublic Long getTempsSaveIterable() {\n\t\t\treturn tempsSaveIterable;\n\t\t}\n\n\t\tpublic void setTempsSaveIterable(Long tempsSaveIterable) {\n\t\t\tthis.tempsSaveIterable = tempsSaveIterable;\n\t\t}\n\n\t\tpublic Long getTempsBulkSave() {\n\t\t\treturn tempsBulkSave;\n\t\t}\n\n\t\tpublic void setTempsBulkSave(Long tempsBulkSave) {\n\t\t\tthis.tempsBulkSave = tempsBulkSave;\n\t\t}\n\t\t\n\t}\n\n### EquipamentServiceController\n\nAl nostre endpoint creem un mètode que fa la crida als mètodes que hem creat a la classe EquipamentService:\n\n\t @RequestMapping(value = \"/bulk\", method = RequestMethod.POST)\n\t public ResponseEntity<ResultBatchDTO> bulk()  {\n\t\t \n\t\t ResultBatchDTO result = new ResultBatchDTO();\n\t\t \n\t\t long inici = System.currentTimeMillis();\n\t\t equipamentService.saveIterable();\n\t\t long fi = System.currentTimeMillis();\n\t\t \n\t\t long temps = (fi-inici) / 1000;\n    \t\n\t\t result.setTempsSaveIterable(temps);\n\t\t \n\t\t inici = System.currentTimeMillis();\n\t\t equipamentService.saveBatch();\n\t\t fi = System.currentTimeMillis();\n\t\t \n\t\t temps = (fi-inici) / 1000;\n\t\t \n\t\t result.setTempsBulkSave(temps);\n\t\t \n\t\t return new ResponseEntity<ResultBatchDTO>(result, HttpStatus.OK);\n    }\n\t\nAquest mètode el que fa es fer la crida als dos mètodes i ens retorna el temps que ha trigat cada mètode en fer els 250.000 inserts.\n\n### Resultat\n\nDespleguem l'aplicació i utilitzant Swagger executem el mètode bulk amb el següent resultat\n\n![](/related/canigo/howto/imatges/20170401.jpg)\n\nCom es pot veure el temps amb el mètode de Spring Data és de 427 segons, mentres que el mètode optimitzat proporcionat per Canigó 3.2 ha trigat 19 segons","objectID":"L2hvd3Rvcy8yMDE3LTA0LUJhdGNoLWluc2VydHMtdXBkYXRlcy1jYW5pZ28zMg=="},"L2hvd3Rvcy8yMDE3LTA4LUhvd3RvLUFjdHVhbGl0emFjaW9fQ2FuaWdvM18xX0NhbmlnbzNfMg==":{"date":1501804800000,"title":"Actualització Canigó 3.1 a Canigó 3.2","description":"Com realitzar l'actualització d'una aplicació de Canigó 3.1 a Canigó 3.2","section":"howtos","categories":["canigo"],"key":"JULIOL2017","path":"/howtos/2017-08-Howto-Actualitzacio_Canigo3_1_Canigo3_2","content":"### A qui va dirigit\r\n\r\nAquest how-to va dirigit a tots aquells usuaris que vulguin fer l'actualització a Canigó 3.2 de la seva aplicació Canigó 3.1\r\n\r\n### Versió de Canigó\r\n\r\nEls passos descrits en aquest document apliquen a la versió 3.1 del Framework Canigó\r\n\r\n### Introducció\r\n\r\nEl passat mes de Març s'ha publicat la versió 3.2 del Framework Canigó. Aquesta versió és una [versió LTS](/noticies/2017-07-05-Canigo-LTS/), i es recomana actualitzar les aplicacions Canigó a aquesta versió per tal de tenir un suport continuat així com la màxima estabilitat que proporciona una versió LTS.\r\n\r\nL'objectiu d'aquest Howto és mostrar els procediments necessaris per a realitzar l'actualització d'una aplicació realitzada amb Canigó 3.1. El punt de partida d'aquest Howto és una aplicació creada amb el plugin de Canigó per Eclipse.\r\n\r\n## Aplicació REST\r\n\r\n### Configuració de dependències\r\n\r\nA la [matriu de compatibilitats] (/canigo-download-related/matrius-compatibilitats) es poden veure les versions dels mòduls i components de Canigó de les versions 3.1.x i 3.2.x. S'han d'actualitzar els intervals dels mòduls utilitzats per a migrar a Canigó 3.2.\r\n\r\nEn cas de tenir alguna dependència de Spring al POM de l'aplicació s'ha d'actualitzar a la versió \"4.3.4.RELEASE\"\r\n\r\nEn cas de tenir la llibreria Xerces com a dependència s'ha d'actualitzar a la versió 2.11.0:\r\n\r\n\t\t<dependency>\r\n\t\t    <groupId>xerces</groupId>\r\n\t\t    <artifactId>xercesImpl</artifactId>\r\n\t\t    <version>2.11.0</version>\r\n\t\t</dependency>\r\n\t\t\r\nS'ha d'afegir la dependència al nou mòdul \"canigo.web.rs\":\r\n\t\r\n\t<canigo.web.rs.version>1.0.0</canigo.web.rs.version>\r\n\t...\r\n\t<dependency>\r\n\t\t<groupId>cat.gencat.ctti</groupId>\r\n\t\t<artifactId>canigo.web.rs</artifactId>\r\n\t\t<version>${canigo.web.rs.version}</version>\r\n\t</dependency>\r\n\t\r\nEls filtres *UrlRewriteFilter* i *LocalizationFilter* ja no es troben disponibles al mòdul \"canigo.web.core\". En cas de tenir la necessitat d'utilitzar-los s'ha d'afegir la dependència amb el mòdul \"canigo.web.jsf\":\r\n\r\n\t<dependency>\r\n\t\t<groupId>cat.gencat.ctti</groupId>\r\n\t\t<artifactId>canigo.web.jsf</artifactId>\r\n\t\t<version>${canigo.web.jsf.version}</version>\r\n\t\t<exclusions>\r\n\t\t\t<exclusion>\r\n\t\t\t\t<groupId>com.sun.faces</groupId>\r\n\t\t\t\t<artifactId>jsf-api</artifactId>\r\n\t\t\t</exclusion>\r\n\t\t\t<exclusion>\r\n\t\t\t\t<groupId>com.sun.faces</groupId>\r\n\t\t\t\t<artifactId>jsf-impl</artifactId>\r\n\t\t\t</exclusion>\r\n\t\t\t<exclusion>\r\n\t\t\t\t<groupId>javax.el</groupId>\r\n\t\t\t\t<artifactId>javax.el-api</artifactId>\r\n\t\t\t</exclusion>\r\n\t\t\t<exclusion>\r\n\t\t\t\t<groupId>com.sun.facelets</groupId>\r\n\t\t\t\t<artifactId>jsf-facelets</artifactId>\r\n\t\t\t</exclusion>\r\n\t\t</exclusions>\r\n\t</dependency>\r\n\t\r\nCom que l'aplicació no és JSF, es pot excloure les llibreries JSF del mòdul..\r\n\r\n### Servei de Logs\r\n\r\nEn Canigó 3.2 s'utilitza Log4j2 en comptes de Log4j. [S'han d'eliminar els fitxers log4j.xml de l'aplicació i substituir-los per log4j2.xml](https://logging.apache.org/log4j/2.x/manual/migration.html)\r\n\r\nPer exemple el següent fitxer log4j.xml\r\n\r\n\t<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\r\n\t<!DOCTYPE log4j:configuration PUBLIC \"-//APACHE//DTD LOG4J//EN\" \"http://logging.apache.org/log4j/docs/api/org/apache/log4j/xml/log4j.dtd\">\r\n\r\n\t<log4j:configuration xmlns:log4j='http://jakarta.apache.org/log4j/'\r\n\t\tdebug=\"true\">\r\n\r\n\t\t<!-- Architecture appender -->\r\n\t\t<appender name=\"file\" class=\"org.apache.log4j.DailyRollingFileAppender\">\r\n\t\t\t<param name=\"DatePattern\" value=\"'.'yyyyMMdd\" />\r\n\t\t\t<param name=\"File\" value=\"/tmp/canigo.log\" />\r\n\t\t\t<param name=\"Append\" value=\"true\" />\r\n\t\t\t<layout class=\"org.apache.log4j.PatternLayout\">\r\n\t\t\t\t<param name=\"ConversionPattern\" value=\"canigo Message: %d{dd MMM yyyy HH:mm:ss,SSS} %-5p [%t] %c - %m%n - %X{APPID}\" />\r\n\t\t\t</layout>\r\n\t\t</appender>\r\n\t\t<appender name=\"console\" class=\"org.apache.log4j.ConsoleAppender\">\r\n\t\t\t<layout class=\"org.apache.log4j.PatternLayout\">\r\n\t\t\t\t<param name=\"ConversionPattern\" value=\"canigo Message: %d{dd MMM yyyy HH:mm:ss,SSS} %-5p [%t] %c - %m%n - %X{APPID}\" />\r\n\t\t\t</layout>\r\n\t\t</appender>\r\n\t\t<category name=\"cat.gencat.ctti\">\r\n\t\t\t<appender-ref ref=\"file\" />\r\n\t\t\t<appender-ref ref=\"console\" />\r\n\t\t</category>\r\n\t\t<root>\r\n\t\t\t<level value=\"debug\" />\r\n\t\t</root>\r\n\t</log4j:configuration>\r\n\t\r\nEs convertiria en el següent fitxer log4j2.xml\r\n\r\n\t<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\t<Configuration>\r\n\t\t<Appenders>\r\n\t\t\t<RollingFile name=\"DAILY_LOG\" fileName=\"/tmp/canigo.log\" filePattern=\"tmp/%d{ddMMyyyy}_canigo.log\" append=\"true\">\r\n\t\t\t\t<PatternLayout pattern=\"canigo Message: %d{dd MM yyyy HH:mm:ss,SSS} %-5p [%t] %-5p [%t] %c - %m%n\"/>\r\n\t\t\t\t<Policies>\r\n\t\t\t\t\t<TimeBasedTriggeringPolicy interval=\"1\"/>\r\n\t\t\t\t</Policies>                               \r\n\t\t\t</RollingFile>\r\n\t\t\t<Console name=\"STDOUT\" target=\"SYSTEM_OUT\">\r\n\t\t\t\t<PatternLayout\r\n\t\t\t\t\tpattern=\"canigo Message: %d{dd MM yyyy HH:mm:ss,SSS} %-5p [%t] %-5p [%t] %c - %m%n\" />\r\n\t\t\t</Console>\r\n\t\t</Appenders>\r\n\t\t<Loggers>\r\n\t\t\t<Logger name=\"cat.gencat.ctti\" level=\"debug\" additivity=\"false\">\r\n\t\t\t\t<AppenderRef ref=\"DAILY_LOG\" />\r\n\t\t\t\t<AppenderRef ref=\"STDOUT\" />\r\n\t\t\t</Logger>\r\n\t\t\t<Root level=\"debug\">\r\n\t\t\t\t<AppenderRef ref=\"DAILY_LOG\" />\r\n\t\t\t\t<AppenderRef ref=\"STDOUT\" />\r\n\t\t\t</Root>\r\n\t\t</Loggers>\r\n\t</Configuration>\r\n\r\nTambé s'ha de substituïr la forma de realitzar el logging a les nostres classes de l'aplicació. A Canigó 3.1 el procediment era el següent:\r\n\r\n\t...\r\n\timport org.apache.commons.logging.Log;\r\n\timport org.apache.commons.logging.LogFactory;\r\n\t...\r\n\tprivate static final Log logger = LogFactory.getLog(MyClass.class);\r\n\t...\r\n\tlogger.debug(\"Això és un log\");\r\n\t...\r\n\t\r\nA Canigó 3.2 el procediment ha de ser el següent:\r\n\r\n\t...\r\n\timport org.slf4j.Logger;\r\n\timport org.slf4j.LoggerFactory;\r\n\t...\r\n\tprivate static final Logger logger = LoggerFactory.getLogger(MyClass.class);\r\n\t...\r\n\tlogger.debug(\"Això és un log\");\r\n\t\r\n### Esquemes de Spring\r\n\r\nA banda d'assegurar-se que totes les llibreries que Spring tinguin el mateix versionatge \"4.3.4.RELEASE\" (cal tenir en compte que hi ha llibreries de Spring amb el seu propi versionatge, en aquest cas ens hem d'assegurar que disposem de la versió compatible amb la 4.3.4.RELEASE del core de Spring) hem d'actualitzar els esquemes XSD dels fitxers de configuració a la versió 4.3.\r\n\r\nL'esquema XSD de Spring Security ha d'actualitzar-se a la versió 4.1.\r\n\r\nPer exemple, el fitxer app-custom-security.xml quedaria amb la següent capçalera:\r\n\r\n\t<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\t<beans  xmlns=\"http://www.springframework.org/schema/beans\"\r\n\t\t\txmlns:security=\"http://www.springframework.org/schema/security\"\r\n\t\t\txmlns:context=\"http://www.springframework.org/schema/context\"\r\n\t\t\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" \r\n\t\t\txmlns:jdbc=\"http://www.springframework.org/schema/jdbc\"\r\n\t\t\txsi:schemaLocation=\"http://www.springframework.org/schema/beans \thttp://www.springframework.org/schema/beans/spring-beans-4.3.xsd\r\n\t\t\t\t\t\t\t\thttp://www.springframework.org/schema/context \thttp://www.springframework.org/schema/context/spring-context-4.3.xsd\r\n\t\t\t\t\t\t\t\thttp://www.springframework.org/schema/security \thttp://www.springframework.org/schema/security/spring-security-4.1.xsd\r\n\t\t\t\t\t\t\t\thttp://www.springframework.org/schema/jdbc \t\thttp://www.springframework.org/schema/jdbc/spring-jdbc-4.3.xsd\">\r\n\r\n### Dispatcher-servlet\r\n\r\nA la versió 4.3.4 de Spring la propietat *mediaTypes* del bean ContentNegotiatingViewResolver ja no és modificable. En aquesta versió *ContentNegotiatingViewResolver* delega en l'objecte *ContentNegotiationManager* la gestió d'aquesta propietat:\r\n\r\nAl fitxer \"dispatcher-servlet.xml\" s'ha de substituir el bean actual:\r\n\r\n\t<bean class=\"org.springframework.web.servlet.view.ContentNegotiatingViewResolver\">\r\n\t\t<property name=\"order\" value=\"1\" />\r\n\t\t<property name=\"mediaTypes\">\r\n\t\t\t<map>\r\n\t\t\t\t<entry key=\"json\" value=\"application/json\" />\r\n\t\t\t</map>\r\n\t\t</property>\r\n\t\t<property name=\"defaultViews\">\r\n\t\t\t<list>\r\n\t\t\t\t<bean class=\"org.springframework.web.servlet.view.json.MappingJackson2JsonView\" />\r\n\t\t\t</list>\r\n\t\t</property>\r\n\t</bean>\r\n\t\r\nPer:\r\n\r\n\t<bean id=\"contentNegotiationManager\"  class=\"org.springframework.web.accept.ContentNegotiationManagerFactoryBean\">\r\n        \t<property name=\"favorPathExtension\" value=\"true\" />\r\n        \t<property name=\"ignoreAcceptHeader\" value=\"true\"/>\r\n\r\n\t\t<property name=\"mediaTypes\">\r\n\t\t    <map>\r\n\t\t\t<entry key=\"json\" value=\"application/json\"/>\r\n\t\t   </map>\r\n\t\t</property>\r\n   \t</bean>\r\n\t\r\n\t<bean class=\"org.springframework.web.servlet.view.ContentNegotiatingViewResolver\">\r\n\t\t<property name=\"order\" value=\"1\" />\r\n\t\t<property name=\"contentNegotiationManager\" ref=\"contentNegotiationManager\"/>\r\n\t\t<property name=\"defaultViews\">\r\n\t\t\t<list>\r\n\t\t\t\t<bean class=\"org.springframework.web.servlet.view.json.MappingJackson2JsonView\" />\r\n\t\t\t</list>\r\n\t\t</property>\r\n\t</bean>\r\n\t\r\n## Aplicació JSF\r\n\r\n### Configuració de dependències\r\n\r\nA la [matriu de compatibilitats] (/canigo-download-related/matrius-compatibilitats) es poden veure les versions dels mòduls i components de Canigó de les versions 3.1.x i 3.2.x. S'han d'actualitzar els intervals dels mòduls utilitzats per a migrar a Canigó 3.2.\r\n\r\nEn cas d'utilitzar el mòdul \"canigo.operation.instrumentation\", l'última versió d'aquest mòdul és només per a aplicacions REST. S'ha de treure la dependència a aquest mòdul i afegir la dependència al nou mòul \"canigo.operation.instrumentation.jsf\":\r\n\r\n\t<dependency>\r\n\t      <groupId>cat.gencat.ctti</groupId>\r\n\t      <artifactId>canigo.operation.instrumentation.jsf</artifactId>\r\n\t      <version>${canigo.operation.instrumentation.jsf}</version>\r\n    \t</dependency>\r\n\t\r\nEn cas de tenir alguna dependència amb Spring al POM de l'aplicació s'ha d'actualitzar a la versió 4.3.4.RELEASE.\r\n\r\nEn cas de tenir la llibreria Xerces com a dependència s'ha d'actualitzar a la versió 2.11:\r\n\r\n\t\t<dependency>\r\n\t\t    <groupId>xerces</groupId>\r\n\t\t    <artifactId>xercesImpl</artifactId>\r\n\t\t    <version>2.11.0</version>\r\n\t\t</dependency>\r\n\t\t\r\n### Servei de Logs\r\n\r\nIdem \"Aplicació REST\"\r\n\r\n### Esquemes de Spring\r\n\r\nIdem \"Aplicació REST\"\r\n","objectID":"L2hvd3Rvcy8yMDE3LTA4LUhvd3RvLUFjdHVhbGl0emFjaW9fQ2FuaWdvM18xX0NhbmlnbzNfMg=="},"L2hvd3Rvcy8yMDE2LTEwLUhvd3RvLUNhbmlnby1TcHJpbmctQmF0Y2g=":{"date":1475193600000,"title":"Spring Batch a una aplicació Canigó","description":"How To per afegir Spring Batch a una aplicació Canigó.","section":"howtos","categories":["canigo"],"key":"OCTUBRE2016","path":"/howtos/2016-10-Howto-Canigo-Spring-Batch","content":"### A qui va dirigit\n\nAquest how-to va dirigit a tots aquells desenvolupadors/arquitectes que vulguin afegir Spring Batch a una aplicació Canigó 3.1 Rest.\n\n### Versió de Canigó\n\nEls passos descrits en aquest document apliquen a la versió 3.1.x del Framework Canigó.\n\n### Introducció\n\nEn aquest HowTo s’explica com afegir Spring Batch a una aplicació Canigó 3.1 REST. Per a fer-ho desplegarem l’aplicació demo que genera el plugin de Canigó (amb una base de dades MySql) amb un procés batch que llegeixi d'un fitxer CSV cada cert temps i inserti les dades a BBDD.\nAquest procés ho implementarem amb Spring Batch.\n\nPer a mostrar el funcionament de Spring Batch amb diferents nodes, farem un altre exemple que realitzi la mateixa tasca que l'anterior però particionada de forma que diferents threads s'ocupin paral·lelament del processament del fitxer. \nEn un entorn real s'hauria d'utilitzar un framework de missatgeria(JMS) per a poder realitzar aquesta separació entre diferents nodes.\n\n## Exemple Configuració Spring Batch\n\n### Afegir Llibreries\n\nS'ha d'afegir al pom.xml la dependència a Spring Batch Core\n\n    <!-- SPRING BATCH -->\n    <dependency>\n        <groupId>org.springframework.batch</groupId>\n        <artifactId>spring-batch-core</artifactId>\n        <version>3.0.7.RELEASE</version>\n    </dependency>\n\t\n### Configuració Base de Dades de Spring Batch (Job Repository)\n\nPrimer s'han d'afegir a la base dades les taules de Spring Batch: S'ha d'executar a la Base de Dades el següent script https://github.com/spring-projects/spring-batch/blob/master/spring-batch-core/src/main/resources/org/springframework/batch/core/schema-mysql.sql\n\nEn cas de tenir una Base de Dades diferent a MySQL seleccionar el script adient : https://github.com/spring-projects/spring-batch/tree/master/spring-batch-core/src/main/resources/org/springframework/batch/core\n\nDesprés hem de definir el job repository. Al fitxer app-custom-persistence-jpa.xml afegirem els següents beans:\n\n\t<!-- Spring Batch -->\n\t<!-- stored job-meta in database -->\n\t<bean id=\"jobRepository\"\n\t\tclass=\"org.springframework.batch.core.repository.support.JobRepositoryFactoryBean\">\n\t\t<property name=\"dataSource\" ref=\"dataSource\" />\n\t\t<property name=\"transactionManager\" ref=\"transactionManager\" />\n\t\t<property name=\"databaseType\" value=\"mysql\" />\n\t</bean>\n\t\n\t<bean id=\"transactionManager\"\n\t\tclass=\"org.springframework.batch.support.transaction.ResourcelessTransactionManager\" />\n\n### Input (Fitxer CSV)\n\nEn aquest howto l'input del procés Batch és un fitxer CSV que hem desat a **resources/cvs/input/input.csv**\n\n\t'estacio autobusos', 'Balaguer'\n\t'Jutjat de Pau', 'Santa Coloma Gramenet'\n\t'centre obert Alba', 'Vilafranca'\n\t'La Salle Manlleu', 'Manlleu'\n\t'estacio metro', 'Barcelona'\n\t'Jutjat Social', 'Manresa'\n\t'centre obert Ocaso', 'Vic'\n\t'La Salle Salou', 'Salou'\n\t'estacio tren', 'Sant Celoni'\n\t'Jutjat Penal', 'Vielha'\n\t'centre obert Nit', 'Sabadell'\n\t'La Salle Lleida', 'Lleida'\n\n### Configuració del Job\n\nHem de crear el fitxer app-custom-spring-batch.xml a la carpeta spring.\n\nA la definició del xml afegim els esquemes de batch y task (per a crida al job de forma asíncrona)\n\n\t<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\n\t<beans xmlns=\"http://www.springframework.org/schema/beans\"\n\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" \n\txmlns:batch=\"http://www.springframework.org/schema/batch\"\n    xmlns:task=\"http://www.springframework.org/schema/task\"\n\txsi:schemaLocation=\"http://www.springframework.org/schema/beans \n           http://www.springframework.org/schema/beans/spring-beans-4.1.xsd\n           http://www.springframework.org/schema/task\n           http://www.springframework.org/schema/task/spring-task-4.1.xsd\n           http://www.springframework.org/schema/batch\n\t\t   http://www.springframework.org/schema/batch/spring-batch-3.0.xsd\">\n\nDefinim el nostre job, que tindrà un step. Aquest step s'encarrega de llegir del fitxer csv, processar la informació i escriure-la en base de dades:\n\n\t<batch:job id=\"howtoJob\">\n\t  <batch:step id=\"step1\">\n\t\t<batch:tasklet>\n\t\t\t<batch:chunk reader=\"cvsFileItemReader\" writer=\"jdbcItemWriter\" processor=\"itemProcessor\" commit-interval=\"2\"></batch:chunk>\n\t\t</batch:tasklet>\n\t  </batch:step>\n\t</batch:job>\n\t\n\t<bean id=\"cvsFileItemReader\" class=\"org.springframework.batch.item.file.FlatFileItemReader\">\n\t\t<property name=\"resource\" value=\"classpath:cvs/input/input.csv\" />\n\n\t\t<property name=\"lineMapper\">\n\t\t    <bean class=\"org.springframework.batch.item.file.mapping.DefaultLineMapper\">\n\t\t\t<property name=\"lineTokenizer\">\n\t\t\t\t<bean\n\t\t\t\t\tclass=\"org.springframework.batch.item.file.transform.DelimitedLineTokenizer\">\n\t\t\t\t\t<property name=\"names\" value=\"nom,municipi\" />\n\t\t\t\t</bean>\n\t\t\t</property>\n\t\t\t<property name=\"fieldSetMapper\">\n\t\t\t\t<bean class=\"cat.gencat.howtobatch.batch.EquipamentFieldSetMapper\" />\n\t\t\t</property>\n\t\t    </bean>\n\t\t</property>\n\t</bean>\n\t\n\t<bean id=\"itemProcessor\" class=\"cat.gencat.howtobatch.batch.CustomItemProcessor\" />\n\t\n\t<bean id=\"jdbcItemWriter\" class=\"org.springframework.batch.item.database.JdbcBatchItemWriter\">\n\t\t<property name=\"dataSource\" ref=\"dataSource\" />\n\t\t<property name=\"sql\">\n\t\t  <value>\n\t            <![CDATA[\n\t            \tinsert into equipaments (nom, municipi)\n\t\t\t\t\tvalues (:nom, :municipi)\n\t            ]]>\n\t\t  </value>\n\t\t</property>\n\t\t<!-- It will take care matching between object property and sql name parameter -->\n\t\t<property name=\"itemSqlParameterSourceProvider\">\n\t\t\t<bean class=\"org.springframework.batch.item.database.BeanPropertyItemSqlParameterSourceProvider\" />\n\t\t</property>\n\t</bean>\n\t\t\nDefinim també el jobLauncher, que s'encarrega de iniciar la execució dels diferents jobs que tinguem a l'aplicació\n\n\t<bean id=\"jobLauncher\"\n\t\tclass=\"org.springframework.batch.core.launch.support.SimpleJobLauncher\">\n\t\t<property name=\"jobRepository\" ref=\"jobRepository\" />\n\t</bean>\n\t\t\nI com en aquest howto volem iniciar de forma asíncrona el nostre procés batch definim un scheduler que s'executi cada 15 segons.\n\n\t <bean id=\"runScheduler\" class=\"cat.gencat.howtobatch.batch.RunScheduler\" />\n\n\t<!-- Run every 15 seconds -->\n\t<task:scheduled-tasks>\n\t\t<task:scheduled ref=\"runScheduler\" method=\"run\" cron=\"*/15 * * * * *\" />\n\t</task:scheduled-tasks>\n\nAra s'ha de crear les classes que hem definit: \n\n - EquipamentFieldSetMapper: S'encarrega de convertir cada línea del CSV en un objecte Equipaments\n - CustomItemProcessor: S'encarrega de processar les dades obtingudas de la lectura (En aquest howto no fem res, però per a facilitar futures implementacions es mostra un exemple)\n - RunScheduler: És la tasca que s'executarà cada 15 segons. Aquí s'inicia el job de Spring Batch\n \n#### EquipamentFieldSetMapper\n\n\tpackage cat.gencat.howtobatch.batch;\n\n\timport org.springframework.batch.item.file.mapping.FieldSetMapper;\n\timport org.springframework.batch.item.file.transform.FieldSet;\n\timport org.springframework.validation.BindException;\n\n\timport cat.gencat.howtobatch.model.Equipament;\n\n\tpublic class EquipamentFieldSetMapper implements FieldSetMapper<Equipament>{\n\n\t\t@Override\n\t\tpublic Equipament mapFieldSet(FieldSet fieldset) throws BindException {\n\t\t\t\n\t\t\tEquipament equipament = new Equipament();\n\t\t\tequipament.setNom(fieldset.readString(0));\n\t\t\tequipament.setMunicipi(fieldset.readString(1));\n\t\t\treturn equipament;\n\t\t}\n\t}\n\n#### CustomItemProcessor\n\n\tpackage cat.gencat.howtobatch.batch;\n\n\timport org.springframework.batch.item.ItemProcessor;\n\timport cat.gencat.howtobatch.model.Equipament;\n\n\tpublic class CustomItemProcessor implements ItemProcessor<Equipament, Equipament> {\n\n\t\t@Override\n\t\tpublic Equipament process(Equipament item) throws Exception {\n\t\t\tSystem.out.println(\"Tractant...\" + item);\n\t\t\treturn item;\n\t\t}\n\t}\n\n#### RunScheduler\n\n\tpackage cat.gencat.howtobatch.batch;\n\n\timport java.util.Date;\n\n\timport org.springframework.batch.core.Job;\n\timport org.springframework.batch.core.JobExecution;\n\timport org.springframework.batch.core.JobParameters;\n\timport org.springframework.batch.core.JobParametersBuilder;\n\timport org.springframework.batch.core.launch.JobLauncher;\n\timport org.springframework.beans.factory.annotation.Autowired;\n\timport org.springframework.stereotype.Component;\n\n\t@Component\n\tpublic class RunScheduler {\n\n\t\t@Autowired\n\t\tJobLauncher jobLauncher;\n\t\t\n\t\t@Autowired\n\t\tJob howtoJob;\n\n\t  public void run() {\n\n\t\ttry {\n\n\t\tString dateParam = new Date().toString();\n\t\tJobParameters param =\n\t\t  new JobParametersBuilder().addString(\"date\", dateParam).toJobParameters();\n\n\t\tSystem.out.println(dateParam);\n\n\t\tJobExecution execution = jobLauncher.run(howtoJob, param);\n\t\tSystem.out.println(\"Sortida: \" + execution.getStatus());\n\n\t\t} catch (Exception e) {\n\t\t\te.printStackTrace();\n\t\t}\n\n\t  }\n\t}\n\nUn job només es pot executar 1 vegada (si s'ha completat amb èxit). Com en aquest cas volem que el mateix job s'executi continuament li hem de passar un paràmetre que el faci únic. En aquest cas li pasem la data.\n\n### Resultat\n\nSi arranquem l'aplicació, cada 15 segons veurem a la consola els logs que hem posat al procés batch:\n\n\tThu Sep 22 17:17:00 CEST 2016\n\tTractant...Equipament [nom='estacio autobusos']\n\tTractant...Equipament [nom='Jutjat de Pau']\n\tTractant...Equipament [nom='centre obert Alba']\n\tTractant...Equipament [nom='La Salle Manlleu']\n\tTractant...Equipament [nom='estacio metro']\n\tTractant...Equipament [nom='Jutjat Social']\n\tTractant...Equipament [nom='centre obert Ocaso']\n\tTractant...Equipament [nom='La Salle Salou']\n\tTractant...Equipament [nom='estacio tren']\n\tTractant...Equipament [nom='Jutjat Penal']\n\tTractant...Equipament [nom='centre obert Nit']\n\tTractant...Equipament [nom='La Salle Lleida']\n\tSortida: COMPLETED\n\tThu Sep 22 17:17:15 CEST 2016\n\tTractant...Equipament [nom='estacio autobusos']\n\tTractant...Equipament [nom='Jutjat de Pau']\n\tTractant...Equipament [nom='centre obert Alba']\n\tTractant...Equipament [nom='La Salle Manlleu']\n\tTractant...Equipament [nom='estacio metro']\n\tTractant...Equipament [nom='Jutjat Social']\n\tTractant...Equipament [nom='centre obert Ocaso']\n\tTractant...Equipament [nom='La Salle Salou']\n\tTractant...Equipament [nom='estacio tren']\n\tTractant...Equipament [nom='Jutjat Penal']\n\tTractant...Equipament [nom='centre obert Nit']\n\tTractant...Equipament [nom='La Salle Lleida']\n\tSortida: COMPLETED\n\tThu Sep 22 17:17:30 CEST 2016\n\tTractant...Equipament [nom='estacio autobusos']\n\tTractant...Equipament [nom='Jutjat de Pau']\n\tTractant...Equipament [nom='centre obert Alba']\n\tTractant...Equipament [nom='La Salle Manlleu']\n\tTractant...Equipament [nom='estacio metro']\n\tTractant...Equipament [nom='Jutjat Social']\n\tTractant...Equipament [nom='centre obert Ocaso']\n\tTractant...Equipament [nom='La Salle Salou']\n\tTractant...Equipament [nom='estacio tren']\n\tTractant...Equipament [nom='Jutjat Penal']\n\tTractant...Equipament [nom='centre obert Nit']\n\tTractant...Equipament [nom='La Salle Lleida']\n\tSortida: COMPLETED\n\n## Exemple Partitioning of Step\n\nEn aquest howto es mostra com configurar el processament de jobs de forma paral·lela. Per a mostrar el funcionament partirem els steps d'un job en N sub-steps i cadascún l'executarà un thread diferent.\n\nPer a utilitzar aquest sistema en una aplicació amb diferents nodes de forma remota s'hauria d'utilitzar un framework de missatgeria(JMS) per a la comunicació entre els nodes.\n\nCanvis a partir de l'exemple anterior:\n\n### app-custom-spring-batch-config\n\nEs modifica el fitxer de configuració per a partir el job. S'ha de implementar una classe que realitzi la partició\n\n\t...\n\n    <job id=\"partitionJob\" xmlns=\"http://www.springframework.org/schema/batch\">\n\t\t<step id=\"howtoJob\">\n\t\t\t<partition step=\"slave\" partitioner=\"rangePartitioner\">\n\t\t\t\t<handler grid-size=\"4\" task-executor=\"taskExecutor\" />\n\t\t\t</partition>\n\t\t</step>\n\t</job>\n\t\n\t<bean id=\"taskExecutor\" class=\"org.springframework.core.task.SimpleAsyncTaskExecutor\" />\n\n\t <!-- each thread will run this job, with different stepExecutionContext values. -->\n\t  <step id=\"slave\" xmlns=\"http://www.springframework.org/schema/batch\">\n\t  \t<tasklet>\n\t\t\t<chunk reader=\"cvsFileItemReader\" writer=\"jdbcItemWriter\" processor=\"itemProcessor\" commit-interval=\"2\">\n\t\t\t</chunk>\n\t\t</tasklet>\n\t  </step>\n\t  \n\t<bean id=\"rangePartitioner\" class=\"cat.gencat.howtobatch.batch.RangePartitioner\" />\n\t\n\t\t\n\t<bean id=\"itemProcessor\" class=\"cat.gencat.howtobatch.batch.CustomItemProcessor\" scope=\"step\">\n\t\t<property name=\"threadName\" value=\"#{stepExecutionContext[name]}\" />\n\t</bean>\n\t...\n\t\nEls beans cvsFileItemReader, jdbcItemWriterm, jobLauncher i runScheduler són los mateixos que a l'exemple anterior.\n\t\nAra s'ha de crear els fitxers que hem definit: \n\n - rangePartitioner: S'encarrega de dividir els steps en el nombre de sub-steps que s'ha definit (grid-size)\n\n#### RangePartitioner\n\n\tpackage cat.gencat.howtobatch.batch;\n\n\timport java.util.HashMap;\n\timport java.util.Map;\n\n\timport org.springframework.batch.core.partition.support.Partitioner;\n\timport org.springframework.batch.item.ExecutionContext;\n\n\tpublic class RangePartitioner implements Partitioner {\n\n\t\t@Override\n\t\tpublic Map<String, ExecutionContext> partition(int gridSize) {\n\n\t\t\tMap<String, ExecutionContext> result\n\t\t\t\t\t\t   = new HashMap<String, ExecutionContext>();\n\n\t\t\tfor (int i = 1; i <= gridSize; i++) {\n\t\t\t\tExecutionContext value = new ExecutionContext();\n\n\t\t\t\tvalue.putString(\"name\", \"Thread\" + i);\n\t\t\t\tresult.put(\"partition\" + i, value);\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\t}\n \nCada cop que es crea un ExecutionContext es crea un Thread, cada thread processarà 4 línies del fitxer CSV.\n\nAl dividir el step en N sub steps, hi haurà N sortides (en aquest cas és indiferent ja que la sortida és escriure a base de dades, però si la sortida fós escriure en un fitxer es crearien N fitxers de sortida, un per cada sub-step)\n\n#### CustomItemProcessor\n\nHem modificat aquest fitxer per a incloure el nom del thread que està processant el step:\n\n\tpackage cat.gencat.howtobatch.batch;\n\n\timport org.springframework.batch.item.ItemProcessor;\n\n\timport cat.gencat.howtobatch.model.Equipament;\n\n\tpublic class CustomItemProcessor implements ItemProcessor<Equipament, Equipament> {\n\n\t\tprivate String threadName;\n\t\t\n\t\t@Override\n\t\tpublic Equipament process(Equipament item) throws Exception {\n\t\t\tSystem.out.println(threadName  + \" Tractant... \" + item);\n\t\t\treturn item;\n\t\t}\n\n\t\tpublic String getThreadName() {\n\t\t\treturn threadName;\n\t\t}\n\n\t\tpublic void setThreadName(String threadName) {\n\t\t\tthis.threadName = threadName;\n\t\t}\n\t\t\n\t}\n \n### Resultat\n \n\tFri Sep 23 09:49:00 CEST 2016\n\tThread4 Tractant... Equipament [nom='estacio autobusos']\n\tThread4 Tractant... Equipament [nom='Jutjat de Pau']\n\tThread3 Tractant... Equipament [nom='centre obert Alba']\n\tThread3 Tractant... Equipament [nom='La Salle Manlleu']\n\tThread2 Tractant... Equipament [nom='estacio metro']\n\tThread2 Tractant... Equipament [nom='Jutjat Social']\n\tThread1 Tractant... Equipament [nom='centre obert Ocaso']\n\tThread1 Tractant... Equipament [nom='La Salle Salou']\n\tThread3 Tractant... Equipament [nom='Jutjat Penal']\n\tThread3 Tractant... Equipament [nom='centre obert Nit']\n\tThread4 Tractant... Equipament [nom='estacio tren']\n\tThread4 Tractant... Equipament [nom='La Salle Lleida']\n\tSortida: COMPLETED\n\tFri Sep 23 09:49:15 CEST 2016\n\tThread3 Tractant... Equipament [nom='estacio autobusos']\n\tThread4 Tractant... Equipament [nom='centre obert Alba']\n\tThread4 Tractant... Equipament [nom='La Salle Manlleu']\n\tThread3 Tractant... Equipament [nom='Jutjat de Pau']\n\tThread1 Tractant... Equipament [nom='estacio metro']\n\tThread1 Tractant... Equipament [nom='Jutjat Social']\n\tThread2 Tractant... Equipament [nom='centre obert Ocaso']\n\tThread2 Tractant... Equipament [nom='La Salle Salou']\n\tThread3 Tractant... Equipament [nom='estacio tren']\n\tThread3 Tractant... Equipament [nom='Jutjat Penal']\n\tThread2 Tractant... Equipament [nom='centre obert Nit']\n\tThread4 Tractant... Equipament [nom='La Salle Lleida']\n\tSortida: COMPLETED","objectID":"L2hvd3Rvcy8yMDE2LTEwLUhvd3RvLUNhbmlnby1TcHJpbmctQmF0Y2g="},"L2hvd3Rvcy8yMDE2LTExLUhvd3RvLUNhbmlnby1KV1Q=":{"date":1480464000000,"title":"Autenticació amb JWT a una aplicació Canigó 3.1","description":"Autenticació amb JWT (JSON Web Tokens) a una aplicació Canigó 3.1.x (REST/HTML5+JS)","section":"howtos","categories":["canigo"],"key":"DESEMBRE2016","path":"/howtos/2016-11-Howto-Canigo-JWT","content":"### A qui va dirigit\n\nAquest how-to va dirigit a tots aquells desenvolupadors/arquitectes que vulguin autenticar amb JWT a una aplicació Canigó 3.1 (REST+HTML5/JS).\n\n### Versió de Canigó\n\nEls pasos descrits en aquest document apliquen a la versió 3.1.x del Framework Canigó.\n\n### Introducció\n\nEn aquest HowTo s’explica com autenticar amb  JWT a una aplicació Canigó 3.1 REST. Per a fer-ho desplegarem l’aplicació demo que genera el plugin de Canigó amb seguretat per BBDD (amb una base de dades HSQLDB en memòria).\n\n\n## Configuració\n\n### Afegir Llibreries\n\nS'ha d'afegir al pom.xml la dependència amb Java JWT:\n\n   \t<!-- JJWT -->\n\t<dependency>\n\t\t<groupId>io.jsonwebtoken</groupId>\n\t\t<artifactId>jjwt</artifactId>\n\t\t<version>0.7.0</version>\n\t</dependency>\n\t\n### Configuració Petició/Resposta\n\nPer configurar JWT primer de tot creem les classes de petició, resposta, i el handler d'aquesta resposta:\n\nAl path *src/main/java/cata/gencat/canigorest311/security/authentication/dto* generem les següents classes:\n\n**AuthenticationRequestDto.java**, per a la petició:\n\n\tpackage cat.gencat.canigorest311.security.authentication.dto;\n\n\timport java.io.Serializable;\n\n\tpublic class AuthenticationRequestDto implements Serializable {\n\n\t\tprivate static final long serialVersionUID = 3237170924587387745L;\n\n\t\tprivate String username;\n\t\tprivate String password;\n\n\t\tpublic AuthenticationRequestDto() {\n\t\t\tsuper();\n\t\t}\n\n\t\tpublic AuthenticationRequestDto(final String username, final String password) {\n\t\t\tthis.setUsername(username);\n\t\t\tthis.setPassword(password);\n\t\t}\n\n\t\tpublic String getUsername() {\n\t\t\treturn username;\n\t\t}\n\n\t\tpublic void setUsername(final String username) {\n\t\t\tthis.username = username;\n\t\t}\n\n\t\tpublic String getPassword() {\n\t\t\treturn password;\n\t\t}\n\n\t\tpublic void setPassword(final String password) {\n\t\t\tthis.password = password;\n\t\t}\n\t}\n\n**AuthenticationResponseDto.java**, per a la respsota\n\n\tpackage cat.gencat.canigorest311.security.authentication.dto;\n\n\timport java.io.Serializable;\n\n\tpublic class AuthenticationResponseDto implements Serializable {\n\n\t\tprivate static final long serialVersionUID = -576643360234236041L;\n\n\t\tprivate final int code;\n\n\t\tpublic AuthenticationResponseDto(final int code) {\n\t\t\tthis.code = code;\n\t\t}\n\n\t\tpublic int getCode() {\n\t\t\treturn code;\n\t\t}\n\t}\n\n**JwtAuthenticationResponseDto.java**, per al token\n\n\tpackage cat.gencat.canigorest311.security.authentication.dto;\n\n\timport java.io.Serializable;\n\n\tpublic class JwtAuthenticationResponseDto implements Serializable {\n\n\t\tprivate static final long serialVersionUID = -5766433606831683041L;\n\t\tprivate final String token;\n\n\t\tpublic JwtAuthenticationResponseDto(final String token) {\n\t\t\tthis.token = token;\n\t\t}\n\n\t\tpublic String getToken() {\n\t\t\treturn token;\n\t\t}\n\t}\n\t\nAl path *src/main/java/cata/gencat/canigorest311/security/authentication/response* generem les classes utilitzades a la resposta:\n\n**ResponseRest.java**\n\n\tpackage cat.gencat.canigorest311.security.authentication.response;\n\n\timport java.io.Serializable;\n\n\tpublic class ResponseRest implements Serializable {\n\t\t/**\n\t\t *\n\t\t */\n\t\tprivate static final long serialVersionUID = -89237367748293773L;\n\t\tprivate int code;\n\t\tprivate String message;\n\n\t\tpublic ResponseRest() {\n\t\t\tsuper();\n\n\t\t}\n\n\t\tpublic ResponseRest(final int code, final String message) {\n\t\t\tsuper();\n\t\t\tthis.code = code;\n\t\t\tthis.message = message;\n\t\t}\n\n\t\tpublic int getCode() {\n\t\t\treturn code;\n\t\t}\n\n\t\tpublic void setCode(final int code) {\n\t\t\tthis.code = code;\n\t\t}\n\n\t\tpublic String getMessage() {\n\t\t\treturn message;\n\t\t}\n\n\t\tpublic void setMessage(final String message) {\n\t\t\tthis.message = message;\n\t\t}\n\t}\n\n**ResponseRestOk.java**\n\n\tpackage cat.gencat.canigorest311.security.authentication.response;\n\n\tpublic class ResponseRestOK extends ResponseRest {\n\n\t\tprivate static final long serialVersionUID = -234121341241231L;\n\n\t\tpublic ResponseRestOK() {\n\t\t\tsuper();\n\t\t}\n\n\t\tpublic ResponseRestOK(final int code, final String message) {\n\t\t\tsuper(code, message);\n\n\t\t}\n\n\t}\n\n**ResponseRestError.java**\n\n\tpackage cat.gencat.canigorest311.security.authentication.response;\n\n\tpublic class ResponseRestError extends ResponseRest {\n\n\t\tprivate static final long serialVersionUID = -12141241223455L;\n\n\t\tpublic ResponseRestError() {\n\t\t\tsuper();\n\t\t}\n\n\t\tpublic ResponseRestError(final int code, final String message) {\n\t\t\tsuper(code, message);\n\n\t\t}\n\n\t}\n\t\nAl path *src/main/java/cata/gencat/canigorest311/security/authentication/handler* generem les classes utilitzades per a construïr la resposta:\n\n**RestAuthenticationFailureHandler.java**\n\n\tpackage cat.gencat.canigorest311.security.authentication.handler;\n\n\timport java.io.IOException;\n\timport java.io.PrintWriter;\n\n\timport javax.servlet.ServletException;\n\timport javax.servlet.http.HttpServletRequest;\n\timport javax.servlet.http.HttpServletResponse;\n\n\timport org.springframework.http.MediaType;\n\timport org.springframework.security.core.AuthenticationException;\n\timport org.springframework.security.web.authentication.AuthenticationFailureHandler;\n\timport org.springframework.stereotype.Component;\n\n\timport com.fasterxml.jackson.databind.ObjectMapper;\n\n\timport cat.gencat.canigorest311.security.authentication.response.ResponseRestError;\n\n\t@Component(\"restAuthenticationFailureHandler\")\n\tpublic class RestAuthenticationFailureHandler implements AuthenticationFailureHandler {\n\n\t\t@Override\n\t\tpublic void onAuthenticationFailure(final HttpServletRequest request, final HttpServletResponse response, final AuthenticationException exception)\n\t\t\t\tthrows IOException, ServletException {\n\t\t\tbuilJsonResponse(response);\n\n\t\t}\n\n\t\tprivate void builJsonResponse(final HttpServletResponse response) throws IOException {\n\t\t\tresponse.setStatus(HttpServletResponse.SC_UNAUTHORIZED);\n\t\t\tresponse.setContentType(MediaType.APPLICATION_JSON.toString());\n\n\t\t\tfinal ObjectMapper mapper = new ObjectMapper();\n\t\t\tfinal ResponseRestError error = new ResponseRestError(HttpServletResponse.SC_UNAUTHORIZED, \"401. Unauthorized\");\n\t\t\tfinal String json = mapper.writeValueAsString(error);\n\t\t\tfinal PrintWriter writer = response.getWriter();\n\t\t\twriter.write(json);\n\t\t\twriter.flush();\n\t\t\twriter.close();\n\t\t}\n\t}\n\t\n**RestAuthenticationSuccessHandler.java**\n\n\tpackage cat.gencat.canigorest311.security.authentication.handler;\n\n\timport java.io.IOException;\n\timport java.io.PrintWriter;\n\n\timport javax.servlet.ServletException;\n\timport javax.servlet.http.HttpServletRequest;\n\timport javax.servlet.http.HttpServletResponse;\n\n\timport org.springframework.http.MediaType;\n\timport org.springframework.security.core.Authentication;\n\timport org.springframework.security.web.authentication.AuthenticationSuccessHandler;\n\timport org.springframework.stereotype.Component;\n\n\timport com.fasterxml.jackson.databind.ObjectMapper;\n\n\timport cat.gencat.canigorest311.security.authentication.response.ResponseRestOK;\n\n\t@Component(\"restAuthenticationSuccessHandler\")\n\tpublic class RestAuthenticationSuccessHandler implements AuthenticationSuccessHandler {\n\n\t\t@Override\n\t\tpublic void onAuthenticationSuccess(final HttpServletRequest request, final HttpServletResponse response, final Authentication authentication)\n\t\t\t\tthrows IOException, ServletException {\n\t\t\t// We do not need to do anything extra on REST login success, because there is no page to redirect to\n\t\t\tbuilJsonResponse(response);\n\t\t}\n\n\t\tprivate void builJsonResponse(final HttpServletResponse response) throws IOException {\n\t\t\tresponse.setStatus(HttpServletResponse.SC_OK);\n\t\t\tresponse.setContentType(MediaType.APPLICATION_JSON.toString());\n\n\t\t\tfinal ObjectMapper mapper = new ObjectMapper();\n\t\t\tfinal ResponseRestOK error = new ResponseRestOK(HttpServletResponse.SC_OK, \"200. Login Sucess\");\n\t\t\tfinal String json = mapper.writeValueAsString(error);\n\t\t\tfinal PrintWriter writer = response.getWriter();\n\t\t\twriter.write(json);\n\t\t\twriter.flush();\n\t\t\twriter.close();\n\t\t}\n\n\t}\n\n### Configuració JWT\n\n#### Handler del token\n\nClasse que s'utilitza per a obtenir la informació del token (username, authorities):\n\nAl path *src/main/java/cata/gencat/canigorest311/security/authentication/jwt*\n\n**JwtTokenHandler.java**\n\n\tpackage cat.gencat.canigorest311.security.authentication.jwt;\n\n\timport java.util.Date;\n\timport java.util.HashMap;\n\timport java.util.Map;\n\n\timport javax.annotation.PostConstruct;\n\n\timport org.apache.commons.lang3.StringUtils;\n\timport org.apache.commons.logging.Log;\n\timport org.apache.commons.logging.LogFactory;\n\timport org.springframework.security.core.authority.AuthorityUtils;\n\timport org.springframework.security.core.userdetails.User;\n\timport org.springframework.security.core.userdetails.UserDetails;\n\timport org.springframework.util.Assert;\n\n\timport io.jsonwebtoken.Claims;\n\timport io.jsonwebtoken.Jwts;\n\timport io.jsonwebtoken.SignatureAlgorithm;\n\n\tpublic class JwtTokenHandler {\n\n\t\tprivate static final Log logger = LogFactory.getLog(JwtAuthenticationFilter.class);\n\n\t\tpublic static final String SECRET_PASSWORD = \"***\";\n\t\tpublic static final String CLAIM_KEY_USERNAME = \"sub\";\n\t\tpublic static final String CLAIM_KEY_AUTHORITIES = \"authorities\";\n\n\t\tprivate String secret;\n\n\t\tprivate Long expiration;\n\n\t\tpublic UserDetails getUserFromToken(final String token) {\n\t\t\tUserDetails user;\n\t\t\ttry {\n\t\t\t\tfinal Claims claims = getClaimsFromToken(token);\n\t\t\t\tfinal String userName = claims.get(CLAIM_KEY_USERNAME, String.class);\n\t\t\t\tfinal String authorityes = claims.get(CLAIM_KEY_AUTHORITIES, String.class);\n\n\t\t\t\tuser = buildUserDetails(userName, authorityes);\n\t\t\t} catch (final Exception e) {\n\t\t\t\tlogger.error(\"Error getting user from token. Token is invalid?\", e);\n\t\t\t\tuser = null;\n\t\t\t}\n\t\t\treturn user;\n\t\t}\n\n\t\tpublic String getUsernameFromToken(final String token) {\n\t\t\tString username;\n\t\t\ttry {\n\t\t\t\tfinal Claims claims = getClaimsFromToken(token);\n\t\t\t\tusername = claims.getSubject();\n\t\t\t} catch (final Exception e) {\n\t\t\t\tlogger.error(\"Error getting userName from token. Token is invalid?\", e);\n\t\t\t\tusername = null;\n\t\t\t}\n\t\t\treturn username;\n\t\t}\n\n\t\tpublic Date getExpirationDateFromToken(final String token) {\n\t\t\tDate expiration;\n\t\t\ttry {\n\t\t\t\tfinal Claims claims = getClaimsFromToken(token);\n\t\t\t\texpiration = claims.getExpiration();\n\t\t\t} catch (final Exception e) {\n\t\t\t\tlogger.error(\"Error getting expiration date from token. Token is invalid?\", e);\n\t\t\t\texpiration = null;\n\t\t\t}\n\t\t\treturn expiration;\n\t\t}\n\n\t\tpublic String generateToken(final UserDetails userDetails) {\n\t\t\tfinal Map<String, Object> claims = new HashMap<>();\n\t\t\tclaims.put(CLAIM_KEY_USERNAME, userDetails.getUsername());\n\t\t\tclaims.put(CLAIM_KEY_AUTHORITIES, StringUtils.join(userDetails.getAuthorities(), ','));\n\t\t\treturn generateToken(claims);\n\t\t}\n\n\t\tpublic String generateToken(final Map<String, Object> claims) {\n\t\t\treturn Jwts.builder().setClaims(claims).setExpiration(generateExpirationDate()).signWith(SignatureAlgorithm.HS512, secret).compact();\n\t\t}\n\n\t\tpublic Boolean canTokenBeRefreshed(final String token) {\n\t\t\treturn !isTokenExpired(token) || ignoreTokenExpiration();\n\t\t}\n\n\t\tpublic String refreshToken(final String token) {\n\t\t\tString refreshedToken;\n\t\t\ttry {\n\t\t\t\tfinal Claims claims = getClaimsFromToken(token);\n\t\t\t\trefreshedToken = generateToken(claims);\n\t\t\t} catch (final Exception e) {\n\t\t\t\tlogger.error(\"Error refreshing token. Token is invalid?\", e);\n\t\t\t\trefreshedToken = null;\n\t\t\t}\n\t\t\treturn refreshedToken;\n\t\t}\n\n\t\tpublic Boolean validateToken(final String token) {\n\t\t\treturn !isTokenExpired(token);\n\t\t}\n\n\t\tprotected Boolean ignoreTokenExpiration() {\n\t\t\treturn false;\n\t\t}\n\n\t\tprivate Claims getClaimsFromToken(final String token) {\n\t\t\tClaims claims;\n\t\t\ttry {\n\t\t\t\tclaims = Jwts.parser().setSigningKey(secret).parseClaimsJws(token).getBody();\n\t\t\t} catch (final Exception e) {\n\t\t\t\tlogger.error(\"Error getting claimsfrom token. Token is invalid?\", e);\n\t\t\t\tclaims = null;\n\t\t\t}\n\t\t\treturn claims;\n\t\t}\n\n\t\tprivate Date generateExpirationDate() {\n\t\t\treturn new Date(System.currentTimeMillis() + expiration * 1000);\n\t\t}\n\n\t\tprivate Boolean isTokenExpired(final String token) {\n\t\t\tfinal Date expiration = getExpirationDateFromToken(token);\n\t\t\treturn expiration.before(new Date());\n\t\t}\n\n\t\tprivate UserDetails buildUserDetails(final String userName, final String authorityes) {\n\t\t\treturn new User(userName, SECRET_PASSWORD,\n\t\t\t\t\tStringUtils.isEmpty(authorityes) ? AuthorityUtils.NO_AUTHORITIES : AuthorityUtils.commaSeparatedStringToAuthorityList(authorityes));\n\t\t}\n\n\t\t@PostConstruct\n\t\tprivate void assertAfterPropertySet() {\n\t\t\tAssert.hasLength(secret, \"Secret (jwt.secret property) for JWT must not be null or empty!\");\n\t\t\tAssert.notNull(expiration, \"expiration (jwt.expiration property) for JWT must not be null!\");\n\t\t\tAssert.state(expiration > 0, \"expiration (jwt.expiration property) for JWT must not be less than 0!\");\n\n\t\t}\n\n\t\tpublic String getSecret() {\n\t\t\treturn secret;\n\t\t}\n\n\t\tpublic void setSecret(final String secret) {\n\t\t\tthis.secret = secret;\n\t\t}\n\n\t\tpublic Long getExpiration() {\n\t\t\treturn expiration;\n\t\t}\n\n\t\tpublic void setExpiration(final Long expiration) {\n\t\t\tthis.expiration = expiration;\n\t\t}\n\n\t}\n\n#### Entrypoint\n\nHem de generar la classe que indicarem a la configuració com a punt d'entrada de l'autenticació:\n\nAl path *src/main/java/cata/gencat/canigorest311/security/authentication/entrypoint* generem la classe **RestAuthenticationEntrypoint.java**\n\n\tpackage cat.gencat.canigorest311.security.authentication.entrypoint;\n\n\timport java.io.IOException;\n\timport java.io.PrintWriter;\n\n\timport javax.servlet.http.HttpServletRequest;\n\timport javax.servlet.http.HttpServletResponse;\n\n\timport org.springframework.http.MediaType;\n\timport org.springframework.security.core.AuthenticationException;\n\timport org.springframework.security.web.AuthenticationEntryPoint;\n\timport org.springframework.stereotype.Component;\n\n\timport com.fasterxml.jackson.core.JsonProcessingException;\n\timport com.fasterxml.jackson.databind.ObjectMapper;\n\n\timport cat.gencat.canigorest311.security.authentication.response.ResponseRestError;\n\n\t@Component(\"restAuthenticationEntryPoint\")\n\tpublic class RestAuthenticationEntryPoint implements AuthenticationEntryPoint {\n\n\t\t@Override\n\t\tpublic void commence(final HttpServletRequest request, final HttpServletResponse response, final AuthenticationException authException) throws IOException {\n\t\t\t// This is invoked when user tries to access a secured REST resource without supplying any credentials\n\t\t\t// We should just send a 401 Unauthorized response because there is no 'login page' to redirect to\n\t\t\tfinal ResponseRestError error = new ResponseRestError(HttpServletResponse.SC_UNAUTHORIZED, \"401. Unauthorized\");\n\t\t\tbuilJsonResponse(response, error);\n\t\t}\n\n\t\tprivate void builJsonResponse(final HttpServletResponse response, final ResponseRestError error) throws JsonProcessingException, IOException {\n\t\t\tresponse.setStatus(HttpServletResponse.SC_UNAUTHORIZED);\n\t\t\tresponse.setContentType(MediaType.APPLICATION_JSON.toString());\n\n\t\t\tfinal ObjectMapper mapper = new ObjectMapper();\n\t\t\tfinal String json = mapper.writeValueAsString(error);\n\t\t\tfinal PrintWriter writer = response.getWriter();\n\t\t\twriter.write(json);\n\t\t\twriter.flush();\n\t\t\twriter.close();\n\t\t}\n\t}\n\t\n#### Controlador de l'autenticació\n\nA l'exemple hem generat un controlador REST (/auth) com a servei que hauria de cridar el login.\n\nAl path *src/main/java/cata/gencat/canigorest311/security/authentication/controller* generem la classe **AuthController.java**\n\n\tpackage cat.gencat.canigorest311.security.authentication.controller;\n\n\timport javax.servlet.http.HttpServletRequest;\n\timport javax.servlet.http.HttpServletResponse;\n\n\timport org.springframework.beans.factory.annotation.Autowired;\n\timport org.springframework.beans.factory.annotation.Qualifier;\n\timport org.springframework.http.MediaType;\n\timport org.springframework.security.core.Authentication;\n\timport org.springframework.security.core.userdetails.User;\n\timport org.springframework.web.bind.annotation.RequestBody;\n\timport org.springframework.web.bind.annotation.RequestMapping;\n\timport org.springframework.web.bind.annotation.RequestMethod;\n\timport org.springframework.web.bind.annotation.RestController;\n\n\timport cat.gencat.canigorest311.security.authentication.dto.AuthenticationRequestDto;\n\timport cat.gencat.canigorest311.security.authentication.dto.JwtAuthenticationResponseDto;\n\timport cat.gencat.canigorest311.security.authentication.jwt.JwtTokenHandler;\n\timport cat.gencat.canigorest311.security.authentication.service.AuthenticationService;\n\timport cat.gencat.canigorest311.security.authentication.service.impl.DefaultAuthenticationService;\n\n\t@RestController\n\tpublic class AuthController {\n\n\t\t@Autowired(required = false)\n\t\t@Qualifier(\"jwtAuthenticationService\")\n\t\tprivate AuthenticationService jwtAuthenticationService;\n\n\t\t@Autowired(required = false)\n\t\tprivate JwtTokenHandler jwtTokenHandler;\n\n\t\t@RequestMapping(value = \"/auth\", produces = MediaType.APPLICATION_JSON_VALUE, method = RequestMethod.POST)\n\t\tpublic JwtAuthenticationResponseDto getAuthToken(final HttpServletRequest request, final HttpServletResponse response,\n\t\t\t\t@RequestBody(required = false) final AuthenticationRequestDto jwtAuthenticationRequestDto) {\n\n\t\t\tif (jwtAuthenticationRequestDto != null) {\n\t\t\t\trequest.setAttribute(DefaultAuthenticationService.SPRING_SECURITY_FORM_USERNAME_KEY, jwtAuthenticationRequestDto.getUsername());\n\t\t\t\trequest.setAttribute(DefaultAuthenticationService.SPRING_SECURITY_FORM_PASSWORD_KEY, jwtAuthenticationRequestDto.getPassword());\n\n\t\t\t}\n\t\t\tfinal Authentication authentication = jwtAuthenticationService.authenticate(request, response);\n\t\t\tfinal String token = jwtTokenHandler.generateToken((User) authentication.getPrincipal());\n\n\t\t\treturn new JwtAuthenticationResponseDto(token);\n\n\t\t}\n\n\t}\n\t\n#### Autenticació\n\nEn aquest exemple només hem implementat el provider de l'autenticació per defecte (DefaultAuthenticationService). Si l'aplicació estiguès protegida per un altre provider, com per exemple GICAR, s'hauria d'implementar un GicarAuthenticationService per a realitzar l'autenticació per GICAR.\n\nAl path *src/main/java/cata/gencat/canigorest311/security/authentication/service*\n\n**AuthenticationService.java**\n\n\tpackage cat.gencat.canigorest311.security.authentication.service;\n\n\timport javax.servlet.http.HttpServletRequest;\n\timport javax.servlet.http.HttpServletResponse;\n\n\timport org.springframework.security.core.Authentication;\n\n\tpublic interface AuthenticationService {\n\t\tAuthentication authenticate(final HttpServletRequest request, final HttpServletResponse response);\n\n\t\tboolean isAuthRequest(HttpServletRequest request);\n}\n\nAl path *src/main/java/cata/gencat/canigorest311/security/authentication/service/impl*\n\n**DefaultAuthenticationService.java**\n\n\tpackage cat.gencat.canigorest311.security.authentication.service.impl;\n\n\timport javax.servlet.http.HttpServletRequest;\n\timport javax.servlet.http.HttpServletResponse;\n\n\timport org.apache.commons.lang3.StringUtils;\n\timport org.springframework.beans.factory.annotation.Autowired;\n\timport org.springframework.context.annotation.Lazy;\n\timport org.springframework.security.authentication.AuthenticationManager;\n\timport org.springframework.security.authentication.UsernamePasswordAuthenticationToken;\n\timport org.springframework.security.core.Authentication;\n\timport org.springframework.stereotype.Component;\n\n\timport cat.gencat.canigorest311.security.authentication.service.AuthenticationService;\n\n\t@Component(\"defaultAuthenticationService\")\n\tpublic class DefaultAuthenticationService implements AuthenticationService {\n\n\t\tpublic static final String SPRING_SECURITY_FORM_USERNAME_KEY = \"username\";\n\t\tpublic static final String SPRING_SECURITY_FORM_PASSWORD_KEY = \"password\";\n\n\t\tprivate String usernameParameter = SPRING_SECURITY_FORM_USERNAME_KEY;\n\t\tprivate String passwordParameter = SPRING_SECURITY_FORM_PASSWORD_KEY;\n\n\t\t@Autowired\n\t\t@Lazy\n\t\tprivate AuthenticationManager authenticationManager;\n\n\t\t@Override\n\t\tpublic Authentication authenticate(final HttpServletRequest request, final HttpServletResponse response) {\n\t\t\tfinal String username = obtainUsername(request);\n\t\t\tfinal String password = obtainPassword(request);\n\n\t\t\tfinal UsernamePasswordAuthenticationToken authRequest = new UsernamePasswordAuthenticationToken(username, password);\n\n\t\t\treturn authenticationManager.authenticate(authRequest);\n\t\t}\n\n\t\tprotected String obtainUsername(final HttpServletRequest request) {\n\t\t\tfinal String username = request.getParameter(usernameParameter);\n\t\t\treturn StringUtils.isEmpty(username) ? \"\" : username.trim();\n\t\t}\n\n\t\tprotected String obtainPassword(final HttpServletRequest request) {\n\t\t\tfinal String password = request.getParameter(passwordParameter);\n\t\t\treturn StringUtils.isEmpty(password) ? \"\" : password;\n\t\t}\n\n\t\t@Override\n\t\tpublic boolean isAuthRequest(final HttpServletRequest request) {\n\t\t\treturn !StringUtils.isEmpty(obtainUsername(request)) && !StringUtils.isEmpty(obtainPassword(request));\n\t\t}\n\n\t}\n\n**JwtAuthenticationService.java**\n\n\tpackage cat.gencat.canigorest311.security.authentication.service.impl;\n\n\timport javax.annotation.PostConstruct;\n\timport javax.servlet.http.HttpServletRequest;\n\timport javax.servlet.http.HttpServletResponse;\n\n\timport org.apache.commons.lang3.StringUtils;\n\timport org.apache.commons.logging.Log;\n\timport org.apache.commons.logging.LogFactory;\n\timport org.springframework.beans.factory.annotation.Autowired;\n\timport org.springframework.beans.factory.annotation.Qualifier;\n\timport org.springframework.context.annotation.Lazy;\n\timport org.springframework.security.authentication.AbstractAuthenticationToken;\n\timport org.springframework.security.core.Authentication;\n\timport org.springframework.security.core.context.SecurityContextHolder;\n\timport org.springframework.security.core.userdetails.User;\n\timport org.springframework.security.web.authentication.WebAuthenticationDetailsSource;\n\n\timport cat.gencat.canigorest311.security.authentication.jwt.JwtAuthenticationFilter;\n\timport cat.gencat.canigorest311.security.authentication.jwt.JwtTokenHandler;\n\timport cat.gencat.canigorest311.security.authentication.service.AuthenticationService;\n\timport io.jsonwebtoken.lang.Assert;\n\n\tpublic class JwtAuthenticationService implements AuthenticationService {\n\n\t\tprivate static final Log logger = LogFactory.getLog(JwtAuthenticationFilter.class);\n\n\t\tprivate String headerAuthName;\n\n\t\tprivate String tokenResponseHeaderName;\n\n\t\t@Autowired\n\t\t@Lazy\n\t\tprivate JwtTokenHandler jwtTokenHandler;\n\n\t\t@Autowired\n\t\t@Qualifier(\"defaultAuthenticationService\")\n\t\t@Lazy\n\t\tprivate AuthenticationService defaultAuthenticationService;\n\n\t\t@Override\n\t\tpublic Authentication authenticate(final HttpServletRequest request, final HttpServletResponse response) {\n\t\t\tlogger.info(\"try Authenticate whith credentials.\");\n\t\t\tfinal Authentication authentication = defaultAuthenticationService.authenticate(request, response);\n\t\t\t((AbstractAuthenticationToken) authentication).setDetails(new WebAuthenticationDetailsSource().buildDetails(request));\n\t\t\tSecurityContextHolder.getContext().setAuthentication(authentication);\n\t\t\tresponse.setHeader(tokenResponseHeaderName, jwtTokenHandler.generateToken((User) authentication.getPrincipal()));\n\t\t\tlogger.info(\"setting JWT token to response header. Authenticate user in Spring context.\");\n\t\t\treturn authentication;\n\t\t}\n\n\t\t@Override\n\t\tpublic boolean isAuthRequest(final HttpServletRequest request) {\n\t\t\treturn (defaultAuthenticationService.isAuthRequest(request))\n\t\t\t\t\t|| !StringUtils.isEmpty(request.getHeader(headerAuthName));\n\t\t}\n\n\t\tpublic String getHeaderAuthName() {\n\t\t\treturn headerAuthName;\n\t\t}\n\n\t\tpublic void setHeaderAuthName(final String headerAuthName) {\n\t\t\tthis.headerAuthName = headerAuthName;\n\t\t}\n\n\t\tpublic String getTokenResponseHeaderName() {\n\t\t\treturn tokenResponseHeaderName;\n\t\t}\n\n\t\tpublic void setTokenResponseHeaderName(final String tokenResponseHeaderName) {\n\t\t\tthis.tokenResponseHeaderName = tokenResponseHeaderName;\n\t\t}\n\n\t\tpublic JwtTokenHandler getJwtTokenHandler() {\n\t\t\treturn jwtTokenHandler;\n\t\t}\n\n\t\tpublic void setJwtTokenHandler(final JwtTokenHandler jwtTokenHandler) {\n\t\t\tthis.jwtTokenHandler = jwtTokenHandler;\n\t\t}\n\n\t\tpublic AuthenticationService getDefaultAuthenticationService() {\n\t\t\treturn defaultAuthenticationService;\n\t\t}\n\n\t\tpublic void setDefaultAuthenticationService(final AuthenticationService defaultAuthenticationService) {\n\t\t\tthis.defaultAuthenticationService = defaultAuthenticationService;\n\t\t}\n\n\t\t@PostConstruct\n\t\tpublic void checkProperties() {\n\t\t\tAssert.hasLength(headerAuthName, \"headerAuthName can't be null or empty!\");\n\t\t\tAssert.hasLength(tokenResponseHeaderName, \"tokenResponseHeaderName can't be null or empty!\");\n\t\t}\n\n\t}\n\n#### Filtre Autenticació\n\nS'ha de crear un nou filtre per a comprovar a les url protegides si l'usuari es troba autenticat, o en cas contrari intentar l'autenticació.\n\nAl path *src/main/java/cata/gencat/canigorest311/security/authentication/jwt* generem la classe **JwtAuthenticationFilter.java**\n\n\tpackage cat.gencat.canigorest311.security.authentication.jwt;\n\n\timport java.io.IOException;\n\n\timport javax.annotation.PostConstruct;\n\timport javax.servlet.FilterChain;\n\timport javax.servlet.ServletException;\n\timport javax.servlet.http.HttpServletRequest;\n\timport javax.servlet.http.HttpServletResponse;\n\n\timport org.apache.commons.logging.Log;\n\timport org.apache.commons.logging.LogFactory;\n\timport org.springframework.beans.factory.annotation.Autowired;\n\timport org.springframework.beans.factory.annotation.Qualifier;\n\timport org.springframework.security.authentication.UsernamePasswordAuthenticationToken;\n\timport org.springframework.security.core.Authentication;\n\timport org.springframework.security.core.context.SecurityContextHolder;\n\timport org.springframework.security.core.userdetails.User;\n\timport org.springframework.security.web.authentication.WebAuthenticationDetailsSource;\n\timport org.springframework.web.filter.OncePerRequestFilter;\n\n\timport cat.gencat.canigorest311.security.authentication.service.AuthenticationService;\n\timport io.jsonwebtoken.lang.Assert;\n\n\tpublic class JwtAuthenticationFilter extends OncePerRequestFilter {\n\n\t\tprivate static final Log logger = LogFactory.getLog(JwtAuthenticationFilter.class);\n\n\t\tprivate String headerAuthName;\n\n\t\tprivate String startToken;\n\n\t\tprivate String tokenResponseHeaderName;\n\n\t\t@Autowired\n\t\tprivate JwtTokenHandler jwtTokenHandler;\n\n\t\t@Autowired\n\t\t@Qualifier(\"jwtAuthenticationService\")\n\t\tprivate AuthenticationService jwtAuthenticationService;\n\n\t\t@Override\n\t\tprotected void doFilterInternal(final HttpServletRequest request, final HttpServletResponse response, final FilterChain chain)\n\t\t\t\tthrows ServletException, IOException {\n\n\t\t\tif (requireDoFilter(request)) {\n\n\t\t\t\tfinal String header = request.getHeader(headerAuthName);\n\n\t\t\t\tif (header != null && header.startsWith(startToken)) {\n\n\t\t\t\t\tfinal String authToken = header.substring(7);\n\t\t\t\t\tfinal User user = (User) jwtTokenHandler.getUserFromToken(authToken);\n\n\t\t\t\t\tfinal Authentication authenticationSecurity = SecurityContextHolder.getContext().getAuthentication();\n\t\t\t\t\tif (authenticationSecurity == null) {\n\t\t\t\t\t\tif (user != null && jwtTokenHandler.validateToken(authToken)) {\n\t\t\t\t\t\t\tlogger.info(\"token is valid, the user is autheticate correctly! setter response jwtToken\");\n\t\t\t\t\t\t\tfinal UsernamePasswordAuthenticationToken authentication = new UsernamePasswordAuthenticationToken(user, null, user.getAuthorities());\n\t\t\t\t\t\t\tauthentication.setDetails(new WebAuthenticationDetailsSource().buildDetails(request));\n\t\t\t\t\t\t\tSecurityContextHolder.getContext().setAuthentication(authentication);\n\t\t\t\t\t\t\tresponse.setHeader(tokenResponseHeaderName,\n\t\t\t\t\t\t\t\t\tjwtTokenHandler.canTokenBeRefreshed(authToken) ? jwtTokenHandler.refreshToken(authToken) : authToken);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tlogger.info(\"token is invalid or missing!\");\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlogger.info(\"The user was previous authenticate!\");\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\tlogger.info(\"attemp to default authentication: call --> wtAuthenticationService.authenticate\");\n\t\t\t\t\tjwtAuthenticationService.authenticate(request, response);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlogger.info(\"The request:\" + request.getPathInfo() + \" has not info for authentication.\");\n\t\t\t}\n\n\t\t\tchain.doFilter(request, response);\n\n\t\t}\n\n\t\tpublic String getHeaderAuthName() {\n\t\t\treturn headerAuthName;\n\t\t}\n\n\t\tpublic void setHeaderAuthName(final String headerAuthName) {\n\t\t\tthis.headerAuthName = headerAuthName;\n\t\t}\n\n\t\tpublic String getStartToken() {\n\t\t\treturn startToken;\n\t\t}\n\n\t\tpublic void setStartToken(final String startToken) {\n\t\t\tthis.startToken = startToken;\n\t\t}\n\n\t\tpublic String getTokenResponseHeaderName() {\n\t\t\treturn tokenResponseHeaderName;\n\t\t}\n\n\t\tpublic void setTokenResponseHeaderName(final String tokenResponseHeaderName) {\n\t\t\tthis.tokenResponseHeaderName = tokenResponseHeaderName;\n\t\t}\n\n\t\tpublic JwtTokenHandler getJwtTokenHandler() {\n\t\t\treturn jwtTokenHandler;\n\t\t}\n\n\t\tpublic void setJwtTokenHandler(final JwtTokenHandler jwtTokenHandler) {\n\t\t\tthis.jwtTokenHandler = jwtTokenHandler;\n\t\t}\n\n\t\tpublic AuthenticationService getJwtAuthenticationService() {\n\t\t\treturn jwtAuthenticationService;\n\t\t}\n\n\t\tpublic void setJwtAuthenticationService(final AuthenticationService jwtAuthenticationService) {\n\t\t\tthis.jwtAuthenticationService = jwtAuthenticationService;\n\t\t}\n\n\t\t@PostConstruct\n\t\tpublic void checkProperties() {\n\t\t\tAssert.hasLength(startToken, \"startToken can't be null!\");\n\t\t\tAssert.hasLength(headerAuthName, \"headerAuthName can't be null or empty!\");\n\t\t\tAssert.hasLength(tokenResponseHeaderName, \"tokenResponseHeaderName can't be null or empty!\");\n\t\t}\n\n\t\tprivate boolean requireDoFilter(final HttpServletRequest request) {\n\t\t\treturn !isLoginRequest(request) && jwtAuthenticationService.isAuthRequest(request);\n\n\t\t}\n\n\t\tprivate boolean isLoginRequest(final HttpServletRequest request) {\n\t\t\treturn request.getPathInfo() != null && request.getPathInfo().endsWith(\"/auth\");\n\t\t}\n\n\t}\n\t\n### Configuració Seguretat a Spring\n\nPer a utilitzar les classes que hem creat als punts anteriors, hem de realitzar la configuració de Spring Security al fitxer **app-custom-security.xml**\n\nEn aquest fitxer hem de fer que Spring tingui en compte el controlador creat:\n\n\t<context:component-scan base-package=\"cat.gencat.canigorest311.security\" />\n\t\nDeclarar els beans de les noves classes creades:\n\n\t<bean name=\"jwtAuthenticationService\" id=\"jwtAuthenticationService\" class=\"cat.gencat.canigorest311.security.authentication.service.impl.JwtAuthenticationService\">\n\t\t<property name=\"tokenResponseHeaderName\" value=\"${jwt.tokenResponseHeaderName:jwtToken}\" />\n\t\t<property name=\"headerAuthName\" value=\"${jwt.header:Authentication}\" />\n\t</bean>\n\t\n\t<bean name=\"jwtAuthenticationFilter\" id=\"jwtAuthenticationFilter\" class=\"cat.gencat.canigorest311.security.authentication.jwt.JwtAuthenticationFilter\">\n\t\t<property name=\"startToken\" value=\"${jwt.header.startToken:Bearer}\" />\n\t\t<property name=\"tokenResponseHeaderName\" value=\"${jwt.tokenResponseHeaderName:jwtToken}\" />\n\t\t<property name=\"headerAuthName\" value=\"${jwt.header:Authentication}\" />\n\t</bean>\n\t\n\t<bean name=\"jwtTokenHandler\" id=\"jwtTokenHandler\" class=\"cat.gencat.canigorest311.security.authentication.jwt.JwtTokenHandler\">\n\t\t<property name=\"expiration\"\tvalue=\"${jwt.expiration:3600L}\" />\n\t\t<property name=\"secret\"\tvalue=\"${jwt.secret:canigo}\" />\n\t</bean>\n\t\nDeclarar el punt d'entrada de la seguretat:\n\n\t<security:http use-expressions=\"true\" create-session=\"stateless\" entry-point-ref=\"restAuthenticationEntryPoint\">\n\t\nDeclarar el filtre JWT:\n\n\t<security:custom-filter ref=\"jwtAuthenticationFilter\" before=\"PRE_AUTH_FILTER\" />\n\t\nAmb aquests canvis el fitxer quedaria de la següent manera:\n\n\t<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n\t<beans  xmlns=\"http://www.springframework.org/schema/beans\"\n\t\t\txmlns:security=\"http://www.springframework.org/schema/security\"\n\t\t\txmlns:context=\"http://www.springframework.org/schema/context\"\n\t\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:jdbc=\"http://www.springframework.org/schema/jdbc\"\n\t\t\txsi:schemaLocation=\"http://www.springframework.org/schema/beans \thttp://www.springframework.org/schema/beans/spring-beans-4.1.xsd\n\t\t\t\t\t\t\t\thttp://www.springframework.org/schema/context \thttp://www.springframework.org/schema/context/spring-context-4.1.xsd\n\t\t\t\t\t\t\t\thttp://www.springframework.org/schema/security \thttp://www.springframework.org/schema/security/spring-security-3.2.xsd\n\t\t\t\t\t\t\t\thttp://www.springframework.org/schema/jdbc \t\thttp://www.springframework.org/schema/jdbc/spring-jdbc-4.1.xs\">\n\n\t\t<context:component-scan base-package=\"cat.gencat.canigorest311.security\" />\n\n\t\t<bean name=\"jwtAuthenticationService\" id=\"jwtAuthenticationService\" class=\"cat.gencat.canigorest311.security.authentication.service.impl.JwtAuthenticationService\">\n\t\t\t<property name=\"tokenResponseHeaderName\" value=\"${jwt.tokenResponseHeaderName:jwtToken}\" />\n\t\t\t<property name=\"headerAuthName\" value=\"${jwt.header:Authentication}\" />\n\t\t</bean>\n\t\t\n\t\t<bean name=\"jwtAuthenticationFilter\" id=\"jwtAuthenticationFilter\" class=\"cat.gencat.canigorest311.security.authentication.jwt.JwtAuthenticationFilter\">\n\t\t\t<property name=\"startToken\" value=\"${jwt.header.startToken:Bearer}\" />\n\t\t\t<property name=\"tokenResponseHeaderName\" value=\"${jwt.tokenResponseHeaderName:jwtToken}\" />\n\t\t\t<property name=\"headerAuthName\" value=\"${jwt.header:Authentication}\" />\n\t\t</bean>\n\t\t\n\t\t<bean name=\"jwtTokenHandler\" id=\"jwtTokenHandler\" class=\"cat.gencat.canigorest311.security.authentication.jwt.JwtTokenHandler\">\n\t\t\t<property name=\"expiration\"\tvalue=\"${jwt.expiration:3600L}\" />\n\t\t\t<property name=\"secret\"\tvalue=\"${jwt.secret:canigo}\" />\n\t\t</bean>\n\n\t\t<security:http pattern=\"/css/**\" security=\"none\" />\n\t\t<security:http pattern=\"/images/**\" security=\"none\" />\n\t\t<security:http pattern=\"/js/**\" security=\"none\" />\n\n\t\t<!-- Secure patterns -->\n\t\t<security:http use-expressions=\"true\" create-session=\"stateless\" entry-point-ref=\"restAuthenticationEntryPoint\">\n\t\t\t<security:intercept-url pattern=\"/**\" access=\"permitAll\" method=\"OPTIONS\" />\n\t\t\t<security:intercept-url pattern=\"/api/equipaments/**\" access=\"hasRole('ROLE_ADMIN')\" method=\"DELETE\" />\n\t\t\t<security:intercept-url pattern=\"/api/equipaments/**\" access=\"hasRole('ROLE_ADMIN')\" method=\"GET\" />\n\t\t\t<security:intercept-url pattern=\"/api/equipaments/**\" access=\"hasRole('ROLE_ADMIN')\" method=\"PUT\" />\n\t\t\t<security:intercept-url pattern=\"/api/equipaments/**\" access=\"hasRole('ROLE_ADMIN')\" method=\"POST\" />\n\t\t\t<security:intercept-url pattern=\"/api/logs/**\" access=\"hasRole('ROLE_ADMIN')\" />\n\n\t\t\t<security:form-login login-processing-url=\"/j_spring_security_check\" login-page=\"/j_spring_security_check\" />\n\t\t\t<security:custom-filter ref=\"jwtAuthenticationFilter\" before=\"PRE_AUTH_FILTER\" />\n\t\t</security:http>\n\n\t\t<security:authentication-manager alias=\"authenticationManager\">\t\n\t\t\t<!-- BBDD -->\n\t\t\t<security:authentication-provider>\n\t\t\t\t<security:jdbc-user-service data-source-ref=\"dataSource\"/>\n\t\t\t</security:authentication-provider>\n\t\t\t\n\t\t</security:authentication-manager>\n\n\t</beans>\n\t\n### Resultat\n\nAmb aquesta configuració, la primera vegada que un usuari vol accedir a l'aplicació haurà de proporcionar l'usuari i password, i l'aplicació a la response retornarà un token:\n\n\tjwtToken:eyJhbGciOiJIUzUxMiJ9.eyJleHAiOjE0ODA2ODc0OTcsInN1YiI6ImFkbWluIiwiYXV0aG9yaXRpZXMiOiJST0xFX0FETUlOLFJPTEVfVVNFUiJ9.kmupP8B269D-SZemxkTdfdqYQ-vRMF3-nNtsWoi-bbDo5Wk38LbRYYf-sO3ceqZaYursfFIYyI0BR6keuko-4A\n\t\nA partir d'aquí, l'aplicació ha d'enviar aquest token a la capçalera de les següents peticions:\n\n\tNom: Authentication\n\tValor: Bearer + token\n\t\nExemple\n\n\tAuthentication: Bearer eyJhbGciOiJIUzUxMiJ9.eyJleHAiOjE0ODA2ODc0OTcsInN1YiI6ImFkbWluIiwiYXV0aG9yaXRpZXMiOiJST0xFX0FETUlOLFJPTEVfVVNFUiJ9.kmupP8B269D-SZemxkTdfdqYQ-vRMF3-nNtsWoi-bbDo5Wk38LbRYYf-sO3ceqZaYursfFIYyI0BR6keuko-4A\n","objectID":"L2hvd3Rvcy8yMDE2LTExLUhvd3RvLUNhbmlnby1KV1Q="},"L2hvd3Rvcy8yMDE3LTA2LUhvd3RvLURlc3BsZWdhcl9hcGxpY2FjaW9fY2FuaWdvMzJfd2Vic3BoZXJl":{"date":1496275200000,"title":"Desplegar una aplicació Canigó 3.2 a Websphere 8.5.5","description":"Desplegar una aplicació Canigó 3.2 a Websphere 8.5.5","section":"howtos","categories":["canigo"],"key":"JUNY2017","path":"/howtos/2017-06-Howto-Desplegar_aplicacio_canigo32_websphere","content":"### A qui va dirigit\n\nAquest how-to va dirigit a tots aquells desenvolupadors que vulguin desplegar una aplicació Canigó 3.2 en un servidor d'aplicacions IBM Websphere 8.5.5\n\n### Introducció\n\nCanigó 3.2 incorpora JPA 2.1 i Hibernate 5.0 com a proveïdor. IBM Wesphere 8.5.5 només dóna suport a JPA 2.0 incloent com a proveïdor OpenJPA 2.4. Degut a aquesta incompatibilitat, s'han de realitzar certes modificacions a les aplicacions Canigó per a poder ser desplegades a WebSphere 8.5.5.\n\nEn aquest HowTo es parteix de l'aplicació plantilla de Canigó que genera el [plugin d'Eclipse] (/canigo-download-related/plugin-canigo/).\n\n### Modificar el pom.xml\n\nS'ha de realitzar l'exclusió al mòdul de Spring Boot de **spring-boot-starter-tomcat**:\n\n\t<dependency>\n      <groupId>org.springframework.boot</groupId>\n      <artifactId>spring-boot-starter-web</artifactId>\n      <exclusions>\n        <exclusion>\n          <artifactId>spring-boot-starter-logging</artifactId>\n          <groupId>org.springframework.boot</groupId>\n        </exclusion>\n        <exclusion>\n          <artifactId>spring-boot-starter-tomcat</artifactId>\n          <groupId>org.springframework.boot</groupId>\n        </exclusion>\n      </exclusions>\n    </dependency>\n\nS'ha de realitzar l'exclusió de la llibreria **xml-apis** del mòdul spring-boot-starter-data-jpa:\n\n    <dependency>\n      <groupId>org.springframework.boot</groupId>\n      <artifactId>spring-boot-starter-data-jpa</artifactId>\n      <exclusions>\n        <exclusion>\n          <artifactId>spring-boot-starter-logging</artifactId>\n          <groupId>org.springframework.boot</groupId>\n        </exclusion>\n        <exclusion>\n          <artifactId>xml-apis</artifactId>\n          <groupId>xml-apis</groupId>\n        </exclusion>\n      </exclusions>\n    </dependency>\n\n### Implementació de PersistenceProviderResolver\n\nPer aconseguir que la nostra aplicació resolgui com a proveïdor de JPA HibernatePersistenceProvider, i no OpenJPA, hem d'implementar la nostra pròpia classe PersistenceProviderResolver. Un cop implementada, hem de fer que la nostra aplicació l'utilitzi registrant-la abans de realitzar la inicialització del mòdul de persistència.\n\nPer fer això hem creat el paquet \"cat.gencat.provawebsphere.websphere\" a l'aplicació i creat el fitxer HibernatePersistenceProviderResolver.java amb el següent codi:\n\n\tpackage cat.gencat.provawebsphere.websphere;\n\n\timport org.hibernate.jpa.HibernatePersistenceProvider;\n\timport org.slf4j.Logger;\n\timport org.slf4j.LoggerFactory;\n\n\timport javax.persistence.spi.PersistenceProvider;\n\timport javax.persistence.spi.PersistenceProviderResolver;\n\timport javax.persistence.spi.PersistenceProviderResolverHolder;\n\timport java.util.Collections;\n\timport java.util.List;\n\n\tpublic class HibernatePersistenceProviderResolver implements PersistenceProviderResolver {\n\t\t\n\t\t/** Logger  */  \n\t\tprivate static final Logger logger = LoggerFactory.getLogger(HibernatePersistenceProviderResolver.class);\n\t\t\n\t\tprivate volatile PersistenceProvider persistenceProvider = new HibernatePersistenceProvider();\n\n\t\t@Override\n\t\tpublic List<PersistenceProvider> getPersistenceProviders() {\n\t\t\treturn Collections.singletonList(persistenceProvider);\n\t\t}\n\n\t\t@Override\n\t\tpublic void clearCachedProviders() {\n\t\t\tpersistenceProvider = new HibernatePersistenceProvider();\n\t\t}\n\n\t\tpublic static void register() {\n\t\t\tlogger.debug(\"Registering HibernatePersistenceProviderResolver\");\n\t\t\tPersistenceProviderResolverHolder.setPersistenceProviderResolver(new HibernatePersistenceProviderResolver());\n\t\t}\n\t}\n\t\nPer assegurar que registrem el nostre proveïdor de JPA a l'inici de l'aplicació, abans de la creació de qualsevol altre bean de Spring, creem la classe PreInitializer amb el següent codi:\n\n\tpackage cat.gencat.provawebsphere.websphere;\n\n\timport org.springframework.beans.BeansException;\n\timport org.springframework.beans.factory.config.BeanFactoryPostProcessor;\n\timport org.springframework.beans.factory.config.ConfigurableListableBeanFactory;\n\timport org.springframework.core.Ordered;\n\timport org.springframework.core.PriorityOrdered;\n\n\t \n\tpublic class PreInitializer implements BeanFactoryPostProcessor, PriorityOrdered {  \n\t\t @Override  \n\t\t public int getOrder() {  \n\t\t  return Ordered.HIGHEST_PRECEDENCE;  \n\t\t }  \n\t\t @Override  \n\t\t public void postProcessBeanFactory(  \n\t\t   ConfigurableListableBeanFactory beanFactory) throws BeansException {  \n\t\t\t HibernatePersistenceProviderResolver.register();\n\t\t }  \n\t} \n\nAl fitxer \"Application.java\" hem de crear el bean per la classe PreInitializer per a que es faci el registre:\n\n\t@Bean\n    public PreInitializer preInitializer() {\n\t\treturn new PreInitializer();\n    }\n\n### Definició entitats a \"persistence.xml\"\n\nAl fitxer de persistència hem de definir totes les entitats que tingui l'aplicació. En la plantilla que utilitza aquest HowTo només hi ha l'entitat Equipament:\n\n<persistence xmlns=\"http://java.sun.com/xml/ns/persistence\"\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\txsi:schemaLocation=\"http://xmlns.jcp.org/xml/ns/persistence http://xmlns.jcp.org/xml/ns/persistence/persistence_2_1.xsd\"\n\tversion=\"1.0\">\n\n\t<persistence-unit name=\"canigo\" transaction-type=\"RESOURCE_LOCAL\">\n\t\t\t<class>cat.gencat.provawebsphere3.model.Equipament</class>  \n\t</persistence-unit>\n\n</persistence>\n\n### Configuració a WebSphere\n\nUna vegada configurada la nostra aplicació a la consola web d'administració de WebSphere, abans d'iniciar-la, seleccionar la nostra aplicació, anar a \"Cargador de clases\" i seleccionar els següents valors:\n\n**Clases cargadas con el cargador local primero (padre último)**\n\n**Cargador de clases único para la aplicación**\n\n![](/related/canigo/howto/imatges/20170501.jpg)\n\nSeguint aquestes instruccions l'aplicació plantilla de Canigó 3.2 haurà estat desplegada de forma satisfactòria a WebSphere 8.5.5.\n","objectID":"L2hvd3Rvcy8yMDE3LTA2LUhvd3RvLURlc3BsZWdhcl9hcGxpY2FjaW9fY2FuaWdvMzJfd2Vic3BoZXJl"},"L2hvd3Rvcy8yMDE3LTA4LUhvd3RvLVVzX2RlX21vbmdvX2NvbXBvc2VfYW1iX0phdmFCdWlsZHBhY2s=":{"date":1500854400000,"title":"Accés per SSL a cluster MongoDB (Compose) des de buildpack Java (Cloud Foundry)","description":"Accés per SSL a cluster MongoDB (Compose) des de buildpack Java (Cloud Foundry)","section":"howtos","categories":["cloud"],"key":"AGOST2017","path":"/howtos/2017-08-Howto-Us_de_mongo_compose_amb_JavaBuildpack","content":"### A qui va dirigit\r\n\r\nAquest how-to va dirigit a tots aquells que vulguin desplegar una aplicació Java a [Bluemix|https://console.bluemix.net/] com a app utilitzant el buildpack Cloud Foundry de Java, i necessiti accés a una base de dades MongoDB creada a [Compose|https://compose.io].\r\n\r\nLes configuracions explicades en aquest Howto pot aplicar-se a aplicacions Java i bases de dades MongoDB desplegades a altres plataformes, però s'ha certificat a Bluemix i Compose, plataformes cloud d'IBM.\r\n\r\n### Introducció\r\n\r\nQuan es crea un cluster MongoDB a Compose, la url de connexió que es genera conté el paràmetre **ssl=true**. Això significa que l'accés ha de realitzar-se per SSL. En cas que no es realitzi cap configuració, l'accés des d'una aplicació Java produïra el següent error:\r\n\r\n\tCaused by: javax.net.ssl.SSLHandshakeException: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification\r\n\t...\r\n\tCaused by: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target\r\n\t...\r\n\tCaused by: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target\r\n\t\r\nPer a solucionar-ho cal afegir el certificat que proporciona Compose al cacerts de Java. Aquest certificat s'haurà de sol·licitar a [suport.cloud@gencat.cat|mailto:suport.cloud@gencat.cat].\r\n\r\n### Afegir certificat a cacerts\r\n\r\nLa versió actual d'OpenJDK que utilitza el buildpack Java de Cloud Foundry, a Agost de 2017, és la versió 1.8.0_141, així que afegim el nostre certificat al cacerts inicial d'aquesta versió.\r\n\r\nPer descarregar [OpenJDK](https://github.com/ojdkbuild/ojdkbuild)\r\n\r\nS'ha d'anar a la ubicació on hem descomprimit la OpenJDK: <path_jdk>/jre/lib/security\r\n\r\nAmb el keytool importem el certificat generat al punt anterior (mongodbcert.crt):\r\n\r\n\tkeytool -importcert -keystore <path_cacerts> -file <path_mongodbcert.crt>\r\n\t\r\nEns demana el password, que és **changeit** i confirmació per importar el certificat, s'ha d'indicar **yes**\r\n\r\nAmb aquest procés disposem del nostre certificat afegit al cacerts, ara s'ha de substituir el cacerts original de java-buildpack amb el nostre\r\n\r\n### Extensió Java-Buildpack\r\n\r\nCrear al Git del SIC: https://git.intranet.gencat.cat/codidialeg/ un projecte buit, per exemple java-buildpack\r\n\r\nAleshores accedir al buildpack que es vol extendre, en aquest howto al github de [cloudfoundry] (https://github.com/cloudfoundry/java-buildpack) i fer un clone.\r\n\r\nAl clone realitzat, afegir el remote el nostre repositori creat i fer un push\r\n\r\nAquest pas ens crea una còpia del buildpack al Git del SIC: https://git.intranet.gencat.cat/mygroup/java-buildpack\r\n\r\nPer afegir el nostre cacerts ho hem de fer a **/resources/open_jdk_jre/lib/security/cacerts**. El path no existeix, l'hem d'afegir.\r\n\r\nUna vegada afegit el fitxer, realitzem el commit per a pujar els canvis al github i al manifest de la nostra aplicació en comptes de:\r\n\r\n\tbuildpack: https://github.com/cloudfoundry/java-buildpack.git\r\n\t\r\nHem de posar:\r\n\t\r\n\tbuildpack: https://git.intranet.gencat.cat/mygroup/java-buildpack.git\r\n\r\n","objectID":"L2hvd3Rvcy8yMDE3LTA4LUhvd3RvLVVzX2RlX21vbmdvX2NvbXBvc2VfYW1iX0phdmFCdWlsZHBhY2s="},"L2hvd3Rvcy8yMDE3LTEwLUhvd3RvLVVzX1NwcmluZ19DYWNoZV9DYW5pZ28=":{"date":1493596800000,"title":"Ús de Spring Cache (Caffeine) en Canigó 3.2.2","description":"Ús de Spring Cache (Caffeine) en Canigó 3.2.2","section":"howtos","categories":["canigo"],"key":"OCTUBRE2017","path":"/howtos/2017-10-Howto-Us_Spring_Cache_Canigo","content":"### A qui va dirigit\r\n\r\nAquest how-to va dirigit a tots aquells desenvolupadors/arquitectes que vulguin afegir Spring Cache a una aplicació Canigó 3.2.\r\n\r\n### Versió de Canigó\r\n\r\nEls passos descrits en aquest document apliquen a la versió 3.2.x del Framework Canigó.\r\n\r\n### Introducció\r\n\r\nEn aquest HowTo s’explica com afegir Spring Cache a una aplicació Canigó 3.2. \r\nPer a fer-ho es desplega l’aplicació demo que genera el plugin de Canigó, per a mostrar el funcionament de Spring Cache primer es fa una prova sense utilitzar la cache i després una altre utilitzant la cache. \r\n\r\nEn aquest primer exemple no se li especifica cap proveïdor específic de caching (caffeine, ehcache, etc.) de tal manera que l'exemple utilitzarà simplement ConcurrentHashMap.\r\n\r\nA una aplicació real es pot triar la implementació de caching que es desitgi, però es important utilitzar l'abstracció que proporciona [Spring Cache] (https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-caching.html#boot-features-caching) (estàndard JSR-107) ja que a banda de complir els estàndards no fixa una aplicació a un proveïdor de caching en concret i facilita en un futur qualsevol modificació.\r\n\r\nEn un segon exemple es mostra com utilitzar un proveïdor de caching, en aquest exemple [Caffeine] (https://github.com/ben-manes/caffeine) com llibreria de caching\r\n\r\n## Exemple Configuració Spring Cache\r\n\r\n### Afegir Llibreries\r\n\r\nS'ha d'afegir al pom.xml la dependència a Spring Cache\r\n\r\n    <!-- SPRING BATCH -->\r\n     <dependency>\r\n\t    <groupId>org.springframework.boot</groupId>\r\n\t    <artifactId>spring-boot-starter-cache</artifactId>\r\n\t\t<exclusions>\r\n\t\t\t<exclusion>\r\n\t\t\t\t<groupId>org.springframework.boot</groupId>\r\n\t\t\t\t<artifactId>spring-boot-starter-logging</artifactId>\r\n\t\t\t</exclusion>\r\n\t\t</exclusions>\r\n\t</dependency>\r\n\t\r\n### Exemple d'accés sense Cache\r\n\r\nA la classe **EquipamentService** es crea els mètodes *getById* i *simularLentitud*, aquest segon mètode es crea per a veure millor els efectes de l'ús de cache respecte a no utilitzar cache.\r\n\r\n\t private void simularLentitud() {\r\n        try {\r\n            long time = 3000L;\r\n            Thread.sleep(time);\r\n        } catch (InterruptedException e) {\r\n            throw new IllegalStateException(e);\r\n        }\r\n    }\r\n\t\r\nAquest mètode el que fa, es aturar el thread durant 3 segons.\r\n\r\n\tpublic Equipament getById(Long id) {\r\n\t\tsimularLentitud();\r\n        return getEquipament(id);\r\n\t}\r\n\r\nAmb aquest mètode obtenint un equipament segons el seu ID, però fem que la crida s'aturi 3 segons.\r\n\r\nAl nostre endpoint (**EquipamentServiceController**) afegim un mètode que realitzi múltiples crides al mètode getById.\r\n\r\n\t@GetMapping(value = \"/howto\", produces = { MediaType.APPLICATION_JSON_VALUE })\r\n\tpublic ResponsePage<String> howto() {\r\n\t\t\r\n\t\tlogger.info(\".... Obtenint equipaments\");\r\n        logger.info(\"Equipament-1 -->\" + equipamentService.getById(Long.valueOf(1)));\r\n        logger.info(\"Equipament-2 -->\" + equipamentService.getById(Long.valueOf(2)));\r\n        logger.info(\"Equipament-1 -->\" + equipamentService.getById(Long.valueOf(1)));\r\n        logger.info(\"Equipament-2 -->\" + equipamentService.getById(Long.valueOf(2)));\r\n        logger.info(\"Equipament-1 -->\" + equipamentService.getById(Long.valueOf(1)));\r\n        logger.info(\"Equipament-1 -->\" + equipamentService.getById(Long.valueOf(1)));\r\n\r\n\t\treturn null;\r\n\t}\r\n\t\r\nEl que fa aquest mètode és simplement cridar 6 vegades a getById, tres vegades demanant el ID 1, i 3 vegades demanant el ID 2.\r\n\r\nSi s'arrenca l'aplicació, es crida a /equipaments/howto i el resultat al log és:\r\n\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 10:11:59,720 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - .... Obtenint equipaments\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 10:12:07,184 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-1 -->Equipament [nom=estació autobusos]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 10:12:10,185 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-2 -->Equipament [nom=centre obert Alba]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 10:12:13,186 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-1 -->Equipament [nom=estació autobusos]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 10:12:16,186 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-2 -->Equipament [nom=centre obert Alba]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 10:12:19,186 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-1 -->Equipament [nom=estació autobusos]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 10:12:22,186 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-1 -->Equipament [nom=estació autobusos]\r\n\r\nTot i que l'aplicació serveix els mateixos objectes múltiples vegades triga 3 segons a servir cadascún (La simulació de lentitud que hem fet).\r\n\r\n### Exemple d'accés amb Cache\r\n\r\nPer a activar la cache, hem de crear una Cache on s'enmmagatzemarà els Equipaments, per fer això utilitzem l'anotació @Cacheable de Spring (org.springframework.cache.annotation.Cacheable)\r\n\r\nAl mètode que s'ha creat al punt anterior (getById) afegim l'anotació\r\n\r\n\t@Cacheable(\"equipaments\")\r\n\tpublic Equipament getById(Long id) {\r\n\t\tsimularLentitud();\r\n        return getEquipament(id);\r\n\t}\r\n\t\r\nAmb aquesta anotació s'indica que es crea la Cache \"equipaments\" on es guardaran els objectes retornats pel mètode getById.\r\n\r\nPer a que l'aplicació processi les anotacions de Caching hem d'afegir l'anotació @EnableCaching a la nostra classe Application.java\r\n\r\n\t@SpringBootApplication\r\n\t@EnableCaching\r\n\tpublic class Application extends SpringBootServletInitializer implements WebApplicationInitializer {\r\n\r\n\t\tpublic static void main(final String[] args) throws Exception {\r\n\t\t\tif (System.getProperty(\"entorn\") == null) {\r\n\t\t\t\tSystem.setProperty(\"entorn\", \"loc\");\r\n\t\t\t}\r\n\r\n\t\t\tSpringApplication.run(Application.class, args);\r\n\t\t}\r\n\t\t\r\nSi ara s'arrenca l'aplicació i es crida a /equipaments/howto i el resultat al log és:\r\n\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 10:51:55,145 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - .... Obtenint equipaments\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 10:51:58,179 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-1 -->Equipament [nom=estació autobusos]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 10:52:01,180 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-2 -->Equipament [nom=centre obert Alba]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 10:52:01,181 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-1 -->Equipament [nom=estació autobusos]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 10:52:01,182 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-2 -->Equipament [nom=centre obert Alba]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 10:52:01,182 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-1 -->Equipament [nom=estació autobusos]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 10:52:01,182 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-1 -->Equipament [nom=estació autobusos]\r\n\t\r\nAra es pot veure que les dos primeres crides trigen 3 segons ja que l'aplicació obté per primera vegada aquests Equipaments. Però per als 4 següents, entrega els objectes de manera immediata (sense entrar al mètode i per tant sense aturar-se els 3 segons que hem simulat).\r\n\r\nEs recomana utilitzar un dels proveïdors compatibles amb [Spring Cache] (https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-caching.html#_supported_cache_providers) ja que la configuració per defecte té evidents problemes com que l'objecte desat a Cache es manté indefinidament, amb els inconvenients que això comporta.\r\n\r\n## Ús de Caffeine\r\n\r\n### Prerequisits\r\n\r\nCaffeine només funciona con Java 1.8 o superior, per això s'ha de compilar la nostra aplicació amb Java 1.8 i utilitzar Java 1.8 en el seu desplegament. Al pom.xml\r\n\r\n\t<plugin>\r\n\t\t<groupId>org.apache.maven.plugins</groupId>\r\n\t\t<artifactId>maven-compiler-plugin</artifactId>\r\n\t\t<configuration>\r\n\t\t\t<source>1.8</source>\r\n\t\t\t<target>1.8</target>\r\n\t\t</configuration>\r\n\t</plugin>\r\n\r\n### Exemple\r\n\r\nS'ha d'afegir la dependència de Caffeine al pom.xml\r\n\r\n\t<dependency>\r\n\t\t<groupId>com.github.ben-manes.caffeine</groupId>\r\n\t\t<artifactId>caffeine</artifactId>\r\n\t</dependency>\r\n\r\nA **resources** es crea el fitxer application.properties per afegir les propietats de configuració de Caffeine\r\n\r\n\tspring.cache.cache-names: equipaments\r\n\tspring.cache.caffeine.spec: maximumSize=500, expireAfterWrite=30s\r\n\t\r\nEn aquesta configuració hem indicat que crea el directori de cache \"equipaments\", que té una mida màxima de 500 elements i que cada element es guarda fins a 30 segons després d'escriure's a la cache.\r\n\r\nSi ara s'arrenca l'aplicació i es crida a /equipaments/howto i el resultat al log és:\r\n\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 13:22:52,706 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - .... Obtenint equipaments\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 13:22:55,709 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-1 -->Equipament [nom=estació autobusos]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 13:22:58,710 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-2 -->Equipament [nom=centre obert Alba]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 13:22:58,710 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-1 -->Equipament [nom=estació autobusos]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 13:22:58,710 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-2 -->Equipament [nom=centre obert Alba]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 13:22:58,710 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-1 -->Equipament [nom=estació autobusos]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 13:22:58,710 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-1 -->Equipament [nom=estació autobusos]\r\n\r\nSi es torna a fer la crida abans que passin 30 segons:\r\n\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 13:23:09,510 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - .... Obtenint equipaments\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 13:23:09,511 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-1 -->Equipament [nom=estació autobusos]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 13:23:09,511 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-2 -->Equipament [nom=centre obert Alba]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 13:23:09,511 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-1 -->Equipament [nom=estació autobusos]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 13:23:09,511 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-2 -->Equipament [nom=centre obert Alba]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 13:23:09,511 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-1 -->Equipament [nom=estació autobusos]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 13:23:09,511 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-1 -->Equipament [nom=estació autobusos]\r\n\t\r\nEls objectes continuen entregant-se immediatament, però si es torna a fer la crida una vegada han passat 30 segons de la seva inserció:\r\n\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 13:23:52,326 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - .... Obtenint equipaments\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 13:23:55,329 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-1 -->Equipament [nom=estació autobusos]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 13:23:58,331 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-2 -->Equipament [nom=centre obert Alba]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 13:23:58,331 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-1 -->Equipament [nom=estació autobusos]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 13:23:58,331 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-2 -->Equipament [nom=centre obert Alba]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 13:23:58,331 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-1 -->Equipament [nom=estació autobusos]\r\n\t(howtoSpringCache) canigo Message: 09 10 2017 13:23:58,331 INFO cat.gencat.howtospringcache.endpoints.EquipamentServiceController - Equipament-1 -->Equipament [nom=estació autobusos]\r\n\t\r\nLes dues primeres crides tornen a trigar 3 segons, ja que a la Cache ja no hi són els objectes.\r\n","objectID":"L2hvd3Rvcy8yMDE3LTEwLUhvd3RvLVVzX1NwcmluZ19DYWNoZV9DYW5pZ28="},"L2hvd3Rvcy8yMDE3LTExLUhvd3RvLVVzX1NlcnZlaV9QZXJzaXN0ZW5jZV9DYW5pZ28=":{"date":1510272000000,"title":"Ús del Servei de Persistencia en Canigó 3.2","description":"Ús del Servei de Persistencia en Canigó 3.2","section":"howtos","categories":["canigo"],"key":"NOVEMBRE2017","path":"/howtos/2017-11-Howto-Us_Servei_Persistence_Canigo","content":"### A qui va dirigit\r\n\r\nAquest how-to va dirigit a tots aquells desenvolupadors/arquitectes que desenvolupin una aplicació Canigó 3.2.\r\n\r\n### Versió de Canigó\r\n\r\nEls passos descrits en aquest document apliquen a la versió 3.2.x del Framework Canigó.\r\n\r\n### Introducció\r\n\r\nEn aquest HowTo s'explica l'estructura del servei de persistència i com definir consultes utilitzant Spring Data y Query DSL.\r\n\r\nPer a fer-ho es desplega l'aplicació demo que genera el plugin de Canigó que per defecte ja incorpora el servei de persistència.\r\n\r\n### Estructura del Servei\r\n\r\nEl servei de persistència ofereix la classe GenericRepository que hereta de la classe de SpringData JpaRepository.\r\n\r\nAquest repository proporciona els mètodes bàsics per a la gestió d'una entitat:\r\n\r\n\tS save(S entity);\r\n\tOptional findById(ID primaryKey);\r\n\tIterable findAll();\r\n\tlong count();\r\n\tvoid delete(T entity);\r\n\tboolean existsById(ID primaryKey);\r\n\t...\r\n\r\nTambé proporciona mètodes per a realitzar la paginació i l'ordenació:\r\n\r\n\tIterable findAll(Sort sort);\r\n\tPage findAll(Pageable pageable);\r\n\r\nEl servei de persistència així mateix ofereix dos mètodes més:\r\n\r\n\tPage findAll(FactoryExpression factoryExpression, Predicate predicate, Pageable pageable);\r\n\tList bulkSave(Iterable entities);\r\n\r\nEl mètode **findAll** que es proporciona retorna tots els elements de l'entitat cercada, però mostrant el valor només dels camps desitjats.\r\n\r\nEl mètode **bulkSave** proporciona un mètode per a [realitzar inserts i updates de forma massiva.](/howtos/2017-04-Batch-inserts-updates-canigo32/)\r\n\r\nPer a utilitzar aquest Repository l'aplicació demo de Canigó proporciona la següent estructura per a l'entitat Equipament. És l'estructura que es recomana utilitzar per a les entitats pròpies de cada aplicació.\r\n\r\n#### EquipamentRepositoryCustom\r\n\r\nAquesta interfície és on definirem mètodes específics per a la nostra entitat que tinguem la necessitat d'implementar.\r\n\r\n#### EquipamentRepositoryImpl\r\n\r\nClasse que implementa els mètodes que hem declarat a EquipamentRepositoryCustom\r\n\r\n#### EquipamentRepository\r\n\r\nInterfície que hereta de GenericRepository (proporcionat pel servei de Persistència) i del nostre EquipamentRepositoryCustom. És l'objecte a què accedirà el nostre Servei (EquipamentService en aquest cas) per a realitzar les operacions desitjades.\r\n\r\n### Spring Data\r\n\r\nA banda de les operacions genèriques (count, delete, find, get) Spring Data proporciona la possibilitat de construir quèries de forma automàtica utilitzant el prefix **By** seguit del camp desitjat.\r\n\r\nAquestes quèries s'ha de definir com a mètode a la classe EquipamentRepository, ja que no hem de realitzar cap implementació a la nostra aplicació.\r\n\r\nPer exemple:\r\n\r\n\tpublic interface EquipamentRepository extends GenericRepository<Equipament, Long>, EquipamentRepositoryCustom {\r\n\r\n\t\tList findByNom(String nom);\r\n\t\tlong countByMunicipi(String municipi);\r\n\t\tlong deleteByMunicipi(String municipi);\r\n\t}\r\n\r\n\tfindByNom retorna la llista d'equipaments que tinguin el nom proporcionat.\r\n\tcountByMunicipi retorna el nombre d'equipaments amb el municipi proporcionat.\r\n\tdeleteByMunicipi retorna el nombre d'equipaments eliminats amb el municipi proporcionat.\r\n\r\nSpring Data també permet la utilització d'expressions com DISTINCT, permet la concatenació de camps al criteri de la query amb AND i OR , la ordenació dels resultats amb ASC o DESC i més funcionalitats.\r\n\r\nPer a més informació de la creació de quèries es pot consultar la documentació de [Spring Data] (https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.query-methods.query-creation)\r\n\r\n### Query DSL\r\n\r\nEl servei de persistència ofereix la integració de Query DSL amb Spring Data i proporciona els mètodes:\r\n\r\n\tT findOne(Predicate predicate); -> Retorna un element que compleixi el Predicate\r\n\tIterable findAll(Predicate predicate); -> Retorna tots els elements que compleixin el Predicate\r\n\tlong count(Predicate predicate); -> Retorna el nombre d'elements que compleixin el Predicate\r\n\tboolean exists(Predicate predicate); -> Retorna si hi ha algun element que compleixi el Predicate\r\n\r\nPer a facilitar la creació del Predicate el servei de persistència ofereix la classe **GenericPredicateBuilder**.\r\n\r\nAquesta classe suporta els següents operadors:\r\n\r\nOperador | Descripció\r\n--------- | --------\r\n> | major que\r\n>: | major o igual que\r\n< | menor que\r\n<> | diferent de\r\n: | igual que\r\n\r\nI permet afegir paràmetres de forma individual:\r\n\r\n\tpublic void addParam (String key, String operation, Object value)\r\n\r\nOn key és el nom del camp, operation és l'operador i value el valor a comparar.\r\n\r\nO de forma conjunta:\r\n\r\n\tpublic void populateSearchCriteria(String search)\r\n\r\nOn el valor de search ha de complir el patró **field1Operador1Valor1,field2Operador2Valor2,fieldNOperadorNValorN**\r\n\r\nUn exemple d'aquest ús es pot trobar al mètode findPaginated d'EquipamentService a la aplicació demo de Canigó:\r\n\r\n\tpublic Page findPaginated(final Integer page, final Integer rpp, final String sort, final String filter) {\r\n\r\n\t\tfinal GenericPredicateBuilder builder = new GenericPredicateBuilder(Equipament.class, \"equipament\");\r\n\r\n\t\tbuilder.populateSearchCriteria(filter);\r\n\r\n\t\tfinal Pageable pageable = new PageRequest(page - 1, rpp, getOrdenacio(sort));\r\n\r\n\t\treturn repository.findAll(builder.build(), pageable);\r\n\t}\r\n\r\nNo és obligatori utilitzar el GenericPredicateBuilder per a construir els predicates. El servei de persistència suporta qualsevol Predicate vàlid.\r\n\r\nPodeu trobar més informació a la documentació de [Spring Data] (https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#core.extensions.querydsl) o de [QueryDSL] (http://www.querydsl.com/static/querydsl/latest/reference/html/)\r\n","objectID":"L2hvd3Rvcy8yMDE3LTExLUhvd3RvLVVzX1NlcnZlaV9QZXJzaXN0ZW5jZV9DYW5pZ28="},"L2hvd3Rvcy8yMDE3LTA1LUhvd3RvLUNvbm5lY3Rhcl9ub2RlanNfYW1iX21vbmdvX3NzbA==":{"date":1493596800000,"title":"Connectar amb un cluster MongoDB per SSL en una aplicació NodeJS","description":"Connectar amb un cluster MongoDB per SSL en una aplicació NodeJS","section":"howtos","categories":["canigo"],"key":"MAIG2017","path":"/howtos/2017-05-Howto-Connectar_nodejs_amb_mongo_ssl","content":"### A qui va dirigit\r\n\r\nAquest how-to va dirigit a tots aquells perfils tècnics que tinguin la necessitat de connectar-se amb un cluster MongoDB que requereixi SSL des d'una aplicació NodeJS.\r\n\r\n### Introducció\r\n\r\nLes connexions entre les aplicacions i les base de dades MongoDB haurien de realitzar-se amb connexió segura (SSL), sobretot en el cas que la base de dades estigui a cloud públic. En aquest how-to s'explica com fer-ho a una aplicació NodeJS.\r\n\r\n### Obtenir certificat\r\n\r\nEl primer pas és obtenir el certificat (ja sigui autosignat o emès per una entitat de confiança com Verisign) del proveïdor de la base de dades.\r\n\r\n### [MongoClient](https://www.mongoclient.com/)\r\n\r\nÉs el connector oficial al qual dóna suport [MongoDB](https://www.mongodb.com/), i correspon al paquet 'mongodb' de NodeJS.\r\n\r\nExemple:\r\n\r\n\tvar MongoClient = require('mongodb').MongoClient\r\n\t\t, format = require('util').format;\r\n\r\n\tvar fs = require('fs');\r\n\t\t\r\n\tvar caFile = fs.readFileSync(__dirname + '/mongodbcert.crt');\r\n\t\t\r\n\tMongoClient.connect('mongodb://user:password@host:port/db', \r\n\t\t{ \tmongos: {\r\n\t\t\t\tssl: true,\r\n\t\t\t\tsslValidate: true,\r\n\t\t\t\tsslCA: caFile,\r\n\t\t\t\tpoolSize: 1,\r\n\t\t\t\treconnectTries: 1\r\n\t\t\t}\r\n\t\t}\r\n\t\t,function (err, db) {\r\n\t\t\tif (err) {\r\n\t\t\t\tthrow err;\r\n\t\t\t} else {\r\n\t\t\t\tconsole.log(\"successfully connected to the database\");\r\n\t\t\t}\r\n\t\tdb.close();\r\n\t});\r\n\t\r\nA la variable caFile es carrega el certificat, i l'afegim com a paràmetre **sslCA** a Mongoclient.connect.\r\n\r\nPer a configurar l'accés SSL és necessari afegir també les propietats **ssl** i **sslValidate** amb valor \"true\".\r\n\t\r\n### [Mongoose](http://mongoosejs.com/)\r\n\r\nEl paquet 'mongoose', el qual permet treballar amb un model orientat a objectes, també és vàlid i suportat per la comunitat.\r\n\r\nExemple:\r\n\r\n\tconst mongoose = require('mongoose');\r\n\tconst fs = require('fs');\r\n\r\n\tconst mongoOpt = {\r\n\t\t\t  \"server\": {\r\n\t\t\t\t\"auto_reconnect\": true,\r\n\t\t\t\t\"reconnectTries\": 1,\r\n\t\t\t\t\"socketOptions\": {\r\n\t\t\t\t  \"keepAlive\": 1,\r\n\t\t\t\t  \"connectTimeoutMS\": 30000\r\n\t\t\t\t}\r\n\t\t\t  },\r\n\t\t\t  \"mongos\": {\r\n\t\t\t\t\"ssl\": true,\r\n\t\t\t\t\"sslValidate\": true,\r\n\t\t\t\t\"sslCA\": fs.readFileSync(__dirname + '/mongodbcert.crt')\r\n\t\t\t  }\r\n\t\t\t};\r\n\r\n\tmongoose.connect('mongodb://user:password@host:port/db', mongoOpt);\r\n\r\n\tvar db = mongoose.connection;\r\n\tdb.on('error', function(err) {\r\n\t\tconsole.error('Error in MongoDB connection: ' + err);\r\n\t\tmongoose.disconnect();\r\n\t});\r\n\r\n\tdb.on('connected', function() {\r\n\t\tconsole.log('Connexió amb el servidor de BBDD');\r\n\t\tmongoose.disconnect();\r\n\t});\r\n\r\nQuan es realitza la connexió, al paràmetre d'opcions (mongoOpt) s'han d'afegir les propietats **ssl** i **sslValidate** a \"true\" i **sslCA** amb el fitxer corresponent al certificat.\r\n","objectID":"L2hvd3Rvcy8yMDE3LTA1LUhvd3RvLUNvbm5lY3Rhcl9ub2RlanNfYW1iX21vbmdvX3NzbA=="},"L2hvd3Rvcy8yMDE4LTAxLWhvd3RvLXRlc3RfamFyc19jYW5pZ28=":{"date":1513036800000,"title":"Proves Unitàries Mòduls de Canigó","description":"Realitzar proves unitàries de mòduls de Canigó","section":"howtos","categories":["canigo"],"key":"GENER2018","path":"/howtos/2018-01-howto-test_jars_canigo","content":"### A qui va dirigit\r\n\r\nAquest how-to va dirigit a tots aquells desenvolupadors/arquitectes que desenvolupin una aplicació Canigó 3.2.3.\r\n\r\n### Versió de Canigó\r\n\r\nEls passos descrits en aquest document apliquen a la versió 3.2.3 del Framework Canigó.\r\n\r\n### Introducció\r\n\r\nAmb la publicació de Canigó 3.2.3 els mòduls Core, Web-RS, Persistència i Seguretat proporcionen uns jars que inclouen els seus tests unitaris (tipus test-jar).\r\n\r\nAmb aquests jars des de l'aplicació creada es pot executar aquests tests per a comprovar que els mòduls funcionen correctament. Aquests tests es poden executar amb llibreries més actuals i d'aquesta manera comprovar que els mòduls continuen funcionant, o en cas contrari que les noves llibreries no són compatibles amb Canigó\r\n\r\n### Test Jars\r\n\r\nSi es crea una nova aplicació amb el [plugin de Canigó](/canigo-download-related/plugin-canigo/) aquestes llibreries ja vénen incorporades al pom.xml\r\n\r\n\t<dependency>\r\n\t   <groupId>cat.gencat.ctti</groupId>\r\n\t   <artifactId>canigo.core</artifactId>\r\n\t   <type>test-jar</type>\r\n\t   <version>${canigo.core.version}</version>\r\n\t   <scope>test</scope>\r\n\t   <classifier>tests</classifier>\r\n\t</dependency>\r\n\t<dependency>\r\n\t   <groupId>cat.gencat.ctti</groupId>\r\n\t   <artifactId>canigo.web.rs</artifactId>\r\n\t   <type>test-jar</type>\r\n\t   <version>${canigo.web.rs.version}</version>\r\n\t   <scope>test</scope>\r\n\t   <classifier>tests</classifier>\r\n\t</dependency>\r\n\t<dependency>\r\n\t   <groupId>cat.gencat.ctti</groupId>\r\n\t   <artifactId>canigo.persistence.jpa</artifactId>\r\n\t   <type>test-jar</type>\r\n\t   <version>${canigo.persistence.jpa}</version>\r\n\t   <scope>test</scope>\r\n\t   <classifier>tests</classifier>\r\n\t</dependency>\r\n\r\nI també el plugin de Maven que fa que s'executin els tests dels mòduls:\r\n\r\n\r\n\t<plugin>\r\n\t\t\t<groupId>org.apache.maven.plugins</groupId>\r\n\t\t\t<artifactId>maven-surefire-plugin</artifactId>\r\n\t\t\t<executions>\r\n\t\t\t\t<execution>\r\n\t\t\t\t\t<id>base-test</id>\r\n\t\t\t\t\t<phase>test</phase>\r\n\t\t\t\t\t<goals>\r\n\t\t\t\t\t\t<goal>test</goal>\r\n\t\t\t\t\t</goals>\r\n\t\t\t\t\t<configuration>\r\n\t\t\t\t\t\t<dependenciesToScan>\r\n\t\t\t\t\t\t\t<dependency>cat.gencat.ctti:canigo.core</dependency>\r\n\t\t\t\t\t\t\t<dependency>cat.gencat.ctti:canigo.persistence.jpa</dependency>\r\n\t\t\t\t\t\t\t<dependency>cat.gencat.ctti:canigo.web.rs</dependency>\r\n\t\t\t\t\t\t</dependenciesToScan>\r\n\t\t\t\t\t\t<excludes>\r\n\t\t\t\t\t\t\t<exclude>%regex[${project.groupId}.*.*Test.*]</exclude>\r\n\t\t\t\t\t\t</excludes>\r\n\t\t\t\t\t</configuration>\r\n\t\t\t\t</execution>\r\n\t\t\t</executions>\r\n\t\t</plugin>\r\n\r\n### Executar els tests\r\n\r\nPer executar els tests només cal cridar al goal de maven **test**\r\n\r\n\tResults :\r\n\r\n\tTests run: 57, Failures: 0, Errors: 0, Skipped: 0\r\n\r\nSi per exemple es vol probar que una nova versió d'Hibernate és compatible amb els mòduls Canigó s'ha d'afegir la llibreria que es desitgi provar amb **scope test**\r\n\r\n\r\n\t<dependency>\r\n\t\t<groupId>org.hibernate</groupId>\r\n\t\t<artifactId>hibernate-core</artifactId>\r\n\t\t<version>5.2.10.Final</version>\r\n\t\t<scope>test</scope>\r\n\t</dependency>\r\n\t\t\t\r\n\t<dependency>\r\n\t\t<groupId>org.hibernate</groupId>\r\n\t\t<artifactId>hibernate-entitymanager</artifactId>\r\n\t\t<version>5.2.10.Final</version>\r\n\t\t<scope>test</scope>\r\n\t</dependency>\r\n\r\nI tornar a llençar el goal maven de test:\r\n\r\n\tTests run: 57, Failures: 0, Errors: 2, Skipped: 0\r\n\r\nAmb aquestes noves llibreries, el mòdul canigo-persistence no passa els tests, amb el qual significa que no es pot utilitzar amb Canigó.\r\n\r\nAmb aquest procediment es pot validar si es poden utilitzar llibreries més actuals que les proporcionades als mòduls de Canigó.\r\n\r\n","objectID":"L2hvd3Rvcy8yMDE4LTAxLWhvd3RvLXRlc3RfamFyc19jYW5pZ28="},"L2hvd3Rvcy8yMDE3LTEyLWhvd3RvLWludGVncmFjaW9fY2FuaWdvX3NpYw==":{"date":1513036800000,"title":"Integració d'una aplicació Canigó a SIC 2.0","description":"Integració d'una aplicació Canigó a SIC 2.0","section":"howtos","categories":["canigo"],"key":"DESEMBRE2017","path":"/howtos/2017-12-howto-integracio_canigo_sic","content":"### A qui va dirigit\r\n\r\nAquest how-to va dirigit a tots aquells desenvolupadors/arquitectes que desenvolupin una aplicació Canigó 3.2 i s'hagin d'integrar al SIC.\r\n\r\n### Versió de Canigó\r\n\r\nEls passos descrits en aquest document apliquen a la versió 3.2.x del Framework Canigó.\r\n\r\n### Introducció\r\n\r\nEn aquest HowTo s'explica els passos a realitzar per a realitzar la [integració d'una aplicació Canigó al SIC](/noticies/2017-12-11-Canigo-Integracio-pipelines-SIC/).\r\n\r\nEl punt de partida és una aplicació Canigó generada pel [plugin de Canigó per a Eclipse](/canigo-download-related/plugin-canigo/), un projecte creat al [Gitlab de SIC] (http://canigo.ctti.gencat.cat/noticies/2017-07-18-SIC-Autoservei-usuaris-SIC2.0/) i un usuari amb permisos per treballar-hi.\r\n\r\n### Connectar amb Git\r\n\r\nPrimer de tot cal que es configurin els binaris per estar fora del control del Git, ja que no corresponen a codi font. Per això cal crear un fitxer [.gitignore](https://git-scm.com/docs/gitignore) a l'arrel de l'aplicació perquè ignori les parts que no s'han de sincronitzar amb el Git. Per exemple:\r\n\r\n\ttarget/\r\n\t\r\nTípicament, a més de la carpeta de sortida de la compilació, també s'ignoren recursos propis de l'IDE de desenvolupament (Eclipse, NetBeans, IntelliJ, ...).\r\n\r\nInicialitzem l'aplicació com a repositori Git i pugem el codi:\r\n\r\n\tAnar a l'arrel de l'aplicació\r\n\tgit init\r\n\tgit remote add origin *path_projecte_git*\r\n\tgit add .\r\n\tgit commit -m \"descripció commit\"\r\n\tgit push -u origin master\r\n\t\r\n### Automatitzar el descriptor sic.yml\r\n\r\nPer a la construcció i desplegament d'una aplicació mitjançant una pipeline al Jenkins, l'aplicació ha de disposar del fitxer \"sic.yml\" amb la versió de l'aplicació. Més informació al punt 3.3.3 del [Manual d'Usuari del SIC](http://canigo.ctti.gencat.cat/related/sic/2.0/manual-usuari.pdf). Aquesta serà la versió amb què s'etiquetarà el codi pujat al master un cop hagi superat les diferents fases prèvies de la pipeline (construcció, tests, ...).\r\n\r\nPer a que el camp \"version\" d'aquest fitxer \"sic.yml\" no hagi de ser actualitzat manualment, es recomana automatitzar el procés a partir de la versió del projecte Maven:\r\n\r\nA *src/main/resources* crear el fitxer \"sic.yml\" amb el següent contingut:\r\n\r\n\tversion: ${project.version}\r\n\t\r\nAl pom.xml de l'aplicació s'ha d'afegir el plugin **maven-resources-plugin** amb la següent configuració:\r\n\r\n\t<plugin>\r\n\t\t<groupId>org.apache.maven.plugins</groupId>\r\n\t\t<artifactId>maven-resources-plugin</artifactId>\r\n\t\t<version>3.0.2</version>\r\n\t\t<executions>\r\n\t\t\t<execution>\r\n\t\t\t\t<id>set-version</id>\r\n\t\t\t\t<phase>process-resources</phase>\r\n\t\t\t\t<goals>\r\n\t\t\t\t\t<goal>copy-resources</goal>\r\n\t\t\t\t</goals>\r\n\t\t\t\t<configuration>\r\n\t\t\t\t\t<useDefaultDelimiters>true</useDefaultDelimiters>\r\n\t\t\t\t\t<outputDirectory>sic</outputDirectory>\r\n\t\t\t\t\t<resources>          \r\n\t\t\t\t\t\t<resource>\r\n\t\t\t\t\t\t\t<directory>src/main/resources</directory>\r\n\t\t\t\t\t\t\t<filtering>true</filtering>\r\n\t\t\t\t\t\t\t<includes>\r\n\t\t\t\t\t\t\t\t<include>sic.yml</include>\r\n\t\t\t\t\t\t\t</includes>\r\n\t\t\t\t\t\t</resource>\r\n\t\t\t\t\t</resources>\r\n\t\t\t\t</configuration>            \r\n\t\t\t</execution>\r\n\t\t</executions>\r\n\t</plugin>\r\n\r\nD'aquesta manera, quan es construeixi l'aplicació, automàticament s'establirà la versió al fitxer \"/sic/sic.yml\", a partir del qual la pipeline del SIC generarà el tag de l'aplicació al Git. \r\n\r\n*A partir de la versió 3.2.3 de Canigó, aquesta configuració ja estarà incorporada a la plantilla que genera el plugin d'Eclipse*\r\n\t\r\n\r\n\t\r\n\r\n","objectID":"L2hvd3Rvcy8yMDE3LTEyLWhvd3RvLWludGVncmFjaW9fY2FuaWdvX3NpYw=="},"L2hvd3Rvcy8yMDE4LTAyLWhvd3RvLXN3YWdnZXJfc29hcHVp":{"date":1518566400000,"title":"Generació de joc de proves per a peticions REST a SOAP-UI amb Swagger","description":"En aquest HowTo s'explica com generar un joc de proves per a peticions REST a SOAP-UI amb Swagger","section":"howtos","categories":["canigo"],"key":"FEBRER2018","path":"/howtos/2018-02-howto-swagger_soapui","content":"### A qui va dirigit\r\n\r\nAquest how-to va dirigit a tots aquells desenvolupadors/arquitectes que desenvolupin una aplicació Canigó 3.2.\r\n\r\n### Versió de Canigó\r\n\r\nEls passos descrits en aquest document apliquen a la versió 3.2 del Framework Canigó.\r\n\r\n### Prerequisits\r\n\r\nEs necessita la versió 5.2.1 o superior de [SOAP-UI] (https://www.soapui.org/downloads/soapui.html)\r\n\r\n### Introducció\r\n\r\nLes aplicacions Canigó amb versió 3.2.x incorporen Swagger a la seva plantilla que permet realitzar proves a les crides de l'aplicació de forma intuïtiva i senzilla, però que no permet realitzar un joc de proves automàtic, com executar totes les crides o realitzar més d'una a la vegada.\r\n\r\nAquestes proves es poden realitzar amb un programa com el SOAP-UI que permet la importació de les metadades generades per swagger. Amb aquestes dades es pot generar un projecte amb totes les crides i poder realitzar proves de forma més exhaustiva i còmode.\r\n\r\n### Obtenció swagger.json\r\n\r\nPer a importar les metadades del nostre projecte a SOAP-UI es necessita obtenir el fitxer json que genera Swagger:\r\n\r\n- Accedir directament al json que genera: http://localhost:8080/api/v2/api-docs\r\n\r\nUna altre forma d'obtenir el fitxer json és:\r\n\r\n- Accedir a la plana de Swagger de la nostra aplicació http://localhost:8080/canigo-api.html\r\n- Obrir les eines de desenvolupador que proporciona el navegador. A Chrome es pot accedir mitjançant F12 o \"Més eines - Eines per a desenvolupadors\"\r\n- Anar a la pestanya Network i fer F5 per refrescar la pàgina\r\n- Seleccionar el filtre XHR\r\n- Apareixerà una petició \"api-docs\" que conté el json. Aquest json s'ha de guardar en un fitxer, per exemple swagger.json\r\n\t\r\n![Obtenir swagger.json](/related/canigo/howto/imatges/201802_01.jpg)\r\n\r\n### Importar a SOAP-UI\r\n\r\nObrim l'aplicació SOAP-UI i es crea un nou projecte (File - Create Empty Project)\r\n\r\nBotó dret sobre el projecte creat, Import Swagger i seleccionar el fitxer que hem desat abans (swagger.json)\r\n\r\nEs crea una crida a cada endpoint publicat de l'aplicació:\r\n\r\n![Import swagger.json](/related/canigo/howto/imatges/201802_02.jpg)\r\n\r\n","objectID":"L2hvd3Rvcy8yMDE4LTAyLWhvd3RvLXN3YWdnZXJfc29hcHVp"},"L2hvd3Rvcy8yMDE4LTA4LUhvd3RvLVRyYW5zbWlzc2lvLWJpbmFyaXMtUkVTVC1BUEk=":{"date":1533859200000,"title":"Transmissió de binaris en una REST API a Canigó 3.2","description":"En aquest HowTo s'explica pas a pas com fer transferència de dades binàries en una REST API a Canigó 3.2 seguint les millors pràctiques definides pel CS Canigó","section":"howtos","categories":["canigo"],"key":"SETEMBRE2018","path":"/howtos/2018-08-Howto-Transmissio-binaris-REST-API","content":"### Audiència\n\nAquest how-to va dirigit a tots aquells desenvolupadors/arquitectes que desenvolupin una aplicació Canigó 3.2 i que necessitin transferir dades binàries en REST APIs.\n\n#### Protocol Buffers\n\nAbans de fer cap modificació, cal generar, compilar i executar l'aplicació per verificar que tot funciona bé.\n\n**NOTA:** _La manera recomanada de generar l'aplicació és amb el plugin d'Eclipse de Caniǵo que ve integrat amb [l'entorn de desenvolupament de Canigó](https://canigo.ctti.gencat.cat/canigo/entorn-desenvolupament/)), i la compilació i desplegament amb els plugins d'Eclipse de Maven i Spring_\n\n1. Generar projecte amb archetype: `mvn -B archetype:generate -DgroupId=cscanigo.howto.rest -DartifactId=protocolbuffers -Dversion=1.0-SNAPSHOT -DarchetypeGroupId=cat.gencat.ctti -DarchetypeArtifactId=plugin-canigo-archetype-rest -DarchetypeVersion=1.5.5`\n2. Compilar amb `mvn -B -f protocolbuffers/pom.xml clean package`\n3. Executar l'aplicació generada mitjançant `java -Dapplication.defaultLanguage=ca -jar protocolbuffers/target/protocolbuffers.war`\n4. Provar d'accedir amb un navegador web a http://localhost:8080/index.html\n\nUn cop s'han executat els pasos previs per disposar d'una aplicació Canigó 3.2 funcionant, s'ha d'afegir el suport específic pels *Protocol Buffers*, de la següent manera:\n\n1. Modificar pom.xml per afegir les següents dependències al final:\n\n```\n\t\t<!-- Dependències pròpies Protocol buffers -->\n\t\t<dependency>\n\t\t\t<groupId>com.google.protobuf</groupId>\n\t\t\t<artifactId>protobuf-java</artifactId>\n\t\t\t<version>3.2.0</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>com.googlecode.protobuf-java-format</groupId>\n\t\t\t<artifactId>protobuf-java-format</artifactId>\n\t\t\t<version>1.4</version>\n\t\t</dependency>\n```\n\n2. Definir els missatges que s'enviaran mitajançant *Protocol Buffers*:\n\t1. Crear el directori on emmagatzemar les definicions en texte dels missatges: **src/main/protobuf**\n\t2. Crear el/s fitxer/s `.proto`. Un exemple de definició seria aquest:\n\t\n```\n// src/main/protobuf/EquipamentEspecial.proto\nsyntax = \"proto2\";\n\n// pot ser qualsevol package, però per mantenir la coherència\noption java_package = \"cscanigo.howto.rest.proto\";\noption java_outer_classname = \"EquipamentEspecialProto\";\n\n// Missatges pel model de dades\n\nmessage EquipamentEspecial {\n  required int64 id = 1;\n  required string nom = 2;\n  optional string municipi = 3;\n  repeated DocumentacioEquipamentEspecial documents = 4;\n}\n\nmessage DocumentacioEquipamentEspecial {\n  required int64 id = 1;\n  required string nom = 2;\n  optional string descripcio = 3;\n  // pot no ser obligatori definir el contingut del document\n  optional bytes contingut = 4;\n}\n\n// Missatges de cerca\n\nmessage CercaRequest {\n  optional int64 id = 1;\n  optional string nom = 2;\n  optional string municipi = 3;\n}\n\nmessage CercaPaginadaRequest {\n  optional int64 id = 1;\n  optional string nom = 2;\n  optional string municipi = 3;\n  optional int32 page = 4 [ default = 1 ];\n  optional int32 rpp = 5 [ default = 10 ];\n  optional string sort = 6;\n  optional string filter = 7;\n}\n\n// Missatges de resposta\n\nmessage CercaResponse {\n  required int32 total = 1;\n  repeated EquipamentEspecial equipaments = 2;\n}\n\n```\n\n3. Afegir al Application.java : `@Bean public ProtobufHttpMessageConverter protobufHttpMessageConverter() { return new ProtobufHttpMessageConverter(); }`\n4. Modificar pom.xml per afegir el plugin que compila els fitxers `.proto` a codi Java. Aquest plugin s'ha de posar abans de la definició del plugin `maven-compiler-plugin`:\n\n```\n\t\t\t<!-- compile proto file into java files. -->\n\t\t\t<plugin>\n\t\t\t\t<groupId>com.github.os72</groupId>\n\t\t\t\t<artifactId>protoc-jar-maven-plugin</artifactId>\n\t\t\t\t<version>3.2.0.1</version>\n\t\t\t\t<executions>\n\t\t\t\t\t<execution>\n\t\t\t\t\t\t<phase>generate-sources</phase>\n\t\t\t\t\t\t<goals>\n\t\t\t\t\t\t\t<goal>run</goal>\n\t\t\t\t\t\t</goals>\n\t\t\t\t\t\t<configuration>\n\t\t\t\t\t\t\t<!-- <includeDirectories> <include>src/main/protobuf</include> </includeDirectories> -->\n\t\t\t\t\t\t\t<inputDirectories>\n\t\t\t\t\t\t\t\t<include>src/main/protobuf</include>\n\t\t\t\t\t\t\t</inputDirectories>\n\t\t\t\t\t\t\t<!-- Create java files. And put them in the directory. -->\n\t\t\t\t\t\t\t<outputTargets>\n\t\t\t\t\t\t\t\t<outputTarget>\n\t\t\t\t\t\t\t\t\t<type>java</type>\n\t\t\t\t\t\t\t\t\t<!-- <outputDirectory>src/main/java</outputDirectory> -->\n\t\t\t\t\t\t\t\t\t<outputDirectory>target/generated-sources/java-protobuf</outputDirectory>\n\t\t\t\t\t\t\t\t</outputTarget>\n\t\t\t\t\t\t\t</outputTargets>\n\t\t\t\t\t\t</configuration>\n\t\t\t\t\t</execution>\n\t\t\t\t</executions>\n\t\t\t</plugin>\n```\n\n**NOTA:** Per poder fer proves, es pot desactivar (de manera temporal) la protecció contra CSRF, afegint al final del mètode configure() de la classe WebSecurityConfig.java `http.csrf().disable();`.\n\nUn cop acabat el suport específic per *Protocol Buffers*, Spring ho integra automàticament amb les annotacions REST. Un exemple d'endpoint REST pels missatges *Protocol Buffer* seria el següent:\n\n```\npackage cscanigo.howto.rest.endpoints;\n\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.http.MediaType;\nimport org.springframework.web.bind.annotation.PostMapping;\nimport org.springframework.web.bind.annotation.RequestBody;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\nimport cscanigo.howto.rest.model.Equipament;\nimport cscanigo.howto.rest.proto.EquipamentEspecialProto.CercaRequest;\nimport cscanigo.howto.rest.proto.EquipamentEspecialProto.CercaResponse;\nimport cscanigo.howto.rest.proto.EquipamentEspecialProto.EquipamentEspecial;\nimport cscanigo.howto.rest.service.EquipamentService;\n\n@RestController\n@RequestMapping(\"/equipamentEspecial\")\npublic class EquipamentEspecialServiceController {\n\n\t@Autowired\n\tEquipamentService equipamentService;\n\n\t@PostMapping(produces = { \"application/x-protobuf\", MediaType.APPLICATION_JSON_VALUE })\n\tpublic CercaResponse getEquipament(@RequestBody final CercaRequest request) {\n\n\t\tEquipament equipament = equipamentService.getEquipament(request.getId());\n\n\t\tEquipamentEspecial.Builder equipamentEspecial = EquipamentEspecial.newBuilder() //\n\t\t\t\t.setId(equipament.getId()) //\n\t\t\t\t.setNom(equipament.getNom()) //\n\t\t\t\t.setMunicipi(equipament.getMunicipi());\n\n\t\tfor (Documents documents : equipament.getDocuments()) {\n\n\t\t\tequipamentEspecial.addDocumentsBuilder() //\n\t\t\t\t\t.setId(documents.getId()) //\n\t\t\t\t\t.setNom(documents.getNom()) //\n\t\t\t\t\t.setContingut(ByteString.copyFrom(documents.getContingut())) //\n\t\t\t\t\t.build();\n\t\t}\n\n\t\treturn CercaResponse.newBuilder() //\n\t\t\t\t.setTotal(1) //\n\t\t\t\t.addEquipaments(equipamentEspecial.build()) //\n\t\t\t\t.build();\n\t}\n\n}\n\n```\n\n**NOTA:** En aquest cas concret, les implementacions actuals per browser (Firefox, Chrome, MSIE, etc.) no són prou madures per considerar-ne l'utilització fora de l'àmbit M2M (màquina a màquina). Tot i així, com a prova de concepte_ es pot utilitzar el següent codi HTML per fer enviar i rebre informació amb *Protocol Buffers*:\n\n```\n<!DOCTYPE HTML>\n<html lang=\"en-US\">\n<head>\n<meta charset=\"UTF-8\">\n<title>Prova de concepte</title>\n<script src=\"js/long.js\"></script>\n<script src=\"js/bytebuffer.js\"></script>\n<script src=\"js/protobuf.js\"></script>\n<script src=\"js/axios.min.js\"></script>\n</head>\n<body>\n\t<script type=\"text/javascript\">\n\t      \"use strict\";\n\t      var CercaRequest, CercaResponse;\n\t      let ProtoBuf = dcodeIO.ProtoBuf;\n\n\t      let EquipamentEspecial = ProtoBuf\n\t      .loadProtoFile('./EquipamentEspecial.proto', (err, builder)=>{\n\t    \t  CercaRequest = builder.build('CercaRequest')\n\t    \t  CercaResponse = builder.build('CercaResponse')\n\t    \t  });\n\n\t      let sendCercaRequest = () =>{\n\t    \t\n\t    \tlet vIdentificador = document.getElementById(\"identificador\").value\n\t       \tlet msg = new CercaRequest({ \n\t       \t\tnom : \"\", \n\t       \t\tid: vIdentificador \n\t       \t\t});\n\t    \t\n\t    \tlet axiosRequestHeaders = {'Accept':'application/x-protobuf', 'Content-Type': 'application/x-protobuf'};\n\t        axios.post('/api/equipamentEspecial', msg.toArrayBuffer(),\n\t            { responseType: 'arraybuffer', headers: axiosRequestHeaders }\n\t          ).then(function (response) {\n\t\t            console.log('Response from the server: ', response)\n\t\t            \n\t\t            let msg = CercaResponse.decode(response.data)\n\t\t            \n\t\t            console.log('Decoded message', msg)\n\t\t            document.getElementById('content').innerText = JSON.stringify(msg, null, 2)\n\t          })\n\t          .catch(function (response) {\n\t            console.log(response)\n\t          })\n\t      }\n\t</script>\n\t<h1>Prova amb Protocol Buffers</h1>\n\t<p>Prova de intercanvi de dades amb Protocol Buffers</p>\n\t<pre id=\"content\"></pre>\n\t<label for=\"identificador\">Identificador de l'equipament</label>\n\t<input type=\"text\" id=\"identificador\" name=\"identificador\" value=\"2\" />\n\t<br />\n\t<!--  -->\n\t<button onclick=\"sendCercaRequest()\">send message to\n\t\tserver</button>\n</body>\n</html>\n```\nMés info:\n* https://webapplog.com/json-is-not-cool-anymore/\n* https://github.com/azat-co/proto-buffer-api/tree/master/public\n* https://www.baeldung.com/spring-rest-api-with-protocol-buffers\n* https://dzone.com/articles/using-googles-protocol-buffers-with-java\n\n#### Multipart\n\nAbans de fer cap modificació cal generar, compilar i executar l'aplicació per verificar que tot funciona bé.\n\n**NOTA:** La manera recomanada de generar l'aplicació és amb el plugin d'Eclipse de Caniǵo que ve integrat amb [l'entorn de desenvolupament de Canigó](https://canigo.ctti.gencat.cat/canigo/entorn-desenvolupament/)), i la compilació i desplegament amb els plugins d'Eclipse de Maven i Spring\n\n1. Generar projecte amb archetype : `mvn -B archetype:generate -DgroupId=cscanigo.howto.rest -DartifactId=multipart -Dversion=1.0-SNAPSHOT -DarchetypeGroupId=cat.gencat.ctti -DarchetypeArtifactId=plugin-canigo-archetype-rest -DarchetypeVersion=1.5.5`\n2. Compilar amb `mvn -B -f multipart/pom.xml clean package`\n3. Executar l'aplicació generada mitjançant `java -Dapplication.defaultLanguage=ca -jar multipart/target/multipart.war`\n4. Provar d'accedir amb Firefox a http://localhost:8080/index.html\n\nUn cop s'han executat els pasos previs, s'ha d'afegir el suport específic pel tractament de dades *Multipart*, de la següent manera:\n\n1. Modificar el mètode dispatcherServletRegistration() de la classe Application.java per afegir abans del retorn:\n\n```\n\t\tMultipartConfigFactory mcf = new MultipartConfigFactory();\n\t\tmcf.setFileSizeThreshold(\"1MB\");\n\t\tmcf.setLocation(System.getProperty(\"java.io.tmpdir\"));\n\t\tmcf.setMaxFileSize(\"1MB\");\n\t\tmcf.setMaxRequestSize(\"32MB\");\n\n\t\tregistration.setMultipartConfig(mcf.createMultipartConfig());\n```\n\nUn cop acabat el suport específic per *Multipart*, Spring ho integra automàticament amb les annotacions REST utilitzant la configuració prèvia. Un exemple d'endpoint REST per missatges *Multipart* seria el següent:\n\n```\n\t@PostMapping(produces = { MediaType.APPLICATION_JSON_VALUE }, headers = \"content-type=multipart/form-data\")\n\t@ResponseStatus(HttpStatus.ACCEPTED)\n\tpublic void saveEquipamentMultipart(//\n\t\t\t@RequestParam(\"descripcio1\") String descripcio1, //\n\t\t\t@RequestPart(\"fitxer1\") MultipartFile file1, //\n\t\t\t@RequestPart(name = \"fitxer2\", required = false) MultipartFile file2 //\n\t) throws Exception {\n\t\t// TODO\n\t}\n```\n\n**NOTA:** _Com a prova de concepte_ es pot utilitzar el següent codi HTML com a referència per enviar un fitxer mitjançant *Multipart*:\n\n```\n<!DOCTYPE HTML>\n<html lang=\"en-US\">\n<head>\n<meta charset=\"UTF-8\">\n<title>Prova amb Multipart</title>\n</head>\n<body>\n\t<h1>Prova amb Multipart</h1>\n\t<p>Prova de pujar un formulari Multipart</p>\n\t<form name=\"miFormulario\" action=\"/api/equipaments\" method=\"post\"\n\t\tenctype=\"multipart/form-data\">\n\t\t<!--  -->\n\t\t<label for=\"descripcio1\">Descripció fitxer 1</label><input type=\"text\"\n\t\t\tname=\"descripcio1\" value=\"descripcio001\" /><br />\n\t\t<!--  -->\n\t\t<label for=\"fitxer1\">Adjuntar fitxer 1</label><input type=\"file\"\n\t\t\tname=\"fitxer1\" /><br />\n\t\t<!--  -->\n\t\t<input type=\"submit\" />\n\t</form>\n</body>\n</html>\n```\n\n#### XML:base64Binary\n\nAbans de fer cap modificació, cal generar, compilar i executar l'aplicació per verificar que tot funciona bé.\n\n**NOTA:** _La manera recomanada de generar l'aplicació és amb el plugin d'Eclipse de Caniǵo que ve integrat amb [l'entorn de desenvolupament de Canigó](https://canigo.ctti.gencat.cat/canigo/entorn-desenvolupament/)), i la compilació i desplegament amb els plugins d'Eclipse de Maven i Spring_\n\n1. Generar projecte amb archetype: `mvn -B archetype:generate -DgroupId=cscanigo.howto.rest -DartifactId=xmlbase64binary -Dversion=1.0-SNAPSHOT -DarchetypeGroupId=cat.gencat.ctti -DarchetypeArtifactId=plugin-canigo-archetype-rest -DarchetypeVersion=1.5.5`\n2. Compilar amb `mvn -B -f xmlbase64binary/pom.xml clean package`\n3. Executar l'aplicació generada mitjançant `java -Dapplication.defaultLanguage=ca -jar xmlbase64binary/target/xmlbase64binary.war`\n4. Provar d'accedir amb un navegador web a http://localhost:8080/index.html\n\nUn cop s'han executat els passos previs per disposar d'una aplicació Canigó 3.2 funcionant, s'ha de triar la implementació (JAXB, CXF, Axis, Xmlbeans, etc.) per treballar. Per simplicitat en aquest exemple farem ús de l'estàndard JAXB per generar el codi java:\n\n1. Afegir el fitxer src/main/xsd/global.xjb\n```\n<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\n<jaxb:bindings \n\txmlns:jaxb=\"http://java.sun.com/xml/ns/jaxb\"\n\txmlns:xjc=\"http://java.sun.com/xml/ns/jaxb/xjc\"\n\txmlns:xs=\"http://www.w3.org/2001/XMLSchema\"\n\tjaxb:extensionBindingPrefixes=\"xjc\" jaxb:version=\"2.0\">\n\n\t<jaxb:globalBindings>\n\t\t<xjc:simple />\n\t\t<xjc:serializable uid=\"-1\" />\n\t\t<jaxb:javaType name=\"java.util.Calendar\"\n\t\t\txmlType=\"xs:dateTime\"\n\t\t\tparseMethod=\"javax.xml.bind.DatatypeConverter.parseDateTime\"\n\t\t\tprintMethod=\"javax.xml.bind.DatatypeConverter.printDateTime\" />\n\t</jaxb:globalBindings>\n\n</jaxb:bindings>\n```\n2. Crear el següent fitxer d'exemple: src/main/xsd/EquipamentEspecial.xsd\n```\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<schema xmlns=\"http://www.w3.org/2001/XMLSchema\"\n\ttargetNamespace=\"urn:cscanigo.howto.rest:xmlbase64binary:1.0-SNAPSHOT\"\n\txmlns:tns=\"urn:cscanigo.howto.rest:xmlbase64binary:1.0-SNAPSHOT\"\n\telementFormDefault=\"unqualified\">\n\n\t<element name=\"Root\">\n\t\t<complexType>\n\t\t\t<choice minOccurs=\"1\">\n\t\t\t\t<element name=\"CercaRequest\" type=\"tns:CercaRequest\"></element>\n\t\t\t\t<element name=\"CercaPaginadaRequest\" type=\"tns:CercaPaginadaRequest\"></element>\n\t\t\t\t<element name=\"CercaResponse\" type=\"tns:CercaResponse\"></element>\n\t\t\t</choice>\n\t\t</complexType>\n\t</element>\n\n\t<complexType name=\"CercaRequest\">\n\t\t<sequence>\n\t\t\t<element name=\"id\" type=\"long\" minOccurs=\"1\" maxOccurs=\"1\" />\n\t\t\t<element name=\"nom\" type=\"string\" minOccurs=\"0\" maxOccurs=\"1\" />\n\t\t\t<element name=\"municipi\" type=\"string\" minOccurs=\"0\" maxOccurs=\"1\" />\n\t\t</sequence>\n\t</complexType>\n\n\t<complexType name=\"CercaPaginadaRequest\">\n\t\t<sequence>\n\t\t\t<element name=\"id\" type=\"long\" minOccurs=\"0\" maxOccurs=\"1\" />\n\t\t\t<element name=\"nom\" type=\"string\" minOccurs=\"0\" maxOccurs=\"1\" />\n\t\t\t<element name=\"municipi\" type=\"string\" minOccurs=\"0\" maxOccurs=\"1\" />\n\t\t\t<element name=\"page\" type=\"int\" minOccurs=\"0\" maxOccurs=\"1\" />\n\t\t\t<element name=\"rpp\" type=\"int\" minOccurs=\"0\" maxOccurs=\"1\" />\n\t\t\t<element name=\"sort\" type=\"string\" minOccurs=\"0\" maxOccurs=\"1\" />\n\t\t\t<element name=\"filter\" type=\"string\" minOccurs=\"0\" maxOccurs=\"1\" />\n\t\t</sequence>\n\t</complexType>\n\n\t<complexType name=\"CercaResponse\">\n\t\t<sequence>\n\t\t\t<element name=\"total\" type=\"int\" minOccurs=\"1\" maxOccurs=\"1\" />\n\t\t\t<element name=\"equipaments\" type=\"tns:EquipamentEspecial\" minOccurs=\"0\" maxOccurs=\"unbounded\"></element>\n\t\t</sequence>\n\t</complexType>\n\n\t<complexType name=\"EquipamentEspecial\">\n\t\t<sequence>\n\t\t\t<element name=\"id\" type=\"long\" minOccurs=\"1\" maxOccurs=\"1\" />\n\t\t\t<element name=\"nom\" type=\"string\" minOccurs=\"1\" maxOccurs=\"1\" />\n\t\t\t<element name=\"municipi\" type=\"string\" minOccurs=\"0\" maxOccurs=\"1\" />\n\t\t\t<element name=\"documents\" type=\"tns:DocumentacioEquipamentEspecial\" minOccurs=\"0\" maxOccurs=\"unbounded\"></element>\n\t\t</sequence>\n\t</complexType>\n\n\t<complexType name=\"DocumentacioEquipamentEspecial\">\n\t\t<sequence>\n\t\t\t<element name=\"total\" type=\"long\" minOccurs=\"1\" maxOccurs=\"1\" />\n\t\t\t<element name=\"nom\" type=\"string\" minOccurs=\"1\" maxOccurs=\"1\" />\n\t\t\t<element name=\"descripcio\" type=\"string\" minOccurs=\"0\" maxOccurs=\"1\" />\n\t\t\t<element name=\"contingut\" type=\"base64Binary\" minOccurs=\"0\" maxOccurs=\"1\" />\n\t\t</sequence>\n\t</complexType>\n\n</schema>\n```\n2. Modificar pom.xml per afegir el següent plugin:\n```\n\t\t\t<plugin>\n\t\t\t\t<groupId>org.codehaus.mojo</groupId>\n\t\t\t\t<artifactId>jaxb2-maven-plugin</artifactId>\n\t\t\t\t<version>2.2</version>\n\t\t\t\t<executions>\n\t\t\t\t\t<execution>\n\t\t\t\t\t\t<id>xjc1</id>\n\t\t\t\t\t\t<phase>generate-sources</phase>\n\t\t\t\t\t\t<goals>\n\t\t\t\t\t\t\t<goal>xjc</goal>\n\t\t\t\t\t\t</goals>\n\t\t\t\t\t\t<configuration>\n\t\t\t\t\t\t\t<packageName>${project.groupId}.xsd.equipamentEspecial</packageName>\n\t\t\t\t\t\t\t<sources>\n\t\t\t\t\t\t\t\t<source>${project.basedir}/src/main/xsd/EquipamentEspecial.xsd</source>\n\t\t\t\t\t\t\t</sources>\n\t\t\t\t\t\t</configuration>\n\t\t\t\t\t</execution>\n\t\t\t\t</executions>\n\t\t\t\t<configuration>\n\t\t\t\t\t<target>2.0</target>\n\t\t\t\t\t<addGeneratedAnnotation>true</addGeneratedAnnotation>\n\t\t\t\t\t<extension>true</extension>\n\t\t\t\t\t<failOnNoSchemas>false</failOnNoSchemas>\n\t\t\t\t\t<laxSchemaValidation>true</laxSchemaValidation>\n\t\t\t\t\t<locale>en</locale>\n\t\t\t\t\t<outputDirectory>${project.build.directory}/generated-sources/java</outputDirectory>\n\t\t\t\t\t<xjbSources>\n\t\t\t\t\t\t<xjbSource>${project.basedir}/src/main/xsd/global.xjb</xjbSource>\n\t\t\t\t\t</xjbSources>\n\t\t\t\t</configuration>\n\t\t\t</plugin>\n```\n\nUn cop afegit el suport específic per _JAXB_, Maven en la fase de generació de codi font genera les classes Java. En l'exemple del EquipamentEspecial.xsd la referència a *XML:base64binary* es generaria automàticament a codi Java de la següent manera (veure el camp \"contingut\"):\n\n```\n/**\n * <p>Java class for DocumentacioEquipamentEspecial complex type.\n * \n * <p>The following schema fragment specifies the expected content contained within this class.\n * \n * <pre>\n * &lt;complexType name=\"DocumentacioEquipamentEspecial\"&gt;\n *   &lt;complexContent&gt;\n *     &lt;restriction base=\"{http://www.w3.org/2001/XMLSchema}anyType\"&gt;\n *       &lt;sequence&gt;\n *         &lt;element name=\"total\" type=\"{http://www.w3.org/2001/XMLSchema}long\"/&gt;\n *         &lt;element name=\"nom\" type=\"{http://www.w3.org/2001/XMLSchema}string\"/&gt;\n *         &lt;element name=\"descripcio\" type=\"{http://www.w3.org/2001/XMLSchema}string\" minOccurs=\"0\"/&gt;\n *         &lt;element name=\"contingut\" type=\"{http://www.w3.org/2001/XMLSchema}base64Binary\" minOccurs=\"0\"/&gt;\n *       &lt;/sequence&gt;\n *     &lt;/restriction&gt;\n *   &lt;/complexContent&gt;\n * &lt;/complexType&gt;\n * </pre>\n * \n * \n */\n@XmlAccessorType(XmlAccessType.FIELD)\n@XmlType(name = \"DocumentacioEquipamentEspecial\", propOrder = {\n    \"total\",\n    \"nom\",\n    \"descripcio\",\n    \"contingut\"\n})\n@Generated(value = \"com.sun.tools.xjc.Driver\", date = \"2018-09-12T12:59:02+02:00\", comments = \"JAXB RI v2.2.11\")\npublic class DocumentacioEquipamentEspecial\n    implements Serializable\n{\n\n    @Generated(value = \"com.sun.tools.xjc.Driver\", date = \"2018-09-12T12:59:02+02:00\", comments = \"JAXB RI v2.2.11\")\n    private final static long serialVersionUID = -1L;\n    @Generated(value = \"com.sun.tools.xjc.Driver\", date = \"2018-09-12T12:59:02+02:00\", comments = \"JAXB RI v2.2.11\")\n    protected long total;\n    @XmlElement(required = true)\n    @Generated(value = \"com.sun.tools.xjc.Driver\", date = \"2018-09-12T12:59:02+02:00\", comments = \"JAXB RI v2.2.11\")\n    protected String nom;\n    @Generated(value = \"com.sun.tools.xjc.Driver\", date = \"2018-09-12T12:59:02+02:00\", comments = \"JAXB RI v2.2.11\")\n    protected String descripcio;\n    @Generated(value = \"com.sun.tools.xjc.Driver\", date = \"2018-09-12T12:59:02+02:00\", comments = \"JAXB RI v2.2.11\")\n    protected byte[] contingut;\n\n// ... la resta de codi ...\n\n```\n\nMés info:\n1. https://docs.oracle.com/javase/6/docs/technotes/tools/share/xjc.html\n2. http://www.mojohaus.org/jaxb2-maven-plugin/Documentation/v2.2/\n3. https://www.journaldev.com/1312/jaxb2-maven-plugin-xjc-example-generate-java-classes-xsd\n\n","objectID":"L2hvd3Rvcy8yMDE4LTA4LUhvd3RvLVRyYW5zbWlzc2lvLWJpbmFyaXMtUkVTVC1BUEk="},"L2hvd3Rvcy8yMDE4LTEwLTEwLUhvd1RvLUNhbmlnby1KYXZhOA==":{"date":1539129600000,"title":"Migració Canigó 3 de Java 7 a Java 8","description":"En aquest HowTo es donen unes pautes per migrar aplicacions Canigó 3 de Java 7 a Java 8","sections":["howtos"],"categories":["canigo"],"key":"NOVEMBRE2018","path":"/howtos/2018-10-10-HowTo-Canigo-Java8","content":"## Audiència\n\nAquest how-to va dirigit principalment al personal tècnic (desenvolupadors i arquitectes) que vulguin actualitzar la versió de Java 7 a 8 en una aplicació Canigó 3.\n\n## Context\n\nEls canvis \"grans\" de versions de Java acostumen a implicar canvis en les aplicacions. L'objectiu d'aquesta guia és facilitar la migració a Java 8 de les aplicacions Canigó 3 que facin servir encara Java 7.\n\n## Canigó 3\n\nLa versió de Canigó 3.1.0 publicada a finals de 2014 va introduir la versió 4 de Spring, la qual suporta _out-of-the-box_ Java 8. Per aquest motiu, les aplicacions que funcionin amb una versió de Canigó igual o posterior a la 3.1.0 no patiran problemes amb Java 8.\n\nPer aplicacions Canigó 3.0.x, es recomana actualitzar a Canigó 3.1 seguint aquesta [guia](https://canigo.ctti.gencat.cat/noticies/2016-05-28-Canigo-Proces-actualitzacio-a-Canigo-3_1/).\n\nA continuació s'especifica el canvi a realitzar al codi de l'aplicació Canigó 3.1 / 3.2 per forçar que les classes generades siguin Java 8 compatibles, impedint el desplegament en servidors d'aplicacions que corrin en versions anteriors de Java. \n\n### pom.xml\n\nPer compilar el projecte amb Java 8, només cal modificar el fitxer `pom.xml` i fer el següent canvi:\n\n                        <plugin>\n                                <groupId>org.apache.maven.plugins</groupId>\n                                <artifactId>maven-compiler-plugin</artifactId>\n                                <configuration>\n                                        <source>1.7</source>\n                                        <target>1.7</target>\n                                </configuration>\n                        </plugin>\n\nper\n\n                        <plugin>\n                                <groupId>org.apache.maven.plugins</groupId>\n                                <artifactId>maven-compiler-plugin</artifactId>\n                                <configuration>\n                                        <source>1.8</source>\n                                        <target>1.8</target>\n                                </configuration>\n                        </plugin>\n\n\n## Canvis a Java 8\n\nA continuació es presenta un llistat de canvis introduïts a la versió 8 de Java que poden afectar a les aplicacions que funcionaven amb la versió 7, i en funció de les quals s'hauria de revisar el codi de l'aplicació.\n\n### DateFormat i SimpleDateFormat\n\nEn el cas que es faci ús del formatat de dates amb noms de mesos (p.e. gener, juny, etc.) poden patir problemes amb el canvi de versió de Java.\n\n### java.net \n\n* La nova versió suposa canvis en el formatat de capçaleres `WWW-Authenticate` gestionades per la classe `HttpURLConnection`.\n* Pot produïr-se _Security Exceptions_ quan s'obrin sockets de \"servidor\" amb el canvi de versió.\n\n### LocaleServiceProvider\n\nLa selecció de `LocaleServiceProvider` ha canviat, i pot donar problemes en la gestió dels idiomes.\n\n### Thread.stop(Throwable)\n\nAquest mètode llençarà sempre un `UnsupportedOperationException`.\n\n### java.security\n\nLes claus RSA de menys de 1024 bits deixaran de funcionar per defecte.\n\n### java.lang\n\nLa selecció en sistemes Windows del directori HOME de l'usuari ha canviat, i pot presentar problemes amb aquesta nova versió.\n\n### java.util.Collection\n\nEls mètodes `removeAll()` i `retainAll()` llençaran un `NullPointerException` quan es passi NULLs.\n\n### XML/JAXP\n\nLa selecció del proveïdor de XML pot donar problemes, seleccionant per defecte el que incorpora Java 8, i provocant inconsistències en el tractament de fitxers XML.\n\n### Altres canvis\n\n* _Warnings_ produïts en la compilació amb Java 7 pot generar _Errors_ amb la nova versió de Java.\n* El tractament de genèrics s'ha fet més restrictiu i pot implicar problemes de compilació\n* java.awt : La gestió de tecles pot donar problemes.\n* Nashorn javascript engine: El motor de Javascript \"Rhino\" s'ha canviat pel nou motor \"Nashorn\", i en el cas que l'aplicació faci ús del motor \"Rhino\" s'haurà d'accedir a l'enllaç [2] de l'apartat _Informació addicional_ per corregir els canvis indicats.\n* java.net.DatagramPacket ha canviat la signatura d'un constructor, i pot implicar que el codi no compili.\n\n## Informació addicional\n\n1. https://www.oracle.com/technetwork/java/javase/8-compatibility-guide-2156366.html\n2. https://wiki.openjdk.java.net/display/Nashorn/Rhino+Migration+Guide\n3. https://allegro.tech/2014/12/How-to-migrate-to-Java-8.html\n\n","objectID":"L2hvd3Rvcy8yMDE4LTEwLTEwLUhvd1RvLUNhbmlnby1KYXZhOA=="},"L2hvd3Rvcy8yMDE4LTA4LUNhbmlnby1TQU1M":{"date":1532649600000,"title":"Configuració SAML per la integració amb GICAR en aplicació Canigó 3.2","description":"En aquest HowTo s'explica pas a pas com configurar el mòdul de SAML de Canigó per la integració amb GICAR en una aplicació demo creada a l'entorn de desenvolupament","section":"howtos","categories":["canigo","gicar"],"key":"AGOST2018","path":"/howtos/2018-08-Canigo-SAML","content":"### A qui va dirigit\n\nAquest how-to va dirigit a tots aquells desenvolupadors/arquitectes que desenvolupin una aplicació Canigó 3.2 i que vulguin integrar-se amb GICAR des del backend.\n\n### Versió de Canigó\n\nEls passos descrits en aquest document apliquen a la versió 3.2 del Framework Canigó.\n\n### Introducció\n\nPer a la integració amb GICAR existeixen diferentes possibilitats. En aquest howto s'explica com fer aquesta integració des del backend Canigó en una aplicació demo creada a l'entorn de desenvolupament.\n\n### Aplicació demo GICAR-SAML\n\nPrimer de tot cal dispossar de l'entorn de desenvolupament en cas de no haver-lo instal·lat prèviament. Per a la creació de l'entorn de desenvolupament seguir les instruccions del següent [enllaç](https://canigo.ctti.gencat.cat/canigo/entorn-desenvolupament/).\n\nPer aquesta demo cal que l'aplicació creada mitjançant el plugin d'Eclipse de Canigó incorpori el mòdul de seguretat de SAML.\n\n* _Eclipse_ &rarr; _New_ &rarr; _Other_ &rarr; _Create a Canigo Project_ &rarr; Valors per defecte i informar un nom de projecte (Ex. \"samldemo\")\n\n* _\"samldemo\"_ &rarr; _Canigó_ &rarr; _Add new module_ &rarr; _Security Module_ &rarr; _Do you want token based security? (yes)_ &rarr; _Select security provider/s (Arxiu)_ &rarr; _Desitja utilitzar SAML (Yes)_\n\nAfegir un usuari existent a GICAR PRE:\n\n_samldemo/src/main/resources/config/props/security.users.properties_\n```\n<DNI>=dummy,ROLE_USER,ROLE_ADMIN,enabled\n```\n\nCrear el fitxer \"application.properties\" i afegir l'entrada amb el port del servidor:\n\n_samldemo/src/main/resources/application.properties_\n```\nserver.port=9090\n```\n\nEn aquest punt, construïm l'aplicació _\"samldemo\" &rarr; _Run As_ &rarr; _Maven install_, i ja la tenim preparada pel seu funcionament.\n\n### Aplicació bridge\n\nL'autenticació amb GICAR no es farà directament des de l'aplicació Canigó (stateless per defecte), sinó a través d'una aplicació bridge (stateful). Aquesta aplicació bridge s'ha de sol·licitar a l'equip del CS Canigó ja que conté dades sensibles.\n\nUn cop importada al workspace de l'Eclipse, la construïm _\"appBridge\" &rarr; _Run As_ &rarr; _Maven install_\n\n### Frontal Apache\n\nPer aquest HowTo, per treballar amb dominis i SSL, s'utilitzarà un frontal Apache.\n\nPrimer de tot, afegim la següent entrada al fitxer \"/etc/hosts\":\n\n```\n127.0.0.1 vagrant.vm vagrant\n```\n\nGenerem el certificat autosignat i la clau privada amb openssl:\n\n```\n$ openssl req -x509 -nodes -days 1095 -newkey rsa:2048 -out /etc/apache2/ssl/apache.crt -keyout /etc/apache2/ssl/apache.key\n```\n\nActivem els mòduls necessaris pel SSL i el proxy pass:\n\n```\n$ a2enmod ssl proxy proxy_connect proxy_http\n```\n\nPer la configuració del site:\n\n_/etc/apache2/sites-available/001-ssl.conf_\n```\n<VirtualHost _default_:443>\n\n#Path on es deixa el contingut stàtic de l'aplicació Bridge\nDocumentRoot \"/var/www/html/saml\"\nServerName vagrant.vm\nServerAlias www.vagrant.vm\nServerAdmin admin@example.cat\nErrorLog \"/var/log/apache2/error_bridge.log\"\nTransferLog \"/var/log/apache2/access.log\"\n\nSSLEngine on\n\nSSLProxyEngine on\n\nProxyRequests Off\nProxyPreserveHost On\n\n#connexió amb l'aplicació Bridge\nProxyPass /bridge/ http://localhost:8080/bridge/\nProxyPassReverse /bridge/ http://localhost:8080/bridge/\n\n#connexió amb l'API de Canigó\nProxyPass /api/ http://localhost:9090/api/\nProxyPassReverse /api/ http://localhost:9090/api/\n\nSSLCipherSuite ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP:+eNULL\n\n#Certificats SSL\nSSLCertificateFile \"/etc/apache2/ssl/apache.crt\"\nSSLCertificateKeyFile \"/etc/apache2/ssl/apache.key\"\n\n<FilesMatch \"\\.(cgi|shtml|phtml|php)$\">\n    SSLOptions +StdEnvVars\n</FilesMatch>\n<Directory \"/usr/lib/cgi-bin\">\n    SSLOptions +StdEnvVars\n</Directory>\n\nBrowserMatch \".*MSIE.*\" \\\n         nokeepalive ssl-unclean-shutdown \\\n         downgrade-1.0 force-response-1.0\n\n\n</VirtualHost>\n```\n\nHabilitem el site amb la següent comanda:\n\n```\n$ a2ensite 001-ssl.conf\n```\n\nPer la configuració de l'accés SSL al site:\n\n_/etc/apache2/conf-available/ssl.conf_\n```\n<IfModule ssl_module>\n  Include sites-enabled/001-ssl.conf\n  SSLRandomSeed startup builtin\n  SSLRandomSeed connect builtin\n</IfModule>\n```\nI la seva activació:\n\n```\n$ a2enconf ssl\n```\n\n### Proves\n\nPer a provar el funcionament, accedir a https://vagrant.vm/bridge/app mitjançant un navegador web. Veurem que se'ns redirigeix al login de GICAR. Un cop introduïdes les credencials veurem que se'ns presenta la següent plana:\n\n![samldemo-app.png](/related/canigo/howto/imatges/201808_01_samldemo-app.png)\n\nAquesta és una plana web de demo inclosa en l'aplicació bridge, per proves del funcionament del mòdul de SAML:\n\n(1) **Get SAML assertion and convert to JWT token**: amb aquesta acció s'obté l'asserció SAML de GICAR i es genera el token JWT per interactuar amb el backend stateless Canigó\n\n(2) **Test API equipaments**: crida a la REST API d'equipaments que ofereix l'aplicació demo Canigó \"samldemo\" generada amb el plugin d'Eclipse. Aquesta crida incorpora el token JWT generat a partir de l'asserció SAML\n\n","objectID":"L2hvd3Rvcy8yMDE4LTA4LUNhbmlnby1TQU1M"},"L2hvd3Rvcy8yMDE4LTA0LWhvd3RvLWZyb250ZW5kLW11bHRpZW50b3Ju":{"date":1522800000000,"title":"Configuració multi-entorn a una SPA amb backend Canigó","description":"En aquest HowTo s'explica com aplicar una configuració multi-entorn per una SPA amb un backend Canigó","section":"howtos","categories":["canigo","sic"],"key":"ABRIL2018","path":"/howtos/2018-04-howto-frontend-multientorn","content":"### A qui va dirigit\n\nAquest how-to va dirigit a tots aquells desenvolupadors/arquitectes que desenvolupin una aplicació Canigó 3.2 amb una SPA per la part de frontend.\n\n### Versió de Canigó\n\nEls passos descrits en aquest document apliquen a la versió 3.2 del Framework Canigó.\n\n### Introducció\n\nLes aplicacions Canigó estan configurades per utilitzar propietats multi-entorn. Això vol dir que les propietats prenen un valor o un altre depenent de l'entorn on s'ha desplegat l'aplicació.\nAquesta funcionalitat de [configuració multi-entorn](/canigo-documentacio-versions-3x-core/modul-configuracio/) només aplica al backend de l'aplicació, el qual mitjançant la propietat de sistema \"entorn\" obté la informació específica de l'entorn on s'ha desplegat.\n\nEl frontend de l'aplicació (típicament SPAs) no disposa d'aquesta informació, i per tant, si no s'aplica alguna solució per configuració multi-entorn cal generar versions diferents per a cada entorn.\n\n### Solució de configuració multi-entorn \n\nCanigó ofereix l'endpoint **/api/info/properties** que retorna totes les propietats de l'aplicació per a l'entorn actual. \n\n<span style=\"color:red\">Aquest endpoint s'ha de protegir o bloquejar en entorns productius</style>\n\n\t@RestController\n\t@RequestMapping(\"/info/properties\")\n\tpublic class InfoPropertiesController {\n\n\t\t@Autowired\n\t\tprivate ICustomPropertyPlaceHolderConfigurer propertyConfigurer;\n\n\t\t@GetMapping(produces = MediaType.APPLICATION_JSON_VALUE)\n\t\tpublic Map<String, String> getInfoPropertiesLoaded() {\n\t\t\treturn propertyConfigurer.getResolvedProps();\n\t\t}\n\t}\n\nLa millor opció per a que el frontend pugui obtenir les propietats multi-entorn que siguin necessaries, seria que l'aplicació exposés un endpoint específic, també protegit, que retorni únicament les propietats necessàries pel frontend.\n\nLa primera vegada que la SPA es carregui, després d'obtenir el token JWT prèvia autenticació, hauria de fer una crida a aquest endpoint per a obtenir la configuració.\n\n\t@RestController\n\t@RequestMapping(\"/info/frontendProperties\")\n\tpublic class InfoFrontendPropertiesController {\n\n\t\t@Autowired\n\t\tprivate ICustomPropertyPlaceHolderConfigurer propertyConfigurer;\n\n\t\t@GetMapping(produces = MediaType.APPLICATION_JSON_VALUE)\n\t\tpublic Map<String, String> getInfoFrontendPropertiesLoaded() {\n\t\t\tMap<String, String> frontendProperties = propertyConfigurer.getResolvedProps();\n\n\t\t\t//FILTRAR frontendProperties i DEIXAR NOMÉS LES QUE NECESSITI EL FRONT-END\n\n\t\t\t return frontendProperties;\n\t\t}\n\t}\n\t\nPer exemple, si el frontend utilitzés la propietat: url.sgde i aquesta url és diferent a PRE i a PRO, al nostre fitxer de propietats hauríem de tenir:\n\n\tpre.url.sgde = http://preproduccio.sgde.intranet.gencat.cat/ServeisInvocacio/serveis/ServeisInvocacioV2?wsdl\n\tpro.url.sgde = http://sgde.intranet.gencat.cat/ServeisInvocacio/serveis/ServeisInvocacioV2?wsdl\n\t\nCom a informació addicional, per a configuracions amb informació sensible es recomana que s'injectin via variables d'entorn enlloc d'estar en fitxers de propietats dins el codi font.\n\n","objectID":"L2hvd3Rvcy8yMDE4LTA0LWhvd3RvLWZyb250ZW5kLW11bHRpZW50b3Ju"},"L2hvd3Rvcy8yMDE4LTEwLUhvd3RvLUdpdGZsb3ctZGVzZW52b2x1cGFtZW50LVNJQw==":{"date":1538438400000,"title":"Com aplicar GitFlow en desenvolupament d'aplicacions al SIC","description":"En aquest HowTo s'explica com utilitzar GitFlow en desenvolupament d'aplicacions al SIC","section":"howtos","categories":["sic"],"key":"NOVEMBRE2018","path":"/howtos/2018-10-Howto-Gitflow-desenvolupament-SIC","content":"## Audiència\n\nAquest how-to va dirigit principalment al personal tècnic (desenvolupadors i arquitectes) que treballin amb Git com a eina de control de versions de codi font.\n\n## Contexte\n\nEl SIC disposa d'un repositori Git (anomenat d'ara en endavant \"Git del SIC\" o \"SIC\" directament) on emmagatzemar i centralitzar les versions lliurables del codi.\n\nAmb anterioritat ja es va publicar un article [\"SIC. Branca Master al Git del SIC\"](https://canigo.ctti.gencat.cat/noticies/2018-03-05-SIC-Utilitzar-branca-master/) referent a quina era la metodologia recomanada per utilitzar el Git del SIC. I tot i que en aquest article es recomana l'ús de [trunk-based (o master-based)](https://continuousdelivery.com/foundations/continuous-integration/), ja que és la forma més natural de fer-ho en relació amb la filosofia del SIC actual, també és possible aplicar GitFlow en un Git de desenvolupament tenint en compte com es faria el pas al Git del SIC posteriorment.\n\nEn aquest context, el workflow de treball proposat es compon de 2 repositoris:\n\n1. El repositori amb el qual es realitza el desenvolupament o Git de desenvolupament: **origin**\n2. El repositori del SIC on es pugen els lliurables o Git del SIC: **gencat**\n\n## Workflows\n\nUn cop definits els 2 repositoris, el seu nom i rols, el mètode proposat per treballar de manera integrada amb el SIC, és seguir el workflow estàndard de GitFlow: una branca **develop** amb la línia de desenvolupament principal, i una branca **master** amb la línia de desplegaments a PRO.\n\n### Inicialització i integració (només la primera vegada)\n\n**IMPORTANT**: Aquest pas dóna per fet que el codi que hi ha al repositori **gencat** és més nou (i té precedència) respecte el repositori **origin**, es _recomana_ fer un backup (o _stash_) abans de continuar.\n\n```bash\ngit remote add gencat https://12345678A@git.intranet.gencat.cat/0123/ABC.git --tags -f -m master\ngit reset --hard ; git checkout -f\ngit pull --all\ngit checkout -t -b master-gencat gencat/master\n# merge inicial\ngit checkout master # origin/master\ngit merge --allow-unrelated-histories -Xtheirs master-gencat\ngit push\n#\n```\n\n### Baixada des del SIC\n\nEl workflow d'integracions de canvis és el següent: gencat/master -> origin/master -> origin/develop\n\n```bash\ngit reset --hard ; git checkout -f\ngit pull --all\n#\ngit checkout master # origin/master\ngit merge master-gencat\ngit push\n#\ngit checkout develop # origin/develop\ngit merge master\ngit push\n```\n\n### Desenvolupament amb GitFlow\n\nEl workflow de desenvolupament més popular per treballar amb Git és [GitFlow](https://datasift.github.io/gitflow/IntroducingGitFlow.html). Hi ha publicada molta documentació al respecte, i exposarem aquí únicament la metodologia aplicada a desenvolupament de noves funcionalitats (el cas més comú).\n\n1. Inicialització (només la primera vegada per a un mateix repositori)\n\n```bash\nsudo apt-get install git-flow\ngit flow init -d\n```\n\n2. Crear nova branca per una funcionalitat (manteniment, correctiu, sota demanda, etc.)\n\n```bash\n# Normalitzar el nom de la branca (p.e. a partir de una tasca JIRA)\n_FEATURE=\"INTEMO-1234 - Normalitzar i definir el procediment per treballar amb l'eina de  desenvolupament Git\"\n_FEATURE=$(echo $_FEATURE | sed -e 'y/ÀÁÈÉÌÍÒÓÙÚÜÇçÑñàáèéìíïòóùúü/AAEEIIOOUUUCcNnaaeeiiioouuu/' -e 's:[^-0-9A-Za-z]:_:g' -e 's:_\\{2,\\}:_:g' -e 's:^_::' -e s:_el_:_:g -e s:_l_:_:g -e s:_amb_:_:g -e s:_i_:_:g -e s:_-_:-:g -e 's:_$::' | cut -c-80)\ngit pull origin\ngit reset --hard ; git checkout -f\ngit checkout develop\ngit flow feature start $_FEATURE\n```\n\n3. Finalitzar i publicar la funcionalitat actual\n\n```bash\ngit pull origin\ngit commit -a\ngit flow feature publish && git flow feature finish && git push\n```\n\n4. Crear i publicar una nova release\n\n```bash\ngit flow release start\n# Un cop s'han integrat canvis d'última hora de DEVELOP (si escau)\n\ngit flow release finish\ngit push --tags\n```\n\n### Pujada a SIC\n\nEl workflow d'integracions de canvis és el següent: origin/develop -> origin/master -> gencat/master\n\n```bash\ngit reset --hard ; git checkout -f\ngit pull --all\n#\ngit checkout master # origin/master\ngit merge develop\ngit push\ngit push --tags\n#\ngit checkout master-gencat # gencat/master\ngit merge master\ngit push gencat master\ngit push gencat master --tags\n```\n\n\n\n## Informació adicional\n\n* https://services.github.com/on-demand/downloads/github-git-cheat-sheet.pdf\n* https://www.atlassian.com/git/tutorials/atlassian-git-cheatsheet\n* https://danielkummer.github.io/git-flow-cheatsheet/\n* https://www.toptal.com/software/trunk-based-development-git-flow\n\n## Annex. Inicialitzar el repositori\n\nEl HowTo dóna per fet que es disposa d'un codi repositat amb Git, però pot donar-se el cas que el codi no sigui així. Aquest annex adreça aquesta situació.\n\nPer inicialitzar el repositori s'ha de seguir les següents passes (bash):\n\n```bash\ndie () {\n  echo ERROR $*\n  exit $1\n}\ndo_repo_git_init () {\n  \n  # carpeta temporal de treball\n  local _CARPETA_GIT_NOU=/tmp/repogitnou\n\n  rm -fr $_CARPETA_GIT_NOU 2>/dev/null\n  mkdir -p $_CARPETA_GIT_NOU || die 1 # crea la carpeta temporal de treball\n  cd $_CARPETA_GIT_NOU || die 2\n  echo \">> Ara s'ha de copiar el codi del projecte en aquesta carpeta : $_CARPETA_GIT_NOU <<\"\n  echo \"Premi INTRO per continuar...\" && read\n  git init || die 3\n  cat>>.gitignore<<EOF\n.settings/\n.project\n.classpath\nbin/\ntarget/\nEOF\n  git status\n}\ndo_repo_git_init\n```\n\n","objectID":"L2hvd3Rvcy8yMDE4LTEwLUhvd3RvLUdpdGZsb3ctZGVzZW52b2x1cGFtZW50LVNJQw=="},"L2hvd3Rvcy8yMDE4LTEwLTE2LUhvd3RvLVVzLXRpcHVzLWpzb24tYS1qcGE=":{"date":1539687856000,"title":"Suport a tipus de dades JSON al mòdul de persistència de Canigó","description":"Aquest howTo descriu com utilitzar el tipus de dada JSON existent a PostgreSQL i MySql amb JPA","sections":"Canigó. Documentació versió 3.x","weight":8,"path":"/howtos/2018-10-16-Howto-Us-tipus-json-a-jpa","content":"## A qui va dirigit\n\nAquest Howto va dirigit a perfils tècnics que vulguin utilitzar el tipus de columna JSON a bases de dades PostgreSQL i MySQL mitjançant JPA i Hibernate com a proveïdor\n\n## Versió de Canigó\n\nEls passos descrits en aquest document apliquen a la versió 3.2.6 del Framework Canigó\n\n## Introducció\n\nAl Setembre del 2018 s’ha publicat la versió 3.2.6 del Framework Canigó. En aquesta 3.2.6 s'incorpora el suport a bases de dades PostgreSQL. A partir dels seus dialectes, Hibernate dona suport a tipus de columnes JSON a PostgreSQL i MySQL, però al no ser un estàndard per a totes les bases de dades relacionals, per aquest tipus de columna, Hibernate no proporciona una implementació pel mapeig entre els objectes Java i la base de dades.\n\nL’objectiu d’aquest Howto és mostrar els procediments necessaris per a poder utilitzar els tipus de columna JSON amb PostgreSQL i MySQL utilitzant Hibernate i JPA.\n\n## Dialectes hibernate\n\n### PostgreSQL\n\nSi s'utilitza una base de dades de tipus PostgreSQL, el mòdul \"canigo.persistence.jpa\" a partir d'Hibernate proporciona els següents dialectes:\n\n- org.hibernate.dialect.PostgreSQL82Dialect mateix que org.hibernate.dialect.PostgreSQLDialect\n- org.hibernate.dialect.PostgreSQL9Dialect: BD Postgres 9 amb suport a \"if exists\" quan s'eliminen constraints\n- org.hibernate.dialect.PostgreSQL92Dialect: BD Postgres 9.2 amb suport a JSON data type\n- org.hibernate.dialect.PostgreSQL94Dialect: BD Postgres 9.4 amb suport a funcions de dates i temps\n\nLes versions més noves incorporen les funcionalitats de les versions anteriors.\n\nAixí, si es vol utilitzar un tipus de columna JSON, la versió de PostgreSQL ha de ser a igual o superior a 9.2 i utilitzar com a mínim el dialecte org.hibernate.dialect.PostgreSQL92Dialect\n\n### MySql\n\nSi s'útilitza una bd de tipus MySql, el mòdul canigo.persistence.jpa a partir de hiberntate proporciona els següents dialectes:\n\n- org.hibernate.dialect.MySQLDialect: Per versions de la bd inferiors a 5\n- org.hibernate.dialect.MySQL5Dialect: Per versions de la bd 5.x\n- org.hibernate.dialect.MySQL5InnoDBDialec: Per versions de la bd 5.x amb InnoDB\n- org.hibernate.dialect.MySQL57InnoDBDialect: Per versions de la bd 5.x amb InnoDB amb suport a fractal seconds precision (fsp)\n\nLes versions més noves incorporen les funcionalitats de les versions anteriors.\n\nAixí, si es vol utilitzar un tipus de columna JSON, la versió de MySql ha de ser igual o superior a 5.7 i utilitzar com a mínim el dialecte org.hibernate.dialect.MySQL5Dialect\n\n## Hibernate JSON type\n\nEl mòdul canigo.persistence.jpa, a partir de la versió 1.3.1, proporciona una implementació pel mapeig entre els objectes Java i la base de dades mitjançant Hibernate. Els tipus són:\n\n- **cat.gencat.ctti.canigo.arch.persistence.jpa.hibernate.type.json.JsonStringType**: Per a tipus de columna JSON de tipus text \n- **cat.gencat.ctti.canigo.arch.persistence.jpa.hibernate.type.json.JsonBinaryType**: Per a tipus de columna JSON de tipus binari \n- **cat.gencat.ctti.canigo.arch.persistence.jpa.hibernate.type.json.JsonNodeBinaryType**: Per a tipus de columna JSON de tipus binari emmagatzemant JSON Node\n\nAquests, realitzen el binding d'informació entre la base de dades i els objectes Java a partir de [Jackson](https://github.com/FasterXML/jackson).\n\n## Carregar Hibernate JSON type\n\n### Postgres\n\nPostgreSQL a partir de la versió 9.2 dona suport als tipus:\n\n- json\n- jsonb\n\nAquests tipus són emmagatzemats amb binari per tant serà necessari utilitzar:\n\n- cat.gencat.ctti.canigo.arch.persistence.jpa.hibernate.type.json.JsonBinaryType\n- cat.gencat.ctti.canigo.arch.persistence.jpa.hibernate.type.json.JsonNodeBinaryType\n\n### MySQL\n\nMySQL a partir de la versió 5.7 dona suport als tipus:\n\n- json\n\nAquests tipus són emmagatzemats amb text per tant serà necessari utilitzar:\n\n- cat.gencat.ctti.canigo.arch.persistence.jpa.hibernate.type.json.JsonStringType\n\nPerquè hibernate carregui aquests tipus de mapeig es necessari utilitzar @TypeDefs, així per exemple si tenim una classe base comuna podem tenir per exemple:\n\n```\nimport javax.persistence.GeneratedValue;\nimport javax.persistence.Id;\nimport javax.persistence.MappedSuperclass;\n\nimport org.hibernate.annotations.GenericGenerator;\nimport org.hibernate.annotations.TypeDef;\nimport org.hibernate.annotations.TypeDefs;\n\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.hibernate.type.json.JsonBinaryType;\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.hibernate.type.json.JsonNodeBinaryType;\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.hibernate.type.json.JsonStringType;\n\n@TypeDefs({ @TypeDef(name = \"json\", typeClass = JsonStringType.class),\n\t\t@TypeDef(name = \"jsonb\", typeClass = JsonBinaryType.class),\n\t\t@TypeDef(name = \"jsonb-node\", typeClass = JsonNodeBinaryType.class), })\n@MappedSuperclass\npublic class BaseEntity {\n\n\t@Id\n\t@GeneratedValue(generator = \"generator\")\n\t@GenericGenerator(name = \"generator\", strategy = \"increment\")\n\tprivate Long id;\n\n\tpublic Long getId() {\n\t\treturn id;\n\t}\n\n\tpublic void setId(Long id) {\n\t\tthis.id = id;\n\t}\n\n}\n```\n\n## Exemple utilització hibernate JSON type\n\nPer l'exemple utilitzarem l'entitat Event que emmagatzema una entitat Location amb la informació de la country i la city\nPer l'entitat Location utilitzarem:\n\n```\nimport java.io.Serializable;\n\npublic class Location implements Serializable {\n\n    private String country;\n\n    private String city;\n\n    public String getCountry() {\n        return country;\n    }\n\n    public void setCountry(String country) {\n        this.country = country;\n    }\n\n    public String getCity() {\n        return city;\n    }\n\n    public void setCity(String city) {\n        this.city = city;\n    }\n}\n```\n\n### PostgreSQL\n\nNecessitem crear la taula Event:\n\n- Si la columna es de tipus json:\n\n```\nCREATE TABLE \"event\" (\n\tID serial PRIMARY KEY,\n\t\"location\" json NOT NULL\n);\n```\n\n- Si la columna es de tipus jsonb:\n\n```\nCREATE TABLE \"event\" (\n\tID serial PRIMARY KEY,\n\t\"location\" jsonb NOT NULL\n);\n```\n\nAixí tindrem les entitats:\n\n- Si la columna és de tipus json i volem emmagatzemar l'objecte Location utilitzarem @Column(columnDefinition = \"json\") amb @Type(type = \"jsonb\"):\n\n```\nimport javax.persistence.Column;\nimport javax.persistence.Entity;\nimport javax.persistence.Table;\n\nimport org.hibernate.annotations.Type;\n\n@Entity(name = \"EventJson\")\n@Table(name = \"event\")\npublic class EventJson extends BaseEntity {\n\n    @Type(type = \"jsonb\")\n    @Column(columnDefinition = \"json\")\n    private Location location;\n\n    public Location getLocation() {\n        return location;\n    }\n\n    public void setLocation(Location location) {\n        this.location = location;\n    }\n}\n```\n\n- Si la columna és de tipus jsonb i volem emmagatzemar l'objecte Location utilitzarem @Column(columnDefinition = \"jsonb\") amb @Type(type = \"jsonb\"):\n\n```\nimport javax.persistence.Basic;\nimport javax.persistence.Column;\nimport javax.persistence.Entity;\nimport javax.persistence.FetchType;\nimport javax.persistence.Table;\n\nimport org.hibernate.annotations.Type;\n\n@Entity(name = \"EventJsonb\")\n@Table(name = \"event\")\npublic class EventJsonb extends BaseEntity {\n\n    @Type(type = \"jsonb\")\n    @Column(columnDefinition = \"jsonb\")\n    @Basic( fetch = FetchType.LAZY )\n    private Location location;\n\n    public Location getLocation() {\n        return location;\n    }\n\n    public void setLocation(Location location) {\n        this.location = location;\n    }\n}\n```\n\n- Si la columna és de tipus jsonb i volem emmagatzemar un objecte JsonNode utilitzarem @Column(columnDefinition = \"jsonb\") amb @Type(type = \"jsonb-node\"):\n\n```\nimport javax.persistence.Column;\nimport javax.persistence.Entity;\nimport javax.persistence.Table;\n\nimport org.hibernate.annotations.Type;\n\nimport com.fasterxml.jackson.databind.JsonNode;\n\n@Entity(name = \"EventJsonbNode\")\n@Table(name = \"event\")\npublic class EventJsonbNode extends BaseEntity {\n\n\t@Type(type = \"jsonb-node\")\n\t@Column(columnDefinition = \"jsonb\")\n\tprivate JsonNode location;\n\n    public JsonNode getLocation() {\n        return location;\n    }\n\n    public void setLocation(JsonNode location) {\n        this.location = location;\n    }\n}\n```\n\nAmb els repositoris:\n\n```\nimport java.util.List;\n\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.model.json.postgres.EventJson;\n\npublic interface EventJsonBaseRepositoryCustom {\n\n\tpublic List<EventJson> findCountryEvents(String country);\n\t\n}\n```\n\n```\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.model.json.postgres.EventJsonbNode;\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.repository.GenericRepository;\n\npublic interface EventJsonbNodeRepository extends GenericRepository<EventJsonbNode, Long>, EventJsonbNodeRepositoryCustom {\n\n}\n\n```\n\n```\npublic interface EventJsonbNodeRepositoryCustom extends EventJsonBaseRepositoryCustom {\n\n}\n```\n\n```\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.model.json.postgres.EventJsonb;\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.repository.GenericRepository;\n\npublic interface EventJsonbRepository extends GenericRepository<EventJsonb, Long>, EventJsonbRepositoryCustom {\n\n}\n```\n\n```\npublic interface EventJsonbRepositoryCustom extends EventJsonBaseRepositoryCustom {\n\n}\n```\n\n```\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.model.json.postgres.EventJson;\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.repository.GenericRepository;\n\npublic interface EventJsonRepository extends GenericRepository<EventJson, Long>, EventJsonRepositoryCustom {\n\n}\n```\n\n```\npublic interface EventJsonRepositoryCustom extends EventJsonBaseRepositoryCustom {\n\n}\n```\n\nI les implementacions dels respositoris:\n\n```\nimport java.util.List;\n\nimport org.springframework.data.jpa.repository.support.QueryDslRepositorySupport;\n\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.model.json.postgres.EventJson;\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.repository.json.postgres.EventJsonBaseRepositoryCustom;\n\npublic abstract class EventJsonBaseRepositoryImpl extends QueryDslRepositorySupport implements EventJsonBaseRepositoryCustom {\n\n\tpublic EventJsonBaseRepositoryImpl(Class<?> domainClass) {\n\t\tsuper(domainClass);\n\t}\n\n\t@Override\n\tpublic List<EventJson> findCountryEvents(String country) {\n\t\treturn getEntityManager()\n\t\t\t\t.createNativeQuery(\"SELECT id, location FROM event WHERE location->> 'country' = :country\", EventJson.class)\n\t\t\t\t.setParameter(\"country\", country).getResultList();\n\t}\n\t\n}\n```\n\n```\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.context.annotation.Lazy;\n\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.model.json.postgres.EventJsonbNode;\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.repository.json.postgres.EventJsonbNodeRepository;\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.repository.json.postgres.EventJsonbNodeRepositoryCustom;\n\npublic class EventJsonbNodeRepositoryImpl extends EventJsonBaseRepositoryImpl implements EventJsonbNodeRepositoryCustom {\n\n\t@Autowired\n\t@Lazy\n\tprivate EventJsonbNodeRepository eventRepository;\n\n\tpublic EventJsonbNodeRepositoryImpl() {\n\t\tsuper(EventJsonbNode.class);\n\t}\n\n}\n```\n\n```\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.context.annotation.Lazy;\n\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.model.json.postgres.EventJsonb;\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.repository.json.postgres.EventJsonbRepository;\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.repository.json.postgres.EventJsonbRepositoryCustom;\n\npublic class EventJsonbRepositoryImpl extends EventJsonBaseRepositoryImpl implements EventJsonbRepositoryCustom {\n\n\t@Autowired\n\t@Lazy\n\tprivate EventJsonbRepository eventRepository;\n\n\tpublic EventJsonbRepositoryImpl() {\n\t\tsuper(EventJsonb.class);\n\t}\n\n}\n```\n\n```\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.context.annotation.Lazy;\n\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.model.json.postgres.EventJson;\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.repository.json.postgres.EventJsonRepository;\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.repository.json.postgres.EventJsonRepositoryCustom;\n\npublic class EventJsonRepositoryImpl extends EventJsonBaseRepositoryImpl implements EventJsonRepositoryCustom {\n\n\t@Autowired\n\t@Lazy\n\tprivate EventJsonRepository eventRepository;\n\n\tpublic EventJsonRepositoryImpl() {\n\t\tsuper(EventJson.class);\n\t}\n\n}\n```\n\nPer a implementar la funció \"findCountryEvents\" utilitzarem la query nativa:\n\n```\nSELECT id, location FROM event WHERE location->> 'country' = :country\n```\n\nOn :country serà el valor dinàmic passat per paràmetre\n\n### MySQL\n\nNecessitem crear la taula Event:\n\n```\nCREATE TABLE event (\n\tID bigint PRIMARY KEY,\n\tlocation json NOT NULL\n);\n```\n\nAixí tindrem la entitat:\n\n```\nimport javax.persistence.Column;\nimport javax.persistence.Entity;\nimport javax.persistence.Table;\n\nimport org.hibernate.annotations.Type;\n\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.model.json.BaseEntity;\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.model.json.Location;\n\n@Entity(name = \"EventJson\")\n@Table(name = \"event\")\npublic class EventJson extends BaseEntity {\n\n    @Type(type = \"json\")\n    @Column(columnDefinition = \"json\")\n    private Location location;\n\n    public Location getLocation() {\n        return location;\n    }\n\n    public void setLocation(Location location) {\n        this.location = location;\n    }\n}\n```\n\nAmb els repositoris:\n\n```\nimport java.util.List;\n\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.model.json.mysql.EventJson;\n\npublic interface EventJsonBaseRepositoryCustom {\n\n\tpublic List<EventJson> findCountryEvents(String country);\n\t\n}\n```\n\n```\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.model.json.mysql.EventJson;\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.repository.GenericRepository;\n\npublic interface EventJsonRepository extends GenericRepository<EventJson, Long>, EventJsonRepositoryCustom {\n\n}\n```\n\n```\npublic interface EventJsonRepositoryCustom extends EventJsonBaseRepositoryCustom {\n\n}\n```\n\nI les implementacions dels respositoris:\n\n```\nimport java.util.List;\n\nimport org.springframework.data.jpa.repository.support.QueryDslRepositorySupport;\n\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.model.json.mysql.EventJson;\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.repository.json.mysql.EventJsonBaseRepositoryCustom;\n\npublic abstract class EventJsonBaseRepositoryImpl extends QueryDslRepositorySupport implements EventJsonBaseRepositoryCustom {\n\n\tpublic EventJsonBaseRepositoryImpl(Class<?> domainClass) {\n\t\tsuper(domainClass);\n\t}\n\n\t@Override\n\tpublic List<EventJson> findCountryEvents(String country) {\n\t\treturn getEntityManager()\n\t\t\t\t.createNativeQuery(\"SELECT id, location FROM event WHERE JSON_EXTRACT(location, \\\"$.country\\\") = :country\", EventJson.class)\n\t\t\t\t.setParameter(\"country\", country).getResultList();\n\t}\n\t\n}\n```\n\n```\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.context.annotation.Lazy;\n\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.model.json.mysql.EventJson;\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.repository.json.mysql.EventJsonRepository;\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.repository.json.mysql.EventJsonRepositoryCustom;\n\npublic class EventJsonRepositoryImpl extends EventJsonBaseRepositoryImpl implements EventJsonRepositoryCustom {\n\n\t@Autowired\n\t@Lazy\n\tprivate EventJsonRepository eventRepository;\n\n\tpublic EventJsonRepositoryImpl() {\n\t\tsuper(EventJson.class);\n\t}\n\n}\n```\n\nPer a implementar la funció \"findCountryEvents\" utilitzarem la query nativa:\n\n```\nSELECT id, location FROM event WHERE JSON_EXTRACT(location, \\\"$.country\\\") = :country\n```\n\nOn :country serà el valor dinàmic passat per paràmetre\n\n## Test utilització hibernate JSON type\n\nEls tipus de bd JSON no estan suportats per la bd H2, per tant els test s'han d'executar atacant a una bd real\n\n### PostgreSQL\n\nPer provar els repositoris tindrem els tests:\n\n```\nimport java.util.List;\n\nimport org.junit.Assert;\nimport org.junit.Before;\nimport org.junit.FixMethodOrder;\nimport org.junit.runners.MethodSorters;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.test.context.ContextConfiguration;\n\nimport com.fasterxml.jackson.databind.JsonNode;\n\nimport cat.gencat.ctti.canigo.arch.core.utils.JacksonUtil;\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.model.json.postgres.EventJson;\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.model.json.postgres.EventJsonbNode;\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.repository.json.postgres.EventJsonbNodeRepository;\n\n\n@RunWith(SpringJUnit4ClassRunner.class)\n@ContextConfiguration(locations = {\"classpath:spring/canigo-core.xml\"})\n@FixMethodOrder(MethodSorters.NAME_ASCENDING)\npublic class EventJsonbNodeRepositoryTest {\n\t\n\t@Autowired\n\tprivate EventJsonbNodeRepository repository;\n\n\t@Before\n\tpublic void settingUp(){\n\t\tAssert.assertNotNull(repository);\n\t\trepository.deleteAll();\n\t}\n\n\t@Test\n\tpublic void test1CRUDOperations(){\n\n\t\t//Test if table is empty\n\t\tAssert.assertTrue(repository.findAll().isEmpty());\n\t\t\n\t\t//Test save\n\t\tJsonNode location = JacksonUtil.toJsonNode(\n                \"{\" +\n                \"   \\\"country\\\": \\\"Romania\\\",\" +\n                \"   \\\"city\\\": \\\"Cluj-Napoca\\\"\" +\n                \"}\"\n            );\n\t\t\n        EventJsonbNode event = new EventJsonbNode();\n        event.setLocation(location);\n\t\trepository.save(event);\n\n\t\t//Test insert and recover\n\t\tEventJsonbNode event2 = new EventJsonbNode();\n\t\tevent2.setLocation(location);\n\t\trepository.save(event2);\n\t\tEventJsonbNode event3 = repository.findOne(event2.getId());\n\t\tAssert.assertEquals(event3.getId(), event2.getId());\n\t\tAssert.assertEquals(event3.getLocation().get(\"country\").asText(), location.get(\"country\").asText());\n\t\tAssert.assertEquals(event3.getLocation().get(\"city\").asText(), location.get(\"city\").asText());\n\t\t\n\t\t//Test delete all\n\t\trepository.deleteAll();\n\t\tAssert.assertTrue(repository.findAll().isEmpty());\n\t\t\n\t}\n\t\n\t\n\t@Test\n\tpublic void testCountryEvents() {\n\t\tJsonNode location = JacksonUtil.toJsonNode(\n                \"{\" +\n                \"   \\\"country\\\": \\\"Romania\\\",\" +\n                \"   \\\"city\\\": \\\"Cluj-Napoca\\\"\" +\n                \"}\"\n            );\n\t\t\n        EventJsonbNode event = new EventJsonbNode();\n        event.setLocation(location);\n\t\trepository.save(event);\n\t\t\n\t\tList<EventJson> eventJsonList = repository.findCountryEvents(location.get(\"country\").asText());\n\t\tfor (EventJson event3 : eventJsonList) {\n\t\t\tAssert.assertEquals(event3.getLocation().getCountry(), location.get(\"country\").asText());\n\t\t}\n\n\t\t// Test delete all\n\t\trepository.deleteAll();\n\t\tAssert.assertTrue(repository.findAll().isEmpty());\n\t}\n\t\n}\n```\n\n```\nimport java.util.List;\n\nimport org.junit.Assert;\nimport org.junit.Before;\nimport org.junit.FixMethodOrder;\nimport org.junit.runners.MethodSorters;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.test.context.ContextConfiguration;\n\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.model.json.Location;\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.model.json.postgres.EventJson;\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.model.json.postgres.EventJsonb;\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.repository.json.postgres.EventJsonbRepository;\n\n@RunWith(SpringJUnit4ClassRunner.class)\n@ContextConfiguration(locations = {\"classpath:spring/canigo-core.xml\"})\n@FixMethodOrder(MethodSorters.NAME_ASCENDING)\npublic class EventJsonbRepositoryTest {\n\t\n\t@Autowired\n\tprivate EventJsonbRepository repository;\n\n\t@Before\n\tpublic void settingUp(){\n\t\tAssert.assertNotNull(repository);\n\t\trepository.deleteAll();\n\t}\n\n\t@Test\n\tpublic void test1CRUDOperations(){\n\n\t\t//Test if table is empty\n\t\tAssert.assertTrue(repository.findAll().isEmpty());\n\t\t\n\t\t//Test save\n        Location location = new Location();\n        location.setCountry(\"Romania\");\n        location.setCity(\"Cluj-Napoca\");\n\n        EventJsonb event = new EventJsonb();\n        event.setLocation(location);\n\t\trepository.save(event);\n\n\t\t//Test insert and recover\n\t\tEventJsonb event2 = new EventJsonb();\n\t\tevent2.setLocation(location);\n\t\trepository.save(event2);\n\t\tEventJsonb event3 = repository.findOne(event2.getId());\n\t\tAssert.assertEquals(event3.getId(), event2.getId());\n\t\tAssert.assertEquals(event3.getLocation().getCountry(), location.getCountry());\n\t\tAssert.assertEquals(event3.getLocation().getCity(), location.getCity());\n\t\t\n\t\t//Test delete all\n\t\trepository.deleteAll();\n\t\tAssert.assertTrue(repository.findAll().isEmpty());\n\t\t\n\t}\n\t\n\t@Test\n\tpublic void testCountryEvents() {\n\t\tLocation location = new Location();\n\t\tlocation.setCountry(\"Romania\");\n\t\tlocation.setCity(\"Cluj-Napoca\");\n\n\t\tEventJsonb event = new EventJsonb();\n\t\tevent.setLocation(location);\n\t\trepository.save(event);\n\t\t\n\t\tList<EventJson> eventJsonList = repository.findCountryEvents(location.getCountry());\n\t\tfor (EventJson event3 : eventJsonList) {\n\t\t\tAssert.assertEquals(event3.getLocation().getCountry(), location.getCountry());\n\t\t}\n\n\t\t// Test delete all\n\t\trepository.deleteAll();\n\t\tAssert.assertTrue(repository.findAll().isEmpty());\n\t}\n\t\n}\n```\n\n```\nimport java.util.List;\n\nimport org.junit.Assert;\nimport org.junit.Before;\nimport org.junit.FixMethodOrder;\nimport org.junit.runners.MethodSorters;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.test.context.ContextConfiguration;\n\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.model.json.Location;\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.model.json.postgres.EventJson;\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.repository.json.postgres.EventJsonRepository;\n\n\n@RunWith(SpringJUnit4ClassRunner.class)\n@ContextConfiguration(locations = { \"classpath:spring/canigo-core.xml\" })\n@FixMethodOrder(MethodSorters.NAME_ASCENDING)\npublic class EventJsonRepositoryTest {\n\n\t@Autowired\n\tprivate EventJsonRepository repository;\n\n\t@Before\n\tpublic void settingUp() {\n\t\tAssert.assertNotNull(repository);\n\t\trepository.deleteAll();\n\t}\n\n\t@Test\n\tpublic void test1CRUDOperations() {\n\n\t\t// Test if table is empty\n\t\tAssert.assertTrue(repository.findAll().isEmpty());\n\n\t\t// Test save\n\t\tLocation location = new Location();\n\t\tlocation.setCountry(\"Romania\");\n\t\tlocation.setCity(\"Cluj-Napoca\");\n\n\t\tEventJson event = new EventJson();\n\t\tevent.setLocation(location);\n\t\trepository.save(event);\n\n\t\t// Test insert and recover\n\t\tEventJson event2 = new EventJson();\n\t\tevent2.setLocation(location);\n\t\trepository.save(event2);\n\t\tEventJson event3 = repository.findOne(event2.getId());\n\t\tAssert.assertEquals(event3.getId(), event2.getId());\n\t\tAssert.assertEquals(event3.getLocation().getCountry(), location.getCountry());\n\t\tAssert.assertEquals(event3.getLocation().getCity(), location.getCity());\n\n\t\t// Test delete all\n\t\trepository.deleteAll();\n\t\tAssert.assertTrue(repository.findAll().isEmpty());\n\n\t}\n\n\t@Test\n\tpublic void testCountryEvents() {\n\t\tLocation location = new Location();\n\t\tlocation.setCountry(\"Romania\");\n\t\tlocation.setCity(\"Cluj-Napoca\");\n\n\t\tEventJson event = new EventJson();\n\t\tevent.setLocation(location);\n\t\trepository.save(event);\n\t\t\n\t\tList<EventJson> eventJsonList = repository.findCountryEvents(location.getCountry());\n\t\tfor (EventJson event3 : eventJsonList) {\n\t\t\tAssert.assertEquals(event3.getLocation().getCountry(), location.getCountry());\n\t\t}\n\n\t\t// Test delete all\n\t\trepository.deleteAll();\n\t\tAssert.assertTrue(repository.findAll().isEmpty());\n\t}\n\n}\n```\n\nATENCIÓ: Per executar aquests tests és necessari atacar a una bd PostgreSQL real\n\n### MySQL\n\nPer provar els repositoris tindrem el test:\n\n```\nimport java.util.List;\n\nimport org.junit.Assert;\nimport org.junit.Before;\nimport org.junit.FixMethodOrder;\nimport org.junit.Test;\nimport org.junit.runner.RunWith;\nimport org.junit.runners.MethodSorters;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.test.context.ContextConfiguration;\nimport org.springframework.test.context.junit4.SpringJUnit4ClassRunner;\n\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.model.json.Location;\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.model.json.mysql.EventJson;\nimport cat.gencat.ctti.canigo.arch.persistence.jpa.repository.json.mysql.EventJsonRepository;\n\n@RunWith(SpringJUnit4ClassRunner.class)\n@ContextConfiguration(locations = { \"classpath:spring/canigo-core.xml\" })\n@FixMethodOrder(MethodSorters.NAME_ASCENDING)\npublic class EventJsonRepositoryTest {\n\n\t@Autowired\n\tprivate EventJsonRepository repository;\n\n\t@Before\n\tpublic void settingUp() {\n\t\tAssert.assertNotNull(repository);\n\t\trepository.deleteAll();\n\t}\n\n\t@Test\n\tpublic void test1CRUDOperations() {\n\n\t\t// Test if table is empty\n\t\tAssert.assertTrue(repository.findAll().isEmpty());\n\n\t\t// Test save\n\t\tLocation location = new Location();\n\t\tlocation.setCountry(\"Romania\");\n\t\tlocation.setCity(\"Cluj-Napoca\");\n\n\t\tEventJson event = new EventJson();\n\t\tevent.setLocation(location);\n\t\trepository.save(event);\n\n\t\t// Test insert and recover\n\t\tEventJson event2 = new EventJson();\n\t\tevent2.setLocation(location);\n\t\trepository.save(event2);\n\t\tEventJson event3 = repository.findOne(event2.getId());\n\t\tAssert.assertEquals(event3.getId(), event2.getId());\n\t\tAssert.assertEquals(event3.getLocation().getCountry(), location.getCountry());\n\t\tAssert.assertEquals(event3.getLocation().getCity(), location.getCity());\n\n\t\t// Test delete all\n\t\trepository.deleteAll();\n\t\tAssert.assertTrue(repository.findAll().isEmpty());\n\n\t}\n\n\t@Test\n\tpublic void testCountryEvents() {\n\t\tLocation location = new Location();\n\t\tlocation.setCountry(\"Romania\");\n\t\tlocation.setCity(\"Cluj-Napoca\");\n\n\t\tEventJson event = new EventJson();\n\t\tevent.setLocation(location);\n\t\trepository.save(event);\n\t\t\n\t\tList<EventJson> eventJsonList = repository.findCountryEvents(location.getCountry());\n\t\tfor (EventJson event3 : eventJsonList) {\n\t\t\tAssert.assertEquals(event3.getLocation().getCountry(), location.getCountry());\n\t\t}\n\n\t\t// Test delete all\n\t\trepository.deleteAll();\n\t\tAssert.assertTrue(repository.findAll().isEmpty());\n\t}\n\n}\n```\n\nATENCIÓ: Per executar aquests tests és necessari atacar a una bd MySQL real\n","objectID":"L2hvd3Rvcy8yMDE4LTEwLTE2LUhvd3RvLVVzLXRpcHVzLWpzb24tYS1qcGE="},"L2hvd3Rvcy8yMDE5LTAzLUhvd1RvLURlZmluaWNpby1zb25kZXMtYXBsaWNhY2lvbnMtQ2FuaWdvLUFwcEFnaWxl":{"date":1549756800000,"title":"HowTo Definició sondes per aplicacions Canigó a AppAgile","description":"Definició sondes per aplicacions Canigó a AppAgile utilitzant livenessProbe i readinessProbe","section":"howtos","categories":["canigo","cloud"],"key":"MARC2018","path":"/howtos/2019-03-HowTo-Definicio-sondes-aplicacions-Canigo-AppAgile","content":"## Definició sondes per aplicacions Canigó a AppAgile\n\nLa plataforma de contenidors [AppAgile](https://canigo.ctti.gencat.cat/cloud/contenidors_appagile/) proporciona un sistema de sondes per validar si un servei està iniciat i en funcionament.\n\nAmb Spring Boot, gràcies a la llibreria **spring-boot-starter-actuator**, es pot definir un endpoint de health per expossar aquesta comprovació en una aplicació Canigó.\n\nDes del descriptor \"yml\" dels contenidors AppAgile es pot lligar les funcionalitats de health que proporciona Spring Boot amb la funcionalitat que proporciona AppAgile per comprovar si un servei està iniciat i en funcionament. Si un servei no està iniciat, AppAgile el reiniciarà i si no dona servei no li enrutarà peticions fins que torni a donar servei.\n\nLes seccions del descriptor \"yml\" dels contenidors AppAgile per afegir aquestes funcionalitats de health són **livenessProbe** i **readinessProbe**.\n\nSi només hi ha una rèplica d'un servei a l'AppAgile, i aquest amb les comprovacions de readinessProbe determina que el servei està ocupat i no pot atendre peticions, retornarà un error a les següents crides que es facin, indicant que no hi ha cap servei disponible per atendre-les.\n\nLes comprovacions que es poden realitzar són l'execució d'una **commanda** (exec), la crida a un **port** (port) o una crida **http** (httpGet)\n\nExemples de cada un:\n\n- Execució d'una commanda:\n```\n  exec:\n      command:\n        - ...\n```\n\n- Crida a un port:\n```\n  tcpSocket:\n      port: \n```\n\n- Crida http:\n```\n  httpGet:\n    \tpath: \n    \tport: \n    \tscheme:\n```\n\nRecomanem l'utilització de comprovacions de tipus crida a un port o crida http.\n\nA més del tipus de comprovació hi ha els següents paràmetres configurables:\n\n- **failureThreshold**: Número màxim de comprovacions errònies per la qual AppAgile realitzarà les accions de reiniciar el servei o no servir crides\n- **initialDelaySeconds**: Número de segons de delay per començar a fer les comprovacions. Recomanem aplicar un temps igual o superior a 600 segons\n- **periodSeconds**: Amb quina freqüència es realitza la comprovació\n- **successThreshold**: Número pel qual es considera que la comprovació és correcte\n- **timeoutSeconds**: Número de segons pel qual es considera que la comprovació s'ha d'abortar i per tant és incorrecte\n\nAixí per exemple, podríem tenir el cas d'un procés extern al del servei que necessitem que estigui iniciat. Si aquest procés cau, necessitem que es reinici el servei o podríem tenir el cas que un servei utilitzi molts recursos del servidor i necessitem que el servidor se centri en resoldre les crides a aquest servei abans de proporcionar servei a altres crides\n\n### Exemple de com configurar un servei que reinicï el servidor si un procés extern cau:\n\nAnem a implementar un servei propi de health de Spring Boot que comprovi si un procés de LibreOffice està aixecat al mateix contenidor:\n\n1. Afegir al pom.xml la dependencia de spring-boot-actuator:\n\n``` xml\n\t\t<dependency>\n\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t<artifactId>spring-boot-starter-actuator</artifactId>\n\t\t\t<exclusions>\n\t\t\t\t<exclusion>\n\t\t\t\t\t<artifactId>spring-boot-starter-logging</artifactId>\n\t\t\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t\t</exclusion>\n\t\t\t</exclusions>\n\t\t</dependency>\n```\n\t\t\n2. Al fitxer boot.properties afegir l'exposició només del servei de health amb detall. També afegim la propietat per excloure la resta de serveis:\n\n``` properties\nmanagement.endpoints.web.exposure.include=health\nmanagement.endpoint.health.show-details=always\nmanagement.security.enabled=false\nmanagement.endpoints.jmx.exposure.exclude=*\n```\n\n3. Crearem un HealthIndicator propi extenent de *org.springframework.boot.actuate.health.AbstractHealthIndicator*\n\n``` java\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.boot.actuate.health.AbstractHealthIndicator;\nimport org.springframework.boot.actuate.health.Health;\nimport org.springframework.stereotype.Component;\n\nimport cat.gencat.ctti.std.conversio.libre.office.ConversioLibreOffice;\nimport cat.gencat.ctti.std.conversio.libre.office.constants.ConversioLibreOfficeConstants;\n\n@Component\npublic class ConversioLibreOfficeHealthIndicator extends AbstractHealthIndicator {\n\n\t@Autowired\n\tprivate ConversioLibreOffice conversioLibreOffice;\n\n\t@Value(\"${\" + ConversioLibreOfficeConstants.CLAU_PROPIETAT_HOST_NAME_LIBRE_OFFICE + \"}\")\n\tprivate String hostNameLibreOffice;\n\n\t@Value(\"${\" + ConversioLibreOfficeConstants.CLAU_PROPIETAT_PORT_LIBRE_OFFICE + \"}\")\n\tprivate Integer portLibreoffice;\n\n\tprivate String DETAIL_KEY = \"detail\";\n\tprivate String ERROR_KEY = \"error\";\n\n\t@Override\n\tprotected void doHealthCheck(Health.Builder builder) throws Exception {\n\t\ttry {\n\t\t\tconversioLibreOffice.connectLibreOffice(hostNameLibreOffice, portLibreoffice);\n\t\t\tbuilder.up().withDetail(DETAIL_KEY,\n\t\t\t\t\t\"Connectat al Libreoffice en el servidor \" + hostNameLibreOffice + \" port \" + portLibreoffice);\n\t\t} catch (Exception ex) {\n\t\t\tbuilder.down().withDetail(DETAIL_KEY, \"No s'ha pogut connectar al Libreoffice en el servidor \"\n\t\t\t\t\t+ hostNameLibreOffice + \" port \" + portLibreoffice).withDetail(ERROR_KEY, ex);\n\t\t}\n\n\t}\n}\n```\n\nEn aquesta comprovació si va bé es retornarà el missatge de que el servei està UP amb el detall \"Connectat al Libreoffice en el servidor ...\"\nSi hi ha algun error a la comprovació es retornarà el missatge de que el servei està DOWN amb el detall \"No s'ha pogut connectar al Libreoffice en el servidor ...\"\n\nAmb aquests canvis tenim publicat un servei a:\n/api/health\n\nOn ens indica si la comprovació és correcte retornarà amb un http code 200 i el missatge:\n\n``` json\n{\n  \"status\": \"UP\",\n  \"conversioLibreOffice\": {\n    \"status\": \"UP\",\n    \"detail\": \"Connectat al Libreoffice en el servidor 127.0.0.1 port 8100\"\n  },\n  \"diskSpace\": {\n    \"status\": \"UP\",\n    \"total\": 65986711552,\n    \"free\": 18808164352,\n    \"threshold\": 10485760\n  }\n}\n```\n\nO si la comprovació no és correcte retornarà amb un http code 503 i el missatge:\n\n``` json\n{\n  \"status\": \"DOWN\",\n  \"conversioLibreOffice\": {\n    \"status\": \"DOWN\",\n    \"detail\": \"No s'ha pogut connectar al Libreoffice en el servidor 127.0.0.1 port 8100\",\n    \"error\": {\n\n\t\t}\n  },\n  \"diskSpace\": {\n    \"status\": \"UP\",\n    \"total\": 65986711552,\n    \"free\": 18807410688,\n    \"threshold\": 10485760\n  }\n}\n```\n\n4. Afegim al descriptor yml del servidor la secció:\n\n``` yml\nlivenessProbe:\n  failureThreshold: 3\n  httpGet:\n    path: /api/health\n    port: 8080\n    scheme: HTTP\n  initialDelaySeconds: 600\n  periodSeconds: 10\n  successThreshold: 1\n  timeoutSeconds: 2\n```\n  \nEl contenidor a AppAgile començarà a realitzar les comprovacions als 600 segons d'estar aixecat, amb una freqüencia de comprovacions cada 10 segons al servei /api/health i si es troba amb 3 indents fallits de comprovació reiniciarà el servidor\n\nExemple d'events dins del AppAgile on mostra com es reinicia el servidor si el servei http /api/health no respon correctament:\n![Liveness_probe_service_killing_container](/related/canigo/howto/imatges/201903_Liveness_probe_service_killing_container.png \"Liveness probe service killing container\")\n\n### Exemple de com configurar el AppAgile perquè reinicï el servidor si un port no està actiu:\n\n1. Afegim al descriptor yml del servidor la secció:\n\n``` yml\nlivenessProbe:\n  failureThreshold: 3\n  initialDelaySeconds: 600\n  periodSeconds: 10\n  successThreshold: 1\n  tcpSocket:\n    port: 8100\n  timeoutSeconds: 2\n```\n  \nEl contenidor AppAgile començarà a realitzar les comprovacions als 600 segons d'estar aixecat, amb una freqüencia de comprovacions cada 10 segons al port 8100 i si es troba amb 3 indents fallits de comprovació reiniciarà el servidor\n\nExemple d'events dins de l'AppAgile on mostra com es reinicia el servidor si el port 8100 no respon correctament:\n\n![Liveness_probe_port_killing_container](/related/canigo/howto/imatges/201903_Liveness_probe_port_killing_container.png \"Liveness probe port killing container\")\n\n","objectID":"L2hvd3Rvcy8yMDE5LTAzLUhvd1RvLURlZmluaWNpby1zb25kZXMtYXBsaWNhY2lvbnMtQ2FuaWdvLUFwcEFnaWxl"},"L2hvd3Rvcy8yMDE4LTExLUhvd3RvLUNhbmlnbzMtSGlrYXJpQ1A=":{"date":1541116800000,"title":"HowTo Ús de Hikari CP a Canigó 3.2","description":"En aquest HowTo es proposa i s'explica com integrar un pool de connexions Hikari CP a Canigó 3.2","section":"howtos","categories":["canigo"],"key":"DESEMBRE2018","path":"/howtos/2018-11-Howto-Canigo3-HikariCP","content":"## Audiència\n\nAquest how-to va dirigit principalment al personal tècnic (desenvolupadors, analistes tècnics i arquitectes) que desenvolupin una aplicació Canigó 3.2 i tinguin la necessitat de treballar amb un *Connection Pool* d'alt rendiment.\n\n## Context\n\nEls pools de connexions proporcionen una millora en el rendiment de les consultes SQL, minimitzant el temps d'adquisició i ús de les connexions a BBDD. Les diferents maneres de gestionar aquestes connexions i l'oferta de funcionalitats relacionades fa que hi hagi diferents implementacions (Apache DBCP2, Hikari CP, C3P0, Tomcat Pool, etc.)\n\nHikari CP és un pool de connexions que actualment té un gran *momentum* degut principalment a una visió minimalista de la gestió de les connexions, fent que frameworks molt populars (com Spring) l'hagin triat com una opció més per la tasca de gestionar les connexions a BBDD.\n\nEls exemples i configuracions estan adaptats específicament per una aplicació estàndard de Canigó, tot i que es fàcilment adaptable a aplicacions J2EE més genèriques.\n\n## Configuració\n\nHikari actualment proporciona 3 versions, segons la versió de Java sigui 8+ o prèvies; tot i que les versions per Java 7 i 6 estan només en mode de manteniment. Segons la versió de Java s'ha de triar la dependència Maven apropiada:\n\n```xml\n\t<!-- Java 8+ -->\n\t<dependency>\n\t\t<groupId>com.zaxxer</groupId>\n\t\t<artifactId>HikariCP</artifactId>\n\t\t<version>3.2.0</version>\n\t</dependency>\n\n\t<!-- Java 7 -->\n\t<dependency>\n\t\t<groupId>com.zaxxer</groupId>\n\t\t<artifactId>HikariCP</artifactId>\n\t\t<version>2.4.7</version>\n\t</dependency>\n\n\t<!-- Java 6 -->\n\t<dependency>\n\t\t<groupId>com.zaxxer</groupId>\n\t\t<artifactId>HikariCP</artifactId>\n\t\t<version>2.3.13</version>\n\t</dependency>\n```\n\n### jpa.properties\n\nDe manera ad-hoc s'ha definit per Canigó que les propietats específiques del pool de connexions de Hikari tinguin el prefix `persistence.hikari`; agrupant la configuració de les propietats del pool de connexions en 3 parts:\n\n1. Mode d'accés i/o autenticació: S'ha de definir l'accés a la BBDD o bé mitjançant l'identificador JNDI o bé mitjançant l'URL, l'usuari i el password.\n1. Propietats generals del pool: Quantitat de connexions i temporitzadors associats. En aquest cas, la resta de configuracions del pool són calculats en funció d'aquests valors.\n1. (Opcional) propietats específiques del driver JDBC: Ajustos específics per millorar el rendiment o per *troubleshooting*.\n\nUn exemple de configuració de Hikari per Canigó seria el següent:\n\n```properties\n#\n# HikariCP\n#\n\n# 1. Accés / Autenticació \n# 1.a JDNI\n#*.persistence.hikari.jndiName=java:comp/env/jdbc/OracleIntranetDS\n\n# 1.b. JDBC Auth\n*.persistence.hikari.jdbc.url=jdbc:h2:mem:bbdd_proves;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=false\n*.persistence.hikari.jdbc.username=sa\n*.persistence.hikari.jdbc.password=\n\n# 2. Pool configuration\n# 20s\n*.persistence.hikari.connectionTimeout=20000\n# 4m\n*.persistence.hikari.maxLifetime=240000\n# Recomanació genèrica: 10 (per aplicacions web intranet), 20 (per aplicacions amb processos batch/nocturns), 50 (per aplicacions web extranet). Finalment 100+ (per grans aplicacions amb molts usuaris concurrents i/o transaccions lentes, OLAP, data Warehouse, etc.)\n*.persistence.hikari.maximumPoolSize=10\n\n# 3. JDBC Driver (MySql) específic\n#    Exemple de https://github.com/brettwooldridge/HikariCP#initialization\n*.persistence.hikari.driver.cachePrepStmts=true\n*.persistence.hikari.driver.prepStmtCacheSize=500\n*.persistence.hikari.driver.prepStmtCacheSqlLimit=2048\n*.persistence.hikari.driver.useServerPrepStmts=true\n*.persistence.hikari.driver.useLocalSessionState=true\n*.persistence.hikari.driver.rewriteBatchedStatements=true\n*.persistence.hikari.driver.cacheResultSetMetadata=true\n*.persistence.hikari.driver.cacheServerConfiguration=true\n*.persistence.hikari.driver.elideSetAutoCommits=true\n*.persistence.hikari.driver.maintainTimeStats=false\n```\n\n\n### Application.java\n\nLa creació del DataSource s'ha de definir de la següent manera:\n\n```java\n\t/**\n\t * NOTA: Sobreescrivim el bean \"dataSource\" creat anteriorment per a què, amb el\n\t * mateix àlies, sigui retornat el DS de Hikari.\n\t * \n\t * @param configuration\n\t * @param configurer\n\t * @return\n\t */\n\t@Bean(name = { \"hikariDataSource\", \"dataSource\" }, destroyMethod = \"close\")\n\t@Primary\n\tpublic DataSource hikariDataSource(final PropertiesConfiguration configuration,\n\t\t\tfinal ICustomPropertyPlaceHolderConfigurer configurer) {\n\n\t\tfinal DataSource ds = init(new HikariDataSource(), \"persistence.hikari.\", //\n\t\t\t\tconfiguration, configurer.getResolvedProps());\n\n\t\tif (logger.isDebugEnabled())\n\t\t\tlogger.debug(ToStringBuilder.reflectionToString(ds));\n\n\t\treturn ds;\n\t}\n\n\tprotected DataSource init(final HikariDataSource ds, final String prefix,\n\t\t\tfinal PropertiesConfiguration configuration, final Map<String, String> properties) {\n\n\t\tfinal String jndiName = configuration.getProperty(prefix + \"jndiName\");\n\t\tfinal String jdbcUrl = configuration.getProperty(prefix + \"jdbc.url\");\n\n\t\tif (jndiName != null && jdbcUrl != null)\n\t\t\tlogger.warn(\"jndiName i jdbcUrl estan definits alhora per \" + prefix);\n\n\t\tif (jndiName != null) {\n\t\t\tds.setDataSourceJNDI(jndiName);\n\t\t} else {\n\t\t\tds.setJdbcUrl(jdbcUrl);\n\t\t\tds.setUsername(configuration.getProperty(prefix + \"jdbc.username\"));\n\t\t\tds.setPassword(configuration.getProperty(prefix + \"jdbc.password\"));\n\t\t}\n\n\t\tds.setConnectionTimeout(new Integer(configuration.getProperty(prefix + \"connectionTimeout\"))); // ~20s\n\t\tds.setValidationTimeout(Math.max(ds.getConnectionTimeout() / 5, 5 * 1000)); // 20% connectionTimeout\n\t\t//\n\t\tfinal int MINUTE = 60 * 1000;\n\t\tds.setMaxLifetime(new Integer(configuration.getProperty(prefix + \"maxLifetime\"))); // ~4m\n\t\tds.setIdleTimeout(Math.max( //\n\t\t\t\tMath.min(ds.getMaxLifetime() - MINUTE, 4 * MINUTE) //\n\t\t\t\t, 10 * 1000));\n\t\t//\n\t\tds.setMaximumPoolSize(new Integer(configuration.getProperty(prefix + \"maximumPoolSize\"))); // ~20\n\t\tds.setMinimumIdle(Math.max(ds.getMaximumPoolSize() / 10, 1)); // [ 10% maximumPoolSize, 1]\n\n\t\t//\n\t\t// Definició de les propietats : persistence.hikari.driver.XYZ ->\n\t\t// ds.addDataSourceProperty(XYZ, *)\n\t\t//\n\n\t\tfor (final Entry<String, String> entry : properties.entrySet()) {\n\n\t\t\tfinal String key = entry.getKey();\n\n\t\t\tif (key.startsWith(prefix + \"driver.\")) {\n\t\t\t\tfinal String property = key.substring((prefix + \"driver.\").length());\n\t\t\t\tds.addDataSourceProperty(property, parse(entry.getValue()));\n\t\t\t}\n\t\t}\n\n\t\treturn ds;\n\t}\n\n\tprotected Object parse(final String value) {\n\n\t\ttry {\n\t\t\treturn new Integer(value);\n\t\t} catch (NumberFormatException e) {\n\t\t\tlogger.debug(e.getMessage());\n\t\t}\n\n\t\tif (\"true\".equals(value))\n\t\t\treturn true;\n\n\t\tif (\"false\".equals(value))\n\t\t\treturn false;\n\n\t\treturn value;\n\t}\n```\n\n## Informació addicional\n\nA continuació es defineix una llista d'enllaços amb informació addicional per poder aprofundir en els diferents aspectes i opcions mostrades al document.\n\n* Hikari\n  * http://brettwooldridge.github.io/HikariCP/\n  * https://github.com/brettwooldridge/HikariCP\n  * https://github.com/brettwooldridge/HikariCP/wiki\n* Propietats específiques de drivers JDBC\n  * http://www.h2database.com/javadoc/org/h2/engine/SysProperties.html\n  * https://dev.mysql.com/doc/connector-j/5.1/en/connector-j-reference-configuration-properties.html\n  * https://jdbc.postgresql.org/documentation/head/connect.html\n  * https://docs.oracle.com/database/121/JAJDB/oracle/jdbc/OracleDriver.html\n* https://commons.apache.org/proper/commons-dbcp/\n* https://tomcat.apache.org/tomcat-8.0-doc/jdbc-pool.html\n  \n\n## Annex. Configurar exemple de Swagger\n\nEl *archetype* per aplicacions REST de Canigó `plugin-canigo-archetype-rest` genera actualment un exemple funcional amb Swagger. Aquest exemple, per defecte, no s'integra amb Hikari de manera que per fer-ne ús del Hikari, només cal modificar el fitxer `src/main/resources/spring/app-custom-persistence-jpa.xml` de la següent manera:\n\n1. Comentar (o eliminar) el tag `<jdbc:embedded-database id=\"dataSource\" type=\"H2\">`\n2. Afegir el següent xml:\n\n```xml\n\t<jdbc:initialize-database data-source=\"hikariDataSource\" >\n\t\t<jdbc:script location=\"classpath:scripts/h2/db-app-h2db-schema.sql\"/>\n\t\t<jdbc:script location=\"classpath:scripts/h2/db-app-h2db-data.sql\"/>\n\t</jdbc:initialize-database>\n```\n","objectID":"L2hvd3Rvcy8yMDE4LTExLUhvd3RvLUNhbmlnbzMtSGlrYXJpQ1A="},"L2hvd3Rvcy8yMDE5LTAzLUhvd3RvLUFjdHVhbGl0emFjaW9fQ2FuaWdvM18yX0NhbmlnbzNfNA==":{"date":1552867200000,"title":"Actualització Canigó 3.2 a Canigó 3.4","description":"Com realitzar l'actualització d'una aplicació de Canigó 3.2 a Canigó 3.4","section":"howtos","categories":["canigo"],"key":"ABRIL2019","path":"/howtos/2019-03-Howto-Actualitzacio_Canigo3_2_Canigo3_4","content":"### A qui va dirigit\n\nAquest how-to va dirigit a tots aquells usuaris que vulguin fer l'actualització a Canigó 3.2 de la seva aplicació Canigó 3.4.\n\n### Versió de Canigó\n\nEls passos descrits en aquest document apliquen a la versió 3.4 del Framework Canigó.\n\n### Introducció\n\nEl mes de Març del 2019 s'ha publicat la versió 3.4 del Framework Canigó. Aquesta versió és una [versió LTS](/canigo/roadmap), i es recomana actualitzar les aplicacions Canigó a aquesta versió per tal de tenir un suport continuat així com la màxima estabilitat que proporciona una versió LTS.\n\nL'objectiu d'aquest Howto és mostrar els procediments necessaris per a realitzar l'actualització d'una aplicació realitzada amb Canigó 3.1. El punt de partida d'aquest Howto és una aplicació creada amb el plugin de Canigó per Eclipse.\n\n### Configuració de dependències\n\nA la [matriu de compatibilitats] (/canigo-download-related/matrius-compatibilitats) es poden veure les versions dels mòduls i components de Canigó de les versions 3.2.x i 3.4.x. S'han d'actualitzar els intervals dels mòduls utilitzats per a migrar a Canigó 3.4.\n\nLa versió parent de Spring boot és la 2.1.3.RELEASE, per tant, per una aplicació amb Spring boot el parent quedaria:\n\n```\t\n\t<parent>\n\t\t<groupId>org.springframework.boot</groupId>\n\t\t<artifactId>spring-boot-starter-parent</artifactId>\n\t\t<version>2.1.3.RELEASE</version>\n\t</parent>\n```\n\nLa versió de spring loeaded és la 1.2.8.RELEASE\n\n### Passos a realitzar \n\nDesprés de canviar les versions dels mòduls decrits a la secció anterior, és necessari realitzar els següents canvis:\n\n1. Canviar en el pom.xml el goal del plugin **maven-assembly-plugin** a **single**\n2. Canviar la classe **org.springframework.boot.web.support.SpringBootServletInitializer** a **org.springframework.boot.web.servlet.support.SpringBootServletInitializer**\n3. Canviar la classe **org.springframework.boot.autoconfigure.web.DispatcherServletAutoConfiguration** a **org.springframework.boot.autoconfigure.web.servlet.DispatcherServletAutoConfiguration**\n4. Canviar la classe **org.springframework.data.jpa.repository.support.QueryDslRepositorySupport** a **org.springframework.data.jpa.repository.support.QuerydslRepositorySupport**\n5. El mètode findOne de QuerydslPredicateExecutor retorna Optional, per simular el que retornava **findOne** de Spring 4.x es necessari canviar-ho per **findById(E).orElse(null)**\n6. Modificar les **named querys amb paràmetres** per afegir-li el **número de cada paràmetre**, per exemple:\nde:\n```\n@Query(\"select p from Person p where p.lastname = ?\")\n\tList<Person> findByLastname(String lastname);\n```\t\na:\n```\n@Query(\"select p from Person p where p.lastname = ?1\")\n\tList<Person> findByLastname(String lastname);\n```\n7. Es recomana utilitzar **org.springframework.data.mongodb.repository.support.QuerydslMongoPredicateExecutor** enlloc de **org.springframework.data.mongodb.repository.support.QuerydslMongoRepository** ja que aquest està deprecat\n8. Modificar totes les utilitzacions del mètode **save(Iterable)** a **saveAll(Iterable)** de les classes que extenguin de cat.gencat.ctti.canigo.arch.persistence.jpa.repository.GenericRepository i de cat.gencat.ctti.canigo.arch.persistence.mongodb.repository.MongoGenericRepository\n9. Modificar la versió de **java** com a mínim a la **versió 8** amb el plugin **maven-compiler-plugin** del pom.xml\n```\n\t\t\t<plugin>\n\t\t\t\t<groupId>org.apache.maven.plugins</groupId>\n\t\t\t\t<artifactId>maven-compiler-plugin</artifactId>\n\t\t\t\t<configuration>\n\t\t\t\t\t<source>1.8</source>\n\t\t\t\t\t<target>1.8</target>\n\t\t\t\t</configuration>\n\t\t\t</plugin>\n```\n10. Modificar el nom del metode **dispatcherServletRegistration** de Application.java per **apiDispatcherServletRegistration**\n11. Utilitzar mètode **\"public MongoClient mongoClient()\"** enlloc de **\"public Mongo mongo() throws Exception\"** dels objectes que heredin de cat.gencat.ctti.canigo.arch.persistence.mongodb.config.MongoCoreConfig\n12. Afegir la propietat de sistema **\"spring.main.allow-bean-definition-overriding\"** a true al iniciar l'aplicació, afegint al Application.java:\n```\nSystem.setProperty(\"spring.main.allow-bean-definition-overriding\", String.valueOf(true));\n```\n13. Si l'aplicació utilitza BD Mongodb, afegir l'annotació \"@Configuration\" a totes les classes que heredin de \"cat.gencat.ctti.canigo.arch.persistence.mongodb.config.MongoCoreConfig\"\n14. Si l'aplicació utilitza BD mysql, canviar el driver **com.mysql.jdbc.Driver** per **com.mysql.cj.jdbc.Driver** al fitxer jdbc.properties\n15. Si l'aplicació utilitza la seguretat per fitxer és necessari canviar el **\"password-encoder\"** del autentication provider, de:\n```\n\t\t<security:authentication-provider>\n \t\t\t\t<security:password-encoder hash=\"plaintext\"/>\n\t\t\t\t<security:user-service properties=\"classpath:config/props/security.users.properties\"/>\n\t\t\t</security:authentication-provider>\n\t\t</security:authentication-manager>\n```\na:\n```\n\t\t<security:authentication-manager>\n\t\t\t<security:authentication-provider>\n\t\t\t\t<security:password-encoder ref=\"passwordEncoder\" />\n\t\t\t\t<security:user-service properties=\"classpath:config/props/security.users.properties\"/>\n\t\t\t</security:authentication-provider>\n\t\t</security:authentication-manager>\n\t\t<bean id=\"passwordEncoder\" class=\"org.springframework.security.crypto.password.NoOpPasswordEncoder\"\tfactory-method=\"getInstance\" />\n```\nO fer un update dels passwords afegint \"{noop}\" davant dels passwords, aixi per exemple si per l'usuari \"user\" tenia el password al fitxer de text \"password\" es necessari canviar-ho per \"{noop}password\"\n\nNo es recomana utilitzar la seguretat per fitxer en entorns productius\n\n16. Si l'aplicació utilitza la seguretat **sense definir un \"password-encoder\"** en el atentication provider es necessari definir-ne un o utilitzar el \"NoOpPasswordEncoder\" que està deprecat, per exemple si tenim una security per BD amb:\n```\n\t\t<security:authentication-manager>\n\t\t\t<security:authentication-provider>\n\t\t\t\t<security:jdbc-user-service data-source-ref=\"dataSource\"/>\n\t\t\t</security:authentication-provider>\n\t\t</security:authentication-manager>\n```\nEs necessari canviar-ho per:\n```\n\t\t<security:authentication-manager>\n\t\t\t<security:authentication-provider>\n\t\t\t\t<security:jdbc-user-service data-source-ref=\"dataSource\"/>\n\t\t\t\t<security:password-encoder ref=\"passwordEncoder\" />\n\t\t\t</security:authentication-provider>\n\t\t</security:authentication-manager>\n\t\t\n\t\t<bean id=\"passwordEncoder\" class=\"org.springframework.security.crypto.password.NoOpPasswordEncoder\"\n\t\tfactory-method=\"getInstance\" />\n```\n\t\t\nO fer un update dels passwords afeint \"{noop}\" davant dels passwords, aixi per exemple si per l'usuari \"user\" tenia el password a BD \"password\" es necessari canviar-ho per \"{noop}password\"\n\nEs recomana utilitzar els \"password.encoders\" BCryptPasswordEncoder, Pbkdf2PasswordEncoder o SCryptPasswordEncoder\n","objectID":"L2hvd3Rvcy8yMDE5LTAzLUhvd3RvLUFjdHVhbGl0emFjaW9fQ2FuaWdvM18yX0NhbmlnbzNfNA=="},"L2hvd3Rvcy8yMDE4LTA5LUhvd3RvLU1vbmdvREI=":{"date":1533859200000,"title":"Configuració de MongoDB a Canigó 3.2.6","description":"En aquest HowTo s'explica pas a pas com configurar el suport de MongoDB a Canigó 3.2.6 seguint les millors pràctiques definides pel CS Canigó","section":"howtos","categories":["canigo"],"key":"OCTUBRE2018","path":"/howtos/2018-09-Howto-MongoDB","content":"## Audiència\n\nAquest how-to va dirigit principalment al personal tècnic (desenvolupadors, analistes, arquitectes) que desenvolupi una aplicació Canigó 3.2.6 i que necessiti configurar el suport per a MongoDB.\n\n## MongoDB\n\nAbans de fer cap modificació al projecte, cal generar, compilar i executar l'aplicació per verificar que tot funciona bé, per després triar el mètode de configurar el suport per a MongoDB.\n\n### Entorn de Desenvolupament de Canigó\n\nEl plugin d'Eclipse de Canigó que ve integrat amb [l'entorn de desenvolupament de Canigó](https://canigo.ctti.gencat.cat/canigo/entorn-desenvolupament/)) és la manera recomanada i més ràpida d'afegir el suport per a MongoDB. Per fer-ho s'ha de seguir les següents passes:\n\n1. Un cop es té el projecte Canigó actiu a l'entorn de desenvolupament s'ha de fer clic al botó dret del ratolí al nom del projecte.\n2. Un cop s'ha desplegat el menú d'opcions (entre d'altres hi ha \"New\", \"Go into\", \"Import\") s'han de triar les següents opcions:\n> Canigó > Add New Modules\n3. Ara s'ha obert una finestra amb el títol \"Add new module\" on es pot triar quins mòduls instal·lar. S'ha d'activar l'opció `MongoDB Module` dins l'opció `Persistence` i clicar al botó `Next>`. Per defecte la BBDD \"MongoDB\" vindrà pre-seleccionada, i només caldrà fer clic al botó `Finish`.\n\nUn cop s'han executat les passes prèvies es disposarà del suport per a MongoDB instal·lat automàticament al projecte, i un petit joc de proves d'exemple dins el package `...mongodb.model` entre altres fitxers tècnics.\nAra només roman configurar l'aprovisionament (entorns, passwords, etc.) al fitxer `src/main/resources/config/props/mongodb.properties`.\n\n### Configuració manual\n\nEn el cas que es vulgui configurar de manera manual el suport per a MongoDB, primer de tot s'haurà de disposar una aplicació creada amb el \"archetype\" de Canigó. Per fer-ho s'han de seguir les següents passes:\n\n1. Generar projecte amb archetype: `mvn -B archetype:generate -DgroupId=cat.gencat.mongodbapp -DartifactId=mongodbapp -Dversion=1.0-SNAPSHOT -DarchetypeGroupId=cat.gencat.ctti -DarchetypeArtifactId=plugin-canigo-archetype-rest -DarchetypeVersion=1.6.0`\n2. Compilar amb `mvn -B -f mongodbapp/pom.xml clean package`\n3. Executar l'aplicació generada mitjançant `java -Dapplication.defaultLanguage=ca -jar mongodbapp/target/mongodbapp.war`\n4. Provar d'accedir amb un navegador web a http://localhost:8080/index.html\n\nUn cop s'han executat els passos previs per disposar d'una aplicació Canigó 3.2.6 funcionant, s'ha d'afegir el suport específic pe *MongoDB*, de la següent manera:\n\n1. Modificar pom.xml per afegir la següent dependència al final:\n\n```\n\t<dependency>\n\t\t<artifactId>canigo.persistence.mongodb</artifactId>\n\t\t<groupId>cat.gencat.ctti</groupId>\n\t\t<version>[1.0.0,1.1.0)</version>\n\t</dependency>\n```\n2. Continuar modificant pom.xml per afegir l'exclusió `spring-boot-starter-logging:org.springframework.boot`:\n\n```\n\t<dependency>\n\t\t<groupId>org.springframework.boot</groupId>\n\t\t<artifactId>spring-boot-starter-data-mongodb</artifactId>\n\t\t<exclusions>\n\t\t\t<exclusion>\n\t\t\t\t<artifactId>spring-boot-starter-logging</artifactId>\n\t\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t</exclusion>\n\t\t</exclusions>\n\t</dependency>\n```\n\n3. Continuar modificant pom.xml per afegir uns processadors d'anotacions:\n\n```\n\t<plugin>\n\t\t<groupId>com.mysema.maven</groupId>\n\t\t<artifactId>apt-maven-plugin</artifactId>\n\t\t<version>1.1.3</version>\n\t\t<executions>\n\t\t\t<execution>\n\t\t\t\t<id>org.springframework.data.mongodb.repository.support.MongoAnnotationProcessor</id>\n\t\t\t\t<goals>\n\t\t\t\t\t<goal>process</goal>\n\t\t\t\t</goals>\n\t\t\t\t<configuration>\n\t\t\t\t\t<outputDirectory>target/generated-sources/java</outputDirectory>\n\t\t\t\t\t<processor>org.springframework.data.mongodb.repository.support.MongoAnnotationProcessor</processor>\n\t\t\t\t</configuration>\n\t\t\t</execution>\n\t\t</executions>\n\t</plugin>\n```\n\n4. Configurar el fitxer `src/main/resources/config/props/mongodb.properties` seguint el següent exemple:\n\n```\n*.mongodb.uri=mongodb://user:secret@127.0.0.1:27017/dataBase\n```\n\n5. Crear una classe tècnica per poder configurar el `MongoCoreConfig` al paquet `...mongodb.config`:\n\n```\npackage cat.gencat.mongodbapp.mongodb.config;\n\nimport org.springframework.context.annotation.Bean;\n\nimport cat.gencat.mongodbapp.mongodb.model.repository.MongoEquipamentListener;\nimport cat.gencat.ctti.canigo.arch.persistence.mongodb.config.MongoCoreConfig;\n\npublic class MainMongoConfig extends MongoCoreConfig {\n\n//\tprotected static MongoClientOptions mongoClientOptions;\n//\n//\tpublic EquipamentMongoConfig() {\n//\t\tsuper(mongoOptions());\n//\t}\n\n//\t@Bean\n//\tpublic MongoEquipamentListener mongoEquipamentListener() {\n//\t\treturn new MongoEquipamentListener();\n//\t}\n\n//\t@Bean\n//\tpublic static MongoClientOptions mongoOptions() {\n//\t\tif (mongoClientOptions == null) {\n//\t\t\tmongoClientOptions = MongoClientOptions.builder().socketTimeout(2000).build();\n//\t\t}\n//\t\treturn mongoClientOptions;\n//\t}\n\n}\n```\n\n6. Modificar `AppConfig.java` anotant la definició de la classe de la següent manera:\n```\n@Import(MainMongoConfig.class)\n```\n\n#### Entitats i repositoris MongoDB\n\nUn cop s'ha configurat l'aplicació descrita a l'apartat anterior només resta afegir les entitats i els repositoris. Com a exemple d'entitat i repositori associat serien els següents codis:\n\n```\npackage cat.gencat.mongodbapp.mongodb.model;\n\nimport javax.validation.constraints.NotNull;\n\nimport org.springframework.data.annotation.Id;\nimport org.springframework.data.mongodb.core.index.Indexed;\nimport org.springframework.data.mongodb.core.mapping.Document;\n\n@Document(collection = \"Equipament\")\npublic class MongoEquipament {\n\t\n\tpublic static final String ID = \"id\";\n\tpublic static final String NOM = \"nom\";\n\tpublic static final String MUNICIPI = \"municipi\";\n\n\t@Id\n\tprivate Long id;\n\n\t@Indexed(unique = true)\n\t@NotNull(message = \"MongoEquipament's nom must not be null\")\n\tprivate String nom;\n\n\tprivate String municipi;\n\n\tpublic Long getId() {\n\t\treturn id;\n\t}\n\n\tpublic void setId(Long id) {\n\t\tthis.id = id;\n\t}\n\n\tpublic String getNom() {\n\t\treturn nom;\n\t}\n\n\tpublic void setNom(String nom) {\n\t\tthis.nom = nom;\n\t}\n\n\tpublic String getMunicipi() {\n\t\treturn municipi;\n\t}\n\n\tpublic void setMunicipi(String municipi) {\n\t\tthis.municipi = municipi;\n\t}\n\n}\n```\n\n```\npackage cat.gencat.mongodbapp.mongodb.model.repository;\n\nimport java.util.List;\n\nimport org.springframework.data.domain.Sort;\nimport org.springframework.data.mongodb.repository.Query;\n\nimport cat.gencat.mongodbapp.mongodb.model.MongoEquipament;\nimport cat.gencat.ctti.canigo.arch.persistence.mongodb.repository.MongoGenericRepository;\n\npublic interface EquipamentMongoRepository extends MongoGenericRepository<MongoEquipament, Long>{\n\n\t@Query(\"{ nom: ?0 }\")\n\tList<MongoEquipament> findByNomQuery(String nom);\n\n\tList<MongoEquipament> findByNomLike(String nom, Sort sort);\n\n\n}\n```\n\nMés info:\n\n1. https://docs.spring.io/spring-data/mongodb/docs/current/reference/html\n2. https://docs.spring.io/spring-data/commons/docs/current/api/org/springframework/data/annotation/package-summary.html\n","objectID":"L2hvd3Rvcy8yMDE4LTA5LUhvd3RvLU1vbmdvREI="},"L25vdGljaWVzLzIwMTUtMDEtMDgtY2FuaWfDsy1SRVNU":{"date":1420848000000,"title":"Cas d'èxit d'aplicació Canigo 3 amb arquitectura HTML5 + REST","description":"L'arquitectura que des del CS Canigó s'està promovent per aplicacions web ja està sent adoptada per noves aplicacions, com és el cas de l'aplicació d'Ajuts i Subvencions (Transversal)","sections":["Notícies","home"],"categories":["desenvolupament","canigó"],"path":"/noticies/2015-01-08-canigó-REST","content":"L'arquitectura que des del CS Canigó s'està promovent per aplicacions web ja està sent adoptada per noves aplicacions, com és el cas de l'aplicació d'Ajuts i Subvencions (Transversal). Aquesta aplicació Canigó 3 ha utilitzat una arquitectura híbrida, 90% HTML5+REST i un 10% JSP. Aquesta petita part basada en JSP (Java Server Pages) bàsicament s'ha fet per a generar l'estructura de la pàgina (template) en què es basa l'aplicació SPA (Single Page Application, aplicació de pàgina única) on les diferents parts de la pàgina es poden refrescar sense haver de recarregar tota la pàgina. La resta de codi de la capa de presentació és estàtic, no generat des del servidor, utilitzant javascript per a cridar serveis REST/JSON i formatar-los al navegador. Les conclusions per part de l'equip tècnic del projecte han estat molt positives pel que fa l'ús d'aquesta arquitectura respecte a la predecessora basada en JSF (Java Server Faces).\r\n\r\nEl següent diagrama il·lustra les diferents capes d'una aplicació Canigó 3 amb aquesta arquitectura HTML5+REST:\r\n\r\n![Arquitectura Canigó Restful](/images/news/arquitectura-canigo-restful.png)\r\n\r\nCom es pot observar la comunicació entre la capa de presentació i la capa de lògica de negoci es fa mitjançant el controlador REST. Aquest desacoblament entre client (Presentació) i servidor (Negoci-Dades) facilita la implementació de diferents clients (escriptori, mòbil, etc.) per accedir a uns mateixos recursos de servidor. En el comunicat de Novembre 2013 podeu trobar més informació respecte a aquest tipus d'arquitectura i el codi font d'una aplicació demo.\r\n\r\nPel que fa als frameworks a utilitzar a la capa de presentació destaquem els següents:\r\n\r\n- Bootstrap: framework HTML, CSS i Javascript per al desenvolupament d'aplicacions web responsives. Incorpora plugins Javascript que requereixen JQuery. \r\n- AngularJS: framework Javascript per desenvolupament d'aplicacions web. Facilita el desenvolupament a més de proposar patrons de disseny per dur-les a terme. Requereix JQuery. En cas de no estar present a l'aplicació utilitza una versió reduïda (jqLite) que inclou el necessari pel seu funcionament.\r\n- Bootstrap UI: llibreria de components Bootstrap basats en AngularJS.\r\n\r\nA més d'aquestes llibreries que hem destacat existeixen moltes altres (JQuery UI, Backbone.js, Ember.js, etc.). Des del CS Canigó es dóna llibertat pel que fa als frameworks a utilitzar a la capa de presentació sempre que es compleixi la normativa de desenvolupament web del CTTI i el PIV (Programa d'Identificació Visual). \r\n\r\nRecordar que la nova versió de l'entorn de treball de Canigó 3 permet la creació d'una plantilla d'aplicació Canigó 3.1 amb aquesta arquitectura HTML5+REST. En aquesta plantilla s'inclou un exemple de CRUD (Create-Read-Update-Delete) d'una entitat.  Per qualsevol dubte referent a aquest tipus d'arquitectura en aplicacions Canigó 3 us podeu posar en contacte amb l'equip del CS Canigó, preferiblement fent una petició de Suport al JIRA CSTD o enviant un correu a la bústia oficina-tecnica.canigo.ctti@gencat.cat.\r\n","objectID":"L25vdGljaWVzLzIwMTUtMDEtMDgtY2FuaWfDsy1SRVNU"},"L2hvd3Rvcy8yMDE5LTA0LUhvd3RvLWFmZWdpcl9kZXZfdG9vbHNfc3ByaW5n":{"date":1555286400000,"title":"Afegir dev tools Spring","description":"How to per afegir les dev tools de Spring a Canigó 3.4.0","section":"howtos","categories":["canigo"],"key":"MAIG2019","path":"/howtos/2019-04-Howto-afegir_dev_tools_spring","content":"### A qui va dirigit\n\nAquest how-to va dirigit a tots aquells perfils tècnics que tinguin la necessitat d'utilitzar les funcionalitats de les dev tools de Spring proporcionats a la versió 3.4.0 de Canigó.\n\nEn aquest how-to es mostrarà com utilitzar la consola web per accedir a la bd h2 d'una aplicació amb Canigó 3.4.0\n\n### Introducció dev tools Spring\n\nAmb Spring Boot s'inclou un conjunt addicional d'eines per poder fer que l'experiència del desenvolupament d'aplicacions amb Spring sigui més senzilla. Un dels mòduls que faciliten les funcionalitats de desenvolupament és el mòdul \"spring-boot-devtools\"\n\nLes funcionalitats més importats que aporta les dev tools de Spring són:\n\n- Restart automàtic\n- Consola web de consulta d'una bd h2\n\n### Afegir dev tools Spring\n\nPer poder utilitzar les dev tools de Spring amb una aplicació amb Canigó 3.4.0 és necessari afegir la següent dependència maven al fitxer pom.xml\n\n```xml\n<dependency>\n\t\t<groupId>org.springframework.boot</groupId>\n\t\t<artifactId>spring-boot-devtools</artifactId>\n\t\t<optional>true</optional>\n\t</dependency>\n```\n\nÉs una bona pràctica afegir la dependència com a \"optional\" ja que així s'evita que les dev tools s'apliquin transitivament a altres mòduls que utilitzin el projecte\n\nLes dev tools són automàticament deshabilitades quan s'executa el projecte executant \"java -jar\" o es desplega en classloaders especials considerats com a productius. Per assegurar-se que no s'executen en entorns productius, per cada entorn productiu, és necessari afegir les següents propietats:\n\n```\nspring.devtools.restart.enabled=false\nspring.h2.console.enabled=false\n```\n\nPer a més informació sobre les dev tools podeu consultar \n\n- [Using boot devtools](https://docs.spring.io/spring-boot/docs/current/reference/html/using-boot-devtools.html)\n\n- [Using H2’s Web Console](https://docs.spring.io/spring-boot/docs/2.1.x/reference/htmlsingle/#boot-features-sql-h2-console)\n\n### Accedir consola web bd h2\n\nSi la nostra aplicació utilitza una bd h2 en entorn de desenvolupament, una vegada afegida la dependència maven, podem accedir a la consola web de les dev tools per a realitzar consultes a la bd h2, accedint a http://localhost:8080/h2-console i omplint el formulari amb la següent informació:\n\n```\nJDBC URL: jdbc:h2:mem:dataSource\nUser Name: sa\nPasword: <deixar buit>\n```\n\nOn obtindrem una consola web de consulta de la bd h2 de l'aplicació com per exemple:\n\n![H2 console](/images/news/dev_tools_spring_h2_console.png)\n\nSi s'utilitza Spring Security a l'aplicació s'ha de deshabilitar el CSRF i el X-Frame-Options, per això en el nostre fitxer\n```\n/src/main/java/cat/gencat/ctti/config/WebSecurityConfig.java\n```\nEn el mètode *configure* Afegirem:\n```\n\t\thttp.csrf().disable();\n\t\thttp.headers().frameOptions().disable();\n```\t\t\n\nPer a més informació sobre la consola web de les dev tools es pot consultar:\n\n- [Using H2’s Web Console](https://docs.spring.io/spring-boot/docs/2.1.x/reference/htmlsingle/#boot-features-sql-h2-console)\n\n- [How to connect to h2 database during development/testing using spring boot](https://medium.com/@harittweets/how-to-connect-to-h2-database-during-development-testing-using-spring-boot-44bbb287570)\n\n- [Using the H2 Database Console in Spring Boot with Spring Security](https://springframework.guru/using-the-h2-database-console-in-spring-boot-with-spring-security/)\n","objectID":"L2hvd3Rvcy8yMDE5LTA0LUhvd3RvLWFmZWdpcl9kZXZfdG9vbHNfc3ByaW5n"},"L25vdGljaWVzLzIwMTUtMDItMDItU0lDLXRyYW5zZm9ybWFjaW8tc2VydmVp":{"date":1417478400000,"title":"SIC. Transformació del servei","description":"El passat 13/11 es va efectuar la transformació del servei SIC al CPD1-HP. En el següent diagrama es mostren els components més rellevants de la capa d'aplicacions i com es realitza la redirecció dels dominis cap als servidors del SIC","sections":["Notícies","home"],"categories":["SIC"],"path":"/noticies/2015-02-02-SIC-transformacio-servei","content":"El passat 13-11-2014 es va efectuar la transformació del servei SIC al CPD1-HP. En el següent diagrama es mostren els components més rellevants de la capa d'aplicacions i com es realitza la redirecció dels dominis cap als servidors del SIC: \n\n![Nou SIC](/related/sic/SIC-CPD1.png)\n\nPer a tots els usuaris del SIC que accedeixen als serveis per domini, ja sigui \"hudson.intranet.gencat.cat\" (Jenkins) o \"svn.intranet.gencat.cat\" (Subversion), el canvi ha estat transparent donat que la connectivitat al nou servidor està oberta i la resolució dels noms per DNS es va canviar el 13/11 per a accedir als nous servidors. Destacar que degut a requeriments d'infraestructura des d'aquesta data és obligatori l'accés per domini, deixant de funcionar l'accés directe per IP (10.48.143.21).\n\nEls usuaris del SIC poden trobar tots els recursos als quals accedien a l'entorn antic en les mateixes URLs. No han canviat les referències a repositoris de Subversion ni a jobs de Jenkins. També es manté tota la informació històrica (tags, històric de modificacions, execucions de jobs, etc.).\n\nEn aquesta transformació s'han fet millores en l'arquitectura del SIC així com actualitzat diferents peces del software que formen part del servei. Els serveis de Jenkins i Nexus ara corren en diferents instàncies de servidors web Tomcat 7.0.50 (Java JRE 1.7.0_51), aïllant les possibles incidències i intervencions que es puguin realitzar en un respecte a l'altre. Les versions de Jenkins i Nexus actuals al SIC són 1.509.4 i 2.10.0 respectivament. Per aquest últim s'ha fet un upgrade de la versió 1.8.0.1 que hi havia instal·lada a l'antic servidor.\n\nEn aquest procés de transformació de CPD s'ha donat de baixa el servei Sonar (sonar.intranet.gencat.cat). Es segueix recomanant però l'ús d'aquest tipus d'eines en entorns de desenvolupament, prèviament a l'alliberament de noves versions de les aplicacions al SIC. L'eina corporativa per l'anàlisi de qualitat de codi és CAST. Més informació al Portal de Qualitat a la secció Eines - CAST.\n\nEn cas de tenir qualsevol dubte o detectar qualsevol afectació conseqüència d'aquesta transformació us podeu posar en contacte amb l'equip del SIC preferiblement via JIRA CSTD al servei SICQ o [s'ha d'obrir una petició Remedy de consulta al SIC](http://canigo.ctti.gencat.cat/howtos/2018-01-howto-obrir-peticions-SIC-a-autoservei-Remedy/#consulta).","objectID":"L25vdGljaWVzLzIwMTUtMDItMDItU0lDLXRyYW5zZm9ybWFjaW8tc2VydmVp"},"L25vdGljaWVzLzIwMTUtMDEtMDktU0lDLW5vdS1tb2RlbA==":{"date":1420675200000,"title":"SIC. Calendari de migració d'aplicacions al nou model","description":"Tal com es va notificar al comunicat de Novembre 2014 aviat començarà la migració d'aplicacions per adaptar-se al nou model TIC. Per organitzar aquest procés de migració s'ha elaborat un calendari i s'ha publicat a la plana principal del SVN del SIC, secció \"Calendari de migració d'aplicacions al SIC\"","sections":["Notícies","home"],"categories":["desenvolupament","canigó"],"path":"/noticies/2015-01-09-SIC-nou-model","content":"Tal com es va notificar al comunicat de Novembre 2014 aviat començarà la migració d'aplicacions per adaptar-se al nou model TIC. Per organitzar aquest procés de migració s'ha elaborat un calendari i s'ha publicat a la plana principal del SVN del SIC, secció \"Calendari de migració d'aplicacions al SIC\". A continuació s'enumeren els principals aspectes en que consisteix aquesta migració:\n\n- La migració començarà a partir del 26-01-15 i durarà fins al 03-03-15\n- La migració es durà a terme en franges horàries de 14h a 18h minimitzant l'impacte en el servei durant les hores de més activitat\n- La migració implicarà un tall de servei però aquest només afectarà al bloc d'aplicacions a migrar en la franja horària corresponent \n- Les aplicacions a migrar s'han separat en blocs segons l'àmbit al qual pertanyen. Per a aquells àmbits amb major volum d'aplicacions a migrar ha calgut distribuir-les en diversos blocs, fet que provocarà que la migració d'aplicacions de tot l'àmbit s'allargui més d'un dia en la franja horària esmentada anteriorment. En aquests casos s'oferirà l'alternativa d'unificar els blocs i realitzar la migració en dies complets però tenint en compte que l'aturada del servei durarà tota la jornada, de 08h a 18h\n- El calendari es troba obert a modificacions. En cas de produir-se alguna, es publicarà i s'informarà d'aquest canvi\n\nAmb 2 setmanes d'antelació a les dates publicades al calendari s'emetrà el corresponent comunicat als Responsables d'Arquitectura, Responsables de Qualitat i als Release Managers de l'Àmbit afectat alertant de l'inici d'aquesta migració i aportant més informació relativa al procés.\n\nEs recorda la importància d'haver tramitat prèviament a aquesta migració la creació dels usuaris Release Manager de lot i àmbit de les aplicacions, donat que l'accés al nou repositori es troba restringit a aquests usuaris. Aquest és l'enllaç a la plana de Documentació del SIC on podeu trobar el Formulari de Gestió d'usuaris al SIC per sol·licitar aquestes altes.\nL'accés als repositoris SVN del nou model per les aplicacions que seran migrades no s'habilitarà fins que finalitzi la seva migració. Aquesta mesura s'ha pres per evitar conflictes de duplicitat de codis entre repositori antic i nou.\n\nPer qualsevol dubte referent a aquest procés de migració us podeu posar en contacte amb l'equip del SIC, preferiblement fent una petició de Suport al JIRA CSTD o [s'ha d'obrir una petició Remedy de consulta al SIC](http://canigo.ctti.gencat.cat/howtos/2018-01-howto-obrir-peticions-SIC-a-autoservei-Remedy/#consulta) .","objectID":"L25vdGljaWVzLzIwMTUtMDEtMDktU0lDLW5vdS1tb2RlbA=="},"L2hvd3Rvcy8yMDE5LTAzLUhvd3RvLVRlc3RfdW5pdGFyaXNfcHJvZ3JhbWFjaW9fcmVhY3RpdmFfY2FuaWdvXzNfNA==":{"date":1553472000000,"title":"Test unitaris amb programació reactiva a Canigó 3.4","description":"How to per crear test unitaris amb programació reactiva a Canigó 3.4","section":"howtos","categories":["canigo"],"key":"ABRIL2019","path":"/howtos/2019-03-Howto-Test_unitaris_programacio_reactiva_canigo_3_4","content":"### A qui va dirigit\n\nAquest how-to va dirigit a tots aquells perfils tècnics que tinguin la necessitat de crear test unitaris a Streams reactius proporcionats a la versió 3.4.0 de Canigó.\n\n### Introducció programació reactiva\n\nAmb la publicació de Canigó 3.4.0 es proporciona suport a Spring 5, proporcionant les funcionalitats per a la programació reactiva utilitzant el estàndard de Streams reactius.\n\nL'objectiu és proporcionar eines per a crear aplicacions no bloquejants, que siguin asíncrones, orientades a esdeveniments i que requereixin un nombre reduït de fils.\n\nSpring 5 utilitza el projecte [Reactor](https://projectreactor.io/) per a crear sistemes reactius eficients.\n\nPer a més informació sobre programació reactiva amb Spring 5 podeu consultar:\nhttps://docs.spring.io/spring-framework/docs/5.1.5.RELEASE/spring-framework-reference/web-reactive.html\n\n### Introducció test programació reactiva\n\nEl projecte Reactor proporciona les principals funcionalitats pel testeig de programació reactiva:\n- Testing d'una seqüència de passos d'un escenari amb programació reactiva\n- Producció de dades en un ordre en concret per testejar el comportament dels operadors\n\nEls principals components que proporcionen aquestes funcionalitats són:\n- StepVerifier\n- TestPublisher\n\nEl resum dels passos a utilitzar per crear un test seria:\n- Creació de l'escenari\n- Els diferents passos a provar en el fluxe de dades del stream\n- Verificació final que la seqüència es compleix \n\nPer a més informació podeu consultar la documentació del projecte [Reactor testing](https://projectreactor.io/docs/core/release/reference/#testing).\n\n### Test unitaris streams \n\n#### StepVerifier\nPer il·lustrar exemples de tests unitaris de serveis amb StepVerifier, partirem d'un servei de Spring que exposa mètodes que retornen un fluxe de dades en streams, aquest servei seria:\n```java\nimport java.time.Duration;\nimport java.util.ArrayList;\nimport java.util.Arrays;\nimport java.util.Collections;\nimport java.util.LinkedHashSet;\nimport java.util.List;\nimport java.util.Set;\nimport java.util.function.Function;\n\nimport reactor.core.publisher.Flux;\n\nimport org.springframework.stereotype.Service;\n\n@Service\npublic class Testing {\n\n\tstatic final Set<String> NAMES = new LinkedHashSet<>(Arrays.asList(\n\t\t\t\"Victor\",\"Simon\",\"Rick\",\"Morty\",\"Beth\",\"Jerry\",\"Summer\"\n\t));\n\n\tpublic Flux<Integer> tenToZero() {\n\t\treturn Flux.range(0, 11)\n\t\t           .map(i -> 10 - i);\n\t}\n\n\tpublic Flux<Integer> operateOnTenToZero(Function<Integer, Integer> operation) {\n\t\treturn tenToZero().map(operation);\n\t}\n\n\tpublic Flux<String> namesPerSecond() {\n\t\tList<String> randomizedNames = new ArrayList<>(NAMES);\n\t\tCollections.reverse(randomizedNames);\n\n\t\treturn Flux.fromIterable(randomizedNames)\n\t\t\t\t.delayElements(Duration.ofSeconds(1));\n\t}\n}\n```\n\nPer provar el primer mètode \"tenToZero\" podriem comprovar que una vegada creada la seqüencia es compleix la seqüencia següent:\n1. S'obté l'element \"10\"\n2. Els següents elements són els elements \"9\", \"8\", \"7\", \"6\", \"5\"\n3. Que després vindran 4 elements més\n4. Que no obtindrem més elements\n\nPer això podríem tenir el test:\n```java\n...\n\t@Test\n\tpublic void tenToZero() {\n\t\tStepVerifier.create(test.tenToZero())\n\t\t            .expectNext(10)\n\t\t            .expectNext(9, 8, 7, 6, 5)\n\t\t            .expectNextCount(4)\n\t\t            .expectNext(0)\n\t\t            .verifyComplete();\n\t}\n...\n```\n\nAltres exemples de tests dels mètodes podrien ser:\n```java\n...\n@Test\n\tpublic void multiplyByTenToZero() {\n\t\tStepVerifier.create(test.operateOnTenToZero(i -> 10 * i))\n\t\t            .expectSubscription()\n\t\t            .expectNextCount(5)\n\t\t            .assertNext(v -> assertThat(v).isEqualTo(50))\n\t\t            .expectNext(40, 30, 20, 10, 0)\n\t\t            .verifyComplete();\n\t}\n\n\t@Test\n\tpublic void divideByTenToZeroErrors() {\n\t\tStepVerifier.create(test.operateOnTenToZero(i -> 10 / i))\n\t\t            .expectNext(1)\n\t\t            .expectNextCount(4)\n\t\t            .expectNext(2)\n\t\t            .expectNextCount(2)\n\t\t            .expectNext(5, 10)\n\t\t            .verifyErrorSatisfies(e -> assertThat(e).isInstanceOf(ArithmeticException.class)\n\t\t                                                    .hasMessage(\"/ by zero\"));\n\t}\n\n\t@Test\n\tpublic void namesPerSecond() {\n\t\tStepVerifier.create(test.namesPerSecond()\n\t\t                        .doOnNext(System.out::println))\n\t\t            .recordWith(ArrayList::new)\n\t\t            .thenConsumeWhile(Objects::nonNull)\n\t\t            .consumeRecordedWith(l -> assertThat(Testing.NAMES).containsAll(l))\n\t\t            .verifyComplete();\n\t}\n\n\t@Test\n\tpublic void namesPerSecondWithoutTime() {\n\t\tStepVerifier.withVirtualTime(() -> test.namesPerSecond()\n\t\t                                       .doOnNext(System.out::println))\n\t\t            .expectSubscription()\n\t\t            .expectNoEvent(Duration.ofSeconds(1))\n\t\t            .expectNext(\"Summer\")\n\t\t            .thenAwait(Duration.ofSeconds(2))\n\t\t            .expectNextCount(2)\n\t\t            .thenAwait(Duration.ofMinutes(1))\n\t\t            .expectNext(\"Morty\", \"Rick\", \"Simon\", \"Victor\")\n\t\t            .verifyComplete();\n\t}\n...\n```\n\nOn tenim que:\n- En el test \"multiplyByTenToZero\" s'utilitza:\n\t- \"expectSubscription\" per comprovar que existeix una subscripció en el stream\n\t- \"assertNext\" amb \"FunctionalInterface\" i lambdas de java per fer comprovacions al element del stream\n\t\n- En el test \"divideByTenToZeroErrors\" s'utilitza:\n\t- \"verifyErrorSatisfies\" per verificar que es rep un error i que aquest compleix un requisits definits\n\t\n- En el test \"namesPerSecond\" s'utilitza:\n\t- \"recordWith\", \"thenConsumeWhile\", \"consumeRecordedWith\", per agrupar en una llista els elements retornats, cada segon, pel fluxe i comprovar que són els elements de la llista\n\t\n- En el test \"namesPerSecondWithoutTime\" s'utilitza:\n\t- \"expectNoEvent\" per verificar que no hi ha cap event a la subcripció durant un temps concret\n\t- \"expectNext\" després de \"expectNoEvent\", per verificar que passat el temps definit a \"expectNoEvent\" hi ha l'element que esperem\n\t- \"thenAwait\" per esperar un temps en concret perquè hi hagi events \n\t- \"expectNextCount\" després de \"thenAwait\", per verificar que passat el temps definit a \"thenAwait\", hi ha el nombre d'elements que esperem\n\t\nAltres funcionalitats interessants serien:\n- \"expectNextMatches\" per verificar que els elements compleixen un predicat\n- \"expectError\", \"expectError\" especificant l'error, \"expectErrorMessage\", \"expectErrorMatches\" i \"expectErrorSatisfies\" per fer comprovacions a l'error esperat\n\t\nPer a més informació sobre l'exemple de la prova podeu consultar aquests [exemples](https://github.com/simonbasle-demos/s1p-reactor-in-action).\n\n#### TestPublisher \nPer il·lustrar exemples de tests unitaris de serveis utilitzant TestPublisher per a la creació del fluxe de dades, partirem d'una classe que exposa un servei per transformar un fluxe de dades amb String a majúscules:\n```java\nimport reactor.core.publisher.Flux;\n\nclass UppercaseConverter {\n    private final Flux<String> source;\n \n    UppercaseConverter(Flux<String> source) {\n        this.source = source;\n    }\n \n    Flux<String> getUpperCase() {\n        return source\n          .map(String::toUpperCase);\n    }   \n}\n```\n\nUtilitzarem TestPublisher per crear un fluxe de dades que es passarà a la classe UppercaseConverter:\n```java\n    @Test\n    public void testPublisherInAction() {\n        final TestPublisher<String> testPublisher = TestPublisher.create();\n\n        UppercaseConverter uppercaseConverter = new UppercaseConverter(testPublisher.flux());\n\n        StepVerifier.create(uppercaseConverter.getUpperCase())\n          .then(() -> testPublisher.emit(\"aA\", \"bb\", \"ccc\"))\n          .expectNext(\"AA\", \"BB\", \"CCC\")\n          .verifyComplete();\n    }\n```\n\nUna vegada creat el fluxe i la connexió amb UppercaseConverter, s'utilitza el step \"then\" per emetre els elements a la subscripció i verificar que, en els següents passos, els elements creats al \"TestPublisher\" són transformats a majúscules.\n\nPer a més informació sobre l'exemple podeu consultar:\nhttps://github.com/eugenp/tutorials/tree/master/spring-5-reactive\n\n### Test unitaris streams reactius\n\nPer il·lustrar exemples de tests unitaris de serveis amb streams reactius utilitzarem un repositori amb MongoDB. Per a més informació com utilitzar reactiu amb un repositori de dades Mongodb, s'ha publicat la guia d'[Utilització de mongo reactiu](/howtos/2019-03-Howto-Utilitzacio_mongo_reactiu.md).\n\nPer l'exemple partirem d'un element \"Account\", amb el id, owner i value\n```java\n@Document\npublic class Account {\n  \n    @Id\n    private String id;\n    private String owner;\n    private Double value;\n  \n    // getters and setters\n}\n```\n\nUtilitzarem el repositori \"AccountCrudRepository\" utilitzant \"ReactiveCrudRepository\" de Spring\n```java\nimport cat.gencat.ctti.model.Account;\nimport org.springframework.data.repository.reactive.ReactiveCrudRepository;\nimport org.springframework.stereotype.Repository;\nimport reactor.core.publisher.Flux;\nimport reactor.core.publisher.Mono;\n\n@Repository\npublic interface AccountCrudRepository extends ReactiveCrudRepository<Account, String> {\n\n    public Flux<Account> findAllByValue(Double value);\n\n    public Mono<Account> findFirstByOwner(Mono<String> owner);\n}\n```\n\nPel test podríem provar que si guardem un \"Account\" al respository, si consultem els \"Accounts\" obtenim l'element guardat, per exemple:\n```java\n...\n@Test\npublic void givenValue_whenFindAllByValue_thenFindAccount() {\n\t\tStepVerifier.create(repository.save(new Account(null, \"Bill\", 12.3)))\n\t\t.expectNextCount(1)\n\t\t.verifyComplete();\n\n    StepVerifier\n      .create(repository.findAllByValue(12.3))\n      .assertNext(account -> {\n          assertEquals(\"Bill\", account.getOwner());\n          assertEquals(Double.valueOf(12.3) , account.getValue());\n          assertNotNull(account.getId());\n      })\n      .expectComplete()\n      .verify();\n}\n...\n```\n\nPer la pròpia definició dels streams reactius, no es pot garantir que immediatament després de la crida al mètode \"save\" el repositori ha guardat la informació.\n\nEl mètode \"block\" s'ha d'evitar utilitzar en el tractament de streams ja que es crea un bloqueig.\n\nPer a garantir que quan utilitzem el mètode \"findAllByValue\" s'ha guardat la informació al repository s'ha utilitzat 2 StepVerifier.\n\nPer provar el mètode \"findFirstByOwner\" podriem utilitzar un test \"homòleg\" a l'anterior:\n```java\n...\n@Test\npublic void givenOwner_whenFindFirstByOwner_thenFindAccount() {\n    StepVerifier.create(repository.save(new Account(null, \"Bill\", 12.3)))\n\t\t.expectNextCount(1)\n\t\t.verifyComplete();\n\t\t\n    StepVerifier\n      .create(repository.findFirstByOwner(Mono.just(\"Bill\")))\n      .assertNext(account -> {\n          assertEquals(\"Bill\", account.getOwner());\n          assertEquals(Double.valueOf(12.3) , account.getValue());\n          assertNotNull(account.getId());\n      })\n      .expectComplete()\n      .verify();\n}\n...\n```\n\nPer provar explícitament el mètode \"save\" del repository, podríem tenir:\n```java\n...\n@Test\npublic void givenAccount_whenSave_thenSaveAccount() {\n    StepVerifier\n      .create(repository.save(new Account(null, \"Bill\", 12.3)))\n      .assertNext(account -> assertNotNull(account.getId()))\n      .expectComplete()\n      .verify();\n}\n...\n```\n\nCom es pot apreciar a les proves, al step \"assertNext\" amb \"FuntionalInterface\" i lambdas de Java podem tenir els \"Asserts\" que necessitem.\n","objectID":"L2hvd3Rvcy8yMDE5LTAzLUhvd3RvLVRlc3RfdW5pdGFyaXNfcHJvZ3JhbWFjaW9fcmVhY3RpdmFfY2FuaWdvXzNfNA=="},"L25vdGljaWVzLzIwMTUtMDItMDUtQ2FuaWdvLWludGVncmFjaW8tc2VydmVpcy1yZXN0LWdpY2Fy":{"date":1423094400000,"title":"Canigó. Integració de serveis REST amb GICAR","description":"Les aplicacions Canigó 3 basades en l'arquitectura HTML5/JS+REST han de tenir en compte una sèrie de consideracions en cas que estiguin integrades amb GICAR. En concret, és probable que hagin de sol·licitar que s'apliquin les següents excepcions","sections":["Notícies","home"],"categories":["desenvolupament","canigó"],"path":"/noticies/2015-02-05-Canigo-integracio-serveis-rest-gicar","content":"Les aplicacions Canigó 3 basades en l'arquitectura HTML5/JS+REST han de tenir en compte una sèrie de consideracions en cas que estiguin integrades amb GICAR. En concret, és probable que hagin de sol·licitar que s'apliquin les següents excepcions:\r\n\r\n- <i>Habilitar mètodes \"PUT\" i \"DELETE\"</i>: aquests mètodes HTTP són utilitzats en serveis RESTful per operacions de modificació/inserció de dades (PUT) i eliminació (DELETE). És molt habitual per tant en aplicacions que utilitzen REST, sobretot de backoffice on es realitza administració d'informació, que requereixin aquests mètodes HTTP.\r\n\r\n- <i>Deshabilitar la validació GICAR de la cometa simple (‘) al querystring</i>: els agents GICAR instal·lats en els frontals corporatius, a més de gestionar l'autenticació d'usuaris, també inclouen validacions de seguretat. Una d'aquestes validacions no permet la cometa simple (‘) en el querystring. Al deshabilitar aquesta validació es torna imprescindible que les aplicacions protegeixin el seu codi per evitar SQL Injection. En el cas d'aplicacions Canigó 3 es recomana fer ús del \"Parameter Binding\" de JPA (Java Persistence Api) alhora de setejar paràmetres en sentències JPQL (Java Persistence Query Language) o SQL (Structured Query Language).\r\n\r\nQuan s’hagin de fer aquestes excepcions cal que el responsable de la solució afectada obri un tiquet a <a href=\"mailto://sau.tic@gencat.cat\">sau.tic@gencat.cat</a> en el servei GICAR,  demanant l’excepció pertinent (aquestes identificades o unes altres), indicant també l’aplicació que ho requereix.\r\n\r\nUs deixem una referència al comunicat de Canigó de Novembre 2013 on podeu trobar un exemple d'aplicació Canigó 3 amb arquitectura HTML5/JS+REST. Per qualsevol dubte relacionat amb l'ús d'aquest tipus d'arquitectura en aplicacions Canigó 3 podeu fer una petició de consulta al [JIRA CSTD](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN) o enviar un correu a la <a href=\"mailto://oficina-tecnica.canigo.ctti@gencat.cat\">Bústia del CS Canigó</a>. ","objectID":"L25vdGljaWVzLzIwMTUtMDItMDUtQ2FuaWdvLWludGVncmFjaW8tc2VydmVpcy1yZXN0LWdpY2Fy"},"L25vdGljaWVzLzIwMTUtMDItMDUtU0dERS1vY3Itc3Rk":{"date":1423094400000,"title":"SGDE. OCR al STD","description":"En el procés de transformació de CPD de l'entorn PROductiu del STD (Sistema de Transformació de Documents), finalitzat el passat 28/1, ha estat publicada una nova versió del WebService de Serveis Invocació STD","sections":["Notícies","home"],"categories":["desenvolupament","sgde"],"path":"/noticies/2015-02-05-SGDE-ocr-std","content":"En el procés de transformació de CPD de l'entorn PROductiu del STD (Sistema de Transformació de Documents), finalitzat el passat 28/1, ha estat publicada una nova versió del WebService de Serveis Invocació STD:\r\n\r\n- [WS v1.0] (http://sgde.intranet.gencat.cat/ServeisInvocacioSTD/services/ServeisSTD?wsdl)\r\n- [WS v2.0 (NOVA VERSIÓ)] (http://sgde.intranet.gencat.cat/ServeisInvocacioSTD/services/ServeisSTDV2?wsdl)\r\n\r\nAquesta nova versió inclou mètodes d'OCR (Optical Character Recognition). A continuació es descriuen breument cadascuna de les funcionalitats proporcionades per aquests nous mètodes:\r\n\r\n- ferOCR: a partir del binari d'una imatge retorna el text resultat del OCR.\r\n- convertirPDFCercable: es passa l'OCR al document a convertir, prèvia conversió a imatge en cas que el document origen no sigui una imatge. El PDF resultat és un PDF \"cercable\".\r\n- convertirComposarPDFCercable: mateixa funcionalitat que l'operació existent \"convertirComposarPDF\" però el document PDF a composar és un PDF \"cercable\", ja que prèviament a la composició s'aplica la funcionalitat de \"convertirPDFCercable\". \r\n\r\nI un diagrama on s'il·lustra el seu funcionament dins el STD:\r\n\r\n<CENTER>![OCR](/images/news/OCR.png)</center>\r\n\r\nEn el Portal de Frameworks i Solucions d'Arquitectura, secció [SGDE] (/sgde/documentacio), podeu trobar tota la informació relacionada amb aquesta versió 2.0 del Webservice de Serveis Invocació STD. Properament es publicarà una nova versió del connector SGDE de Canigó 2 i Canigó 3 que faciliti el seu consum des d'aplicacions Canigó.","objectID":"L25vdGljaWVzLzIwMTUtMDItMDUtU0dERS1vY3Itc3Rk"},"L25vdGljaWVzLzIwMTUtMDMtMDUtY2FuaWfDsy1jYXB0Y2hh":{"date":1425513600000,"title":"Canigó. Captcha en aplicacions Canigó 3","description":"Els Captcha són tests utilitzats per a diferenciar entre persones i robots que tracten d'evitar un mal ús de les aplicacions per part de robots/programes automàtics. En aplicacions Canigó els Captcha poden resultar molt útils per a validar que s'està fent un ús correcte de les accions destinades a l'usuari final de l'aplicació com per exemple omplir i enviar formularis","sections":["Notícies","home"],"categories":["desenvolupament","canigó"],"path":"/noticies/2015-03-05-canigó-captcha","content":"Els Captcha són tests utilitzats per a diferenciar entre persones i robots que tracten d'evitar un mal ús de les aplicacions per part de robots/programes automàtics. En aplicacions Canigó els Captcha poden resultar molt útils per a validar que s'està fent un ús correcte de les accions destinades a l'usuari final de l'aplicació com per exemple omplir i enviar formularis.\r\n\r\nDes del CS Canigó recomanem l'ús de [Google ReCaptcha] (http://www.google.com/recaptcha/intro/index.html)  degut a la senzillesa de la seva implementació, la facilitat d'ús per a l'usuari final de l'aplicació i la seguretat que proporciona. Google ReCaptcha és una evolució dels Captcha originals que fa més difícil per als programes OCR el reconeixement de les paraules a introduir.\r\n\r\n<CENTER>![captcha](/images/news/captcha.png)</center>\r\n\r\nPer qualsevol dubte referent a la integració dels Captcha a les aplicacions Canigó podeu fer una petició de consulta al servei [CAN] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN) al JIRA CSTD o adreçar-vos a la bústia <a href=\"mailto://oficina-tecnica.canigo.ctti@gencat.cat\">oficina-tecnica.canigo.ctti@gencat.cat</a>.","objectID":"L25vdGljaWVzLzIwMTUtMDMtMDUtY2FuaWfDsy1jYXB0Y2hh"},"L25vdGljaWVzLzIwMTUtMDQtMDUtU0lDIC1hdXRvcml0emFjaW8tcmVwb3NpdG9yaXM=":{"date":1428192000000,"title":"SIC. Nova política d'autorització d'accés a repositoris","description":"Els repositoris de Subversion de l'antic model existents al SIC només comptaven amb un control d'accessibilitat (autenticació). Els usuaris podien accedir a determinats repositoris en funció del grup al qual se'ls hi havia assignat amb control total (Read/Write). En els repositoris del nou model s'ha incorporat un control d'autorització que permet definir els permisos sobre el contingut accedit (Read o Read/Write)","sections":["Notícies","home"],"categories":["desenvolupament","sic"],"path":"/noticies/2015-04-05-SIC -autoritzacio-repositoris","content":"Els repositoris de Subversion de l'antic model existents al SIC només comptaven amb un control d'accessibilitat (autenticació). Els usuaris podien accedir a determinats repositoris en funció del grup al qual se'ls hi havia assignat amb control total (Read/Write). En els repositoris del nou model s'ha incorporat un control d'autorització que permet definir els permisos sobre el contingut accedit (Read o Read/Write)\n\nAquesta nova característica ha permès limitar els permisos del grup d'administradors de CPD als repositoris de les aplicacions per tal que només puguin descarregar contingut (Read), salvant el risc i responsabilitat que comportava l'accés total (Read/Write) als repositoris als quals tenien accés en l'antic model.\n\n<CENTER>![sic](/images/news/RML_vs_CPD_permissions.png)</center>\n\nEls nous repositoris de [Subversion] (http://svn.intranet.gencat.cat/) compten ara amb un total de 532 codis de diàleg donats d'alta. En el següent gràfic es mostren el total de codis de diàleg distribuïts per àmbits:\n\nPer qualsevol consulta referent a la política d'accés als repositoris de Subversion es pot fer arribar una petició de consulta al JIRA CSTD al servei [SICQ] (https://cstd.ctti.gencat.cat/jiracstd/browse/SICQ) o [s'ha d'obrir una petició Remedy de consulta al SIC](http://canigo.ctti.gencat.cat/howtos/2018-01-howto-obrir-peticions-SIC-a-autoservei-Remedy/#consulta).\n\n","objectID":"L25vdGljaWVzLzIwMTUtMDQtMDUtU0lDIC1hdXRvcml0emFjaW8tcmVwb3NpdG9yaXM="},"L25vdGljaWVzLzIwMTUtMDQtMzAtU0lDLU1hc3Rlci1TbGF2ZS1DUEQ0":{"date":1430352000000,"title":"SIC. Multi-CPD - Desplegaments a CPD4-TSystems","description":"El SIC - Multi CPD basat en l'arquitectura Master/Slave de Jenkins ja s’ha començat a implantar. El primer CPD on s’ha posat en marxa el Slave de Jenkins per als desplegaments d’aplicacions ha estat a CPD4-TSystems. Aquest slave és controlat pel Jenkins Master (CPD1-HP), el qual li delegarà el desplegament de les aplicacions ubicades a CPD4-TSystems.","sections":["Notícies","home"],"categories":["sic"],"path":"/noticies/2015-04-30-SIC-Master-Slave-CPD4","content":"El SIC - Multi CPD basat en l'arquitectura Master/Slave de Jenkins ja s’ha com****ençat a implantar. El primer CPD on s’ha posat en marxa el Slave de Jenkins per als desplegaments d’aplicacions ha estat a CPD4-TSystems. Aquest slave és controlat pel Jenkins Master (CPD1-HP), el qual li delegarà el desplegament de les aplicacions ubicades a CPD4-TSystems.\n\nEls avantatges d’aquesta arquitectura Master/Slave són els següents:\n\n- *Distribució de la càrrega de treball*: l'execució de les tasques (jobs) es realitza en els slaves.\n- *Reduïr el tràfic a XCAT*: els artefactes es promouen entre entorns dins el CPD.\n- *Minimitzar les connectivitats entre CPDs*: el master només necessita connexió ssh amb els slaves. L'execució de les tasques per el desplegament la realitzen els slaves dins els CPDs.\n\n<CENTER>![SIC_MultiCPD_Slave_CPD4.png](/images/news/SIC_MultiCPD_Slave_CPD4.png)</center>\n\nDestacar que entre els diferents slaves i el master hauran de sincronitzar-se certes dades  (artefactes resultat, logs execució, ...). D'aquesta manera el master centralitza tota la informació i pot presentar-la a l'usuari al [Portal de Jenkins](http://hudson.intranet.gencat.cat).\n\nEs recorda el procediment per a poder realitzar desplegaments de les aplicacions des de SIC:\n\n- Custodiar el codi font de l'aplicació al [SVN del SIC](http://svn.intranet.gencat.cat). Si encara no es disposa d'un espai per el codi de diàleg demanar-ne la creació enviant el \"Formulari d’alta d’aplicació per a la Custòdia de codi al SIC\" que podeu trobar dins la secció de [Documentació del SIC](http://canigo.ctti.gencat.cat/sic/documentacio/Sic-documentacio) al Portal de Frameworks i Solucions d'Arquitectura.\n- Demanar l'alta de jobs a Jenkins mitjançant el \"Formulari d’alta d’aplicació per al Portal d’Integració Contínua (Jenkins)\" disponible també en la secció de [Documentació del SIC](http://canigo.ctti.gencat.cat/sic/documentacio/).\n\nAquests formularis [s'ha d'obrir una petició Remedy](http://canigo.ctti.gencat.cat/howtos/2018-01-howto-obrir-peticions-SIC-a-autoservei-Remedy/)  pel responsable de l'aplicació (persona dins el CTTI o d’un Departament).\n\nPer a obtenir més informació relativa al SIC podeu accedir a la [secció SIC](http://canigo.ctti.gencat.cat/sic/) dins el Portal de Frameworks i Solucions d'Arquitectura. Per consultes o suport preferiblement fer una petició al [Servei SICQ del JIRA CSTD](https://cstd.ctti.gencat.cat/jiracstd/browse/SICQ) o bé  [s'ha d'obrir una petició Remedy](http://canigo.ctti.gencat.cat/howtos/2018-01-howto-obrir-peticions-SIC-a-autoservei-Remedy/).\n\n","objectID":"L25vdGljaWVzLzIwMTUtMDQtMzAtU0lDLU1hc3Rlci1TbGF2ZS1DUEQ0"},"L25vdGljaWVzLzIwMTUtMDMtMDUtU0lDLVBIUA==":{"date":1425513600000,"title":"SIC. PHP","description":"Durant el mes de Febrer s'ha dotat al SIC dels processos necessaris per poder fer desplegaments d'aplicacions PHP en entorns corporatius. A  la secció de Documentació del SIC del Portal de Frameworks i Solucions d'Arquitectura podeu trobar noves versions dels documents de referència.","sections":["Notícies","home"],"categories":["desenvolupament","canigó"],"path":"/noticies/2015-03-05-SIC-PHP","content":"Durant el mes de Febrer s'ha dotat al SIC dels processos necessaris per poder fer desplegaments d'aplicacions PHP en entorns corporatius. A  la secció de Documentació del SIC del Portal de Frameworks i Solucions d'Arquitectura podeu trobar noves versions dels següents documents: \n\n- <i>Formulari d'alta d'aplicació per al Portal d'Integració Continua (Tasques al Jenkins):</i> en aquest formulari s'ha afegit una nova pestanya \"PHP-Desplegament\" amb els camps necessaris pel desplegament d'aplicacions PHP en entorns d'INT, PRE i PRO. \n- <i>Manual d'Integració:</i> afegit detall dels requeriments per la integració d'aplicacions PHP al SIC. \n- <i>Manual d'Usuari:</i> afegida informació per l'ús de Jenkins per tal de fer desplegaments d'aplicacions PHP amb el SIC.\nLa custòdia de codi d'aplicacions PHP ja era permesa i amb l'afegit dels desplegaments es proveeix al SIC de la possibilitat de gestionar el cicle de vida d'aplicacions desenvolupades amb aquesta tecnologia. Destacar que de la mateixa manera que amb aplicacions JEE, també es permet l'execució de scripts de bases de dades Oracle en els desplegaments automàtics a INT. Per PRE i PRO, els procediments de desplegament són semi-automàtics amb lliurament per sFTP d'artefactes a CPD i enviament de correu de sol·licitud de desplegament a SAU CTTI.\n\nA continuació es mostra un diagrama amb el funcionament global del SIC per aplicacions PHP:\n\n<CENTER>![PHP](/images/news/SIC_PHP.png)</center>\n\nComentar que en el roadmap del SIC està l'execució de scripts SQL/PLSQL en MySQL donada la seva presencia en el stack LAMP (Linux - Apache HTTP Server - MySQL- PHP).\n\nPer qualsevol dubte referent a la integració d'aplicacions PHP al SIC podeu fer una petició de consulta al servei [SICQ] (https://cstd.ctti.gencat.cat/jiracstd/browse/SICQ) al JIRA CSTD o [s'ha d'obrir una petició Remedy de consulta al SIC](http://canigo.ctti.gencat.cat/howtos/2018-01-howto-obrir-peticions-SIC-a-autoservei-Remedy/#consulta).\n\n","objectID":"L25vdGljaWVzLzIwMTUtMDMtMDUtU0lDLVBIUA=="},"L25vdGljaWVzLzIwMTQtMTItMDktY29ubmVjdG9ycy1jYW5pZ28=":{"date":1418083200000,"title":"Canigó. Publicació serveis i connectors Canigó 3.1","description":"Al mes de Novembre s'han alliberat noves versions dels serveis i connectors que formen part de Canigó 3.1. Aquesta és la referència a la Matriu de compatibilitats de Canigó 3.1. En ella s'especifica el detall de totes les versions dels serveis de Canigó 3.1 i les compatibilitats/dependències entre cadascun d'ells. ","sections":["Notícies","home"],"categories":["desenvolupament","canigó"],"path":"/noticies/2014-12-09-connectors-canigo","content":"En aquestes noves versions de serveis i connectors s'han eliminat dependències nnecessàries així com unificat les existents. Per exemple, tots els connectors que utilitzen Axis2 han estat unificats a la versió 1.5.3. Moltes altres com Aspectj, JAX-WS, Bouncy Castle Crypto API, etc. han estat actualitzades.\r\n\r\nTambé s'ha alliberat la versió 1.2.0 del Plugin d'Eclipse per donar suport al desenvolupament d'aplicacions Canigó 3.1. Aquest plugin permet la creació de dos tipus de plantilles d'aplicació:\r\n\r\n- Plantilla HTML/JS i REST: backend basat en serveis REST utilitzant Spring MVC. Presentació desacoblada. (Recomanació CS Canigó)\r\n- Plantilla JSF 2.2 (Primefaces): backend basat en la JSF 2.2 i Primefaces 5.0 com a llibreria de components al frontend.\r\n\r\nAl Portal de Frameworks i Solucions d'Arquitectura podeu trobar la Documentació de Referència de Canigó 3 actualitzada i els binaris de Canigó 3.1 disponibles a la secció de Descàrregues. Per aquest comunicat també s'ha redactat un HowTo destinat a totes aquelles aplicacions desenvolupades amb Canigó 3.0 que vulguin migrar a Canigó 3.1.","objectID":"L25vdGljaWVzLzIwMTQtMTItMDktY29ubmVjdG9ycy1jYW5pZ28="},"L25vdGljaWVzLzIwMTUtMDQtMjQtU0lDIC1wdWJsaWNhY2lvLWFudGl2aXJ1cw==":{"date":1429833600000,"title":"Canigó. Nova versió del connector Antivirus","description":"S'han publicat noves versions del connector d'Antivirus de Canigó 3 i Canigó 2. El funcionament d'aquestes versions, 1.2.0 i 2.3.21-SNAPSHOT respectivament, ha estat certificat amb la versió 7.5 de l'API de Symantec corresponent a la versió instal·lada per el nou Antivirus corporatiu. Cal destacar els canvis de dominis realitzats en la transformació del servei d'Antivirus. Les aplicacions han de fer canvis a la seva configuració per accedir-hi.","sections":["Notícies","home"],"categories":["desenvolupament","canigo"],"path":"/noticies/2015-04-24-SIC -publicacio-antivirus","content":"Durant el mes d'Abril han estat publicades les versions [1.2.0](http://repos.canigo.ctti.gencat.cat/repository/maven2/cat/gencat/ctti/canigo.integration.antivirus/1.2.0/) del [Connector d'Antivirus] (/canigo-documentacio-versions-3x-integracio/modul-antivirus/) per a Canigó 3 i [2.3.21-SNAPSHOT](http://repos.canigo.ctti.gencat.cat/repository/maven2/canigo/connectors/canigo-connectors-antivirus/2.3.21-SNAPSHOT/) per a Canigó 2.\r\n\r\nAquestes noves versions utilitzen la versió 7.5 de l’API de Symantec. Per a poder utilitzar aquesta API s’ha de sol·licitar el jar “sym-7.5.jar” a la bústia de canigó <oficina-tecnica.canigo.ctti@gencat.cat> al no estar disponible a cap repositori públic Maven. Altrament l’aplicació no podrà compilar. La instal·lació haurà de fer-se en els repositoris locals dels desenvolupadors. Aquesta llibreria ja ha estat incorporada internament al SIC (Servei d’Integració Contínua) per a compilacions de releases d’aplicacions.\r\n\r\nPer a continuar utilitzant l'API de Symantec 4.3.1 s'ha de mantenir la versió 1.1.0 del connector (o anterior) en cas de Canigó 3 i 2.3.20 (o anterior) en cas de Canigó 2. No s'han detectat incompatibilitats en l'ús d'aquesta versió de l'API en l'accés al nou servei d'Antivirus.\r\n\r\nEls nous dominis d'accés al Servei d'Antivirus són:\r\n\r\nEntorn         | Domini \t\t\t\t\t\t\t\t\t\t| port\r\n-------------- | ----------------------------------------------\t| -----\r\npreproducció   | preproduccio.antivirus.intranet.gencat.cat     | 1344\r\nproducció      | antivirus.intranet.gencat.cat       \t\t\t| 1344\r\n\r\nEl port d'accés, ICAP (1344), no és un dels estàndars (80-http, 443-https). És per aquest motiu que s’han de gestionar les regles de firewall per habilitar la connectivitat cap al servei d’Antivirus des dels servidors d'aplicacions.\r\n\r\nPer a obtenir més informació del Mòdul d'Antivirus podeu consultar la documentació del [Connector d'Antivirus] (/canigo-documentacio-versions-3x-integracio/modul-antivirus/) al Portal de Frameworks i Solucions d’Arquitectura.\r\n","objectID":"L25vdGljaWVzLzIwMTUtMDQtMjQtU0lDIC1wdWJsaWNhY2lvLWFudGl2aXJ1cw=="},"L25vdGljaWVzLzIwMTUtMDQtMDUtU0lDLW1pZ3JhY2nDsw==":{"date":1428192000000,"title":"SIC. Migració a nou model TIC finalitzada","description":"El passat mes de Març ha finalitzat la migració d'aplicacions al SIC de l'antic model, basat en departaments i acrònims d'aplicació, cap al nou, basat en àmbits i codis de diàleg","sections":["Notícies","home"],"categories":["desenvolupament","sic"],"path":"/noticies/2015-04-05-SIC-migració","content":"El passat mes de Març ha finalitzat la migració d'aplicacions al SIC de l'antic model, basat en departaments i acrònims d'aplicació, cap al nou, basat en àmbits i codis de diàleg.\n\nEls nous repositoris de [Subversion] (http://svn.intranet.gencat.cat/) compten ara amb un total de 532 codis de diàleg donats d'alta. En el següent gràfic es mostren el total de codis de diàleg distribuïts per àmbits:\n\n<CENTER>![sic](/images/news/codisdialeg_per_ambit.png)</center>\n\nEls repositoris de l'antic model es conserven com a backup però s'hi ha deshabilitat l'accés. Aquests es mantindran fins al 30 / 6, i passada aquesta data s'eliminaran. Destacar que totes aquelles persones que no hagin demanat permisos als nous repositoris no hi tindran accés donat que no s'han migrat usuaris i permisos. Aquest és l'enllaç a la [secció de documentació](/sic/documentacio) on es pot trobar el formulari de gestió d'usuaris del SIC. \n\nPer qualsevol consulta referent a la migració de repositoris es pot fer arribar una petició de consulta al JIRA CSTD al servei [SICQ] (https://cstd.ctti.gencat.cat/jiracstd/browse/SICQ) o [s'ha d'obrir una petició Remedy de consulta al SIC](http://canigo.ctti.gencat.cat/howtos/2018-01-howto-obrir-peticions-SIC-a-autoservei-Remedy/#consulta).\n","objectID":"L25vdGljaWVzLzIwMTUtMDQtMDUtU0lDLW1pZ3JhY2nDsw=="},"L25vdGljaWVzLzIwMTUtMDYtMDItQ2FuaWdvLVBsdWdpbg==":{"date":1433203200000,"title":"Canigó. Actualització del plugin de Canigó per Eclipse","description":"Recentment s'ha publicat una nova versió del Plugin de Canigó per Eclipse. Aquesta versió és compatible amb la versió d'Eclipse Luna (4.4) per a dos de les seves 2 distribucions: Eclipse IDE for Java Developers i Eclipse IDE for Java EE Developers. A banda d'aquesta actualització del plugin també s'ha certificat el seu funcionament en S.O. Linux.","sections":["Notícies","home"],"categories":["desenvolupament","canigó"],"key":"JUNY2015","path":"/noticies/2015-06-02-Canigo-Plugin","content":"Recentment s'ha publicat una nova versió del Plugin de Canigó per Eclipse. Aquesta versió és compatible amb la versió d'Eclipse Luna (4.4) per a dos de les seves distribucions: Eclipse IDE for Java Developers i Eclipse IDE for Java EE Developers. A banda d'aquesta actualització del plugin també s'ha certificat el seu funcionament en S.O. Linux.\r\n\r\nA la següent taula s'aporta el detall de les diferents versions existents del plugin:\r\n\r\n*Nota: en la taula es mostra la última \"fix\" version de cada \"minor\" version*\r\n\r\n|Versió Plugin|Versió Canigó|Versió JSF|Spring MVC|Versió Eclipse|Compatibilitat S.O.|\r\n|-----|---|---|---|--------------|-------|\r\n|**1.0.1**|3.0.1|1.2|N/A|Helios (3.6.1)|Windows|\r\n|**1.1.0**|3.0.2|2.0|N/A|Helios (3.6.1)|Windows|\r\n|**1.2.1**|3.1.x|2.2|4.1.0.RELEASE|Helios (3.6.1)|Windows|\r\n|**1.3.1**|3.1.x|2.2|4.1.0.RELEASE|Luna (4.4)*|Windows + Linux|\r\n\r\n*Per a fer servir la versió 1.3.1 del Plugin amb la distribució JEE d'Eclipse Luna cal aplicar un patch que consisteix en substituïr una llibreria de la instal·lació base:\r\n\r\n+ La llibreria que cal sobreescriure es troba a: \\<eclipse_home\\>/plugins/org.eclipse.m2e.maven.runtime_1.5.1.20150109-1819/jars/maven-embedder-3.2.1.jar\r\n+ La llibrería amb la que s'ha de sobreescriure es pot descarregar des d'[aquest enllaç](http://canigo.ctti.gencat.cat/devenv/patch_plugin_canigo/maven-embedder-3.2.1.jar)\r\n\r\nUn cop finalitzat aquest procediment ja es pot crear un projecte Canigó des de l'Eclipse: New -> Other -> Asistent projectes Canigó -> Crear un projecte Canigó. Trobareu més informació relativa al Plugin de Canigó a la [documentació](/canigo-download-related/plugin-canigo).","objectID":"L25vdGljaWVzLzIwMTUtMDYtMDItQ2FuaWdvLVBsdWdpbg=="},"L25vdGljaWVzLzIwMTUtMDctMjQtQ2FuaWdvLUFycXVpdGVjdHVyYS1hcGxpY2FjaW8tcmVjb21hbmFkYQ==":{"date":1437696000000,"title":"Canigó. Arquitectura aplicació recomanada","description":"Des del CS Canigó es segueix treballant per potenciar el desenvolupament d'aplicacions amb arquitectures client/servidor desacoblades basades en serveis Rest i HTML5/JS. Aquest tipus d'arquitectura facilita el desenvolupament de la part client i servidor de forma independent.","sections":["Notícies","home"],"key":"AGOST2015","categories":["desenvolupament","canigó"],"path":"/noticies/2015-07-24-Canigo-Arquitectura-aplicacio-recomanada","content":"Des del CS Canigó es segueix treballant per potenciar el desenvolupament d'aplicacions amb arquitectures client/servidor desacoblades basades en serveis REST i HTML5/JS. Aquest tipus d'arquitectura facilita el desenvolupament de la part client i servidor de forma independent el que suposa una sèrie d'avantatges entre els quals destaquem:\r\n\r\n* *Diferents equips de desenvolupament*: permet tenir equips especialitzats en maquetació per la capa de presentació i tècnics JEE per el backend.\r\n* *Múltiples clients*: disposar de diferents clients (Ex. web, aplicacions natives a dispositius mòbils) que consumeixen uns mateixos serveis.\r\n* *Modularització*: backend modularitzat, és a dir, diferents aplicacions  fins i tot implementades amb diferents tecnologies. Per a l’usuari seria transparent en tenir un client web únic.\r\n* *Rendiment*: és possible desplegar les planes HTML en un servidor web (Apache, Nginx) amb la resta del contingut estàtic i els serveis en un contenidor de servlets (Ex. Tomcat) o servidor d'aplicacions  (Ex. Weblogic). El fet que les planes HTML puguin ser servides directament per un servidor web sense necessitat d'arribar al servidor d'aplicacions fa que es pugui tenir un millor rendiment.\r\n\r\nL'aplicació SICJA (Sistema d'Informació de la Comissió Jurídica Assessora) del Departament de Presidència està sent desenvolupada amb aquesta arquitectura  i les impressions rebudes tant per l'usuari com per l'equip tècnic estan sent molt positives.\r\n\r\nEl desenvolupament d'aplicacions JEE amb aquesta arquitectura en detriment de JSF (JavaServer Faces) és una tendència global i que es pot visualitzar a Google Trends:\r\n\r\n<CENTER>![canigo-tendencia-tecnologies](/images/news/canigo-tendencia-tecnologies.png)</center>\r\n\r\n*Termes comparats*: Primefaces, Richfaces, JavaServer Faces (JSF), Representational state transfer (REST) i AngularJS (JavaScript MVW Framework)\r\n\r\nQualsevol proveïdor d'aplicacions de la Generalitat que vulgui desenvolupar aplicacions Canigó amb aquesta arquitectura pot utilitzar el plugin d'Eclipse (versió >= 1.2.0) que proporciona el CS Canigó per crear la base de l'aplicació. Més informació del plugin a la següent [plana](http://canigo.ctti.gencat.cat/canigo-download-related/plugin-canigo/)).","objectID":"L25vdGljaWVzLzIwMTUtMDctMjQtQ2FuaWdvLUFycXVpdGVjdHVyYS1hcGxpY2FjaW8tcmVjb21hbmFkYQ=="},"L25vdGljaWVzLzIwMTUtMDYtMTUtU0lDLURlc3BsZWdhbWVudHMgSm9icyBSZW1lZHk=":{"date":1434326400000,"title":"SIC. Peticions desplegament via Remedy","description":"Fins ara totes les peticions de desplegament de les aplicacions a entorns PRE i PRO realitzades des del SIC es demanaven via correu a SAU (sau.ctti@gencat.cat). El SIC està evolucionant per tal que aquestes peticions de desplegament es sol·licitin via Remedy a mida que van migrant les aplicacions a aquest nou sistema.","sections":["Notícies","home"],"categories":["sic"],"key":"JULIOL2015","path":"/noticies/2015-06-15-SIC-Desplegaments Jobs Remedy","content":"Fins ara totes les peticions de desplegament de les aplicacions a entorns PRE i PRO realitzades des del SIC es demanaven via correu a SAU (sau.ctti@gencat.cat). El SIC està evolucionant per tal que aquestes peticions de desplegament es sol·licitin via Remedy a mida que van migrant les aplicacions a aquest nou sistema.\nPer tal d'assolir aquest objectiu s'estan adaptant els jobs de Jenkins del SIC per tal d'integrar-se amb Remedy. Aquesta integració es realitzarà en 2 fases:\n\n+ 1a Fase: Es deshabilitarà l'execució de tots els jobs de PRE/PRO de les aplicacions que ja es trobin a Remedy. Gràcies a un sistema d'alertes seran fàcilment identificables els jobs afectats. A més, s'han enviat comunicats informatius als usuaris Release Manager d'aquestes aplicacions.\n+ 2a Fase: S'implementarà la integració SIC - Remedy per tal de permetre que els jobs obrin peticions de desplegament a PRE/PRO mitjançant la generació d'un canvi en mode DRAFT a Remedy. S'aplicarà aquesta integració als jobs deshabilitats i es reactivaran. La previsió es que a finals de Juliol es realitzi aquesta activació.\n\nMentre no s'hagi completat aquesta integració, el procediment que caldrà seguir per a demanar desplegaments d’aquestes aplicacions serà el definit per Gestió de Serveis, és a dir, obrint una RFC directament a Remedy demanant el desplegament i indicant a CPD la ubicació de l'artefacte i les instruccions de desplegament.\n\nUna vegada completat, a mesura que les aplicacions amb jobs al SIC migrin a Remedy, l'equip del SIC actualitzarà els jobs de desplegament per tal que utilitzin aquesta via.\n\nL'escenari final contempla que totes les aplicacions estiguin integrades a Remedy, però fins llavors al SIC ens trobarem en una situació com la següent:\n\n<CENTER>![SIC-Desplegament-Remedy.png](/images/news/SIC-Desplegament-Remedy.png)</center>\n\nPer qualsevol dubte relatiu a aquesta integració del SIC amb Remedy us podeu posar en contacte amb l'equip del SIC [obrint una petició Remedy de consulta al SIC](http://canigo.ctti.gencat.cat/howtos/2018-01-howto-obrir-peticions-SIC-a-autoservei-Remedy/#consulta).","objectID":"L25vdGljaWVzLzIwMTUtMDYtMTUtU0lDLURlc3BsZWdhbWVudHMgSm9icyBSZW1lZHk="},"L25vdGljaWVzLzIwMTUtMDctMzEtQ2FuaWdvLVBsdWdpbi1FY2xpcHNlLU1hcnM=":{"date":1438300800000,"title":"Canigó. Certificació plugin Canigó a Eclipse Mars","description":"Donada la recent publicació d'Eclipse Mars (4.5) des del CS Canigó s'ha certificat el funcionament del plugin per la creació de projectes Canigó 3.1 en aquesta versió d'Eclipse.","sections":["Notícies","home"],"key":"AGOST2015","categories":["desenvolupament","canigó"],"path":"/noticies/2015-07-31-Canigo-Plugin-Eclipse-Mars","content":"Donada la recent publicació d'[Eclipse Mars (4.5)](https://projects.eclipse.org/releases/mars) des del CS Canigó s'ha certificat el funcionament del plugin per la creació de projectes Canigó 3.1 en aquesta versió d'Eclipse.\r\n\r\nAquesta és la taula actualitzada amb les diferents versions existents del plugin:\r\n\r\n*Nota: en la taula es mostra l'última \"fix\" version de cada \"minor\" version*\r\n\r\n|Versió Plugin|Versió Canigó|Versió JSF|Spring MVC|Versió Eclipse|Compatibilitat S.O.|\r\n|-----|---|---|---|--------------|-------|\r\n|**1.0.1**|3.0.1|1.2|N/A|Helios (3.6.1)|Windows|\r\n|**1.1.0**|3.0.2|2.0|N/A|Helios (3.6.1)|Windows|\r\n|**1.2.1**|3.1.x|2.2|4.1.0.RELEASE|Helios (3.6.1)|Windows|\r\n|**1.3.1**|3.1.x|2.2|4.1.0.RELEASE|Luna (4.4)*|Windows + Linux|\r\n|**1.4.0**|3.1.x|2.2|4.1.0.RELEASE|Mars (4.5)*|Windows + Linux|\r\n\r\n*Per a fer servir les versions 1.3.1 i 1.4.0 del Plugin amb la distribució JEE d'Eclipse cal aplicar un patch que consisteix en substituir una llibreria de la instal·lació base:\r\n\r\n_Eclipse Luna_\r\n\r\n+ La llibreria que cal sobreescriure es troba a: \\<eclipse_home\\>/plugins/org.eclipse.m2e.maven.runtime_1.5.1.20150109-1819/jars/maven-embedder-3.2.1.jar\r\n+ La llibrería amb la que s'ha de sobreescriure es pot descarregar des d'[aquest enllaç](http://canigo.ctti.gencat.cat/devenv/patch_plugin_canigo/maven-embedder-3.2.1.jar)\r\n\r\n_Eclipse Mars_\r\n\r\n+ La llibreria que cal sobreescriure es troba a: \\<eclipse_home\\>/plugins/org.eclipse.m2e.maven.runtime_1.6.0.20150526-2031/jars/maven-embedder-3.3.3.jar\r\n+ La llibrería amb la que s'ha de sobreescriure es pot descarregar des d'[aquest enllaç](http://canigo.ctti.gencat.cat/devenv/patch_plugin_canigo/maven-embedder-3.3.3.jar)\r\n\r\nUn cop finalitzat aquest procediment ja es pot crear un projecte Canigó des de l'Eclipse: New -> Other -> Assistent projectes Canigó -> Crear un projecte Canigó. Trobareu més informació relativa al Plugin de Canigó a la [documentació](/canigo-download-related/plugin-canigo).\r\n","objectID":"L25vdGljaWVzLzIwMTUtMDctMzEtQ2FuaWdvLVBsdWdpbi1FY2xpcHNlLU1hcnM="},"L25vdGljaWVzLzIwMTUtMDgtMzEtU0lDLUludGVncmFjacOzLWRlbC1TSUMtYS1SZW1lZHk=":{"date":1440979200000,"title":"SIC. Obertura de peticions al SIC via Remedy","description":"Degut a que els sistemes de suport a l'usuari de la Generalitat de Catalunya s'estan integrant a Remedy, el CS Canigó està treballant en la integració del SIC a aquest sistema.","sections":["Notícies","home"],"categories":["sic"],"key":"SEPTEMBRE2015","path":"/noticies/2015-08-31-SIC-Integració-del-SIC-a-Remedy","content":"Degut a que els sistemes de suport a l'usuari de la Generalitat de Catalunya s'estan integrant a [Remedy](https://pautic.gencat.cat), el CS Canigó està treballant conjuntament amb l'equip de SAU-Remedy en la integració del SIC a aquest sistema. \n\nFins ara, les peticions es gestionaven mitjançant el Servei de SIC al [JIRA del CSTD](http://cstd.ctti.gencat.cat) o a través del correu electrònic de la bústia SIC. \n\nEn breu s'activarà el servei 'Framework SIC' a Remedy i les peticions a SIC ja es podran d'obrir mitjançant aquesta eina. Tant les noves peticions de SIC via JIRA CSTD com les rebudes via bústia SIC, es redirigiran internament cap a Remedy, [fent una petició Remedy al SIC](http://canigo.ctti.gencat.cat/howtos/2018-01-howto-obrir-peticions-SIC-a-autoservei-Remedy/).\n\nEs deixarà un mes de convivència entre els tres mètodes d’entrada (bústia, JIRA i Remedy). Transcorregut aquest temps, es tancarà definitivament la bústia de SIC i el servei de SIC al JIRA CSTD i totes les peticions s'hauran de gestionar via Remedy.\n\n<center>![peticions_sic_a_Remedy.png](/images/news/peticions_sic_a_Remedy.png)</center>\n\nS'emetrà un comunicat oficial informant d'aquest canvi de gestió sobre les peticions SIC on s'ampliarà aquesta informació i s'actualitzarà la documentació sobre SIC del portal per tal de reflectir aquest canvi.\n","objectID":"L25vdGljaWVzLzIwMTUtMDgtMzEtU0lDLUludGVncmFjacOzLWRlbC1TSUMtYS1SZW1lZHk="},"L25vdGljaWVzLzIwMTUtMDUtMjktU0lDLVVwZ3JhZGUtU1ZO":{"date":1432857600000,"title":"SIC. Upgrade versió Subversion al SIC","description":"En breu s'actualitzarà la versió de SVN del servidor de SIC, passant d'una 1.6.11 a una 1.8.13. Aquesta actualització comportarà una sèrie de millores en rendiment, robustesa i seguretat al SVN de SIC.","sections":["Notícies","home"],"categories":["sic"],"key":"JUNY2015","path":"/noticies/2015-05-29-SIC-Upgrade-SVN","content":"En breu s'actualitzarà la versió de SVN del servidor de SIC, passant d'una 1.6.11 a una 1.8.13. Aquesta actualització comportarà una sèrie de millores al SVN de SIC, de les quals destaquem les següents:\n\n||Subversion 1.6|Subversion 1.8|\n|----------------------|-----------|-------------|\n|Llibreria client HTTP|neon* |serf (+rendiment)|\n|Sistema d'arxius al repositori|basat en Berkeley DB* |basat en FSFS (+robustesa)|\n|Llistat d'arxius|En accedir a l'arrel del repositori d'àmbit es presentaran totes les carpetes de codi diàleg (tot i que només deixa accedir a les que es té permís).| En accedir a l'arrel del repositori d'àmbit, només es presenten les carpetes de codi diàleg a les que es pot accedir.|\n*Deprecat per Apache\n\nTrobareu més detall dels canvis a la pàgina oficial de les [Release Notes de la versió 1.8 de Subversion](https://subversion.apache.org/docs/release-notes/1.8.html).\n\n#### Compatibilitat amb clients SVN < 1.8\nEs recomana a aquells usuaris de SIC que continuen treballant amb un client anterior a la 1.8.X que s'actualitzin també a aquesta versió per tal que puguin aprofitar al màxim les millores que introduirà aquesta versió.\n\nPer a obtenir més informació relativa al SIC podeu accedir a la [secció SIC](http://canigo.ctti.gencat.cat/sic/) dins el Portal de Frameworks i Solucions d'Arquitectura. Per consultes o suport preferiblement fer una petició al [Servei SICQ del JIRA CSTD](https://cstd.ctti.gencat.cat/jiracstd/browse/SICQ) o [s'ha d'obrir una petició Remedy de consulta al SIC](http://canigo.ctti.gencat.cat/howtos/2018-01-howto-obrir-peticions-SIC-a-autoservei-Remedy/#consulta).","objectID":"L25vdGljaWVzLzIwMTUtMDUtMjktU0lDLVVwZ3JhZGUtU1ZO"},"L25vdGljaWVzLzIwMTUtMDktMDEtQ2FuaWdvLVBsYW50aWxsYS1hcGxpY2FjaW8tcmVzdA==":{"date":1441065600000,"title":"Canigó. Plantilla aplicació REST+HTML5/Js","description":"Des de CS Canigó es proporciona una plantilla d'aplicació amb arquitectura REST+HTML5/Js. Aquesta és pot generar amb el plugin de Canigó per Eclipse versió 1.2.1 o superior","sections":["Notícies","home"],"categories":["canigo"],"key":"SEPTEMBRE2015","path":"/noticies/2015-09-01-Canigo-Plantilla-aplicacio-rest","content":"Des del CS Canigó es recomana utilitzar arquitectures client/servidor desacoblades basades en serveis REST i HTML5/JS [(comunicat Agost 2015)] (/noticies/2015-07-24-Canigo-Arquitectura-aplicacio-recomanada). Per el frontend es dóna llibertat a utilitzar la tecnologia desitjada sempre que compleixi el PIV de Gencat. \r\n\r\nA partir de la versió 1.2.1** del Plugin de Canigó per Eclipse es pot generar l'esquelet d'una aplicació Canigó 3.1 amb arquitectura REST+HTML5/Javascript.A la plantilla que es crea amb el plugin, la part frontend corrersponent a un CRUD (Create-Read-Update-Delete) molt bàsic es troba realitzada amb HTML5/Javascript. No s'ha utilitzat cap llibreria de frontend (AngularJS, Bootstrap, EmberJS...), ja que és decisió de l'usuari triar la tecnologia més adient per la seva aplicació.\r\n\r\nAl HowTo publicat [aquest mes] (/related/canigo/howto/Canigo - HowTo - Generacio aplicacio Canigo 3.1 amb plugin Eclipse.pdf) es descriu com fer la instal·lació de l'última versió del plugin (1.4.0) i la creació de l'esquelet d'una aplicació Canigó.\r\n\r\nRespecte a les tecnologies emprades a Canigó 3.1 per al backend les més rellevants són les següents:\r\n\r\n* *Spring MVC 4.1.0.RELEASE* : Framework Web basat en el patró Model-View-Controller.\r\n* *Spring Security 4.0.0.M2*: Framework que té la funció de proporcionar tant funcions d'autenticació com d'autorització a aplicacions Java.\r\n* *JPA (Java Persistence API) 2.1*: Busca la manera d'unificar les utilitats que proporcionen un mapeig objecte-relacional. La implementació de JPA per defecte a Canigó 3.1 és Hibernate versió 4.3.6.\r\n\r\nRecordar la Taula de compatibilitat de versions del plugin segons la versió d'Eclipse:\r\n\r\n|Versió Plugin|Versió Eclipse|\r\n|-----|--------------|\r\n|**1.2.1**|Helios (3.6.1)|\r\n|**1.3.1**|Luna (4.4)|\r\n|**1.4.0**|Mars (4.5)|","objectID":"L25vdGljaWVzLzIwMTUtMDktMDEtQ2FuaWdvLVBsYW50aWxsYS1hcGxpY2FjaW8tcmVzdA=="},"L25vdGljaWVzLzIwMTUtMDktMjMtQ2FuaWdvLVVzLWFwcGxldC1zaWduYXR1cmEtQ0FPQw==":{"date":1443484800000,"title":"Canigó. Ús applet d'e-signatura del CAOC","description":"La versió 45 del navegador web Google Chrome deixa de donar suport a la tecnologia NPAPI requerida per els applets Java. En conseqüència, l'applet d'e-signatura del CAOC s'ha d'executar en un altre navegador.","sections":["Notícies","home"],"key":"OCTUBRE2015","categories":["canigo"],"path":"/noticies/2015-09-23-Canigo-Us-applet-signatura-CAOC","content":"La versió 45 del navegador web Google Chrome deixa de donar suport a la tecnologia NPAPI requerida pels applets Java. En conseqüència, applets com el d'e-signatura del CAOC s'han d'executar en un altre navegador com per exemple Firefox o Internet Explorer.\r\n\r\nReferències:\r\n\r\n- [Chrome Support](https://support.google.com/chrome/answer/6213033)\r\n- [Java and Google Chrome Browser](https://java.com/en/download/faq/chrome.xml)\r\n\r\nDes d'altres navegadors, si la seguretat de Java bloqueja l'execució de l'applet cal afegir una excepció de seguretat per al lloc web del qual es descarrega.\r\n\r\nEn el cas concret de l'applet d'e-signatura, a més de tenir en compte aquests pre-requisits, des del consorci es fan una sèrie de recomanacions per la seva correcta execució:\r\n\r\n- Validar la versió de Safesign del client, en cas que no sigui l'última (3.0.76) s'hauria de desinstal·lar i descarregar des de la web del AOC ([Instal·lació T-CAT](https://web.aoc.cat/suport/knowledge-base/installacio-t-cat/))\r\n- Si es disposa d'un altre lector, es pot fer la prova si està dins la [llista de lectors homologats](https://web.aoc.cat/suport/knowledge-base/llista-de-lectors-homologats)\r\n- En cas de dubtes us podeu posar en contacte amb el CAOC a través del [Formulari de Suport](https://web.aoc.cat/suport/formulari-t-cat/)\r\n\r\n","objectID":"L25vdGljaWVzLzIwMTUtMDktMjMtQ2FuaWdvLVVzLWFwcGxldC1zaWduYXR1cmEtQ0FPQw=="},"L25vdGljaWVzLzIwMTUtMTAtMjctQ2FuaWdvLUFkYXB0YWNpby1hbC1QSVY=":{"date":1445904000000,"title":"Canigó. Adaptació al PIV de Gencat","description":"L'adaptació al PIV de Gencat és un requeriment per moltes aplicacions. L'estratègia a seguir per les aplicacions Canigó depèn de la versió en què estigui implementada.","sections":["Notícies","home"],"key":"NOVEMBRE2015","categories":["canigo"],"path":"/noticies/2015-10-27-Canigo-Adaptacio-al-PIV","content":"L'adaptació al [PIV (Programa d'Identificació Visual) de la Generalitat de Catalunya](http://www.gencat.cat/web/guies/estil/) és un requeriment per a moltes aplicacions web construïdes amb Canigó. L'estratègia a seguir per a aquestes aplicacions depèn de la versió en què estigui implementada. \r\n\r\n### Aplicacions ja desenvolupades amb Canigó 2 i Canigó 3\r\n\r\n* **Millor opció**:\r\n\r\n\t- Adaptar l'estil de l'aplicació al PIV mitjançant la modificació i creació de nous estils (css) sense modificar l'estructura (plantilles html) de l'aplicació. \r\n\r\n\t- Requereix un expert en maquetació, però l'esforç és molt menor que modificar l'estructura de les plantilles i incorporar els nous css\r\n\r\n* **No es recomana**:\r\n\r\n\t- Incorporar les plantilles de Bootstrap del nou Gencat ja que pot produir incompatibilitats amb la llibreria prototype.js utilitzada al servei de presentació de Canigó 2, a més de l'esforç que suposa modificar la capa de presentació (struts).\r\n\r\n* **Solució alternativa**:\r\n\r\n\t- Refer l'arquitectura de l'aplicació per desacoblar presentació i negoci. S'ha de tenir en compte que pot tenir un cost molt elevat.\r\n\r\n### Noves aplicacions Canigó 3\r\n\r\n* **Recomanació**:\r\n\r\n\t- Incorporació de Bootstrap 3 per al templating de l'aplicació i que l'arquitectura d'aquesta estigui basada en desacoblament client/servidor (veure [Arquitectura aplicació recomanada](/noticies/2015-07-24-Canigo-Arquitectura-aplicacio-recomanada/)). Qualsevol canvi en la presentació només suposarà canvis en el client i no haver de redesplegar el backend.\r\n\r\n\t- Es poden tenir equips separats per al manteniment i evolució de la presentació i el negoci, que poden portar ritmes diferents.\r\n\r\n* **No es recomana**:\r\n\r\n\t- Utilitzar una arquitectura a l'aplicació amb acoblament entre client i servidor (struts, jsf, ...) donat que pot dificultar modificacions en el templating i els estils.","objectID":"L25vdGljaWVzLzIwMTUtMTAtMjctQ2FuaWdvLUFkYXB0YWNpby1hbC1QSVY="},"L25vdGljaWVzLzIwMTUtMTEtMDUtRkFRcyBTSUM=":{"date":1446681600000,"title":"SIC. FAQ","description":"Com a novetat, a la secció SIC del Portal de Frameworks i Solucions d'Arquitectura, pròximament es publicaran les FAQ del SIC. L'objectiu d'aquestes FAQ és donar resposta a les qüestions que sovint ens plantegen els proveïdors d'aplicacions respecte a la integració amb el SIC.","sections":["Notícies","home"],"key":"NOVEMBRE2015","categories":["sic"],"path":"/noticies/2015-11-05-FAQs SIC","content":"Com a novetat, a la secció SIC del Portal de Frameworks i Solucions d'Arquitectura, pròximament es publicaran les FAQ del SIC. L'objectiu d'aquestes FAQ és donar resposta a les qüestions que sovint ens plantegen els proveïdors d'aplicacions respecte a la integració amb el SIC.\r\n\r\nA continuació s'enumeren algunes de les entrades que apareixeran en aquestes FAQ:\r\n<br/>\r\n<br/>\r\n<br/>\r\n\r\n\r\n**Es poden pujar binaris al SVN del SIC?**\r\n\r\nPer defecte no donat que el SVN del SIC és un repositori de codi font, no de binaris. Ara bé, es poden contemplar excepcions en cas que el codi font inclogui Applets/Servlets, l'aplicació no es trobi mavenitzada o es vulgui fer ús del SVN de SIC per l'entrega de binaris a CPD. En aquests casos cal demanar l'excepció via SAU-Remedy.\r\n<br/>\r\n<br/>\r\n<br/>\r\n\r\n\r\n**Puc demanar l'alta d'un usuari per accedir a un repositori del SVN?**\r\n\r\nNo tothom pot demanar d'alta usuaris al SIC, només ho poden demanar els responsables d'àmbit (OGOS, OGDP, @gencat.cat) o de CPD.\r\n<br/>\r\n<br/>\r\n<br/>\r\n\r\n\r\n**El meu àmbit encara no està migrat a Remedy i no disposo d'usuari a Remedy per poder obrir peticions SIC en aquest canal. Com puc fer peticions de SIC?**\r\n\r\nEn aquest cas concret, es pot fer enviant un correu a la [bústia de SAU-REMEDY] (mailto:sau.tic@gencat.cat) incloent tota la informació necessària per tractar la petició. Per a més informació consultar la secció sobre [Peticions SIC a SAU-Remedy](http://localhost:1313/sic/peticions/)\r\n<br/>\r\n<br/>\r\n<br/>\r\n\r\n\r\n**Puc variar l'estructura de carpetes dels repositoris SVN de les meves aplicacions?**\r\n\r\nEls usuaris són lliures de poder modificar l'estructura de carpetes dins l'arrel dels repositoris SVN de SIC. SIC recomana una manera de treballar i en crear el repositori genera una estructura per defecte d'acord a aquesta manera. \r\n\r\nEn cas de voler utilitzar els repositoris SVN de SIC per a fer arribar els binaris a desplegar a CPD o voler fer servir jobs de Jenkins, sí que cal respectar certes normes. Aquestes es troben publicades al [Manual d'Integració de SIC](http://canigo.ctti.gencat.cat/related/sic/manual-integracio.pdf), apartats 3.1.4 i 3.1.5 .\r\n<br/>\r\n<br/>\r\n<br/>\r\n\r\n\r\n**Perquè en desplegar la meva aplicació a INT mitjançant un job de Jenkins del SIC s'ha desplegat una versió d'aplicació anterior a la que he escollit?**\r\n\r\nMolt probablement es deu al fet que abans l'execució del job s'ha desplegat l'aplicació manualment mitjançant la consola d'administració i la configuració de desplegament ha quedat lligada a aquella versió i no pas a la versió que compila i puja el job.\r\n\r\nPer a més informació sobre aquest problema i com evitar-ho, consultar el següent [article](http://canigo.ctti.gencat.cat/noticies/2015-10-05-SIC-Bones-practiques-desplegaments-INT/)\r\n<br/>\r\n<br/>\r\n<br/>\r\n<br/>\r\n\r\nA més d'aquestes FAQ, al [Portal de Frameworks i Solucions d'Arquitectura](http://canigo.ctti.gencat.cat/sic-documentacio/manuals/) hi ha publicats els Manuals d'Usuari i Integració amb més informació. En cas de dubtes es poden fer consultes via SAU-Remedy al servei \"FRAMEWORK SIC\".","objectID":"L25vdGljaWVzLzIwMTUtMTEtMDUtRkFRcyBTSUM="},"L25vdGljaWVzLzIwMTUtMTEtMDYtQ1MgQ2FuaWdvLVJvYWRtYXA=":{"date":1446768000000,"title":"CS Canigó. Roadmap","description":"Aquest mes d'Octubre ha estat publicat el Roadmap del CS Canigó. D'aquesta manera es dona visibilitat a les tasques que es fan des del Centre de Suport a curt i llarg termini amb una previsió de lliurament.","sections":["Notícies","home"],"key":"NOVEMBRE2015","categories":["cscanigo"],"path":"/noticies/2015-11-06-CS Canigo-Roadmap","content":"Aquest mes d'Octubre ha estat publicat el Roadmap del CS Canigó. D'aquesta manera es dona visibilitat a les tasques que es fan des del Centre de Suport a curt i llarg termini amb una previsió de lliurament.\r\n\r\n<iframe src='//cdn.knightlab.com/libs/timeline3/latest/embed/index.html?source=1ycTBuP_02_fFQYHePMhAxAnNt70R4GyTP4phJn3EHi8&font=Default&lang=ca&initial_zoom=1&height=600' width='100%' height='600' frameborder='0'></iframe>\r\n\r\n*Aquest Roadmap està subjecte a canvis*\r\n\r\n<br>\r\n\r\nEl Roadmap és accessible des de la plana principal del [Portal de Frameworks i Solucions d'Arquitectura](http://canigo.ctti.gencat.cat). En aquesta mateixa plana, pròximament s'habilitarà un enllaç a un formulari amb la finalitat de fer arribar al CS Canigó propostes d'evolutius a incloure en el Roadmap.","objectID":"L25vdGljaWVzLzIwMTUtMTEtMDYtQ1MgQ2FuaWdvLVJvYWRtYXA="},"L25vdGljaWVzLzIwMTUtMTAtMDUtU0lDLUJvbmVzLXByYWN0aXF1ZXMtZGVzcGxlZ2FtZW50cy1JTlQ=":{"date":1444176000000,"title":"SIC. Bones pràctiques per a no interferir en els mecanismes de SIC quan s’accedeix manualment a la consola d’administració del servidor d’aplicacions","description":"Una de les funcionalitats més destacades del SIC és el desplegament automàtic d'aplicacions en entorns d'INT. Amb l'experiència adquirida fins ara en els nous CPDs, des de l'equip del SIC recomanem una sèrie de bones pràctiques per tal d'evitar que actuacions alienes al SIC puguin interferir en el correcte funcionament d'aquests desplegaments automatitzats.","sections":["Notícies","home"],"categories":["sic"],"key":"OCTUBRE2015","path":"/noticies/2015-10-05-SIC-Bones-practiques-desplegaments-INT","content":"Una de les funcionalitats més destacades del SIC és el desplegament automàtic d'aplicacions en entorns d'INT. Amb l'experiència adquirida fins ara en els nous CPDs, des de l'equip del SIC recomanem una sèrie de bones pràctiques per tal d'evitar que actuacions alienes al SIC puguin interferir en el correcte funcionament d'aquests desplegaments automatitzats.\r\n\r\nEls jobs de desplegament a entorns d'INT de SIC (en endavant jobs d'INT) s'aprovisionen d'acord a la configuració de desplegament de l'aplicació al servidor d'aplicacions. Una vegada l'equip de SIC finalitza l'aprovisionament del job d'INT aquest queda lligat a aquesta configuració. Un canvi de configuració al servidor d'aplicacions pot provocar que el job deixi de funcionar correctament pel fet que no es podrà realitzar el desplegament.\r\n\r\nPer tant, la recomanació és que un cop aprovisionat el job d'INT no es faci servir cap altre via de desplegament que no sigui el propi SIC. En cas contrari, és responsabilitat del proveïdor d'aplicacions conèixer si el desplegament pot implicar que el job d'INT del SIC deixi de funcionar.\r\n\r\nAquestes són les accions detectades que poden produir un problema al funcionament del job d'INT:\r\n\r\n* _Canvi del nom de l'aplicació a la consola d'administració del servidor_: el job referenciarà a un nom d'aplicació inexistent\r\n* _Canvi del path i/o nom de l'artefacte a desplegar_: el job no desplegarà la versió de l'artefacte que s'està promovent des del SIC\r\n* _Canvi dels permisos de l'artefacte a desplegar_: el job podria tenir problemes de permisos per enviar l'artefacte o el servidor d'aplicacions per llegir-lo\r\n\r\nEn el següent diagrama s'il·lustra l'efecte que pot produir alguna d'aquestes accions:\r\n\r\n<center>![deploy_INT.jpg](/images/news/deploy_INT.jpg)</center>\r\n\r\n\r\nPer a qualsevol dubte relatiu a aquest tema, ens podeu obrir una consulta a Remedy al servei \"FRAMEWORK SIC\".","objectID":"L25vdGljaWVzLzIwMTUtMTAtMDUtU0lDLUJvbmVzLXByYWN0aXF1ZXMtZGVzcGxlZ2FtZW50cy1JTlQ="},"L25vdGljaWVzLzIwMTUtMTEtMTgtQ2FuaWdvLUVudG9ybi1EZXY=":{"date":1447804800000,"title":"Canigó. Nou entorn de desenvolupament","description":"A mitjans d'aquest mes de Novembre ha estat publicat el nou entorn de desenvolupament de Canigó. Amb aquest nou entorn es canvia l'antic instal·lable (.exe) exclusiu per a sistemes operatius Windows per un entorn multiplaforma amb moltes més possibilitats.","sections":["Notícies","home"],"key":"DESEMBRE2015","categories":["canigo"],"path":"/noticies/2015-11-18-Canigo-Entorn-Dev","content":"A mitjans d'aquest mes de Novembre ha estat publicat el nou entorn de desenvolupament de Canigó. Amb aquest nou entorn es canvia l'antic instal·lable (.exe) exclusiu per a sistemes operatius Windows per un entorn multiplaforma amb moltes més possibilitats.\r\n\r\n\r\nA continuació s'especifiquen les característiques més rellevants d'aquest nou entorn de desenvolupament:\r\n\r\n**Màquina virtual**\r\n\r\n* VM [Oracle VirtualBox](https://www.virtualbox.org/): aprovisionament de màquina virtual a partir d'un script [Vagrant](https://www.vagrantup.com/)\r\n* Linux: màquina virtual basada en sistema operatiu [Ubuntu](http://www.ubuntu.com/)\r\n* Personalitzacions: màquina virtual personalitzada proporcionant un espai d'eines CTTI\r\n\r\n**IDE**\r\n\r\nL'IDE és [Spring Tool Suite] (https://spring.io/tools) (basat en Eclipse Mars) amb JDK 7 (Oracle) i els següents plugins:\r\n\r\n* M2Eclipse per integració amb [Apache Maven](https://maven.apache.org/)\r\n* CTTI Canigó per creació aplicacions Canigó 3.1 basades en arquitectura REST+HTML5/JS o JSF\r\n* Spring Tool Suite per facilitar el desenvolupament d'aplicacions basades en [Spring](http://spring.io/projects)\r\n* Docker Tooling per manegar els contenidors [Docker](https://www.docker.com/)\r\n* Subclipse per integració amb [Subversion] (https://subversion.apache.org/)\r\n* SonarQube per integració amb [SonarQube] (http://www.sonarqube.org/) (antic Sonar)\r\n\r\n**Altres**\r\n\r\n* Engine Docker i Docker Compose Tool per l'execució de contenidors Docker\r\n* Navegador Google Chrome\r\n* Client VPNC per accés a XCAT\r\n* Fons de pantalla corporatiu CTTI\r\n* Accessos directes a eines CTTI: SIC ([SVN](http://svn.intranet.gencat.cat) i [Jenkins](http://hudson.intranet.gencat.cat)), [JIRA CSTD](https://cstd.ctti.gencat.cat/), [Portal Frameworks i Solucions d'Arquitectura](http://canigo.ctti.gencat.cat/).\r\n\r\n\r\nA més d'aquest nou entorn de desenvolupament des del CS Canigó també s'ha publicat una aplicació demo [Equipaments](https://github.com/gencat/equipaments) amb la finalitat de proporcionar als proveïdors d'aplicacions un exemple d'aplicació Canigó 3.1 per a ser desplegada en contenidors Docker. L'ús d'aquests contenidors Docker pretén simular el desplegament en els PaaS del [Full de ruta de CTTI] (https://portic.ctti.gencat.cat/les_tic/Normativa/arquitectura/Documents/Full%20de%20Ruta%20del%20Programari.pdf#search=full%20de%20ruta). El stack on es desplega aquesta aplicació demo Equipaments és Apache 2.4/Tomcat 7/MySQL 5.6.\r\n\r\nA la secció [\"Framework Canigó\"](http://canigo.ctti.gencat.cat/canigo/) -> [\"Entorn de desenvolupament\"](http://canigo.ctti.gencat.cat/canigo/entorn-desenvolupament/) dins d'aquest portal podeu trobar més informació amb el detall del procés d'instal·lació, execució de l'aplicació demo Equipaments així com d'altra informació d'interès per a treballar amb aquest nou entorn de desenvolupament.\r\n\r\nPer a qualsevol dubte, problema o suggerència relatiu a aquest nou entorn de desenvolupament ens podeu fer arribar una petició al servei [CAN](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN) del JIRA CSTD o bé enviar-nos un correu a la nostra [bústia](mailto:oficina-tecnica.canigo.ctti@gencat.cat).\r\n","objectID":"L25vdGljaWVzLzIwMTUtMTEtMTgtQ2FuaWdvLUVudG9ybi1EZXY="},"L25vdGljaWVzLzIwMTUtMTItMDctU0lDLUJhbGFuYy0yMDE1":{"date":1449446400000,"title":"SIC. Balanç 2015","description":"Evolució del SIC des de la implantació del nou model TIC fins al desembre del 2015","sections":["Notícies","home"],"categories":["sic"],"key":"DESEMBRE2015","path":"/noticies/2015-12-07-SIC-Balanc-2015","content":"El canvi al nou model TIC ha marcat un punt i apart a la història del SIC. Des d'aquell instant, i durant aquest any i mig, el SIC ha anat assolint un conjunt de fites que queden resumides en el següent fris cronològic:\r\n\r\n<center><iframe src='//cdn.knightlab.com/libs/timeline3/latest/embed/index.html?source=1KwmAmGiVqaPRzp3cgcZ0iCGAfb56eyJv1rgkoizBtGQ&font=Default&lang=ca&hash_bookmark=true&initial_zoom=2&height=500' width='100%' height='500' frameborder='0'></iframe></center>\r\n\r\nAquesta evolució que ha experimentat el SIC s'ha aplicat en les següents vessants:\r\n\r\n* A nivell tecnològic:\r\n\t* ampliant el ventall de tecnologies suportades:\r\n\t\t* segons el llenguatge:\r\n\t\t\t* .NET i NuGet\r\n\t\t\t* PHP\r\n        * servidors:\r\n        \t* Websphere 8.5\r\n\t\t* bases de dades:\r\n\t\t\t* Oracle 12c\r\n* A nivell d'infraestructura:\r\n\t* Implantació d'un model amb SLAVES que permet la construcció i el desplegament dins del propi CPD que alberga l'aplicació\r\n* A nivell funcional:\r\n\t* s'ha incrementat el nombre d'aplicacions que utilitzen el SVN, que construeixen i que despleguen mitjançant els nostres servidors d'integració contínua Jenkins.\r\n* A nivell de seguretat:\r\n\t* a més de l'autenticació al SVN, s'ha afegit un model autoritzatiu que permet determinar la visibilitat i les accions en funció de rols\r\n\r\nLa nostra intenció és seguir evolucionant el SIC per donar servei a qualsevol aplicació que s'utilitzi a la Generalitat. Per a més informació sobre els futurs evolutius que s'aplicaran al SIC, podeu consultar el [Roadmap d'arquitectura del CTTI](http://canigo.ctti.gencat.cat/centre-de-suport/roadmap/).\r\n","objectID":"L25vdGljaWVzLzIwMTUtMTItMDctU0lDLUJhbGFuYy0yMDE1"},"L25vdGljaWVzLzIwMTUtMTItMTgtU0lDLVNpc3RlbWEtYXV0b3JpdHphY2lvbnMtcGV0aWNpb25z":{"date":1450396800000,"title":"SIC. Sistema d'autoritzacions de peticions FRAMEWORK SIC a SAU-Remedy","description":"L'admissió de peticions al servei FRAMEWORK SIC de SAU-Remedy es troba restringit per un sistema de rols d'usuari que determina quines operacions pot demanar cada rol. Aquest article pretén explicar com es realitza aquesta discriminació.","sections":["Notícies","home"],"categories":["sic"],"key":"GENER2016","path":"/noticies/2015-12-18-SIC-Sistema-autoritzacions-peticions","content":"L'admissió de peticions al servei FRAMEWORK SIC de SAU-Remedy es troba restringit per un sistema de rols d'usuari que determina quines operacions pot demanar cada rol. Aquest article pretén explicar com es realitza aquesta discriminació.\r\n\r\nEs controla que les peticions que representen més impacte sobre els serveis SIC provinguin d'aquells usuaris amb més pes sobre el projecte. Es consideren peticions amb impacte:\r\n\r\n* Alta/Baixes d'usuaris SIC.\r\n* Restitució de passwords d'altres usuaris SIC.\r\n* Altes de repositoris [SVN](http://svn.intranet.gencat.cat/).\r\n* Petició d'aplicació d'excepció sobre el control d'extensions d'arxius a pujar als repositoris SVN (.war, .ear, .jar).\r\n\r\n<center>![autoritzacions_peticions_responsables.png](/images/news/autoritzacions_peticions_responsables.png)</center>\r\n\r\nN'hi ha altres tipus de peticions que no representen gaire impacte sobre els serveis SIC:\r\n\r\n* Restitució de password d'usuari SIC propi (a excepció del rol gestor de peticions SIC a SAU-Remedy, donat que no requereix un usuari al SIC).\r\n* Afegir llibreries al [Nexus](http://hudson.intranet.gencat.cat/nexus/) de SIC.\r\n* Altes/modificacions de Jobs de [Jenkins](http://hudson.intranet.gencat.cat/hudson/) de les aplicacions\r\n* Inscripció d'usuaris gestors de peticions SIC a SAU-Remedy (nou rol d'usuari que resta explicat al següent [article](http://canigo.ctti.gencat.cat/noticies/2015-12-23-SIC-Nou-rol-de-peticionari-a-SAU-Remedy/))\r\n\r\n<center>![autoritzacions_peticions_tecnics.png](/images/news/autoritzacions_peticions_tecnics.png)</center>\r\n\r\n\r\n\r\nPel que fa a les consultes o incidències amb serveis SIC, qualsevol usuari pot obrir-les a SAU-Remedy. No s'aplica aquest sistema de control d'autorització.\r\n\r\nPer a qualsevol dubte relatiu a aquest tema, ens podeu [obrir una consulta](http://canigo.ctti.gencat.cat/sic/peticions/) al servei \"FRAMEWORK SIC\" de SAU-Remedy .\r\n","objectID":"L25vdGljaWVzLzIwMTUtMTItMTgtU0lDLVNpc3RlbWEtYXV0b3JpdHphY2lvbnMtcGV0aWNpb25z"},"L25vdGljaWVzLzIwMTUtMTItMjQtQ2FuaWdvLUJhbGFuYy0yMDE1":{"date":1450915200000,"title":"Canigó. Balanç 2015","description":"Resum de les tasques realitzades per l'equip de Canigó durant l'any 2015","sections":["Notícies","home"],"categories":["canigo"],"key":"GENER2016","path":"/noticies/2015-12-24-Canigo-Balanc-2015","content":"Durant l'any 2015 des de l'equip de Canigó hem assolit diferents fites que resumim en el següent timeline:\r\n\r\n<center><iframe src='//cdn.knightlab.com/libs/timeline3/latest/embed/index.html?source=1culZh-JCr-W43Vt1qNGyhTT7wMuAOHA_BLQOwodSjaY&font=Default&lang=en&initial_zoom=1&height=650&lang=ca' width='100%' height='650' frameborder='0'></iframe></center>\r\n\r\nEns agradaria destacar per sobre de tota la resta les següents:\r\n\r\n* *[Nou Portal de Canigó ](http://canigo.ctti.gencat.cat)* (1-2-2015)\r\n\r\nAl mes de Febrer es va efectuar la migració de l'antic Confluence a un nou portal amb els nous estils Gencat. Aquest nou portal és un site estàtic que facilita molt la publicació de nous continguts així com la interacció amb els usuaris. Aprofitant aquesta migració s'han revisat continguts obsolets actualitzant-los o bé donant-los de baixa.\r\n\r\n* *[Nou entorn de treball](http://canigo.ctti.gencat.cat/canigo/entorn-desenvolupament/)* (15-11-2015)\r\n\r\nDurant els primers mesos de l'any s'ha analitzat la millor opció per un nou entorn de desenvolupament d'aplicacions Canigó. Finalment s'ha optat per l'aprovisionament d'una màquina virtual proporcionant un espai d'eines per facilitar el desenvolupament. Conjuntament amb aquest entorn de desenvolupament es proporciona una demo d'aplicació per a ser desplegada en un stack Apache+Tomcat+MySQL mitjançant contenidors Docker.\r\n\r\n* *Racionalització d'infraestructura* (23/12/2015 - Finalitzada primera fase)\r\n\r\nDes del mes de Octubre s'està duent a terme un projecte conjuntament amb CPD1 per tal de racionalitzar la infraestructura utilitzada al CS Canigó. En una primera fase han estat migrats al SIC el SVN, Hudson, i repositoris Maven 1 i Maven 2 propis de Canigó. Gràcies a aquesta migració de serveis destinats al manteniment del framework Canigó deixarà de ser necessària una infraestructura dedicada.\r\n\r\nPer l'any 2016 es preveu seguir evolucionant el nou portal i entorn de treball, i com a principal objectiu és pretén actualitzar l'actual versió 3.1 de Canigó. Aquesta actualització es farà aprofitant el coneixement adquirit en eines RAD analitzades durant l'any i l'estudi tecnològic realitzat sobretot pel que fa a l'evolució del framework JEE Spring. A mida que es vagin planificant les tasques previstes pel 2016 les podreu consultar en el [Roadmap d'arquitectura del CTTI](http://canigo.ctti.gencat.cat/centre-de-suport/roadmap/).\r\n","objectID":"L25vdGljaWVzLzIwMTUtMTItMjQtQ2FuaWdvLUJhbGFuYy0yMDE1"},"L25vdGljaWVzLzIwMTUtMTItMjMtU0lDLU5vdS1yb2wtZGUtcGV0aWNpb25hcmktYS1TQVUtUmVtZWR5":{"date":1450828800000,"title":"SIC. Nou rol de peticionari SIC a SAU-Remedy","description":"Neix a SIC un nou tipus d'usuari: Gestor de peticions a SAU-Remedy. Aquest tipus d'usuari pretén flexibilitzar el sistema d'autorització de peticions de SIC afegint un nou conjunt d'usuaris autoritzats per a poder demanar certs tipus de peticions de suport de FRAMEWORK SIC a SAU- Remedy.","sections":["Notícies","home"],"categories":["sic"],"key":"GENER2016","path":"/noticies/2015-12-23-SIC-Nou-rol-de-peticionari-a-SAU-Remedy","content":"Neix a SIC un nou tipus d'usuari: Gestor de peticions a SAU-Remedy. Aquest tipus d'usuari pretén flexibilitzar el sistema [d'autorització de peticions de SIC] (http://canigo.ctti.gencat.cat/noticies/2015-12-18-SIC-Sistema-autoritzacions-peticions/) afegint un nou conjunt d'usuaris autoritzats a poder demanar certs tipus de peticions de suport de FRAMEWORK SIC a SAU- Remedy.\r\n\r\nAquests usuaris **no tindran accés als serveis de SIC** (no podrà treballar amb repositoris SVN ni amb jobs de Jenkins). El seu abast **es limitarà a poder demanar**  mitjançant SAU-Remedy:\r\n\r\n* Altes / modificacions de Jobs\r\n* Altes de llibreries a Nexus\r\n* Fer consultes sobre SIC\r\n* Reportar incidències relacionades amb serveis de SIC.\r\n\r\nLa petició d'inscripció en aquest grup d'usuaris cal que sigui efectuada pels responsables d'arquitectura i qualitat del Lot. L'haurà de demanar mitjançant petició de suport funcional a [SAU-Remedy](http://canigo.ctti.gencat.cat/sic/peticions/),adjuntant el [formulari d'alta] (http://canigo.ctti.gencat.cat/sic-documentacio/formularis/) corresponent.\r\nLes peticions que demani aquest grup d'usuaris hauran de ser referents a aplicacions del seu mateix lot.\r\n\r\nPer a qualsevol dubte relatiu a aquest tema, ens podeu [obrir una consulta](http://canigo.ctti.gencat.cat/sic/peticions/) al servei \"FRAMEWORK SIC\" de SAU-Remedy .","objectID":"L25vdGljaWVzLzIwMTUtMTItMjMtU0lDLU5vdS1yb2wtZGUtcGV0aWNpb25hcmktYS1TQVUtUmVtZWR5"},"L25vdGljaWVzLzIwMTYtMDEtMjgtQ2FuaWdvLUNvbm5lY3RvcnMtUElDQQ==":{"date":1453939200000,"title":"Noves versions dels connectors de Canigó amb la PICA","description":"S'han publicat noves versions dels connectors amb la PICA per a complir les noves restriccions d'esquema","sections":["Notícies","home"],"categories":["canigo"],"key":"FEBRER2016","path":"/noticies/2016-01-28-Canigo-Connectors-PICA","content":"S'han publicat noves versions dels connectors amb la PICA per a complir les noves restriccions d'esquema. És necessari informar les dades Nom i Nif d'emissor, així com informar les dades d'un funcionari en la majoria dels productes de la PICA. Els valors dels camps \"nifEmisor\" i \"nomEmisor\" a informar s’han de consultar a la [OT PICA](mailto:requeridors.otpica.ctti@gencat.cat). Per a més detall dels productes podeu visitar la Intranet d'Administració Electrònica ([IPAE](http://ipae.intranet.gencat.cat)).\r\n\r\nA continuació es mostren les noves versions publicades dels connectors amb la PICA per Canigó 2 i Canigó 3:\r\n\r\n__Canigó 2__:\r\n\r\n|Nom connector|Versió|\r\n|-----|--------------|\r\n|**canigo-connectors-pica-avisosalertes**|1.0.1|\r\n|**canigo-connectors-pica-dni**|1.1.0|\r\n|**canigo-connectors-pica-padro**|1.0.1|\r\n|**canigo-connectors-pica-tributs**|1.0.2|\r\n|**canigo-connectors-sarcat**|1.1.1|\r\n|**canigo-connectors-psis**|1.0.2|\r\n|**canigo-connectors-nt**|1.0.2|\r\n\r\n* _Per a més informació consultar la documentació de [Canigó 2](/canigo-documentacio-versions-anteriors/versio-2/)_\r\n\r\n__Canigó 3__:\r\n\r\n|Nom connector|Versió|\r\n|-----|--------------|\r\n|**canigo.integration.avisosalertes_pica**|1.1.2|\r\n|**canigo.integration.dni.pica**|1.2.0|\r\n|**canigo.integration.padro.pica**|1.1.1|\r\n|**canigo.integration.tributs.pica**|1.1.2|\r\n|**canigo.integration.sarcat.pica**|1.1.2|\r\n|**canigo.integration.psis**|1.1.2|\r\n|**canigo.integration.notificacions.electroniques**|1.3.1|\r\n\r\n* _Per a més informació consultar la documentació de [Canigó 3](/canigo-documentacio-versions-3x-integracio/)_\r\n\r\nEls canvis a l'esquema estan operatius des del 21 de desembre a PRE i durant els pròxims mesos s'aniran incorporant a PRO. Recomanem que es realitzin proves contra preproducció i en cas de no tenir nif/nom emissor que es demani a la PICA com més aviat millor.\r\n\r\nEn cas de tenir qualsevol dubte en l'ús per part de les aplicacions dels connectors amb la PICA us podeu posar en contacte amb el CS Caniǵo a través del [JIRA CSTD](https://cstd.ctti.gencat.cat/jiracstd/CAN) amb una petició de consulta o suport, o bé enviant-nos un correu a la nostra [bústia](mailto:oficina-tecnica.canigo.ctti@gencat.cat).\r\n","objectID":"L25vdGljaWVzLzIwMTYtMDEtMjgtQ2FuaWdvLUNvbm5lY3RvcnMtUElDQQ=="},"L25vdGljaWVzLzIwMTYtMDItMTAtU0lDLUNhbnZpcy1wZXRpY2lvbnMtZGVzcGxlZ2FtZW50cy1qb2JzLVBSRS1QUk8=":{"date":1455062400000,"title":"Canvi al sistema d'obertura de peticions als jobs de desplegament a PRE/PRO de SIC","description":"Fins el moment, les peticions de desplegament a entorns PRE/PRO que es demanaven mitjançant jobs de Jenkins SIC seguien l'antic model d'obertura de peticions: correu a la bústia de SAU. Amb l'entrada de Remedy, el mecanisme per a demanar desplegaments ha canviat.","sections":["Notícies","home"],"categories":["sic"],"key":"MARC2016","path":"/noticies/2016-02-10-SIC-Canvis-peticions-desplegaments-jobs-PRE-PRO","content":"Fins el moment, les peticions de desplegament a entorns PRE/PRO que es demanaven mitjançant jobs de Jenkins SIC seguien l'antic model d'obertura de peticions: correu a la bústia de SAU.\r\nAmb l'entrada de Remedy, el mecanisme per a demanar desplegaments ha canviat. Les aplicacions donades d'alta a Remedy han de demanar els desplegaments mitjançant l'obertura d'un tiquet de tipus canvi a l'eina.\r\nL'equip de SIC ha treballat en l'adaptació dels jobs de desplegament a PRE/PRO per tal d'acollir-se al model de peticions de desplegament mitjançant Remedy.\r\n\r\nEls jobs de desplegament a PRE/PRO de SIC adaptats a aquest sistema:\r\n\r\n* Pujaran els artefactes a desplegar als servidors de CPD (aquest punt no canvia respecte al model anterior).\r\n* Obriran un **canvi de tipologia “Desplegament” i en estat=”Draft”** a Remedy (no es requerirà passar prèviament per l'Atrium Impact Simulator) i com a Sol·licitant l'usuari que ha executat el job de desplegament. **L'usuari que executarà el job ha d'estar donat d'alta a GICAR i amb usuari autoritzat a treballar a ITSM Remedy. Si no és així, ITSM Remedy denegarà l'obertura del canvi** i el job finalitzarà amb error.\r\n* Els valors dels camps 'Summary' i 'Notes' que figuraran al Draft del canvi, es correspondran amb els camps 'TITOL' i 'OBSERVACIONS' del job de Jenkins. Aquests s'indicaran amb un valor per defecte que l'usuari podrà editar. La informació sobre la ubicació on s'han pujat prèviament els artefactes a desplegar s'afegirà automàticament al camp ''Notes'.\r\n* Una vegada creat el Draft, el job retornarà l'identificador de petició creada a Remedy. En paral·lel, ITSM Remedy enviarà una notificació d'obertura de tasca a la bústia de l'usuari que ha executat el job des del SIC.\r\n* El Draft es generarà amb uns camps mínims. Posteriorment, qualsevol usuari del grup de gestió d’ITSM REMEDY associat al desplegament haurà d'accedir al Draft per completar la resta de dades (incloent el document amb les instruccions de desplegament) i aplicar la instrucció operativa vigent de Gestió de Canvis.\r\n\r\n\r\n<center>![autoritzacions_peticions_responsables.png](/images/news/SIC-Jobs-peticions-Remedy.png)</center>\r\n\r\nEl canvi es va activar el dia **22 de Febrer** per als jobs d'aquelles aplicacions que ja es trobin dins Remedy. Els jobs de la resta d'aplicacions que encara no s'hagin integrat a Remedy mantindran l'antic sistema d'obertura de petició via correu a SAU.\r\nEn el moment que aquestes aplicacions s'afegeixin a Remedy, l'equip de SIC actualitzarà els seus jobs per tal que facin servir el model d'obertura de canvis via ITSM Remedy (els proveïdors no s'hauran de preocupar de demanar l'actualització dels jobs).\r\n\r\nPer a qualsevol dubte relatiu a aquest canvi, podeu contactar amb SAU (sau.tic@gencat.cat / Consulta al servei 'FRAMEWORK SIC' de Remedy).\r\n","objectID":"L25vdGljaWVzLzIwMTYtMDItMTAtU0lDLUNhbnZpcy1wZXRpY2lvbnMtZGVzcGxlZ2FtZW50cy1qb2JzLVBSRS1QUk8="},"L25vdGljaWVzLzIwMTYtMDMtMzEtU0lDLURlc3BsZWdhbWVudC1kZS1zaXRlcy1zdGF0aWNzLWFsLWNsb3Vk":{"date":1459382400000,"title":"SIC. S'habiliten els desplegaments de sites estàtics al núvol","description":"A partir d'aquest mes de març, el SIC comença a fer les seves primeres passes amb les tecnologies cloud integrant el desplegament de sites estàtics a Bluemix, el servei al núvol d'IBM.","sections":["Notícies","home"],"categories":["sic"],"key":"ABRIL2016","path":"/noticies/2016-03-31-SIC-Desplegament-de-sites-statics-al-cloud","content":"Un dels objectius que el SIC s'ha fixat enguany és ampliar el ventall de tecnologies i paradigmes que suporta per donar servei al màxim d'aplicacions possible. Amb la integració dels desplegaments de sites estàtics al núvol, s'inicia un nou camí en què es pretèn que el paraigua de la Integració Contínua acabi cobrint el 100% de les aplicacions de la Generalitat de Catalunya que requereixin desplegar-se en aquest nou tipus d'entorn.\r\n\r\nEl SIC ha publicat una nova versió del *Formulari d’alta d’aplicació per al Portal d’Integració Contínua (Tasques al Jenkins)* que podeu trobar a [la plana de Formularis del SIC del Portal](http://canigo.ctti.gencat.cat/sic-documentacio/formularis/). És mitjançant aquest formulari que es pot sol·licitar aquest nou tipus de desplegaments. Veureu que s’ha creat un nou apartat \"Web estàtiques\" per aplicacions d'aquest tipus.\r\n\r\n### Sites estàtics a Bluemix\r\n\r\nVal a dir que, com a primera aproximació a aquest nou escenari, el SIC ha decidit limitar-se al desplegament de sites estàtics a Bluemix, la solució Cloud d'IBM.\r\n\r\nBluemix permet per desplegar múltiples aplicacions i/o serveis ja siguin en forma de buildpacks --com és en aquest cas-- o d'altres --com per exemple contenidors Docker--. Aquests elements desplegats s'emmagatzemen dins d'un espai determinat que, alhora, pertany a una organització concreta. És a dir, una organització pot contenir múltiples espais que alhora poden contenir diverses aplicacions. Aquesta és la jerarquia utilitzada a Bluemix per estructurar les aplicacions i els serveis albergats.\r\n\r\n<center>![sites_estatics_Bluemix.png](/images/news/sites_estatics_Bluemix.png)</center>\r\n\r\n### Jobs de Jenkins\r\n\r\nEn principi, cada aplicació web estàtica al Bluemix requerirà la creació de tres jobs de jenkins:\r\n\r\n* **Job de tipus BLD**: s'encarregarà de realitzar les mètriques de codi necessàries, la construcció de l'artefacte i la generació dels arxius de manifest per a cada entorn.\r\n* **Job de tipus PRE**: s'encarregarà de realitzar la construcció de l'artefacte i el desplegament a Bluemix utilitzant l'arxiu de manifest per a aquest entorn.\r\n* **Job de tipus PRO**: s'encarregarà de desplegar l'artefacte construït de forma satisfactòria en l'anterior entorn utilitzant l'arxiu de manifest per a aquest entorn.\r\n\r\n### Properes passes\r\n\r\nEn futures ampliacions del servei, es pretén donar suport a múltiples tipologies d'aplicació així com a múltiples proveïdors d'infrastructura al núvol.\r\n\r\nCom sempre, per a qualsevol dubte relatiu a aquest tema, ens podeu [obrir una consulta](http://canigo.ctti.gencat.cat/sic/peticions/) al servei \"FRAMEWORK SIC\" de SAU-Remedy .\r\n","objectID":"L25vdGljaWVzLzIwMTYtMDMtMzEtU0lDLURlc3BsZWdhbWVudC1kZS1zaXRlcy1zdGF0aWNzLWFsLWNsb3Vk"},"L25vdGljaWVzLzIwMTYtMDQtMDEtU0lDLUV0aXF1ZXRhZ2UtYWwtU1ZO":{"date":1459468800000,"title":"SIC. Etiquetatge de versions al SVN del SIC","description":"Hi ha diverses maneres de crear versions de codi al repositori SVN del SIC (sota directori /tags). Aquest article pretén recollir-ne algunes i aconsellar l'ús d'una en particular.","sections":["Notícies","home"],"categories":["sic"],"key":"ABRIL2016","path":"/noticies/2016-04-01-SIC-Etiquetage-al-SVN","content":"Hi ha diverses maneres de crear versions de codi al repositori SVN del SIC (sota directori /tags). Aquest article pretén recollir-ne algunes i aconsellar l'ús d'una en particular.\r\n\r\nEs parteix del fet que, tal com s'esmenta al [Manual d'Integració amb SIC] (http://canigo.ctti.gencat.cat/related/sic/manual-integracio.pdf), ja s'ha realitzat una primera pujada del codi font al directori /trunk del repositori de l'aplicació al SVN del SIC.\r\n<center>![etiquetatge_svn_trunk.PNG](/images/news/etiquetatge_svn_trunk.PNG)</center>\r\n\r\nLes posteriors versions (estables) del codi haurien de constar al directori /tags del repositori SVN de l'aplicació. Aquestes versions es poden generar de les següents maneres:\r\n\r\n<br/>\r\n<br/>\r\n\r\n**A partir del codi font de l'entorn de desenvolupament local**\r\n\r\nEs sincronitzaria el codi font de l'entorn local amb una nova carpeta dins el directori /tags del repositori SVN i es faria un checkin d'aquest. Això implicaria la creació d'una nova còpia etiquetada del codi al repositori, deslligada de la versió que figura al directori /trunk.\r\n<center>![etiquetatge_svn_opcio1.PNG](/images/news/etiquetatge_svn_opcio1.PNG)</center>\r\n\r\n<br/>\r\n<br/>\r\n\r\n**A partir del codi font al /trunk del repositori SVN del SIC**\r\n\r\nEn primer lloc caldria sincronitzar el codi font de l'entorn local amb el de la carpeta /trunk del repositori SVN de l'aplicació al SIC. Posteriorment caldria generar un tag d'aquest contingut i deixar-ho a la carpeta de /tags. La versió etiquetada del codi no seria una nova còpia del codi sinó una referència a al contingut del /trunk en el moment de generar-la (alterar posteriorment el contingut del /trunk no alterarà el contingut del tag generat).\r\n<center>![etiquetatge_svn_opcio2.PNG](/images/news/etiquetatge_svn_opcio2.PNG)</center>\r\n\r\n<br/>\r\n\r\n\r\nDes de SIC recomanem fer servir aquesta segona manera d'etiquetar per 2 motius:\r\n\r\n* Es redueix considerablement el temps d'espera en fer el checkin donat que només s'actualitzen els canvis al /trunk i l'operació de crear el tag del contingut del /trunk al repositori SVN és immediata.\r\n* Es genera un històric de canvis entre les versions, doncs les versions generades al /tag es troben lligades al /trunk, no són còpies noves de codi font.\r\n\r\n**NOTA**: Es recorda que els repositoris SIC són considerats com a repositoris d'entregables, no com a repositoris de treball. Per tant, només s'hauria de pujar el codi font en el /trunk quan es desitgi publicar una nova versió del codi.\r\n\r\nPer a qualsevol dubte relatiu a aquest tema, ens podeu [obrir una consulta](http://canigo.ctti.gencat.cat/sic/peticions/) al servei \"FRAMEWORK SIC\" de SAU-Remedy .\r\n","objectID":"L25vdGljaWVzLzIwMTYtMDQtMDEtU0lDLUV0aXF1ZXRhZ2UtYWwtU1ZO"},"L25vdGljaWVzLzIwMTYtMDItMDQtU0lDLUludGVncmFjaW8tQ29udGludWEtZG90TmV0":{"date":1454544000000,"title":"Suport complet del SIC a la integració contínua amb .NET","description":"El SIC s'ha certificat en la construcció, en la gestió de dependències i en els desplegaments d'aplicatius programats amb .NET","sections":["Notícies","home"],"categories":["sic"],"key":"FEBRER2016","path":"/noticies/2016-02-04-SIC-Integracio-Continua-dotNet","content":"__Els inicis amb MSBuild__\r\n\r\nDes de l'estiu de 2015, el SIC ha estat treballant per poder oferir el mateix suport a les aplicacions desenvolupades amb .NET que el que ja ofereix a les aplicacions desenvolupades amb Java.\r\n\r\nCom a primer pas en la integració de .NET al SIC, es va habilitar la compilació i el muntatge d'aquest tipus d'aplicacions mitjançant [MSBuild](https://msdn.microsoft.com/es-es/library/dd393574.aspx).\r\n\r\nLa utilització de MSBuild permet controlar amb un fitxer xml el procés de compilació i muntatge del programari d'una forma equivalent a les eines del món Java tals com ANT i Maven. Amb MSBuild, a través de la definició de tasques i d'objectius en aquest fitxer xml, es pot orquestrar la gestió de mòduls i la generació dels artefactes .NET.\r\n\r\n__Gestió de dependències amb NuGet__\r\n\r\nUn element fonamental en la integració contínua és la gestió de dependències. L'ús de llibreries provinents de repositoris oficials o de pròpies validades i emmagatzemades en un repositori de confiança garanteix l'absència d'errors de compatibilitat entre les llibreries utilitzades en l'entorn de desenvolupament i l'entorn d'execució.\r\n\r\nDurant la tardor de 2015, es va habilitar un nou repositori en el servidor Nexus del SIC que permet emmagatzemar llibreries .NET. Es tracta d'un repositori Nexus compatible amb [NuGet](https://www.nuget.org/). A més, es va habilitar en els servidors d'integració contínua l'ús d'aquest repositori per fer el muntatge de l'aplicació. D'aquesta manera, es garanteix que les llibreries utilitzades són fiables tant en termes de compatibilitat i fiabilitat com de seguretat.\r\n\r\n__Desplegaments amb Web Deploy__\r\n\r\nUn cop s'ha aconseguit controlar el procés de muntatge i la gestió de dependències, era el torn estandarditzar el procés de desplegament als servidors.\r\n\r\nDurant el mes de gener de 2016, s'han certificat al SIC els desplegaments a IIS mitjançant [Web Deploy](https://www.microsoft.com/es-es/download/details.aspx?id=43717&751be11f-ede8-5a0c-058c-2ee190a24fa6=True). Amb aquesta eina, s'aprofita la generació de l'empaquetament zip --que es desa en el procés de muntatge en les carpetes de binaris-- per desplegar l'aplicació de forma automàtica als servidors IIS.\r\n\r\nAquest sistema de desplegament és el que internament utilitza Visual Studio en els entorns de desenvolupament.\r\n\r\nAmb aquestes tres eines, el SIC està preparat per oferir un suport complet a les aplicacions desenvolupades amb .NET. La tecnologia .NET ja és considerada \"first class\" dins del SIC, amb totes les prestacions que fins avui només gaudia la tecnologia JEE.\r\n","objectID":"L25vdGljaWVzLzIwMTYtMDItMDQtU0lDLUludGVncmFjaW8tQ29udGludWEtZG90TmV0"},"L25vdGljaWVzLzIwMTYtMDMtMDEtQ2FuaWdvLUNvbm5lY3Rvci1QU0dE":{"date":1456790400000,"title":"Nou connector de Canigó 3 amb la Plataforma de Serveis de Gestió documental (PSGD)","description":"S'ha publicat un nou connector de Canigó 3 amb la Plataforma de Serveis de Gestió documental (en endavant PSGD). El propòsit del connector és proporcionar una interfície Java per accedir als serveis exposats per la PSGD.","sections":["Notícies","home"],"categories":["canigo"],"key":"MARC2016","path":"/noticies/2016-03-01-Canigo-Connector-PSGD","content":"S'ha publicat un nou connector de Canigó 3 amb la Plataforma de Serveis de Gestió documental (en endavant PSGD). El propòsit del connector és proporcionar una interfície Java per accedir als serveis exposats per la PSGD.\r\n\r\nEl connector permet el consum de totes les funcionalitats oferides per aquest servei:\r\n\r\n* _Gestió del token d'autenticació_: controla el cicle de vida del token d'autenticació renovant-ho automàticament quan aquest hagi caducat\r\n* _Gestió de documents_: permet el consum de les funcionalitats relacionades amb documents\r\n\t- Alta d’un nou document (en streaming)\r\n\t- Baixa lògica d’un document\r\n\t- Marcar un document com a no modificable (“Check-out”)\r\n\t- Carregar una nova versió d’un document i marcar-lo com a modificable (“Check-in”)\r\n\t- Editar les metadades d’un document\r\n\t- Descarregar un document (en streaming)\r\n\t- Cercar documents en funció de les seves metadades\r\n* _Gestió de relació d’expedients_: permet el consum dels serveis relacionats amb la gestió de carpetes contenidores de documents\r\n\t- Alta d’un expedient\r\n\t- Baixa d’un expedient\r\n\t- Assignació d’un document a un expedient\r\n\t- Eliminar l’assignació d’un document a un expedient\r\n* _Gestió del repositori_: permet el consum dels serveis relacionats amb la gestió del quadre de classificació i del tipus de documents\r\nsuportats.\r\n\t- Manteniment del quadre de classificació\r\n\t- Manteniment de la tipologia de documents\r\n\r\nAquest connector és el primer dins el framework que consumeix serveis REST i no Webservices (SOAP). Donat que Canigó està basat en [Spring](https://projects.spring.io/spring-framework/) s'ha emprat la classe [RestTemplate](https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/client/RestTemplate.html) per a la seva implementació. Destacar també la modalitat en streaming utilitzada per l'enviament de fitxers de gran mida evitant possibles problemes de memòria en les aplicacions.\r\n\r\nEn cas de tenir qualsevol dubte en l'ús del connector de Canigó 3 amb la PSGD podeu consultar la [documentació del connector](http://canigo.ctti.gencat.cat/canigo-documentacio-versions-3x-integracio/modul-psgd/) publicada al portal, posar-vos posar en contacte amb el CS Caniǵo a través del [JIRA CSTD](https://cstd.ctti.gencat.cat/jiracstd/CAN) amb una petició de consulta o suport, o bé enviant-nos un correu a la nostra [bústia](mailto:oficina-tecnica.canigo.ctti@gencat.cat).\r\n","objectID":"L25vdGljaWVzLzIwMTYtMDMtMDEtQ2FuaWdvLUNvbm5lY3Rvci1QU0dE"},"L25vdGljaWVzLzIwMTYtMDQtMTgtU0lDLVBvbGl0aXF1ZXMtcmVzcGVjdGUtbm92ZXMtYXBsaWNhY2lvbnM=":{"date":1460937600000,"title":"SIC. Polítiques d'integració respecte a noves aplicacions","description":"Des de SIC es pretén recuperar la funcionalitat original dels repositoris SVN (custòdia del codi font) i promocionar l'us de la Plataforma d'Integració Contínua per a construïr i desplegar els binaris de les aplicacions.","sections":["Notícies","home"],"Draft":true,"categories":["sic"],"key":"MAIG2016","path":"/noticies/2016-04-18-SIC-Politiques-respecte-noves-aplicacions","content":"Als seus inicis, els repositoris SVN de CTTI es van concebir per a la custòdia i versionat de codi font de les aplicacions i la Plataforma d'Integració Contínua (jobs Jenkins) per construir els binaris a partir d'aquest codi font i desplegar-los als servidors d'aplicacions.\r\n\r\nAmb el pas del temps i de manera involuntària, s'ha permés l'ús dels repositoris SVN com a font d'intercanvi de binaris de les aplicacions amb CPD per tal que aquests darrers els puguin recollir i desplegar als seus entorns. Com a conseqüència d'aquest mode de treball, l'ús de la Plataforma d'Integració Contínua per construir i desplegar aplicacions ha quedat força desplaçat.\r\n\r\n\r\nDes de SIC es pretén recuperar la funcionalitat original dels repositoris SVN (custòdia del codi font) i promocionar l'ús de la Plataforma d'Integració Contínua per a construïr i desplegar els binaris de les aplicacions.\r\n\r\nPer a tal efecte i amb l'acord de CTTI, com a part de la preparació del servei totes les noves aplicacions hauràn de fer servir els repositoris SVN per a la custòdia de codi i la Plataforma d'Integració Contínua per a construïr els binaris i desplegar l'aplicació (les que es trobin suportades).\r\n\r\nPer a les aplicacions ja existents que facin servir els repositoris SVN per a compartir els binaris amb CPD, per el moment no s'obligarà però sí s'aconsella que s'addereixin al sistema de construcció i desplegament d'aplicacions de la Plataforma d'Integració Contínua (jobs Jenkins).\r\n\r\nS'ha elaborat el següent díptic que ha de servir com a carta de presentació de SIC i sumaritza els pasos necessaris per integrar-se.\r\n\r\n<center>![descarregaLogs.PNG](/images/news/descarregaLogs.png)</center>\r\n\r\nPer a qualsevol dubte relatiu a aquest tema, ens podeu [obrir una consulta](http://canigo.ctti.gencat.cat/sic/peticions/) al servei \"FRAMEWORK SIC\" de SAU-Remedy .\r\n","objectID":"L25vdGljaWVzLzIwMTYtMDQtMTgtU0lDLVBvbGl0aXF1ZXMtcmVzcGVjdGUtbm92ZXMtYXBsaWNhY2lvbnM="},"L25vdGljaWVzLzIwMTYtMDQtMTQtQ2FuaWdvLUFkbWluaXN0cmFjaW8tTG9ncw==":{"date":1460592000000,"title":"Canigó. Nou Mòdul d'Administració de Logs","description":"Nou mòdul per al monitoratge i administració de logs d'aplicacions Canigó 3.1.","sections":["Notícies","home"],"categories":["canigo"],"key":"MAIG2016","path":"/noticies/2016-04-14-Canigo-Administracio-Logs","content":"S'ha publicat un nou mòdul de Canigó 3.1 amb la finalitat de proporcionar als proveïdors d'aplicacions eines per a l'administració i monitoratge de logs.\r\n\r\nAquest mòdul \"canigo.operation.logging\" ofereix les següents funcionalitats:\r\n\r\n### Funcionalitats\r\n\r\n#### Canviar en calent el nivell de log dels diferents paquets de l'aplicació\r\n\r\n<center>![configuracioNivellLog.PNG](/images/news/configuracioNivellLogs.PNG)</center>\r\n\r\n#### Visualització de fitxers de logs en temps real mitjançant streaming amb WebSockets\r\n\r\n<center>![visualitzacioLogs.PNG](/images/news/VisualitzacioLogs.PNG)</center>\r\n\r\n#### Descarregar els fitxers de logs\r\n\r\n<center>![descarregaLogs.PNG](/images/news/descarregaLogs.png)</center>\r\n\r\n### Plugin Canigó per Eclipse\r\n\r\nTambé s'ha publicat la versió 1.5.1 del [Plugin de Canigó per Eclipse] (/related/canigo/howto/Canigo - HowTo - Generacio aplicacio Canigo 3.1 amb plugin Eclipse.pdf) el qual inclou la possibilitat d'afegir/eliminar aquest mòdul a una aplicació Canigó 3.1.\r\n\r\nAmb el Plugin de Canigó per Eclipse, en cas de crear una aplicació amb arquitectura REST+HTML5/JS el mòdul d'administració de logs ja ve inclòs per defecte.\r\n\r\n### Aplicació Demo\r\n\r\nDes del CS Canigó es proporciona una aplicació de demo d’aquest mòdul. Podeu trobar el codi font en el següent [enllaç](https://github.com/gencat/demoAdminLogs).\r\n\r\nPer a més informació sobre el mòdul podeu consultar la [documentació](/canigo-documentacio-versions-3x-core/modul-logging-admin/) publicada en el portal.\r\n","objectID":"L25vdGljaWVzLzIwMTYtMDQtMTQtQ2FuaWdvLUFkbWluaXN0cmFjaW8tTG9ncw=="},"L25vdGljaWVzLzIwMTYtMDUtMjgtQ2FuaWdvLVByb2Nlcy1hY3R1YWxpdHphY2lvLWEtQ2FuaWdvLTNfMQ==":{"date":1464393600000,"title":"Canigó. Actualització d'aplicacions Canigó 3.0 a Canigó 3.1","description":"Recordatori del procediment per a realitzar l'actualització d'aplicacions Canigo 3.0 a Canigó 3.1","sections":["Notícies","home"],"categories":["canigo"],"key":"JUNY2016","path":"/noticies/2016-05-28-Canigo-Proces-actualitzacio-a-Canigo-3_1","content":"Amb motiu de la recent publicació del mòdul d'[Administració de Logs de Canigó](/noticies/2016-04-14-Canigo-Administracio-Logs/), el qual té com a requisit l'ús de Canigó 3.1, us recordem com procedir per a realitzar l'actualització d'una aplicació Canigó 3.0 a Canigó 3.1. Els passos a efectuar per a realitzar l'actualització els podeu trobar en aquest [howto](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Actualitzacio+Canig%C3%B3+3.0+a+Canigo+3.1.pdf).\n\nEn cas de realitzar l'actualització en una aplicació basada en arquitectura REST+HTML5/JS, i no JSF (JavaServer Faces), el frontend no es veu afectat per l'actualització. Si l'aplicació Canigó 3.0 que s'actualitza utilitza JSF cal analitzar en detall la compatibilitat de les vistes (.jsf, .xhtml) i els seus components de presentació (Primefaces, Richfaces, ...) respecte a JSF 2.2. En aquest cas l'impacte pot ser major.\n\nCanigó 3.1 es va alliberar a finals del 2014 amb els següents canvis com a més destacables:\n\n* *Actualització de llibreries*:\n\n|   | Canigó 3.0   | Canigó 3.1 |\n|---|--------------|------------|\n| __Spring Framework__ | 3.0.3.RELEASE | 4.1.0.RELEASE |\n| __JPA__ | 1.0 | 2.1 |\n| __Hibernate__ | 3.3.2.GA | 4.3.6.Final |\n| __Servlet API__ | 2.5 | 3.0.1 |\n| __JSF__ | 2.0 | 2.2 |\n| __PICA__ | 1.6.3  | 1.9.2 |\n\n* *Revisió de llibreries*: eliminació de llibreries innecessàries i unificació de llibreries entre els diferents mòduls\n\nPer a qualsevol dubte referent al procés d'actualització de Canigó 3.0 a 3.1 podeu obrir una consulta o petició de suport al [servei CAN del JIRA CSTD](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN).\n","objectID":"L25vdGljaWVzLzIwMTYtMDUtMjgtQ2FuaWdvLVByb2Nlcy1hY3R1YWxpdHphY2lvLWEtQ2FuaWdvLTNfMQ=="},"L25vdGljaWVzLzIwMTYtMDUtMzAtU0lDLU1vbmdvREI=":{"date":1464566400000,"title":"SIC. Suport a MongoDB","description":"Suport a la primera base de dades NoSQL al SIC. Els jobs de desplegament a INT són capaços d'executar codi Javascript per manipular documents i crear o eliminar col·leccions de documents, indexos, etc.","sections":["Notícies","home"],"categories":["SIC"],"key":"JUNY2016","path":"/noticies/2016-05-30-SIC-MongoDB","content":"Durant el mes de Maig s'ha dotat al SIC de les eines i procediments necessaris per poder donar suport a MongoDB. A  la secció de Documentació del SIC del Portal de Frameworks i Solucions d'Arquitectura podeu trobar noves versions dels següents documents:\r\n\r\n- <i>[Formulari d'alta d'aplicació per al Portal d'Integració Contínua (Tasques al Jenkins)](/related/sic/SIC-Formulari-Construccio-Desplegament-Aplicacio.xlsx):</i> en aquest formulari s'ha afegit una nova pestanya \"Scripts BBDD\" amb els camps necessaris per demanar l'execució de scripts MongoDB.\r\n\r\n![Formulari scripts BBDD](/images/news/formulari_mongodb.PNG \"Formulari scripts BBDD\")\r\n\r\n- <i>[Manual d'Usuari:](/related/sic/manual-usuari.pdf)</i> afegida informació per la configuració del fitxer de plans de BBDD per a MongoDB.\r\n\r\nUn exemple de com podria quedar el fitxer de plans per a MongoDB seria el següent:\r\n\r\n![Script plans MongoDB](/images/news/plans_mongodb.PNG \"Script plans MongoDB\")\r\n\r\nL'**idBBDD** fa referència a la base de dades on s'ha d'executar el script, no al tipus (podria haver scripts per dues bases de dades MongoDB, per exemple).\r\n\r\nDestacar que l'execució de scripts només es troba disponible per als entorns d'INT. Per PRE i PRO, els procediments de desplegament són semi-automàtics amb lliurament per sFTP d'artefactes a CPD, i enviament de correu de sol·licitud de desplegament a SAU CTTI o sol·licitud de canvi a Remedy.\r\n\r\nPer a qualsevol dubte referent a l'execució de scripts de MongoDB ens podeu [obrir una consulta](http://canigo.ctti.gencat.cat/sic/peticions/) al servei \"FRAMEWORK SIC\" de SAU-Remedy.\r\n","objectID":"L25vdGljaWVzLzIwMTYtMDUtMzAtU0lDLU1vbmdvREI="},"L25vdGljaWVzLzIwMTYtMDYtMDgtR0lDQVItZG9jdW1lbnRhY2lv":{"date":1465344000000,"title":"GICAR. Publicació de la documentació al web d'Arquitectura","description":"Publicació de la documentació de GICAR al web d'arquitectura i les novetats en quant a l'entorn de desenvolupament","sections":["Notícies","home"],"categories":["GICAR"],"key":"JULIOL2016","path":"/noticies/2016-06-08-GICAR-documentacio","content":"Al mes de Juny es publica la documentació de GICAR a la web d'Arquitectura CTTI. \r\n\r\nAquesta documentació pretén ajudar als integradors a conèixer el funcionament de GICAR, l'arquitectura i els fluxos d'autenticació. \r\n\r\nUna fita molt important que volem destacar, és el fet que posem a disposició dels desenvolupadors, un entorn de Sandbox, públic i basat en Docker amb el qual podran fer proves de funcionament real de les aplicacions integrades amb GICAR: http://canigo.ctti.gencat.cat/gicar-integracio/sandbox/\r\n\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n\r\n![GICAR](/related/gicar/logo.png)\r\n<img src=\"/images/bloc/docker/large_h-dark-trans.png\" style=\"width:75%\" />","objectID":"L25vdGljaWVzLzIwMTYtMDYtMDgtR0lDQVItZG9jdW1lbnRhY2lv"},"L25vdGljaWVzLzIwMTYtMDUtMzAtU0lDLU5vZGVKUw==":{"date":1464566400000,"title":"SIC. Suport a NodeJS","description":"Suport a construcció i desplegament d'aplicacions NodeJS. Inclou resolució de dependències amb npm (Node Package Manager) per JavaScript.","sections":["Notícies","home"],"categories":["SIC"],"key":"JUNY2016","path":"/noticies/2016-05-30-SIC-NodeJS","content":"Durant el mes de Maig s'ha dotat al SIC de les eines i procediments necessaris per poder empaquetar i desplegar aplicacions [NodeJS](https://nodejs.org/) en entorns corporatius. A la secció de Documentació del SIC del Portal de Frameworks i Solucions d'Arquitectura podeu trobar noves versions dels següents documents:\r\n\r\n- <i>[Formulari d'alta d'aplicació per al Portal d'Integració Contínua (Tasques al Jenkins)](/related/sic/SIC-Formulari-Construccio-Desplegament-Aplicacio.xlsx):</i>  en aquest formulari s'ha afegit una nova pestanya \"NodeJS-Construcció,Desplegament\" amb els camps necessaris per al desplegament d'aplicacions NodeJS en entorns d'INT, PRE i PRO.\r\n- <i>[Manual d'Integració:](/related/sic/manual-integracio.pdf)</i> afegit detall dels requeriments per la integració d'aplicacions NodeJS al SIC.\r\n- <i>[Manual d'Usuari:](/related/sic/manual-usuari.pdf)</i> afegida informació per l'ús de Jenkins per tal de fer desplegaments d'aplicacions NodeJS amb el SIC.\r\n\r\nLa custòdia de codi d'aplicacions NodeJS al SVN del SIC ja era permesa, i amb l'afegit de la construcció i els desplegaments es proveeix al SIC de la possibilitat de gestionar el cicle de vida d'aplicacions desenvolupades amb aquesta tecnologia. Al SIC es resolen les dependències de l'aplicació via [npm (Node Package Manager)](https://www.npmjs.com/) a través del Nexus, motiu pel qual no és permès pujar carpetes \"node_modules\" amb el codi d'aquestes dependències. En cas de ser necessari els proveïdors d'aplicacions poden demanar la instal·lació de paquets npm propis al Nexus.\r\n\r\nDestacar que de la mateixa manera que amb aplicacions JEE i PHP, també es permet l'execució de scripts de bases de dades Oracle/MongoDB en els desplegaments automàtics a INT. Per a PRE i PRO, els procediments de desplegament són semi-automàtics amb lliurament per sFTP d'artefactes a CPD i enviament de correu de sol·licitud de desplegament a SAU CTTI o sol·licitud de canvi a Remedy.\r\n\r\nPer a qualsevol dubte referent a la integració d'aplicacions NodeJS al SIC ens podeu [obrir una consulta](http://canigo.ctti.gencat.cat/sic/peticions/) al servei \"FRAMEWORK SIC\" de SAU-Remedy.\r\n","objectID":"L25vdGljaWVzLzIwMTYtMDUtMzAtU0lDLU5vZGVKUw=="},"L25vdGljaWVzLzIwMTYtMDctMDQtU0lDLU15U1FMLWktU1FMU0VSVkVS":{"date":1467590400000,"title":"SIC. Suport a MySQL i Microsoft SQL SERVER","description":"Suport a les bases de dades de tipus MySQL i Microsoft SQL SERVER. Els jobs de desplegament a INT són capaços d'executar scripts DDL i DML d'aquestes bases de dades.","sections":["Notícies","home"],"categories":["SIC"],"key":"JULIOL2016","path":"/noticies/2016-07-04-SIC-MySQL-i-SQLSERVER","content":"Durant el mes de Juny s'ha dotat al SIC de les eines i procediments necessaris per poder donar suport a les bases de dades *MySQL* i *Microsoft SQL SERVER*. Aquesta nova addició de tecnologies de Bases de Dades té afectació als següents documents de  la secció de Documentació del SIC del Portal de Frameworks i Solucions d'Arquitectura:\r\n\r\n- <i>[Formulari d'alta d'aplicació per al Portal d'Integració Contínua (Tasques al Jenkins)](/related/sic/SIC-Formulari-Construccio-Desplegament-Aplicacio.xlsx):</i> a la llengüeta \"Scripts BBDD\" podreu incloure les dades de connexió a aquests tipus de bases de dades. Recordar-vos que per a cada connexió, caldrà copiar i pegar la taula amb la informació pertinent.\r\n\r\n![Formulari scripts BBDD MySQL i SQLSERVER](/images/news/SIC-formulari_ Jenkins_SQL.png \"Formulari scripts BBDD MySQL i SQLSERVER\")\r\n\r\n- <i>[Manual d'Usuari:](/related/sic/manual-usuari.pdf)</i> afegida informació per la configuració del fitxer de plans de BBDD per a aquestes bases de dades.\r\n\r\nA continuació es mostra un exemple de com podria quedar el fitxer de plans per a una aplicació amb que utilitzés aquestes bases de dades:\r\n\r\n![Script plans MySQL i SQLSERVER](/images/news/SIC-fitxer_plans.png \"MySQL i SQLSERVER\")\r\n\r\nAl fitxer de plans s'indica l'**idBBDD**. Aquest atribut fa referència al nom de la connexió que s'ha definit al formulari anterior i indica que l'script indicat s'ha d'executar a través de la connexió de base de dades amb aquest nom.\r\n\r\nDestacar que l'execució de scripts només es troba disponible per als entorns d'INT. Per PRE i PRO, els procediments de desplegament són semi-automàtics amb lliurament per sFTP d'artefactes a CPD, i enviament de correu de sol·licitud de desplegament a SAU CTTI o sol·licitud de canvi a Remedy.\r\n\r\nPer a qualsevol dubte referent a l'execució de scripts de base de dades ens podeu [obrir una consulta](http://canigo.ctti.gencat.cat/sic/peticions/) al servei \"FRAMEWORK SIC\" de SAU-Remedy.\r\n","objectID":"L25vdGljaWVzLzIwMTYtMDctMDQtU0lDLU15U1FMLWktU1FMU0VSVkVS"},"L25vdGljaWVzLzIwMTYtMDgtMDItU0lDLUdlc3Rpby1EZXBlbmRlbmNpZXMtQU5ULWRvdE5FVA==":{"date":1438473600000,"title":"SIC. Gestió de dependències per aplicacions .NET i JAVA al SIC","description":"El SIC ha incorporat les tecnologies ANT i .NET. Us expliquem com implementar la gestió de dependències amb aquestes tecnologies.","sections":["Notícies","home"],"categories":["sic"],"path":"/noticies/2016-08-02-SIC-Gestio-Dependencies-ANT-dotNET","content":"## Gestió de dependències al SIC\r\n\r\nL'única forma fins a l'actualitat de gestionar dependències al SIC era mitjançant [Apache Maven](http://maven.apache.org/). Aquesta gestió de dependències només era possible en aplicacions JAVA i utilizava [Nexus](http://www.sonatype.com/download-oss-sonatype) com a repositori d'artefactes.\r\n\r\nUs recordem que, per defecte, no es permet la inclusió de llibreries i/o artefactes (.jar, .war, .ear, .dll...) al repositori de codi SVN del SIC. Aquests elements es poden obtenir de 3 formes diferents:\r\n\r\n* Si es tracta d'una llibreria del proveïdor, aquesta es generarà en el propi procés de construcció de l'aplicació.\r\n* Si no és una llibreria del proveïdor:\r\n\t* Si és una llibreria que es pot obtenir d'un repositori Maven / NuGet oficial, el servidor Nexus l'obtindrà en el procés  de construcció de l'aplicació.\r\n\t* Si és una llibreria que no es troba en cap repositori oficial, s'haurà de facilitar en el procés d'integracióde l'aplicació al SIC per a que sigui inclosa al repositori Nexus de forma manual.\r\n\r\nA continuació, amb l'experiència adquirida gràcies a la integració de les primeres aplicacions ANT i .NET al SIC, hem desenvolupat uns procediments per a que les aplicacions JAVA-ANT i .NET puguin gestionar dependències al SIC.\r\n\r\nSi hi esteu interessats, premeu els següents enllaços:\r\n\r\n* [Gestió de dependències amb .NET: NuGet](/noticies/2016-08-02-SIC-Gestio-Dependencies-dotNET)\r\n* [Gestió de dependències amb JAVA utilitzant ANT](/noticies/2016-08-02-SIC-Gestio-Dependencies-ANT)\r\n\r\n","objectID":"L25vdGljaWVzLzIwMTYtMDgtMDItU0lDLUdlc3Rpby1EZXBlbmRlbmNpZXMtQU5ULWRvdE5FVA=="},"L25vdGljaWVzLzIwMTYtMDgtMDItU0lDLUdlc3Rpby1EZXBlbmRlbmNpZXMtQU5U":{"date":1470873600000,"title":"SIC. Gestió de dependències per aplicacions ANT","description":"Procediment de gestió de dependències amb aplicacions ANT al SIC","sections":["Notícies","home"],"categories":["sic"],"key":"SETEMBRE2016","path":"/noticies/2016-08-02-SIC-Gestio-Dependencies-ANT","content":"## Gestió de dependències amb Java utilitzant ANT\n\nPer aplicacions Java no mavenitzades, tot i que existeixen solucions com [Apache Ivy](http://ant.apache.org/ivy/), és freqüent la utilització directament d'[Apache ANT](http://ant.apache.org/) per a gestionar dependències.\n\nPer a què la gestió de dependències ANT configurada a l'aplicació sigui compatible amb el SIC, cal que compleixi els següents punts:\n\n1. Utilització d'una versió d'**ANT 1.9.2 o superior**.\n\n2. S'han d'incloure a l'inici del fitxer _build.xml_ del projecte les següents directives:\n\n\t\t(...)\n\t\t<property name=\"nexus-url\" value=\"http://hudson.intranet.gencat.cat/nexus/service/local/artifact/maven/redirect\" />\n    \n\t    <macrodef name=\"descarrega-nexus\">\n    \t    <attribute name=\"repositori\"/>\n\t        <attribute name=\"grup\"/>\n    \t    <attribute name=\"artefacte\"/>\n        \t<attribute name=\"versio\"/>\n        \t<attribute name=\"extensio\"/>\n\t        <attribute name=\"desti\"/>\n    \t    <sequential>\n            \t<echo>[NEXUS] Descarregant llibreria @{grup}.@{artefacte}-@{versio}.@{extensio}</echo>\n            \t<get src=\"${nexus-url}?r=@{repositori}&amp;g=@{grup}&amp;a=@{artefacte}&amp;v=@{versio}&amp;e=@{extensio}\" dest=\"@{desti}/@{artefacte}-@{versio}.@{extensio}\" />\n        \t</sequential>\n\t    </macrodef>\n\t\t(...)\n        \n3. Cercar al repositori Nexus del SIC la llibreria que desitgem incloure al projecte:\n\n  1. Accedim al [Nexus del SIC](http://hudson.intranet.gencat.cat/nexus)\n  2. Escrivim la llibreria que desitgem cercar:\n  <img alt=\"Cerca de la llibreria\" src=\"/images/news/SIC-ant-nexus-01.png\" style=\"margin: 10px auto;width: 80%;auto;display:block;\"/>\n  3. Ens apareixeran els resultats de la cerca:\n  <img alt=\"Cerca de la llibreria\" src=\"/images/news/SIC-ant-nexus-02.png\" style=\"margin: 10px auto;width: 80%;auto;display:block;\"/>\n  4. Seleccionem l'element desitjat. Ens apareixeran dades que necessitem informar:\n      * El grup\n      * L'artefacte\n      * La versió\n      * L'extensió\n      * Indicador del repositori (a l'esquerra)\n   <img alt=\"Cerca de la llibreria\" src=\"/images/news/SIC-ant-nexus-03.png\" style=\"margin: 10px auto;width: 80%;height: auto;display:block;\"/>\n  5. Ens falta saber el nom del repositori del qual s'ha resolt la dependència. Farem clic a *Repositoris*:\n   <img alt=\"Cerca de la llibreria\" src=\"/images/news/SIC-ant-nexus-04.png\" style=\"margin: 10px auto;display:block;\"/>\n  6. Busquem el repositori a partir de l'indicador obtingut al pas 3.4. En aquest cas, el repositori de **3rd party** és **thirdparty**:\n   <img alt=\"Cerca de la llibreria\" src=\"/images/news/SIC-ant-nexus-05.png\" style=\"margin: 10px auto;width: 80%;auto;display:block;\"/>\n4. Per a cada llibreria que tingui el projecte, invocar a la macro que hem definit en el pas 2. Com a destí, especificar la ruta (path relatiu) on guardeu les llibreries del projecte. Exemple:\n\n\t\t<descarrega-nexus repositori=\"thirdparty\" grup=\"com.liferay.portal\" artefacte=\"servlet-api\" versio=\"5.1.2\" extensio=\"jar\" desti=\"./lib/\"/>\n        \nPer a qualsevol dubte referent a la gestió de dependències amb ANT al SIC  podeu [obrir una consulta](http://canigo.ctti.gencat.cat/sic/peticions/) al servei “FRAMEWORK SIC” de SAU-Remedy.\n\n","objectID":"L25vdGljaWVzLzIwMTYtMDgtMDItU0lDLUdlc3Rpby1EZXBlbmRlbmNpZXMtQU5U"},"L25vdGljaWVzLzIwMTYtMDgtMDItU0lDLUdlc3Rpby1EZXBlbmRlbmNpZXMtZG90TkVU":{"date":1470096000000,"title":"SIC. Gestió de dependències per a aplicacions .NET","description":"Procediment de gestió de dependències amb aplicacions .NET al SIC","sections":["Notícies","home"],"categories":["sic"],"key":"AGOST2016","path":"/noticies/2016-08-02-SIC-Gestio-Dependencies-dotNET","content":"## Gestió de dependències amb .NET: NuGet\n\nDurant la tardor del 2015, es va habilitar un nou repositori en el servidor Nexus del SIC que permet emmagatzemar llibreries .NET. Es tracta d'un repositori Nexus compatible amb [NuGet](https://www.nuget.org/). A més, es va habilitar en els servidors d'integració contínua l'ús d'aquest repositori per fer el muntatge de l'aplicació. D'aquesta manera, es garanteix que les llibreries utilitzades són fiables tant en termes de compatibilitat i fiabilitat com de seguretat.\n\n### Llibreries a tenir en compte\n\nAbans de començar, us recordem que s'han d'incloure al projecte totes les llibreries que no venen per defecte en un servidor Windows amb la instal·lació del Framework de .NET.\n\nPer exemple, un problema que hem trobat de forma recurrent és la no inclusió de les llibreries del client de base de dades Oracle.\n\nAquestes llibreries s'instal·len als servidors i als entorns de desenvolupament i queden registrades al GAC (Global Assembly Cache) del sistema. Per tant, són llibreries que no cal incloure-les al projecte, ja que tant en l'entorn de desenvolupament com en els entorns d'Integració, Preproducció i Producció ja estan registrades.\n\nUn cop l'aplicació s'integra al SIC, aquest tipus de llibreries s'han d'incloure de forma obligada en la gestió de dependències del projecte, ja que, els servidors del SIC no les tenen instal·lades.\n\n### Com funciona?\n\nTota dependència que s'hagi d'incloure a un projecte .NET es declara a l'arxiu de projecte (_XXXXX.csproj_ ó _XXXXX.vbproj_). Les llibreries que no són de sistema queden amb un format similar al següent:\n\n\t(...)\n    <Reference Include=\"Oracle.DataAccess, Version=4.121.1.0, Culture=neutral, PublicKeyToken=89b483f429c47342, processorArchitecture=x86\">\n\t\t<Private>False</Private>\n    </Reference>\n    (...)\n\nAquestes llibreries s'han de declarar al projecte com paquets NuGet. Per tant, a l'arxiu de gestió de dependències NuGet (generalment `packages.config`) s'ha de declarar aquesta dependència:\n\n    <?xml version=\"1.0\" encoding=\"utf-8\"?>\n    <packages>\n            (...)\n        <package id=\"Oracle.DataAccess.x86\" version=\"4.121.1.0\" targetFramework=\"net40\" />\n\t\t\t(...)\n    </packages>\n\nD'aquesta manera es descarregarà la llibreria del repositori Nexus del SIC a la carpeta `/packages`.\n\nHaurem de tornar a l'arxiu de projecte i incloure el path on s'ha descarregat la dependència:\n\n\t(...)\n    <Reference Include=\"Oracle.DataAccess, Version=4.121.1.0, Culture=neutral, PublicKeyToken=89b483f429c47342, processorArchitecture=x86\">\n\t\t<HintPath>..\\packages\\Oracle.DataAccess.x86.4.121.1.0\\lib\\net40\\Oracle.DataAccess.dll</HintPath>\n\t\t<Private>False</Private>\n    </Reference>\n    (...)\n\nPer tal que l'empaquetatge de l'aplicació continuï funcionant a l'entorn de desenvolupament, caldrà afegir la referència al Repository NuGet del Nexus del SIC (http://hudson.intranet.gencat.cat/nexus/content/groups/nuget-group/) a la configuració local (arxiu `Nuget.config`).\n\nTot i així, en molts aspectes no és necessari haver d'arribar a tan baix nivell. La comunitat .NET ofereix les següents solucions (no excloents entre si):\n\n* **NuGet Package Explorer**: Per explorar paquets NuGet i construir-los visualment.\n* **NuSpec Reference Generator**: Generar dependències per a nuspec\n* **NuProj**: Creador avançat de paquets NuGet amb intergació amb Visual Studio.\n\nPer a les llibreries de codi obert publicades al NuGet Gallery i per a les llibreries pròpies del proveïdor que es construeixen amb jobs de Jenkins *LIB* no caldrà fer cap tasca addicional. Per a la resta de llibreries, com per exemple el client d'Oracle o llibreries de proveïdors que no tenen jobs de Jenkins *LIB*, caldrà facilitar-li al SIC el paquet NuGet o l'artefacte `.dll` corresponent identificant l'*arquitectura* (**x86** o **x64**), la *versió* i el *targetFramework*.\n\nPer a qualsevol dubte referent a la gestió de dependències amb NuGet al SIC  podeu [obrir una consulta](http://canigo.ctti.gencat.cat/sic/peticions/) al servei “FRAMEWORK SIC” de SAU-Remedy.","objectID":"L25vdGljaWVzLzIwMTYtMDgtMDItU0lDLUdlc3Rpby1EZXBlbmRlbmNpZXMtZG90TkVU"},"L25vdGljaWVzLzIwMTYtMDctMDYtQ2xvdWQtZG9jdW1lbnRhY2lv":{"date":1467763200000,"title":"Container Cloud. Publicació de la documentació al web d'Arquitectura","description":"Ha estat publicada la documentació del Container Cloud al web d'arquitectura. En ella podreu trobar els diferents elements del catàleg, les plataformes cloud de referència, arquitectures tipus i la definició del cicle de vida de les aplicacions.","sections":["Notícies","home"],"categories":["cloud"],"key":"AGOST2016","path":"/noticies/2016-07-06-Cloud-documentacio","content":"Recentment ha estat publicada la documentació de [Container Cloud](http://canigo.ctti.gencat.cat/cloud/) a la web d'Arquitectura CTTI. Com a Container Cloud entenem totes aquelles solucions basades en containers (CaaS, Containers as a Service) a cloud públic i privat.\r\n\r\nLa documentació de Container Cloud es divideix en les següents seccions:\r\n\r\n* [**Elements del catàleg**](http://canigo.ctti.gencat.cat/cloud/cataleg/)\r\n\r\nFa referència a tots aquells elements que ens permetran desplegar les nostres aplicacions en el Container Cloud.\r\n\r\n* [**Plataformes cloud de referència**](http://canigo.ctti.gencat.cat/cloud/caas/)\r\n\r\nEnumeració de les diferents plataformes que componguen l'entorn Container Cloud.\r\n\r\n* [**Arquitectures tipus**](http://canigo.ctti.gencat.cat/cloud/aq/)\r\n\r\nEn aquesta secció podreu trobar diferents pilots d'arquitectures de referència desenvolupats per l'equip d'Administració del Cloud per tal de proveir d'exemples a tots aquells que vulguin desplegar les seves aplicacions en el Container Cloud.\r\n\r\n* [**Cicle de vida**](http://canigo.ctti.gencat.cat/cloud/lifecycle/)\r\n\r\nDetall de les diferents passes que ha de seguir una aplicació des de la seva fase inicial en què es fa el disseny d'arquitectura fins que es desplega al Container Cloud.\r\n\r\nPer qualsevol dubte relatiu al Container Cloud us podeu posar en contacte amb l'equip d'Administració del Cloud al [servei CLD del JIRA CSTD](http://cstd.ctti.gencat.cat/jiracstd/browse/CLD) o bé enviant un correu a la bústia [suport.cloud@gencat.cat](mailto:suport.cloud@gencat.cat)","objectID":"L25vdGljaWVzLzIwMTYtMDctMDYtQ2xvdWQtZG9jdW1lbnRhY2lv"},"L25vdGljaWVzLzIwMTYtMTAtMDQtU0lDLUNhcy1leGl0LWRlc3BsZWdhbWVudC1kb3RORVQ=":{"date":1475539200000,"title":"SIC. Cas d'èxit de desplegament d'una aplicació .NET","description":"El SIC ja compta amb un cas d'èxit de desplegament d'aplicació .NET mitjançant jobs de Jenkins. S'ha perfeccionat l'operativa dels jobs de desplegament d'aplicacions .NET per tal de fer-los capaços d'escollir el fitxer de configuració d'aplicació adient per a cada entorn on es desplegarà l'aplicació.","sections":["Notícies","home"],"categories":["sic"],"key":"OCTUBRE2016","path":"/noticies/2016-10-04-SIC-Cas-exit-desplegament-dotNET","content":"El SIC ja compta amb un cas d'èxit de desplegament d'aplicació .NET mitjançant jobs de Jenkins. \nS'ha perfeccionat l'operativa dels jobs de desplegament d'aplicacions .NET per tal de fer-los capaços d'escollir el fitxer de configuració d'aplicació (*Web.config*) adient per a cada entorn on es desplegarà l'aplicació. \n\nEl funcionament dels jobs que necessitin fer aquesta distinció serà el següent:\n\n* **Jobs de INT**: \n\t* Construirà els binaris de l'aplicació i empaquetarà en un ZIP tot el contingut a desplegar a l'IIS. \n\t* Es realitzarà un tractament d'aquest paquet per tal que inclogui l'arxiu de configuració de l'entorn de INT (reanomenarà el fitxer *Web.config.INT* a *Web.config*).\n\t* Mitjançant la utilitat MSDeploy, es desplegarà aquest paquet a l'IIS d'Integració.\n\t\n* **Jobs de PRE**:\n\t* Recollirà el paquet amb els binaris construïts del job de INT.\n\t* Es realitzarà un tractament d'aquest paquet per tal que inclogui l'arxiu de configuració de l'entorn de PRE (reanomenarà el fitxer *Web.config.PRE* a *Web.config*).\n\t* Pujarà a l'sFTP de CPD aquest paquet i obrirà una petició Remedy/correu a SAU demanant-ne el desplegament a PRE d'aquest.\n\t\n* **Jobs de PRO**:\n\t* Recollirà el paquet amb els binaris fet servir al job de PRE.\n\t* Es realitzarà un tractament d'aquest paquet per tal que inclogui l'arxiu de configuració de l'entorn de PRO (reanomenarà el fitxer *Web.config.PRO* a *Web.config*).\n\t* Pujarà a l'sFTP de CPD aquest paquet i obrirà una petició Remedy/correu a SAU demanant-ne el desplegament a PRO d'aquest.\n\t\n\n\n\nLa següent imatge il·lustra aquest comportament:\n\n![Funcionament jobs .NET](/images/news/SIC-funcionament-jobs-net.png \"Funcionament jobs .NET\")\n\nAquest sistema permetrà mantenir el principi de construcció única dels binaris + promoció d'aquests entre els diferents entorns.\n\nVal a dir que les aplicacions necessitin d'aquesta distinció de fitxers de configuració per entorn hauran d'incloure les diferents versions d'aquest fitxer al codi font (*Web.config.INT*, *Web.config.PRE*, *Web.config.PRO*). Per a aquelles aplicacions que no necessitin mantenir diferents configuracions per entorn, no s'aplicarà el tractament a l'empaquetat dels binaris abans d'enviar-ho a desplegar.\n\n\nPer a qualsevol dubte referent al funcionament dels jobs de desplegament automàtic /petició de desplegament d'aplicacions .NET, podeu [obrir una consulta](http://canigo.ctti.gencat.cat/sic/peticions/) al servei \"FRAMEWORK SIC\" de SAU-Remedy.\n","objectID":"L25vdGljaWVzLzIwMTYtMTAtMDQtU0lDLUNhcy1leGl0LWRlc3BsZWdhbWVudC1kb3RORVQ="},"L25vdGljaWVzLzIwMTYtMTEtMDctU0lDLUFjdHVhbGl0emFjaW8tc29mdHdhcmU=":{"date":1478563200000,"title":"SIC. Actualització de versions d'eines al SIC","description":"El 28 d'Octubre es va portar a terme una actualització de versions d'alguns components de software al SIC per tal d'acomplir el full de ruta del CTTI","sections":["Notícies","home"],"categories":["sic"],"key":"NOVEMBRE2016","path":"/noticies/2016-11-07-SIC-Actualitzacio-software","content":"El 28 d'Octubre es va portar a terme una actualització de versions d'alguns components de software al SIC. A continuació s'exposa una taula amb el detall del programari i les versions que s'han actualitzat / afegit.\n\n\n|Programari|Versió actual|\n|------------|-------------|\n|Jenkins|~~1.609.3~~  **2.7.4**|\n|SVN|1.8.14|\n|Nexus|2.11|\n\n\nL'actualització a [Jenkins 2.7.4](https://jenkins.io/2.0/) permetrà poder fer ús de [Pipelines](https://jenkins.io/doc/book/pipeline/). Les pipelines suposaran una millora substancial respecte al control del flux d'execució dels jobs, oferint més possibilitats i permetent controlar totes les fases del procés de CD (Continuous Delivery).\n\nPer altra banda, s'ha afegit la versió de JDK 1.8, el connector d'Oracle DB 12.1 i la versió de Maven 3.3.9 a la plataforma Jenkins del SIC. D'aquesta manera, el SIC segueix aliniat amb el [full de ruta del programari](https://portic.ctti.gencat.cat/les_tic/Normativa/arquitectura/Documents/Full%20de%20Ruta%20del%20Programari.pdf) i es troba preparat per poder construir i desplegar les aplicacions que facin ús d'algunes de les tecnologies més recents.\n\nS'aprofita aquest article per informar les versions de software (llenguatges, servidors JEE/contenidors de servlets, bases de dades) suportats pel SIC:\n\n|Tecnologia|Versió|\n|----------------------|-------------|\n|JDK|1.5, 1.6, 1.7, **1.8**|\n|Oracle DB|10.2.0.5.0, **12.1**|\n|Maven|2.0.9, 2.0.10, 2.2.1, 3.2.2, **3.3.9**|\n|.NET|4.5.2|\n|ANT|1.8.2, 1.9.6|\n|IBM WAS|8.5.5|\n|node.js|0.12.13, 4.4.3, 5.10.1|\n|MongoDB|3.2.5|\n|MS SQLServer|2014|\n|MySQL|5.7.9|\n","objectID":"L25vdGljaWVzLzIwMTYtMTEtMDctU0lDLUFjdHVhbGl0emFjaW8tc29mdHdhcmU="},"L25vdGljaWVzLzIwMTYtMTItMDQtQ2FuaWdvLUpXVA==":{"date":1480809600000,"title":"Canigó. Autenticació amb JWT (JSON Web Tokens)","description":"Autenticació amb JWT en aplicacions Canigó 3.1.x. Comparativa amb sistema tradicional basat en cookies","sections":["Notícies","home"],"categories":["canigo"],"key":"DESEMBRE2016","path":"/noticies/2016-12-04-Canigo-JWT","content":"El sistema d'autenticació tradicional utilitzat en aplicacions Canigó es basa en **cookies**. JSESSIONID és la cookie generada per contenidors de Servlets i servidors JEE, i s'utilitza per a la gestió de la sessió. El servidor crea i envia la cookie al client, el qual l'envia al servidor per a cada petició HTTP posterior. D'aquesta manera el servidor pot relacionar peticions separades que arribin d'un mateix client. Aquest sistema d'autenticació basat en cookies és **stateful**. Això significa que es manté sessió tant al costat servidor (sessió HTTP), com al client (Cookie).\n\nAquest sistema de gestió de la sessió mitjançant cookies té una sèrie d'inconvenients:\n\n* _Sobrecàrrega_: la informació relativa als usuaris normalment s'emmagatzema en memòria. Quan hi ha molts usuaris connectats, augmenta el consum de memòria al servidor.\n\n* _No escalable fàcilment_: com que s'emmagatzema informació en memòria, si necessitem balancejar la càrrega entre diferents servidors, l'usuari haurà de tornar a logar-se si les peticions no van sempre dirigides al mateix servidor. Gràcies a tècniques com sticky session o rèplica de sessió entre nodes es pot evitar. Tot i així, l'ús de cookies dificulta l'escalabilitat de les aplicacions, mentre que amb tokens el problema es soluciona de forma natural.\n\n* _CORS (Cross-Origin Resource Sharing)_: cookies + CORS no funcionen bé amb diferents dominis. \n\n* _CSRF (Cross-Site Request Forgery)_: amb cookies estem exposats a aquesta vulnerabilitat, a no ser que utilitzem alguna tècnica per protegir-nos. Amb tokens, enviats a la capçalera HTTP, estem protegits d'aquest tipus de vulnerabilitat.\n\n**[JWT (JSON Web Tokens)](https://jwt.io/)** està esdevenint un estàndard de-facto pel que fa a sistemes d'autenticació basats en tokens. La principal característica d'aquests sistemes d'autenticació és que són **stateless**. El servidor no emmagatzema informació dels usuaris logats a l'aplicació. Cada petició al servidor va acompanyada per un token el qual permet al servidor verificar l'autenticitat de la petició.\n\nEl fet que el servidor no necessiti mantenir informació de sessió per autenticar els usuaris és el principal avantatge de JWT respecte a l'ús de cookies.\n\nEl workflow amb JWT és el següent:\n\n- L'usuari realitza una petició al servei d'autenticació enviant usuari i contrasenya\n- El servei d'autenticació respon amb un token JWT amb les dades identificatives de l'usuari\n- L'usuari sol·licita accés a un servei segur enviant el token al servidor\n- La capa de seguretat valida el token, i en cas satisfactori, es dóna accés al recurs sol·licitat\n\nEn el següent diagrama observem de forma simplificada la diferència entre autenticació amb Cookies vs Tokens (JWT):\n\n![Cookies vs Tokens](/related/cs/2016/12/cookie-token-auth.png)\n\nGràcies a l'ús de JWT obtenim una sèrie de beneficis:\n\n* _Escalabilitat_: els tokens s'emmagatzemen a nivell de client, podent ser enviats a qualsevol dels nodes de l'aplicació sense que això suposi cap problema. El node servidor, sigui quin sigui, tindrà la lògica de validació del token.\n\n* _Seguretat_: com que no s'utilitza sessió, aquesta no podrà ser suplantada (CSRF).\n\n* _Multiplataforma_: no tindrem problemes en accedir des de diferents dispositius als recursos expossats per el backend de la nostra aplicació. Només cal que aquests dispositius entenguin el protocol HTTP.\n\n* _CORS_: es poden fer peticions AJAX a qualsevol servidor a qualsevol domini, donat que s'utilitza una capçalera HTTP per a transmetre la informació de l'usuari.\n\nEn cas de necessitar mantenir informació associada a la sessió de l'usuari, l'opció més natural amb JWT és emmagatzemar-la al costat client en aplicacions SPA (Single Page Application). Per exemple, en el cas de navegadors web que donin suport a HTML5 es pot fer ús del Web Storage API (sessionStorage o localStorage). És possible codificar dins el token informació de l'usuari (email, privilegis, ...). Aquesta informació ha de ser mínima, mantenint el token molt lleuger. No es considera una bona pràctica utilitzar el token com a un símil de la sessió HTTP, i sobrecarregar-lo d'informació. El token viatja al servidor a cada petició, així que no és recomanable donar-li aquest ús.\n\nEn aquest comunicat hem desenvolupat un [HowTo](/howtos/2016-11-Howto-Canigo-JWT/) amb el detall de la configuració a un backend Canigó 3.1.x per habilitar autenticació amb JWT gràcies a [Java JWT](https://java.jsonwebtoken.io/). A la pròxima versió Canigó 3.2, aquest sistema d'autenticació es proporcionarà dins el servei de seguretat per a que sigui fàcilment configurable.\n\nPer qualsevol dubte respecte a l'ús de JWT en aplicacions Canigó us podeu posar en contacte amb el CS Canigó obrint un tiquet de suport al [servei CAN del JIRA CSTD](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN) o enviant un correu a la bústia [oficina-tecnica.canigo.ctti@gencat.cat](mailto:oficina-tecnica.canigo.ctti@gencat.cat)\n","objectID":"L25vdGljaWVzLzIwMTYtMTItMDQtQ2FuaWdvLUpXVA=="},"L25vdGljaWVzLzIwMTctMDEtMDUtT1RDYW5pZ28tQmFsYW5jLTIwMTY=":{"date":1483574400000,"title":"Oficina Tècnica de Canigó. Balanç 2016","description":"Evolució dels serveis de la Oficina Tècnica de Canigó a l'any 2016","sections":["Notícies","home"],"categories":["sic, canigo, sgde"],"key":"GENER2017","path":"/noticies/2017-01-05-OTCanigo-Balanc-2016","content":"A continuació es mostren les fites aconseguides al 2016 segons ordre cronològic:\n\n<center><iframe src='https://cdn.knightlab.com/libs/timeline3/latest/embed/index.html?source=1sqpklweKg2oJIwJcStMksqj6jggC9idUe_A_RW2BPeo&font=Default&lang=ca&initial_zoom=2&height=500' width='100%' height='500' frameborder='0'></iframe></center>\n\nA mode resum, destacaríem les següents:\n\n* _SIC_ :\n\n\t- Suport de Jenkins SIC per a la generació d'artefactes i desplegaments automàtics en tecnologies .Net i NodeJS.\n\t- Suport de Jenkins SIC per a l'execució d'scripts a BBDD MongoDB, MySQL, SQLServer i PostgreSQL.\n\t- Desplegaments de sites estàtics al Cloud des de jobs Jenkins SIC.\n\t- Adaptació de Jenkins al sistema d'obertura de peticions de desplegament via Remedy.\n\t- Disponibilitat de l'Slave Jenkins a CPD2.\n\t- Actualització de versions de programari del SIC: Jenkins, SVN i Nexus.\n\t- El SIC s'encarrega de la gestió integral del codi font i del reporting a direcció CTTI.\n\n* _FW Canigó_ :\n\n\t- Actualització connectors Canigó amb la PICA\n\t- Nou connector amb el Gestor Documental Aresta (PSGD).\n\t- Nou mòdul d'Administració de Logs.\n\t- Publicació de noves versions de l'entorn de desenvolupament Canigó.\n\t- Certificació Canigó 3.1 en Tomcat 8 i Weblogic 12c amb Oracle Java 8\n\n* _SGDE_ :\n\n\t- Obligatorietat d'informar els camps 'ambit' i 'aplicacio' a les crides al WS\n    - Pilot de Mobilització de Formularis\n\nPer a més informació sobre els futurs evolutius planificats, podeu consultar el [Roadmap d'arquitectura del CTTI](http://canigo.ctti.gencat.cat/centre-de-suport/roadmap/).\n","objectID":"L25vdGljaWVzLzIwMTctMDEtMDUtT1RDYW5pZ28tQmFsYW5jLTIwMTY="},"L25vdGljaWVzLzIwMTctMDItMDMtSW50cm9kdWNjaW8tU0lDMi4w":{"date":1486080000000,"title":"SIC. Introducció a SIC 2.0","description":"El SIC està evolucionant per tal de poder donar cabuda a les tecnologies més emprades avui dia. La primera actualització està prevista d'aplicar-se a l'Abril d'aquest any.","sections":["Notícies","home"],"categories":["sic"],"key":"FEBRER2017","path":"/noticies/2017-02-03-Introduccio-SIC2.0","content":"El SIC està evolucionant per tal de poder donar cabuda a les tecnologies més emprades avui dia. La primera actualització està prevista d'aplicar-se a l'Abril d'aquest any i inclourà els següents canvis:\n\n#### **Nou Sistema de control de codi font: Gitlab**\n\nS'incorporarà [Gitlab](https://about.gitlab.com/) com a Sistema de control de codi font (SCM). Aquest SCM conviurà amb l'actual, el SVN.\nLes noves aplicacions que s'incorporin al SIC a partir d'aquest Abril, ja ho podran fer amb Gitlab.\n\n\n#### **Sistema d'accés al Gitlab / SVN / Jenkins**\n\nA partir de l'Abril, l'accés als repositoris GIT/SVN i Jenkins es farà mitjançant les mateixes credencials del compte GICAR. \nS'emetrà un comunicat alertant de la data concreta de posada en funcionament d'aquest canvi.\n\n\n#### **Autoservei de repositoris i usuaris a Gitlab**\n\nEls mateixos proveïdors d'aplicacions seran autònoms per poder crear els repositoris de codi de les aplicacions dins el Gitlab i assignar permisos a usuaris en aquests repositoris.\nPer a les aplicacions que ja custodien el codi font al repositori SVN, el SIC oferirà la possibilitat de migrar el contingut d'aquest sistema al de Gitlab. D'igual manera, es proporcionarà un procediment als proveïdors que vulguin migrar projectes del seu GIT de desenvolupament al GITLAB del SIC.\n\n\n![SIC 1.0 vs SIC 2.0](/images/news/introduccio-sic.2.0.png)\n\nDurant els pròxims mesos s'alliberarà més informació i més detallada sobre aquests i futurs canvis que s'afegiran a SIC.\n","objectID":"L25vdGljaWVzLzIwMTctMDItMDMtSW50cm9kdWNjaW8tU0lDMi4w"},"L25vdGljaWVzLzIwMTYtMTItMDEtU0lDLU5vdmEtQ3JlYWNpby1NYXNzaXZhLVJlcG9zaXRvcmlzU1ZO":{"date":1480550400000,"title":"SIC. Nova creació massiva de repositoris SVN","description":"Des de SIC s'ha recopilat la informació de les aplicacions que encara no tenen repositori a SIC i s'ha portat a terme un nou procés de creació massiva de repositoris SVN","sections":["Notícies","home"],"categories":["sic"],"key":"DESEMBRE2016","path":"/noticies/2016-12-01-SIC-Nova-Creacio-Massiva-RepositorisSVN","content":"A l'Agost del 2014 el SIC es va adaptar al nou model TIC. Com a part del procés d'adaptació, es van crear els repositoris SVN de les aplicacions de les quals es tenien constància. A partir d'aquella data, els repositoris SVN de les noves aplicacions s'han creat sota demanda dels proveïdors d'aplicacions o Departament.\n\nAquest mes de Novembre s'ha extret de l'inventari d'aplicacions del Pòrtic la informació de les aplicacions que encara no tenen repositori SVN a SIC, i s'ha portat a terme un nou procés de creació massiva de repositoris SVN. \n\nEl llistat dels repositoris SVN donats d'alta fins al moment es pot consultar al següent [document] (/related/sic/Repositoris_SVN_Creats_A_SIC_Novembre2016.xlsx). \n\n\n<CENTER>![sic](/images/news/SIC_repositoris_creats_Novembre2016.png)</center>\n\n\nEs preveu repetir aquest procés d'identificació i creació massiva de repositoris periòdicament.\n\nEls proveïdors d'aplicacions que disposin d'usuari SIC i trobin creat els repositoris SVN de les aplicacions que mantenen (sota http://svn.intranet.gencat.cat/ [àmbit]), ja podran fer-los servir sense necessitat de formalitzar la petició d'alta del repositori a SIC. Altrament, hauran de continuar formalitzant la [petició d'alta de repositori] (http://canigo.ctti.gencat.cat/sic/peticions/) a SIC.\n","objectID":"L25vdGljaWVzLzIwMTYtMTItMDEtU0lDLU5vdmEtQ3JlYWNpby1NYXNzaXZhLVJlcG9zaXRvcmlzU1ZO"},"L25vdGljaWVzLzIwMTctMDItMDYtTm92ZXRhdHMtQ2FuaWdvLTMy":{"date":1486339200000,"title":"Canigó. Novetats a propera versió Canigó 3.2","description":"Des de l'equip de Canigó s'està treballant en la versió 3.2 de Canigó, la qual incorporarà novetats importants com el suport a serveis REST i autenticació amb JWT (JSON Web Token).","sections":["Notícies","home"],"categories":["canigo"],"key":"FEBRER2017","path":"/noticies/2017-02-06-Novetats-Canigo-32","content":"Des de l'equip de Canigó s'està treballant en la versió 3.2 de Canigó, la qual incorporarà novetats importants com el suport a serveis REST i autenticació amb JWT (JSON Web Token) entre d'altres. Fa temps que tant des d'Arquitectura CTTI com des del CS Canigó s'està promovent l'ús d'arquitectures basades en servei REST al backend i consum de dades via Javascript en frontals web HTML5, i és en aquesta nova versió que s'incorporaran classes i configuracions de suport per facilitar el desenvolupament d'aplicacions que segueixin aquesta arquitectura.\n\nLa introducció de [Swagger](http://swagger.io/), framework pel disseny, construcció, documentació i consum d'APIs REST, és clau per disposar d'un ecosistema que permeti treballar amb APIs REST de forma fàcil i intuïtiva.\n\n<center>![Swagger a Canigó 3.2](/images/news/swagger-canigo.png)</center>\n\nLa integració realitzada amb Swagger i [JWT](https://jwt.io/) (JSON Web Token) permet validar la seguretat de les nostres APIs. Un cop obtingut el token (/api/auth) és possible fer crides a altres APIs REST de l'aplicació sempre que l'usuari hi estigui autoritzat. En cas contrari obtindrem un error \"HTTP 401 - Unauthorized\".\n\nComentar que JSF (JavaServer Faces) passa a ser una tecnologia deprecada en aquesta versió de Canigó. En cap cas s'evolucionarà més enllà d'actualització de llibreries per tal de garantir la compatibilitat amb contenidors de servlets i servidors d'aplicacions del [Full de Ruta del Programari](https://portic.ctti.gencat.cat/les_TIC/Normativa/arquitectura/Documents/Full%20de%20Ruta%20del%20Programari.pdf).\n\nLa data d'alliberament de Canigó 3.2 està prevista per finals d'aquest mes de Febrer de 2017. Una nova notícia o destacat es publicarà en aquest portal per tal de donar més detalls d'aquesta nova versió de Canigó: documentació, binaris i aplicació plantilla.\n\nPer qualsevol dubte us podeu posar en contacte amb el CS Canigó al [servei CAN](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN) del JIRA CSTD o enviant-nos un mail a la [bústia](oficina-tecnica.canigo.ctti@gencat.cat) del CS Canigó.","objectID":"L25vdGljaWVzLzIwMTctMDItMDYtTm92ZXRhdHMtQ2FuaWdvLTMy"},"L25vdGljaWVzLzIwMTctMDMtMDYtQ2xvdWQtc2VndXJldGF0LWFjY2VzLWVsYXN0aWNzZWFyY2gtb3Nz":{"date":1488758400000,"title":"Cloud. Accés a Elasticsearch a cloud públic","description":"L'accés a un Elasticsearch a cloud públic té una sèrie de consideracions de seguretat a tenir en compte","sections":["Notícies","home"],"categories":["cloud"],"key":"MARC2017","path":"/noticies/2017-03-06-Cloud-seguretat-acces-elasticsearch-oss","content":"L'accés a un Elasticsearch (ES) a cloud públic té una sèrie de consideracions de seguretat a tenir en compte. En el cas de [Compose](https://www.compose.com/), plataforma utilitzada a solucions de cloud públic per l'aprovisionament de DBaaS, els ES no incorporen el mòdul [X-Pack](https://www.elastic.co/products/x-pack/security) el qual permet securitzar-ne l'accés. Cal incloure doncs mecanismes que impedeixin accessos no autoritzats.\r\n\r\n## Seguretat\r\n\r\nÉs imprescindible que els accessos a l'ES només es realitzin des de servidors autoritzats. Serà necessari, per tant, que s'identifiquin les IPs d'accés per tal que es configurin a una whitelist a Compose.\r\n\r\nExemple:\r\n\r\n![Whitelist Compose](/images/cloud/whitelist_compose.png)\r\n\r\n### Accés des d'una aplicació a Bluemix\r\n\r\nEn el cas que l'aplicació origen que requereix accés a l'ES estigui a Bluemix, és necessari l'ús del servei [Statica](https://console.ng.bluemix.net/catalog/services/statica).\r\n\r\n![Statica](/images/cloud/statica.png)\r\n\r\nL'assignació d'una IP fixe de sortida permetrà la seva configuració a la whitelist de Compose.\r\n\r\n### Accés des d'una aplicació a CPD corporatiu\r\n\r\nPer les aplicacions desplegades a CPD corporatiu caldrà que CPD indiqui la IP de sortida de l'aplicació a Internet. Aquesta és la IP que s'haurà de configurar a la whitelist de Compose.\r\n\r\n### Accés des d'una pàgina web\r\n\r\nEn alguns casos, com per exemple cercadors a portals web, és possible que l'accés a l'ES es realitzi des del navegador de l'usuari. Les planes web no haurien d'incorporar les credencials a l'ES donat que la sostracció d'aquestes podria derivar en un ús indegut. Pels ES que no incorporin el mòdul X-Pack és més important encara, ja que els usuaris tenen privilegis de lectura i escriptura.\r\n\r\n#### Proxy\r\n\r\nPer tal d'evitar el problema de sostracció de credencials, es recomana que l'accés a l'ES es realitzi via un proxy, per exemple, desplegat a Bluemix. Aquest proxy (Apache, Nginx, ...) serà qui tindrà les credencials d'accés a l'ES. L'accés al proxy només es podrà realitzar des del domini de l'aplicació.\r\n\r\nPer els servidors web Nginx i Apache els mòduls que permeten aquesta configuració són [ngx_http_access_module](http://nginx.org/en/docs/http/ngx_http_access_module.html) i [mod_authz_host](https://httpd.apache.org/docs/2.4/mod/mod_authz_host.html) respectivament.\r\n\r\n## Cas pràctic\r\n\r\nUn escenari real seria el d'una aplicació amb un backend a CPD corporatiu el qual insereix dades a l'ES, i un cercador que les consulta des d'una plana web.\r\n\r\n![Seguretat accés a ES a cloud públic](/images/cloud/seguretat_es_cloud_public.png)\r\n\r\n- _Administrador_: responsable d'introduïr les dades a l'ES\r\n- _Usuari_: cerca d'informació a l'ES\r\n\r\nExisteix una altra opció que consistiria en que el backend també accedís a l'ES a través del Proxy. En aquest cas seria el Proxy quí tindria configurada a la seva whitelist la \"ip_sortida_backend\", en lloc del Compose.\r\n\r\n## Referències\r\n\r\n- [Static IPs with Bluemix and Statica](https://www.ibm.com/blogs/bluemix/2015/08/static-ips-with-bluemix-and-statica/)\r\n- [Securing Elasticsearch and Kibana](https://www.elastic.co/guide/en/x-pack/current/xpack-security.html)\r\n","objectID":"L25vdGljaWVzLzIwMTctMDMtMDYtQ2xvdWQtc2VndXJldGF0LWFjY2VzLWVsYXN0aWNzZWFyY2gtb3Nz"},"L25vdGljaWVzLzIwMTctMDMtMDctUGlwZWxpbmVzLVNJQzIuMA==":{"date":1488844800000,"title":"SIC. Introducció Pipelines a SIC 2.0","description":"El passat mes es van comentar algunes de les millores que incorporarà SIC 2.0 pel que fa al SCM (s'afegeix Gitlab). L'altre gran peça de SIC, el Jenkins, també patirà un gran canvi amb l'evolució a SIC 2.0. S'incorpora el model de treball amb jobs de tipus Pipeline, job que engloba tots els estats del cicle d'Integració Contínua.","sections":["Notícies","home"],"categories":["sic"],"key":"MARC2017","path":"/noticies/2017-03-07-Pipelines-SIC2.0","content":"El passat mes es van comentar algunes de les millores que incorporarà SIC 2.0 pel que fa al SCM (s'afegeix Gitlab). L'altre gran peça de SIC, el Jenkins, també patirà un gran canvi amb l'evolució a SIC 2.0. S'incorpora el model de treball amb jobs de tipus Pipeline, job que engloba tots els estats del cicle d'Integració Contínua.\r\n\r\nFins el moment, es contempla el següent escenari:\r\n\r\n- Existeixen els següents tipus de jobs: d'instal·lació de llibreries, de construcció + validació codi, de desplegament automàtic a INT i de petició desplegament a PRE/PRO. \r\n- Tots ells s'executen per separat\r\n- Només es contempla el desplegament automàtic a entorns INT.\r\n\r\nLa versió actual de Jenkins, la 2.7.4, incorpora un nou tipus de job, el de Pipeline. Aquest tipus de jobs faciliten la inclusió del cicle complet d'Integració Contínua en un únic Job. S'està treballant en l'adaptació a aquest model de treball. Les característiques d'aquest seran:\r\n\r\n- El job ja no serà executat directament pel desenvolupador sinó que s'iniciarà automàticament en fer la pujada de codi al GitLab (un hook configurat al GitLab farà de llançadora).\r\n- El job descarregarà la darrera versió de codi font i construirà el/s binaris. Per a considerar el codi com a vàlid, s'efectuaran validacions de qualitat i test automàtics.\r\n- Prèviament al desplegament automàtic a entorns PRE i PRO, el job Pipeline contemplarà l'autorització per part dels responsables i validarà que el desplegament s'efectua dins la finestra d'execució de l'aplicació.\r\n- El flux del job Pipeline podrà ser aturat en cas de considerar una versió com a no apta per a desplegar.\r\n\r\n\r\nA continuació es mostra un esquema simplificat del funcionament del nou tipus de Job Pipeline en contrapartida al sistema actual de jobs.\r\n\r\n![SIC 1.0 vs SIC 2.0](/images/news/introduccio-pipelines-sic.2.0.png)\r\n\r\nDurant els pròxims mesos s'alliberarà informació més detallada sobre el funcionament d'aquest tipus de Jobs.","objectID":"L25vdGljaWVzLzIwMTctMDMtMDctUGlwZWxpbmVzLVNJQzIuMA=="},"L25vdGljaWVzLzIwMTctMDMtMzEtcHVibGljYWNpby1jYW5pZ28zMg==":{"date":1490918400000,"title":"Canigó. Publicada nova versió 3.2 del framework","description":"La versió 3.2 del framework Canigó presenta novetats molt importants respecte a les seves predecessores. L'objectiu principal d'aquesta nova versió és facilitar el desenvolupament d'aplicacions que segueixin el patró d'arquitectura recomanat pel CS Canigó, consistent en el desacoblament del frontend web vers els serveis de backend que exposen les dades de negoci. En aquesta línia es depreca JSF, sent aquesta l'última versió de Canigó en la que s'hi donarà suport","sections":["Notícies","home"],"categories":["canigo"],"key":"ABRIL2017","path":"/noticies/2017-03-31-publicacio-canigo32","content":"Amb l'alliberament de la versió 3.2 del framework Caniǵo s'assoleix un dels objectius que es persegueix des de fa temps al CS Canigó, consistent en facilitar el desenvolupament d'aplicacions que segueixin el patró d'arquitectura on el frontend web i el backend que exposa les dades de negoci estan totalment desacoblats. Amb aquesta finalitat s'ha incorporat un nou Mòdul RS (RESTful Services) el qual dóna suport al desenvolupament d'APIs REST. A més d'aquest nou mòdul, Canigó 3.2 té actualitzacions importants d'alguns mòduls core com els de seguretat, persistència i traces. L'altre gran objectiu d'aquesta nova versió de Canigó és facilitar el desplegament en entorns corporatius a CPDs i Container Clouds. En aquesta línia s'ha certificat el seu funcionament en Tomcat 8 i Weblogic 12c, i introduït Docker a la plantilla d'aplicació.\n\n<br>\n### Mòduls\n\nA continuació es descriuen els canvis més rellevants que s'han fet als mòduls que formen part del framework.\n\n#### Mòdul RS (RESTFul Services) [_NOU!_]\n\nEl Mòdul RS ha estat introduït al framework per permetre l'exposició de dades mitjançant serveis REST de forma àgil i seguint les millors pràctiques d'[APIs REST](http://canigo.ctti.gencat.cat/blog/2016/01/api/).\n\nLes principals característiques d'aquest mòdul són les següents:\n\n* Control genèric d'errors\n* Classes estàndard de resposta\n* APIs REST incorporades per exposar les propietats de configuració de l'aplicació i mòduls carregats\n\nTot el contingut es serveix en format JSON.\n\nPodeu trobar tota la informació d'aquest mòdul a la següent [pàgina](http://canigo.ctti.gencat.cat/canigo-documentacio-versions-3x-core/modul-rs/) del portal.\n\n#### Mòdul de Seguretat [_ACTUALITZAT!_]\n\nCom a gran novetat al Mòdul de Seguretat s'incorpora el suport a [JWT (JSON Web Token)](https://jwt.io/) per tal de permetre la construcció d'aplicacions stateless que puguin ser fàcilment escalables. En concret, la llibreria utilitzada és [JJWT (Java JWT)](https://github.com/jwtk/jjwt).\n\nL'ús de JWT és compatible amb GICAR i la resta de proveïdors de seguretat suportats per Canigó. \nUn cop l'usuari ha estat autenticat, el backend Canigó genera un token que haurà de ser enviat pel client a la capçalera HTTP per a cada petició.\n\nPodeu trobar tota la informació d'aquest mòdul a la següent [pàgina](http://canigo.ctti.gencat.cat/canigo-documentacio-versions-3x-core/modul-seguretat/) del portal.\n\n#### Mòdul de Persistència (JPA) [_ACTUALITZAT!_]\n\n[Spring Data JPA] (http://projects.spring.io/spring-data-jpa/) i [QueryDSL] (http://www.querydsl.com/) passen a ser les llibreries de suport principals per l'accés a dades.\n\nGràcies a Spring Data JPA i l'ús de repositoris es redueix el codi necessari per fer accessos a la base de dades. Les operacions més habituals són proporcionades pels repositoris i afegir nous mètodes d'accés a dades a aquests repositoris és molt fàcil.\n\nQueryDSL permet la generació de queries dinàmiques de forma segura mitjançant codi. És compatible amb JPA i, de la mateixa manera que Spring Data, dóna suport als motors de bases de dades més populars (Oracle, MySQL, PostgreSQL, SQLServer, MongoDB).\n\nPodeu trobar tota la informació d'aquest mòdul a la següent [pàgina](http://canigo.ctti.gencat.cat/canigo-documentacio-versions-3x-core/modul-jpa/) del portal.\n\n#### Mòdul de Traces [_ACTUALITZAT!_]\n\nL'actualització de Log4j a SLF4J+Log4j2 és la principal novetat que incorpora aquest mòdul. A continuació s'enumeren els principals avantatges que suposa aquest canvi:\n\n* Loggers asíncrons\n* Nivells de log personalitzats\n* Reconfiguració automàtica\n* Ús més eficient de memòria i millores en la concurrència\n* Fàcilment extensible\n* Configuració en més formats: XML, JSON, YAML\n\nPodeu trobar tota la informació d'aquest mòdul a la següent [pàgina](http://canigo.ctti.gencat.cat/canigo-documentacio-versions-3x-core/modul-traces/) del portal.\n\n#### Mòdul JSF [_DEPRECAT!_]\n\nJSF (JavaServer Faces) passa a ser una tecnologia deprecada en aquesta versió de Canigó. No s'ha evolucionat més enllà d'actualitzar versions de llibreries per tal de garantir la compatibilitat amb contenidors de servlets i servidors d'aplicacions del [Full de Ruta del Programari del CTTI](https://portic.ctti.gencat.cat/les_TIC/Normativa/arquitectura/Documents/Full%20de%20Ruta%20del%20Programari.pdf).\n\n<br>\n### Nou Repositori Maven al Nexus del SIC\n\nCanigó 3.2, en el seu core, incorpora un canvi important. Aquest canvi és el pas d'un repositori Maven a un grup de repositoris amb accés SSL: https://sic.ctti.extranet.gencat.cat/nexus/content/groups/canigo-group-maven2/\n\nGràcies a l'ús d'aquest grup de repositoris disponible al Nexus del SIC, qualsevol canvi (actualització, eliminació, afegit) als repositoris que formen part del grup serà transparent al desenvolupador d'aplicacions Canigó.\n\n<br>\n### Nova plantilla d'aplicació Canigó 3.2\n\nLa nova versió 1.6.0 del [Plugin d'Eclipse de Canigó](http://canigo.ctti.gencat.cat/canigo-download-related/plugin-canigo/) permet la creació d'aplicacions Canigó 3.2. A partir d'aquesta nova versió del plugin deixa de donar-se l'opció de crear aplicacions Canigó basades en JSF.\n\nA continuació es descriuen les novetats més importants que incorpora la plantilla d'aplicació Canigó 3.2.\n\n#### Swagger\n\nLa introducció de [Swagger](http://swagger.io/), framework pel disseny, construcció, documentació i consum d'APIs REST, és clau per disposar d'un ecosistema que permeti treballar amb APIs REST de forma fàcil i intuïtiva.\n\n<center>![Swagger a Canigó 3.2](/images/news/swagger-canigo.png)</center>\n\nLa integració realitzada amb Swagger i JWT permet validar la seguretat de les nostres APIs de forma ràpida.\n\n#### Spring Boot\n\n[Spring Boot](https://projects.spring.io/spring-boot/) ens permet executar l'aplicació sense necessitat de disposar d'un servidor d'aplicacions o contenidor de servlets. És capaç d'executar-ne un internament (Tomcat, Jetty o Undertow) i aixecar l'aplicació.\n\nAquesta és la característica més important, però en té d'altres:\n\n* Simplificació de configuració Maven\n* Configuracions de Spring de forma automàtica\n* No genera codi i no requereix configuració per XML\n\n#### Docker\n\nCanigó 3.2 pot ser desplegat en els contenidors Docker certificats per [Suport Cloud](http://canigo.ctti.gencat.cat/cloud/), ja sigui en un jar executable (Spring Boot) amb Java o en un war a Tomcat:\n\n*Bluemix*\n\n* [gencatcloud/java](https://hub.docker.com/r/gencatcloud/java)\n* [gencatcloud/tomcat](https://hub.docker.com/r/gencatcloud/tomcat)\n\n*OpenShift*\n\n* [gencatcloud/java-openshift](https://hub.docker.com/r/gencatcloud/java-openshift)\n* [gencatcloud/tomcat-openshift](https://hub.docker.com/r/gencatcloud/tomcat-openshift)\n\nD'aquesta manera es vol facilitar el desplegament d'aplicacions Canigó en entorns Container Cloud com [Bluemix](https://console.eu-gb.bluemix.net/) i d'altres basats en [OpenShift](https://www.openshift.org/).\n\n<br>\n### Certificació amb servidors del full de ruta\n\nCanigó 3.2 ha estat certificat amb alguns dels servidors del [Full de ruta del programari del CTTI](https://portic.ctti.gencat.cat/les_TIC/Normativa/arquitectura/Documents/Full%20de%20Ruta%20del%20Programari.pdf) corrent amb els runtimes Java d'Oracle suportats per cadascun d'ells:\n\n* Weblogic 12c\n* Tomcat 7 i 8\n* Websphere 8.5 (_properament_)\n\n<br>\nPer qualsevol dubte relatiu a aquesta nova versió de Canigó us podeu posar en contacte amb el CS Canigó al [servei CAN](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN) del JIRA CSTD o enviant-nos un mail a la [bústia](mailto:oficina-tecnica.canigo.ctti@gencat.cat) del CS Canigó.\n","objectID":"L25vdGljaWVzLzIwMTctMDMtMzEtcHVibGljYWNpby1jYW5pZ28zMg=="},"L25vdGljaWVzLzIwMTctMDUtMTItU0lDLW5vdmVzLWZ1bmNpb25hbGl0YXRz":{"date":1494547200000,"title":"SIC 2.0: Millores en la gestió d'usuaris i repositoris","description":"Atès la imminent arribada del SIC 2.0, és convenient que tots els usuaris siguin coneixedors de les noves funcionalitats que ofereix aquesta versió. En aquest article, fem un resum dels mòduls de gestió d'usuaris i repositoris.","sections":["Notícies","home"],"categories":["sic"],"key":"MAIG2017","path":"/noticies/2017-05-12-SIC-noves-funcionalitats","content":"Atès la imminent arribada del SIC 2.0, és convenient que tots els usuaris siguin coneixedors de les noves funcionalitats que ofereix aquesta versió. En aquest article, fem un resum dels mòduls de gestió d'usuaris i repositoris.\r\n\r\n## Autoservei d'usuaris\r\n\r\nAmb l'autoservei d'usuaris, hi ha un rol que pateix una evolució molt important al SIC: el rol de *Release Manager*. Els usuaris amb aquest rol podran gestionar els usuaris dels seus projectes. En concret, podran realitzar, a més de les funcions que ja disposaven al SIC 1.0, les següents accions:\r\n\r\n* Concedir/treure els accessos dels seus projectes publicats al SIC als usuaris que considerin oportú.\r\n* Definir quins permisos té cada usuari en cadascun dels projectes (poden concedir el rol de *Release Manager* a altres usuaris que no el tinguin).\r\n\r\nA més d'aquestes noves funcionalitats, cal recordar que ja no caldrà sol·licitar les altes i baixes dels usuaris al SIC. El SIC 2.0 s'ha integrat amb GICAR i, per tant, la gestió d'usuaris es realitza a través de GICAR. \r\n\r\nD'aquesta manera, ja no caldrà realitzar peticions a SAU/Remedy per cobrir cap necessitat dels proveïdors d'aplicacions pel que fa a la gestió d'usuaris del SIC.\r\n\r\n## Autoservei de repositoris\r\n\r\nDe forma similar que amb l'autoservei d'usuaris, el rol de *Release Manager* adquireix també més funcionalitats pel que fa a la gestió de repositoris.\r\n\r\nAl SIC 2.0 disposem d'un nou gestor de repositoris de codi font: **GitLab**. A més a més de les diferències tècniques (els repositoris són Git i no SVN), n'hi ha d'organitzatives. Aprofitant tota l'experiència adquirida amb el SIC 1.0, hem configurat els repositoris de forma diferent. Ara hi ha només un nivell d'agrupació: el codi d'aplicació. L'acrònim de Departament/Unitat Organitzativa l'hem eliminat. D'aquesta manera és més senzill localitzar els projectes a través de l'eina i l'estructura roman independent dels canvis departamentals.\r\n\r\nTot usuari al GitLab pot crear repositoris i grups de repositoris en el seu propi espai personal. Els *Release Managers*, a més a més, podran crear repositoris oficials en l'espai del SIC. Simplement, hauran d'entrar al grup corresponent al codi d'aplicació del projecte i els hi apareixerà l'opció de creació.\r\n\r\nPer tant, desapareix la necessitat de realitzar peticions a SAU/Remedy per sol·licitar la creació d'un nou repositori al SIC. Els lots d'aplicacions són autònoms pel que fa als repositoris.\r\n\r\n## Avantatges\r\n\r\nEls avantatges de l'evolució del SIC 2.0 són:\r\n\r\n* S'eliminen temps d'espera administratius. Els lots d'aplicacions poden treballar des del primer dia de forma autònoma.\r\n* Estandardització dels usuaris del SIC, en haver integrat aquest amb GICAR.\r\n* No cal involucrar a responsables d'àmbit ni de lot per a la gestió d'usuaris i de repositoris. El lot d'aplicacions té l'autoritat per fer-ho.\r\n* Desapareix la limitació de disposar com a màxim 3 *Release Managers* per lot i àmbit.\r\n\r\nAviat podreu consultar tota la documentació associada a aquesta nova versió del SIC al [portal](http://canigo.ctti.gencat.cat/sic-documentacio/).\r\n\r\nPer a qualsevol dubte o suggeriment, podeu contactar amb el SIC a través de SAU/Remedy o un correu electrònic a la bústia [`oficina-tecnica.canigo.ctti@gencat.cat`](mailto:oficina-tecnica.canigo.ctti@gencat.cat).\r\n","objectID":"L25vdGljaWVzLzIwMTctMDUtMTItU0lDLW5vdmVzLWZ1bmNpb25hbGl0YXRz"},"L25vdGljaWVzLzIwMTctMDYtMDctU0lDLVNJQ18yLjA=":{"date":1496793600000,"title":"SIC. Llançament del SIC 2.0","description":"El passat 31 de Maig es va realitzar la presentació oficial del SIC 2.0. Presentem un resum amb les característiques més importants.","sections":["Notícies","home"],"categories":["sic"],"key":"JUNY2017","path":"/noticies/2017-06-07-SIC-SIC_2.0","content":"## SIC 2.0\r\n\r\nEl passat 31 de Maig es va realitzar la presentació oficial del SIC 2.0. Com ja s'ha comentat en altres comunicats, aquesta nova versió del SIC incorpora:\r\n\r\n* Un autoservei d'usuaris amb el que els release managers són autosuficients per a assignar els usuaris que necessitin als seus projectes i aplicacions. Els usuaris estan precarregats des de GICAR. Només es requereix fer un login previ a [GitLab] (https://git.intranet.gencat.cat/users/sign_in) per a que siguin visibles des de l'aplicació. S'ha establert un sistema d'assignació de privilegis que funciona de la següent manera:\r\n\t* Per a Release Managers i administradors de CPD/Lloc de Treball, els privilegis s'assignen de forma automàtica.\r\n\t* Per a la resta d'usuaris de Lot, els Release Managers gestionen els seus privilegis.\r\n* Un autoservei de repositoris, mitjançant el qual, els Release Managers poden crear-los i concedir permisos d'accés a aquests a d'altres usuaris.\r\n* S'adopta de forma general els jobs de construcció i desplegament de tipus Pipeline, que permeten extensibilitat i futures millores al SIC.\r\n* Git com a nou SCM, que és de naturalesa distribuïda i que permet una millor gestió de branques, i un entorn de treball més usable i modern.\r\n* Solució als problemes d'espai deguts a l'emmagatzemament de binaris, mitjançant el nou sistema de Gestió de Binaris.\r\n\r\nAquestes noves funcionalitats s'han adquirit gràcies a la implantació dels següents sistemes:\r\n\r\n* Integració amb GICAR\r\n* GitLab 9.x\r\n* Jenkins 2.x\r\n* Nou mòdul de Gestió de Binaris\r\n\r\nPodeu descarregar-vos la presentació fent clic a [aquest enllaç](/related/sic/2.0/SIC-2.0.pdf).\r\n\r\n## Període de convivència entre Subversion i Gitlab\r\n\r\nS'ha establert un període de convivència entre Subversion i Gitlab que permetrà el traspàs progressiu de repositoris d'un sistema a l'altre. En aquest periode, es mantindran les credencials antigues únicament per accedir a Subversion. Per als altres components de SIC **caldrà utilitzar les credencials de GICAR**.\r\n\r\nLa gestió d'usuaris es farà integrament amb les eines de Gicar i de Gitlab. Les identitats antigues es mantindran per permetre la convivència.\r\n\r\nEls repositoris nous es crearan a Gitlab. Els repositoris subversion seguiran estan actius fins a que els responsables de l'aplicació hagin notificat la migració a gitlab o fins a la data de fi de disponibilitat de subversion, el 6 de novembre de 2017.\r\n\r\n### Migració de repositoris\r\n\r\nCada proveïdor d'aplicacions és autònom per migrar les seves aplicacions de SVN a GIT. Una migració entre el subversion de SIC i el nou Git de SIC2.0 pot ser una tasca feixuga per la quantitat de versions històriques que manté el repositori actual, i per tant molt sensible a errors i repeticions de la migració. Per facilitar aquesta migració, es recomana pujar la versió actual directament des dels entorns de desenvolupament locals GIT. D'aquesta manera, tindran els entorns alineats tecnològicament amb el SIC i podran fer servir les funcionalitats proporcionades per Git a l'hora de treballar amb més d'un repositori. En especial, es podrà afegir el nou *remote* corresponent al GitLab del SIC, el que permetrà fer *push* a aquest *remote* cada vegada que es vulgui generar una versió entregable al SIC. En cas de no disposar d'un entorn git local, es recomana crear-ne un i volcar-hi la darrera versió de l'aplicació al subversion local disponible i fer un push al nou git.\r\n\r\n## Nova gestió de binaris\r\n\r\nPer a evitar els problemes d'espai que generen els binaris en un SCM com git o subversion, no es permetrà la inclusió d'arxius binaris al GitLab. Si és imprescindible l'emmagatzemament de binaris, el SIC ofereix les següents alternatives:\r\n\r\n* Per a llibreries: Utilitzar el repositori Nexus del SIC.\r\n* Per a d'altres binaris:\r\n\t* Fins al 26 de Juny, s'haurà de seguir utilitzant el SVN per a la pujada de binaris.\r\n\t* A partir del 26 de Juny, s'haurà d'utilitzar el nou mòdul de Gestió de Binaris, que estarà disponible a través de l'URL: [`https://bin.sic.intranet.gencat.cat`](https://bin.sic.intranet.gencat.cat).\r\n    * L'accés al SVN per a binaris es restringirà el 10 de juliol definitivament\r\n\r\n\r\nUs facilitem un calendari amb les properes accions que es realitzaran al SIC:\r\n\r\n<iframe src='https://cdn.knightlab.com/libs/timeline3/latest/embed/index.html?source=1OTb_56tC81h5WUsq_KMVHfdoFUjrgd4HSETtbV-HAiY&font=OpenSans-GentiumBook&lang=ca&timenav_position=top&initial_zoom=1&height=650' width='100%' height='650' webkitallowfullscreen mozallowfullscreen allowfullscreen frameborder='0'></iframe>\r\n\r\n## Beneficis del SIC 2.0\r\n\r\nEls beneficis aportats per aquests canvis són:\r\n\r\n* Autoservei en la gestió d'usuaris i en la gestió de repositoris per part dels lots d'aplicacions.\r\n* Reducció a la mínima expressió dels tràmits administratius per a que un usuari pugui fer servir un repositori o crear-ne un de nou.\r\n* Reducció del temps de cicle (interval de temps entre que es puja una funcionalitat nova al SCM i aquesta arriba a Producció).\r\n* Extensibilitat: S'han assentat els fonaments que permetran afegir futures millores al SIC d'una forma més àgil.\r\n\r\n## Informació disponible\r\n\r\nPer a més informació, podeu consultar el [FAQ del SIC](/sic/faq/) i amb més detall als [Manuals del SIC](/sic-documentacio/manuals/).\r\n\r\nEn cas de tenir qualsevol dubte, ens podeu enviar una consulta a través de SAU-Remedy (servei Framework SIC) o al correu: `oficina-tecnica.canigo.ctti@gencat.cat`.\r\n","objectID":"L25vdGljaWVzLzIwMTctMDYtMDctU0lDLVNJQ18yLjA="},"L25vdGljaWVzLzIwMTctMDctMDUtQ2FuaWdvLUxUUw==":{"date":1499212800000,"title":"Canigó. Versions LTS","description":"Nova política de versions per el framework Canigó","sections":["Notícies","home"],"categories":["canigo"],"key":"JULIOL2017","path":"/noticies/2017-07-05-Canigo-LTS","content":"Des de Canigó s'ha decidit introduir el concepte de **versions LTS (Long-Term Support)**, així com a dotar d'un significat molt concret als dígits destinats al versionatge del framework.\r\n\r\nLes [versions LTS](http://canigo.ctti.gencat.cat/blog/2017/06/versions_lts/) són un tipus especial de versions que estan designades per a ser suportades per un periode més llarg del normal, l'objectiu de les quals és ser el més estable possible. En el període de temps entre dues versions LTS apareixeran versions de Canigó que solucionin bugs, eliminin vulnerabilitats o afegeixen noves funcionalitats.\r\n\r\nLa versió Canigó 3.2.0 publicada el passat mes de Març és considerada com la primera (i actual) versió LTS del framework. És a partir d'aquesta versió que es comença aplicar la següent **política de versions**:\r\n\r\n* _4rt dígit_: publicació de correccions d'incidències o noves funcionalitats que la seva publicació no pot esperar a l'agrupació de correccions o noves funcionalitats (modificació 3er dígit) - _No planificades_ [Ex. 3.2.0.1]\r\n* _3er dígit_: correcció d'incidències, vulnerabilitats o noves funcionalitats que no introdueixen cap incompatibilitat - _Cada 3 mesos_ [Ex 3.2.1]\r\n* _2on dígit_: noves funcionalitats que introdueixen incompatibilitats, i que per tant, fan necessari adaptacions a les aplicacions - _Previsiblement cada 2 anys_\r\n\r\nRespecte al segon dígit, les versions imparelles es consideren internes destinades a proves (Ex. 3.3), i per tant, no seran aptes per a ser desplegades en entorns productius.\r\n\r\nAquest és el **roadmap** previst per Canigó:\r\n\r\n\r\n\r\n<script type=\"text/javascript\" src=\"https://www.gstatic.com/charts/loader.js\"></script>\r\n\r\n<script type=\"text/javascript\">\r\n  google.charts.load(\"current\", {packages:[\"timeline\"], 'language': 'es'});\r\n  google.charts.setOnLoadCallback(drawChart);\r\n  function drawChart() {\r\n    var container = document.getElementById('roadmap');\r\n    var chart = new google.visualization.Timeline(container);\r\n    var dataTable = new google.visualization.DataTable();\r\n\r\n\tdataTable.addColumn({ type: 'string', id: 'id' });\r\n    dataTable.addColumn({ type: 'string', id: 'Name' });\r\n    dataTable.addColumn({ type: 'date', id: 'Start' });\r\n    dataTable.addColumn({ type: 'date', id: 'End' });\r\n    dataTable.addRows([\r\n      [ '1','Canigo 3.2.0 LTS', new Date(2017, 2), new Date(2020, 2) ],\r\n      [ '2','Canigo 3.2.1', new Date(2017, 5), new Date(2017, 8) ],\r\n      [ '3','Canigo 3.2.2', new Date(2017, 8), new Date(2017, 11) ],\r\n\t  [ '4','Canigo 3.2.3', new Date(2017, 11), new Date(2018, 2) ],\r\n\t  [ '5','Canigo 3.2.4', new Date(2018, 2), new Date(2018, 5) ],\r\n\t  [ '6','Canigo 3.2.5', new Date(2018, 5), new Date(2018, 8) ],\r\n      [ '7','Canigo 3.2.6', new Date(2018, 8), new Date(2018, 11) ],\r\n\t  [ '8','Canigo 3.2.7', new Date(2018, 11), new Date(2019, 2) ],\r\n\t  [ '9','Canigo 3.4.0 LTS', new Date(2019, 2), new Date(2022, 2) ],\r\n\t  [ '10','Canigo 3.4.1', new Date(2019, 5), new Date(2019, 8) ],\r\n\t  [ '11','Canigo 3.4.2', new Date(2019, 8), new Date(2019, 11) ],\r\n\t  [ '12','Canigo 3.4.3', new Date(2019, 11), new Date(2020, 2) ],\r\n\t  [ '13','Canigo 3.4.4', new Date(2020, 2), new Date(2020, 5) ]]);\r\n\r\n    var options = {\r\n      timeline: { groupByRowLabel: false, showRowLabels: false },\r\n\t  colors: ['blue', 'green', 'green', 'green', 'green', 'green', 'green', 'green', 'blue','green','green','green','green']\r\n    };\r\n\r\n    chart.draw(dataTable, options);\r\n  }\r\n</script>\r\n\r\n<div id=\"roadmap\" style=\"height: 590px;\"></div>\r\n\r\n\r\n\r\nPel que fa al **suport**:\r\n\r\n* Les _versions LTS_ tindran un període de suport de fins a 3 anys. Per garantir la màxima estabilitat rebran totes les correccions d'incidències i vulnerabilitats, però no noves funcionalitats.\r\n\r\n* Les _versions actuals (o \"current\")_ tindran suport mentre siguin la versió actual, és a dir, de 3 mesos.\r\n\r\nCom es pot observar, cada 2 anys es publicarà una nova versió LTS (Ex. 3.4.0 LTS) amb tots els canvis (correcció d'incidències i vulnerabilitats, millores, noves funcionalitats) realitzats des de l'última versió LTS. Hi haurà un període de convivència d'un any entre versions LTS per tal que les aplicacions es puguin **actualitzar**.\r\n\r\nL'actualització de les aplicacions, sempre que es tracti d'un 4rt dígit (fix), serà directe. En el cas del 3er dígit o inferior, caldrà realitzar adaptacions. Per al 3er dígit les adaptacions seran mínimes, previsiblement només actualització de dependències amb mòduls Canigó.\r\n\r\nL'objectiu d'aquesta nova política de versionatge és evitar l'**obsolescència** tecnològica de les aplicacions que utilitzin Canigó forçant la seva actualització com a màxim cada 3 anys a la versió LTS actual.\r\n\r\nRespecte als nous desenvolupaments, es recomana adoptar la versió actual (current) i anar actualitzant fins que aparegui la següent versió LTS, per tal de tenir un suport continuat així com màxima estabilitat.\r\n\r\nPer qualsevol dubte respecte d'aquesta nova política de versionatge us podeu posar en contacte amb l'Oficina Tècnica de Canigó fent una petició al [JIRA CSTD](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN) o per correu a la [bústia](mailto:oficina-tecnica.canigo.ctti@gencat.cat).\r\n","objectID":"L25vdGljaWVzLzIwMTctMDctMDUtQ2FuaWdvLUxUUw=="},"L25vdGljaWVzLzIwMTctMDktMDgtU0lDLU5leHVzMw==":{"date":1504828800000,"title":"SIC. Actualització a Nexus 3","description":"Aquest mes d'Agost ha estat actualitzat el Nexus del SIC de la versió 2.11 a la 3.2.1. Gràcies a aquesta actualització es dóna suport a nous tipus de repositoris com Bower, gestor de paquets força utilitzat en la construcció de frontends estàtics","sections":["noticies","home"],"categories":["sic"],"key":"SETEMBRE2017","path":"/noticies/2017-09-08-SIC-Nexus3","content":"## Actualització del Nexus del SIC\n\nS'ha actualitzat la versió del repositori de dependències del SIC (Nexus) a la versió 3.2.1. Aquest increment de versió respon a la necessitat per part del SIC per gestionar i emmagatzemar nous tipus de dependències. Els tipus de repositoris que suporta el Nexus 3.2.1 són:\n\n1. Maven 2\n2. NuGet\n3. Registre privat de Docker\n4. NPM\n5. Bower\n6. PyPI\n7. Repositoris Ruby, RubyGems i Gem\n8. Repositoris Raw i webs estàtics Maven\n\nD'aquesta manera s'amplia el nombre de tecnologies que són integrables al SIC.\n\n### Canvis respecte a la versió anterior\n\nLes implicacions d'utilitzar aquesta nova versió per al SIC són:\n\n* **Fi de suport a repostoris Maven 1**: El format de repositoris Maven 1 s'ha anat abandonant per tota la comunitat en els darrers anys (com per exemple [Atlassian al 2012](https://www.atlassian.com/blog/archives/shutting-down-maven-1-repositories-on-maven-atlassian-com)). Amb aquesta actualització, el SIC deixa de donar suport a repositoris Maven 1.\n* **Integració de tecnologies Front-End de nova generació**: Amb el suport de repositoris *bower*, juntament amb els de *NPM* que el SIC ja suportava, es pot realitzar la construcció i desplegament de pràcticament qualsevol tipus de tecnologia Front-End.\n* **Els repositoris Maven ja no són navegables per HTML**: Els repositoris al Nexus 3 ja no són navegables com ho eren al Nexus 2. Es pot seguir descarregant els artefactes a partir de la URL d'on es troben, però les estructures de carpetes de repositoris i grups no són accessibles des del navegador web. L'alternativa és seguir el següent procediment:\n\t1. Accedir directament a l'aplicació web del Nexus (https://hudson.intranet.gencat.cat/nexus/). El Nexus 3 no està integrat amb GICAR i per tant no s'ha de fer login. Tindreu accés a tots els repositoris públics de forma anònima.\n\t2. Per a navegar, a partir de l'opció del menú de l'esquerra *Browse*. Es pot navegar a través *Assets* o *Components*.\n\t3. Per a fer cerques d'artefactes, cal utilitzar el buscador a la part superior central de l'aplicació:\n\n![Exemple de cerca al Nexus 3](/images/news/SIC-cerca-Nexus3.png \"Exemple de cerca al Nexus 3\")\n\nPer a més detalls, teniu tota la informació disponible al [Manual d'Usuari del SIC](http://canigo.ctti.gencat.cat/related/sic/2.0/manual-usuari.pdf).\n\n","objectID":"L25vdGljaWVzLzIwMTctMDktMDgtU0lDLU5leHVzMw=="},"L25vdGljaWVzLzIwMTctMTEtMjktSm9icy1hdXRvbWF0aWNzLXBlci1hLVBSRS1pLVBSTw==":{"date":1511913600000,"title":"SIC. Jobs automàtics per a PRE i PRO","description":"Des del passat mes de novembre, el SIC està preparat per oferir jobs de desplegament automàtic als entorns de Preproducció i Producció.","sections":["Notícies","home"],"categories":["sic"],"key":"DESEMBRE2017","path":"/noticies/2017-11-29-Jobs-automatics-per-a-PRE-i-PRO","content":"Des del passat mes de novembre, el SIC està preparat per oferir jobs de desplegament automàtic als entorns de Preproducció i Producció. Aquests jobs, executats per usuaris de CPD/LDT, automatitzen les tasques realitzades pels tècnics aportant robustesa, fiabilitat i traçabilitat en els desplegaments d'aplicacions en aquests entorns.\n\nA continuació es compara el funcionament actual amb el nou funcionament que es pot adoptar gràcies als desplegaments automàtics a PRE i PRO.\n\n## Funcionament actual\n\nSi recordem el funcionament dels jobs pipeline que disposàvem fins ara amb el SIC 2.0 en entorns no containeritzats, era el següent:\n\n<div style=\"width:90%;margin:0 auto;\"><img style=\"width: 90%; height: auto\" src=\"/images/news/Pipeline.png\" alt=\"Pipeline amb jobs semiautomàtics\" title=\"Pipeline amb jobs semiautomàtics\"></img></div>\n\n\nCom es pot observar, es tracta d'una pipeline que en els entorns de PRE i PRO hi ha aturades per a que es pugui realitzar el desplegament externament. La pipeline crea l'esborrany de la petició, ubica els artefactes a desplegar en un SFTP on els tècnics de CPD poden recollir-los i s'espera fins que els desenvolupadors indiquen si el desplegament s'ha realitzat correctament o hi ha hagut algun problema i s'ha hagut de cancel·lar. Al SIC, aquest tipus de desplegament els anomenem **semiautomàtics**.\n\n## Nou funcionament\n\nLes aplicacions que optin per disposar d'un desplegament automatitzat a PRE i PRO tindran una pipeline amb el següent patró:\n\n<div style=\"width:90%;margin:0 auto;\"><img style=\"width: 90%; height: auto\" src=\"/images/news/PipelineJobsPREiPRO.png\" alt=\"Pipeline amb jobs automàtics\" title=\"Pipeline amb jobs automàtics\"></img></div>\n\nTal i com es pot observar al segon esquema, l'aturada per la creació del Remedy es continua realitzant. El que varia respecte al primer esquema és que hi apareixen dues petites pipelines de desplegament per als tècnics de CPD.\n\nFins ara els tècnics, quan els hi arribava el tiquet Remedy i estaven dins de la finestra vàlida de desplegament, realitzaven el desplegament a mà.\n\nAmb aquest nou model, els tècnics tenen una mini-pipeline per entorn per a la realització del desplegament. Al SIC, anomenem a aquest tipus de desplegaments com a **automàtics**.\n\nAmb aquest nou funcionament, transparent per al proveïdor d'aplicacions, els proveïdors d'infraestructura podran beneficiar-se de tenir jobs automàtics de desplegament per als entorns de PRE i PRO.\n\n## Aspectes que cal tenir en consideració\n\nAquests nous jobs pipeline per CPD tenen les següents capacitats i limitacions:\n\n* Aquests jobs de desplegament són compatibles amb plataformes en clúster i/o plataformes amb múltiples servidors per capa (servidors múltiples sense estar clusteritzats). Actualment, però, aquest sistema és compatible amb plataformes Tomcat. S'aniran integrant clústers d'altres tipus de servidors d'aplicacions a mesura que es vagin integrant aplicacions al SIC.\n* El job de CPD no realitza la marxa enrere d'entorns de BBDD. Caldrà que l'operari de CPD realitzi un backup previ de la BBDD abans de realitzar el desplegament.\n* No es podrà realitzar cap manteniment als servidors mentre s'està realitzant el desplegament. Els servidors podrien estar indisponibles en el moment de desplegament, fet que provocaria l'execució de la marxa enrere. Si durant la marxa enrere el servidor segueix estant indisponible, el job acabarà amb un error.\n* Com sempre, caldrà notificar al SIC si hi ha canvis en la infraestructura (s'afegeixen, es modifiquen o es donen de baixa servidors).\n* El SIC s'encarrega de la custòdia de l'últim artefacte desplegat correctament des del propi SIC. La marxa enrere es realitzarà utilitzant aquest artefacte. \n* En el cas que s'hagi de fer un desplegament sense estar el SIC disponible, es podrà realitzar manualment, però caldrà emmagatzemar a l'espai d'artefactes del SIC aquest darrer artefacte per a que sigui tingut en compte en la marxa enrere.\n\nEn unes setmanes, oferirem una formació a Lots d'Aplicacions i CPD/LDT per tal de cobrir tant aquesta nova funcionalitat com futures que en vindran. En breu, tant els proveïdors d'aplicacions com els d'infraestructura rebran una convocatòria.\n\nPer a qualsevol dubte o aclariment sobre el funcionament dels desplegaments automàtics a PRE i PRO, podeu obrir una petició de Consulta a 'Framework SIC' via SAU-Remedy.\n","objectID":"L25vdGljaWVzLzIwMTctMTEtMjktSm9icy1hdXRvbWF0aWNzLXBlci1hLVBSRS1pLVBSTw=="},"L25vdGljaWVzLzIwMTctMTAtMTAtU0lDLUludGVyYWNjaW9ucy1KZW5raW5zLVJlbWVkeQ==":{"date":1507593600000,"title":"SIC. Interacció entre Jenkins i Remedy","description":"Degut al nombre de consultes rebudes aquest mes sobre la interacció entre Jenkins i Remedy a l'hora de generar canvis, hem creat aquest article on s'exposa com es relacionen aquests dos elements.","sections":["noticies","home"],"categories":["sic"],"key":"OCTUBRE2017","path":"/noticies/2017-10-10-SIC-Interaccions-Jenkins-Remedy","content":"## Remedy al SIC\n\nDes d'inicis de 2016, el SIC va habilitar una nova forma de comunicar els canvis originats per evolutius d'aplicacions mitjançant la creació d'un draft de CRQ a Remedy. D'aquesta manera el SIC s'adaptava al creixent nombre d'aplicacions que s'integrava amb Remedy; deixant progressivament en desús el procediment d'enviament de correus a CPD per a peticions de canvi.\n\n### Procediment de creació d'un Draft a Remedy a través d'una CRQ\n\nActualment, la interacció amb Remedy es produeix en els jobs/stages que incloguin un **desplegament semiautomàtic**. Un **desplegament semiautomàtic** és aquell que el SIC hi proporciona els artefactes generats en una fase o un job previ però alhora requereix la intervenció de CPD per tal de realitzar el desplegament. Per tal de lligar la intervenció de CPD amb el SIC, és el propi SIC el que crea un Draft a Remedy i hi informa textualment on ha dipositat els artefactes per tal que CPD els pugui recollir.\n\nEl procediment actual quan es crea un Draft a Remedy és el següent en els desplegaments semiautomàtics:\n\n#### 1. S'invoca el job de Jenkins\n\nJa sigui realitzant un push a la branca master del projecte GitLab (mètode SIC 2.0), ja sigui invocant-lo directament (mètode SIC 1.0), el job comença l'execució identificant l'usuari que ha disparat l'execució del job.\n\n<div style=\"width:90%;margin:0 auto;\"><img style=\"width: 90%; height: auto\" src=\"/images/news/invocacioJobs.png\" alt=\"Invocació de Jobs al SIC\" title=\"Invocació de Jobs al SIC\"></img></div>\n\n#### 2. Invocació a Remedy\n\nDesprés de realitzar les tasques necessàries, el job invoca al Web Service de Remedy per tal de crear el *Change Request* (CRQ en endavant) en estat Draft.\n\nJenkins té un usuari genèric per autenticar-se amb aquest web service i, entre d'altres paràmetres, ha d'indicar un usuari com a **creador** de la CRQ. Jenkins assigna l'usuari que ha identificat en el pas anterior com a usuari creador.\n\n<div style=\"width:90%;margin:0 auto;\"><img style=\"width: 90%; height: auto\" src=\"/images/news/InvocacioWSRemedy.png\" alt=\"Invocació al Web Service de Remedy\" title=\"Invocació al Web Service de Remedy\"></img></div>\n\n#### 3. Funcionalitat interna a Remedy\n\nEl Web Service de Remedy valida que l'usuari informat té permisos per poder crear CRQs en el servei sol·licitat. Un cop l'ha validat, el Web Service de Remedy obté un llistat de tots els coordinadors de canvi vàlids i n'agafa un a l'atzar. Finalment, acaba creant el Draft.\n\n<div style=\"width:90%;margin:0 auto;\"><img style=\"width: 90%; height: auto\" src=\"/images/news/tasquesWSRemedy.png\" alt=\"Tasques internes del WS de Remedy\" title=\"Tasques internes del WS de Remedy\"></img></div>\n\nRecordeu que podeu consultar aquesta i altra informació al [Manual d'Usuari del SIC](http://canigo.ctti.gencat.cat/related/sic/2.0/manual-usuari.pdf).\n\n","objectID":"L25vdGljaWVzLzIwMTctMTAtMTAtU0lDLUludGVyYWNjaW9ucy1KZW5raW5zLVJlbWVkeQ=="},"L25vdGljaWVzLzIwMTctMTEtVXNfVG9rZW5zX0pXVF9HSUNBUg==":{"date":1510272000000,"title":"Ús de JWT (JSON Web Token) amb GICAR","description":"Funcionament del servei de seguretat de Canigó amb tokens JWT i GICAR","sections":["noticies","home"],"categories":["canigo"],"key":"NOVEMBRE2017","path":"/noticies/2017-11-Us_Tokens_JWT_GICAR","content":"La versió de Canigó 3.2 permet treballar amb [JWT](https://en.wikipedia.org/wiki/JSON_Web_Token) (JSON Web Tokens). Concretament Canigó utilitza la llibreria [Java JWT] (https://java.jsonwebtoken.io/). Aquesta llibreria permet, un cop realitzada l'autenticació de l'usuari, generar un token amb les dades bàsiques d'aquest usuari que serà enviat pel navegador web a la capçalera HTTP per cada petició. El backend Canigó 3.2 sap que les peticions rebudes amb aquest token són d'un usuari correctament autenticat, ja que aquest backend és l'únic que el pot haver generat.\r\n\r\nEn el cas que es vulgui integrar una aplicació Canigó 3.2 que utilitza JWT amb GICAR com a mètode d'autenticació, s'ha de tenir en compte que no és necessari (i no és recomanable) que GICAR intercepti totes les peticions a cada servei REST que exposi l'aplicació. En cas contrari, se sobrecarregarà GICAR amb moltes peticions el que pot afectar també al rendiment de l'aplicació. GICAR només hauria d'interceptar l'accés a la SPA (Single Page Application), punt d'entrada a l'aplicació, mentre que els serveis REST queden protegits amb el token JWT. Només en cas que aquest token expiri, caldrà tornar a autenticar amb GICAR. L'aplicació Canigó 3.2, un cop rebi la capçalera HTTP de GICAR amb un usuari vàlid, generarà un nou token.\r\n\r\nEl funcionament del sistema és el següent:\r\n\r\n<div style=\"width:90%;margin:0 auto;\"><img style=\"width: 70%; height: auto\" src=\"/images/news/diagrama_sequencia_gicar_jwt.png\" alt=\"Diagrama seqüencia GICAR-JWT\" title=\"Diagrama seqüencia GICAR-JWT\"></img></div>\r\n\r\n- L'usuari accedeix a la SPA. GICAR intercepta la petició i redirigeix a l'usuari a la pantalla de login.\r\n- L'usuari realitza el login, i l'aplicació, una vegada autenticat a GICAR, genera un token JWT amb les dades de l'usuari logat que proporciona al client.\r\n- Cada cop que es realitza una petició a un servei REST s'ha de proporcionar aquest token.\r\n- Si el servidor rep una petició REST sense tenir un token vàlid, aquest retorna un error de \"no autenticat\" (Error HTTP 401).\r\n- El client quan rep un error HTTP 401 ha de redirigir a l'usuari a la pantalla de login de GICAR.\r\n\r\nAl següent [enllaç](/canigo-documentacio-versions-3x-core/modul-seguretat/) es pot consultar més informació sobre el funcionament del servei de Seguretat de Canigó.\r\n","objectID":"L25vdGljaWVzLzIwMTctMTEtVXNfVG9rZW5zX0pXVF9HSUNBUg=="},"L25vdGljaWVzLzIwMTgtMDEtMTAtT1RDYW5pZ28tQmFsYW5jLTIwMTc=":{"date":1515542400000,"title":"Oficina Tècnica de Canigó i Suport Cloud. Balanç 2017","description":"Evolució dels serveis de l'Oficina Tècnica de Canigó i Suport Cloud a l'any 2017","sections":["noticies","home"],"categories":["sic, canigo, sgde","cloud"],"key":"GENER2018","path":"/noticies/2018-01-10-OTCanigo-Balanc-2017","content":"A continuació es mostren les fites aconseguides el 2017 segons ordre cronològic:\r\n\r\n<center><iframe src='https://cdn.knightlab.com/libs/timeline3/latest/embed/index.html?source=1se11kf-cofPGpMC7IQgwIcO3i1Lt_0SbVWjRMKZpHMQ&font=Georgia-Helvetica&lang=ca&initial_zoom=2&height=500' width='100%' height='500' webkitallowfullscreen mozallowfullscreen allowfullscreen frameborder='0'></iframe></center>\r\n\r\nA mode resum, destacaríem les següents:\r\n\r\n### **Suport Cloud**\r\n\r\n- Posada en servei de la plataforma de contenidors on-premise **SwarmMe**\r\n- Posada en servei de la plataforma de contenidors on-premise **AppAgile**\r\n- Migració d'aplicacions del servei Single and Scalable Group Container Service de Bluemix al nou **Bluemix Container Service** basat en Docker i Kubernetes\r\n- Millora d'imatges Docker estàndard de gencatcloud, ara basades en la distribució de Linux **Alpine**, més segures i de tamany més reduït\r\n- Implementació de nova imatge Docker Apache-Shibboleth per la integració amb **GICAR**, tant a cloud privat com públic\r\n- Suport al desplegament d'aplicacions en les diferents plataformes de contenidors i cloud públic en catàleg: AppAgile, SwarmMe, Azure i Bluemix\r\n\r\n\r\n### SIC (Servei d'Integració Continua)\r\n\r\n- Publicació del **SIC 2.0**, el qual inclou:\r\n\t- Integració al SIC del nou sistema de gestió de versions de codi (**Git**).\r\n\t- Integració de la seguretat del SIC amb **GICAR**.\r\n\t- **Autoservei d'usuaris** al SIC, mitjançant el qual els usuaris de CTTI i de CPD/LDT tenen accés de forma automàtica i els usuaris de Lot d'aplicacions poden concedir-se permisos dins el mateix lot i àmbit.\r\n\t- Gràcies a la incorporació de l'**Autoservei de repositoris** al SIC, els usuaris de lot d'aplicacions poden crear-se de forma autònoma els seus repositoris.\r\n\t- Integració de jobs en format **pipeline** al SIC.\r\n\t- Creació d'un **Sistema de Gestió de Binaris**, mitjançant el qual s'evita l'antipatró de dispositar artefactes als sistemes de versions de codi.\r\n- Integració del SIC amb les plataformes de contenidors **Docker Bluemix Container Service (Kubernetes)** i **AppAgile (Openshift)**\r\n- Integració del SIC amb **Bluemix Cloud Foundry PaaS**\r\n- Participació de l'equip del SIC en el procés d'alta de **noves solucions**\r\n- Pas a **HTTPS** de la totalitat de serveis del SIC 2.0\r\n- Actualització de versió del servei **Nexus** a la versió 3.2.1\r\n- Integració d'un sistema de **desplegament automàtic** als entorns de PRE i PRO (amb tall de servei)\r\n\r\n\r\n### **Canigó**\r\n\r\n- Publicació de [**Canigó 3.2.0**](http://cstd.ctti.gencat.cat/jiracstd/browse/CAN/fixforversion/10450) amb suport a arquitectures HTML5/JS+REST: Spring Boot, Swagger, JWT,...\r\n- Publicació de [**Canigó 3.2.1**](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN/fixforversion/10461) amb actualització de llibreries, suport a la càrrega de propietats en jars, millores i resolució d'incidències\r\n- Publicació de [**Canigó 3.2.2**] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN/fixforversion/10463) amb millores per donar suport a les best practices per la implementació d'APIs REST, actualització de llibreries, millores i resolució d'incidències\r\n- Publicació de [**Canigó 3.2.3**] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN/fixforversion/10464) amb la publicació de jars amb test unitaris per als mòduls core, web-rest, persistència i seguretat\r\n- Nova política de [**versions LTS**] (/noticies/2017-07-05-Canigo-LTS/) pel Framework Canigó\r\n- Certificació Canigó 3.2 en **JBoss EAP 6.4**\r\n- Publicació de la [**versió 2.0.0 del entorn de desenvolupament de Canigó**] (/canigo/entorn-desenvolupament/) amb actualització de programari\r\n\r\n\r\n### **SGDE (Servei de Gestió del Document Electrònic)**\r\n\r\n- STD (Servei de Transformació de Documents): **augmentat el límit de mida de documents** per les operacions de composició\r\n- eFormularis: **deprecada versió v8** del WS de ServeisInvocacio\r\n- STD (Servei de Transformació de Documents): composició de documents amb **diferents orientacions de pàgina**\r\n\r\nPer a més informació sobre els futurs evolutius planificats, podeu consultar el [Roadmap d'arquitectura del CTTI](http://canigo.ctti.gencat.cat/centre-de-suport/roadmap/).","objectID":"L25vdGljaWVzLzIwMTgtMDEtMTAtT1RDYW5pZ28tQmFsYW5jLTIwMTc="},"L25vdGljaWVzLzIwMTctMTItMTEtQ2FuaWdvLUludGVncmFjaW8tcGlwZWxpbmVzLVNJQw==":{"date":1512950400000,"title":"Canigó. Integració amb SIC 2.0","description":"Les aplicacions Canigó poden ser fàcilment integrables al SIC 2.0, tant per la seva custodia de codi al Git, com per la seva construcció i desplegament amb Jenkins","sections":["noticies"],"categories":["canigo"],"key":"DESEMBRE2017","path":"/noticies/2017-12-11-Canigo-Integracio-pipelines-SIC","content":"Les aplicacions Canigó poden ser fàcilment integrables al [**SIC (Servei d'Integració Continua)**](http://canigo.ctti.gencat.cat/sic/), tant per la seva custodia de codi al Git, com per la seva construcció i desplegament amb Jenkins. Des del CS Canigó s'ha redactat aquest [HowTo](http://canigo.ctti.gencat.cat/howtos/2017-12-howto-integracio_canigo_sic/) on s'explica pas a pas com fer aquesta integració.\r\n\r\nA mode de resum, els principals aspectes a tenir en compte són els següents:\r\n\r\n* Per la custodia de codi al **Git**...\r\n\r\n  * Cal dispossar de permissos en el projecte per el qual es vol custodiar el codi. Més informació respecte a l'Autoservei d'usuaris al Gitlab al següent [enllaç](http://canigo.ctti.gencat.cat/noticies/2017-07-18-SIC-Autoservei-usuaris-SIC2.0/)\r\n  \r\n  * Cal connectar l'aplicació Canigó local amb el projecte del Gitlab i pujar els canvis sempre a la branca principal (master). Recordar que el Git del SIC no és un repositori de desenvolupament, només s'hauran de pujar els canvis quan es tingui una versió \"releaseable\" de l'aplicació\r\n  \r\n  * Cal configurar l'aplicació per a que ignori la carpeta amb el resultat de la construcció (Ex. /target), meta-dades de l'Eclipse o IDE utilitzat, i binaris que puguin haver-hi en el codi del projecte. Aquests binaris que formen part de l'aplicació han d'ubicar-se al [Repositori de Binaris del SIC](http://canigo.ctti.gencat.cat/noticies/2017-07-05-SIC-Gestio-binaris/)\r\n\r\n* Per la construcció i desplegament amb una pipeline al **Jenkins**...\r\n\r\n  * Cal configurar el procés de construcció Maven per a que auto-configuri la versió de l'aplicació al descriptor \"sic.yml\" que ha d'ubicar-se a ```\"<app-canigo>/sic/sic.yml\"``` (Més detall en el [HowTo](http://canigo.ctti.gencat.cat/howtos/2017-12-howto-integracio_canigo_sic/)).\r\n  \r\n    **sic.yml**\r\n    ```\r\n    version: 1.0.0\r\n    ...\r\n    ```\r\n    A la propera versió de Canigó que s'alliberi, aquesta configuració Maven ja vindrà pre-establerta.\r\n    Podeu trobar més detal del fucionament de descriptor \"sic.yml\" al punt 3.3.3 del [Manual d'Usuari del SIC](http://canigo.ctti.gencat.cat/related/sic/2.0/manual-usuari.pdf)\r\n  \r\n  * En cas que el frontend de l'aplicació es desenvolupi en un projecte apart del de backend i es desplegui també de forma independent (opció recomanada), cal també incorporar aquest descriptor ```\"<frontend>/sic/sic.yml\"``` i idealment automatitzar la seva generació\r\n  \r\n  * Cal especificar a l'equip del SIC les passes per la construcció i desplegament de l'aplicació per a que configurin la pipeline al Jenkins. En el cas del backend Canigó, normalment l'empaquetat estàndard Maven, i per la part de frontend dependrà molt de la tecnologia utilitzada (Angular, React, ...) les quals utilitzaran gestors de paquets com [npm](https://www.npmjs.com/). Aquesta petició de suport s'ha de fer via Remedy al servei \"FRAMEWORK SIC\"\r\n\r\nPer qualsevol dubte relatiu a la integració al SIC d'aplicacions Canigó, us podeu posar en contacte amb el CS Canigó enviant un correu a [oficina-tecnica.canigo.ctti@gencat.cat](mailto:oficina-tecnica.canigo.ctti@gencat.cat) o bé fent-nos arribar una petició de consulta/suport al [CSTD](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN/).\r\n","objectID":"L25vdGljaWVzLzIwMTctMTItMTEtQ2FuaWdvLUludGVncmFjaW8tcGlwZWxpbmVzLVNJQw=="},"L25vdGljaWVzLzIwMTgtMDItMTQtQ2FuaWdvLVN3YWdnZXItaS1TT0FQLVVJ":{"date":1518566400000,"title":"Canigó. Jocs de proves API REST","description":"Des de Canigó 3.2 es dona suport a la implementació d'APIs REST. Poder generar un joc de proves automatitzat a partir del contracte de l'API REST és possible gràcies a eines com SOAP UI","sections":["Notícies","home"],"categories":["canigo"],"key":"FEBRER2018","path":"/noticies/2018-02-14-Canigo-Swagger-i-SOAP-UI","content":"Existeixen diferents estàndards per la definició del contracte d'una API REST. Els més populars són [WADL](http://www.w3.org/Submission/wadl/) i [Swagger](https://swagger.io/) (OpenAPI Specification).\r\n**Swagger** és un framework molt útil, no només per a descriure una API REST sinó també per produir, consumir i poder visualitzar-la.\r\n\r\nDes de Canigó 3.2 es dóna suport a APIs REST gràcies a Spring 4 i el seu MVC (Model-View-Controller), i [Springfox](http://springfox.github.io/springfox/). Springfox és una implementació de l'especificació Swagger2.\r\n\r\nSwagger proporciona una UI (User Interface) amb un format \"human-readable\" de les APIs REST. L'aspecte que té en una aplicació Canigó 3.2 és la següent:\r\n\r\n*\\<base-url\\>/canigo-api.html*\r\n\r\n![canigo-api](/images/news/canigo-api.png)\r\n\r\nGràcies a aquesta UI els desenvolupadors poden conèixer i provar les APIs.\r\n\r\nA més d'aquesta UI, és possible obtenir l'especificació de l'API en format JSON.\r\n\r\n*\\<base-url\\>/api/v2/api-docs*\r\n\r\n![swagger-json](/images/news/swagger-json.png)\r\n\r\nAquesta definició de l'API en format JSON ens permet generar jocs de proves per la validació del seu funcionament. \r\n\r\n[SOAP UI](https://www.soapui.org/) és una eina molt popular per la realització de tests tant REST com SOAP, i és a partir de la versió [5.2.1+](https://www.soapui.org/news/soapui-5-2-1-released.html) que dona suport a la importació de definicions Swagger.\r\n\r\nEn aquest comunicat podeu trobar un [How-To](/howtos/2018-02-howto-swagger_soapui/) amb el detall per la generació d'aquests jocs de proves SOAP UI a partir de l'especificació Swagger.\r\n\r\nAmb el joc de proves generat, és possible l'automatització de la seva execució mitjançant la utilitat [TestRunner](https://www.soapui.org/test-automation/running-functional-tests.html) que incorpora SOAP UI. Això pot permetre, en entorns d'integració continua dels proveïdors d'aplicacions, automatitzar aquestes proves en pipelines de Jenkins. D'aquesta manera, canvis continus en el codi de les APIS poder ser validats de forma ràpida abans d'alliberar una versió estable de l'aplicació al SIC.\r\n","objectID":"L25vdGljaWVzLzIwMTgtMDItMTQtQ2FuaWdvLVN3YWdnZXItaS1TT0FQLVVJ"},"L25vdGljaWVzLzIwMTgtMDMtMDUtU0lDLVV0aWxpdHphci1icmFuY2EtbWFzdGVy":{"date":1520208000000,"title":"SIC. Branca Master al Git del SIC","description":"Arrel les consultes rebudes les darreres setmanes, creiem convenient publicar aquest article on s'explica els usos de les branques al SIC.","sections":["Notícies","home"],"categories":["sic"],"key":"FEBRER2018","path":"/noticies/2018-03-05-SIC-Utilitzar-branca-master","content":"Arrel les consultes rebudes les darreres setmanes, creiem convenient publicar aquest article on s'explica els usos de les branques al SIC.\n\n## Models de gestió de branques en repositoris Git\n\nHi ha un gran ventall d'aproximacions que es poden conjugar per a la gestió de branques d'un repositori git:\n\n1. Ús d'una sola branca, seguint el principi del [trunk-based (o master-based) development](https://continuousdelivery.com/foundations/continuous-integration/).\n2. Ús d'un sistema de branques procedimentat en el que hi ha branques fixes i branques temporals, com per exemple [GitFlow](http://nvie.com/posts/a-successful-git-branching-model/).\n3. Ús de branques no procedimentat.\n\n## Model adoptat al SIC\n\nDins d'aquest gran amalgama de possibilitats, des del SIC s'estableix utilitzar únicament la branca **master**, és a dir, és un model basat en la primera opció. L'adopció d'aquest model respon a l'ús que se'n fa del repositori Git del SIC: és un repositori de lliurables.\n\nLes pipelines, que actualment només construeixen i despleguen, en el futur realitzaran altres tasques:\n\n* Anàlisi de la qualitat del codi\n* Anàlisi de vulnerabilitats\n* Proves d'acceptació, de fum, etc.\n\nMoltes d'aquestes tasques només tenen sentit quan es tracta de lliurables.\n\nPer aquests motius, al SIC només els canvis a la branca **master** són els que inicien l'execució de la pipeline associada a l'aplicació. Els canvis a la resta de branques són ignorats per Jenkins.\n\n## Model que ha d'adoptar el proveïdor d'aplicacions\n\nEl model que es recomana seguir des del SIC en l'entorn de desenvolupament del proveïdor d'aplicacions és el mateix model que adopta el SIC: una sola branca (amb una metodologia **trunk-based**).\n\nS'han actualitzat el [FAQ](http://canigo.ctti.gencat.cat/sic/faq/), el [Manual d'Usuari](http://canigo.ctti.gencat.cat/related/sic/2.0/manual-usuari.pdf) i [Manual d'Integració](http://canigo.ctti.gencat.cat/related/sic/2.0/manual-integracio.pdf) tot indicant que únicament la branca master és la que té associades pipelines de Jenkins.\n\nSi teniu cap dubte al respecte, podeu obrir una [consulta](http://canigo.ctti.gencat.cat/howtos/2018-01-howto-obrir-peticions-SIC-a-autoservei-Remedy/#consulta) a SAU Remedy.\n","objectID":"L25vdGljaWVzLzIwMTgtMDMtMDUtU0lDLVV0aWxpdHphci1icmFuY2EtbWFzdGVy"},"L25vdGljaWVzLzIwMTgtMDMtMjMtQ2FuaWdvLUNvbmZpZ3VyYWNpby1tdWx0aWVudG9ybi1TUEE=":{"date":1522800000000,"title":"Canigó. Configuració multi-entorn en SPAs","description":"Amb la separació de frontend i backend que es recomana aplicar com a patró d'arquitectura en aplicacions Canigó, i per tal d'acomplir els requeriments d'una única construcció no depenent de l'entorn que s'imposa des del SIC, cal donar una solució de configuració multi-entorn per la part de frontend","sections":["Notícies","home"],"categories":["canigo"],"key":"ABRIL2018","path":"/noticies/2018-03-23-Canigo-Configuracio-multientorn-SPA","content":"Amb la separació de frontend i backend que es recomana aplicar com a patró d'arquitectura en aplicacions Canigó, i per tal d'acomplir els requeriments d'una **única construcció no depenent de l'entorn** que s'imposa des del SIC (Servei d'Integració Continua), cal donar una solució de configuració multi-entorn per la part de frontend. Aquest frontend en les aplicacions web actuals típicament seran SPA (Single Page Application).\n\nA continuació s'enumeren diferents opcions:\n\n<br />\n\n#### Opció 1) Configuració embeguda al codi\n\nConfiguració única \"hardcoded\" al codi javascript de la SPA\n\n*Avantatges*\n\n* És la solució més simple\n\n*Inconvenients*\n\n* Es pot estar exposant informació sensible al repositori de codi\n* Per desplegar a cada entorn cal modificar el codi font amb la configuració específica\n* No dona suport a configuració multi-entorn\n\n*Conclusió*\n\nPot ser una configuració vàlida per un pilot però no per una aplicació que hagi de desplegar-se en entorns productius\n\n<br />\n\n#### Opció 2) Configuració per domini d'aplicació\n\nConfiguració multi-entorn \"hardcoded\" al client, i obtinguda en funció del domini de l'aplicació.\n\nPer exemple:\n\n- si el domini de l'aplicació és \"preproduccio.app.gencat.cat\", s'obtindria la configuració corresponent a l'entorn de preproducció\n- en cas de no portar el prefix preproduccio, sabríem que estem al de producció\n\nAquesta lògica hauria d'estar al propi codi font, ja sigui en el de la mateixa SPA, o bé en un mòdul reusable entre diferents SPAs.\n\n*Avantatges*\n\n* És una solució relativament fàcil d'aplicar\n* Multi-entorn, per desplegar a cada entorn no cal modificar el codi font amb la configuració específica\n\n*Inconvenients*\n\n* Es pot estar exposant informació sensible al repositori de codi\n* Un canvi de configuració a qualsevol entorn suposa tenir que reconstruir la SPA\n\n*Conclusió*\n\nTot i ser millor que l'opció 1), té mancances no assumibles per ser adoptada com a solució\n\n<br />\n\n#### Opció 3) Obtenir la configuració mitjançant una crida REST al backend\n\nPer aplicar aquesta solució cal que el backend exposi un endpoint d'on obtenir la configuració específica per l'entorn que requereixi la SPA. Per exemple, en un backend Canigó podria ser https://domini/api/frontendProperties.\nAquesta crida s'hauria de fer de forma autenticada (Ex. JWT) un cop l'usuari ha fet login a l'aplicació i ha obtingut el token d'accés.\n\n*Avantatges*\n\n* L'accés a la configuració és segur\n* És una solució relativament fàcil d'aplicar\n\n*Inconvenients*\n\n* L'entrada a l'aplicació té el delay que suposa fer aquesta crida al backend per obtenir la configuració\n\n*Conclusió*\n\nEl principal inconvenient que té aquesta solució és el delay que s'afegeix en la càrrega de la SPA\n\n<br /><br />\nTot i que poden haver-hi altres solucions, l'**opció 3)** es considera com a vàlida ja que compleix els requisits de multi-entorn i mínims de seguretat. És una solució força natural a aplicar en una SPA amb un backend Canigó 3.2. Per a més detall, des del CS Canigó hem preparat el [HowTo - Configuració multi-entorn a una SPA amb backend Canigó](http://canigo.ctti.gencat.cat/howtos/2018-04-howto-frontend-multientorn/).\n","objectID":"L25vdGljaWVzLzIwMTgtMDMtMjMtQ2FuaWdvLUNvbmZpZ3VyYWNpby1tdWx0aWVudG9ybi1TUEE="},"L25vdGljaWVzLzIwMTgtMDMtMjMtU0lDLUNhbnZpLXNpc3RlbWEtcGVybWlzb3M=":{"date":1521763200000,"title":"SIC. Canvi del sistema de permisos al SIC","description":"Durant el mes d'abril, es modificarà el sistema de permisos del SIC per tal de simplificar l'operativa de l'Autoservei. L'anterior model de seguretat quedarà obsolet i s'aplicarà el model de seguretat 2018.","sections":["Notícies","home"],"categories":["sic"],"key":"ABRIL2018","path":"/noticies/2018-03-23-SIC-Canvi-sistema-permisos","content":"Durant el mes d'abril, es modificarà el sistema de permisos del SIC per tal de simplificar l'operativa de l'Autoservei. L'anterior model de seguretat quedarà obsolet i s'aplicarà el **model de seguretat 2018**.\n\n## Audiència\n\nAquest canvi en el sistema de permisos afecta els proveïdors d'aplicacions. Us recordem que els proveïdors d'aplicacions són els únics que gestionen els permisos amb la modalitat d'autoservei. La resta d'usuaris del SIC (CPD, LDT, personal CTTI) tenen els seus permisos predefinits i només el SIC els pot modificar.\n\n## Canvi en l'estructura de permisos\n\n### Model de seguretat 2014\n\nFins ara, l'actual model de seguretat en el que es basava el SIC seguia una estructura bidimensional, en el que una dimensió era la definició d'àmbits a data de 2014 i l'altra dimensió es basava en el model de proveïdors de lot/fora lot:\n\n<div style=\"width:90%;margin:5px auto;\"><img style=\"width: 90%; height: auto\" src=\"/images/news/SIC-model-seguretat-2014.png\" alt=\"Model de seguretat definit el 2014\" title=\"Model de seguretat definit el 2014\"></img></div>\n\nAmb el llançament de l'Autoservei d'Usuaris al SIC, aquest model de seguretat s'ha tornat poc pràctic:\n\n* Els àmbits en aquest model són estàtics. Al llarg d'aquests anys han aparegut nous departaments i d'altres han canviat de nom, s'han agrupat o s'han descompost en d'altres. Avui dia, és difícil per al proveïdor d'aplicacions determinar a quin àmbit del SIC correspon un codi d'aplicació.\n* D'altra banda, l'estructuració de proveïdors d'aplicacions amb lots no sempre és útil, ja que a vegades hi ha subcontractacions d'un lot a un altre o intervé més d'un proveïdor en un sol codi d'aplicació.\n\n### Model de seguretat 2018\n\nEl nou model pretén resoldre els problemes que ocasionava l'anterior model i, a més, se simplifica l'estructura de grups de seguretat. Passem a tenir model unidimensional de grups **basat en el codi d'aplicació**.\n\n<div style=\"width:90%;max-width: 800px;margin:5px auto;\"><img style=\"width: 90%;height: auto\" src=\"/images/news/SIC-model-seguretat-2018.png\" alt=\"Nou model de seguretat (2018)\" title=\"Nou model de seguretat (2018)\"></img></div>\n\nAquest nou model ens aporta una sèrie de beneficis:\n\n* L'increment en la finor de la granularitat ens aporta **més detall** i **més versatilitat**.\n* S'elimina la dependència que tenien els grups de seguretat amb els àmbits del SIC. Futurs canvis en l'organització de la Generalitat no afectaran el model de seguretat del SIC.\n* Els release managers de cada codi d'aplicació podran incloure els usuaris que considerin pertinents, siguin del seu lot o d'un altre.\n\n### Activació del nou model\n\nTan bon punt com entri en vigor el nou model de seguretat, estarà disponible la nova versió de la documentació relativa al sistema de permisos del SIC:\n\n* Els articles que ja parlaven dels sistemes de permisos del SIC 2.0:\n\t* [Procediment de concessió de permisos al SIC](/noticies/2017-07-18-SIC-Autoservei-usuaris-SIC2.0/)\n\t* [Estructura de permisos al SIC](/noticies/2017-11-10-SIC-Estructura-permisos-i-Autoservei/)\n* El [Manual d'Usuari](/related/sic/2.0/manual-usuari.pdf)\n* El [Manual d'Integració](/related/sic/2.0/manual-integracio.pdf)\n\nDurant l'activació es migraran els permisos actuals dels Release Managers al nou model. Per tant, els usuaris actuals no es veuran afectats per aquest canvi d'estructura de permisos.\n\nSi teniu cap dubte al respecte, podeu obrir una [consulta](/howtos/2018-01-howto-obrir-peticions-SIC-a-autoservei-Remedy/#consulta) a SAU Remedy.\n","objectID":"L25vdGljaWVzLzIwMTgtMDMtMjMtU0lDLUNhbnZpLXNpc3RlbWEtcGVybWlzb3M="},"L25vdGljaWVzLzIwMTgtMDQtMzAtZWZvcm11bGFyaXMtUkVTVC1BUEk=":{"date":1525046400000,"title":"eFormularis. Serveis Invocació REST API","description":"En el projecte d'actualització tecnològica que s'està duent a terme a la plataforma d'eFormularis, s'introdueix una novetat que és la publicació d'una REST API per l'accés als Serveis d'Invocació de Formularis PDF","sections":["Notícies","home"],"categories":["sgde"],"key":"MAIG2018","path":"/noticies/2018-04-30-eformularis-REST-API","content":"En el projecte d'actualització tecnològica que s'està duent a terme a la plataforma d'eFormularis, s'introdueix una novetat que és la publicació d'una **REST API** per l'accés als Serveis d'Invocació de Formularis PDF:\n\n* Renderització de formularis PDF\n* Extracció de dades de formularis PDF\n* Aplanat de formularis PDF\n* Signatura de documents PDF amb certificat genèric de la Generalitat de Catalunya\n\nL'accés a aquesta REST API, a diferència de les versions precedessores basades en SOAP, ja es pot realitzar mitjançant **HTTPS**. L'especificació Swagger de la REST API es pot obtenir de la següent URL:\n\n**Producció**\n\nhttps://eformularis.intranet.gencat.cat/ServeisInvocacioApi/api/v2/api-docs (*No operativa fins a la posada en servei de la nova plataforma a Producció*)\n\n**Preproducció**\n\nhttps://preproduccio.eformularis.intranet.gencat.cat/ServeisInvocacioApi/api/v2/api-docs (*Operativa*)\n\n![eforms-swagger-specification](/images/news/serveis-invocacio-rest-api.png)\n\n<br>\nLes noves funcionalitats que s'afegeixin als Serveis d'Invocació de Formularis PDF està previst que només s'incorporin a aquesta REST API, i no a les versions predecessores basades en SOAP. Pel versionat de la REST API es seguiran les [bones pràctiques](http://canigo.ctti.gencat.cat/blog/2016/01/api/#versionat) definides en el blog d'arquitectura de CTTI. Tot i així, els serveis seran \"backward compatible\" sempre que sigui possible per evitar tenir que versionar la REST API.\n\nProperament a Canigó es proporcionarà una nova versió del connector amb el SGDE per incorporar un client que permeti el consum d'aquesta REST API de forma fàcil.\n\nCom a afegit a aquesta notícia, enumerem alguns dels **avantatges** que suposa l'ús de REST APIs en lloc de WS SOAP, i que han influït en la decisió d'implementar aquesta REST API pels Serveis d'Invocació de Formularis PDF:\n\n* *Rendiment*: permet format JSON per les dades, més lleuger que XML tant pel seu pes com pel seu processament\n* *Flexibilitat*: mentre que pels WS SOAP el codi dels clients ha de ser compilat per cada nou WSDL (Web Services Description Language), les REST API poden ser \"backward compatible\"\n* *Stateless*: les REST API estan concebudes per definició per a no mantenir estat, i en el cas d'operacions atòmiques, independents, com són les que formen part dels Serveis d'Invocació de Formularis PDF, encaixa perfectament\n* *Facilitat d'ús*: poden ser consumides per qualsevol client que suporti el protocol HTTP\n\nPer a qualsevol dubte respecte a l'ús d'aquesta REST API us podeu posar en contacte amb el CS Canigó preferiblement mitjançant el [servei STF del CSTD](https://cstd.ctti.gencat.cat/jiracstd/browse/STF) o bé enviant un correu a la [bústia](mailto:oficina-tecnica.canigo.ctti@gencat.cat).\n\n","objectID":"L25vdGljaWVzLzIwMTgtMDQtMzAtZWZvcm11bGFyaXMtUkVTVC1BUEk="},"L25vdGljaWVzLzIwMTgtMDQtMjctU0lDLUpvYnMtcGlwZWxpbmUtZXN0YXQtYWN0dWFs":{"date":1524787200000,"title":"SIC. Jobs pipeline: Estat de l'art","description":"Fa gairebé un any que es van implantar els jobs de tipus pipeline al SIC. En aquest article s'analitza l'estat actual d'aquests tipus de jobs i s'expliquen els futurs canvis que experimentaran aquesta modalitat de jobs","sections":["Notícies","home"],"categories":["sic"],"key":"MAIG2018","path":"/noticies/2018-04-27-SIC-Jobs-pipeline-estat-actual","content":"Fa gairebé un any que es van implantar els jobs de tipus pipeline al SIC. En aquest article s'analitza l'estat actual d'aquests tipus de jobs i s'expliquen els futurs canvis que experimentaran aquesta modalitat de jobs.\n\n## Introducció\n\nAbans de Jenkins 2.0, els _jobs_ de tipus _pipeline_ ja existien mitjançant la instal·lació d'una sèrie de plugins que permetien fer ús d'aquesta modalitat de jobs. Per a la versió 2.0 de Jenkins, els desenvolupadors de l'eina van realitzar un esforç per madurar aquesta nova funcionalitat i integrar-la al seu nucli. D'aquesta manera, a partir d'aquesta versió, l'ús de pipelines amb Jenkins passava a ser una forma oficial i més estable de creació de _jobs_.\n\nAmb la implantació l'any passat del SIC 2.0, es va incorporar la versió de Jenkins 2.7.4 que ja aportava aquesta funcionalitat.\n\n## Què és una _pipeline_ de Jenkins?\n\nUna _pipeline_ consisteix en un sistema en el que es transforma un flux de dades mitjançant un procés de fases seqüencials, sent l'entrada de cadascuna d'elles la sortida de l'anterior.\n\nEls jobs de tipus _pipeline_ tenen una part de metadades (identificació el job, definició de paràmetres, permisos...) i la pròpia _pipeline_ amb la configuració de la construcció i del desplegament. Aquesta pipeline es representa amb un arxiu Groovy que disposa una estructura segmentada en _stages_. A les instruccions de cada _stage_ se les anomena _steps_.\n\n## Avantatges en l'ús de _pipelines_\n\nEls avantatges que ens proporciona aquesta nova forma de generar els jobs són els següents:\n\n* No cal crear el job mitjançant els formularis que s'empraven amb els jobs de tipus _freestyle_ que requerien plugins, més dedicació i més manteniment.\n* Els jobs es tornen molt més versàtils. S'obre un ventall de possibilitats en l'ús d'eines. Ja no cal dependre només dels plugins, sinó que també hi ha la possibilitat d'incloure _[Shared Libraries](https://jenkins.io/doc/book/pipeline/shared-libraries/)_ de Jenkins per poder programar customitzacions de qualsevol mena.\n* Anb el desús de plugins, se simplifica la configuració i el manteniment de la plataforma Jenkins.\n* Permet realitzar la construcció i el desplegament en tots els entorns de l'aplicació amb un sol job. Facilitant el seguiment del cicle de vida de l'aplicació i garantint el principi de promoció d'artefactes entre entorns amb una única construcció.\n\n## La _pipeline_ Jenkins al SIC\n\nLa _pipeline_ Jenkins que s'ha implementat al SIC és el resultat d'implementar jobs amb els següents objectius en ment:\n\n1. Aportar el valor de cada _commit_ amb la menor latència possible a Producció.\n2. Permetre la introducció de controls (de qualitat, de robustesa, de seguretat...) al codi per evitar pujar versions que no siguin aptes.\n3. Automatitzar el cicle de vida de l'aplicació el màxim possible per evitar errors humans i tenir traça de cada construcció i de cada desplegament.\n4. Configuració del SIC definida per codi.\n\nAmb aquests objectius, s'ha definit al SIC el següent model de _pipeline_:\n\n![Pipeline del SIC](/images/news/PipelineJobsPREiPROiOficinesv1.png)\n\n## Futures passes\n\nL'ús de _pipelines_ al SIC obre un nou món de possibilitats, com per exemple automatitzar la creació de _jobs_ generant aquesta _pipeline_ a partir d'una sèrie de paràmetres de configuració.\n\nJustament a finals d'abril s'ha finalitzat el projecte de l'**Autoservei de jobs pipeline**, amb el qual es podran crear _jobs_ de forma automàtica a partir de les configuracions introduïdes als repositoris GIT per part del proveïdor d'aplicacions i del proveïdor d'infraestructures.\n\nCrearem un article en el proper comunicat explicant el seu funcionament amb més detall.\n\nTambé teniu disponible tota la informació relativa al seu funcionament al [Manual d'Usuari del SIC](/related/sic/manual-usuari.pdf).\n","objectID":"L25vdGljaWVzLzIwMTgtMDQtMjctU0lDLUpvYnMtcGlwZWxpbmUtZXN0YXQtYWN0dWFs"},"L25vdGljaWVzLzIwMTgtMDUtMTgtY2FuaWdvLWV2b2x1Y2lvLXNlcnZlaS10cmFjZXM=":{"date":1526601600000,"title":"Canigó. Evolució Mòduls de Traces i Instrumentació","description":"Analitzem l'evolució realitzada en els mòduls de traces i instrumentació a Canigó 3.2, recomanacions pel que fa al seu ús, i l'evolució a futur prevista per aquests serveis","sections":["Notícies"],"categories":["canigo"],"key":"JUNY2018","path":"/noticies/2018-05-18-canigo-evolucio-servei-traces","content":"### Traces\n\nEl [**Mòdul de Traces**](https://canigo.ctti.gencat.cat/canigo-documentacio-versions-3x-core/modul-traces/) va ser actualitzat de Log4j 1.x a Log4j 2.x a Canigó 3.2. Amb aquesta actualització es va voler dotar a les aplicacions Canigó de tots els avantatges que suposa l'ús d'aquesta nova versió de la llibreria. D'entre elles volem destacar la importància, pel que fa a aspectes de rendiment de les aplicacions, de l'ús de [loggers asíncrons] (https://logging.apache.org/log4j/2.x/manual/async.html).\n\nEls **loggers asíncrons** representen una gran millora respecte els síncrons, sobretot si el registre de les traces s'ha de realitzar en un destí amb una latència considerable (Ex. filesystem en un NAS, socket a servei remot). S'ha de tenir en compte que per obtenir aquesta millora de rendiment, es perd en fiabilitat, ja que alguns esdeveniments podrien arribar a perdre's. Si es volgués utilitzar en auditories, o alguna funcionalitat on no fos acceptable perdre cap registre, s'hauria d'implementar un mecanisme de fallback i utilitzar-lo en cas de detectar algun error (Ex. disc sense espai, problema de connectivitat, ...).\n\nA mode de resum, enumerem les principals novetats que incorpora Log4j 2.x:\n\n* Loggers asíncrons\n* Nivells de log personalitzats\n* Reconfiguracions en calent\n* Suport a lambdas\n* Filtres\n* Plugins\n* Suport a APIs\n* Traces de missatges personalitzats\n* Millores de concurrència\n* Configuració en diferents formats (XML, JSON o YAML, a més de configuració programàtica)\n\n#### Solució de logs centralitzats\n\nLes solucions de logs centralitzats tipus **ELK** (Elasticsearch+Logstash+Kibana) o **EFK** (Elasticsearch+Fluentd+Kibana) són cada cop més comuns. Des de CTTI s'està avaluant el seu ús.\n\nLes aplicacions Canigó 3.2 poden fer ús d'aquestes solucions de logs centralitzats, ja sigui escrivint traces a fitxer o sortida estàndard i que els agents de recol·lecció de logs els enviïn al repositori, o bé enviant-los directament mitjançant appenders de Log4j 2.x.\n\n### Instrumentació\n\nEl [**Mòdul d'Instrumentació**](https://canigo.ctti.gencat.cat/canigo-documentacio-versions-3x-core/modul-instrumentacio/), el qual no ha de confondre's amb el de traces, s'evolucionarà per tal de facilitar l'anàlisi del rendiment de les aplicacions (ús de memòria a la JVM, consum de cpu, pool de connexions a base de dades, temps de resposta de les peticions, healthchecks, ...) i permetre la integració amb serveis externs de centralització de la informació (Ex. Prometheus, InfluxDB, ...). També es vol integrar una solució de **traces distribuïdes** que permeti poder fer seguiment d'una acció d'usuari o sistema que requereixi interactuar amb diferents serveis, mitjançant l’ús d’un ID de Correlació que es vagi traspassant entre totes les crides entre els serveis.\n\nEn l'actualitat, el mòdul d'instrumentació facilita principalment:\n\n* monitoritzar l'execució de serveis de l'aplicació, obtenint informació com el temps de resposta i si el resultat és correcte o no\n* validar l'estat d'un servei, confirmant que està responent correctament (Ex. base de dades, servidor smtp, ...)\n\nA Canigó 3.2, a diferència de versions predecessores, les dades d'instrumentació s'exposen mitjançant serveis REST. En frontends web aquestes dades podent ser presentades visualment amb qualsevol llibreria Javascript, com per exemple, [Chart.js](https://www.chartjs.org/).\n<br><br>\nPer qualsevol dubte respecte a l'ús d'aquests mòduls i la seva evolució prevista us podeu posar en contacte amb el CS Canigó preferiblement via [JIRA CSTD al servei CAN](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN) o [bústia](mailto:oficina-tecnica.canigo.ctti@gencat.cat).\n","objectID":"L25vdGljaWVzLzIwMTgtMDUtMTgtY2FuaWdvLWV2b2x1Y2lvLXNlcnZlaS10cmFjZXM="},"L25vdGljaWVzLzIwMTgtMDYtMjgtU0lDLUdlbmVyYXItc2l0ZXMtd2ViLWFtYi1IdWdv":{"date":1530144000000,"title":"SIC. Generació de llocs web estàtics amb Hugo","description":"En aquest article s'explica el funcionament d'una web generada amb Hugo i el procediment d'integració al SIC","sections":["Notícies","home"],"categories":["sic"],"key":"JULIOL2018","path":"/noticies/2018-06-28-SIC-Generar-sites-web-amb-Hugo","content":"El passat mes de juny es va integrar el generador [Hugo](https://gohugo.io/) al SIC, el qual permet generar webs amb contingut estàtic d'una forma còmoda, fiable i eficient.\n\n## Què és Hugo?\n\nHugo és un dels molts **generadors de webs estàtiques** que han sorgit en els darrers anys.\n\nUn generador de webs estàtiques facilita la generació i la publicació dels continguts estàtics (HTML, CSS, elements multimèdia...) fins al punt que el manteniment del web no cal que es dugui a terme per part d'una persona amb perfil tècnic.\n\nAmb l'ús de la senzilla sintaxi de [Markdown](https://gohugo.io/content-management/formats/#learn-markdown), que permet aplicar estils, introduir enllaços i imatges amb facilitat, els usuaris poden generar continguts amb aspecte professional sense entrar en els detalls tècnics dels estils CSS i dels elements HTML.\n\nA partir d'una configuració inicial (que sí requereix la participació d'un perfil tècnic), la posterior generació de continguts pot ser realitzada per un redactor sense coneixements tècnics. A tots els efectes pot substituir el paper d'eines dinàmiques de generació de blogs (com Joomla, Drupal o Wordpress) amb els avantatges de les webs estàtiques:\n\n* **Més seguretat**: mai s'executa codi d'un gestor de continguts, ja que no n'hi ha. Les úniques vulnerabilitats possibles són les existents al propi servidor web.\n* **Més eficiència**: el contingut mostrat pel servidor és estàtic, no cal generar-lo en cada accés.\n* **Més mantenibilitat**: només cal mantenir el servidor web amb configuracions bàsiques. No cal configurar cap proxy al backend ni cap mena de CGI o procés PHP que s'encarregui de la generació del contingut.\n* **Més robustesa**: L'arquitectura de la solució és més senzilla que en altres tipus de solucions. Seguint el principi KISS (* **K**eep **i**t **s**imple, **s**tupid!*). La intervenció de menys elements d'arquitectura fa que hi hagi menys elements susceptibles de fallar.\n* **Més escalabilitat**: A més de ser més eficients i més robustes, aquestes solucions escalen millor i tenen més tolerància a pics d'accés.\n\nCom inconvenient, òbviament, per a webs que requereixin més funcionalitat que la de mostrar continguts (passarel·les de pagament, operatives funcionals, etc.) es requerirà disposar de continguts dinàmics i caldrà adoptar una altra solució.\n\n## Exemples de webs amb Hugo\n\nA CTTI ja s'està emprant aquest generador estàtic de webs. Webs com aquest mateix d'[**Arquitectura**](https://canigo.ctti.gencat.cat/) o com el de [**Qualitat**](https://qualitat.solucions.gencat.cat/) han estat generats amb aquesta eina.\n\n## Ús d'Hugo al SIC\n\nSi disposeu d'un web estàtic generat amb Hugo, per integrar-lo al SIC caldrà que seguiu el procediment estàndard d'integració:\n\n1. Repositar el web al Gitlab del SIC, dins del codi d'aplicació adient.\n2. Crear la carpeta `/sic` a l'arrel del projecte i incloure l'arxiu `/sic/sic.yml` per incloure la versió cada cop que feu un push.\n3. Un cop estiguin creats aquests arxius, ja s'haurà integrat l'aplicació al SIC i en cada push haureu de confirmar el desplegament als entorns de PRE i PRO. Si disposeu d'entorn d'INT, el desplegament es farà automàticament.\n\nInternament la pipeline generarà el web a una carpeta temporal i generarà un arxiu .zip que consistirà en l'artefacte estàtic que es desplegarà als servidors web de cada entorn.\n\nTambé teniu disponible tota la informació relativa al seu funcionament al [Manual d'Usuari del SIC](/related/sic/manual-usuari.pdf).\n","objectID":"L25vdGljaWVzLzIwMTgtMDYtMjgtU0lDLUdlbmVyYXItc2l0ZXMtd2ViLWFtYi1IdWdv"},"L25vdGljaWVzLzIwMTgtMDctMjYtYWN0dWFsaXR6YWNpby1kb2N1bWVudGFjaW8tc3Vwb3J0LWNsb3Vk":{"date":1532563200000,"title":"Suport Cloud. Actualització documentació","description":"Durant les darreres setmanes s'ha realitzat una tasca important d'actualització de documentació per part de l'equip de Suport Cloud, principalment d'elements de catàleg i tasques operatives a realitzar per part dels proveïdors d'aplicacions. En aquest article us fem un breu resum.","sections":["Notícies"],"categories":["cloud"],"key":"AGOST2018","path":"/noticies/2018-07-26-actualitzacio-documentacio-suport-cloud","content":"Durant les darreres setmanes s'ha realitzat una tasca important d'actualització de documentació per part de l'equip de Suport Cloud.\n\n### Tasques operatives (Novetat!)\n\nEn el desplegament d'aplicacions al que anomenem Container Cloud, l'equip d'aplicacions ha d'assumir certes responsabilitats pròpies d'un model DevOps. En aquesta [plana](/cloud/2018-05-28-CLOUD-OPS-Cloud/) podeu trobar-ne el detall.\n\n### Elements del catàleg\n\nDe forma periòdica es fa una actualització dels diferents elements que formen part del [catàleg](/cloud/cataleg/) de Suport Cloud. En el cas de les **imatges Docker** desenvolupades pel propi equip de Suport Cloud, l'objectiu és oferir sempre versions suportades de les diferents tecnologies i les més actuals possible. En cas que la tecnologia ofereixi una versió LTS (Long Term Support), com per exemple NodeJS, sempre s'intentarà estar alineat amb aquesta versió.\n\nCom novetat important, s'ha repositat el [codi font](https://git.intranet.gencat.cat/3048-intern/imatges-docker) de les imatges Docker de Suport Cloud al [Git del SIC](https://git.intranet.gencat.cat/).\n<br><br>\n![suport-cloud-docker-images.png](/images/news/suport-cloud-docker-images.png)\n<br>\n\nAquest codi font ha estat eliminat de Github, i les imatges Docker de DockerHub, passant al registre Docker corporatiu.\n\n* https://github.com/gencat/ &rarr; https://git.intranet.gencat.cat/3048-intern/imatges-docker\n* https://hub.docker.com/u/gencatcloud/ &rarr; https://docker-registry.ctti.extranet.gencat.cat/\n\n### Matriu catàleg Cloud\n\nPer facilitar la recerca de disponibilitat d'elements de catàleg en un determinat Cloud Privat o Públic, es pot utilitzar la següent [matriu](https://qualitat.solucions.gencat.cat/estandards/estandard-full-ruta-programari/).\n\n### Entorns de desenvolupament\n\nDes de Suport Cloud es recomana utilitzar [entorns de desenvolupament](/cloud/entorns-dev/) el més alineats possible amb les [plataformes Container Cloud](/cloud/plataformes/). És per aquest motiu que quan s'actualitza un Container Cloud, s'actualitza també la versió de la plataforma de desenvolupament equivalent. És molt important sobretot a l'hora de definir els descriptors de desplegament (yaml), ja que canvis de versió poden suposar canvis en aquests descriptors.\n","objectID":"L25vdGljaWVzLzIwMTgtMDctMjYtYWN0dWFsaXR6YWNpby1kb2N1bWVudGFjaW8tc3Vwb3J0LWNsb3Vk"},"L25vdGljaWVzLzIwMTgtMDgtMTAtQ2FuaWdvLVRyYW5zbWlzc2lvLWJpbmFyaXMtUkVTVC1BUEk=":{"date":1533859200000,"title":"Canigó. Transmissió de binaris en REST APIs","description":"En aquest article expliquem diferents opcions per transmissió de dades binàries en REST APIs, recomanacions i millors pràctiques.","sections":["Notícies","home"],"categories":["canigo"],"key":"SETEMBRE2018","path":"/noticies/2018-08-10-Canigo-Transmissio-binaris-REST-API","content":"La **transmissió de dades binàries** en un servei web, sobretot quan es tracta d'un volum de dades important, és un punt crític en el rendiment d'una aplicació. Cal tractar-ho amb deteniment, i aplicar la millor solució tècnica segons les característiques de l'aplicació.\n\n## Introducció\n\nActualment els dos formats _human readable_ d'ús general més utilitzats per dades estructurades són **JSON** i **XML**.\n\nRespecte al suport de dades binàries, el format XML suporta aquest tipus de dades de manera nativa principalment mitjançant el tipus `base64Binary`, mentre que el format JSON no en dóna suport directe, obligant a codificar aquesta informació de manera ad-hoc (p.e. com a Strings en Base64, Base85 o Base91).\n\n## Opcions\n\nTal com s'ha introduït prèviament a l'apartat anterior, hi ha diverses opcions tècniques per transmetre dades binàries les quals es descriuen a continuació.\n\n### Base64\n\nUna de les maneres més esteses de transmetre dades binàries és mitjançant la codificació en **Base 64**, sent aquesta l'estàndard amb màxima interoperabilitat car que és independent del format amb el qual es transfereixen les dades (JSON, XML, etc.). Un dels defectes principals d'aquest esquema de codificació és que augmenta la mida un **33%**, de manera que un arxiu de per exemple 6MB es transforma en un de 8MB.\n\nRelacionades amb la codificació prèvia hi ha (entre d'altres) les codificacions en _Base85_ i _Base91_, incrementant el rang de caràcters permesos segons la codificació, i reduint en conseqüència la mida final, però aquestes són menys esteses.\n\nExemple:\n```\n$ echo -n 'Exemple de codificació' | base64 \nRXhlbXBsZSBkZSBjb2RpZmljYWNpw7M=\n```\n\n#### XML:base64Binary\n\nEl format XML suporta de manera nativa l'enviament de dades binàries especificant aquest el tipus de dada `base64Binary`, de manera que el desenvolupador no ha d'encarregar-se de la tasca de codificació/decodificació de les dades, car que la biblioteca que implementa el tractament del format XML ho implementa internament.\n\nExemple:\n```\n<dades>\n<imatge>iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAACjElEQVR4Aa2V30uTURjHnVBUgglC...</imatge>\n</dades>\n```\n\n### Multipart (multipart/form-data)\n\nL'estàndard MIME defineix un tipus de contingut (_Content-Type_) que permet agrupar de manera ordenada diferents continguts en un mateix missatge, el tipus _Multipart_, i dins d'aquesta definició, hi ha un subtipus anomenat _Form-Data_.\n\nAquest tipus de contingut **multipart/form-data** és un estàndard pel qual les pàgines web permeten pujar fitxers als servidors juntament amb altres dades. \n\nUn avantatge d'utilitzar aquest estàndard és que és el mateix que utilitzen les pàgines web, alineant i unificant maneres de transmetre dades, a més a més sense incórrer en les des-avantatges d'una codificació del tipus Base64.\n\nExemple\n```\nHTTP POST https://api.onedrive.com/v1.0/drive/items/{folder-id}:/{child-folder-name}:/children\nAuthorization: bearer EwB...\nContent-Type: multipart/form-data; boundary=87ca48b5-cc31-4889-9e81-87df743e08ae\nContent-Length: 1284\n--87ca48b5-cc31-4889-9e81-87df743e08ae\nContent-Disposition: form-data; name=\"metadata\"\nContent-Type: application/json; charset=UTF-8\nContent-Length: 31\nContent-Transfer-Encoding: binary\n{\"file\":{},\"name\":\"file-name.ext\"}\n--87ca48b5-cc31-4889-9e81-87df743e08ae\nContent-Disposition: form-data; name=\"content\"\nContent-Type: text/plain\nContent-Length: 842\nContent-Transfer-Encoding: binary\n  File content goes here\n--87ca48b5-cc31-4889-9e81-87df743e08ae--\n```\n\n### Esquemes binaris\n\nLes opcions prèvies mantenien la premissa que eren orientades a text (_human readable_), però també hi ha opcions que permeten enviar la informació de manera estructurada utilitzant protocols binaris, o _machine readable_.\n\nL'avantatge d'aquests esquemes binaris radica en que estan optimitzats per la transferència eficient de dades, i no pas per la seva inspecció/supervisió per part de persones.\n\n#### Protocol Buffers\n\nAquest format d'estructuració de dades és l'equivalent (salvant algunes diferències) al format XML però en binari.\n\nEls principals avantatges d'aquest format és un suport excel·lent dels principals llenguatges (Java, Python, C#, Go, etc.) i una bona interoperabilitat entre plataformes (Linux, Windows, IoT, etc.), tot mantenint un _overhead_ mínim i una velocitat de càrrega millors en comparació amb XML.\n\nExemple (format text pla de protocol buffer)\n```\n# Textual representation of a protocol buffer.\n# This is *not* the binary format used on the wire.\nperson {\n  name: \"John Doe\"\n  email: \"jdoe@example.com\"\n}\n```\n\n#### MTOM\n\nMessage Transmission Optimization Mechanism (MTOM) és un estàndard de la W3C, que aglutina l'empaquetat de dades XML en el format binari XOP, l'enviament mitjançant _Multipart_ dins d'un protocol HTTP.\n\n## Recomanació\n\nDes d'un punt de vista de rendiment, la forma més eficient de transmissió de dades binàries és fer-ho de manera _asíncrona_, directament a un servei especialitzat en l'intercanvi de fitxers (p.e. FTP/SFTP/FTPS). En aquest sentit, no es fa cap codificació/escaneig de les dades per treballar amb les dades reals.\n\nEn el cas que s'hagi de fer mitjançant un API REST, s'ha de tenir en compte diversos factors i el pes en la decisió final:\n\n* Volum de transferència de dades: Si el volum de dades a transmetre és _elevat_ es desaconsella utilitzar l'enviament explícit o implícit de les codificacions textuals (p.e. Base64), i es recomana l'ús de protocols binaris, donats el seu rendiment i eficiència.\n* Interoperabilitat amb altres projectes/sistemes: En aquest cas les codificacions textuals (p.e. Base64) i més concretament el format XML, i el seu tipus de dades `base64Binary`, poden maximitzar la interoperabilitat permetent l'enviament de dades binàries.\n\nDes d'un punt de vista purament tècnic, i sense tenir en compte d'altres criteris, el ranking quedaria així:\n\n1. Protocol Buffers<br>\nEls avantatges d'aquesta opció són clares: Un protocol binari eficient en la densitat d'informació, ràpid en el tractament de dades i interoperable entre plataformes.\n\n2. Multipart<br>\nL'avantatge principal d'aquesta opció és que presenta un format d'empaquetat i encapsulació orientat a text i independent del format subjacent (p.e. JSON, XML), mantenint _quasi_ intacta la compatibilitat cap enrere, i mantenint alhora una elevada eficiència en la transmissió de dades binàries.\n\n3. XML:base64Binary<br>\nL'avantatge principal d'aquesta opció és que no requereix cap modificació especial, car que està suportat per l'estàndard XML, garantint una interoperabilitat màxima. Els desavantatges però són una eficiència i velocitat reduïdes (en comparació amb els protocols binaris).\n\nLes opcions Base64 i MTOM quedarien descartades en favor d'aquestes.\n\n### Streaming\n\nA banda de transmetre i tractar dades de manera eficient i còmode pel desenvolupador, la possibilitat de permetre _Streaming_ del contingut binari pot representar una necessitat en el cas que s'hagi de treballar amb un volum elevat de dades binàries, com per exemple els fitxers adjunts o reports pesants, car que les opcions estàndard carreguen aquestes dades binàries en memòria.\n\nEn aquest sentit l'única opció recomanable actualment per poder donar suport a _Streaming_ és l'opció de **Multipart**, car que les implementacions d'aquest estàndard transfereixen a fitxers temporals els continguts binaris, abstraient el desenvolupador d'aquest detall.\n\n## Enllaços d'interés\n\n* https://en.wikipedia.org/wiki/Base64\n* https://medium.com/walmartlabs/rest-easy-with-json-and-binary-f218f7e141be\n* https://canigo.ctti.gencat.cat/related/canigo/howto/Canigo%20-%20Streaming%20de%20fitxers%20en%20clients%20REST.pdf\n* https://en.wikipedia.org/wiki/MIME#Multipart_messages\n* https://ec.haxx.se/http-multipart.html\n* http://cxf.apache.org/docs/jax-rs-multiparts.html\n* https://en.wikipedia.org/wiki/Message_Transmission_Optimization_Mechanism\n* https://developers.google.com/protocol-buffers/docs/overview\n* https://github.com/protocolbuffers/protobuf/issues/5120\n","objectID":"L25vdGljaWVzLzIwMTgtMDgtMTAtQ2FuaWdvLVRyYW5zbWlzc2lvLWJpbmFyaXMtUkVTVC1BUEk="},"L25vdGljaWVzLzIwMTgtMDktMjYtcHVibGljYWNpby1jYW5pZ28tM18yXzY=":{"date":1537920000000,"title":"Publicació versió 3.2.6 Canigó","description":"S'ha publicat una nova versió de Canigó la qual incorpora un nou mòdul per a connexions amb bases de dades MongoDB, a més d'afegir suport a PostgreSQL en el mòdul de persistència ja existent","sections":["Notícies","home"],"categories":["canigo"],"key":"OCTUBRE2018","path":"/noticies/2018-09-26-publicacio-canigo-3_2_6","content":"## Suport a PostgreSQL\n\nS'ha afegit a Canigó 3.2.6 el suport per la base de dades PostgreSQL mitjançant l'estàndard JPA.\n\nTot i que la utilització de PostgreSQL es podia fer directament per part dels diferents proveïdors (configurant l'aplicació, i els servidors d'aplicacions als diferents entorns), amb aquesta nova versió de Canigó la configuració s'automatitza i es certifica el suport a aquesta base de dades des del CS Canigó.\n\n### Per què PostgreSQL?\n\n[PostgreSQL]((https://www.postgresql.org/)) és una BBDD relacional robusta de codi obert, que ofereix un suport ampli de l'estàndard SQL:2011, a més a més d'un gran ventall de característiques opcionals (que no formen part del nucli de l'estàndard).\n\nLes principals característiques són un rendiment especialment bo en consultes complexes (escenaris OLTP/OLAP), compliment ACID estricte, replicació de dades entre diferents servidors, seguretat avançada de dades (rols i encriptació), suport avançat per tipus de dades com per exemple JSON, XML o GIS, consultes de tipus _full-text search_ ràpides, personalització i definició de nous tipus de dades, funcions, operadors, etc.\n\n## Suport a MongoDB\n\nS'ha publicat un nou mòdul de Canigó 3 per a connexions amb bases de dades MongoDB. El propòsit del mòdul és proporcionar les utilitats per a realitzat la connexió i interactuar amb MongoDB de forma fàcil.\n\n[MongoDB](https://www.mongodb.com/) és un programari de codi obert, per a la creació i gestió de base de dades orientada a documents, escalable, d'alt rendiment, i lliure. La base de dades gestiona col·leccions de documents similars al format de dades JSON.\n\nEl nou mòdul \"canigo.persistence.mongodb\" utilitza Spring Data MongoDB i QueryDSL. Es pot trobar informació sobre aquests frameworks a la documentació de referència:\n\n* [Spring Data MongoDB] (https://docs.spring.io/spring-data/mongodb/docs/current/reference/html/). \n* [QueryDSL] (http://www.querydsl.com/static/querydsl/latest/reference/html/)\n\nCom amb el mòdul JPA per a bases de dades relacionals, en aquest nou mòdul per a bases de dades MongoDB, es proporcionen les configuracions i funcionalitats per a la generació de consultes de forma fàcil i senzilla.\n\nEn cas de tenir qualsevol dubte en l'ús del mòdul de Canigó 3 amb MongoDB podeu consultar la [documentació del mòdul](https://canigo.ctti.gencat.cat/canigo-documentacio-versions-3x-core/modul-mongodb) publicada al portal, posar-vos posar en contacte amb el CS Caniǵo a través del [JIRA CSTD](https://cstd.ctti.gencat.cat/jiracstd/CAN) amb una petició de consulta o suport, o bé enviant-nos un correu a la nostra [bústia](mailto:oficina-tecnica.canigo.ctti@gencat.cat).\n\n## Mòdul canigo.persistence.core\n\nDurant la fase de desenvolupament del nou mòdul de persistència de dades amb MongoDB s'ha creat un mòdul tècnic nou amb funcionalitats comunes dels paradigmes relacional/SQL (canigo.persistence.jpa) i noSQL de MongoDB (canigo.persistence.mongodb). Per tant, tots dos mòduls depenen d'aquest.\n\n## Plugin Eclipse\n\nEl plugin per l'IDE Eclipse, utilitzat a l'entorn de desenvolupament amb Canigó oficial, s'ha actualitzat a la versió 1.7.0 amb la incorporació de les dues noves opcions per configurar la BBDD: PostgreSQL i MongoDB.\n\nMés informació del plugin en [aquesta](https://canigo.ctti.gencat.cat/canigo-download-related/plugin-canigo/) plana del portal.\n","objectID":"L25vdGljaWVzLzIwMTgtMDktMjYtcHVibGljYWNpby1jYW5pZ28tM18yXzY="},"L25vdGljaWVzLzIwMTktMDEtMTAtT1RDYW5pZ28tQmFsYW5jLTIwMTg=":{"date":1547078400000,"title":"Oficina Tècnica de Canigó i Suport Cloud. Balanç 2018","description":"Evolució dels serveis de l'Oficina Tècnica de Canigó i Suport Cloud a l'any 2018","sections":["Noticies","home"],"categories":["sic, canigo, sgde","cloud"],"key":"FEBRER2019","path":"/noticies/2019-01-10-OTCanigo-Balanc-2018","content":"A continuació es mostren les fites aconseguides el 2018 segons ordre cronològic:\n\n<center><iframe src='https://cdn.knightlab.com/libs/timeline3/latest/embed/index.html?source=15wu7P9o-vGz4N9psnSswTD4FGbbWatxQDE58OGZcP70&font=Default&lang=ca&hash_bookmark=true&initial_zoom=1&height=650' width='100%' height='650' webkitallowfullscreen mozallowfullscreen allowfullscreen frameborder='0'></iframe></center>\n\nA més del timeline anterior, fem una breu descripció de cadascuna d'aquestes fites:\n\n### Suport Cloud\n\n- Millora i evolució d'**Imatges Docker corporatives** alineant-les amb el full de ruta de CTTI\n- Posada en servei  del **Registre Docker corporatiu** basat en Harbor\n- **Ampliació del catàleg de serveis** afegint la plataforma de contenidors CaaS d'IBM a cloud privat\n- **Suport a la construcció i desplegament d'aplicacions** en les diferents plataformes cloud en catàleg: AppAgile, SwarmMe, CaaS, Bluemix, Azure i Compose (DBaaS)\n- **Tasques d'operacions** disponibles pels proveïdors d'aplicacions\n- **Millores en el servei**: accés a logs, pla de comunicacions,...\n\n\n### SIC (Servei d'Integració Continua)\n\n- Publicació de l'**Autoservei de jobs del SIC**, mitjançant el qual els proveïdors són autònoms en la definició per la generació de les pipelines de construcció i desplegament d'aplicacions a CPD des del SIC\n- Integració del servidor d'aplicacions **JBoss EAP**\n- Integració del generador de webs estàtiques **Hugo** i desplegament en servidors web\n- Integració de **controls d’idoneïtat** de les versions de programari que han de pujar a producció, i que s’implementen a la pipeline\n- Integració dels **controls de qualitat** del codi font a la pipeline\n\n\n### Canigó\n\n- Publicació de [**Canigó 3.2.4**](https://cstd.ctti.gencat.cat/jiracstd/projects/CAN/versions/10494) amb millores al servei de mailing, d'instrumentació i de seguretat al servei RS (suport a serveis REST)\n- Publicació de [**Canigó 3.2.5**](https://cstd.ctti.gencat.cat/jiracstd/projects/CAN/versions/10498) amb la inclusió d'un nou mòdul per suport a SAML2, millores de rendiment al mòdul d'instrumentació, actualització de Spring per resolució de vulnerabilitats reconegudes (CVE's), i resolució d'incidències al servei de persistència i LOPD\n- Publicació de [**Canigó 3.2.6**](https://cstd.ctti.gencat.cat/jiracstd/projects/CAN/versions/10601) amb la inclusió d'un nou mòdul de suport a MongoDB i a PostgreSQL al mòdul de persistència\n- Publicació de [**Canigó 3.2.7**](https://cstd.ctti.gencat.cat/jiracstd/projects/CAN/versions/10602) amb suport a autenticació amb certificat per GICAR al mòdul de seguretat, millores a la gestió d'adjunts del servei de mailing, millores en la parametrització del connector amb l'Antivirus corporatiu, suport a tipus de dades JSON a PostreSQL i MySQL, i resolució d'incidències\n- Publicació de les [**versions 2.0.1, 2.0.2, 2.0.3, i 2.0.4 de l'entorn de desenvolupament de Canigó**](/canigo/entorn-desenvolupament/) amb millores al procés de construcció, actualitzacions del plugin d'Eclipse de Canigó i resolució d'incidències\n\n\n### **SGDE (Servei de Gestió del Document Electrònic)**\n\n- eFormularis: **actualització tecnològica** del servei i **suport a formularis HTML5 adaptatius**\n- STD (Servei de Transformació de Documents): definició **nova arquitectura del servei i pilot** (prevista possada en servei a finals del primer trimestre de 2019)\n\nPer a més informació sobre els futurs evolutius planificats, podeu consultar el [Roadmap d'arquitectura del CTTI](http://canigo.ctti.gencat.cat/centre-de-suport/roadmap/).\n","objectID":"L25vdGljaWVzLzIwMTktMDEtMTAtT1RDYW5pZ28tQmFsYW5jLTIwMTg="},"L25vdGljaWVzLzIwMTgtMDktMjYtQ2FuaWdvLXByb21vLWNvbm5lY3RvcnM=":{"date":1537920000000,"title":"Connectors de Canigó amb serveis corporatius","description":"Fem un recordatori de l'objectiu dels connectors que proporciona Canigó i el seu manteniment/suport associat","sections":["Notícies","home"],"categories":["canigo"],"key":"OCTUBRE2018","path":"/noticies/2018-09-26-Canigo-promo-connectors","content":"## Manteniment de connectors Canigó\n\nDins de la tasca de manteniment del framework de Canigó, aquest mes de setembre s'ha encetat una tasca de revisió i manteniment dels diferents [connectors o mòduls d'integració de Canigó](https://canigo.ctti.gencat.cat/canigo-documentacio-versions-3x-integracio/), revisant les proves unitàries i actualitzant el codi mirant d'adaptar-lo als nous _best practices_. Qualsevol problema amb els connectors és detectat de forma proactiva mitjançant l'automatització de l'execució d'aquests tests unitàris al [SIC](https://canigo.ctti.gencat.cat/sic/).\n\nUn connector de Canigó és un conjunt de funcionalitats dins un àmbit definit, empaquetades en un format accessible per al desenvolupador. L'objectiu dels connectors de Canigó és múltiple:\n\n* Abstracció: Per una banda s'aconsegueix abstreure el desenvolupador dels detalls de la implementació, triant valors adients i pre-definits per la OT de Canigó (p.e. timeouts).\n* Simplificació: Per l'altre banda els connectors ofereixen una capa simplificada d'utilització orientada als casos d'ús més estàndard, orientant el desenvolupament cap a una solució estàndard, millorant el TTM.\n* Certificació i suport: Finalment, els connectors de Canigó ajuden a definir el conjunt de dependències per l'ús de l'aplicació. Tot aquest conjunt de dependències i de configuracions ajuda a definir un _quòrum_ que permet definir una aplicació certificada per Canigó, donant accés a un suport preferent i de qualitat.\n\nA continuació es descriuen un petit subconjunt dels diferents connectors que proporciona Canigó:\n\n### PICA\n\nLa Plataforma d'Integració i Col.laboració Administrativa disposa d'un suport preferent dins a Canigó, desplegat en diferents connectors segons l'àmbit dels serveis oferits.\n\nAixí doncs, el ventall de funcionalitats dels diferents connectors varia des de l'accés a dades del Padró i la validació de dades amb DNI, fins a l'accés a dades tributàries.\n\n### ICC\n\nEls serveis del connector per l'Institut Cartogràfic i Geològic de Catalunya estan orientats a la cerca i validació d'adreces, geo-posicionaments i serveis de localització.\n\n### PSGD\n\nEls serveis de Gestió Documental amb Alfresco giren entorn de la gestió de carpetes, documents i metadades associades.\n\n### PSIS\n\nEl connector per treballar amb els certificats digitals oferts pel Consorci Administració Oberta de Catalunya ofereix serveis de validació de certificats i signatures.\n\n### SGDE\n\nEl Servei de Gestió del Document Electrònic o SGDE, és un servei que permet realitzar múltiples operacions amb documents, des de renderitzacions i extraccions de dades de formularis PDF, fins a conversió de formats MS Office a PDF.\n\nPer a qualsevol dubte respecte a l'ús d'aquests o altres connectors de Canigó, podeu possar-vos en contacte amb el CS Canigó obrint una petició al JIRA CSTD al servei [CAN](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN) o bé enviant un correu a la [bústia](mailto:oficina-tecnica.canigo.ctti@gencat.cat).\n","objectID":"L25vdGljaWVzLzIwMTgtMDktMjYtQ2FuaWdvLXByb21vLWNvbm5lY3RvcnM="},"L25vdGljaWVzLzIwMTktMDItMjAtYWN0dWFsaXR6YWNpby10ZWNub2xvZ2ljYS1zdGQ=":{"date":1550620800000,"title":"STD. Actualització tecnològica del servei","description":"L'últim trimestre del 2018 es va iniciar un projecte d'actualització tecnològica del STD (Servei de Transformació de Documents) que està previst que finalitzi a l'Abril. També es realitza una rearquitectura per tal de millorar l'aïllament de les diferents funcionalitats que es proporcionen i la seva escalabilitat. STD és el principal servei en el qual es recolza eCopia, servei de còpia autèntica de documents corporatiu de la Generalitat","sections":["Notícies","home"],"categories":["sgde"],"key":"MARC2019","path":"/noticies/2019-02-20-actualitzacio-tecnologica-std","content":"L'últim trimestre del 2018 es va iniciar un projecte d'**actualització tecnològica del servei STD (Servei de Transformació de Documents)** que està previst que finalitzi a l'Abril. També es realitza una **rearquitectura** del servei per tal de millorar l'aïllament de les diferents funcionalitats que es proporcionen i la seva escalabilitat. STD és el principal servei en el qual es recolza eCopia, servei de còpia autèntica de documents corporatiu de la Generalitat.\n\nAbans d'entrar en detall dels canvis que es realitzaran en aquest projecte, fem un recordatori de les diferents funcionalitats que ofereix el servei STD:\n\n* Creació de codis segurs de verificació (**CSV**) per a la identificació i registre de documents\n* **Composició** de documents PDF, consistent en la fusió de plantilles que contenen una sèrie de tags especials\namb informació sobre les dades a inserir en els documents originals\n* **Conversió** de diferents formats ofimàtics a PDF\n* **OCR** (Optical Character Recognition) per obtenir el text d’una imatge i generació de PDFs cercables\n\n## Rearquitectura\n\nTota la capa d'aplicació del servei STD es mou de VM a contenidors [**Docker**](https://canigo.ctti.gencat.cat/cloud/cataleg/#contenidors-docker) a la plataforma [**AppAgile**](https://canigo.ctti.gencat.cat/cloud/contenidors_appagile/). Només el servei de conversió de documents ofimàtics MS Office a PDF requereix d'un entorn Windows aprovisionat en VMs a CPD.\n\n![std2-arquitectura](/images/news/std2-arquitectura.PNG)\n\nGràcies a aquesta rearquitectura és possible **escalar** els diferents serveis per separat dependent del seu consum, a més d'estar **aïllats**, motiu pel qual un problema en un dels serveis no afectarà la resta. Tot el cicle de vida (desenvolupament, construcció, tests, versionat, desplegament) de cada servei és independent dels altres, podent ser evolucionats per separat.\n\nTotes les funcionalitats del STD avui dia són exposades mitjançant serveis **SOAP**. Un cop finalitzat aquest projecte d'actualització tecnològica, a més de mantenir aquests serveis per compatibilitat amb els consumidors existents, s'exposarà una nova **API REST**. Aquesta és la línia que s'evolucionarà a futur i a la qual es recomana que les aplicacions noves s'integrin, i les existents vagin migrant. La documentació per l'ús d'aquesta nova API REST es publicarà properament al [Manual d'Usuari](https://canigo.ctti.gencat.cat/related/sgde/CSCanigo.MU.P00.E01_manual_usuari_STD.pdf) del servei.\n\n### Sondes\n\nEls contenidors desplegats a AppAgile tenen configurades sondes per garantir la disponibilitat del servei. En aquest comunicat s'inclou un [how-to](https://canigo.ctti.gencat.cat/howtos/2019-03-HowTo-Definicio-sondes-aplicacions-Canigo-AppAgile/) on s'explica com es poden configurar aquestes sondes en aplicacions Canigó 3.2.\n\n## Actualització tecnològica\n\nA continuació es detalla les actualitzacions de versions i canvis de productes més rellevants:\n\n* Tots els serveis es basen en [**Canigó**](https://canigo.ctti.gencat.cat/canigo/), i s'actualitzen a la versió [3.2.7](https://canigo.ctti.gencat.cat/canigo/roadmap/)\n* Es canvia l'engine de conversió de MS Office a PDF, passant de [J-Interop](http://www.j-interop.org/) a [**documents4j**](https://documents4j.com/)\n* S'actualitza la versió de **MS Office** de 2010 a 2016\n* S'actualitza OpenOffice 4.0.1 a **LibreOffice** 5.4.5.1\n* S'actualitza la versió de [**Tesseract**](https://opensource.google.com/projects/tesseract), engine OCR, de 3.02.02 a 3.05.02\n* S'actualitzen les versions de les llibreries de tractament de documents PDF (PDFBox, iText) així com d'altres d'ús intern dels diferents serveis\n\n## Impacte en integradors\n\nEl canvi tecnològic s'ha realitzat tenint en compte que l'impacte en els consumidors actuals sigui mínim. És per aquest motiu que es mantindran intactes les URLs actuals d'accés al servei SOAP:\n\n**WS SOAP**\n\n* _PRE_: ```http://preproduccio.sgde.intranet.gencat.cat/ServeisInvocacioSTD/services/ServeisSTD<V2>?wsdl```\n* _PRO_: ```http://sgde.intranet.gencat.cat/ServeisInvocacioSTD/services/ServeisSTD<V2>?wsdl```\n\n*L'antic domini de PRE \"sgde.pre.intranet.gencat.cat\" també seguirà funcionant com fins ara\n\nTambé l'accés SFTP:\n\n**SFTP**\n\n* _PRE_: ```sftp <usuari-app>@preproduccio.sftp.sgde.intranet.gencat.cat```\n* _PRO_: ```sftp <usuari-app>@sftp.sgde.intranet.gencat.cat```\n\n*L'antic domini de PRE \"sftp.sgde.pre.intranet.gencat.cat\" també seguirà funcionant com fins ara\n\nA més dels dominis existents, es donaran d'alta nous dominis dedicats al STD, en el cas de l'accés http amb la possibilitat de fer-ho per SSL:\n\n**WS SOAP (NOU!)**\n\n* _PRE_: ```https://preproduccio.std.intranet.gencat.cat/ServeisInvocacioSTD/services/ServeisSTD<V2>?wsdl```\n* _PRO_: ```https://std.intranet.gencat.cat/ServeisInvocacioSTD/services/ServeisSTD<V2>?wsdl```\n\n**SFTP (NOU!)**\n\n* _PRE_: ```sftp <usuari-app>@preproduccio.sftp.std.intranet.gencat.cat```\n* _PRO_: ```sftp <usuari-app>@sftp.std.intranet.gencat.cat```\n\n<br />\nAviat s'informarà, tant en aquest portal com mitjançant comunicats destinats als integradors, la data de disponibilitat del nou entorn de Preproducció així com del període de proves abans no es posi en servei el nou entorn de Producció.\n\n<br />\nPer qualsevol dubte referent a aquest projecte de transformació tecnològica us podeu posar en contacte amb el CS Canigó obrint una petició de consulta o suport al servei [STF](https://cstd.ctti.gencat.cat/jiracstd/projects/STF) del CSTD, o bé enviant un correu a [oficina-tecnica.canigo.ctti@gencat.cat](mailto:oficina-tecnica.canigo.ctti@gencat.cat)\n","objectID":"L25vdGljaWVzLzIwMTktMDItMjAtYWN0dWFsaXR6YWNpby10ZWNub2xvZ2ljYS1zdGQ="},"L25vdGljaWVzLzIwMTktMDMtMjktYWN0dWFsaXR6YWNpby1jYW5pZ28tM180XzA=":{"date":1553472000000,"title":"Canigó. Publicació versió 3.4.0","description":"S'ha publicat una nova versió de Canigó donant suport a Spring 5, Spring Boot 2 i nous paradigmes de programació. També s’inclou l’actualització del connector amb la Plataforma de Serveis de Gestió Documental (PSGD)","sections":["Notícies","home"],"categories":["canigo"],"key":"ABRIL2019","path":"/noticies/2019-03-29-actualitzacio-canigo-3_4_0","content":"Amb l’alliberament de la **versió 3.4.0 del framework Canigó** s’assoleix un dels objectius que es persegueix des de CS Canigó, consistent en proporcionar als desenvolupadors d'aplicacions un framework amb les últimes versions suportades de Java i Spring, a més de permetre nous paradigmes de programació.\n\nCom a afegit, a la versió 3.4 també s’inclou l’actualització del connector amb la Plataforma de Serveis de Gestió Documental (PSGD), també coneguda com a **ARESTA**.\n\n## Actualització tecnologies base\n\n### Java 11\n\nEl Setembre de 2018, Oracle va publicar la versió 11 de Java, la primera versió LTS amb la nova política de sis mesos de cicle de suport. Podeu consultar la documentació d'aquesta versió, així com les seves release notes al següent [enllaç](https://www.oracle.com/technetwork/java/javase/11-relnotes-5012447.html).\n\nDes del CS Canigó, s'ha certificat la compatibilitat de Canigó 3.4.0 amb aquesta versió Java 11.\n\n### Spring 5\n\nSpring Framework ofereix un model complet de programació i configuració per a aplicacions empresarials basades en Java. Spring 5 és la primera gran entrega de Spring Framework des de la versió 4 publicada el Desembre de 2013.\n\nEl principal objectiu de Spring 5 és proporcionar els nous paradigmes de programació amb programació funcional (webflux) i programació reactiva.\n\nA més, el resum d'actualitzacions que incorpora són les següents:\n\n### Principals actualitzacions de la línia base:\n- Java SE 8+ Java EE 7+\n- JDK 8\n- Servlet 3.1\n- Bean validation 1.1\n- JPA 2.1\n- JMS 2.0\n- Millores en el test\n\n### Principals extensions de la línia base\n- Java EE 8\n- Servlet 4.0\n- Bean validation 2.0\n- JPA 2.2\n- JMS 2.0\n- JSON Bingdins API 1.0\n- Hibernate validator 6.0\n- Apache Johnzon 1.1\n- Refinat de la interacció amb resouces amb NIO.2\n\nSegons estudis realitzats a 5.160 desenvolupadors a finals del 2018, el 24% de les aplicacions que utilitzaven Spring ja utilitzaven la versió 5.\n\n### Spring Boot 2\n\nSpring Boot, al igual que Canigó, proporciona eines pel desenvolupament fàcil d'aplicacions empresarials amb el mínim possible de configuració.\n\nSpring Boot 1 acaba la seva línia de desenvolupament i manteniment a l'Agost del 2019.\n\nSpring Boot 2 el seu principal objectiu és donar suport a Spring 5, Java 8 a la seva línia base i l'actualització de les versions de les seves dependències així com també actualització dels seus servidors suportats.\n\nSegons estudis realitzats a 5.160 desenvolupadors a finals del 2018, amb pocs mesos des de la seva publicació, el 30% de les aplicacions que utilitzaven Spring Boot utilitzaven la versió 2,\n\nAmb l'actualització a Spring Boot 2, Canigó 3.4.0 proporciona una actualitzada, potent, fàcil i productiva eina de creació d'aplicacions amb Java.\n\n## Arquitectura\n\nA la versió 3.4.0 de Canigó amb Spring 5 i Spring Boot 2 es proporciona les següents funcionalitats:\n\n### Configuració propietats amb yaml\n\nYAML és un estàndard de format fàcilment llegible que significa \"YAML Ain't Markup Language\", per a més informació es pot consultar el següent [enllaç](https://yaml.org/).\n\nA la versió Canigó 3.4.0 es proporciona la funcionalitat de càrrega de propietats definides a fitxers yaml.\n\nL'objectiu d'aquest canvi és utilitzar un estàndard més actual i llegible per a la definició de les propietats de les aplicacions i poder, en properes versions de Canigó, utilitzar totes les funcionalitats de configuració de propietats de Spring.\n\nPer a aplicacions amb Canigó 3.4, es recomana passar les propietats definides en format properties a format yaml.\n\nEn properes versions de Canigó s'eliminarà l'actual funcionalitat de configuració de propietats pròpia de Canigó, per utilitzar les funcionalitats de configuració de propietats estàndard de Spring.\n\nPer a més informació podeu consultar la documentació del [Mòdul de configuració](/canigo-documentacio-versions-3x-core/modul-configuracio/).\n\n### Programació amb estàndard de Streams Reactius\n\nIntroduïts a la versió 8 de Java, els Streams són utilitzats pel processament eficient de col·leccions d'objectes.\n\nStreams Reactius és un estàndard per al processament de streams asíncrona, amb contrapressió i no bloquejant. L’estàndard es defineix al [Manifest Reactiu](http://www.reactive-streams.org/)\n\nEl resum d'aquest estàndard seria que es crea un fluxe on existeix un publicador i un consumidor. El publicador va publicant elements al fluxe a la velocitat que el consumidor les consumeix, sense que hi hagi un bloqueig per part del publicador, ni una contrapressió pel consumidor.\n\n[//]: # (https://alexandreesl.com/tag/reactive-streams/)\n![Reactive streams](/images/news/reactive-streams.png)\n\nEl resum de passos per una comunicació reactiva serien:\n1. El productor (o publicador) es subscriu amb un consumidor (o subscriptor)\n2. El consumidor quan està llest li indica al productor\n3. El productor li envia elements al consumidor\n4. El consumidor processa els elements i li demana més elements o cancel·la la petició al productor\n\nSpring 5 utilitza el projecte [Reactor](https://projectreactor.io/) per a crear sistemes reactius eficients.\n\n### Programació reactiva\n\nSpring 5 proporciona les funcionalitats per a la programació reactiva utilitzant l'estàndard de Streams Reactius.\n\nL'objectiu és proporcionar eines per a crear aplicacions no bloquejants, que siguin asíncrones, orientades a esdeveniments i que requereixin d'un nombre reduït de fils.\n\nAmb el nou mòdul Spring Web Reactive, Spring proporciona un model de programació tradicional amb Model-Vista-Controlador (MVC), però executat amb reactiu i no bloquejant. A la imatge següent es mostra una comparativa entre Spring MVC i Spring Web Reactive:\n\n![Web Reactive overview](https://docs.spring.io/spring-framework/docs/5.0.0.M1/spring-framework-reference/html/images/web-reactive-overview.png)\n\nUn exemple pràctic on podrien actuar els Streams Reactius seria quan tenim un repositori de dades (que actua com a productor) que produeix dades que un servidor HTTP (que actua com a consumidor) escriu com a resposta. En l'exemple, el principal propòsit dels Streams Reactius seria delegar al servidor HTTP el control de com de ràpid o lent el repositori de dades ha de proporcionar les dades.\n\nEls endpoints web de Spring MVC i WebFlux suporten reactiu com a retorn, però WebFlux, a més, proporciona suport per entrada de dades reactiva. Per a que un repositori de dades suporti reactiu el seu driver ha de ser no bloquejant (non-blocking). Els drivers de bases de dades que actualment proporcionen non-blocking, són: MongoDB, Redis, Cassandra i Couchbase.\n\nPer a mostrar com utilitzar reactiu amb un repositori de dades s'ha publicat la següent guia d'[Utilització de mongo reactiu](/canigo-documentacio-versions-3x-altres/modul-mongo-reactiu/).\n\nPer a més informació sobre programació reactiva amb Spring 5 podeu consultar aquest [enllaç](https://docs.spring.io/spring-framework/docs/5.1.5.RELEASE/spring-framework-reference/web-reactive.html).\n\n### Programació funcional (WebFlux)\n\nLa programació funcional va néixer per poder proporcionar un desenvolupament orientat a l'aplicació de funcions declarades.\n\nSpring WebFlux proporciona endpoints web de forma funcional a més dels controladors tradicionals, proporcionant un lleuger model de programació funcional on les funcions són utilitzades per enrutar i capturar peticions a més de la tradicional programació imperativa.\n\nA la següent imatge es pot observar la comparativa de funcionalitats entre Spring MVC i Spring WebFlux:\n\n![Spring MVC Webflux Venn](https://docs.spring.io/spring-framework/docs/5.1.5.RELEASE/spring-framework-reference/images/spring-mvc-and-webflux-venn.png)\n\nSpring WebFlux està suportat a Tomcat, Jetty, Netty, Undertow i contenidors Servlet 3.1+.\n\nPer a mostrar com utilitzar aquest nou paradigma de programació web s'ha publicat la guia [Utilització de web flux](/canigo-documentacio-versions-3x-altres/modul-webFlux/).\n\nPer a més informació sobre programació funcional amb Spring 5 podeu consultar aquest [enllaç](https://docs.spring.io/spring-framework/docs/5.1.5.RELEASE/spring-framework-reference/web-reactive.html#webflux-fn).\n\n### Spring MVC o WebFlux\n\nEls següents punts són un resum del què s'han de tenir en compte a l'hora de decidir-se per utilitzar Spring MVC o WebFlux en una aplicació:\n\n- Si l'aplicació amb Spring MVC funciona correctament, no hi ha necessitat de canvi\n\n- Si necessites un web stack amb non-blocking, Spring WebFlux et proporcionarà el màxim de funcionalitats reactives\n\n- Si necessites una aplicació el més lleugera possible, amb programació web funcional i utilització de lambdas de Java 8, Spring Web flux et proporcionarà endpoint web funcionals\n\n- Si l'aplicació utilitza apis de persistència bloquejants (JPA, JDBC) o apis externes bloquejants, Spring MVC és la millor solució\n\n- Encara que l'aplicació hagi d'estar basada en Spring MVC, els controladors de Spring MVC poden cridar a altres components reactius com serveis remots o repositoris de dades no bloquejants.\n\nSi teniu dubtes a l'hora de decidir si utilitzar Spring MVC o WebFlux, podeu posar-vos en contacte amb el CS Canigó al [servei CAN](https://cstd.ctti.gencat.cat/jiracstd/projects/CAN) del JIRA CSTD o enviant-nos un mail a la [bústia del CS Canigó](mailto:oficina-tecnica.canigo.ctti@gencat.cat) per tractar el vostre cas.\n\n### Certificació amb servidors incrustats (Spring Boot)\n\nS'ha certificat la compatibilitat de Canigó 3.4.0 amb els següents servidors incrustats amb Spring Boot:\n\n|     \tServidor incrustat\t\t\t\t\t|      \t\t\t\tVersió\t\t\t\t\t     \t|\n|--------------------------------- \t|--------------------------------- \t|\n|  Tomcat\t\t\t\t\t          \t  \t \t|         9.0.16\t             \t\t\t|\n|  Undertow\t\t\t\t          \t  \t \t|         2.0.17.Final         \t\t\t|\n|  Jetty\t\t\t  \t\t        \t  \t \t|         9.4.14.v20181114    \t\t\t|\n|  Netty (webflux)\t\t\t\t\t\t\t\t\t|         4.1.33.Final        \t\t\t|\n|  Reactor Netty (reactor webflux)  |         0.8.5.RELEASE       \t\t\t|\n\nPer la següent versió de Canigó es certificarà Canigó 3.4.x amb els servidors suportats al [full de ruta del CTTI](https://qualitat.solucions.gencat.cat/estandards/estandard-full-ruta-programari/)\n\nPer més informació podeu consultar aquest [enllaç](/canigo/download/).\n\n## Connectors\n\nCom a afegit, a la versió 3.4.0 s'ha actualitzat el següent mòdul d'integració:\n\n### ARESTA\n\nL'objectiu d'aquest connector és proporcionar un punt d’accés cap a la Plataforma de Serveis de Gestió Documental (PSGD), també coneguda com a ARESTA, facilitant a les aplicacions l’ús d'aquesta plataforma.\n\nA la versió 3.4.0 de Canigó, s'ha alineat el connector amb PSGD o ARESTA a la versió 6.0.\n\nPodeu consultar la documentació d'aquest connector a [Mòduls d'Integració - ARESTA (PSGD)](/canigo-documentacio-versions-3x-integracio/modul-psgd/).\n\n## Com utilitzar Canigó 3.4.0\n\nProperament es publicarà una actualització de [l'entorn de desenvolupament](/canigo/entorn-desenvolupament/) i del [plugin de Canigó per Eclipse](/canigo-download-related/plugin-canigo/) per a la creació d'aplicacions Canigó 3.4.0.\n\nPer poder passar una aplicació de Canigó 3.2 a Canigó 3.4 podeu seguir els passos descrits a [Actualització Canigó 3.2 a Canigó 3.4](/howtos/2019-03-Howto-Actualitzacio_Canigo3_2_Canigo3_4/).\n\n<br/>\nPer qualsevol dubte relatiu a aquesta nova versió de Canigó us podeu posar en contacte amb el CS Canigó al [servei CAN](https://cstd.ctti.gencat.cat/jiracstd/projects/CAN) del JIRA CSTD o enviant-nos un mail a la [bústia del CS Canigó](mailto:oficina-tecnica.canigo.ctti@gencat.cat).\n","objectID":"L25vdGljaWVzLzIwMTktMDMtMjktYWN0dWFsaXR6YWNpby1jYW5pZ28tM180XzA="},"L3ByaW5jaXBpcw==":{"date":1542240000000,"title":"Principis d'Arquitectura de Sistemes d'Informació","description":"Recomanacions a seguir en la construcció de sistemes d'informació a la Generalitat de Catalunya","blog_tags":["bones pràctiques"],"sections":["Blog"],"aliases":["/principis","/principis/","/bloc/principis","/bloc/2015/11/principis","/blog/principis","/blog/2015/11/principis","/arquitectura/principis","/arquitectura/2015/11/principis"],"imatge":"/images/bloc/principis.png","langs":["ca","es"],"path":"/principis","content":"## Introducció\n\n\nEls principis d'arquitectura CTTI són les normes i directrius generals destinades a ser perdurables i rarament modificables i  tenen com a objectiu informar i recolzar la forma en què CTTI vol que s'implementin els Sistemes d'Informació.\n\nEls principis, basats en el framework TOGAF, s’estructuren jeràrquicament en diferents segments i s’amplien amb una sèrie d’estratègies i pràctiques que marquen el rumb. Entre elles, destaquen el moviment DEVOPS, els principis sobre Microserveis i l'aposta per solucions de programari lliure.\n\n<p>A continuació detallem quins són aquests principis.</p>\n\n\n\n## 1. Principis sobre el disseny d’aplicacions\n\n<p><strong>1.1 Segregació de funcions/responsabilitats</strong>. Les aplicacions han d’estar estructuralment dividides en blocs independents per funcionalitats, processos de negoci o serveis, per tal d’evitar els monòlits.</p><p>Aquest principi és d’aplicació a totes les capes. Una aplicació tipus pot dividir-se fàcilment, per exemple, en els següents mòduls:</p>\n\n<ul>\n    <li>Públic general (internet)</li>\n    <li>Col·laboradors externs (extranet)</li>\n    <li>BackOffice (intranet)</li>\n    <li>Processos batch</li>\n    <li>Extraccions (ETL)</li>\n</ul>\n\n<p><strong>1.2 Des del moment del disseny l'Arquitectura ha de ser desacoblada</strong> per permetre als components i aplicacions mantenir-se completament autònoms i independents:</p>\n\n<ul>\n    <li>1.2.1 Components autònoms (separació de la frontend/presentació i el backend/negoci), es desenvolupen i es despleguen independentment.</li>\n    <li>1.2.2 Components independents, poden ser reemplaçats o actualitzats sense afectar a la resta de components.</li>\n\t<li>1.2.3 Desacoblament entre aplicacions. Cal evitar les relacions entre aplicacions que impedeixin el seu desacoblament. Per exemple, relacions en l'àmbit de base de dades, ús de llibreries compartides, fitxers de configuració compartits, etc. </li>\n</ul>\n\n<p><strong>1.3 Arquitectura orientada a serveis</strong>. Cada cop més, les aplicacions poden ser consumides externament (exposant la seva funcionalitat) o bé han d’integrar-se amb aplicacions de tercers. Les relacions s'han de dur a terme mitjançant serveis.\n</p>\n<p><strong>1.4 Model de qualitat</strong>, a l’hora de dissenyar un sistema cal incorporar aspectes qualitatius al cicle de vida, per més informació visitar el <a href=\"https://qualitat.solucions.gencat.cat/\">Portal de Qualitat.</a> </p>\n\n<p> <strong>1.5 Integració contínua i custòdia de codi</strong>\n<ul>\n\t<li> 1.5.1 Totes les aplicacions han de tenir custodiat el codi font a algun dels repositoris oficials de la Generalitat.</li>\n\t<li> 1.5.2 Totes les aplicacions han d'estar preparades per ser desplegades de forma automàtica utilitzant les eines proporcionades pel <a href=\"https://canigo.ctti.gencat.cat/sic-documentacio/\">Sistema d'Integració Continua.</a></li>\n\t<li> 1.5.3 Els components a desplegar han de ser els mateixos per tots els entorns. Per tant, el que s'hagi desplegat a Integració o Preproducció s'ha de poder desplegar a Producció sense necessitat de fer-hi canvis.</li>\t\n</ul>\t\n</p>\n<p> <strong>1.6 <a href=\"http://ctti.gencat.cat/ca/ctti/solucions-corporatives/\">Solucions transversals</a></strong>. Es prioritzarà la utilització de solucions transversals en lloc de fer solucions a mida. S'ha d'evitar desenvolupar les funcionalitats que ja estan disponibles. A continuació es detallen algunes de les solucions transversals més esteses.</strong>\n<ul>\n\t<li> <strong>1.6.1 Ús del framework Canigo</strong>. Per aplicacions JEE s'ha de fer ús del <a href=\"https://canigo.ctti.gencat.cat/canigo/framework/\">Framework Canigó.</a></li>\n\t<li><strong>1.6.2 Servidors SMTP transversals</strong>, utilitzar els servidors SMTP transversals (IronPort) com servidor SMTP per enviar correus des de les aplicacions.\n\t\t\t<a href=\"https://portic.ctti.gencat.cat/solucions/soltecnologiques/_layouts/15/WopiFrame.aspx?sourcedoc=%2Fsolucions%2Fsoltecnologiques%2FDocuments%2FLloc%20de%20Treball%2F10%2D02%2FCTTI%5F9%2E61%5FIntegraci%C3%B3%5FSMTP%5FIronPort%2Epdf&action=view\">Manual per a la integració SMTP</a></li>\n\t<li><strong>1.6.3 Accés a internet des de xCAT</strong>, per accedir a recursos internet des de servidors ubicats a la xarxa XCAT, és necessari utilitzar el ProxyPass, mai accedir directament a internet.</li>\n\t<li><strong>1.6.4 Gestió d'identitats</strong>, les aplicacions han d’autentificar els usuaris tenint en compte els següents models: </li>\n\t<ul>\n\t\t<li>1.6.4.1 Col·lectiu Gencat: autentificació mitjançant <a href=\"http://ctti.gencat.cat/ca/ctti/solucions-corporatives/gestio-didentitats/\">“GICAR”</a>.</li>\n\t\t<li>1.6.4.2 Col·lectiu Híbrid (Gencat/Empreses): autentificació mitjançant <a href=\"http://ctti.gencat.cat/ca/ctti/solucions-corporatives/gestio-didentitats/\">“GICAR”</a>.</li>\n\t\t<li>1.6.4.3 Ciutadans: autentificació mitjançant <a href=\"https://www.aoc.cat/serveis-aoc/valid/\">“VÀlid”</a> d'AOC.</li>\n\t</ul>\n\t<li><strong>1.6.5 Sistema de gestió del document electrònic </strong>(<a href=\"http://ctti.gencat.cat/ca/ctti/solucions-corporatives/solucions-de-suport/sistema-de-gestio-del-document-electronic-sgde/\">SGDE</a>), proporciona als Sistemes d’Informació, les principals funcions necessàries per al tractament i transformació del document electrònic, per tal de donar suport a l’intercanvi fiable i segur de documents i informació entre els ciutadans i la Generalitat de Catalunya.</li>\t\n\t<li><strong>1.6.6 Gestor de continguts web </strong>(<a href=\"http://ctti.gencat.cat/ca/ctti/solucions-corporatives/comunicacio-i-relacio/webs/geco/\">GECO+</a>), permet crear i mantenir continguts i portals d'internet mitjançant un conjunt de peces i serveis comuns (framework).</li>\t\n<li><strong>1.6.7 PICA - Plataforma d'interoperabilitat</strong>(<a href=\"http://ctti.gencat.cat/ca/ctti/solucions-corporatives/administracio-electronica/serveis-dintegracio-i-interoperabilitat/\">PICA</a>). Plataforma que permet l'accés a informació dels organismes de la Generalitat i altres administracions públiques i institucions, el consum de serveis comuns de tramitació, la integració entre els Sistemes d'Informació departamentals i la plataforma de tramitació corporativa. Tot sota criteris d'estandardització, rapidesa, senzillesa, seguretat i legalitat.</li>\n\n<li><strong>1.6.8 Tramitador d'ajuts i subvencions - </strong>(<a href=\"http://ctti.gencat.cat/ca/ctti/solucions-corporatives/tramitacio-i-gestio-de-serveis/tais/\">TAIS</a>). Sistema d'informació per a la gestió electrònica d'expedients de gestió de subvencions.</li>\n</ul>\n<p></p>\n\n## 2. Principis sobre la Tecnologia\n\n<p><strong>2.1 Continuïtat tecnològica</strong>. D’acord a les necessitats i amb l’objectiu de millorar el manteniment i evolució de les aplicacions es promou:\n\n<ul>\n\t<li> 2.1.1 Per a la creació d’aplicacions orientades a serveis, els serveis (backend) exposaran el seu negoci mitjançant REST i en format JSON (REST permet ser consumit per qualsevol tecnologia que interpreti Http).</li>\n\t<li> 2.1.2 En el cas d’aplicacions web, la presentació estarà construïda amb tecnologies estàtiques  (html5/javascript/css) i consumirà els serveis que li proporcioni el backend. </li>\n</ul>\n\n<p><strong>2.2 Estabilitat de les versions de programari</strong>. Les versions de les diferents peces (productes, llibreries...) que composen un sistema han de ser el més estables possible. S'ha de fer ús de versions LTS (Long-Term Support) o bé, o en la seva mancança, la GA (General Availability) o la nomenclatura que hagi donat el fabricant com a estable. Un sistema productiu no pot incorporar versions no consolidades (snapshot, alpha, beta, release candidate, milestone...) dels components que en formin part.</p>\n\n<p><strong>2.3 Interoperabilitat</strong>. El programari i el maquinari han d’ajustar-se a estàndards definits que promouen la interoperabilitat de dades, aplicacions i tecnologia.</p>\n\n<p><strong>2.4 <a href=\"https://qualitat.solucions.gencat.cat/estandards/\"> Els estàndards de qualitat</a></strong> definits pel CTTI són aplicables al desenvolupament, manteniment i ús de les solucions TI de la Generalitat de Catalunya. A continuació es llisten els relacionats amb els principis d'arquitectura\n<ul>\n<li><strong>2.4.1 Full de ruta</strong>. Davant solucions estàndard s’utilitzaran preferentment els components que es troben al <a href=\"https://qualitat.solucions.gencat.cat/estandards/estandard-full-ruta-programari/\">Full de Ruta</a> en la versió \"versió actual CTTI\". Aquest fet no exclou que per a noves solucions es puguin proposar altres tecnologies que, eventualment, podran passar a formar-ne part. La reutilització d'infraestructura ja existent no eximeix del requeriment d'actualitzar el programari en cas que aquest ja no estigui suportat pel fabricant.</li>\n<li><strong>2.4.2 Principis de la guia Web Gencat</strong>, són d'aplicació els principis detallats a la <a href=\"http://guiaweb.gencat.cat/ca/inici/\"> Guia Web Gencat per aplicacions orientades a la ciutadania.</a></li>\n<li><strong>2.4.3 Nomenclatura de dominis</strong>, respectar les nomenclatures de noms de dominis del document <a href=\"https://qualitat.solucions.gencat.cat/estandards/estandard-dominis-dns/\">Estàndards Dominis DNS.</a></li> \n<li><strong>2.4.4 Nomenclatura de les infraestructures</strong>, s'ha de complir l'estàndard pel que fa al nom de les infraestructures detallat al document <a href=\"https://qualitat.solucions.gencat.cat/estandards/estandard-nomenclatura-infraestructures/\">Estàndard nomenclatura infraestructures</a></li>\n</ul>\n</p>\n\n<p><strong>2.5 Ús de Cloud Públic</strong>. Cal valorar l'ús d'entorns de Cloud Públic. Recomanat per aplicacions amb les característiques detallades a continuació:\n<ul>\n\t<li> Aplicacions que no siguin crítiques pel negoci.</li>\n\t<li> Utilitzades des d'internet. </li>\n\t<li> Sense requeriments de seguretat alts. </li>\n\t<li> Si requereix integració amb altres serveis de Generalitat de Catalunya, aquesta ha de ser lleugera. </li>\n</ul>\n</p>\n\n<p><strong>2.6 Ús d'Https</strong>. Les urls de les aplicacions i els serveis publicats tant a internet com a xCAT (xarxa intranet de la Generalitat) es faran mitjançant l'ús de protocols segurs (https).</p>\t\n\n<p><strong>2.7 Mateixa arquitectura per Preproducció i Producció</strong>. Perquè les proves fetes a preproducció tinguin validesa, és necessari que els entorns de preproducció i producció siguin idèntics pel que fa al disseny, encara que els recursos assignats a preproducció siguin inferiors.</p>\n\n\n## 3. Principis sobre el cost i manteniment de les solucions\n\n<p><strong>3.1 Optimització de costos</strong>, pensar en els costos i en la seva optimització:</p>\n<ul>\n    <li>3.1.1 Monitoritzar els serveis per a identificar necessitats d’ampliació o reducció de recursos i poder ajustar els costos en conseqüència.</li>\n    <li>3.1.2 Dissenyar l’arquitectura amb una planificació de les càrregues de treball òptima en costos, de forma que s’equilibrin quan sigui possible les finestres d’execució dels components (online, extraccions, analítica, processos batch ...), per evitar els pics de càrrega i que es reparteixi de forma balancejada segons les necessitats del negoci.</li>\n    <li>3.1.3 Arquitectura mínima. Cal tenir en compte l’escalabilitat i fer una previsió (mínim 1 any) amb l’objectiu d’aconseguir una arquitectura sostenible en el temps.</li>\n</ul>\n\n<p><strong>3.2 Benefici màxim al menor cost i risc possible</strong>. Cal tenir presents els costos d’infraestructura i el model de llicenciament requerits per a posar en marxa una solució, ja que representen un cost recurrent. A l'hora de concebre una solució s’ha d’identificar quin tipus de llicenciament serà el millor per la solució desitjada. Quan s’escull un producte (opensource o comercial) o es tria fer un desenvolupament a mida, cal fer una avaluació del cost vs. benefici de l’opció triada respecte a les altres: </p>\n<ul>\n    <li>3.2.1 Per a problemes comuns, utilitzar “Opensource”. </li>\n    <li>3.2.2 Per a problemes poc comuns, comprar. </li>\n    <li>3.2.3 Per a problemes únics, desenvolupar a mida.</li>\n</ul>\n\n<p><strong>3.3 Impacte d’actualització</strong>, pensar en l’impacte d’actualització que pugui tenir un canvi de sistema operatiu, middleware o producte allà on s'executa l’aplicació: com menys acoblament amb el sistema de base i més utilització d’estàndards existeix, més senzilla serà l’actualització o l’ampliació de funcionalitats de l’aplicació.</p>\n","objectID":"L3ByaW5jaXBpcw=="},"L25vdGljaWVzLzIwMTktMDItMjAtcm9hZG1hcC1jYW5pZ28=":{"date":1550620800000,"title":"Canigó. Roadmap del framework","description":"En aquesta notícia presentem el roadmap previst per les properes versions del framework Canigó","sections":["Notícies","home"],"categories":["canigo"],"key":"MARC2019","path":"/noticies/2019-02-20-roadmap-canigo","content":"En aquesta notícia presentem el roadmap previst per les properes versions del framework Canigó:\n\n![canigo-roadmap](/images/news/canigo-roadmap.PNG)\n\n<br />\n### Canigó 3.4.0 (LTS)\n\nEn aquesta versió es realitzarà una actualització tecnològica del framework per tal d'anar a versions suportades de Java i Spring principalment, i donar suport a nous paradigmes de programació. També s'inclou l'actualització del connector amb la Plataforma de Serveis de Gestió Documental (PSGD), també coneguda com a ARESTA.\n\n**Actualització tecnologies base**\n\n* Java 11\n* Spring 5\n* Spring Boot 2\n* Spring Security 5\n\n**Arquitectura**\n\n* Possibilitat d’utilització propietats en yml\n* Programació amb estàndard de Streams Reactius\n* Programació reactiva (Spring WebFlux)\n* Programació funcional (Spring WebFlux)\n* Suport servidors incrustats amb suport a reactiu (Jetty, Undertow)\n* Certificació amb servidors embeguts (Spring Boot)\n\n**Connectors**\n\n* Actualització connector amb ARESTA\n\n### Canigó 3.4.1\n\nEn aquesta versió es persegueix principalment certificar el framework Canigó 3.4.x amb els servidors suportats al [full de ruta del CTTI](https://qualitat.solucions.gencat.cat/estandards/estandard-full-ruta-programari/). També fer difusió i millorar la productivitat dels equips de desenvolupament permetent la generació d'aplicacions Canigó 3.4.x mitjançant l'[entorn de desenvolupament de Canigó](https://canigo.ctti.gencat.cat/canigo/entorn-desenvolupament/).\n\n**Productivitat**\n\n* Actualització plugin Eclipse Canigó\n* Actualització entorn de desenvolupament\n\n**Arquitectura**\n\n* Certificació amb servidors del full de ruta del CTTI\n\n**How-to's**\n\n* Spring profile amb Canigó\n* Exemples de programació amb streams reactius, programació reactiva, programació funcional\n\n### Canigó 3.5.0 (Interna)\n\nEn aquesta versió interna, no destinada a entorns productius, es realitzarà un pilot d'arquitectura de microserveis.\n\n**Pilot**\n\n* Aplicació amb microserveis\n* Integració amb peces d’un sistema de microserveis\n    * Configuration service (Consul, Spring Cloud Config Server, ...)\n    * Discovery service (Consul, Eureka Server, ...)\n    * Gateway service (Zuul proxy, Ribbon, Istio, ...)\n    * Acces control service (Spring Session, Istio, ...)\n    * Cache distribuida (Hazelcast, Redis, ...)\n    * Client balancing (Ribbon, Hystrix, Turbine, Istio, ...)\n    * Telemetria (Prometheus, Grafana, ...)\n    * Traces distribuides (Zipkin)\n    * Explotació traces (Logstash, Elastic Search, Kibana)\n\n### Canigó 3.5.1 (Interna)\n\nEn aquesta versió interna, no destinada a entorns productius, es realitzarà un pilot amb una aplicació Canigó 3.4.x per integrar-la amb serveis centralitzats de telemetria i traces, així com afegir-hi tests amb el suport d'entorns dockeritzats. També es planteja un nou generador d'aplicacions Canigó de l'estil [Spring Initializr](https://start.spring.io/) totalment agnòstic de l'IDE de desenvolupament.\n\n**Pilot**\n\n* Ampliació de la telemetria d’una aplicació (Prometheus, Grafana, ...)\n* Ampliació de l’explotació traces d’una aplicació (Logstash, Elastic Search, Kibana)\n* Ampliació execució test amb containers (Testcontainers, VuGen)\n\n**Productivitat**\n\n* Generació de projecte Canigó a partir de web inicialitzadora\n\n<br />\nA banda del framework Java, des del CS Canigó s'estan avaluant altres iniciatives com proporcionar mòduls de suport a frontends web amb la finalitat d'estandaritzar i facilitar tant el desenvolupament com la integració amb el SIC (construcció, test, desplegament).\n\n<br />\nPer qualsevol suggerència o consulta relativa a aquest roadmap podeu obrir un tiquet al servei [CAN](https://cstd.ctti.gencat.cat/jiracstd/projects/CAN) del CSTD, o enviar un correu a la bústia [oficina-tecnica.canigo.ctti@gencat.cat](mailto:oficina-tecnica.canigo.ctti@gencat.cat).\n","objectID":"L25vdGljaWVzLzIwMTktMDItMjAtcm9hZG1hcC1jYW5pZ28="},"L3NnZGUvYWJvdXQ=":{"date":1422115902000,"title":"Què és el Servei de Gestió del Document Electrònic (SGDE)","description":"Plataforma, funcionalitats i ús del servei","sections":"SGDE","toc":false,"taxonomies":[],"weight":1,"path":"/sgde/about","content":"El **Servei de Gestió del Document Electrònic** proporciona als sistemes d'informació les principals funcions necessàries per al tractament i transformació del document electrònic per tal de donar suport a l'intercanvi fiable i segur de documents i informació entre els ciutadans i la Generalitat de Catalunya.\r\n\r\nPer implementar-ho s'ha desplegat un entorn corporatiu de valor afegit, basat en el format PDF, que proporciona uns serveis d'invocació (WebServices) que poden ser utilitzats des de qualsevol llenguatge o plataforma.\r\nL'arquitectura aplicada aporta la disponibilitat i flexibilitat necessària per a absorbir la demanda estacionals dels diferents departaments (campanyes, convocatòries, etc.).\r\n\r\n## Plataformes\r\n\r\nActualment l'SGDE té integrades dues plataformes:\r\n\r\n- Plataforma de **Formularis Adobe**\r\n- **Sistema de Transformació de Documents** o STD\r\n\r\n\r\n## Funcionalitats\r\n\r\nEl servei SGDE dóna resposta a la gestió del document en les transaccions per via telemàtica entre la Generalitat i els ciutadans, empreses i/o empleats públics.\r\n\r\nLes funcionalitats que ofereix s'agrupen pel tipus de plataforma on es troben implementades;\r\n\r\n### Plataforma de Formularis Adobe \r\n\r\n- Extracció de dades d'un formulari\r\n- Creació de formularis a partir de dades\r\n- Conversió de formularis intel.ligents en documents PDF plans (aplanat de formularis)\r\n- Signatura bàsica de documents amb un certificat genèric Generalitat \r\n\r\n### Sistema de Transformació de Documents o STD \r\n\r\n- Conversió a format pdf/a per a permetre la compatibilitat amb el temps\r\n- Normalització de format: Conversió de diferents formats ofimàtics al format PDF.\r\n- Transformació de documents: El sistema permet afegir informació en qualsevol dels quatre marges de cada pàgina dels documents d'entrada (imatges, texts, números de pàgina, codis QR etc.). També permetrà afegir una marca d'aigua en qualsevol posició del document.\r\n- Codi verificació de documents: Creació d'un codi segur de verificació (CSV) per a la identificació i registre del document i posicionament d'aquest codi sobre el document.\r\n\r\n## Ús del Servei\r\n\r\nPer poder utilitzar algun dels serveis de l'SGDE és necessari donar-se d'alta en alguna de les plataformes que l'integren. Per poder fer-ho s'ha de consultar la secció \"Documentació SGDE\" d'aquesta secció i seguir els passos documentats per cada plataforma.\r\n\r\nMes informació en [oficina-tecnica.canigo.ctti@gencat.cat](mailto://oficina-tecnica.canigo.ctti@gencat.cat)\r\n\r\n","objectID":"L3NnZGUvYWJvdXQ="},"L25vdGljaWVzLzIwMTktMDQtMTYtc3RkLWVuLXNlcnZlaS1ub3UtZW50b3JuLXByZQ==":{"date":1555372800000,"title":"STD. En servei nou entorn de Preproducció","description":"L'últim trimestre del 2018 es va iniciar un projecte d'actualització tecnològica del STD (Servei de Transformació de Documents), realitzant una rearquitectura per tal de millorar l'aïllament de les diferents funcionalitats que es proporcionen i la seva escalabilitat. En data 15/04/2019 s'ha posat en servei el nou entorn de Preproducció","sections":["Notícies","home"],"categories":["sgde"],"key":"MAIG2019","path":"/noticies/2019-04-16-std-en-servei-nou-entorn-pre","content":"L'últim trimestre del 2018 es va iniciar un projecte d'**actualització tecnològica del servei STD (Servei de Transformació de Documents)**. També es realitza una **rearquitectura** del servei per tal de millorar l'aïllament de les diferents funcionalitats que es proporcionen i la seva escalabilitat. \n\nLes principals funcionalitats que ofereix el servei STD són:\n\n* Creació de codis segurs de verificació (**CSV**) per a la identificació i registre de documents\n* **Composició** de documents PDF, consistent en la fusió de plantilles que contenen una sèrie de tags especials\namb informació sobre les dades a inserir en els documents originals\n* **Conversió** de diferents formats ofimàtics a PDF\n* **OCR** (Optical Character Recognition) per obtenir el text d’una imatge i generació de PDFs cercables\n\n## Rearquitectura\n\nEls principals punts de la rearquitectura són:\n\nTota la capa d'aplicació del servei STD es mou de VM a contenidors [**Docker**](https://canigo.ctti.gencat.cat/cloud/cataleg/#contenidors-docker) a la plataforma [**AppAgile**](https://canigo.ctti.gencat.cat/cloud/contenidors_appagile/).\n\n![std2-arquitectura](/images/news/std2-arquitectura.PNG)\n\nTotes les funcionalitats del STD avui dia són exposades mitjançant serveis **SOAP**, i amb l'actualització tecnològica, s'exposarà una nova **API REST**.\n\n## Actualització tecnològica\n\nA continuació es detalla les actualitzacions de versions i canvis de productes més rellevants:\n\n* Tots els serveis es basen en [**Canigó**](https://canigo.ctti.gencat.cat/canigo/), i s'actualitzen a la versió [3.2.7](https://canigo.ctti.gencat.cat/canigo/roadmap/)\n* Es canvia l'engine de conversió de MS Office a PDF, passant de [J-Interop](http://www.j-interop.org/) a [**documents4j**](https://documents4j.com/)\n* S'actualitza la versió de **MS Office** de 2010 a 2016\n* S'actualitza OpenOffice 4.0.1 a **LibreOffice** 5.4.5.1\n* S'actualitza la versió de [**Tesseract**](https://opensource.google.com/projects/tesseract), engine OCR, de 3.02.02 a 3.05.02\n* S'actualitzen les versions de les llibreries de tractament de documents PDF (PDFBox, iText) així com d'altres d'ús intern dels diferents serveis\n\n## Impacte en integradors\n\nEl canvi tecnològic s'ha realitzat tenint en compte que l'impacte en els consumidors actuals sigui mínim. És per aquest motiu que es mantindran intactes les URLs actuals d'accés al servei SOAP:\n\n**WS SOAP**\n\n* _PRE_: ```http://preproduccio.sgde.intranet.gencat.cat/ServeisInvocacioSTD/services/ServeisSTD<V2>?wsdl```\n\n* _PRO_: ```http://sgde.intranet.gencat.cat/ServeisInvocacioSTD/services/ServeisSTD<V2>?wsdl```\n\n*L'antic domini de PRE \"sgde.pre.intranet.gencat.cat\" també seguirà funcionant com fins ara\n\nTambé l'accés SFTP:\n\n**SFTP**\n\n* _PRE_: ```sftp <usuari-app>@preproduccio.sftp.sgde.intranet.gencat.cat```\n\n* _PRO_: ```sftp <usuari-app>@sftp.sgde.intranet.gencat.cat```\n\n*L'antic domini de PRE \"sftp.sgde.pre.intranet.gencat.cat\" també seguirà funcionant com fins ara\n\nA més dels dominis existents, es donaran d'alta nous dominis dedicats al STD, en el cas de l'accés http amb la possibilitat de fer-ho per SSL:\n\n**WS SOAP (NOU!)**\n\n* _PRE_: ```https://preproduccio.std.intranet.gencat.cat/ServeisInvocacioSTD/services/ServeisSTD<V2>?wsdl```\n\n* _PRO_: ```https://std.intranet.gencat.cat/ServeisInvocacioSTD/services/ServeisSTD<V2>?wsdl```\n\n**SFTP (NOU!)**\n\n* _PRE_: ```sftp <usuari-app>@preproduccio.sftp.std.intranet.gencat.cat```\n\n* _PRO_: ```sftp <usuari-app>@sftp.std.intranet.gencat.cat```\n\nLes IPs relacionades amb els dominis són:\n\n**WS SOAP**\n\n* _PRE_: ```preproduccio.sgde.intranet.gencat.cat 10.1.126.83```\n* _PRE_: ```sgde.pre.intranet.gencat.cat 10.1.126.83```\n\n* _PRO_: ```sgde.intranet.gencat.cat 10.1.118.54```\n\n**SFTP**\n\n* _PRE_: ```preproduccio.sftp.sgde.intranet.gencat.cat 10.53.4.16```\n* _PRE_: ```sftp.sgde.pre.intranet.gencat.cat 10.53.4.16```\n\n* _PRO_: ```sftp.sgde.intranet.gencat.cat 10.52.4.103```\n\n**WS SOAP (NOU!)**\n\n* _PRE_: ```preproduccio.std.intranet.gencat.cat 10.53.12.21```\n\n* _PRO_: ```std.intranet.gencat.cat 10.52.12.31```\n\n**SFTP (NOU!)**\n\n* _PRE_: ```preproduccio.sftp.std.intranet.gencat.cat 10.53.4.16```\n\n* _PRO_: ```sftp.std.intranet.gencat.cat 10.52.4.103```\n<br />\n<br />\nEn data **15/04/2019** es va fer efectiva la posada en servei el nou entorn de **Preproducció**. Proporcionant el servei de STD amb la nova rearquitectura\n<br />\n<br />\nLa data prevista de posada en servei del nou entorn de **Producció** és el **09/05/2019**. Quan s'hagi materialitzat el canvi al nou entorn de Producció s'informarà, tant en aquest portal, com mitjançant comunicats destinats als integradors.\n<br />\n<br />\nPodeu trobar més detall de la rearquitecura a la noticia publicada al portal [STD. Actualització tecnològica del servei](/noticies/2019-02-20-actualitzacio-tecnologica-std/)\n\nPer qualsevol dubte referent a aquest projecte de transformació tecnològica us podeu posar en contacte amb el CS Canigó obrint una petició de consulta o suport al servei [STF](https://cstd.ctti.gencat.cat/jiracstd/projects/STF) del CSTD, o bé enviant un correu a [oficina-tecnica.canigo.ctti@gencat.cat](mailto:oficina-tecnica.canigo.ctti@gencat.cat)\n","objectID":"L25vdGljaWVzLzIwMTktMDQtMTYtc3RkLWVuLXNlcnZlaS1ub3UtZW50b3JuLXByZQ=="},"L3NnZGUvZG9jdW1lbnRhY2lv":{"date":1422115902000,"title":"Documentació","description":"Documentació comú, manuals i formularis específics per cada plataforma","sections":"SGDE","taxonomies":[],"weight":2,"path":"/sgde/documentacio","content":"### Presentació del servei\n\n- [Presentació](/related/sgde/Presentació-SGDE.pdf)\n\nPer poder utilitzar els serveis del SGDE és necessari donar-se d'alta en alguna de les plataformes següents:\n\n###  Plataforma de Formularis Adobe\n\n- [Sobre Formularis](/sgde-related/intro-formularis)\n\n- [Manual d'Usuari - Servei d'Invocació de Formularis](/related/sgde/Manual-Usuari-Serveis-Invocació.pdf)\n- [Manual d'Usuari - Autoservei](/related/sgde/Manual-Usuari-Servei-Corporatiu-de-Formularis-Electrònics-v9.pdf)\n\n- [Normatiu servei corporatiu de formularis electrònics](/related/sgde/SC-NOR15-01-Norma-servei-corporatiu-de-formularis-electrònics.pdf)\n- [Llibre blanc servei corporatiu de formularis - Adobe LiveCycle](/related/sgde/GE-Llibre blanc servei corporatiu de formularis.pdf)\n\n###  Sistema de Transformació de Documents o STD\n\n- [Sobre l'STD](/sgde-related/intro-std)\n\n- [Manual d'Usuari](/related/sgde/CSCanigo.MU.P00.E01_manual_usuari_STD.pdf)\n- [Manual de Creació de Plantilles](/related/sgde/CSCanigo.MU.P00.E01_Manual_creacio_plantilles_STD.pdf)\n\n- [Formulari d'Alta d'aplicació](/related/sgde/CSCanigo.PA.P00.STD_ALTA_ambit-aplicacio.xlsx)\n","objectID":"L3NnZGUvZG9jdW1lbnRhY2lv"},"L3NnZGUvc3Rk":{"date":1422115902000,"title":"Sistema de Transformació de Documents (STD)","description":"Descripció del servei","sections":"SGDE","taxonomies":[],"weight":4,"path":"/sgde/std","content":"El CTTI ofereix una plataforma on es troba disponible el Sistema de Transformació de Documents o STD. Aquesta plataforma s'integra dintre del grup de Serveis del SGDE (Sistema de Gestió de Documents Electrònics) del CTTI juntament amb la plataforma de Formularis Electrònics.\r\n\r\nEls serveis inclosos per aquesta plataforma són:\r\n\r\n- Transformació de documents Ofimàtics (Word, Excel, PowerPoint, OpenOffice, etc.) a PDF.\r\n- Conversió de documents PDF mitjançant plantilles.\r\n\t- Operacions de Translació, Rotació i Escalatge.\r\n\t- Inserció de diferents tipus de Tags de Text, Imatges, Codis QR, Codis de Barres, Codis CSV i Marques d'Aigua.\r\n- Generació de Codis Segurs de Validació o CSV\r\n\r\nQualsevol aplicació que ho sol.liciti pot treballar amb l'STD prèvia petició d'alta en la plataforma. Per fer-ho s'ha d'enviar la Plantilla d'Alta al Servei, degudament omplerta a [oficina-tecnica.canigo.ctti@gencat.cat](mailto://oficina-tecnica.canigo.ctti@gencat.cat), sol.licitant formalment l'alta.\r\n","objectID":"L3NnZGUvc3Rk"},"L3NnZGUvZm9ybXVsYXJpcw==":{"date":1422115902000,"title":"Formularis electrònics","description":"Descripció del servei d'eFormularis","sections":"SGDE","taxonomies":[],"weight":3,"path":"/sgde/formularis","content":"El CTTI disposa d'una plataforma de formularis electrònics que permet la interacció amb formularis PDF dinàmics basats en Adobe Livecycle ES4 SP1 sota una arquitectura amb disponibilitat i tolerància a fallades.\r\n\r\nA més, i aquest és un dels principals avantatges respecte a la solució única amb Adobe, s'ofereix un servei d'accés a les funcionalitats requerides en el tractament de formularis electrònics sense cap necessitat de conèixer l'API que ofereix Adobe.\r\nPer a la construcció dels formularis Adobe se seguiran les recomanacions dels següents llibres normatius del CTTI:\r\n\r\n- Llibre blanc servei corporatiu de formularis\r\n- Llibre normatiu (NOR15-01 6-11-08)\r\n\r\nAquests documents i més informació com l'arquitectura de la plataforma i els procediments de treball es poden consultar dintre de l'apartat de documentació de Formularis electrònics al Portal del Centre de Suport Canigó http://canigo.ctti.gencat.cat/sgde/documentacio/\r\n","objectID":"L3NnZGUvZm9ybXVsYXJpcw=="},"L3NnZGUtcmVsYXRlZC9pbnRyby1mb3JtdWxhcmlz":{"date":1422115902000,"title":"Formularis electrònics (eFormularis)","description":"Plataforma de formularis electrònics Adobe","sections":"SGDE","taxonomies":[],"weight":3,"path":"/sgde-related/intro-formularis","content":"El CTTI disposa d'una plataforma de formularis electrònics que permet la interacció amb formularis PDF dinàmics basats en Adobe Livecycle ES4 SP1 sota una arquitectura amb disponibilitat i tolerància a fallades.\r\n\r\nA més, i aquest és un dels principals avantatges respecte a la solució única amb Adobe, s'ofereix un servei d'accés a les funcionalitats requerides en el tractament de formularis electrònics sense cap necessitat de conèixer l'API que ofereix Adobe.","objectID":"L3NnZGUtcmVsYXRlZC9pbnRyby1mb3JtdWxhcmlz"},"L3NnZGUvc2VydmVpLWZvcm11bGFyaXMtaHRtbDU=":{"date":1525219200000,"title":"Formularis HTML5 a eFormularis","description":"Formularis HTML5 a eFormularis","sections":"SGDE","taxonomies":[],"toc":true,"weight":5,"path":"/sgde/servei-formularis-html5","content":"## Introducció\r\n\r\nEn l'actualització tecnològica realitzada durant el 2018 (23-4-2018 Preproducció - 13-6-2018 Producció) a la plataforma d'eFormularis, Adobe LiveCycle es substituït per **AEM (Adobe Experience Manager)**, el qual incorpora noves funcionalitats relatives a formularis HTML5.\r\n\r\nEls **Adaptive Forms** són els formularis HTML5 d'AEM amb capacitat multi-dispositiu. Això vol dir que responen de forma diferent, s'adapten, depenent del dispositiu on siguin executats. Un altre gran diferència respecte als formularis PDF, és que el mode d'execució és **on-line**. El formulari ja no es descarrega i s'emplena en mode **off-line** com en el cas dels PDF, per a ser enviats posteriorment.\r\n\r\nD'aquí en endavant, quan s'anomeni un formulari HTML5 ens estem referint exclusivament a un adaptive form d'AEM.\r\n\r\n## Sol·licitud alta aplicació\r\n\r\nPer a que una aplicació web pugui incorporar un formulari HTML5 gestionat pel servei d'eFormularis, cal que faci arribar una petició de sol·licitud d'alta al [servei STF del JIRA CSTD](https://cstd.ctti.gencat.cat/jiracstd/browse/STF) proporcionant la següent informació:\r\n\r\n**Dades generals**\r\n\r\n- _Àmbit_: àmbit al que pertany l'aplicació (Ex. DGAC, TSF, CTT, ...)\r\n- _Codi de diàleg aplicació_: codi de diàleg de l'aplicació\r\n- _Nom aplicació_: nom descriptiu de l'aplicació\r\n- _Responsable CTTI_: persona responsable per part de CTTI de l'aplicació\r\n- _Responsable proveïdor d'aplicacions_: persona responsable per part del lot d'aplicacions\r\n\r\n**Dades tècniques**\r\n\r\n- _Endpoint de preomplert de dades_: nom dns i port del servei que expossa l'endpoint per l'obtenció de les dades (XML o JSON) per realitzar el preomplert del formulari. Si el formulari no requereix preomplert de dades, ni per les noves instanciacions ni per carregar esborranys, no cal proporcionar aquesta informació\r\n- _Endpoint de submit_: en cas que el formulari tingui un botó de tipus submit, caldrà que s'especifiqui el nom dns i port del servei que expossa l'endpoint al que es farà l'enviament de les dades. Si el formulari tindrà una acció per fer l'enviament de les dades del formuari via AJAX sense ser de tipus submit, no cal proporcionar aquesta informació\r\n\r\nCom a resposta a la sol·licitud d'alta, el equip del CS Canigó retornarà la URL base dels formularis de l'aplicació al servei d'eFormularis:\r\n\r\n- PRE: https://preproduccio.publicador.eformularis.intranet.gencat.cat/content/forms/af/&lt;aplicacio&gt;/&lt;formulari&gt;.html\r\n- PRO: https://publicador.eformularis.intranet.gencat.cat/content/forms/af/&lt;aplicacio&gt;/&lt;formulari&gt;.html\r\n\r\nTambé confirmarà que s'han habilitat les connectivitats requerides des del servei d'eFormularis cap als endpoints necessaris per la integració.\r\n\r\n## Model d'integració\r\n\r\n![model-integracio-formularisHTML5](/related/sgde/model_integracio_formularis-html5.png)\r\n\r\n### Frontals web aplicació\r\n\r\nCom es pot observar en el punt anterior, el lloc web on es vulgui incorporar el formulari ha de tenir uns frontals web (Apache, NGinx,...) com a part de la seva infraestructura. El motiu és que, per tal de mantenir el context dins l'aplicació i no fer una redirecció a un altre domini, cal fer una sèrie de configuracions en aquests frontals per tal que l'accés al servei d'eFormularis sigui transparent.\r\n\r\nEn la secció [Configuracions](#configuracions) es pot veure el detall de les configuracions a realitzar.\r\n\r\n#### Regles de firewall\r\n\r\nEls frontals web de l'aplicació hauran de tenir connectivitat amb el servei de publicació de Formularis HMTL5 d'eFormularis:\r\n\r\n\t- PRE\r\n\t\tNom: preproduccio.publicador.eformularis.intranet.gencat.cat\r\n\t\tIP: 10.1.126.79\r\n\t\tPort: 443\r\n\t- PRO:\r\n\t\tNom: publicador.eformularis.intranet.gencat.cat\r\n\t\tIP: 10.1.118.51\r\n\t\tPort: 443\r\n\r\n### Consideracions de seguretat\r\n\r\nEs recomana que l'aplicació incorpori un token en la crida al formulari, i que aquest s'enviï en l'enviament de les dades del formulari per tal que l'aplicació pugui fer les validacions pertinents (autenticitat, timeout).\r\n\r\n## Cicle de vida formulari HTML5\r\n\r\nA continuació es descriu el cicle de vida pel que passa un formulari HTML5 a la plataforma d'eFormularis\r\n\r\n### Desenvolupament\r\n\r\nDesenvolupament local en una instància AEM del desenvolupador, executada en mode autor. El instal·lable d'AEM ha de ser sol·licitat al CS Canigó pel responsable CTTI de l'aplicació, preferiblement obrint una petició al servei [STF](https://cstd.ctti.gencat.cat/jiracstd/browse/STF), o bé enviant un correu a la [bústia del CS Canigó](mailto:oficina-tecnica.canigo.ctti@gencat.cat).\r\n\r\nL'execució de la instància d'AEM en mode autor permetrà al desenvolupador fer el disseny del formulari HTML5.\r\n\r\n```\r\n$ java -jar <AEM_jar>\r\n```\r\n\r\nS'ha de tenir en compte que per defecte el repositori d'AEM és crea al directori des d'on l'usuari executa aquest procés. És important ja que el volum de dades que s'hi emmagatzema és gran (5GB aproximadament) i de vital importancia per el funcionament d'AEM.\r\n\r\nEl formulari i tots els recursos associats (temes, fragments, ...) han de crear-se en un directori de l'aplicació, no directament a l'arrel. D'aquesta manera al fer l'export/import entre entorns quedaran ubicats al lloc adient.\r\n\r\n*Formularis*\r\n\r\n- PRE: https://preproduccio.autor.eformularis.intranet.gencat.cat/content/forms/af/&lt;aplicacio&gt;/&lt;formulari&gt;.html\r\n- PRO: https://autor.eformularis.intranet.gencat.cat/content/forms/af/&lt;aplicacio&gt;/&lt;formulari&gt;.html\r\n\r\n*Temes*\r\n\r\n- PRE: https://preproduccio.autor.eformularis.intranet.gencat.cat/aem/formdetails.html/content/dam/formsanddocuments-themes/&lt;aplicacio&gt;/&lt;tema&gt;\r\n- PRO: https://autor.eformularis.intranet.gencat.cat/aem/formdetails.html/content/dam/formsanddocuments-themes/&lt;aplicacio&gt;/&lt;tema&gt;\r\n\r\n### Desplegament\r\n\r\nPer tal que un formulari HTML5 sigui desplegat a eFormularis, cal seguir les següents pases:\r\n\r\n- Exportar el formulari HTML5 a l'AEM autor de desenvolupament: AEM Start -> Forms -> Forms & Documents -> Sel·leccionar formulari -> Download\r\n\r\n- Crear una petició al CSTD, [servei STF] (https://cstd.ctti.gencat.cat/jiracstd/browse/STF) especificant aquesta informacio:\r\n\r\n\t- àmbit, aplicació, nom formulari i versió (opcional, en cas que ja hi hagi alguna altre desplegada i no es vulgui sobreescriure)\r\n\t- adjunt zip amb el conjunt d'assets resultat de l'exportació del formulari\r\n\t- entorn\r\n\t- data publicació: data en que es vol programar la publicació del formulari. Si no s'informa es considerarà que es vol publicar el més aviat possible\r\n\r\n- El CS Canigó validarà el formulari a la instància AEM autor i el publicarà, retornant com a resultat la URL d'accés al formulari: \r\n\r\n\t- PRE: https://preproduccio.publicador.eformularis.intranet.gencat/content/forms/af/&lt;aplicacio&gt;/&lt;formulari&gt;.html\r\n\t- PRO: https://publicador.eformularis.intranet.gencat/content/forms/af/&lt;aplicacio&gt;/&lt;formulari&gt;.html\r\n\r\nPer altres recursos com els temes i els fragments el procediment de publicació és el mateix. Cal tenir en compte les dependències entre ells en l'ordre de publicació.\r\n\r\n#### Versionatge\r\n\r\nDonat que la URL de cada formulari ha de ser unívoca, en cas de que es vulgui que puguin conviure diferents versions d'un formulari caldrà que s'afegeix la versió a aquesta URL:\r\n\r\nhttps://preproduccio.publicador.eformularis.intranet.gencat/content/forms/af/&lt;aplicacio&gt;/&lt;formulari&gt;_1.0.0.html\r\n\r\nhttps://preproduccio.publicador.eformularis.intranet.gencat/content/forms/af/&lt;aplicacio&gt;/&lt;formulari&gt;_2.0.0.html\r\n\r\nEs recomana però que els formularis siguin sempre **backward compatible**, evitant aquest versionatge en la publicació, podent mantenir sempre la mateixa URL.\r\n\r\n### Baixa\r\n\r\nQuan un formulari o una versió en concreta estigui en desús, s'haurà de demanar al CS Canigó la seva baixa. La petició s'haurà de fer al [servei STF] (https://cstd.ctti.gencat.cat/jiracstd/browse/STF) informant la URL que l'identifica a cada entorn.\r\n\r\n## Configuracions\r\n\r\nA continuació es descriuen les principals configuracions a realitzar pel funcionament d'un formulari HTML5.\r\n\r\n### Configuració frontal web\r\n\r\nConfiguració de proxy HTTP invers als frontals web Apache de l'aplicació per l'accés als recursos (js, css, ...) d'AEM:\r\n\r\n\t<VirtualHost *:443>\r\n\t\tProxyPreserveHost On\r\n\r\n\t\tSSLProxyEngine on\r\n\t\tSSLProxyVerify none \r\n\t\tSSLProxyCheckPeerCN off\r\n\t\tSSLProxyCheckPeerName off\r\n\t\tSSLProxyCheckPeerExpire off\r\n\r\n\t\tServerName <domini-aplicacio>\r\n\r\n\t\tProxyPass /forms/ https://preproduccio.publicador.eformularis.intranet.gencat.cat/forms/\r\n\t\tProxyPassReverse /forms/ https://preproduccio.publicador.eformularis.intranet.gencat.cat/forms/\r\n\r\n\t\tProxyPass /content/ https://preproduccio.publicador.eformularis.intranet.gencat.cat/content/\r\n\t\tProxyPass /etc/ https://preproduccio.publicador.eformularis.intranet.gencat.cat/etc/\r\n\t\tProxyPass /etc.clientlibs/ https://preproduccio.publicador.eformularis.intranet.gencat.cat/etc.clientlibs/\r\n\t\t# CSRF Filter\r\n\t\tProxyPass /libs/granite/csrf/token.json https://preproduccio.publicador.eformularis.intranet.gencat.cat/libs/granite/csrf/token.json\r\n\r\n\t\tProxyPassReverse /etc/ https://preproduccio.publicador.eformularis.intranet.gencat.cat/etc/\r\n\t\tProxyPassReverse /etc.clientlibs/ https://preproduccio.publicador.eformularis.intranet.gencat.cat/etc.clientlibs/\r\n\t\t# written for thank you page and other URL present in AF during redirect\r\n\t\tProxyPassReverse /content/ https://preproduccio.publicador.eformularis.intranet.gencat.cat/content/\r\n\t</VirtualHost>\r\n\t\r\non &lt;domini-aplicacio&gt; és el domini de l'aplicació que està publicant el formulari\r\n\r\n### Incrustar formulari\r\n\r\nCodi javascript per incrustar el formulari HTML5 a la plana web de l'aplicació:\r\n\t\r\n\t <script>\r\n\t\tvar path = \"https://<domini-aplicacio>/content/forms/af/<aplicacio>/<formulari>.html\";\r\n\t\tvar pathData = \"<url-precarrega-dades>\"\r\n\t\tpath += \"/jcr:content/guideContainer.html\";\r\n\t\t$.ajax({\r\n\t\t\turl  : path ,\r\n\t\t\ttype : \"GET\",\r\n\t\t\tdata : {\r\n\t\t\t\t// Set the wcmmode to be disabled\r\n\t\t\t\twcmmode : \"disabled\",\r\n\t\t\t\t\"dataRef\": pathData\r\n\t\t\t},\r\n\t\t\tasync: false,\r\n\t\t\tsuccess: function (data) {\r\n\t\t\t\t//document.getElementById('output').innerHTML = data;\r\n\t\t\t\t$( \"div\" ).html(data);\r\n\t\t\t},\r\n\t\t\terror: function (data) {\r\n\t\t\t\t// any error handler\r\n\t\t\t}\r\n\t\t});\r\n\t </script>\r\n\r\non &lt;domini-aplicacio&gt; és el domini de l'aplicació que està publicant el formulari\r\non &lt;url-precarrega-dades&gt; és la URL de l'endpoint del qual s'obtindran les dades per el preomplert\r\n\r\n### Enviament de dades\r\n\r\nLa llibreria guideBridge ens dona una API de comunicació amb el formulari, que podem utilitzar per obtenir les dades introduïdes per el formulari.\r\n\r\nEl següent codi javascript ens dóna un exemple per a l’enviament de les dades per AJAX:\r\n\r\n\tfunction sendData (){\r\n\t\tguideBridge.getData({\r\n\t\t\tsuccess : function (guideResultObject) {\r\n\t\t\t\t//POST de guideResultObject.data a <endpoint-submit>\r\n\t\t\t},\r\n\t\t\terror : function (guideResultObject) {\r\n\t\t\t\t var msg = guideResultObject.getNextMessage();\r\n\t\t\t\t while (msg != null) {\r\n\t\t\t\t \talert(\"No s'han pogut obtenir les dades del formulari: \" + msg.message);\r\n\t\t\t\t\tmsg = guideResultObject.getNextMessage();\r\n\t\t\t\t }\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t\r\n\tsendData();\r\n \r\non &lt;endpoint-submit&gt; és l'endpoint de l'aplicació on es vol fer l'enviament de les dades. Idealment aquest endpoint hauria de ser relatiu a la URL de publicació del formulari, ja que d’aquesta manera no caldrà fer cap diferenciació per entorn.\r\n\r\nAquesta llibreria es pot utilitzar tant des del propi formulari com des de la pàgina de l’aplicació en la que s’ha incrustat el formulari. \r\n\r\nLes funcionalitats es poden consultar a: https://helpx.adobe.com/experience-manager/6-3/forms/javascript-api/GuideBridge.html\r\n\r\n## Desenvolupament Avançat\r\n\r\nPot ser que sigui necessari ampliar la funcionalitat per defecte d'un formulari de l'AEM, incloure nous components o convertir les regles dels formularis en funcions reutilitzables. Podem crea una llibreria javascript amb funcionalitat pròpia que podem incloure en el nostre formulari.\r\n\r\n### Creació nova llibreria\r\nPodem crear una llibreria dins l'AEM seguint els següents passos: http://blogs.adobe.com/experiencedelivers/experience-management/clientlibs-explained-example/\r\n\r\nLa llibreria haurà de situar-se en un path concret dintre de l'AEM:\r\n\r\n**/apps/&lt;aplicacio&gt;/&lt;nom_llibreria&gt;**\r\n\r\nCal utilitzar la propietat allowProxy per tal de poder ser referenciada desde el formulari, tal i com s'explica a: https://helpx.adobe.com/experience-manager/6-3/sites/developing/using/clientlibs.html#CreatingClientLibraryFolders\r\n\r\nEs poden crear nous components basats en components existents del Formularis de l'AEM. Podeu seguir el següent enllaç per a trobar la documentació oficial: https://helpx.adobe.com/experience-manager/6-3/forms/using/introduction-widgets.html\r\n\r\n#### Nota sobre la nomenclatura\r\n\r\nLes funcions que afegim en la nostra llibreria conviuran tant amb el javascript de l'aplicació que incrusta el formulari com amb altres llibreries del propi AEM. Per tant les funcions i objectes que creem haurien d'incloure un **Namespace** en la nomenclatura per a evitar col·lisions.\r\n\r\n### Deploy\r\n\r\nTot aquesta funcionalitat cal empaquetar-se en un paquet **&lt;aplicacio&gt;_&lt;nom_llibreria&gt;__&lt;versio&gt;.zip** instal·lable en l'AEM. Aquest paquet també pot incloure els formularis de l'aplicació.\r\nLa documentació oficial sobre la creació de paquets la podem trobar a: \r\nhttps://helpx.adobe.com/experience-manager/6-3/sites/administering/using/package-manager.html\r\n\r\nÉs recomanable crear-se un entorn de treball en local utilitzant maven i l'arquetip que l'AEM ens proporciona:\r\nhttps://helpx.adobe.com/experience-manager/6-3/sites/developing/using/vlt-mavenplugin.html#simplecontentpackagearchetype\r\n\r\nDes de el fitxer META-INF/vault/filter.xml del paquet que hem creat es pot controlar els directoris de l'AEM que s'inclouran en el deploy.\r\n\r\n### Normes d'empaquetament\r\n\r\nEls paquets enviats a desplegar a els servidors AEM han de complir les següents restriccions:\r\n\r\n1. Els paths a importar sempre han d'incloure el nom de l'aplicació.\r\n2. Imatges i recursos que utilitza la llibreria s'han d'incloure en una carpeta anomenada **resources** de la pròpia llibreria\r\n3. El codi javascript no pot anar minimitzat\r\n\r\nEls paths que s'han d'incloure en el **filter.xml** del vault han de ser:\r\n\r\n|Nom|Descripció|\r\n|---|----------|\r\n|/apps/&lt;aplicacio&gt;/&lt;nom_llibreria&gt;| Llibreries clients|\r\n|/content/forms/af/&lt;aplicacio&gt;/| Descpripció dels formularis |\r\n|/content/dam/formsanddocuments/&lt;aplicacio&gt;/| El formularis i els seus components |","objectID":"L3NnZGUvc2VydmVpLWZvcm11bGFyaXMtaHRtbDU="},"L3NnZGUtcmVsYXRlZC9pbnRyby1zdGQ=":{"date":1427760000000,"title":"Sistema de Transformació de Documents (STD)","description":"STD","sections":"SGDE","taxonomies":[],"weight":3,"path":"/sgde-related/intro-std","content":"El CTTI ofereix una nova plataforma on es troba disponible el **Sistema de Transformació de Documents** o STD. Aquesta plataforma s'integra dintre del grup de Serveis del **SGDE** (Sistema de Gestió de Documents Electrònics) del CTTI juntament amb la plataforma de Formularis Electrònics.\r\n\r\nEls serveis inclosos per aquesta plataforma són:\r\n\r\n- **Transformació de documents Ofimàtics** (Word, Excel, PowerPoint, OpenOffice, etc.) a PDF.\r\n- **Conversió de documents PDF** mitjançant plantilles.\r\n- Operacions de **Translació, Rotació i Escalatge**.\r\n- Inserció de diferents tipus de **Tags de Text, Imatges, Codis QR, Codis de Barres, Codis CSV i Marques d'Aigua**.\r\n- Generació de **Codis Segurs de Validació** o CSV\r\n- **OCR** (Optical Character Recognition)\r\n\r\nQualsevol aplicació que ho sol.liciti pot treballar amb l'STD prèvia petició d'alta en la plataforma. Per fer-ho s'ha d'enviar la Plantilla d'Alta al Servei, degudament omplerta a [oficina-tecnica.canigo.ctti@gencat.cat] (mailto://oficina-tecnica.canigo.ctti@gencat.cat), sol.licitant formalment l'alta.","objectID":"L3NnZGUtcmVsYXRlZC9pbnRyby1zdGQ="},"L3NpYy9mYXE=":{"date":1546819200000,"title":"FAQ","description":"Preguntes freqüents sobre els serveis del SIC","sections":"SIC","taxonomies":[],"weight":6,"path":"/sic/faq","content":"## Accessibilitat\n\n#### **Què necessito per a poder començar a treballar amb SIC?** ####\n* Client Git instal·lat a la màquina des d'on es faran les pujades. Aquest es pot descarregar des de la [web oficial de Git](https://git-scm.com/downloads) tot i que també es pot utilitzar qualsevol altre client de Git com GitKraken o Sourcetree; o bé que aquest estigui integrat en un IDE de desenvolupament com Visual Studio Code, Eclipse, IntelliJ... etcètera.\n* Usuari a GICAR, amb l'e-mail informat a la identitat i bolcat a l'LDAP del SIC.\n<br/><br/>\n\n#### **Des de la nostra oficina no tenim connectivitat cap als serveis del SIC. Com podem resoldre aquest problema?** ####\nCaldrà configurar la vostra VPN/Lan2Lan/PPP per a que disposi d'accés a les adreces IP del SIC. Si us cal saber les adreces IP dels serveis podeu obrir una consulta a [Framework SIC](/sic/suport).\n<br/><br/>\n\n#### **Com puc concedir permisos a altres membres als meus codis d'aplicació?** ####\n* En el cas de responsables de lot, CPD i LdT l'assignació de permisos és automàtica, per tant no calen accions addicionals.\n* En el cas de proveïdors d'aplicacions, el SIC proporciona l'[Autoservei d'usuaris](/sic-serveis/autoservei-usuaris/) que permet definir nous membres del grup de Release Manager i concedir accés a la resta de l'equip de desenvolupament. \n<br/><br/>\n\n#### **En accedir al Gitlab amb un usuari GICAR operatiu i amb les credencials correctes, es produeix un error d'autenticació. Cal fer alguna acció addicional?** ####\nMissatge d'error: \"*Could not authenticate you from Ldapmain because \"Invalid credentials*\". <br/>\nPer accedir als serveis del SIC, resulta necessari que l'usuari es trobi bolcat a l'LDAP del SIC. Caldria fer una petició de suport al servei GICAR a través de SAU-Remedy per tal que duguin a terme aquest bolcat.\n<br/><br/>\n\n#### **En accedir al Gitlab, contínuament em redirigeix a la pàgina del meu perfil i m'obliga a informar una adreça de correu. Cal fer alguna acció addicional?** ####\nCal tenir informat el correu electrònic a la identitat GICAR per tal que la informació es propagui al Gitlab. Caldria fer una petició de suport al servei GICAR a través de SAU-Remedy per tal que actualitzin aquest camp.\n<br/><br/>\n\n#### **Si ja estic logat a GICAR, perquè em torna a demanar les credencials en accedir als portals Gitlab/Jenkins del SIC?** ####\nEls portals Gitlab/Jenkins del SIC no es troben adherits al Single Sign-On de GICAR (no llegeixen les capçaleres d'autenticació GICAR). L'autenticació i autorització es realitza contra l'LDAP del SIC, on s'han bolcat les dades dels usuaris GICAR.\n<br/><br/>\n\n\n## Custodia de codi\n\n#### **Quina versió de client GIT necessito tenir instal·lada per a treballar amb el Gitlab?** ####\nLa versió de GIT que fa servir el GITLAB de SIC és la 9.0.5 i, segons la documentació oficial de GIT, qualsevol versió 2.X seria compatible. Tanmateix, recomanem utilitzar una versió igual o superior a la 2.7.X.\n<br/><br/>\n\n#### **Quina diferència hi ha entre grup d'aplicació i projecte dins el Gitlab de SIC?** ####\n* Els projectes són les diferents parts de les aplicacions (mòduls, serveis, llibreries pròpies,...) que disposen d'un control de versions propi. \n* Els grups són agrupacions de projectes i es corresponen amb el codi d'aplicació. \n<br/><br/>\n\n#### **Quina diferència hi ha entre espai privat i espai corporatiu al Gitlab de SIC i a quin espai he de crear els projectes?** ####\nEls usuaris Release Manager podran crear tant grups com projectes dins el seu espai personal al portal Gitlab, però de cara a oficialitzar a CTTI l'entrega del codi font d'un projecte, aquest haurà de figurar a l'espai corporatiu de SIC. <br/>\nEls grups oficials d'aplicació es crearan automàticament a partir de la informació de l'inventari d'aplicacions.\nEls projectes dins els grups oficials d'aplicació sí que podran ser creats pels Release Manager mitjançant el portal Gitlab.\n<br/><br/>\n\n#### **Puc crear subgrups dins els grups d'aplicació oficials al Gitlab?** ####\nÉs possible crear subgrups dins un grup d'aplicació oficial però de cara a la integració amb Jenkins, comportarà una incompatibilitat. Per tant, es desaconsella treballar amb subgrups dins l'espai corporatiu del SIC.\n<br/><br/>\n\n#### **Com puc migrar el codi dels repositoris SVN (SIC 1.0) cap als del Gitlab (SIC 2.0)?** ####\nPodeu consultar el procediment descrit a [Migració repositoris SVN a Git] (/sic/serveis/scm) a l'apartat corresponent.\n<br/><br/>\n\n#### **Fins quan podem utilitzar el SVN?** ####\nEl SVN es va passar a mode lectura el **5 de Febrer de 2018**.\n<br/><br/>\n\n#### **Com afectarà la migració del projectes de SVN a Gitlab als jobs Jenkins associats?** ####\nCaldrà actualitzar l'origen del codi font dels jobs per tal que apuntin al repositori del projecte de Gitlab. Els nous jobs es crearan seguint el nou tipus de job Pipeline però els existents romandran amb el format actual.\n<br/><br/>\n\n#### **Mantindré els meus accessos de SIC 1.0 a SIC 2.0?** ####\nMantindrà els mateixos rols d'accés als serveis, ja que aquests s'han heretat de l'anterior sistema de permisos.\n<br/><br/>\n\n\n## Integració contínua\n\n#### **Quines branques provoquen l'execució de pipelines de construcció i desplegament al Jenkins?** ####\nÚnicament la branca MASTER és la que té el lligam amb les pipelines de Jenkins. No obstant, es pot publicar qualsevol branca al Git del SIC.\n<br/><br/>\n\n#### **El job de desplegament no funciona informant que ja existeix el tag definitiu. Quin és el problema?** ####\nLa tasca de desplegament (job) comprova si existeix el tag definitiu associat a la versió indicada al fitxer \"sic/sic.yml\" i mostra error si no s'ha realitzat el corresponent increment de versió. Caldrà que incrementi el valor de versió i torni a provar.\n<br/><br/>\n\n#### **En els desplegaments automàtics a BBDD es gestionen transaccions?** ####\nNo es realitza cap gestió de transaccions de BBDD per defecte. Si escau, caldrà incorporar clàusules de transacció dins els scripts d'usuari: BEGIN TRANSACTION, COMMIT i ROLLBACK.\n<br/><br/>\n\n\n## Binaris\n\n#### **En pujar nous binaris el sistema indica que el projecte no acompleix els requisits establers. Quin és el problema?** ####\nSi el codi d'aplicació indicat és vàlid, probablement el sistema ha detectat inconsistències respecte al codi de projecte. És a dir, durant la pujada de binaris el sistema verifica que aquesta vingui acompanyada de l'actualització de la versió del codi font del projecte. Únicament estaran exemptes d’aquesta validació les aplicacions que disposin d’una excepció aprovada en la custodia de codi. <br/>\nPer tant, per a resoldre el problema, caldrà actualitzar el codi font del projecte o tramitar, si escau, la corresponent excepció amb arquitectura del CTTI per a que l'aplicació no disposi d'aquesta restricció. <br/> \nEn cas de tractar-se d'una aplicació multi projecte que sí reposita el codi però la pujada de binaris es vol realitzar en bloc (tots els artefactes, documentació...), o bé es vol lliurar un artefacte que no té un projecte al darrere (producte de tercers, llibreria sense codi...) caldrà optar per indicar un codi de projecte que acompleixi els requeriments indicats. En cas contrari, les pujades hauran de fer-se de forma diferenciada per a cada un dels projectes de l'aplicació.\nA partir del **24/01/2019 aquest control serà restrictiu**.\n<br/><br/>\n\n#### **He anat a recuperar binaris pujats i veig que ja no hi son. Què ha passat?** ####\nS'executa un procés diari d'esborrat de binaris respectant només les 5 últimes versions per codi d'aplicació i projecte. No s'ha de concebre com un servei de custodia de binaris \"in eternum\" si no com un servei d'intercanvi de binaris amb CPD/LdT.\n<br/><br/>\n\n<br/>\nSi teniu qualsevol dubte o problema utilitzeu el canal de [Suport] (/sic/suport) o contacteu amb l'Oficina Tècnica Canigó CTTI a través del correu electrònic: **oficina-tecnica.canigo.ctti@gencat.cat**.\n","objectID":"L3NpYy9mYXE="},"L3NpYy9hYm91dA==":{"date":1546387200000,"title":"Què és el Servei d'Integració Contínua (SIC 2.0)","description":"Conceptes, motivació, modalitats d’integració i serveis que es proporcionen","sections":"SIC","toc":true,"taxonomies":[],"weight":1,"path":"/sic/about","content":"## Conceptes i motivació\r\n\r\nLa integració de les diferents peces de programari que componen una aplicació és un repte present en tot projecte de desenvolupament. \r\nSovint apareixen **problemàtiques** com els següents:\r\n\r\n* Proves d'integració ajornades fins moments massa propers al desplegament.\r\n* Alt cost de correcció dels errors.\r\n* Visibilitat baixa de l'estat de construcció dels projectes.\r\n* Manca d'homogeneïtat en les eines utilitzades.\r\nL'existència d'un servei que gestioni el cicle de vida d'aquestes peces i permeti automatitzar certes tasques i donar visió global proporciona molts **beneficis**, entre els quals podem citar:\r\n* Reducció en els costos de manteniment de les aplicacions.\r\n* Augment de la qualitat i fiabilitat de les aplicacions.\r\n* Donar visibilitat de les activitats, lliurables i estat del desenvolupament dels projectes.\r\n* Disposar d'un conjunt d'eines comunes en la construcció de les aplicacions.\r\n* Establir un repositori comú on ubicar el codi font de les aplicacions.\r\n* Simplificar i reduir el temps de desplegament als diferents entorns.\r\nA més, el concepte d'integració contínua permet disposar permanentment d'una versió del codi provinent d'un repositori controlat i amb uns paràmetres de qualitat mesurables.\r\nEl Servei d'Integració Contínua (SIC) neix amb l'objectiu de donar aquest suport al cicle de vida de manera centralitzada i amb un cost reduït, ja que està basat en tecnologies de programari lliure.\r\n\r\n## Modalitats d’integració\r\n\r\nEs contemplen dos tipus de modalitats d’integració de les aplicacions al SIC:\r\n\r\n* **Integracions automatitzades**: es fa ús de les eines per la custodia de codi font i les eines de construcció i desplegament automatitzat d’artefactes. Es divideixen en dos tipus:\r\n\t- Automatització en la construcció i desplegament fins a l’entorn d’integració i entrega dels artefactes a CPD a través del servei de gestió de binaris per a que CPD pugui realitzar el desplegament als entorns de preproducció i producció.\r\n\t- Automatització en la construcció i desplegament fins a l’entorn de producció. Actualment disponible per aplicacions desplegades al Cloud Públic.\r\n* **Integracions sense automatització**: es fa ús de les eines per a la custodia de codi font i és el proveïdor d’aplicacions qui s’encarrega de fer la construcció i lliurar els artefactes a través del servei de gestió de binaris per a que CPD pugui realitzar el desplegament.\r\n\r\n## Serveis\r\n\r\n### Custodia de codi font\r\n\r\nQuan l'equip de desenvolupament té una nova versió del codi font llesta per lliurar, es connecta al sistema de custodia de codi font del SIC i efectua la pujada de la nova versió. <br/>\r\nLa persona de l'equip que efectua aquesta acció és la que té el rol de Release Manager o **Gestor de Lliuraments**. \r\nTot i que qualsevol usuari de l'equip de desenvolupament podria accedir al servei de custodia de codi font de SIC, es recomana que l'accés sigui efectuat només per les figures dels Release Manager. Es considera que l'equip de desenvolupament ja té el seu propi repositori de codi a les seves instal·lacions i que allà és on es fan les proves pertinents fins que es considera el codi llest per lliurar.\r\n\r\nPer a més informació: [Custodia de codi font] (/sic-serveis/scm/)\r\n\r\n### Integració contínua\r\n\r\nEl SIC té capacitat per a poder realitzar el **desplegament automàtic** d'un gran nombre d'aplicacions de diferents tecnologies a diferents entorns. \r\nAquests es realitzen mitjançant l'eina d'Integració Contínua de SIC: Jenkins. Es configurarà una única tasca per projecte que s'executarà automàticament amb cada pujada de codi al servei de custodia de codi font. <br/>\r\nLa tasca inclourà accions de construcció d'artefactes, versionat de codi, execució de tests, anàlisi de codi i desplegaments a entorns no-productius i productius. En aquells entorns on no es pugui desplegar automàticament, el flux d'execució de la tasca s'aturarà esperant una resposta manual d'acceptació.\r\n\r\nPer a més informació: [Integració contínua] (/sic-serveis/ci/)\r\n\r\n### Binaris\r\n\r\nSi les aplicacions no permeten la construcció i desplegament d'artefactes mitjançant el sistema d'integració contínua, el SIC proporciona un servei per a que les aplicacions puguin **lliurar els artefactes** (.war, .ear, .jar, .zip, etc.) a CPD/LdT mitjançant el sistema de gestió de binaris de SIC. \r\n\r\nPer a més informació: [Binaris] (/sic-serveis/binaris/)\r\n\r\n\r\n### Autoservei d’usuaris\r\n\r\nEls usuaris Release Managers, responsables de lot i tècnics de CPD assignats disposaran d’accés als corresponents serveis del SIC. No obstant, es podran incloure **nous membres del grup de Release Managers** mitjançant l’autoservei d’usuaris.\r\n\r\nPer a més informació: [Autoservei d'usuaris] (/sic-serveis/autoservei-usuaris/)","objectID":"L3NpYy9hYm91dA=="},"L3NpYy9zdXBvcnQ=":{"date":1546560000000,"title":"Canals de suport","description":"Com obtenir suport per part de l'equip del SIC","sections":"SIC","aliases":["/sic/peticions/","/howtos/2018-01-howto-obrir-peticions-SIC-a-autoservei-Remedy/"],"toc":true,"taxonomies":[],"weight":5,"path":"/sic/suport","content":"Si teniu qualsevol dubte o problema assegureu-vos de no trobar resposta a les [FAQ] (/sic/faq) i utilitzeu els canals de suport o contacteu amb l'Oficina Tècnica Canigó CTTI a través del correu electrònic: **oficina-tecnica.canigo.ctti@gencat.cat**.\n\n## Obrir nova petició a SAU-Remedy\n\nA continuació, descriurem el procediment a seguir per a **obrir noves peticions dirigides al servei de FRAMEWORK SIC a Remedy**. <br/>\nAquesta guia s’ha elaborat a partir de la \"Guia d’usuari del Portal d’Autoservei\" oficial de Remedy per a que serveixi de guia per a aquells usuaris que no estiguin massa familiaritzat amb els procediments de Remedy a l’hora d’obrir peticions o que pateixin dificultats a l’hora d’identificar el tipus\nde petició a obrir al servei de SIC a Remedy segons la seva necessitat. <br/>\n\nCal tenir pressent:\n\n* Respectar una determinada sintaxi a l’hora d’informar el camp \"**descripció breu de la petició**\" per tal de facilitar la identificació de tasques per part dels tècnics de SAU-Remedy.\n* **Adjuntar qualsevol document que pugui ser útil** per a la resolució de la petició (formularis, captures de pantalla, exemples... etcètera).\n\n### Accés al servei\n\nPodrà accedir mitjançant el següent enllaç: https://pautic.gencat.cat. <br/>\nHaurà d'autenticar-se amb de les seves credencials d'accés **GICAR** i dirigir-se al portal d'autoservei. <br/>\n**OBSERVACIÓ**: El perfil de l'usuari pot condicionar les opcions habilitades en cada cas.\n<CENTER>![Pàgina principal](/related/sic/Remedy1.png)</center>\n<br/>\n\n### Procediment\n\nA Remedy no hi ha tipus de peticions específiques per als serveis SIC, totes les peticions s’han de demanar a partir de tres categories generals: \n\n* **Avaria o mal funcionament**: per a reportar incidències.\n* **Necessito saber**: per a realitzar consultes.\n* **Necessito demanar**: per a realitzar sol·licituds.\n\n#### Avaria o mal funcionament (incidències)\n\nTipus de petició per reportar qualsevol tipus d'incidència relacionada amb els serveis del SIC: problemes d'accés als serveis, errors d'execució de jobs... etcètera.\n\nCaldrà seleccionar la categoria: `Avaria o mal funcionament → Incidència en aplicacions` i prémer el botó \"Sol·licitar ara\". <br/>\nEl formulari d'entrada presenta el següent aspecte:\n<CENTER>![Pàgina principal](/related/sic/Remedy2.png)</center>\n<br/>\n\nInformació a emplenar:\n\n* **Dades de contacte**: nom, telèfon de contacte i altres dades addicionals (correu electrònic o altres).\n* Detall de la petició:\n\t- **Tipus de problema** : tipologia de la problemàtica (no puc accedir, va massa lent, funcionament incorrecte o altres)\n\t- **Nom de l'aplicació**: \"FRAMEWORK SIC\"\n\t- **Resum de la incidència o de l'error que es mostra a la pantalla**: <br/>\n\t  Es recomana utilitzar una nomenclatura d'aquest estil en funció de la necessitat: <br/>\n\t  \"SIC - Incidència Usuaris [_codi diàleg_]\" + breu descripció de la incidència <br/>\n\t  \"SIC - Incidència Gitlab [_codi diàleg_, _projecte_]\" + breu descripció de la incidència <br/>\n\t  \"SIC - Incidència Jenkins [_codi diàleg_, _projecte_]\" + breu descripció de la incidència <br/>\n\t  \"SIC - Incidència Binaris [_codi diàleg_, _projecte_]\" + breu descripció de la incidència <br/>\n\t  ...\t\n\t- **Descripció dels passos que ha seguit per reproduir la incidència**: informació de la incidència al màxim nivell de detall possible i cas de reproducció.\n\t- **La incidència afecta a un usuari, un grup d'usuaris o tota la seu?**: tipus d'afectació d'usuaris (només a mi, un grup d'usuaris, tota la seu o no ho se).\n\t- **La incidència afecta a una o més aplicacions?**: tipus d'afectació d'aplicacions (una aplicació o més d'una aplicació).\n\t- **Des de quan té la incidència?**: moment a partir del qual ha començat a produir-se l'incidència.\n\t- **És un error recurrent o puntual?**: tipus de recurrència (recurrent o puntual).\n\t- **Observacions**: comentaris addicionals. \n\t- **LOPD**: indicar si la incidència pot afectar o manté relació amb dades personals.\n* **Arxius adjunts**: qualsevol arxiu que pugui ser útil per a la resolució de la incidència.\n\n#### Necessito saber (consultes)\n\nTipus de petició per a demanar qualsevol tipus d'informació relacionada amb els serveis del SIC.\n\nCaldrà seleccionar la categoria: `Necessito saber → Consulta sobre aplicacions` i prémer el botó \"Sol·licitar ara\". <br/>\nEl formulari d'entrada presenta el següent aspecte:\n<CENTER>![Pàgina principal](/related/sic/Remedy3.png)</center>\n<br/>\n\nInformació a emplenar:\n\n* **Dades de contacte**: nom, telèfon de contacte i altres dades addicionals (correu electrònic o altres).\n* Detall de la petició:\n\t- **Tipus de consulta** : tipologia de la consulta (dubtes d'ús, consulta tècnica o altres).\n\t- **Nom de l'aplicació**: \"FRAMEWORK SIC\"\n\t- **Codi de l'etiqueta o el nom el seu ordinador**: aquesta dada no aporta valor a l'hora de resoldre una consulta relacionada amb el SIC, per tant, recomanem utilitzar-lo per indicar una descripció breu de la consulta. <br/>\n\tEs recomana utilitzar una nomenclatura d'aquest estil en funció de la necessitat: <br/>\n\t  \"SIC - Consulta Usuaris\" + breu descripció de la consulta <br/>\n\t  \"SIC - Consulta Gitlab\" + breu descripció de la consulta <br/>\n\t  \"SIC - Consulta Jenkins\" + breu descripció de la consulta <br/>\n\t  \"SIC - Consulta Binaris\" + breu descripció de la consulta <br/>\n\t  ...\t\n\t- **Descripció de la consulta**: informació de la consulta al màxim nivell de detall possible.\n* **Arxius adjunts**: qualsevol arxiu que pugui ser útil per a la resolució de la consulta.\n\n#### Necessito demanar (sol·licituds)\n\nTipus de petició per a demanar:\n\n* Construcció o adaptació de jobs de construcció i desplegament a Jenkins.\n* Publicació de noves llibreries al Nexus.\n* Creació d'usuaris de grups especials (administradors, oficines de qualitat... etcètera).\n* Esborrat de binaris i projectes al servei de custodia de codi.\n\nCaldrà seleccionar la categoria: `Necessito demanar → Suport funcional` i prémer el botó \"Sol·licitar ara\". <br/>\nEl formulari d'entrada presenta el següent aspecte:\n<CENTER>![Pàgina principal](/related/sic/Remedy4.png)</center>\n<br/>\n\nInformació a emplenar:\n\n* **Dades de contacte**: nom, telèfon de contacte i altres dades addicionals (correu electrònic o altres).\n* Detall de la petició:\n\t- **Urgència**: tipus d'urgència.\n\t- **Nom de l'aplicació**: \"FRAMEWORK SIC\"\n\t- **Descripció breu del suport**:\n\t  Es recomana utilitzar una nomenclatura d'aquest estil en funció de la necessitat: <br/>\n\t  \"SIC - Alta jobs aplicació [_codi diàleg_, _projecte_]\" <br/>\n\t  \"SIC - Adaptació jobs aplicacio [_codi diàleg_, _projecte_]\" + breu descripció de la sol·licitud <br/>\n\t  \"SIC - Publicació llibreries Nexus [_codi diàleg_]\" + breu descripció de la sol·licitud <br/>\n\t  \"SIC - Creació d'usuaris\" + breu descripció de la sol·licitud <br/>\n\t  \"SIC - Esborrat de projecte [_codi diàleg_, _projecte_]\" + breu descripció de la sol·licitud <br/>\n\t  ...\t\n\t- **Descripció detallada del suport**: informació de la sol·licitud al màxim nivell de detall possible.\n* **Arxius adjunts**: qualsevol arxiu que pugui ser útil com, per exemple, el document de Disseny d'Arquitectura de l'aplicació per tal de disposar d'una primera aproximació sobre la tasca, la llibreria a publicar... etcètera.\n\n## Contactar amb bústia SAU\n\nEn cas que el **servei Remedy no es trobi disponible**, podrà optar per obrir una petició via bústia SAU: [sau.tic@gencat.cat](mailto:sau.tic@gencat.cat). <br/>\nPer tal que aquesta petició pugui ser atesa pel personal de SAU-Remedy, cal indicar la mateixa informació que s'indicaria a la petició Remedy. El redactat ha de ser en text pla, sense incloure sintaxi HTML. <br/>\nEs proposa seguir les següents plantilles a l'hora del redactat del correu de petició:\n\n[**Per a consultes:**](mailto:sau.tic@gencat.cat?subject=Consulta%20sobre%20aplicaci%C3%B3%20FRAMEWORK%20SIC&body=-%20Nom%20de%20l%27aplicaci%C3%B3%3A%20FRAMEWORK%20SIC%0A-%20Codi%20de%20la%20etiqueta%20o%20el%20nom%20del%20seu%20ordinador%3A%20SIC-Consulta%0A-%20Tel%C3%A8fon%20de%20contacte%0A%0A-%20Descripci%C3%B3%20de%20la%20consulta)\n\nAssumpte: \"Consulta sobre aplicació FRAMEWORK SIC\"  <br/>\nContingut:\n\n\t- Nom de l'aplicació: FRAMEWORK SIC\n\t- Codi de la etiqueta o el nom del seu ordinador: SIC-Consulta\n\t- Telèfon de contacte\n\t- Descripció de la consulta\n\t\t  \n<br/>\n[**Per a reportar una incidència:**](mailto:sau.tic@gencat.cat?subject=Incid%C3%A8ncia%20sobre%20aplicaci%C3%B3%20FRAMEWORK%20SIC&body=-%20Codi%20de%20la%20etiqueta%20o%20el%20nom%20del%20seu%20ordinador%3A%20SIC-Incid%C3%A8ncia%0A-%20Tel%C3%A8fon%20de%20contacte%0A-%20Problema%0A-%20Nom%20de%20l%27aplicaci%C3%B3%3A%20FRAMEWORK%20SIC%0A%0A-%20Descripci%C3%B3%20de%20l%27error%20o%20problema%20que%20es%20mostra%20a%20la%20pantalla)\n\nAssumpte: \"Incidència sobre aplicació FRAMEWORK SIC\"  <br/>\nContingut:\n\n\t- Codi de la etiqueta o el nom del seu ordinador: SIC-Incidència\n\t- Telèfon de contacte\n\t- Problema\n\t- Nom de l'aplicació: FRAMEWORK SIC\n\t- Descripció de l'error o problema que es mostra a la pantalla\n\t\n<br/>\n[**Petició de suport:**](mailto:sau.tic@gencat.cat?subject=Petici%C3%B3%20de%20suport%20funcional%20per%20a%20l%27aplicaci%C3%B3%20FRAMEWORK%20SIC&body=-%20Urg%C3%A8ncia%3A%20Alta%2C%20Mitjana%20o%20Baixa%0A-%20Nom%20de%20l%27aplicaci%C3%B3%3A%20FRAMEWORK%20SIC%0A-%20Descripci%C3%B3%20breu%20del%20suport%0A%0A-%20Descripci%C3%B3%20detallada%20del%20suport%0A)\n\nAssumpte: \"Petició de suport funcional per a l'aplicació FRAMEWORK SIC\" <br/>\nContingut:\n\n\t- Urgència: (Alta, Mitjana o Baixa)\n\t- Nom de l'aplicació: FRAMEWORK SIC\n\t- Descripció breu del suport\n\t- Descripció detallada del suport\n","objectID":"L3NpYy9zdXBvcnQ="},"L3NpYy1yZWxhdGVkL3Byb2NlZGltZW50":{"date":1427760000000,"title":"Procediment d'alta d'aplicacions sense codi de diàleg al SIC","description":"","sections":"SIC","weight":1,"path":"/sic-related/procediment","content":"### Procediment d'alta d'aplicacions sense codi de diàleg al SIC\n\nPer aquelles aplicacions que no estan donades d'alta a l'Inventari d'Aplicacions de Gestió de Serveis cal tramitar aquesta alta prèviament a poder incorporar-la al SIC. D'aquesta manera se li assignarà un codi d'aplicació, dada requerida en l'alta d'aplicacions al SIC.\n\nL'alta a l'Inventari d'Aplicacions s'ha de realitzar emplenant la [Fitxa d'Alta d'Aplicació](/related/sic/Fitxa-Alta-App.xlsm), concretament les pestanyes \"Caracterització\" i \"NAQ Solució\", i fent-la arribar a la bústia [ogdp.suport@gencat.cat](mailto://ogdp.suport@gencat.cat). En cas de dubtes i per obtenir la darrera versió de la fitxa podeu contactar amb aquesta mateixa bústia.","objectID":"L3NpYy1yZWxhdGVkL3Byb2NlZGltZW50"},"L3NpYy1zZXJ2ZWlzL2F1dG9zZXJ2ZWktdXN1YXJpcw==":{"date":1546560000000,"title":"Autoservei d'usuaris","description":"Autoservei d'usuaris SIC 2.0 mitjançant GitLab","aliases":["/sic/autoservei-usuaris/","/noticies/2017-07-18-SIC-Autoservei-usuaris-SIC2.0/"],"sections":"SIC","taxonomies":[],"toc":true,"weight":4,"path":"/sic-serveis/autoservei-usuaris","content":"## Introducció\n\nEl SIC 2.0 proporciona un servei de gestió d'usuaris per a que els lots d'aplicacions disposin d'autonomia a l'hora d'assignar permisos d'accés sobre els diferents serveis. <br/>\nAbans d'entrar en el funcionament de l'autoservei d'usuaris, explicarem breument l'estructura actual de permisos del SIC.\n\n## Estructura de permisos\n\nEl SIC té estructurada la seva seguretat en diferents tipus de grups:\n\n* Grups per a lots i proveïdors d'aplicacions\n* Grups per a CPDs i LdTs\n* Altres grups\n\n### Grups per a lots i proveïdors d'aplicacions\n\nAquests tipus de grups contenen a desenvolupadors i altres perfils que componen l'amalgama de perfils requerits per desenvolupar una aplicació. Dins d'aquests tipus de grups, distingim dos subtipus:\n\n* Release Managers\n* Responsables de lot\n\nA continuació, descriurem cadascun d'aquests subtipus.\n<br/><br/>\n\n#### Release Managers\n\nAquest tipus de grup recull als Release Managers, és a dir, a tots els usuaris amb perfil Release Manager que pertanyen a un codi d'aplicació concret. Els membres d'un grup Release Managers són perfils que poden:\n\n* Operar amb servei de **custodia de codi**.\n* **Concedir permisos** a altres companys per accedir com a Developers o Masters al codi d'aplicació corresponent, passant aquests últims a ser Release Managers a tots els efectes.\n* **Crear nous projectes** dins del grup de l'aplicació.\n* Accedir als serveis d'**integració contínua**.\n* Accedir al servei de gestió de **binaris** per dipositar i recollir arxius.\n\n#### Responsables de lot\n\nAquest tipus de grup recull als responsables de lot. <br/>\nAl SIC 1.0, els membres d'aquest tipus de grup eren els encarregats de sol·licitar accés per a un Release Manager. Actualment, al SIC 2.0, aquesta funcionalitat manca de valor gràcies a l'autoservei d'usuaris, mitjançant el qual els propis Release Managers poden concedir accés a la resta de companys. <br/>\nAquest grup, per tant, ha passat a ser un agregador de totes les aplicacions del lot disposant d'una **participació transversal a tots els codis de les aplicacions** i podent realitzar les mateixes accions que un Release Manager. <br/>\nLa pertinença als grups d'aquest tipus és automàtica i ve donada per la categorització que fa GICAR dels usuaris, als quals s'assigna a un LOT concret en el moment de la creació\n\n### Grups de CPDs i LdTs\n\nAquests tipus de grups recullen als responsables dels diferents centres de processament de dades (CPD) i a llocs de treball (LdT). Els membres d'aquest tipus de grups tenen **accés en mode lectura als repositoris i al servei de gestió de binaris**, a més poden executar a Jenkins jobs de desplegament automàtic per CPD per als codis d'aplicació corresponents. <br/>\nLa pertinença als grups d'aquest tipus és automàtica i ve donada per la categorització que fa GICAR dels usuaris, als quals s'assigna a un CPD/LDT concret en el moment de la creació. Per tant, tot usuari de GICAR, pel fet de ser d'un CPD o d'un grup de LDT concrets, té accés preconcedit al SIC.\n\n### Altres grups\n\nEs tracta de grups especials per a la gestió del servei i altres funcionalitats: **Administració, Oficina de Qualitat**,... etcètera. És a dir, són grups necessaris per al correcte funcionament dels serveis i per a la integració amb la resta d'agents del CTTI. <br/>\nLa pertinença a aquests tipus de grups es realitza de forma manual ja que la seva composició varia amb molt poca freqüència.\n\n## Funcionament\n\nA continuació, ens centrarem en la gestió de membres del grup de **Release Managers mitjançant l'autoservei d'usuaris**.\nAquest servei es realitza mitjançant l'eina de custodia de codi font implantada: [GitLab](https://git.intranet.gencat.cat/).\n\n### Accés al servei\n\nPodrà accedir mitjançant el següent enllaç: https://git.intranet.gencat.cat <br/>\nHaurà d'autenticar-se amb de les seves credencials d'accés **GICAR**. Els Release Manager, responsables de lot i tècnics de CPD disposaran d'accés al servei. Si no disposa d'accés, haurà de sol·licitar-ho al seu responsable.\n\n### Creació de comptes d'usuari\n\nPer a poder accedir al servei caldrà disposar d'un usuari GICAR operatiu i crear el compte corresponent. Per a fer-ho, haurà d'introduir l'identificador d'usuari i contrasenya i, en cas de tractar-se d'un nou compte, el sistema el redirigirà a la plana de perfil per a que pugui dur a terme el procés d'alta. <br/>\n\n**IMPORTANT**: És imprescindible que la identitat GICAR de l'usuari tingui informada l'**adreça de correu** i que l'usuari es trobi bolcat a l'**LDAP del SIC** (adreça de correu inclosa). Per tant, tant si el sistema el redirigeix contínuament a la pàgina de perfil per informar l'adreça de correu, com si no pot accedir al servei perquè es produeix un error d'autenticació amb unes credencials vàlides, caldrà fer una petició de suport al servei GICAR a través de SAU-Remedy.\n\n### Estructura de grups i projectes\n\nEls **Grups** tindran com a identificador el codi de diàleg de les aplicacions. Els usuaris Release Manager hauran de crear **Projectes** dins aquests grups per tal de disposar dels repositoris Git on fer la pujada de codi font de les aplicacions.\n\nPer a més informació: [Custodia de codi font] (/sic-serveis/scm/)\n\n### Comptabilitat amb SIC 1.0\n\nEls usuaris que ja eren **\"Release Manager Lot x Àmbit\"** al sistema SIC 1.0, mantindran el mateix rol al sistema SIC 2.0. Per tant, en accedir al portal del GitLab (mitjançant les credencials GICAR corresponents) disposaran d'accés als grups per codi de diàleg de les seves aplicacions.\n\n**AVÍS**: durant el primer accés al GitLab no es comptarà amb visibilitat sobre els grups d'aplicacions. Caldrà esperar a l'endemà del primer login per tal de disposar d'accés als grups i projectes corresponents.\n\n<center>![RML a SIC 1.0 VS SIC 2.0](/images/news/autoserveiUsuaris_1.PNG)</center>\n<br/>\n\n### Permisos d'accés\n\nEn crear projectes dins els grups d'aplicació, la resta d'usuaris del lot que no siguin Release Manager no disposaran de visibilitat.\n\n<CENTER>![Visibilitat resta usuaris Lot](/images/news/autoserveiUsuaris_2.PNG)</center>\n<br/>\nEls mateixos usuaris Release Manager podran consultar, editar, afegir i eliminar membres del projecte, però ho hauran de fer **a nivell de projecte**, no de grup de projectes.\n\n<CENTER>![Proporcionar accés a Projecte](/images/news/autoserveiUsuaris_3.PNG)</center>\n<br/>\nPer a concedir accés sobre un projecte caldrà:\n\n* Accedir al **projecte**.\n* Mitjançant el menú superior cal seleccionar \"**Settings**\" i, dins aquest ,\"**Members**\".\n* Al formulari que apareix, cercar l'usuari al qual es vol donar accés. La cerca es pot realitzar per nom o NIF. S'aconsella **cercar per NIF**.\n* Escollir el **rol** que ha de tenir l'usuari dins el projecte:\n\t* Rol Master: permetrà treballar amb el projecte en qüestió, crear nous projectes dins el grup de l'aplicació i proporcionar accés a altres usuaris als projectes dins el grup.\n\t* Rol Developer: únicament permetrà treballar amb el projecte en qüestió (descàrrega i pujades).\n* Prémer el botó de \"**Add to Project**\"\n\n<CENTER>![Proporcionar accés a Projecte](/images/news/autoserveiUsuaris_4.PNG)</center>\n<br/>\n\nEn el cas que el rol escollit per a l'usuari hagués estat de **Master**, l'endemà de l'assignació, l'usuari haurà adquirit accés a la resta de projectes del grup de l'aplicació, convertint-se a efectes pràctics en un nou Release Manager del codi d'aplicació. Aquesta **promoció a Release Manager** permetrà l'accés a la resta de serveis del SIC: custodia de codi, gestió de binaris i integració contínua.\n<CENTER>![Visibilitat adquirida segons Rol](/images/news/autoserveiUsuaris_5.PNG)</center>\n<br/>\n\n**AVÍS**: Si desitja concedir permisos a un usuari per a un grup que no disposa de cap projecte, caldrà prèviament crear el projecte per a poder dur a terme l'assignació desitjada.\n\n<br/><br/><br/>\nSi voleu més informació podeu consultar la secció de [Manuals](/sic/manuals/). <br/>\nSi teniu qualsevol dubte o problema assegureu-vos de no trobar resposta a les [FAQ] (/sic/faq) i utilitzeu el canal de [Suport] (/sic/suport) o contacteu amb l'Oficina Tècnica Canigó CTTI a través del correu electrònic: **oficina-tecnica.canigo.ctti@gencat.cat**.","objectID":"L3NpYy1zZXJ2ZWlzL2F1dG9zZXJ2ZWktdXN1YXJpcw=="},"L3NpYy1yZWxhdGVkL25vdS1tb2RlbC10aWM=":{"date":1427760000000,"title":"Model TIC al SIC","description":"","sections":"SIC","weight":1,"lastmod":"2018-05-14","path":"/sic-related/nou-model-tic","content":"### Model TIC al SIC\n\n<div style=\"border-radius: 5px;background-color:#cc0000;padding:5px;color:white;\">\n**Avís**: Aquesta pàgina ha estat editada a data 14/05/2018 amb l'aplicació del model de seguretat 2018 del SIC.\n</div>\n\nL'actual implantació del model TIC al SIC ha consistit en:\n\n- Creació d'una nova estructura del repositoris on les aplicacions s'agrupen per codi d'aplicació.\n- Les noves altes d'aplicació es realitzaran contra aquesta estructura.\n- Creació de nous grups de permissos per gestionar els accessos a aquests repositoris.\n\n## Nous grups de permisos\n\nA continuació s'enumeren els grups de permisos LDAP disponibles per accedir als repositoris de codi font/Portal d'Integració Contínua del SIC:\n\n- AMBIT: Es defineix un grup per cada àmbit, cadascun amb accés total al repositori de codi de les seves aplicacions SIC.\nEl grup està integrat pels responsables CTTI de l'àmbit. La llista d'àmbits es pot consultar al següent apartat.\n- RSPL_LOT: Es defineix un grup de responsables per cada lot amb accés total al repositori de codi de les aplicacions SIC del seu lot.\nEl grup està integrat amb els responsables d'arquitectura i qualitat dels lots.\n- CPD: Es defineix un grup per cada CPD dels codis de diàleg amb accés al repositori de codi de les aplicacions SIC del seu CPD.\n- RM_CODIAPLICACIÓ: Es defineix un grup de release manager per a cada codi d'aplicació amb accés total a les aplicacions SIC d'aquest codi d'aplicació.\nEl grup s'integra amb les persones sol·licitades a les fases 0 en la seva creació i a partir d'aquell instant, pels usuaris afegits en mode autoservei.\n\n## Llistat d'àmbits disponibles\n\n| Codi àmbit  \t| Descripció d'àmbit  \t\t\t\t\t\t\t\t\t\t\t\t\t\t|\n| :---------- \t| :----------------- \t\t\t\t\t\t\t\t\t\t\t\t\t\t|\n| AAM\t\t\t| \tDepartament d'Agricultura, Ramaderia, Pesca, Alimentació i Medi Natural\t|\n| ACC\t\t\t| \tAgència Catalana del Consum\t\t\t\t\t\t\t\t\t\t\t\t|\n| ACC10\t\t\t|\tACC1Ó\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|\n| ACT\t\t\t|\tAgència Catalana de Turisme\t\t\t\t\t\t\t\t\t\t\t\t|\n| ATC\t\t\t|\tAgència Tributària de Catalunya\t\t\t\t\t\t\t\t\t\t\t|\n| ATM\t\t\t|\tAutoritat del Transport Metropolità\t\t\t\t\t\t\t\t\t\t|\n| BSF\t\t\t|\tDepartament de Benestar Social i Família\t\t\t\t\t\t\t\t|\n| CCAC\t\t\t|\tDirecció General d'Atenció Ciutadana i Difusió\t\t\t\t\t\t\t|\n| CCAE\t\t\t|\tDGPAE\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|\n| CCE\t\t\t|\tConsell Català de l'Esport\t\t\t\t\t\t\t\t\t\t\t\t|\n| CLT\t\t\t|\tDEPARTAMENT DE CULTURA\t\t\t\t\t\t\t\t\t\t\t\t\t|\n| CTT\t\t\t|\tCentre de Telecomunicacions i Tecnologies de la Informació\t\t\t\t|\n| DGP\t\t\t|\tDirecció General de la Policia\t\t\t\t\t\t\t\t\t\t\t|\n| EAD\t\t\t|\tEADOP\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|\n| EAPC\t\t\t|\tEscola d'Administració Pública de Catalunya\t\t\t\t\t\t\t\t|\n| ECO\t\t\t|\tDepartament d'Economia i Coneixement\t\t\t\t\t\t\t\t\t|\n| EMO\t\t\t|\tDepartament d'Empresa i Ocupació\t\t\t\t\t\t\t\t\t\t|\n| ENS\t\t\t|\tDepartament d'Ensenyament\t\t\t\t\t\t\t\t\t\t\t\t|\n| GRI\t\t\t|\tDepartament de Governació i Relacions Institucionals\t\t\t\t\t|\n| ICA\t\t\t|\tICAEN\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|\n| ICS\t\t\t|\tICS\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|\n| INT\t\t\t|\tDepartament d'Interior\t\t\t\t\t\t\t\t\t\t\t\t\t|\n| JUS\t\t\t|\tDepartament de Justícia\t\t\t\t\t\t\t\t\t\t\t\t\t|\n| PRE\t\t\t|\tDepartament de la Presidència\t\t\t\t\t\t\t\t\t\t\t|\n| SCT\t\t\t|\tServei Català de Trànsit\t\t\t\t\t\t\t\t\t\t\t\t|\n| SEM\t\t\t|\tServei d'Emergències Mèdiques\t\t\t\t\t\t\t\t\t\t\t|\n| SLT\t\t\t|\tDepartament de Salut\t\t\t\t\t\t\t\t\t\t\t\t\t|\n| SOC\t\t\t|\tServei d'Ocupació de Catalunya (SOC)\t\t\t\t\t\t\t\t\t|\n| SUR\t\t\t|\tSecretaria d'Universitats i Recerca\t\t\t\t\t\t\t\t\t\t|\n| TES\t\t\t|\tDepartament de Territori i Sostenibilitat\t\t\t\t\t\t\t\t|\n","objectID":"L3NpYy1yZWxhdGVkL25vdS1tb2RlbC10aWM="},"L3NpYy1yZWxhdGVkL2FjY2VzLWNwZA==":{"date":1427760000000,"title":"Accés per a CPD","description":"","sections":"SIC","weight":1,"path":"/sic-related/acces-cpd","content":"### Accés per a CPD\n\nPer a totes aquelles aplicacions per a les que que no és possible realitzar desplegaments automatitzats des del SIC s'ofereix la possibilitat que els administradors de CPD puguin accedir als artefactes (.war, .ear, .zip, ...) custodiats al SIC per tal de poder realitzar desplegaments en els servidors dels nous CPDs.\n\nEls administradors podran accedir indistintament tant als artefactes lliurats al Subversion com els que generi Jenkins per a una aplicació que està compilant al SIC. Amb aquesta finalitat s'ha creat el Formulari d'accés per a CPD al SIC que podeu trobar a la secció de [Documentació](/sic/documentacio). Per tal de sol- licitar aquests accessos és necessari fer arribar aquest formulari degudament emplenat al servei SIC via petició de suport al [JIRA CSTD](https://cstd.ctti.gencat.cat/jiracstd/browse/SICQ). En cas de no dispossar d'usuari o permissos en aquest servei SIC del JIRA CSTD [s'ha d'obrir una petició Remedy al SIC](http://canigo.ctti.gencat.cat/howtos/2018-01-howto-obrir-peticions-SIC-a-autoservei-Remedy/).\n\n## Procediment de desplegament\n\nÉs responsabilitat del proveïdor de l'aplicació proporcionar a l'administrador de CPD el Manual de Desplegament on indicar les instruccions per a realitzar el desplegament de l'aplicació. És en aquest manual on cal indicar quina és la ubicació dins el SIC d'on obtenir l'artefacte/s a desplegar en el CPD:\n\nExemples\n\nLliurament a Subversion:\nhttp://svn.intranet.gencat.cat/ctt/0192/demoApp/tags/<versio>/bin/<nom_artefacte>\nhttp://svn.intranet.gencat.cat/ctt/0192/demoApp/tags/<versio>/docs/<nom_doc_desplegament>\nLliurament a Jenkins: http://hudson.intranet.gencat.cat/hudson/job/CTTI_demoApp_BLD/<num_compilacio>/artifact/treball/target/demoApp.ear","objectID":"L3NpYy1yZWxhdGVkL2FjY2VzLWNwZA=="},"L3NpYy1zZXJ2ZWlzL2Np":{"date":1546473600000,"title":"Integració contínua","description":"Jenkins és l'eina implantada al SIC per la integració contínua","sections":"SIC","toc":true,"aliases":["/noticies/2018-05-16-SIC-Autoservei-pipelines/","/sic/integracions-dev/","/sic/clau/"],"taxonomies":[],"weight":2,"path":"/sic-serveis/ci","content":"## Introducció\n\n![Jenkins](/related/sic/serveis/jenkins-logo.png \"Jenkins\")\n\n**Jenkins** és l'eina implantada al SIC per a la integració contínua en el desenvolupament de software. Es tracta d'un servei en el que, a partir de la definició previa de tasques (jobs), es construeixen les aplicacions, es versionen, es realitzen anàlisis de qualitat, s'executen tests i inclús es despleguen als entorns preproductius i productius. Està basat en el projecte Hudson.\n\n<br/>\n**Nexus** és l'eina implantada al SIC com a administrador central de biblioteques que facilita la col·laboració eficient entre els diferents col·laboradors i equips implicats. Permet crear servidors proxy, recopilar i administrar les dependències externes, ja siguin de tercers o pròpies. És compatible amb llibreries de diferents tecnologies: llibreries Java, paquets NuGet, paquets NPM i paquets bower. <br/>\nActualment aquest servei és administrat per l'equip del SIC i només permet consultar-lo en mode lectura.\n\n## Modalitats de desplegament\n\nEs contemplen diverses modalitats de desplegament:\n\n* **Semiautomàtica**: es construeixen els artefactes i es lliuren a través del servei de gestió de binaris per a que CPD/LdT dugui a terme el procés de desplegament. Aquesta modalitat requerirà conformitat prèvia i les accions prèvies davant una possible marxa enrere aniran a càrrec de CPD/LdT.\n* **Automàtica**: es construeixen els artefactes i es despleguen al servidors web, servidors d'aplicacions i servidors de bases de dades. Aquesta modalitat no requerirà cap tipus de conformitat prèvia.\n* **Automàtica per CPD**: es similar a la automàtica però serà CPD/LdT qui s'encarregarà de donar conformitat i continuïtat a les etapes de desplegament. Aquesta modalitat, per tant, requerirà conformitat prèvia i les accions prèvies davant una possible marxa enrere aniran a càrrec de CPD/LdT. \n\nActualment, el sistema previst seria el següent:\n\n* Entorn **INT**: modalitat automàtica.\n* Entorn **PRE/PRO**: modalitat semiautomàtica (per defecte) o automàtica per CPD si així s'acorda. Només s'aplica la modalitat automàtica en aplicacions desplegades al Cloud Públic.\n* **Altres** entorns: caldrà establir l'ordre d'execució d'etapes i la modalitat de desplegament aplicable.\n\n## Funcionament\n\n### Accés als serveis\n\nPodrà accedir a **Jenkins** mitjançant el següent enllaç: https://hudson.intranet.gencat.cat/hudson/ <br/>\nHaurà d'autenticar-se amb de les seves credencials d'accés **GICAR**. Els Release Manager, responsables de lot i tècnics de CPD disposaran d'accés al servei. Si no disposa d'accés, haurà de sol·licitar-ho al seu responsable.\n\n![Jenkins](/related/sic/serveis/jenkins-sic.png)\n<br/>\n\n<br/>\nPodrà accedir a **Nexus** mitjançant el següent enllaç: https://hudson.intranet.gencat.cat/nexus/\n\n![Nexus](/related/sic/serveis/nexus-sic.png)\n<br/>\n\n### Relació de tasques disponibles (jobs)\n\nUna vegada fet el login s'accedeix a la llista de jobs en execució i la relació de jobs disponibles per l'usuari amb la informació més rellevant: **nom, estat del darrer muntatge (Status) i el nivell de salut general del projecte (Weather)** basat en l'estabilitat, cobertura i tests realitzats. Aquest nivell de salut es pot definir per a cada projecte i es basa en el número de construccions que han anat bé /malament, així com en el percentatge de proves i indicadors d'anàlisi.\n\n### Detall de les tasques (jobs)\n\nEs pot consultar la **configuració, historial, estadístiques, resultats i situació** de cadascuna dels jobs mitjançant l'enllaç habilitat. En cas de tractar-se de jobs de tipus \"pipeline\" (tipologia multi-etapa implementat al SIC 2.0) es mostrarà una gràfica amb les darreres execucions i el resultat de cadascuna de les seves etapes. <br/>\nPer tal de disposar de la informació detallada de passes realitzades i logs generats haurà de dirigir-se a la opció \"Console Output\". Al final d'aquest log es mostrarà el resultat general de l'execució: SUCCES, FAILED o ABORTED. Aquest resultat serà notificat per correu electrònic als responsables assignats.\n\n### Execució de tasques (jobs)\n\nEls jobs de tipus \"pipeline\" no es podran iniciar directament des del portal ni es podrà sol·licitar la seva execució. Les tasques **s'executaran quan es produeixi una pujada d'una nova versió del codi font del projecte** per part del lot d'aplicacions, per lo que caldrà limitar la quantitat d'usuaris que utilitzen el servei de custodia de codi i fer una única pujada amb èxit per versió, moment en el que es realitzarà l'etiquetat definitiu.\n\n### Etapes de desplegament\n\nEls jobs multi-etapa realitzen multitud d'accions organitzades en STAGES. En cas de produir-se incidències a qualsevol de les seves etapes el job es cancel·larà i es notificarà per correu electrònic.\n\n<CENTER>![Nou projecte](/related/sic/serveis/jobs_stages.png)</center>\n<br/>\n\nA continuació s'explica breument cadascuna de les etapes de desplegament previstes:\n\n* **Init**: inicialitzacions internes.\n* **Checkout**: descàrrega del codi font del projecte a l'espai de treball.\n* **Build**: compilació i construcció d'artefactes en funció de la tecnologia i eines emprades.\n* **Commit test**: execució de tests de commit, si escau.\n* **Unit test**: execució de tests unitaris, si escau.\n* **Anàlisi estàtic de codi**: execució d'anàlisi de codi estàtic a partir d'unes regles predefinides.\n* **Generació tag de build**: generació del tag de Build al repositori de codi conforme es tracta d'una versió construïble.\n* **Desplegament a INT**: desplegament automàtic a l'entorn d'integració, si escau, incloent possibles processos d'actualització de l'estat de la base de dades.\n* **Smoke test**: verificació bàsica a l'entorn d'integració per assegurar que el projecte s'ha publicat correctament, si escau.\n* **Desplegament a PRE**: lliurament d'artefactes per al desplegament manual a l'entorn de preproducció i creació de ticket Remedy en mode \"Draft\". En aquest punt el sistema demanarà conformitat manual per tal de procedir al desplegament un cop verificades les etapes anteriors.\n* **Smoke test**: verificació bàsica a l'entorn de preproducció per assegurar que el projecte s'ha desplegat correctament, si escau. En aquest punt el sistema demanarà conformitat manual per tal de procedir a la verificació un cop finalitzat el procés de desplegament a preproducció.\n* **Acceptancy test**: execució de tests automàtics d'acceptació, si escau.\n* **Exploratory test**: execució de tests manuals d'acceptació, si escau.\n* **Generació tag definitiu**: generació del tag definitiu al repositori de codi conforme es tracta d'una versió desplegable a producció.\n* **Desplegament a PRO**: lliurament d'artefactes per al desplegament manual a l'entorn de producció i creació de ticket Remedy en mode \"Draft\". En aquest punt el sistema demanarà conformitat manual per tal de procedir al desplegament un cop verificades les etapes anteriors.\n* **Smoke test**: verificació bàsica a l'entorn de producció per assegurar que el projecte s'ha desplegat correctament, si escau. En aquest punt el sistema demanarà conformitat manual per tal de procedir a la verificació un cop finalitzat el procés de desplegament a producció.\n\n### Versionat\n\nLa versió dels projectes ha de ser sempre **incremental**, és a dir, qualsevol nova actualització de codi lliurat al SIC ha d'anar acompanyat d'un increment de la versió. Per tant, no es permetrà que el projecte desplegui una versió igual o inferior a una versió prèviament desplegada. En cas contrari, es podria induir a error o confusió en els futurs desplegaments de preproducció i producció. Per exemple, no se sabria quina versió d'integració està desplegada a l'entorn de preproducció.\n\n### Execució de proves unitàries\n\nDins del procés de construcció dels executables (i sempre que l'aplicació ho requereixi) s'executen les proves unitàries. Com a resultat de l'execució de les proves unitàries s'obtenen dos tipus d'informes:\n\n* Nombre total de **proves i percentatge** de proves passades i fallides.\n* Percentatge de **cobertura** de les proves respecte al codi font.\n\n### Anàlisi del codi\n\nL'anàlisi de codi és un altre dels processos que es passen dins la tasca de construcció. A partir d'unes regles predefinides, s'analitza el codi per tal d'obtenir mètriques d'adherència a estàndards i bones pràctiques. L'eina implantada al SIC per la Oficina de Qualitat es **Kiwuan**.\n\n### Artefactes generats i gestió de possibles marxes enrere\n\nCom a resultat de la construcció es generarà un conjunt d'artefactes, bàsicament components estàtics i dinàmics.\nEls artefactes no queden emmagatzemats a l'espai de treball per lo que la marxa enrere passaria per **recuperar la versió anterior del codi** del projecte per a que es tornin a construir i desplegar els artefactes anteriors. Pel que fa als entorns de preproducció i producció, la marxa enrere es delegarà als procediments de desplegament realitzats per CPD. \n\n### Publicació de llibreries\n\nTotes les dependències de l’aplicació han de ser accessibles en els repositoris públics configurats al Nexus del SIC. Es pot validar la seva existència accedint a la següent URL: https://hudson.intranet.gencat.cat/nexus. <br/>\n\nEn cas de tractar-se d'una llibreria pròpia amb codi repositat al SIC, caldrà construir un job d'instal·lació de dependències. En aquest cas, les etapes es simplificaran considerablement de forma que bàsicament **es construeixi l'artefacte i es publiqui al Nexus del SIC**.\n\n## Autoservei de jobs pipeline\n\nL'Autoservei de jobs pipeline permet als usuaris del SIC la **generació al vol de pipelines d'automatització de la construcció i del desplegament de l'aplicació** sense la intervenció de l'equip del SIC. D'aquesta manera, els equips de cada codi d'aplicació són independents per preparar la construcció del job corresponent per a cada projecte de GitLab.\n\nAquest autoservei de pipelines es basa en la generació de jobs a partir d'arxius de configuració que els equips que en són responsables informen i publiquen al Git. La pipeline de generació identifica si hi ha hagut canvis en aquests arxius al fer un push i s'encarrega de generar una nova versió de la pipeline de desplegament. Finalment, l'executa.\n\nA continuació, entrarem en més detall sobre com funciona aquest nou servei que ofereix el SIC.\n\n### Motivació\n\nEls objectius que vol assolir aquesta nova funcionalitat són:\n\n* La línia estratègica de DevOps que està marcant CTTI requereix **flexibilitat i independència** en els principals actors que intervenen en la construcció i els desplegaments de les aplicacions.\n* A tal efecte, una necessitat clau és anular la dependència existent cap a l'equip del SIC, que fins ara implementava els automatismes de construcció i desplegament. Amb aquest nou model **els usuaris del SIC són autosuficients per generar-se ells mateixos les seves pròpies pipelines**.\n* Com a conseqüència del punt anterior, **no cal ajustar-se al calendari de l'equip SIC per obtenir les pipelines de construcció i desplegament**. Els propis usuaris poden implementar-les en el moment que els hi sigui més adient.\n* **Augmenta l'eficiència en les integracions d'aplicacions al SIC**, ja que s'eliminen del procés traspassos innecessaris d'informació i de responsabilitats a l'equip SIC.\n* De retruc, el fet d'afegir un sistema de configuració amb arxius YML independents de la plataforma d'Integració Contínua Jenkins **proporciona al SIC un nivell d'abstracció addicional amb el que es podria disposar d'altres eines d'automatització sense afectar als usuaris**.\n\n### Funcionament\n\nGeneralment, a cada codi d'aplicació li correspon un proveïdor d'aplicacions i un proveïdor d'infraestructures. Aquests dos equips **han de participar i col·laborar** per tal d'utilitzar l'autoservei de jobs pipeline del SIC aportant la informació necessària de la que cadascun és responsable.\n\n![Pipeline del SIC](/images/news/AutoserveiJobs-Funcionament.png)\n\nEl funcionament previst és el següent:\n\n1. Els **proveïdors d'aplicacions i els proveïdors d'infraestructures aportaran cadascun d'ells el seu propi arxiu de configuració**.\n2. Si es fa algun canvi en la configuració de l'autoservei corresponent a l'aplicació s'invocarà a la pipeline generadora de jobs. Aquesta pipeline recupera els arxius de configuració necessaris per a la **generació de la pipeline** de l'aplicació i la dispara.\n3. En posteriors execucions, sempre que no es canviï l'arxiu de configuració, **no es tornarà a regenerar** i s'invocarà directament la darrera pipeline generada.\n\nD'aquesta manera, mitjançant els arxius de configuració proporcionats per cada proveïdor, s'invoca a una **pipeline generadora de pipelines** que construeix la pipeline encarregada de la construcció i del desplegament de l'aplicació.\nFinalment, un cop generada la nova pipeline, aquesta serà invocada per realitzar la construcció i el desplegament automatitzats definits als arxius de configuració.\n\n### Configuració\n\nCaldrà realitzar les tasques prèvies de configuració per a que el sistema sigui capaç de generar una tasca de desplegament operativa.\n\n<br/>\n#### Arxiu de Configuració de l'Aplicació (ACA)\n\nLa informació que aporta el proveïdor d'aplicacions quedarà recollida en l'arxiu `/sic/aca.yml` dins del repositori del projecte. La seva existència és la que determina si l'aplicació té actiu el mode Autoservei de Pipelines. Es tracta d'un arxiu de text en format YAML, que serà responsabilitat del proveïdor d'aplicacions de mantenir-lo actualitzat, en el que s'ha d'aportar la següent configuració:\n\n* **Versió**: versió (independent de la versió de l'aplicació) que s'utilitza per fer seguiment de l'arxiu de configuració.\n* **Paràmetres**: parells clau-valor en els que es farà substitució dins de la pipeline.\n* **Recursos**: diferents tipus de recursos als que es fa referència en la pipeline.\n    - **Entorns**: entorns als que es desplega l'aplicació, així com el seu ordre i la modalitat de desplegament desitjada.\n    - **Infraestructures**: denominació d'infraestructures destí (cal demanar al proveïdor d'infraestructures la denominació de la infraestructura).\n    - **Artefactes**: artefactes a generar durant el procés de construcció que s'han de desplegar en el procés de desplegament.\n* **Procés de construcció**: definició del procés de construcció amb l'ús de passes (*steps*) de construcció.\n* **Procés de desplegament**: definició del procés de desplegament amb l'ús de passes (*steps*) de desplegament.\n* **Notificacions**: definició d'adreces de correu electrònic on notificar accions manuals en espera i resultats de l'execució.\n\nEs proporciona una [Guia de construcció del fitxer ACA](/howtos/2018-05-SIC-Autoservei-jobs-pipeline-ACA) amb un exemple de cas d'ús.\n\n<br/>\n#### Arxiu de Configuració d'Infraestructures (ACI)\n\nD'altra banda, la informació que aporta el proveïdor d'infraestructures queda recollida en el seu repositori del SIC. En aquest repositori hi dipositarà els arxius de configuració d'infraestructures (en pot tenir més d'un per aplicació o projecte), el nom dels quals -sense l'extensió- és l'identificador que ha de facilitar al proveïdor d'aplicacions.\n\nSerà responsabilitat del proveïdor d'infraestructures tenir actualitzada aquesta informació i de notificar al proveïdor d'aplicacions quan hagi realitzat algun canvi. El proveïdor d'aplicacions haurà de fer com a mínim un increment de versió a l'ACA per tal de provocar la regeneració de la pipeline incorporant els canvis realitzats pel proveïdor d'infraestructures a la nova pipeline generada.\n\nEl proveïdor d'infraestructures haurà d'informar als seus arxius de configuració:\n\n* **Versió**: versió de l'arxiu de configuració.\n* **Recursos**: secció que recull tots els recursos de la part d'infraestructures. Actualment, només hi ha el detall de cada infraestructura.\n* **Infraestructures**: detall de les infraestructures incloses en aquest arxiu de configuració.\n\nS'han d'incloure tots els entorns de les capes/stacks definides en l'arxiu pertinent.\n\n##### Clau pública\n\nLa infraestructura de clau pública (PKI en anglès) permet establir un sistema de xifrat en el que es permet l'execució amb garanties operacionals criptogràfiques, tals com el xifrat, la firma digital i el no repudi de transaccions electròniques.\n\nEl SIC aprofita els avantatges d'aquest sistema oferint aquesta clau pública als seus usuaris per tal que aquests puguin fer-ne ús en els procediments operatius que la requereixin. Es tracta d’un arxiu `.pem` amb la clau pública del SIC. Aquesta clau consisteix en una RSA de 4096 bits.\n\nEn el casos en els que el proveïdor d'infraestructures necessita introduir paraules de pas als descriptors ACI, per encriptar-les pot utilitzar la següent comanda:\n\n    ```\n    $ echo '<password_a_encriptar>' | openssl rsautl -encrypt -pubin -inkey sic_id_rsa.pub.pem | base64\n\tK0zcD3BuLKN55XVjqpovmwbJDEVehnEN7pz06ytPMlBowuc2IATSyH/c/zN5EmLE5DFoJcRLFA9B\n\tNmf0rh0yzUDb3kS+jXUuFhx+N35N2ScbemiZL3sjji3icXqgWmiQTmfp1hCAZgq5oMfMJzpwjWlq\n\tubT15lXq/6jgkj0hS9pYUpZBz0rH6IX0q81xRvsnQteMyrtQik/p/2ZaTbj0ciiLG61kkVcGSZLo\n\tsr9iOVdFh3q8Ok7+CAPhKaa/maGn0LEeaafj+5pBLE9AWcOy98imBRUzr4C8bi9ydMjuRdvd12XT\n\t1JdcHer/G1ZWBx9yEIYQEGgG/eFR4njNBjtjH/A53YBcbLIH2ZzHI3v33PCE5W3aVoK5qVqdVf64\n\tGlicdVQ2VSm7ROE4bfcUu4BzVw1em6hUw6LSXxH6GrKVxFe0JVWbrIlOyDL1nGu3Yu6zdplayK+q\n\tanqNjSRixyLOjoKon2g80dHGd12S7j1av3oyhPz/1KlqMt71YgTrZG3GxeW7NB356V/18bY/PwCn\n\tUcNttMs3oOvt+6d4UgeqqesA1fgDx92X+zIoyOTh2rnkfWo554cwqg+w3JaB5Kp30vGJNXwrvR+W\n\t+x4v2PLCO1D2b59Bb3n9/rFENXHE8wYLPAecPoSNjB6dB2/JdZibUwDJz+T98nOlcgJ7FcBBQ4s=\n\t$\n    ```\n\n<a href=\"/related/sic/key/sic_id_rsa.pub.pem\" download target=\"_blank\" style=\"display: block; margin: 25px auto; border-radius: 5px; width: 200px; padding: 10px; color: white !important; text-decoration: none !important;background-color: #CC0000;text-align: center;font-weight:bold;\">\nDescarregar la clau\n</a>\n\n### Què es pot realitzar amb l'Autoservei de jobs pipeline?\n\nAmb l'autoservei de jobs pipeline es poden definir tants entorns i infraestructures com siguin necessaris per a la construcció i el desplegament d'una aplicació.\n\n#### Tecnologies integrades a l'Autoservei de jobs\n\nHi ha les següents tecnologies de construcció suportades:\n\n* Maven (Java)\n* Ant (Java)\n* MS Build (.NET)\n* Npm (NodeJS)\n* Hugo (Webs estàtiques)\n\nFinalment, també s'integren els desplegaments a:\n\n- Servidor web Apache\n- Servidors d'aplicacions\n    - Tomcat (Java)\n    - Weblogic (Java)\n    - Websphere (Java)\n    - JBoss (Java)\n    - IIS (.NET)\n- Servidors de Bases de Dades\n  - MySQL\n  - MongoDB\n  - PostgreSQL\n  - Oracle\n  - SQL Server\n\nPer a més detall del que es pot fer amb l'Autoservei de Jobs pipeline, us recomanem que consulteu l'apartat 7 del [manual d'usuari.](/related/sic/manual-usuari.pdf).\n\n## Matriu de tecnologies compatibles\n\nLes tecnologies de construcció d'aplicacions serveixen per gestionar el cicle de vida d'una aplicació o algunes de les seves fases. <br/>\nA continuació, s'exposen les tecnologies i les versions amb les que el SIC és compatible.\n\n|Tecnologia|Versions|\n|-------|-------|\n|Ant|1.8.2<br />1.9.6|\n|Maven|2.0.10<br />2.2.1<br />3.2.2<br />3.3.9|\n|MS_Build|4.0|\n|MS_Deploy|7.1|\n\nCas particular de tecnologies front-end:\n\n|Versió node|Versió npm|\n|-----------|----------|\n|0.12.3|2.15.0|\n|4.4.3|2.15.1|\n|5.10.1|3.8.3|\n|8.12.0 (LTS)|6.4.1|\n\nL'única eina que va lligada en certa manera amb la versió de node és **npm**. La resta d'eines de cicle de vida (tals com **bower**, **gulp** i **grunt**) s'han d'incloure amb l'aplicació per a què el SIC les utilitzi per a la seva construcció. Pel que fa a [Angular](https://angular.io/), framework de frontend recomanat per Arquitectura CTTI i el CS Canigó, l'aplicació definirà la versió de **ng** (Angular-cli) a utilitzar per a la seva construcció.\n\n**<span style=\"color: #C00000;\">AVÍS:</span>** Aquesta normativa del SIC no invalida l'[Estàndard pel full de ruta del programari](https://qualitat.solucions.gencat.cat/estandards/estandard-full-ruta-programari/#servidors-d-aplicacions), ans al contrari, l'estén per acabar de concretar els requeriments propis del SIC.\n\n### Properes passes\n\nEs preveu l'ús del patró builder amb Docker. En aquest model, es disposa d'un contenidor de construcció que genera l'artefacte desitjat, podent-ne instal·lar en el seu interior les tecnologies i eines necessàries que siguin requerides.\n\n<br/><br/><br/>\nSi voleu més informació podeu consultar la secció de [Manuals](/sic/manuals/). <br/>\nSi teniu qualsevol dubte o problema assegureu-vos de no trobar resposta a les [FAQ] (/sic/faq) i utilitzeu el canal de [Suport] (/sic/suport) o contacteu amb l'Oficina Tècnica Canigó CTTI a través del correu electrònic: **oficina-tecnica.canigo.ctti@gencat.cat**.\n","objectID":"L3NpYy1zZXJ2ZWlzL2Np"},"L3NpYy1zZXJ2ZWlzL2JpbmFyaXM=":{"date":1550793600000,"title":"Binaris","description":"Eina del SIC per el lliurament d'artefactes a CPD","sections":"SIC","aliases":["/noticies/2017-07-05-SIC-Gestio-binaris/"],"toc":true,"taxonomies":[],"weight":3,"path":"/sic-serveis/binaris","content":"## Introducció\n\nEl sistema de gestió de **binaris del SIC** s'encarrega de:\n\n* Emmagatzemar els binaris que entreguen els Release Managers (o el sistema d'integració contínua per a entorns amb desplegament no automàtic) per  a deixar-los a disposició del CPD/LdT encarregat de desplegar-los.\n* Emmagatzemar els binaris i arxius pesats que no són permesos dins de GIT i que, per algun motiu, no es poden emmagatzemar al Nexus (material multimèdia pesat, binaris que no són dependències, etcètera) per a aplicacions que repositen codi font.\n\n<span style=\"color: #C00000;font-weight: bold\">AVÍS:</span> <span style=\"color: #C00000\">Només es conservaran les últimes 5 versions per codi d'apliació i projecte, així com versions anteriors amb menys d'un mes de vida (30 dies).</span>\n\n## Funcionament\n\n### Accés al servei\n\nPodrà accedir mitjançant el següent enllaç: https://bin.sic.intranet.gencat.cat <br/>\nHaurà d'autenticar-se amb de les seves credencials d'accés **GICAR**. Els Release Manager, responsables de lot i tècnics de CPD disposaran d'accés al servei. Si no disposa d'accés, haurà de sol·licitar-ho al seu responsable.\n\n<br/>\nPer a més informació: [Autoservei d'usuaris] (/sic-serveis/autoservei-usuaris/)\n\n<CENTER>![Binaris](/images/news/SIC-GestioBinarisPortal.png)</center>\n<br/>\n\n### Pujada d'artefactes\n\nAquest servei està destinat a aplicacions que, ja sigui per estar desenvolupades amb una tecnologia no suportada o per particularitats del procés de construcció, no es poden construir i desplegar mitjançant el servei d'integració contínua. <br/>\nPer a més informació: [Manual d'Integració](/related/sic/manual-integracio.pdf). <br/>\n\nEn accedir al servei es mostra una pàgina de benvinguda amb l'acció **Dipositar artefactes al SIC**. <br/>\nAquesta acció és únicament accessible per als lots d'aplicacions i redirigieix a l'usuari al job de Jenkins de pujada d'artefactes al SIC. Es tracta d'un mateix job per a tots els Release Managers de tots els lots. No registra traces amb informació sensible i transmet els links amb les ubicacions dels manuals i artefactes per correu electrònic a l'usuari que ha iniciat l'execució.\n\nAquest job sol·licita la següent informació:\n\n* **Codi d'aplicació**: número de 4 xifres que es correspon amb el codi de diàleg (obligatori).\n* **Projecte**: identificador del projecte (obligatori).\n* **Versió**: número de versió de lliurament (obligatori). **El codi de versió ha de complir la normativa establerta per l'Oficina de Qualitat respecte a la nomenclatura de versions. En breu el sistema comprovarà aquest requisit.** Per a més informació: [Estàndard de versions] (https://qualitat.solucions.gencat.cat/estandards/estandard-versions-programari)\n* **Arxiu de binaris**: arxiu de binaris que desitja dipositar (obligatori).\n* **Descomprimir ZIP**: indica si l'arxiu de binaris caldrà descomprimir-lo un cop pujat (per defecte, sí).\n* **Arxiu de documentació**: arxiu de documentació que desitja associar (opcional).\n\nEl job validarà que el codi d'aplicació sigui vàlid i que l'usuari disposi dels corresponents permisos. Si s'especifica una combinació de codi d'aplicació, projecte i versió ja lliurada anteriorment, el sistema sobreescriurà el seu contingut.\n\n<br/>\n<span style=\"color: #C00000;font-weight: bold\">AVÍS:</span> <span style=\"color: #C00000\">El dia 24/01/2019 es va activar el mode restrictiu en la validació que la pujada d'un nou binari vingui acompanyada de l'actualització de la versió del codi font del projecte corresponent al Git.</span> Només estan exemptes les aplicacions que disposen d'una excepció aprovada en la custodia de codi.\n\n### Recuperació d'artefactes\n\nEn accedir al servei es mostra una pàgina de benvinguda amb l'acció **Recuperar artefactes del SIC**. <br/>\nAquesta acció és accessible tant pels Release Managers de tots els lots com per a tots els administradors de tots els CPDS/LdT i serà utilitzada per CPD/LdT de cara al desplegament de les aplicacions. Aquests accediran al servei en mode lectura a través del frontal web.\n\n## Eliminació de binaris\n\nS'executa un **procés diari nocturn** d'esborrat de binaris de forma que es respectaran únicament les últimes 5 versions repositades per codi d'aplicació i projecte; i, pel que fa a versions anteriors, es respectaran si aquestes han estat pujades durant l'últim mes (30 dies). No està concebut, per tant, com un servei de custodia permanent de binaris si no com un sistema d'intercanvi de binaris amb CPD/LdT per al desplegament d'aplicacions.\n\n<br/><br/><br/>\nSi voleu més informació podeu consultar la secció de [Manuals](/sic/manuals/). <br/>\nSi teniu qualsevol dubte o problema assegureu-vos de no trobar resposta a les [FAQ] (/sic/faq) i utilitzeu el canal de [Suport] (/sic/suport) o contacteu amb l'Oficina Tècnica Canigó CTTI a través del correu electrònic: **oficina-tecnica.canigo.ctti@gencat.cat**.\n","objectID":"L3NpYy1zZXJ2ZWlzL2JpbmFyaXM="},"L3NpYy1zZXJ2ZWlzL3NjbQ==":{"date":1546387200000,"title":"Custodia de codi font","description":"GitLab és l'eina implantada al SIC per la custodia de codi font","aliases":["/howtos/2017-07-Howto-Migrar-repositori-SVN-a-repositori-GIT/"],"sections":"SIC","taxonomies":[],"toc":true,"weight":1,"path":"/sic-serveis/scm","content":"## Introducció\n\n![GitLab](/related/sic/serveis/gitlab-logo.png \"GitLab\")\n\n**GitLab** és l'eina implantada al SIC per la custodia de codi font. Es tracta d'un servei web de control de versions i desenvolupament de software col·laboratiu basat en Git. A més de gestor de repositoris, el servei ofereix també allotjament de Wikis i un sistema de seguiment d'errors, tot publicat sota una llicència de codi obert. \n\nAquest repositori no és un entorn de desenvolupament, per lo que només les persones assignades com a Release Managers seran les encarregades de **consolidar el codi i lliurar-lo**. Aquest codi font ja haurà d’estar validat en entorns de desenvolupament i es lliurarà quan es decideixi distribuir als entorns dels serveis TIC centrals.\n\n## Funcionament\n\n### Accés al servei\n\nPodrà accedir mitjançant el següent enllaç: https://git.intranet.gencat.cat <br/>\nHaurà d'autenticar-se amb de les seves credencials d'accés **GICAR**. Els Release Manager, responsables de lot i tècnics de CPD disposaran d'accés al servei, així com la resta de membres de l'equip de desenvolupament als que es decideixi atorgar accés. Si no disposa d'accés, haurà de sol·licitar-ho al seu responsable. <br/>\n\n![GitLab](/related/sic/serveis/gitlab-sic.png)\n<br/>\n\n### Creació de comptes d'usuari i permisos d'accés\n\nPer a poder accedir al servei caldrà disposar d'un usuari GICAR operatiu (amb l'adreça de correu associada) i crear el compte corresponent. Per a fer-ho, haurà d'introduir l'identificador d'usuari i contrasenya i, en cas de tractar-se d'un nou compte, el sistema el redirigirà a la plana de perfil per a que pugui dur a terme el procés d'alta. <br/>\nSi no disposa d'accés als grups i projectes s'haurà d'adreçar als **Release Managers** del codi de diàleg o al responsable del lot per a que l'incloguin com a membre del projecte o projectes que es considerin. A partir d’aquest moment, ja podrà gestionar el codi font i a l'endemà l'usuari passarà a ser un Release Manager a tots els efectes, disposant d'accés a tots els serveis del SIC per al codi de diàleg corresponent.\n\nPer a més informació: [Autoservei d'usuaris] (/sic-serveis/autoservei-usuaris/)\n\n### Estructura de grups i projectes\n\nTotes les aplicacions que recull l'inventari d'aplicacions disposen automàticament d'un grup al GitLab per al codi de diàleg del CTTI corresponent (per exemple: https://git.intranet.gencat.cat/0192). Dins el grup assignat, es poden crear tants projectes com conjunts de codi susceptibles de ser versionats de forma independent. Pot tractar-se d'una **llibreria, un microservei, un mòdul o un programa sense fragments independents**.\n<br/>\nPer accedir a la vista de grups i projectes, ho podrà fer des del menú d'opcions generals (botó <img style=\"display:inline\" src=\"/images/news/icone_menu_gitlab.PNG\" alt=\"icone menu gitlab\"/> situat a la part superior esquerra).\n<br/>\nNo es poden incloure binaris de llibreries ni d’altres mòduls ni executables (JAR, WAR, EAR, DLL, EXE…) i la mida màxima dels arxius serà de 25MB. En tot cas, a tal efecte es podrà fer ús del servei de gestió de binaris.\n\nPer a més informació: [Binaris] (/sic-serveis/binaris/)\n\n### Creació de nous projectes\n\nPer a crear nous projectes caldrà dirigir-se al grup del codi de diàleg i prémer l'acció \"New project\". Haurà d'indicar el nom del projecte i seleccionar el nivell de visibilitat \"Private\".\n\n<CENTER>![Nou projecte](/related/sic/serveis/new_project.png)</center>\n<br/>\n\n### Integració contínua\n\nEn publicar una nova versió del codi font sobre la branca MASTER, automàticament es dispararà la tasca de construcció i desplegament associada en el sistema d'Integració Contínua (Jenkins). En aquest sentit, cal tenir pressents algunes premisses:\n\n* Els repositoris poden tenir tantes branques com siguin necessàries, però sempre s’haurà d’incloure la branca **MASTER** i el contingut d’aquesta branca serà amb el que treballarà la tasca associada.\n* Cal proporcionar processos de construcció d’artefactes **independents de les màquines i plataformes** on s’executen, de forma que siguin aplicables tant en els entorns de desenvolupament com en els entorns del SIC.\nPer a més informació: [Integració contínua] (/sic-serveis/ci/)\n\n## Migració repositoris SVN a Git\n\nPer aplicacions que encara no hagin migrat el seu codi font cap a l'eina actual de custodia de codi font del SIC (GitLab), podran fer-ho si s'acompleixen els següents requisits:\n\n* Utilitzar un sistema operatiu Linux i tenir instal·lats els paquets git, git-svn i svn.\n* El repositori a migrar **no pot contenir binaris** (.jar, .war, .ear, .dll, .exe, carpeta \"node_modules\") **ni arxius de mida superior a 25 MB**.\nActualment el repositori original a SVN es troba disponible en mode lectura per a poder accedir a l'historial. Per a dur a terme la migració al nou sistema, caldrà seguir les següents passes:\n\n<br/>\n#### 1. Eliminació de binaris\n\nEl Git del SIC té restriccions alhora de pujar fitxers binaris, fet que pot provocar errors en el procés de migració. Aquests repositoris que tinguin binaris no es podran migrar al Git, romandran en el SVN en mode lectura. Per aquests casos, per començar a treballar amb Git s'haurien de seguir els següents passos:\n\n* Descarregar el darrer tag del SVN\n* Eliminar els binaris. Podem tenir dos casos:\n\t- Binaris prescindibles: es poden generar a partir de codi font de l'aplicació, i per tant, no cal conservar-los\n\t- Binaris no prescindibles: s'han d'ubicar en el [servei de custodia de binaris](/sic-serveis/binaris/) o al [Nexus](https://hudson.intranet.gencat.cat/nexus/) del SIC.\n* Inicialitzar el repositori Git local (git init)\n* Fer el commit, push i tag d'aquesta versió inicial al Git\nUn cop finalitzat aquest procés al Git es disposarà del tag més recent. L'històric es mantindrà al SVN en mode lectura.\n\n<br/>\n#### 2. Obtenir els autors\n\nEn primer lloc, s'ha de consultar qui ha modificat els arxius del SVN. Per fer això s'ha preparat un [job de Jenkins] (https://hudson.intranet.gencat.cat/hudson/job/MIGRACIO_GENERAR_AUTORS/).\n\nS'ha d'executar aquest job informant els següents paràmetres:\n\n\tDEPARTAMENT -> acrònim del departament (En una ruta com http://svn.intranet.gencat.cat/ctt/0192/) seria ctt )\n\tCODI_DIALEG -> codi de diàleg (Per exemple 0192)\n\nUna vegada executat el job envia per email el fitxer author.txt a l'usuari que ha executat el job.\n\nS'ha de descarregar i desar el fitxer a la carpeta desitjada, en aquest howto /migració.\n\nA més d'obtenir el fitxer author.txt, s'ha de descarregar el següent [fitxer] (/related/sic/howto/unknown_author.zip) i descomprimir-lo en la mateixa carpeta (/migracio). Aquest zip conté un procés per a evitar errors en el següent pas.\n\n<br/>\n#### 3. Obtenir les dades del SVN\n\nPer a obtenir les dades del SVN que s'han de migrar, dintre de la carpeta /migracio (on es troba el fitxer author.txt) executar:\n\n\tgit svn clone --authors-file=author.txt --authors-prog=unknown_author.sh http://svn.intranet.gencat.cat/$1/$2/$3 --no-metadata -s $4\n\nOn s'ha de substituir les variables segons:\n\n\t$1 -> acrònim del departament (En una ruta com http://svn.intranet.gencat.cat/ctt/0192/) seria ctt )\n\t$2 -> codi de diàleg (Per exemple 0192)\n\t$3 -> path de la carpeta que conté les carpetes tags, trunk i branches. En cas que estiguin a l'arrel no posar res.\n\t$4 -> nom de la carpeta que es crea al sistema de fitxers locals on es deixa el codi\n\n<br/>\n#### 4. Tractament del codi SVN\n\nAccedir a la carpeta que s'ha creat en el punt anterior ($4) i abans de pujar el codi a Git executar les següents comandes:\n\n\tcp -Rf .git/refs/remotes/origin/tags/* .git/refs/tags/\n\trm -Rf .git/refs/remotes/origin/tags\n\tcp -Rf .git/refs/remotes/* .git/refs/heads/\n\trm -Rf .git/refs/remotes\n\tfor i in $(ls .git/refs/tags/ -1 | grep '@'); do rm \".git/refs/tags/$i\"; done\n\t\n<br/>\n#### 5. Crear projecte en Git\n\nPer a crear el projecte en Git heu d'accedir a https://git.intranet.gencat.cat anar al grup del vostre codi de diàleg i prémer l'acció \"New Project\".\n\n<br/>\n#### 6. Pujar el codi a Git\n\nA la carpeta on s'ha desat el codi del SVN executar:\n\n\tgit remote add origin https://$1@git.intranet.gencat.cat/$2/$3.git\n\nOn s'ha de substituir les variables segons:\n\n\t$1 -> usuari GitLab\n\t$2 -> codi de diàleg (Per exemple 0192)\n\t$3 -> Nom del projecte de GitLab\n\nPer finalitzar es puja el codi a Git\n\n\tgit push origin --all\n\tgit push --tags\n\t\nÉs molt important analitzar el log que mostra Git per pantalla per assegurar que no hi ha errors i s'han migrat tant el trunk com tots els tags.\n\n<br/><br/><br/>\nSi voleu més informació podeu consultar la secció de [Manuals](/sic/manuals/). <br/>\nSi teniu qualsevol dubte o problema assegureu-vos de no trobar resposta a les [FAQ] (/sic/faq) i utilitzeu el canal de [Suport] (/sic/suport) o contacteu amb l'Oficina Tècnica Canigó CTTI a través del correu electrònic: **oficina-tecnica.canigo.ctti@gencat.cat**.","objectID":"L3NpYy1zZXJ2ZWlzL3NjbQ=="},"L3NpYy13ZWxjb21lLXBhY2svZWluZXNfc2lj":{"date":1546819200000,"title":"Quin són els serveis del SIC i com fer-ne ús","description":"Guia amb la informació més rellevant per a l'ús dels serveis que proporciona el SIC","sections":"SIC","toc":true,"taxonomies":[],"weight":1,"path":"/sic-welcome-pack/eines_sic","content":"## Introducció\r\n\r\nEl SIC proporciona una sèrie de serveis: custodia de codi font (GitLab), integració contínua (Jenkins i Nexus) i binaris. Aquests serveis resulten d'**obligat ús excepte si les aplicacions utilitzen altres sistemes homologats o n'estan exemptes**. Si no és el cas i la tecnologia de l'aplicació permet desplegar-la automàticament via SIC, esdevindrà requisit imprescindible per al pas a producció.\r\n\r\nTots els serveis del SIC basen la gestió d'usuaris en la identitat **GICAR** associada proporcionant un **autoservei d'usuaris** per a disposar d’autonomia a l'hora d'atorgar-hi accés a la resta de membres de l'equip de desenvolupament.\r\n\r\n## Modalitats d'integració\r\n\r\nPer tant, es contemplen tres tipus de modalitats d'ús dels serveis:\r\n\r\n* **Automatitzada**: \r\n\t- Es realitza custodia de codi i les fonts s'actualitzen en cada lliurament.\r\n\t- S'utilitzen les eines de construcció i desplegament automatitzat d'artefactes, lliurant els artefactes per al desplegament de preproducció i producció mitjançant el servei de binaris (excepte Cloud que es desplega automàticament en aquests entorns).\r\n* **Sense automatització**, per aplicacions que no es poden desplegar automàticament perquè la seva tecnologia o especificitats no ho permeten:\r\n    - Es realitza custodia de codi i les fonts s'actualitzen en cada lliurament.\r\n\t- Els arxius es lliuren a CPD/LdT mitjançant el servei de binaris.\r\n* **Sense integrar**, per aplicacions exemptes de custodia de codi:\r\n    - Si no es fa ús d'un altre sistema homologat, els arxius es lliuren a CPD/LdT mitjançant el servei de binaris.\r\n    \r\n## Custodia de codi (GitLab)\r\n\r\n* **Com accedir**: https://git.intranet.gencat.cat mitjançant usuari GICAR.\r\n* **Tipus de solució**: servei de control de versions.\r\n* **Com crear un compte**: introduir credencials d'accés GICAR, essent imperatiu disposar d'adreça de correu associada, i realitzar el procés d'alta del perfil.\r\n* **Qui pot accedir**: els Release Manager, responsables de lot, tècnics de CPD i els membres de l'equip de desenvolupament als que s'atorgui accés.\r\n* **Com disposar d'accés**: sol·licitar al seu responsable que l'incorpori com a membre del/s projecte/s, ja sigui com a desenvolupador (Developer) o com a nou integrant del grup de Release Manager (Master).\r\n* **Com organitzar els projectes**: els projectes s'ubiquen dins el grup del codi d'aplicació, creant tants projectes com conjunts de codi susceptibles de ser versionats de forma independent.\r\n* **Quan i com fer el lliurament d'una nova versió**: un cop validat als entorns de desenvolupament, es consolidarà, es realitzarà l'increment de versió i es pujarà al repositori. Si el projecte disposa d'una tasca de construcció i desplegament automàtic i l'actualització s'ha fet sobre la branca MASTER, es dispararà la tasca corresponent al Jenkins.\r\n\r\nPer a més informació: [Custodia de codi font] (/sic-serveis/scm/)\r\n\r\n## Integració contínua\r\n\r\n### Jenkins\r\n\r\n* **Com accedir**: https://hudson.intranet.gencat.cat/hudson/ mitjançant usuari GICAR.\r\n* **Tipus de solució**: servei per a la integració contínua (construcció, anàlisi, desplegament, proves... etcètera).\r\n* **Qui pot accedir**: els Release Manager, responsables de lot i tècnics de CPD.\r\n* **Com disposar d'accés**: sol·licitar al seu responsable que l'incorpori com a membre del/s projecte/s al servei de control de versions (Gitlab) com a nou integrant del grup de Release Manager (Master). A l'endemà, l'usuari haurà passat a ser Release Manager disposant del corresponent accés al servei.\r\n* **Com fer el lliurament d'una nova versió**: l'actualització del codi de la branca MASTER dispararà la tasca de construcció i desplegament (job de tipus \"pipeline\").\r\n* **Quines passes componen el desplegament automàtic**: construcció, generació de tags i desplegament als diferents entorns. Opcionalment es poden realitzar tests unitaris, tests d'integració i anàlisi de codi font.\r\n* **Quines passes de desplegament requereixen conformitat**: el pas a preproducció i producció requeriran de conformitat prèvia (etapes anteriors verificades). En funció de si el desplegament és semiautomàtic o automàtic per CPD, aquesta conformitat serà responsabilitat del grup de Release Managers o dels tècnics de CPD (respectivament).\r\n\r\n### Nexus\r\n\r\n* **Com accedir**: https://hudson.intranet.gencat.cat/nexus/.\r\n* **Tipus de solució**: servei per a l'administració central de biblioteques.\r\n* **Qui pot accedir**: no requereix autenticació, tothom pot accedir en mode lectura.\r\n* **Com publicar noves llibreries**: per a la publicació de noves llibreries no públiques (pròpies o de tercers) caldrà sol·licitar-ho a l'equip de SIC.\r\n\r\n<br/>\r\nPer a més informació: [Integració contínua] (/sic-serveis/ci/)\r\n\r\n## Binaris\r\n\r\n* **Com accedir**: https://bin.sic.intranet.gencat.cat/ mitjançant usuari GICAR.\r\n* **Tipus de solució**: servei de lliurament i recuperació d'artefactes.\r\n* **Qui pot accedir**: els Release Manager, responsables de lot i tècnics de CPD.\r\n* **Com disposar d'accés**: sol·licitar al seu responsable que l'incorpori com a membre del/s projecte/s al servei de control de versions (Gitlab) com a nou integrant del grup de Release Manager (Master). A l'endemà, l'usuari haurà passat a ser Release Manager disposant del corresponent accés al servei.\r\n* **Com dipositar nous artefactes**: executar la tasca de pujada d'artefactes indicant, com a mínim: codi d'aplicació, projecte, versió i l'arxiu a dipositar. Pot incloure documentació associada.\r\n* **Com recuperar artefactes**: localitzar el codi d'aplicació, projecte i versió i podrà descarregar el contingut necessari.\r\n\r\nPer a més informació: [Binaris] (/sic-serveis/binaris/)\r\n\r\n<br/><br/><br/>\r\nEs tracta d’una guia ràpida per a informar dels aspectes més rellevants a tenir en compte per a l'ús de les eines del SIC.\r\n<br/>\r\nSi voleu més informació podeu consultar la secció de [Manuals](/sic/manuals/). <br/>\r\nSi teniu qualsevol dubte o problema assegureu-vos de no trobar resposta a les [FAQ] (/sic/faq) i utilitzeu el canal de [Suport] (/sic/suport) o contacteu amb l'Oficina Tècnica Canigó CTTI a través del correu electrònic: **oficina-tecnica.canigo.ctti@gencat.cat**.","objectID":"L3NpYy13ZWxjb21lLXBhY2svZWluZXNfc2lj"},"L3NpYy13ZWxjb21lLXBhY2svZml0eGVyLWFjYQ==":{"date":1546819200000,"title":"Com construir el fitxer ACA","description":"Guia amb la informació de construcció del fitxer ACA per a l'Autoservei de Jobs","aliases":["/howtos/2018-05-SIC-Autoservei-jobs-pipeline-ACA/"],"sections":"SIC","toc":true,"taxonomies":[],"weight":3,"path":"/sic-welcome-pack/fitxer-aca","content":"## Introducció\r\n\r\nDins el sistema d'Integració Contínua, el SIC proporciona un servei mitjançant el qual, amb el treball col·laboratiu dels proveïdors d'aplicacions i d'infraestructures i sense la intervenció de l'equip del SIC, es pot **construir un job d’automatització de la construcció i del desplegament** de forma automàtica.\r\n\r\n## Requeriments generals\r\n\r\nS'estableixen una sèrie de requeriments per a estar en disposició de preparar el fitxer:\r\n\r\n* **Col·laboració**: el proveïdor d'aplicacions i el proveïdor d'infraestructures han d'estar disposats a col·laborar i mantenir una comunicació de cara a alinear la configuració.\r\n* **L'aplicació ha de ser integrable amb l'automatització de la construcció i del desplegament**: el sistema ha de ser capaç de construir i desplegar l'aplicació, per lo que la seva tecnologia i especificitats han d'estar contemplades al sistema d'Integració Continua. \r\n* Tenir constància dels **entorns** on es desplegarà l'aplicació i les **modalitats de desplegament** aplicables en cada cas.\r\n* Per als entorns amb modalitat de desplegament automàtic, disposar dels **identificadors d'infraestructures** de desplegament.\r\n\r\n## Exemple: Aplicació d'equipaments\r\n\r\nA mode d'exemple, mostrarem com s'integraria una aplicació Canigó 3.2.4 com la d'Equipaments a l'Autoservei de jobs del SIC a partir de les següents consideracions:\r\n\r\n* **Codi d'aplicació: 9999**\r\n* Proveïdor d'aplicacions: **lot A99**\r\n* Proveïdor d'infraestructures: **CPD9**\r\n* Entorns i modalitats de desplegament: **INT (automàtica), PRE i PRO (semiautomàtica)**.\r\n* **Aplicació Canigó 3.2.4**.\r\n* Backend que en construir-se genera un **artefacte estàtic i un artefacte dinàmic** que es despleguen en servidor web **Apache i Tomcat** (respectivament).\r\n* **DB h2** embeguda.\r\n* Projecte **repositat al GitLab**, incloent l'arxiu `sic.yml` que inclou la versió actual de l'aplicació.\r\n\r\n### Acordar denominacions d'infraestructura\r\n\r\nA l'**Arxiu de Configuració de l'Aplicació (ACA)**, els proveïdors d'aplicacions han de fer referència a les infraestructures on despleguen el seus artefactes. No cal que en coneixin els detalls, simplement cal que s'enumerin indicant en quins entorns estan habilitades. Aquesta informació l'ha de facilitar el proveïdor d'infraestructures i que es declararan a l'**Arxiu de Configuració d'Infraestructures (ACI)**. \r\n\r\nEn el cas d'exemple, s'hi identifiquen les següents:\r\n\r\n* **Apache** → `9999_equipaments_apaches`\r\n* **Tomcat** → `9999_equipaments_tomcats`\r\n\r\n### Construcció de l'ACA\r\n\r\nEl proveïdor d'aplicacions haurà de generar l'ACA al repositori del seu projecte, concretament: `/sic/aca.yml`. \r\n\r\n#### Versió\r\n\r\nCaldrà indicar la versió de l'ACA, que segueix un versionatge diferent al de l'aplicació. En aquest cas, cada increment de versió es correspon amb **canvis en les especificacions de construcció i/o desplegament**.\r\n\r\n```\r\nversion: X.Y.Z\r\n```\r\n\r\n#### Paràmetres\r\n\r\nCaldrà indicar els paràmetres (són opcionals, per lo que pot tractar-se d'una llista de 0 elements). Els paràmetres s'utilitzen per aplicar substitucions, de forma que on aparegui `${nom_param}` s'aplicarà el valor `valor_param`.\r\n\r\n```\r\nparameters:\r\n  - name: nom_param_1\r\n    value: valor_param_1\r\n  - name: nom_param_2\r\n    value: valor_param_2\r\n```\r\n\r\n#### Recursos\r\n\r\nCaldrà definir els recursos dins l'entitat `resources`. Hi ha tres tipus de recursos:\r\n\r\n* Entorns (`environments`)\r\n* Infraestructures (`infrastructures`)\r\n* Artefactes (`artifacts`)\r\n\r\n##### Entorns\r\n\r\nEs tracta de definir els entorns de desplegament, incloent el seu ordre i la modalitat de desplegament aplicada:\r\n\r\n```\r\nresources:\r\n  environments:\r\n    - id: int\r\n      environment: int\r\n      position: 1\r\n      deploymentType: AUTOMATIC\r\n    - id: pre\r\n      environment: pre\r\n      position: 2\r\n      deploymentType: SEMIAUTOMATIC\r\n    - id: pro\r\n      environment: pro\r\n      position: 3\r\n      deploymentType: SEMIAUTOMATIC\r\n```\r\n\r\n##### Infraestructures\r\n\r\nCaldrà relacionar les denominacions d'infraestructures indicades pel proveïdor: tipus `element`, entorns `environments` i identificador del proveïdor `provider`.\r\nEn aquest cas, no hi ha cap variable d'entorn requerida a nivell d’infraestructura, per tant quedaria buida la secció `vars`.\r\n\r\n```\r\nresources:\r\n  (...)\r\n  infrastructures:\r\n    - id: 9999_equipaments_apaches\r\n      element: apache\r\n      environments:\r\n        - environment: int\r\n          vars:\r\n        - environment: pre\r\n          vars:\r\n        - environment: pro\r\n          vars:\r\n      provider: cpd9\r\n    - id: 9999_equipaments_tomcats\r\n      element: tomcat\r\n      environments:\r\n        - environment: int\r\n          vars:\r\n        - environment: pre\r\n          vars:\r\n        - environment: pro\r\n          vars:\r\n      provider: cpd9\r\n```\r\n\r\n##### Artefactes\r\n\r\nEls artefactes generats, en aquest cas, són dos: un artefacte dinàmic i un d'estàtic. Caldrà incloure la ruta corresponent de cada un d'ells:\r\n\r\n```\r\nresources:\r\n  (...)\r\n  artifacts:\r\n    - id: artifact01\r\n      artifactType: static\r\n      path: target/equipaments-static.zip\r\n    - id: artifact02\r\n      artifactType: dynamic\r\n      path: target/equipaments.war\r\n```\r\n\r\n#### Procés de construcció\r\n\r\nPer a construir l'aplicació Equipaments, caldrà executar una comanda maven amb els goals `clean` i `package`. És pot realitzar en un únic pas, per tant, s'hauria d'incloure un únic **step**:\r\n\r\n```\r\nbuild:\r\n  steps:\r\n    - id: bs001\r\n      position: 1\r\n      tool: maven_3.2.2\r\n      parameters: clean package -Dmaven.test.skip=true\r\n      jdk: JDK 1.8 \r\n      generates:\r\n        - artifact01\r\n        - artifact02\r\n```\r\n\r\nLa secció `generates` inclou una relació d'artefactes generats. Aquests han de correspondre amb els declarats a la secció `resources.artifacts`.\r\n\r\n#### Procés de desplegament\r\n\r\nPer al procés de desplegament, caldrà definir el desplegament de l'artefacte estàtic als servidors Apaches i de l'artefacte dinàmic als servidors Tomcat:\r\n\r\n```\r\ndeploy:\r\n  steps:\r\n    - id: dp001\r\n      position: 1\r\n      type: predefined\r\n      destination: 9999_equipaments_apaches\r\n      artifact: artifact01\r\n    - id: dp002\r\n      position: 2\r\n      type: predefined\r\n      destination: 9999_equipaments_tomcats\r\n      artifact: artifact02\r\n```\r\n\r\nEn aquest cas, hem optat per fer primer el desplegament de la capa web i a continuació el desplegament de la capa d'aplicació.\r\n\r\n#### Notificacions\r\n\r\nFinalment, caldrà indicar les adreces de correu electrònic on notificar accions manuals en espera i resultats de l’execució:\r\n\r\n\r\n```\r\nnotificationRecipients:\r\n    - usuari1@domini\r\n    - usuari2@domini\r\n```\r\n\r\n#### Resultat final\r\n\r\nD'aquesta manera, el fitxer resultant quedaria de la següent manera:\r\n\r\n```\r\nversion: 1.2.2\r\nparameters:\r\nresources:\r\n  environments:\r\n    - id: int\r\n      environment: int\r\n      position: 1\r\n      deploymentType: AUTOMATIC\r\n    - id: pre\r\n      environment: pre\r\n      position: 2\r\n      deploymentType: SEMIAUTOMATIC\r\n    - id: pro\r\n      environment: pro\r\n      position: 3\r\n      deploymentType: SEMIAUTOMATIC\r\n  infrastructures:\r\n    - id: 9999_equipaments_apaches\r\n      element: apache\r\n      environments:\r\n        - environment: int\r\n          vars:\r\n        - environment: pre\r\n          vars:\r\n        - environment: pro\r\n          vars:\r\n      provider: cpd9\r\n    - id: 9999_equipaments_tomcats\r\n      element: tomcat\r\n      environments:\r\n        - environment: int\r\n          vars:\r\n        - environment: pre\r\n          vars:\r\n        - environment: pro\r\n          vars:\r\n      provider: cpd9\r\n  artifacts:\r\n    - id: artifact01\r\n      artifactType: static\r\n      path: target/canigo324-static.zip\r\n    - id: artifact02\r\n      artifactType: dynamic\r\n      path: target/canigo324.war.original\r\nbuild:\r\n  steps:\r\n    - id: bs001\r\n      position: 1\r\n      tool: maven_3.2.2\r\n      jdk: JDK 1.8\r\n      parameters: clean package -Dmaven.test.skip=true\r\n      generates:\r\n        - artifact01\r\n        - artifact02\r\ndeploy:\r\n  steps:\r\n    - id: dp001\r\n      position: 1\r\n      type: predefined\r\n      destination: 9999_equipaments_apaches\r\n      artifact: artifact01\r\n    - id: dp002\r\n      position: 2\r\n      type: predefined\r\n      destination: 9999_equipaments_tomcats\r\n      artifact: artifact02\r\nnotificationRecipients:\r\n    - usuari1@domini\r\n    - usuari2@domini\r\n```\r\n\r\n\r\n<br/><br/><br/>\r\nSi voleu més informació podeu consultar la secció de [Manuals](/sic/manuals/). <br/>\r\nSi teniu qualsevol dubte o problema assegureu-vos de no trobar resposta a les [FAQ] (/sic/faq) i utilitzeu el canal de [Suport] (/sic/suport) o contacteu amb l'Oficina Tècnica Canigó CTTI a través del correu electrònic: **oficina-tecnica.canigo.ctti@gencat.cat**.\r\n","objectID":"L3NpYy13ZWxjb21lLXBhY2svZml0eGVyLWFjYQ=="},"L3NpYy13ZWxjb21lLXBhY2svcHJlcGFyYXItYXBsaWNhY2lv":{"date":1546560000000,"title":"Com preparar una aplicació per desplegar-la automàticament","description":"Guia amb la informació més rellevant a tenir en compte per la integració al SIC del desplegament d'una aplicació","sections":"SIC","toc":true,"taxonomies":[],"weight":2,"path":"/sic-welcome-pack/preparar-aplicacio","content":"## Introducció\r\n\r\nEn el cas que l’aplicació utilitzi el servei de custodia de codi i la seva tecnologia permeti la construcció i desplegament automatitzat d’artefactes, s’hauran d’acomplir una sèrie de requeriments per a que es pugui dur a terme la construcció dels corresponents jobs de desplegament.\r\n\r\n## Lliurament de codi font\r\n\r\nCal que es pugi el codi font de l’aplicació al sistema de gestió de codi font (SCM - Source Code Management) del SIC:\r\n\r\n* Els projectes han de crear-se dins el **codi de diàleg** adient, de forma que tota la gestió posterior de jobs i creació de peticions Remedy s'associïn a l'aplicació corresponent.\r\n* **No es poden incloure binaris** de llibreries ni d’altres mòduls ni executables (JAR, WAR, EAR, DLL, EXE...) i la mida màxima dels arxius serà de 25MB. A tal efecte, s’ha habilitat un sistema de gestió de [Binaris](https://bin.sic.intranet.gencat.cat).\r\n* Aquest repositori no és un entorn de desenvolupament, per lo que només les persones assignades com a **Release Managers** seran les encarregades de consolidar el codi i lliurar-lo. Aquest codi font ja haurà d'estar validat en entorns de desenvolupament i es lliurarà quan es decideixi distribuir als entorns dels serveis TIC centrals.\r\n* Els repositoris poden tenir tantes branques com siguin necessàries, però sempre s’haurà d’incloure la **branca MASTER** i el contingut d’aquesta branca serà amb el que treballaran les pipelines de Jenkins.\r\n* Les pipelines de Jenkins seran les encarregades de generar els **TAGS** corresponents. Es generaran TAGs de build un cop s’aconsegueixi construir els artefactes i TAGS definitius un cop finalitzada la verificació a l’entorn de PREPRODUCCIÓ.\r\n\r\n## Estructura de projectes\r\nL'estructura de projectes i el seu contingut ha de ser compatible amb el sistema establert d'Integració Contínua:\r\n\r\n* Dins del grup del codi de diàleg, es tindran **tant projectes com a conjunts de codi font susceptibles de ser versionats** de forma independent a la resta de projectes. Pot tractar-se d’una llibreria, un microservei, un mòdul o un programa sense fragments independents.\r\n* Cal proporcionar **procesos de construcció** d'artefactes independents de les màquines i plataformes on s'executen, de forma que siguin aplicables tant en els entorns de desenvolupament com en els entorns del SIC.\r\n* Tots els projectes hauran de disposar de la carpeta /sic/ al primer nivell de la carpeta de codi de projecte i, dins d’aquesta carpeta, cal crear l’arxiu **sic.yml** que albergarà la versió funcional del projecte. Per exemple: “version: 1.1.0”.\r\nLes aplicacions Canigò disposen d'un generador mitjançant un plugin de Maven que, a partir de la construcció de l'aplicació, generen automàticament el fitxer sic.yml amb la versió del POM.\r\n* Per tal d’automatitzar la creació de pipelines, els projectes hauran de disposar de l’arxiu de configuració **aca.yml** que caldrà ubicar dins la mateixa carpeta /sic/.\r\n* No es permet l'ús de versions **Snapshot**.\r\n* Si es contempla l'execució de scripts de desplegament a BBDD, cal preparar el fitxer de **plans** i scripts a una carpeta independent. \r\n\r\n## Llibreries\r\nRespecte a les llibreries requerides pels projectes, en funció del seu tipus, cal tenir en compte les següents premisses:\r\n\r\n* **Llibreries de tercers que no siguin públiques**: caldrà publicar-les manualment al Nexus, per lo que haureu d'indicar al SIC d'on baixar-les per tal d'enregistrar les llibreries oficials.\r\n* **Llibreries pròpies**: el seu codi font haurà d'estar en projectes diferenciats al grup corresponent al codi de diàleg. Aquestes es generaran i es publicaran al Nexus mitjançant jobs de Jenkins addicionals.\r\n* **Llibreries pròpies no associades a projecte**: hauria de tractar-se d'un cas residual i justificat. Haureu de fer-les arribar al SIC per tal de publicar-les manualment al Nexus.\r\n\r\nEs pot validar la existència o no de la dependència accedint a la següent URL: [Nexus](https://hudson.intranet.gencat.cat/nexus).\r\n\r\n## Modalitats de desplegament\r\nEs contemplen diverses modalitats de desplegament en funció de l’entorn. Actualment, el sistema previst seria el següent:\r\n\r\n* Entorn **INT**: automàtica (es construeixen els artefactes i es despleguen als servidors web, d’aplicacions i/o de bases de dades).\r\n* Entorn **PRE/PRO**: semiautomàtica (es dipositen els artefactes per a que el CPD s’encarregui del seu desplegament) o automàtic per CPD (modalitat automàtica on els tècnics de CPD assignats seran els encarregats d’autoritzar i executar les etapes de desplegament). Aquesta modalitat haurà d’acordar-se amb els diferents implicats. Ambdues modalitats delegaran qualsevol tasca prèvia al desplegament (backup, preparació de marxa enrere...) als tècnics de CPD.\r\n* **Altres** entorns: caldrà especificar la modalitat aplicable i quina posició ocuparan dins el procés de desplegament.\r\n\r\n## Funcionament dels jobs de Jenkins\r\nEn realitzar una pujada de codi sobre la branca MASTER, si el projecte té un job de Jenkins associat, automàticament es llençarà la canonada de desplegament:\r\n\r\n* Els jobs pipeline realitzen multitud de tasques encadenades mitjançant **STAGES**. En cas de produir-se alguna incidència, l'execució es cancel·larà i notificarà del que ha passat.\r\n* Caldrà limitar la quantitat d’usuaris que realitzen aquesta acció i tenir en compte que el sistema només permetrà fer una única pujada exitosa per versió del projecte ja que, un cop desplegat, es generarà el **TAG definitiu**.\r\n* Els artefactes es construiran una sola vegada a l’etapa de **BUILD** i seran els que es desplegaran als diferents entorns. No es contempla, doncs, condicionar la construcció d’artefactes a l’entorn on es desplegaran (ús profiles maven o similar).\r\n* Durant el desplegament es requeriran **accions d’usuari** destinades a autoritzar l’evolució de les etapes de desplegament.\r\n* Els jobs **notificaran** dels resultats a les adreces de correu assignades.\r\n* En els desplegaments en modalitat semiautomàtica, es generaran **tickets Remedy** en modo “Draft” a nom de l’usuari que ha iniciat l’execució, per lo que cal tenir pressent que aquest ha de disposar de permisos per a la creació de peticions de tipus CRQ.\r\n\r\nPer poder efectuar certes tasques caldrà accedir a la plataforma mitjançat el formulari d’autenticació de [Jenkins](https://hudson.intranet.gencat.cat/hudson).\r\n\r\n<br/><br/><br/>\r\nEs tracta d’una guia ràpida per a informar dels aspectes més rellevants a tenir en compte quan una aplicació es vol integrar amb el SIC.\r\n<br/>\r\nSi voleu més informació podeu consultar la secció de [Manuals](/sic/manuals/). <br/>\r\nSi teniu qualsevol dubte o problema assegureu-vos de no trobar resposta a les [FAQ] (/sic/faq) i utilitzeu el canal de [Suport] (/sic/suport) o contacteu amb l'Oficina Tècnica Canigó CTTI a través del correu electrònic: **oficina-tecnica.canigo.ctti@gencat.cat**.","objectID":"L3NpYy13ZWxjb21lLXBhY2svcHJlcGFyYXItYXBsaWNhY2lv"}}