<!DOCTYPE html>
<html xml:lang="ca-ES" lang="ca-ES" xmlns="http://www.w3.org/1999/xhtml">
<head>

	<title>Custodia de codi font</title>
		<meta charset="UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link rel="shortcut icon" type="image/x-icon" href="/img/favicon.ico" />
	<link href="/css/master.min.css" rel="stylesheet" type="text/css" />
	<link href="/css/canigo.css" rel="stylesheet" type="text/css" />
	<script src="/js/jquery.min.js" type="text/javascript"></script>

	<script>
		document.write("<meta name=\"titol\" content=\"Custodia de codi font\" />");
		document.write("<meta name=\"description\" content=\"GitLab és l\x27eina implantada al SIC per la custodia de codi font\" />");
	</script>

	

</head>
<body class="single">
	<div class="contenidor unfixed">

				

		<header class="fons_header navbar navbar-default z-index-menu">
			<div class="container" role="menu">
				<div class="row clearfix menuNav">
					<div class="col-md-3 col-xs-3 column visible-xs coloca ">
						<button type="button" onclick="amunt();" title="Menu"
							class="navbar-toggle pull-left" data-toggle="collapse"
							data-target=".navbar-collapse">
							<span class="sr-only">Toggle navigation</span> <span
								class="icon-bar"></span> <span class="icon-bar"></span> <span
								class="icon-bar"></span>
						</button>
					</div>

					<div class="col-md-3 col-xs-6 col-offset-2 column visible-xs titol-mobil">
						
						<span class="white titol-mobil-destacat">canigo.ctti</span><span class="white">.gencat.cat</span>
					</div>

					<div class="col-md-3 col-xs-3 column visible-xs coloca1">
						<button onclick="amunt();" type="button" title="Cerca"
							class="ico_cerca " data-toggle="collapse" data-target=".dos">
						</button>
					</div>

				</div>

				<div class="collapse dos">
					<div class="shadowBox">
						<form class="navbar-form navbar-left primer" action="/cercador/" method="get"
 						onsubmit="location.href=this.action+'?q='+this.cerca_cap.value; return false;">
							<div class="form-group">
								<input type="search" class="form-control" name="q" id="cerca_cap"
									title="Cerca"
									placeholder="Cerca" />
								<button type="button" title="Neteja" class="btn btn-default"></button>
								<input type="submit" class="ocult" name="Cerca" value="Cerca" />
							</div>
						</form>
					</div>
				</div>	

				<nav class="collapse navbar-collapse navbar-ex1-collapse ">
				
					<div class="row">
						<div class="col-md-6 col-sm-4 column">
							<a class="img-responsive logo" title="Generalitat de Catalunya"
								href="https://ctti.gencat.cat/">gencat.cat</a>
							<button class="menu_tancar visible-xs collapsed"
								data-target=".navbar-collapse" data-toggle="collapse"
								title="Tancar"></button>
						</div>

						<div class="col-md-6 col-sm-8 column hidden-xs hidden-mg">
							<form class="navbar-form cercador_vermell hidden-xs pull-right" action="/cercador/"  method="get" onsubmit="location.href=this.action+'?q='+this.cerca2.value; return false;">
								<div class="form-group">
									<label class="hidden" for="cerca2">Cerca</label>
									<input id="cerca2" class="form-control" type="search" 
									placeholder="Cerca" name="q" title="Cerca">
									<input class="btn btn-default" type="submit" title="Cerca" value="">
								</div>
							</form>

							

						</div>

					</div>
					<div class="col-xs-12 hidden-xs" id="nomPortal">
                    	<span class="titol-cap-nou">Centre de Telecomunicacions i Tecnologies de la Informació</span>
                    </div>					
					<ul class="nav navbar-nav">

			        	

						<li>
							<a class="dropdown-toggle" href='/' data-toggle='_dropdown'>Inici</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/principis' data-toggle='_dropdown'>Principis d&#39;arquitectura</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/blog' data-toggle='_dropdown'>Blog</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/cloud' data-toggle='_dropdown'>Cloud</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/canigo' data-toggle='_dropdown'>Canigó</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/sic' data-toggle='_dropdown'>SIC</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/sgde' data-toggle='_dropdown'>SGDE</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/gicar' data-toggle='_dropdown'>GICAR</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/cs' data-toggle='_dropdown'>Centres de Suport</a>
						</li>

						

					</ul>

				</nav>
			</div>
		</header>



	</div>

	<section class="border-start">

						
			

			<article class="bgGrey">
				<div class="container">
					<div class="row">
						<div class="capcelera_basica col-sm-12">
							<div class="capcelera_basica_cont">
								<ol class="breadcrumb filariana hidden-xs">
									<li>
										<a href="/">Inici</a>
									</li>
									<li class="breadcrumbs2">
									
										<a href="/sic-serveis">
											
























										</a>
										

































	<a href="/sic/">Servei d'Integració Contínua</a> </li>
	<li>
	
		<a href="/sic-serveis/">
	

	Serveis

	
		</a>
	


































									
									</li>

								</ol>

								<h1 class="capcelera_flotant pull-left" data-txt=".title">
									

										
											





	Custodia de codi font


										

									
								</h1>

								

								
								

								

								

							</div>
						</div>

					</div>
				</div>
			</article>

			


		   <div class="padding-xs container">
	    	
	    	   <i><b>Darrera actualització:</b></i> 02-01-2019
	        
           </div>
           
			<article class="padding-xs padding-sm padding-md contingut">				
				<div class="container">
 		
					
				

	

	<div class="row" id="TOC">
		<div class="col-md-12 col-xs-12"> 
			<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#introducció">Introducció</a></li>
<li><a href="#funcionament">Funcionament</a>
<ul>
<li><a href="#accés-al-servei">Accés al servei</a></li>
<li><a href="#creació-de-comptes-d-usuari-i-permisos-d-accés">Creació de comptes d&rsquo;usuari i permisos d&rsquo;accés</a></li>
<li><a href="#estructura-de-grups-i-projectes">Estructura de grups i projectes</a></li>
<li><a href="#creació-de-nous-projectes">Creació de nous projectes</a></li>
<li><a href="#integració-contínua">Integració contínua</a></li>
</ul></li>
<li><a href="#migració-repositoris-svn-a-git">Migració repositoris SVN a Git</a>
<ul>
<li>
<ul>
<li><a href="#1-eliminació-de-binaris">1. Eliminació de binaris</a></li>
<li><a href="#2-obtenir-els-autors">2. Obtenir els autors</a></li>
<li><a href="#3-obtenir-les-dades-del-svn">3. Obtenir les dades del SVN</a></li>
<li><a href="#4-tractament-del-codi-svn">4. Tractament del codi SVN</a></li>
<li><a href="#5-crear-projecte-en-git">5. Crear projecte en Git</a></li>
<li><a href="#6-pujar-el-codi-a-git">6. Pujar el codi a Git</a></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</nav>
    	</div>
	</div>

	


					

						

<h2 id="introducció">Introducció</h2>

<p><img src="/related/sic/serveis/gitlab-logo.png" alt="GitLab" title="GitLab" /></p>

<p><strong>GitLab</strong> és l&rsquo;eina implantada al SIC per la custodia de codi font. Es tracta d&rsquo;un servei web de control de versions i desenvolupament de software col·laboratiu basat en Git. A més de gestor de repositoris, el servei ofereix també allotjament de Wikis i un sistema de seguiment d&rsquo;errors, tot publicat sota una llicència de codi obert.</p>

<p>Aquest repositori no és un entorn de desenvolupament, per lo que només les persones assignades com a Release Managers seran les encarregades de <strong>consolidar el codi i lliurar-lo</strong>. Aquest codi font ja haurà d’estar validat en entorns de desenvolupament i es lliurarà quan es decideixi distribuir als entorns dels serveis TIC centrals.</p>

<h2 id="funcionament">Funcionament</h2>

<h3 id="accés-al-servei">Accés al servei</h3>

<p>Podrà accedir mitjançant el següent enllaç: <a href="https://git.intranet.gencat.cat">https://git.intranet.gencat.cat</a> <br/>
Haurà d&rsquo;autenticar-se amb de les seves credencials d&rsquo;accés <strong>GICAR</strong>. Els Release Manager, responsables de lot i tècnics de CPD disposaran d&rsquo;accés al servei, així com la resta de membres de l&rsquo;equip de desenvolupament als que es decideixi atorgar accés. Si no disposa d&rsquo;accés, haurà de sol·licitar-ho al seu responsable. <br/></p>

<p><img src="/related/sic/serveis/gitlab-sic.png" alt="GitLab" />
<br/></p>

<h3 id="creació-de-comptes-d-usuari-i-permisos-d-accés">Creació de comptes d&rsquo;usuari i permisos d&rsquo;accés</h3>

<p>Per a poder accedir al servei caldrà disposar d&rsquo;un usuari GICAR operatiu (amb l&rsquo;adreça de correu associada) i crear el compte corresponent. Per a fer-ho, haurà d&rsquo;introduir l&rsquo;identificador d&rsquo;usuari i contrasenya i, en cas de tractar-se d&rsquo;un nou compte, el sistema el redirigirà a la plana de perfil per a que pugui dur a terme el procés d&rsquo;alta. <br/>
Si no disposa d&rsquo;accés als grups i projectes s&rsquo;haurà d&rsquo;adreçar als <strong>Release Managers</strong> del codi de diàleg o al responsable del lot per a que l&rsquo;incloguin com a membre del projecte o projectes que es considerin. A partir d’aquest moment, ja podrà gestionar el codi font i a l&rsquo;endemà l&rsquo;usuari passarà a ser un Release Manager a tots els efectes, disposant d&rsquo;accés a tots els serveis del SIC per al codi de diàleg corresponent.</p>

<p>Per a més informació: <a href="/sic-serveis/autoservei-usuaris/">Autoservei d&rsquo;usuaris</a></p>

<h3 id="estructura-de-grups-i-projectes">Estructura de grups i projectes</h3>

<p>Totes les aplicacions que recull l&rsquo;inventari d&rsquo;aplicacions disposen automàticament d&rsquo;un grup al GitLab per al codi de diàleg del CTTI corresponent (per exemple: <a href="https://git.intranet.gencat.cat/0192">https://git.intranet.gencat.cat/0192</a>). Dins el grup assignat, es poden crear tants projectes com conjunts de codi susceptibles de ser versionats de forma independent. Pot tractar-se d&rsquo;una <strong>llibreria, un microservei, un mòdul o un programa sense fragments independents</strong>.
<br/>
Per accedir a la vista de grups i projectes, ho podrà fer des del menú d&rsquo;opcions generals (botó <img style="display:inline" src="/images/news/icone_menu_gitlab.PNG" alt="icone menu gitlab"/> situat a la part superior esquerra).
<br/>
No es poden incloure binaris de llibreries ni d’altres mòduls ni executables (JAR, WAR, EAR, DLL, EXE…) i la mida màxima dels arxius serà de 25MB. En tot cas, a tal efecte es podrà fer ús del servei de gestió de binaris.</p>

<p>Per a més informació: <a href="/sic-serveis/binaris/">Binaris</a></p>

<h3 id="creació-de-nous-projectes">Creació de nous projectes</h3>

<p>Per a crear nous projectes caldrà dirigir-se al grup del codi de diàleg i prémer l&rsquo;acció &ldquo;New project&rdquo;. Haurà d&rsquo;indicar el nom del projecte i seleccionar el nivell de visibilitat &ldquo;Private&rdquo;.</p>

<p><CENTER><img src="/related/sic/serveis/new_project.png" alt="Nou projecte" /></center>
<br/></p>

<h3 id="integració-contínua">Integració contínua</h3>

<p>En publicar una nova versió del codi font sobre la branca MASTER, automàticament es dispararà la tasca de construcció i desplegament associada en el sistema d&rsquo;Integració Contínua (Jenkins). En aquest sentit, cal tenir pressents algunes premisses:</p>

<ul>
<li>Els repositoris poden tenir tantes branques com siguin necessàries, però sempre s’haurà d’incloure la branca <strong>MASTER</strong> i el contingut d’aquesta branca serà amb el que treballarà la tasca associada.</li>
<li>Cal proporcionar processos de construcció d’artefactes <strong>independents de les màquines i plataformes</strong> on s’executen, de forma que siguin aplicables tant en els entorns de desenvolupament com en els entorns del SIC.
Per a més informació: <a href="/sic-serveis/ci/">Integració contínua</a></li>
</ul>

<h2 id="migració-repositoris-svn-a-git">Migració repositoris SVN a Git</h2>

<p>Per aplicacions que encara no hagin migrat el seu codi font cap a l&rsquo;eina actual de custodia de codi font del SIC (GitLab), podran fer-ho si s&rsquo;acompleixen els següents requisits:</p>

<ul>
<li>Utilitzar un sistema operatiu Linux i tenir instal·lats els paquets git, git-svn i svn.</li>
<li>El repositori a migrar <strong>no pot contenir binaris</strong> (.jar, .war, .ear, .dll, .exe, carpeta &ldquo;node_modules&rdquo;) <strong>ni arxius de mida superior a 25 MB</strong>.
Actualment el repositori original a SVN es troba disponible en mode lectura per a poder accedir a l&rsquo;historial. Per a dur a terme la migració al nou sistema, caldrà seguir les següents passes:</li>
</ul>

<p><br/></p>

<h4 id="1-eliminació-de-binaris">1. Eliminació de binaris</h4>

<p>El Git del SIC té restriccions alhora de pujar fitxers binaris, fet que pot provocar errors en el procés de migració. Aquests repositoris que tinguin binaris no es podran migrar al Git, romandran en el SVN en mode lectura. Per aquests casos, per començar a treballar amb Git s&rsquo;haurien de seguir els següents passos:</p>

<ul>
<li>Descarregar el darrer tag del SVN</li>
<li>Eliminar els binaris. Podem tenir dos casos:

<ul>
<li>Binaris prescindibles: es poden generar a partir de codi font de l&rsquo;aplicació, i per tant, no cal conservar-los</li>
<li>Binaris no prescindibles: s&rsquo;han d&rsquo;ubicar en el <a href="/sic-serveis/binaris/">servei de custodia de binaris</a> o al <a href="https://hudson.intranet.gencat.cat/nexus/">Nexus</a> del SIC.</li>
</ul></li>
<li>Inicialitzar el repositori Git local (git init)</li>
<li>Fer el commit, push i tag d&rsquo;aquesta versió inicial al Git
Un cop finalitzat aquest procés al Git es disposarà del tag més recent. L&rsquo;històric es mantindrà al SVN en mode lectura.</li>
</ul>

<p><br/></p>

<h4 id="2-obtenir-els-autors">2. Obtenir els autors</h4>

<p>En primer lloc, s&rsquo;ha de consultar qui ha modificat els arxius del SVN. Per fer això s&rsquo;ha preparat un <a href="https://hudson.intranet.gencat.cat/hudson/job/MIGRACIO_GENERAR_AUTORS/">job de Jenkins</a>.</p>

<p>S&rsquo;ha d&rsquo;executar aquest job informant els següents paràmetres:</p>

<pre><code>DEPARTAMENT -&gt; acrònim del departament (En una ruta com http://svn.intranet.gencat.cat/ctt/0192/) seria ctt )
CODI_DIALEG -&gt; codi de diàleg (Per exemple 0192)
</code></pre>

<p>Una vegada executat el job envia per email el fitxer author.txt a l&rsquo;usuari que ha executat el job.</p>

<p>S&rsquo;ha de descarregar i desar el fitxer a la carpeta desitjada, en aquest howto /migració.</p>

<p>A més d&rsquo;obtenir el fitxer author.txt, s&rsquo;ha de descarregar el següent <a href="/related/sic/howto/unknown_author.zip">fitxer</a> i descomprimir-lo en la mateixa carpeta (/migracio). Aquest zip conté un procés per a evitar errors en el següent pas.</p>

<p><br/></p>

<h4 id="3-obtenir-les-dades-del-svn">3. Obtenir les dades del SVN</h4>

<p>Per a obtenir les dades del SVN que s&rsquo;han de migrar, dintre de la carpeta /migracio (on es troba el fitxer author.txt) executar:</p>

<pre><code>git svn clone --authors-file=author.txt --authors-prog=unknown_author.sh http://svn.intranet.gencat.cat/$1/$2/$3 --no-metadata -s $4
</code></pre>

<p>On s&rsquo;ha de substituir les variables segons:</p>

<pre><code>$1 -&gt; acrònim del departament (En una ruta com http://svn.intranet.gencat.cat/ctt/0192/) seria ctt )
$2 -&gt; codi de diàleg (Per exemple 0192)
$3 -&gt; path de la carpeta que conté les carpetes tags, trunk i branches. En cas que estiguin a l'arrel no posar res.
$4 -&gt; nom de la carpeta que es crea al sistema de fitxers locals on es deixa el codi
</code></pre>

<p><br/></p>

<h4 id="4-tractament-del-codi-svn">4. Tractament del codi SVN</h4>

<p>Accedir a la carpeta que s&rsquo;ha creat en el punt anterior ($4) i abans de pujar el codi a Git executar les següents comandes:</p>

<pre><code>cp -Rf .git/refs/remotes/origin/tags/* .git/refs/tags/
rm -Rf .git/refs/remotes/origin/tags
cp -Rf .git/refs/remotes/* .git/refs/heads/
rm -Rf .git/refs/remotes
for i in $(ls .git/refs/tags/ -1 | grep '@'); do rm &quot;.git/refs/tags/$i&quot;; done
</code></pre>

<p><br/></p>

<h4 id="5-crear-projecte-en-git">5. Crear projecte en Git</h4>

<p>Per a crear el projecte en Git heu d&rsquo;accedir a <a href="https://git.intranet.gencat.cat">https://git.intranet.gencat.cat</a> anar al grup del vostre codi de diàleg i prémer l&rsquo;acció &ldquo;New Project&rdquo;.</p>

<p><br/></p>

<h4 id="6-pujar-el-codi-a-git">6. Pujar el codi a Git</h4>

<p>A la carpeta on s&rsquo;ha desat el codi del SVN executar:</p>

<pre><code>git remote add origin https://$1@git.intranet.gencat.cat/$2/$3.git
</code></pre>

<p>On s&rsquo;ha de substituir les variables segons:</p>

<pre><code>$1 -&gt; usuari GitLab
$2 -&gt; codi de diàleg (Per exemple 0192)
$3 -&gt; Nom del projecte de GitLab
</code></pre>

<p>Per finalitzar es puja el codi a Git</p>

<pre><code>git push origin --all
git push --tags
</code></pre>

<p>És molt important analitzar el log que mostra Git per pantalla per assegurar que no hi ha errors i s&rsquo;han migrat tant el trunk com tots els tags.</p>

<p><br/><br/><br/>
Si voleu més informació podeu consultar la secció de <a href="/sic/manuals/">Manuals</a>. <br/>
Si teniu qualsevol dubte o problema assegureu-vos de no trobar resposta a les <a href="/sic/faq">FAQ</a> i utilitzeu el canal de <a href="/sic/suport">Suport</a> o contacteu amb l&rsquo;Oficina Tècnica Canigó CTTI a través del correu electrònic: <strong>oficina-tecnica.canigo.ctti@gencat.cat</strong>.</p>


					

					
				</div>	

			</article>	


	</section>	

		<div class="fons_footer ">
		<footer class="container center-block shadowBox2">
			<div class="shadow2"></div>
			<div class="row footer_tab_ord">

				<div class="footer_tab_bot col-sm-12">
					<div class="avis_legal">

						<div id="fAvisLegal">
							<div>
								<div class="hidden-xs">
									<a href="https://www.gencat.cat"> <img
										src="/img/logo_generalitat_gris.png_679097835.png"
										width="101" height="27" alt="www.gencat.cat"
										/></a>
									<p>
										<a title="Avis legal" href="https://web.gencat.cat/ca/menu-ajuda/ajuda/avis_legal/" target="_self">Avís legal</a>: La &copy; Generalitat de Catalunya permet la reutilització dels continguts i de les dades sempre que se citi la font i la data d'actualització, que no es desnaturalitzi la informació i que no es contradigui amb una llicència específica.
									</p>
								</div>
								<div class="visible-xs avis_legal">
									<p>
										<a title="Avis legal" href="https://web.gencat.cat/ca/menu-ajuda/ajuda/avis_legal/" target="_self">Avís legal</a>: La &copy; Generalitat de Catalunya permet la reutilització dels continguts i de les dades sempre que se citi la font i la data d'actualització, que no es desnaturalitzi la informació i que no es contradigui amb una llicència específica.
									</p>
								</div>
								
								<div class="fi_peu visible-xs">
									<a title="www.gencat.cat" href="https://www.gencat.cat"> <img
										src="/img/logo_generalitat_gris.png_679097835.png"
										width="101" height="27" 
										alt="www.gencat.cat" /></a> <a class="torna_amunt pull-right"
										href=" javascript:tornarAmunt();" title="Torna amunt">
										<p>Torna amunt</p>
									</a>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</footer>
	</div>

<script src="/js/master.min.js" type="text/javascript"></script>
<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
<script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.min.js"></script>
<script src="/js/custom.js" type="text/javascript"></script>



<script type="text/javascript">

if(location.hostname!=="localhost"){

	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', "UA-59408075-1", 'auto');
	ga('send', 'pageview', {
	  	'page': location.pathname + location.search  + location.hash
	  }
	);

}

</script>




</body>
</html>
